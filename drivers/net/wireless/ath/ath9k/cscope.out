cscope 15 /media/bacchus00/2447ef67-a1bd-41b7-bb02-3966279d9c18/openwrt/build_dir/target-mips_34kc_uClibc-0.9.33.2/linux-ar71xx_generic/compat-wireless-2016-01-10/drivers/net/wireless/ath/ath9k               0001971145
	@ahb.c

19 
	~<löux/∆80211.h
>

20 
	~<löux/∂©f‹m_devi˚.h
>

21 
	~<löux/©h9k_∂©f‹m.h
>

22 
	~<löux/moduÀ.h
>

23 
	~"©h9k.h
"

25 c⁄° 
∂©f‹m_devi˚_id
 
	g©h9k_∂©f‹m_id_èbÀ
[] = {

27 .
«me
 = "ath9k",

28 .
	gdrivî_d©a
 = 
AR5416_AR9100_DEVID
,

31 .
	g«me
 = "ar933x_wmac",

32 .
	gdrivî_d©a
 = 
AR9300_DEVID_AR9330
,

35 .
	g«me
 = "ar934x_wmac",

36 .
	gdrivî_d©a
 = 
AR9300_DEVID_AR9340
,

39 .
	g«me
 = "qca955x_wmac",

40 .
	gdrivî_d©a
 = 
AR9300_DEVID_QCA955X
,

43 .
	g«me
 = "qca953x_wmac",

44 .
	gdrivî_d©a
 = 
AR9300_DEVID_AR953X
,

47 .
	g«me
 = "qca956x_wmac",

48 .
	gdrivî_d©a
 = 
AR9300_DEVID_QCA956X
,

54 
	$©h_ahb_ªad_ˇchesize
(
©h_comm⁄
 *
comm⁄
, *
csz
)

56 *
csz
 = 
L1_CACHE_BYTES
 >> 2;

57 
	}
}

59 
boﬁ
 
	$©h_ahb_ì¥om_ªad
(
©h_comm⁄
 *
comm⁄
, 
u32
 
off
, 
u16
 *
d©a
)

61 
©h_so·c
 *
sc
 = (©h_so·¯*)
comm⁄
->
¥iv
;

62 
∂©f‹m_devi˚
 *
pdev
 = 
	`to_∂©f‹m_devi˚
(
sc
->
dev
);

63 
©h9k_∂©f‹m_d©a
 *
pd©a
;

65 
pd©a
 = 
	`dev_gë_∂©d©a
(&
pdev
->
dev
);

66 i‡(
off
 >(
	`ARRAY_SIZE
(
pd©a
->
ì¥om_d©a
))) {

67 
	`©h_îr
(
comm⁄
,

69 
__func__
, 
off
);

70  
Ál£
;

73 *
d©a
 = 
pd©a
->
ì¥om_d©a
[
off
];

74  
åue
;

75 
	}
}

77 
©h_bus_›s
 
	g©h_ahb_bus_›s
 = {

78 .
©h_bus_ty≥
 = 
ATH_AHB
,

79 .
	gªad_ˇchesize
 = 
©h_ahb_ªad_ˇchesize
,

80 .
	gì¥om_ªad
 = 
©h_ahb_ì¥om_ªad
,

83 
	$©h_ahb_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

85 
__iomem
 *
mem
;

86 
©h_so·c
 *
sc
;

87 
õì80211_hw
 *
hw
;

88 
ªsour˚
 *
ªs
;

89 c⁄° 
∂©f‹m_devi˚_id
 *
id
 = 
	`∂©f‹m_gë_devi˚_id
(
pdev
);

90 
úq
;

91 
ªt
 = 0;

92 
©h_hw
 *
ah
;

93 
hw_«me
[64];

95 i‡(!
	`dev_gë_∂©d©a
(&
pdev
->
dev
)) {

96 
	`dev_îr
(&
pdev
->
dev
, "noÖlatform data specified\n");

97  -
EINVAL
;

100 
ªs
 = 
	`∂©f‹m_gë_ªsour˚
(
pdev
, 
IORESOURCE_MEM
, 0);

101 i‡(
ªs
 =
NULL
) {

102 
	`dev_îr
(&
pdev
->
dev
, "no memoryÑesource found\n");

103  -
ENXIO
;

106 
mem
 = 
	`devm_i‹em≠_noˇche
(&
pdev
->
dev
, 
ªs
->
°¨t
, 
	`ªsour˚_size
(res));

107 i‡(
mem
 =
NULL
) {

108 
	`dev_îr
(&
pdev
->
dev
, "ioremap failed\n");

109  -
ENOMEM
;

112 
ªs
 = 
	`∂©f‹m_gë_ªsour˚
(
pdev
, 
IORESOURCE_IRQ
, 0);

113 i‡(
ªs
 =
NULL
) {

114 
	`dev_îr
(&
pdev
->
dev
, "no IRQÑesource found\n");

115  -
ENXIO
;

118 
úq
 = 
ªs
->
°¨t
;

120 
	`©h9k_fûl_ch™˘x_›s
();

121 
hw
 = 
	`õì80211_Æloc_hw
((
©h_so·c
), &
©h9k_›s
);

122 i‡(
hw
 =
NULL
) {

123 
	`dev_îr
(&
pdev
->
dev
, "no memory for ieee80211_hw\n");

124  -
ENOMEM
;

127 
	`SET_IEEE80211_DEV
(
hw
, &
pdev
->
dev
);

128 
	`∂©f‹m_£t_drvd©a
(
pdev
, 
hw
);

130 
sc
 = 
hw
->
¥iv
;

131 
sc
->
hw
 = hw;

132 
sc
->
dev
 = &
pdev
->dev;

133 
sc
->
mem
 = mem;

134 
sc
->
úq
 = irq;

136 
ªt
 = 
	`ªque°_úq
(
úq
, 
©h_i§
, 
IRQF_SHARED
, "©h9k", 
sc
);

137 i‡(
ªt
) {

138 
	`dev_îr
(&
pdev
->
dev
, "request_irq failed\n");

139 
îr_‰ì_hw
;

142 
ªt
 = 
	`©h9k_öô_devi˚
(
id
->
drivî_d©a
, 
sc
, &
©h_ahb_bus_›s
);

143 i‡(
ªt
) {

144 
	`dev_îr
(&
pdev
->
dev
, "failedÅo initialize device\n");

145 
îr_úq
;

148 
ah
 = 
sc
->
sc_ah
;

149 
	`©h9k_hw_«me
(
ah
, 
hw_«me
, (hw_name));

150 
	`wùhy_öfo
(
hw
->
wùhy
, "%s mem=0x%lx, irq=%d\n",

151 
hw_«me
, ()
mem
, 
úq
);

155 
îr_úq
:

156 
	`‰ì_úq
(
úq
, 
sc
);

157 
îr_‰ì_hw
:

158 
	`õì80211_‰ì_hw
(
hw
);

159  
ªt
;

160 
	}
}

162 
	$©h_ahb_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

164 
õì80211_hw
 *
hw
 = 
	`∂©f‹m_gë_drvd©a
(
pdev
);

166 i‡(
hw
) {

167 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

169 
	`©h9k_deöô_devi˚
(
sc
);

170 
	`‰ì_úq
(
sc
->
úq
, sc);

171 
	`õì80211_‰ì_hw
(
sc
->
hw
);

175 
	}
}

177 
∂©f‹m_drivî
 
	g©h_ahb_drivî
 = {

178 .
¥obe
 = 
©h_ahb_¥obe
,

179 .
	gªmove
 = 
©h_ahb_ªmove
,

180 .
	gdrivî
 = {

181 .
«me
 = "ath9k",

183 .
	gid_èbÀ
 = 
©h9k_∂©f‹m_id_èbÀ
,

186 
MODULE_DEVICE_TABLE
(
∂©f‹m
, 
©h9k_∂©f‹m_id_èbÀ
);

188 
	$©h_ahb_öô
()

190  
	`∂©f‹m_drivî_ªgi°î
(&
©h_ahb_drivî
);

191 
	}
}

193 
	$©h_ahb_exô
()

195 
	`∂©f‹m_drivî_uƒegi°î
(&
©h_ahb_drivî
);

196 
	}
}

	@ani.c

17 
	~<löux/kî√l.h
>

18 
	~<löux/exp‹t.h
>

19 
	~"hw.h
"

20 
	~"hw-›s.h
"

22 
	s™i_ofdm_Àvñ_íåy
 {

23 
	m•ur_immunôy_Àvñ
;

24 
	mfú_°ï_Àvñ
;

25 
	mofdm_wók_sig«l_⁄
;

39 c⁄° 
™i_ofdm_Àvñ_íåy
 
	gofdm_Àvñ_èbÀ
[] = {

52 
	#ATH9K_ANI_OFDM_NUM_LEVEL
 \

53 
	`ARRAY_SIZE
(
ofdm_Àvñ_èbÀ
)

	)

54 
	#ATH9K_ANI_OFDM_MAX_LEVEL
 \

55 (
ATH9K_ANI_OFDM_NUM_LEVEL
-1)

	)

56 
	#ATH9K_ANI_OFDM_DEF_LEVEL
 \

57 3

	)

80 
	s™i_cck_Àvñ_íåy
 {

81 
	mfú_°ï_Àvñ
;

82 
	mmrc_cck_⁄
;

85 c⁄° 
™i_cck_Àvñ_íåy
 
	gcck_Àvñ_èbÀ
[] = {

98 
	#ATH9K_ANI_CCK_NUM_LEVEL
 \

99 
	`ARRAY_SIZE
(
cck_Àvñ_èbÀ
)

	)

100 
	#ATH9K_ANI_CCK_MAX_LEVEL
 \

101 (
ATH9K_ANI_CCK_NUM_LEVEL
-1)

	)

102 
	#ATH9K_ANI_CCK_MAX_LEVEL_LOW_RSSI
 \

103 (
ATH9K_ANI_CCK_NUM_LEVEL
-3)

	)

104 
	#ATH9K_ANI_CCK_DEF_LEVEL
 \

105 2

	)

107 
	$©h9k_hw_upd©e_mib°©s
(
©h_hw
 *
ah
,

108 
©h9k_mib_°©s
 *
°©s
)

110 
u32
 
addr
[5] = {
AR_RTS_OK
, 
AR_RTS_FAIL
, 
AR_ACK_FAIL
,

111 
AR_FCS_FAIL
, 
AR_BEACON_CNT
};

112 
u32
 
d©a
[5];

114 
	`REG_READ_MULTI
(
ah
, &
addr
[0], &
d©a
[0], 5);

116 
°©s
->
πs_good
 +
d©a
[0];

118 
°©s
->
πs_bad
 +
d©a
[1];

120 
°©s
->
ackrcv_bad
 +
d©a
[2];

122 
°©s
->
fcs_bad
 +
d©a
[3];

124 
°©s
->
bóc⁄s
 +
d©a
[4];

125 
	}
}

127 
	$©h9k_™i_ª°¨t
(
©h_hw
 *
ah
)

129 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

131 
™iSèã
->
li°íTime
 = 0;

133 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

135 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_1
, 0);

136 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_2
, 0);

137 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_MASK_1
, 
AR_PHY_ERR_OFDM_TIMING
);

138 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_MASK_2
, 
AR_PHY_ERR_CCK_TIMING
);

140 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

142 
	`©h9k_hw_upd©e_mib°©s
(
ah
, &ah->
ah_mibSèts
);

144 
™iSèã
->
ofdmPhyEºCou¡
 = 0;

145 
™iSèã
->
cckPhyEºCou¡
 = 0;

146 
	}
}

149 
	$©h9k_hw_£t_ofdm_nû
(
©h_hw
 *
ah
, 
u8
 
immunôyLevñ
,

150 
boﬁ
 
sˇn
)

152 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

153 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

154 c⁄° 
™i_ofdm_Àvñ_íåy
 *
íåy_ofdm
;

155 c⁄° 
™i_cck_Àvñ_íåy
 *
íåy_cck
;

156 
boﬁ
 
wók_sig
;

158 
	`©h_dbg
(
comm⁄
, 
ANI
, "**** ofdmlevel %d=>%d,Ñssi=%d[lo=%d hi=%d]\n",

159 
™iSèã
->
ofdmNoi£ImmunôyLevñ
,

160 
immunôyLevñ
, 
	`BEACON_RSSI
(
ah
),

161 
ATH9K_ANI_RSSI_THR_LOW
,

162 
ATH9K_ANI_RSSI_THR_HIGH
);

164 i‡(
	`AR_SREV_9100
(
ah
Ë&& 
immunôyLevñ
 < 
ATH9K_ANI_OFDM_DEF_LEVEL
)

165 
immunôyLevñ
 = 
ATH9K_ANI_OFDM_DEF_LEVEL
;

167 i‡(!
sˇn
)

168 
™iSèã
->
ofdmNoi£ImmunôyLevñ
 = 
immunôyLevñ
;

170 
íåy_ofdm
 = &
ofdm_Àvñ_èbÀ
[
™iSèã
->
ofdmNoi£ImmunôyLevñ
];

171 
íåy_cck
 = &
cck_Àvñ_èbÀ
[
™iSèã
->
cckNoi£ImmunôyLevñ
];

173 i‡(
™iSèã
->
•urImmunôyLevñ
 !
íåy_ofdm
->
•ur_immunôy_Àvñ
)

174 
	`©h9k_hw_™i_c⁄åﬁ
(
ah
,

175 
ATH9K_ANI_SPUR_IMMUNITY_LEVEL
,

176 
íåy_ofdm
->
•ur_immunôy_Àvñ
);

178 i‡(
™iSèã
->
fú°ïLevñ
 !
íåy_ofdm
->
fú_°ï_Àvñ
 &&

179 
íåy_ofdm
->
fú_°ï_Àvñ
 >
íåy_cck
->fir_step_level)

180 
	`©h9k_hw_™i_c⁄åﬁ
(
ah
,

181 
ATH9K_ANI_FIRSTEP_LEVEL
,

182 
íåy_ofdm
->
fú_°ï_Àvñ
);

184 
wók_sig
 = 
íåy_ofdm
->
ofdm_wók_sig«l_⁄
;

185 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_STATION
 &&

186 
	`BEACON_RSSI
(
ah
Ë<
ATH9K_ANI_RSSI_THR_HIGH
)

187 
wók_sig
 = 
åue
;

193 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
) &&

194 
ah
->
›mode
 !
NL80211_IFTYPE_STATION
)

195 
wók_sig
 = 
åue
;

198 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
) &&

199 
™iSèã
->
ofdmNoi£ImmunôyLevñ
 >= 8)

200 
wók_sig
 = 
Ál£
;

202 i‡(
™iSèã
->
ofdmWókSigDëe˘
 !
wók_sig
)

203 
	`©h9k_hw_™i_c⁄åﬁ
(
ah
, 
ATH9K_ANI_OFDM_WEAK_SIGNAL_DETECTION
,

204 
wók_sig
);

206 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

209 i‡(
™iSèã
->
ofdmNoi£ImmunôyLevñ
 >
ATH9K_ANI_OFDM_DEF_LEVEL
) {

210 
ah
->
c⁄fig
.
ofdm_åig_high
 = 
ATH9K_ANI_OFDM_TRIG_HIGH
;

211 
ah
->
c⁄fig
.
ofdm_åig_low
 = 
ATH9K_ANI_OFDM_TRIG_LOW_ABOVE_INI
;

213 
ah
->
c⁄fig
.
ofdm_åig_high
 = 
ATH9K_ANI_OFDM_TRIG_HIGH_BELOW_INI
;

214 
ah
->
c⁄fig
.
ofdm_åig_low
 = 
ATH9K_ANI_OFDM_TRIG_LOW
;

216 
	}
}

218 
	$©h9k_hw_™i_ofdm_îr_åiggî
(
©h_hw
 *
ah
)

220 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

222 i‡(
™iSèã
->
ofdmNoi£ImmunôyLevñ
 < 
ATH9K_ANI_OFDM_MAX_LEVEL
)

223 
	`©h9k_hw_£t_ofdm_nû
(
ah
, 
™iSèã
->
ofdmNoi£ImmunôyLevñ
 + 1, 
Ál£
);

224 
	}
}

229 
	$©h9k_hw_£t_cck_nû
(
©h_hw
 *
ah
, 
u_öt8_t
 
immunôyLevñ
,

230 
boﬁ
 
sˇn
)

232 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

233 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

234 c⁄° 
™i_ofdm_Àvñ_íåy
 *
íåy_ofdm
;

235 c⁄° 
™i_cck_Àvñ_íåy
 *
íåy_cck
;

237 
	`©h_dbg
(
comm⁄
, 
ANI
, "**** ccklevel %d=>%d,Ñssi=%d[lo=%d hi=%d]\n",

238 
™iSèã
->
cckNoi£ImmunôyLevñ
, 
immunôyLevñ
,

239 
	`BEACON_RSSI
(
ah
), 
ATH9K_ANI_RSSI_THR_LOW
,

240 
ATH9K_ANI_RSSI_THR_HIGH
);

242 i‡(
	`AR_SREV_9100
(
ah
Ë&& 
immunôyLevñ
 < 
ATH9K_ANI_CCK_DEF_LEVEL
)

243 
immunôyLevñ
 = 
ATH9K_ANI_CCK_DEF_LEVEL
;

245 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_STATION
 &&

246 
	`BEACON_RSSI
(
ah
Ë<
ATH9K_ANI_RSSI_THR_LOW
 &&

247 
immunôyLevñ
 > 
ATH9K_ANI_CCK_MAX_LEVEL_LOW_RSSI
)

248 
immunôyLevñ
 = 
ATH9K_ANI_CCK_MAX_LEVEL_LOW_RSSI
;

250 i‡(!
sˇn
)

251 
™iSèã
->
cckNoi£ImmunôyLevñ
 = 
immunôyLevñ
;

253 
íåy_ofdm
 = &
ofdm_Àvñ_èbÀ
[
™iSèã
->
ofdmNoi£ImmunôyLevñ
];

254 
íåy_cck
 = &
cck_Àvñ_èbÀ
[
™iSèã
->
cckNoi£ImmunôyLevñ
];

256 i‡(
™iSèã
->
fú°ïLevñ
 !
íåy_cck
->
fú_°ï_Àvñ
 &&

257 
íåy_cck
->
fú_°ï_Àvñ
 >
íåy_ofdm
->fir_step_level)

258 
	`©h9k_hw_™i_c⁄åﬁ
(
ah
,

259 
ATH9K_ANI_FIRSTEP_LEVEL
,

260 
íåy_cck
->
fú_°ï_Àvñ
);

263 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9485
(ah) ||

264 
	`AR_SREV_9565
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

267 i‡(
™iSèã
->
mrcCCK
 !
íåy_cck
->
mrc_cck_⁄
)

268 
	`©h9k_hw_™i_c⁄åﬁ
(
ah
,

269 
ATH9K_ANI_MRC_CCK
,

270 
íåy_cck
->
mrc_cck_⁄
);

271 
	}
}

273 
	$©h9k_hw_™i_cck_îr_åiggî
(
©h_hw
 *
ah
)

275 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

277 i‡(
™iSèã
->
cckNoi£ImmunôyLevñ
 < 
ATH9K_ANI_CCK_MAX_LEVEL
)

278 
	`©h9k_hw_£t_cck_nû
(
ah
, 
™iSèã
->
cckNoi£ImmunôyLevñ
 + 1,

279 
Ál£
);

280 
	}
}

286 
	$©h9k_hw_™i_lowî_immunôy
(
©h_hw
 *
ah
)

288 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

291 i‡(
™iSèã
->
ofdmNoi£ImmunôyLevñ
 > 0 &&

292 (
™iSèã
->
ofdmsTu∫
 ||ániSèã->
cckNoi£ImmunôyLevñ
 == 0)) {

293 
	`©h9k_hw_£t_ofdm_nû
(
ah
, 
™iSèã
->
ofdmNoi£ImmunôyLevñ
 - 1,

294 
Ál£
);

299 i‡(
™iSèã
->
cckNoi£ImmunôyLevñ
 > 0)

300 
	`©h9k_hw_£t_cck_nû
(
ah
, 
™iSèã
->
cckNoi£ImmunôyLevñ
 - 1,

301 
Ál£
);

302 
	}
}

309 
	$©h9k_™i_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
is_sˇ¬ög
)

311 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

312 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

313 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

314 
ofdm_nû
, 
cck_nû
;

316 i‡(!
ch™
)

319 
	`BUG_ON
(
™iSèã
 =
NULL
);

320 
ah
->
°©s
.
a°_™i_ª£t
++;

322 
ofdm_nû
 = 
	`max_t
(, 
ATH9K_ANI_OFDM_DEF_LEVEL
,

323 
™iSèã
->
ofdmNoi£ImmunôyLevñ
);

324 
cck_nû
 = 
	`max_t
(, 
ATH9K_ANI_CCK_DEF_LEVEL
,

325 
™iSèã
->
cckNoi£ImmunôyLevñ
);

327 i‡(
is_sˇ¬ög
 ||

328 (
ah
->
›mode
 !
NL80211_IFTYPE_STATION
 &&

329 
ah
->
›mode
 !
NL80211_IFTYPE_ADHOC
)) {

336 i‡(
™iSèã
->
ofdmNoi£ImmunôyLevñ
 !=

337 
ATH9K_ANI_OFDM_DEF_LEVEL
 ||

338 
™iSèã
->
cckNoi£ImmunôyLevñ
 !=

339 
ATH9K_ANI_CCK_DEF_LEVEL
) {

340 
	`©h_dbg
(
comm⁄
, 
ANI
,

342 
ah
->
›mode
,

343 
ch™
->
ch™√l
,

344 
is_sˇ¬ög
,

345 
™iSèã
->
ofdmNoi£ImmunôyLevñ
,

346 
™iSèã
->
cckNoi£ImmunôyLevñ
);

348 
ofdm_nû
 = 
ATH9K_ANI_OFDM_DEF_LEVEL
;

349 
cck_nû
 = 
ATH9K_ANI_CCK_DEF_LEVEL
;

355 
	`©h_dbg
(
comm⁄
, 
ANI
,

357 
ah
->
›mode
,

358 
ch™
->
ch™√l
,

359 
is_sˇ¬ög
,

360 
™iSèã
->
ofdmNoi£ImmunôyLevñ
,

361 
™iSèã
->
cckNoi£ImmunôyLevñ
);

363 
	`©h9k_hw_£t_ofdm_nû
(
ah
, 
ofdm_nû
, 
is_sˇ¬ög
);

364 
	`©h9k_hw_£t_cck_nû
(
ah
, 
cck_nû
, 
is_sˇ¬ög
);

366 
	`©h9k_™i_ª°¨t
(
ah
);

367 
	}
}

369 
boﬁ
 
	$©h9k_hw_™i_ªad_cou¡îs
(
©h_hw
 *
ah
)

371 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

372 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

373 
u32
 
phyC¡1
, 
phyC¡2
;

374 
öt32_t
 
li°íTime
;

376 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

377 
li°íTime
 = 
	`©h_hw_gë_li°í_time
(
comm⁄
);

379 i‡(
li°íTime
 <= 0) {

380 
ah
->
°©s
.
a°_™i_ eg_‹_lzîo
++;

381 
	`©h9k_™i_ª°¨t
(
ah
);

382  
Ál£
;

385 
™iSèã
->
li°íTime
 +=ÜistenTime;

387 
	`©h9k_hw_upd©e_mib°©s
(
ah
, &ah->
ah_mibSèts
);

389 
phyC¡1
 = 
	`REG_READ
(
ah
, 
AR_PHY_ERR_1
);

390 
phyC¡2
 = 
	`REG_READ
(
ah
, 
AR_PHY_ERR_2
);

392 
ah
->
°©s
.
a°_™i_ofdmîrs
 +
phyC¡1
 - 
™iSèã
->
ofdmPhyEºCou¡
;

393 
™iSèã
->
ofdmPhyEºCou¡
 = 
phyC¡1
;

395 
ah
->
°©s
.
a°_™i_cckîrs
 +
phyC¡2
 - 
™iSèã
->
cckPhyEºCou¡
;

396 
™iSèã
->
cckPhyEºCou¡
 = 
phyC¡2
;

398  
åue
;

399 
	}
}

401 
	$©h9k_hw_™i_m⁄ô‹
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

403 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

404 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

405 
u32
 
ofdmPhyEºR©e
, 
cckPhyEºR©e
;

407 i‡(!
	`©h9k_hw_™i_ªad_cou¡îs
(
ah
))

410 
ofdmPhyEºR©e
 = 
™iSèã
->
ofdmPhyEºCou¡
 * 1000 /

411 
™iSèã
->
li°íTime
;

412 
cckPhyEºR©e
 = 
™iSèã
->
cckPhyEºCou¡
 * 1000 /

413 
™iSèã
->
li°íTime
;

415 
	`©h_dbg
(
comm⁄
, 
ANI
,

417 
™iSèã
->
li°íTime
,

418 
™iSèã
->
ofdmNoi£ImmunôyLevñ
,

419 
ofdmPhyEºR©e
, 
™iSèã
->
cckNoi£ImmunôyLevñ
,

420 
cckPhyEºR©e
, 
™iSèã
->
ofdmsTu∫
);

422 i‡(
™iSèã
->
li°íTime
 > 
ah
->
™ùîiod
) {

423 i‡(
cckPhyEºR©e
 < 
ah
->
c⁄fig
.
cck_åig_low
 &&

424 
ofdmPhyEºR©e
 < 
ah
->
c⁄fig
.
ofdm_åig_low
) {

425 
	`©h9k_hw_™i_lowî_immunôy
(
ah
);

426 
™iSèã
->
ofdmsTu∫
 = !aniState->ofdmsTurn;

427 
	`©h9k_™i_ª°¨t
(
ah
);

428 } i‡(
ofdmPhyEºR©e
 > 
ah
->
c⁄fig
.
ofdm_åig_high
) {

429 
	`©h9k_hw_™i_ofdm_îr_åiggî
(
ah
);

430 
™iSèã
->
ofdmsTu∫
 = 
Ál£
;

431 
	`©h9k_™i_ª°¨t
(
ah
);

432 } i‡(
cckPhyEºR©e
 > 
ah
->
c⁄fig
.
cck_åig_high
) {

433 
	`©h9k_hw_™i_cck_îr_åiggî
(
ah
);

434 
™iSèã
->
ofdmsTu∫
 = 
åue
;

435 
	`©h9k_™i_ª°¨t
(
ah
);

438 
	}
}

439 
EXPORT_SYMBOL
(
©h9k_hw_™i_m⁄ô‹
);

441 
	$©h9k_íabÀ_mib_cou¡îs
(
©h_hw
 *
ah
)

443 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

445 
	`©h_dbg
(
comm⁄
, 
ANI
, "Enable MIB counters\n");

447 
	`©h9k_hw_upd©e_mib°©s
(
ah
, &ah->
ah_mibSèts
);

449 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

451 
	`REG_WRITE
(
ah
, 
AR_FILT_OFDM
, 0);

452 
	`REG_WRITE
(
ah
, 
AR_FILT_CCK
, 0);

453 
	`REG_WRITE
(
ah
, 
AR_MIBC
,

454 ~(
AR_MIBC_COW
 | 
AR_MIBC_FMC
 | 
AR_MIBC_CMC
 | 
AR_MIBC_MCS
)

456 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_MASK_1
, 
AR_PHY_ERR_OFDM_TIMING
);

457 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR_MASK_2
, 
AR_PHY_ERR_CCK_TIMING
);

459 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

460 
	}
}

463 
	$©h9k_hw_dißbÀ_mib_cou¡îs
(
©h_hw
 *
ah
)

465 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

467 
	`©h_dbg
(
comm⁄
, 
ANI
, "Disable MIB counters\n");

469 
	`REG_WRITE
(
ah
, 
AR_MIBC
, 
AR_MIBC_FMC
);

470 
	`©h9k_hw_upd©e_mib°©s
(
ah
, &ah->
ah_mibSèts
);

471 
	`REG_WRITE
(
ah
, 
AR_MIBC
, 
AR_MIBC_CMC
);

472 
	`REG_WRITE
(
ah
, 
AR_FILT_OFDM
, 0);

473 
	`REG_WRITE
(
ah
, 
AR_FILT_CCK
, 0);

474 
	}
}

475 
EXPORT_SYMBOL
(
©h9k_hw_dißbÀ_mib_cou¡îs
);

477 
	$©h9k_hw_™i_öô
(
©h_hw
 *
ah
)

479 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

480 
¨5416AniSèã
 *
™i
 = &
ah
->ani;

482 
	`©h_dbg
(
comm⁄
, 
ANI
, "Initialize ANI\n");

484 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

485 
ah
->
c⁄fig
.
ofdm_åig_high
 = 
ATH9K_ANI_OFDM_TRIG_HIGH
;

486 
ah
->
c⁄fig
.
ofdm_åig_low
 = 
ATH9K_ANI_OFDM_TRIG_LOW
;

487 
ah
->
c⁄fig
.
cck_åig_high
 = 
ATH9K_ANI_CCK_TRIG_HIGH
;

488 
ah
->
c⁄fig
.
cck_åig_low
 = 
ATH9K_ANI_CCK_TRIG_LOW
;

490 
ah
->
c⁄fig
.
ofdm_åig_high
 = 
ATH9K_ANI_OFDM_TRIG_HIGH_OLD
;

491 
ah
->
c⁄fig
.
ofdm_åig_low
 = 
ATH9K_ANI_OFDM_TRIG_LOW_OLD
;

492 
ah
->
c⁄fig
.
cck_åig_high
 = 
ATH9K_ANI_CCK_TRIG_HIGH_OLD
;

493 
ah
->
c⁄fig
.
cck_åig_low
 = 
ATH9K_ANI_CCK_TRIG_LOW_OLD
;

496 
™i
->
•urImmunôyLevñ
 = 
ATH9K_ANI_SPUR_IMMUNE_LVL
;

497 
™i
->
fú°ïLevñ
 = 
ATH9K_ANI_FIRSTEP_LVL
;

498 
™i
->
mrcCCK
 = 
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 
åue
 : 
Ál£
;

499 
™i
->
ofdmsTu∫
 = 
åue
;

500 
™i
->
ofdmWókSigDëe˘
 = 
åue
;

501 
™i
->
cckNoi£ImmunôyLevñ
 = 
ATH9K_ANI_CCK_DEF_LEVEL
;

502 
™i
->
ofdmNoi£ImmunôyLevñ
 = 
ATH9K_ANI_OFDM_DEF_LEVEL
;

508 
ah
->
™ùîiod
 = 
ATH9K_ANI_PERIOD
;

509 
ah
->
c⁄fig
.
™i_pﬁl_öãrvÆ
 = 
ATH9K_ANI_POLLINTERVAL
;

511 
	`©h9k_™i_ª°¨t
(
ah
);

512 
	`©h9k_íabÀ_mib_cou¡îs
(
ah
);

513 
	}
}

	@ani.h

17 #i‚de‡
ANI_H


18 
	#ANI_H


	)

20 
	#BEACON_RSSI
(
ahp
Ë◊hp->
°©s
.
avgbrssi
)

	)

23 
	#ATH9K_ANI_OFDM_TRIG_HIGH
 3500

	)

24 
	#ATH9K_ANI_OFDM_TRIG_HIGH_BELOW_INI
 1000

	)

25 
	#ATH9K_ANI_OFDM_TRIG_HIGH_OLD
 500

	)

27 
	#ATH9K_ANI_OFDM_TRIG_LOW
 400

	)

28 
	#ATH9K_ANI_OFDM_TRIG_LOW_ABOVE_INI
 900

	)

29 
	#ATH9K_ANI_OFDM_TRIG_LOW_OLD
 200

	)

31 
	#ATH9K_ANI_CCK_TRIG_HIGH
 600

	)

32 
	#ATH9K_ANI_CCK_TRIG_HIGH_OLD
 200

	)

33 
	#ATH9K_ANI_CCK_TRIG_LOW
 300

	)

34 
	#ATH9K_ANI_CCK_TRIG_LOW_OLD
 100

	)

36 
	#ATH9K_ANI_SPUR_IMMUNE_LVL
 3

	)

37 
	#ATH9K_ANI_FIRSTEP_LVL
 2

	)

39 
	#ATH9K_ANI_RSSI_THR_HIGH
 40

	)

40 
	#ATH9K_ANI_RSSI_THR_LOW
 7

	)

42 
	#ATH9K_ANI_PERIOD
 300

	)

45 
	#ATH9K_ANI_POLLINTERVAL
 300

	)

47 
	#ATH9K_SIG_FIRSTEP_SETTING_MIN
 0

	)

48 
	#ATH9K_SIG_FIRSTEP_SETTING_MAX
 20

	)

49 
	#ATH9K_SIG_SPUR_IMM_SETTING_MIN
 0

	)

50 
	#ATH9K_SIG_SPUR_IMM_SETTING_MAX
 22

	)

54 
	e©h9k_™i_cmd
 {

55 
	mATH9K_ANI_OFDM_WEAK_SIGNAL_DETECTION
 = 0x1,

56 
	mATH9K_ANI_FIRSTEP_LEVEL
 = 0x2,

57 
	mATH9K_ANI_SPUR_IMMUNITY_LEVEL
 = 0x4,

58 
	mATH9K_ANI_MRC_CCK
 = 0x8,

59 
	mATH9K_ANI_ALL
 = 0xfff

62 
	s©h9k_mib_°©s
 {

63 
u32
 
	mackrcv_bad
;

64 
u32
 
	mπs_bad
;

65 
u32
 
	mπs_good
;

66 
u32
 
	mfcs_bad
;

67 
u32
 
	mbóc⁄s
;

71 
	s©h9k_™i_deÁu…
 {

72 
u16
 
	mm1ThªshLow
;

73 
u16
 
	mm2ThªshLow
;

74 
u16
 
	mm1Thªsh
;

75 
u16
 
	mm2Thªsh
;

76 
u16
 
	mm2Cou¡Thr
;

77 
u16
 
	mm2Cou¡ThrLow
;

78 
u16
 
	mm1ThªshLowExt
;

79 
u16
 
	mm2ThªshLowExt
;

80 
u16
 
	mm1ThªshExt
;

81 
u16
 
	mm2ThªshExt
;

82 
u16
 
	mfú°ï
;

83 
u16
 
	mfú°ïLow
;

84 
u16
 
	mcy˝wrThr1
;

85 
u16
 
	mcy˝wrThr1Ext
;

88 
	s¨5416AniSèã
 {

89 
u8
 
	mnoi£ImmunôyLevñ
;

90 
u8
 
	mofdmNoi£ImmunôyLevñ
;

91 
u8
 
	mcckNoi£ImmunôyLevñ
;

92 
boﬁ
 
	mofdmsTu∫
;

93 
u8
 
	mmrcCCK
;

94 
u8
 
	m•urImmunôyLevñ
;

95 
u8
 
	mfú°ïLevñ
;

96 
boﬁ
 
	mofdmWókSigDëe˘
;

97 
u32
 
	mli°íTime
;

98 
u32
 
	mofdmPhyEºCou¡
;

99 
u32
 
	mcckPhyEºCou¡
;

100 
©h9k_™i_deÁu…
 
	möiDef
;

103 
	s¨5416Sèts
 {

104 
u32
 
	ma°_™i_•urup
;

105 
u32
 
	ma°_™i_•urdown
;

106 
u32
 
	ma°_™i_ofdm⁄
;

107 
u32
 
	ma°_™i_ofdmoff
;

108 
u32
 
	ma°_™i_cckhigh
;

109 
u32
 
	ma°_™i_ccklow
;

110 
u32
 
	ma°_™i_°ïup
;

111 
u32
 
	ma°_™i_°ïdown
;

112 
u32
 
	ma°_™i_ofdmîrs
;

113 
u32
 
	ma°_™i_cckîrs
;

114 
u32
 
	ma°_™i_ª£t
;

115 
u32
 
	ma°_™i_ eg_‹_lzîo
;

116 
u32
 
	mavgbrssi
;

117 
©h9k_mib_°©s
 
	ma°_mib°©s
;

119 
	#ah_mibSèts
 
°©s
.
a°_mib°©s


	)

121 
©h9k_íabÀ_mib_cou¡îs
(
©h_hw
 *
ah
);

122 
©h9k_hw_dißbÀ_mib_cou¡îs
(
©h_hw
 *
ah
);

123 
©h9k_hw_™i_öô
(
©h_hw
 *
ah
);

	@antenna.c

17 
	~"©h9k.h
"

71 
ölöe
 
boﬁ
 
	$©h_is_Æt_™t_øtio_bëãr
(
©h_™t_comb
 *
™tcomb
,

72 
Æt_øtio
, 
maxdñè
,

73 
mödñè
, 
maö_rssi_avg
,

74 
Æt_rssi_avg
, 
pkt_cou¡
)

76 i‡(
pkt_cou¡
 <= 50)

77  
Ál£
;

79 i‡(
Æt_rssi_avg
 > 
maö_rssi_avg
 + 
mödñè
)

80  
åue
;

82 i‡(
Æt_øtio
 >
™tcomb
->
™t_øtio2
 &&

83 
Æt_rssi_avg
 >
™tcomb
->
low_rssi_thªsh
 &&

84 (
Æt_rssi_avg
 > 
maö_rssi_avg
 + 
maxdñè
))

85  
åue
;

87  
Ál£
;

88 
	}
}

90 
ölöe
 
boﬁ
 
	$©h_™t_div_comb_Æt_check
(
©h_hw_™tcomb_c⁄f
 *
c⁄f
,

91 
©h_™t_comb
 *
™tcomb
,

92 
Æt_øtio
, 
Æt_rssi_avg
,

93 
maö_rssi_avg
)

95 
boﬁ
 
ªsu…
, 
£t1
, 
£t2
;

97 
ªsu…
 = 
£t1
 = 
£t2
 = 
Ál£
;

99 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
 &&

100 
c⁄f
->
Æt_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
)

101 
£t1
 = 
åue
;

103 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
 &&

104 
c⁄f
->
Æt_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

105 
£t2
 = 
åue
;

107 
c⁄f
->
div_group
) {

109 i‡(
Æt_øtio
 > 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
)

110 
ªsu…
 = 
åue
;

114 i‡(
Æt_rssi_avg
 < 4 ||á…_rssi_avg < 
™tcomb
->
low_rssi_thªsh
)

117 i‡((
£t1
 && (
Æt_rssi_avg
 >(
maö_rssi_avg
 - 5))) ||

118 (
£t2
 && (
Æt_rssi_avg
 >(
maö_rssi_avg
 - 2))) ||

119 (
Æt_øtio
 > 
™tcomb
->
™t_øtio
))

120 
ªsu…
 = 
åue
;

124 i‡(
Æt_rssi_avg
 < 4 ||á…_rssi_avg < 
™tcomb
->
low_rssi_thªsh
)

127 i‡((
£t1
 && (
Æt_rssi_avg
 >(
maö_rssi_avg
 - 3))) ||

128 (
£t2
 && (
Æt_rssi_avg
 >(
maö_rssi_avg
 + 3))) ||

129 (
Æt_øtio
 > 
™tcomb
->
™t_øtio
))

130 
ªsu…
 = 
åue
;

135  
ªsu…
;

136 
	}
}

138 
	$©h_ ac⁄f_Æt_good_sˇn
(
©h_™t_comb
 *
™tcomb
,

139 
©h_hw_™tcomb_c⁄f
 
™t_c⁄f
,

140 
maö_rssi_avg
)

142 
™tcomb
->
quick_sˇn_˙t
 = 0;

144 i‡(
™t_c⁄f
.
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

145 
™tcomb
->
rssi_ a2
 = 
maö_rssi_avg
;

146 i‡(
™t_c⁄f
.
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
)

147 
™tcomb
->
rssi_ a1
 = 
maö_rssi_avg
;

149 (
™t_c⁄f
.
maö_ a_c⁄f
 << 4Ë|á¡_c⁄f.
Æt_ a_c⁄f
) {

151 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

152 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

153 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

154 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

157 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

158 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

159 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

160 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

163 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

164 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

165 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

166 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =

167 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

170 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

171 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

172 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

173 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =

174 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

177 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

178 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

179 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

180 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

183 
™tcomb
->
maö_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

184 
™tcomb
->
fú°_quick_sˇn_c⁄f
 =

185 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

186 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

191 
	}
}

193 
	$©h_™t_£t_Æt_øtio
(
©h_™t_comb
 *
™tcomb
,

194 
©h_hw_™tcomb_c⁄f
 *
c⁄f
)

197 i‡(
™tcomb
->
fú°_øtio
 &&á¡comb->
£c⁄d_øtio
) {

198 i‡(
™tcomb
->
rssi_£c⁄d
 >á¡comb->
rssi_thúd
) {

200 i‡((
™tcomb
->
fú°_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) ||

201 (
™tcomb
->
fú°_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
))

203 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

204 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

206 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

209 
c⁄f
->
Æt_ a_c⁄f
 =

210 
™tcomb
->
fú°_quick_sˇn_c⁄f
;

211 } i‡((
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) ||

212 (
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)) {

214 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

215 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

217 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

220 
c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
;

222 } i‡(
™tcomb
->
fú°_øtio
) {

224 i‡((
™tcomb
->
fú°_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) ||

225 (
™tcomb
->
fú°_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
))

227 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

228 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

230 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

233 
c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
fú°_quick_sˇn_c⁄f
;

234 } i‡(
™tcomb
->
£c⁄d_øtio
) {

236 i‡((
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) ||

237 (
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
))

239 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

240 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

242 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

245 
c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
;

248 i‡((
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) ||

249 (
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
))

251 i‡(
c⁄f
->
maö_ a_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

252 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

254 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

257 
c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
maö_c⁄f
;

259 
	}
}

261 
	$©h_£À˘_™t_div_‰om_quick_sˇn
(
©h_™t_comb
 *
™tcomb
,

262 
©h_hw_™tcomb_c⁄f
 *
div_™t_c⁄f
,

263 
maö_rssi_avg
, 
Æt_rssi_avg
,

264 
Æt_øtio
)

267 
™tcomb
->
quick_sˇn_˙t
) {

270 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
™tcomb
->
maö_c⁄f
;

271 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
fú°_quick_sˇn_c⁄f
;

275 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
™tcomb
->
maö_c⁄f
;

276 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
;

277 
™tcomb
->
rssi_fú°
 = 
maö_rssi_avg
;

278 
™tcomb
->
rssi_£c⁄d
 = 
Æt_rssi_avg
;

280 i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) {

282 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

283 
ATH_ANT_DIV_COMB_LNA1_DELTA_HI
,

284 
ATH_ANT_DIV_COMB_LNA1_DELTA_LOW
,

285 
maö_rssi_avg
, 
Æt_rssi_avg
,

286 
™tcomb
->
tŸÆ_pkt_cou¡
))

287 
™tcomb
->
fú°_øtio
 = 
åue
;

289 
™tcomb
->
fú°_øtio
 = 
Ál£
;

290 } i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
) {

291 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

292 
ATH_ANT_DIV_COMB_LNA1_DELTA_MID
,

293 
ATH_ANT_DIV_COMB_LNA1_DELTA_LOW
,

294 
maö_rssi_avg
, 
Æt_rssi_avg
,

295 
™tcomb
->
tŸÆ_pkt_cou¡
))

296 
™tcomb
->
fú°_øtio
 = 
åue
;

298 
™tcomb
->
fú°_øtio
 = 
Ál£
;

300 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

301 
ATH_ANT_DIV_COMB_LNA1_DELTA_HI
,

303 
maö_rssi_avg
, 
Æt_rssi_avg
,

304 
™tcomb
->
tŸÆ_pkt_cou¡
))

305 
™tcomb
->
fú°_øtio
 = 
åue
;

307 
™tcomb
->
fú°_øtio
 = 
Ál£
;

311 
™tcomb
->
Æt_good
 = 
Ál£
;

312 
™tcomb
->
sˇn_nŸ_°¨t
 = 
Ál£
;

313 
™tcomb
->
sˇn
 = 
Ál£
;

314 
™tcomb
->
rssi_fú°
 = 
maö_rssi_avg
;

315 
™tcomb
->
rssi_thúd
 = 
Æt_rssi_avg
;

317 
™tcomb
->
£c⁄d_quick_sˇn_c⁄f
) {

318 
ATH_ANT_DIV_COMB_LNA1
:

319 
™tcomb
->
rssi_ a1
 = 
Æt_rssi_avg
;

321 
ATH_ANT_DIV_COMB_LNA2
:

322 
™tcomb
->
rssi_ a2
 = 
Æt_rssi_avg
;

324 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
:

325 i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
)

326 
™tcomb
->
rssi_ a2
 = 
maö_rssi_avg
;

327 i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
)

328 
™tcomb
->
rssi_ a1
 = 
maö_rssi_avg
;

334 i‡(
™tcomb
->
rssi_ a2
 >á¡comb->
rssi_ a1
 +

335 
div_™t_c⁄f
->
 a1_ a2_swôch_dñè
)

336 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

338 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

340 i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA1
) {

341 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

342 
ATH_ANT_DIV_COMB_LNA1_DELTA_HI
,

343 
ATH_ANT_DIV_COMB_LNA1_DELTA_LOW
,

344 
maö_rssi_avg
, 
Æt_rssi_avg
,

345 
™tcomb
->
tŸÆ_pkt_cou¡
))

346 
™tcomb
->
£c⁄d_øtio
 = 
åue
;

348 
™tcomb
->
£c⁄d_øtio
 = 
Ál£
;

349 } i‡(
™tcomb
->
maö_c⁄f
 =
ATH_ANT_DIV_COMB_LNA2
) {

350 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

351 
ATH_ANT_DIV_COMB_LNA1_DELTA_MID
,

352 
ATH_ANT_DIV_COMB_LNA1_DELTA_LOW
,

353 
maö_rssi_avg
, 
Æt_rssi_avg
,

354 
™tcomb
->
tŸÆ_pkt_cou¡
))

355 
™tcomb
->
£c⁄d_øtio
 = 
åue
;

357 
™tcomb
->
£c⁄d_øtio
 = 
Ál£
;

359 i‡(
	`©h_is_Æt_™t_øtio_bëãr
(
™tcomb
, 
Æt_øtio
,

360 
ATH_ANT_DIV_COMB_LNA1_DELTA_HI
,

362 
maö_rssi_avg
, 
Æt_rssi_avg
,

363 
™tcomb
->
tŸÆ_pkt_cou¡
))

364 
™tcomb
->
£c⁄d_øtio
 = 
åue
;

366 
™tcomb
->
£c⁄d_øtio
 = 
Ál£
;

369 
	`©h_™t_£t_Æt_øtio
(
™tcomb
, 
div_™t_c⁄f
);

375 
	}
}

377 
	$©h_™t_div_c⁄f_Á°_divbüs
(
©h_hw_™tcomb_c⁄f
 *
™t_c⁄f
,

378 
©h_™t_comb
 *
™tcomb
,

379 
Æt_øtio
)

381 
™t_c⁄f
->
maö_gaötb
 = 0;

382 
™t_c⁄f
->
Æt_gaötb
 = 0;

384 i‡(
™t_c⁄f
->
div_group
 == 0) {

386 (
™t_c⁄f
->
maö_ a_c⁄f
 << 4) |

387 
™t_c⁄f
->
Æt_ a_c⁄f
) {

389 
™t_c⁄f
->
Á°_div_büs
 = 0x3b;

392 
™t_c⁄f
->
Á°_div_büs
 = 0x3d;

395 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

398 
™t_c⁄f
->
Á°_div_büs
 = 0x7;

401 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

404 
™t_c⁄f
->
Á°_div_büs
 = 0x7;

407 
™t_c⁄f
->
Á°_div_büs
 = 0x6;

410 
™t_c⁄f
->
Á°_div_büs
 = 0x0;

413 
™t_c⁄f
->
Á°_div_büs
 = 0x6;

416 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

419 
™t_c⁄f
->
Á°_div_büs
 = 0x3b;

422 
™t_c⁄f
->
Á°_div_büs
 = 0x3d;

427 } i‡(
™t_c⁄f
->
div_group
 == 1) {

429 (
™t_c⁄f
->
maö_ a_c⁄f
 << 4) |

430 
™t_c⁄f
->
Æt_ a_c⁄f
) {

432 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

435 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

438 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

441 i‡(!(
™tcomb
->
sˇn
) &&

442 (
Æt_øtio
 > 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
))

443 
™t_c⁄f
->
Á°_div_büs
 = 0x3f;

445 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

448 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

451 i‡(!(
™tcomb
->
sˇn
) &&

452 (
Æt_øtio
 > 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
))

453 
™t_c⁄f
->
Á°_div_büs
 = 0x3f;

455 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

458 i‡(!(
™tcomb
->
sˇn
) &&

459 (
Æt_øtio
 > 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
))

460 
™t_c⁄f
->
Á°_div_büs
 = 0x3f;

462 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

465 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

468 i‡(!(
™tcomb
->
sˇn
) &&

469 (
Æt_øtio
 > 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
))

470 
™t_c⁄f
->
Á°_div_büs
 = 0x3f;

472 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

475 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

478 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

481 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

486 } i‡(
™t_c⁄f
->
div_group
 == 2) {

488 (
™t_c⁄f
->
maö_ a_c⁄f
 << 4) |

489 
™t_c⁄f
->
Æt_ a_c⁄f
) {

491 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

494 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

497 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

500 i‡(!
™tcomb
->
sˇn
 && (
Æt_øtio
 >á¡comb->
™t_øtio
))

501 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

503 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

506 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

509 i‡(!
™tcomb
->
sˇn
 && (
Æt_øtio
 >á¡comb->
™t_øtio
))

510 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

512 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

515 i‡(!
™tcomb
->
sˇn
 && (
Æt_øtio
 >á¡comb->
™t_øtio
))

516 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

518 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

521 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

524 i‡(!
™tcomb
->
sˇn
 && (
Æt_øtio
 >á¡comb->
™t_øtio
))

525 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

527 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

530 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

533 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

536 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

542 i‡(
™tcomb
->
Á°_div_büs
)

543 
™t_c⁄f
->
Á°_div_büs
 = 
™tcomb
->fast_div_bias;

544 } i‡(
™t_c⁄f
->
div_group
 == 3) {

545 (
™t_c⁄f
->
maö_ a_c⁄f
 << 4) |

546 
™t_c⁄f
->
Æt_ a_c⁄f
) {

548 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

551 
™t_c⁄f
->
Á°_div_büs
 = 0x39;

554 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

557 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

560 
™t_c⁄f
->
Á°_div_büs
 = 0x3f;

563 
™t_c⁄f
->
Á°_div_büs
 = 0x2;

566 
™t_c⁄f
->
Á°_div_büs
 = 0x3;

569 
™t_c⁄f
->
Á°_div_büs
 = 0x3;

572 
™t_c⁄f
->
Á°_div_büs
 = 0x3;

575 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

578 
™t_c⁄f
->
Á°_div_büs
 = 0x6;

581 
™t_c⁄f
->
Á°_div_büs
 = 0x1;

587 
	}
}

589 
	$©h_™t_åy_sˇn
(
©h_™t_comb
 *
™tcomb
,

590 
©h_hw_™tcomb_c⁄f
 *
c⁄f
,

591 
cuº_Æt_£t
, 
Æt_rssi_avg
,

592 
maö_rssi_avg
)

594 
cuº_Æt_£t
) {

595 
ATH_ANT_DIV_COMB_LNA2
:

596 
™tcomb
->
rssi_ a2
 = 
Æt_rssi_avg
;

597 
™tcomb
->
rssi_ a1
 = 
maö_rssi_avg
;

598 
™tcomb
->
sˇn
 = 
åue
;

600 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

601 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

603 
ATH_ANT_DIV_COMB_LNA1
:

604 
™tcomb
->
rssi_ a1
 = 
Æt_rssi_avg
;

605 
™tcomb
->
rssi_ a2
 = 
maö_rssi_avg
;

606 
™tcomb
->
sˇn
 = 
åue
;

608 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

609 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

611 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
:

612 
™tcomb
->
rssi_add
 = 
Æt_rssi_avg
;

613 
™tcomb
->
sˇn
 = 
åue
;

615 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

617 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
:

618 
™tcomb
->
rssi_sub
 = 
Æt_rssi_avg
;

619 
™tcomb
->
sˇn
 = 
Ál£
;

620 i‡(
™tcomb
->
rssi_ a2
 >

621 (
™tcomb
->
rssi_ a1
 + 
c⁄f
->
 a1_ a2_swôch_dñè
)) {

623 i‡((
™tcomb
->
rssi_add
 >á¡comb->
rssi_ a1
) &&

624 (
™tcomb
->
rssi_add
 >á¡comb->
rssi_sub
)) {

626 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

627 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

628 } i‡(
™tcomb
->
rssi_sub
 >

629 
™tcomb
->
rssi_ a1
) {

631 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

632 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

635 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

636 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

640 i‡((
™tcomb
->
rssi_add
 >á¡comb->
rssi_ a2
) &&

641 (
™tcomb
->
rssi_add
 >á¡comb->
rssi_sub
)) {

643 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

644 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
;

645 } i‡(
™tcomb
->
rssi_sub
 >

646 
™tcomb
->
rssi_ a1
) {

648 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

649 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
;

652 
c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

653 
c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

660 
	}
}

662 
boﬁ
 
	$©h_™t_åy_swôch
(
©h_hw_™tcomb_c⁄f
 *
div_™t_c⁄f
,

663 
©h_™t_comb
 *
™tcomb
,

664 
Æt_øtio
, 
Æt_rssi_avg
,

665 
maö_rssi_avg
, 
cuº_maö_£t
,

666 
cuº_Æt_£t
)

668 
boﬁ
 
ªt
 = 
Ál£
;

670 i‡(
	`©h_™t_div_comb_Æt_check
(
div_™t_c⁄f
, 
™tcomb
, 
Æt_øtio
,

671 
Æt_rssi_avg
, 
maö_rssi_avg
)) {

672 i‡(
cuº_Æt_£t
 =
ATH_ANT_DIV_COMB_LNA2
) {

676 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

677 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

678 } i‡(
cuº_Æt_£t
 =
ATH_ANT_DIV_COMB_LNA1
) {

679 
div_™t_c⁄f
->
maö_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

680 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

683 
ªt
 = 
åue
;

684 } i‡((
cuº_Æt_£t
 !
ATH_ANT_DIV_COMB_LNA1
) &&

685 (
cuº_Æt_£t
 !
ATH_ANT_DIV_COMB_LNA2
)) {

689 i‡(
cuº_maö_£t
 =
ATH_ANT_DIV_COMB_LNA2
)

690 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA1
;

691 i‡(
cuº_maö_£t
 =
ATH_ANT_DIV_COMB_LNA1
)

692 
div_™t_c⁄f
->
Æt_ a_c⁄f
 = 
ATH_ANT_DIV_COMB_LNA2
;

694 
ªt
 = 
åue
;

697  
ªt
;

698 
	}
}

700 
boﬁ
 
	$©h_™t_sh‹t_sˇn_check
(
©h_™t_comb
 *
™tcomb
)

702 
Æt_øtio
;

704 i‡(!
™tcomb
->
sˇn
 || !™tcomb->
Æt_good
)

705  
Ál£
;

707 i‡(
	`time_a·î
(
jiffõs
, 
™tcomb
->
sˇn_°¨t_time
 +

708 
	`m£cs_to_jiffõs
(
ATH_ANT_DIV_COMB_SHORT_SCAN_INTR
)))

709  
åue
;

711 i‡(
™tcomb
->
tŸÆ_pkt_cou¡
 =
ATH_ANT_DIV_COMB_SHORT_SCAN_PKTCOUNT
) {

712 
Æt_øtio
 = ((
™tcomb
->
Æt_ªcv_˙t
 * 100) /

713 
™tcomb
->
tŸÆ_pkt_cou¡
);

714 i‡(
Æt_øtio
 < 
™tcomb
->
™t_øtio
)

715  
åue
;

718  
Ál£
;

719 
	}
}

721 
	$©h_™t_comb_sˇn
(
©h_so·c
 *
sc
, 
©h_rx_°©us
 *
rs
)

723 
©h_hw_™tcomb_c⁄f
 
div_™t_c⁄f
;

724 
©h_™t_comb
 *
™tcomb
 = &
sc
->
™t_comb
;

725 
Æt_øtio
 = 0, 
Æt_rssi_avg
 = 0, 
maö_rssi_avg
 = 0, 
cuº_Æt_£t
;

726 
cuº_maö_£t
;

727 
maö_rssi
 = 
rs
->
rs_rssi_˘l
[0];

728 
Æt_rssi
 = 
rs
->
rs_rssi_˘l
[1];

729 
rx_™t_c⁄f
, 
maö_™t_c⁄f
;

730 
boﬁ
 
sh‹t_sˇn
 = 
Ál£
, 
ªt
;

732 
rx_™t_c⁄f
 = (
rs
->
rs_rssi_˘l
[2] >> 
ATH_ANT_RX_CURRENT_SHIFT
) &

733 
ATH_ANT_RX_MASK
;

734 
maö_™t_c⁄f
 = (
rs
->
rs_rssi_˘l
[2] >> 
ATH_ANT_RX_MAIN_SHIFT
) &

735 
ATH_ANT_RX_MASK
;

737 i‡(
Æt_rssi
 >
™tcomb
->
low_rssi_thªsh
) {

738 
™tcomb
->
™t_øtio
 = 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO
;

739 
™tcomb
->
™t_øtio2
 = 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO2
;

741 
™tcomb
->
™t_øtio
 = 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO_LOW_RSSI
;

742 
™tcomb
->
™t_øtio2
 = 
ATH_ANT_DIV_COMB_ALT_ANT_RATIO2_LOW_RSSI
;

746 i‡(
maö_rssi
 > 0 && 
Æt_rssi
 > 0) {

747 
™tcomb
->
tŸÆ_pkt_cou¡
++;

748 
™tcomb
->
maö_tŸÆ_rssi
 +
maö_rssi
;

749 
™tcomb
->
Æt_tŸÆ_rssi
 +
Æt_rssi
;

751 i‡(
maö_™t_c⁄f
 =
rx_™t_c⁄f
)

752 
™tcomb
->
maö_ªcv_˙t
++;

754 
™tcomb
->
Æt_ªcv_˙t
++;

757 i‡(
maö_™t_c⁄f
 =
rx_™t_c⁄f
) {

758 
	`ANT_STAT_INC
(
ANT_MAIN
, 
ªcv_˙t
);

759 
	`ANT_LNA_INC
(
ANT_MAIN
, 
rx_™t_c⁄f
);

761 
	`ANT_STAT_INC
(
ANT_ALT
, 
ªcv_˙t
);

762 
	`ANT_LNA_INC
(
ANT_ALT
, 
rx_™t_c⁄f
);

766 
sh‹t_sˇn
 = 
	`©h_™t_sh‹t_sˇn_check
(
™tcomb
);

768 i‡(((
™tcomb
->
tŸÆ_pkt_cou¡
 < 
ATH_ANT_DIV_COMB_MAX_PKTCOUNT
) ||

769 
rs
->
rs_m‹óggr
Ë&& !
sh‹t_sˇn
)

772 i‡(
™tcomb
->
tŸÆ_pkt_cou¡
) {

773 
Æt_øtio
 = ((
™tcomb
->
Æt_ªcv_˙t
 * 100) /

774 
™tcomb
->
tŸÆ_pkt_cou¡
);

775 
maö_rssi_avg
 = (
™tcomb
->
maö_tŸÆ_rssi
 /

776 
™tcomb
->
tŸÆ_pkt_cou¡
);

777 
Æt_rssi_avg
 = (
™tcomb
->
Æt_tŸÆ_rssi
 /

778 
™tcomb
->
tŸÆ_pkt_cou¡
);

781 
	`©h9k_hw_™tdiv_comb_c⁄f_gë
(
sc
->
sc_ah
, &
div_™t_c⁄f
);

782 
cuº_Æt_£t
 = 
div_™t_c⁄f
.
Æt_ a_c⁄f
;

783 
cuº_maö_£t
 = 
div_™t_c⁄f
.
maö_ a_c⁄f
;

784 
™tcomb
->
cou¡
++;

786 i‡(
™tcomb
->
cou¡
 =
ATH_ANT_DIV_COMB_MAX_COUNT
) {

787 i‡(
Æt_øtio
 > 
™tcomb
->
™t_øtio
) {

788 
	`©h_ ac⁄f_Æt_good_sˇn
(
™tcomb
, 
div_™t_c⁄f
,

789 
maö_rssi_avg
);

790 
™tcomb
->
Æt_good
 = 
åue
;

792 
™tcomb
->
Æt_good
 = 
Ál£
;

795 
™tcomb
->
cou¡
 = 0;

796 
™tcomb
->
sˇn
 = 
åue
;

797 
™tcomb
->
sˇn_nŸ_°¨t
 = 
åue
;

800 i‡(!
™tcomb
->
sˇn
) {

801 
ªt
 = 
	`©h_™t_åy_swôch
(&
div_™t_c⁄f
, 
™tcomb
, 
Æt_øtio
,

802 
Æt_rssi_avg
, 
maö_rssi_avg
,

803 
cuº_maö_£t
, 
cuº_Æt_£t
);

804 i‡(
ªt
)

805 
div_comb_d⁄e
;

808 i‡(!
™tcomb
->
sˇn
 &&

809 (
Æt_rssi_avg
 < (
maö_rssi_avg
 + 
div_™t_c⁄f
.
 a1_ a2_dñè
)))

810 
div_comb_d⁄e
;

812 i‡(!
™tcomb
->
sˇn_nŸ_°¨t
) {

813 
	`©h_™t_åy_sˇn
(
™tcomb
, &
div_™t_c⁄f
, 
cuº_Æt_£t
,

814 
Æt_rssi_avg
, 
maö_rssi_avg
);

816 i‡(!
™tcomb
->
Æt_good
) {

817 
™tcomb
->
sˇn_nŸ_°¨t
 = 
Ál£
;

819 i‡(
cuº_maö_£t
 =
ATH_ANT_DIV_COMB_LNA2
) {

820 
div_™t_c⁄f
.
maö_ a_c⁄f
 =

821 
ATH_ANT_DIV_COMB_LNA2
;

822 
div_™t_c⁄f
.
Æt_ a_c⁄f
 =

823 
ATH_ANT_DIV_COMB_LNA1
;

824 } i‡(
cuº_maö_£t
 =
ATH_ANT_DIV_COMB_LNA1
) {

825 
div_™t_c⁄f
.
maö_ a_c⁄f
 =

826 
ATH_ANT_DIV_COMB_LNA1
;

827 
div_™t_c⁄f
.
Æt_ a_c⁄f
 =

828 
ATH_ANT_DIV_COMB_LNA2
;

830 
div_comb_d⁄e
;

832 
	`©h_£À˘_™t_div_‰om_quick_sˇn
(
™tcomb
, &
div_™t_c⁄f
,

833 
maö_rssi_avg
, 
Æt_rssi_avg
,

834 
Æt_øtio
);

835 
™tcomb
->
quick_sˇn_˙t
++;

838 
div_comb_d⁄e
:

839 
	`©h_™t_div_c⁄f_Á°_divbüs
(&
div_™t_c⁄f
, 
™tcomb
, 
Æt_øtio
);

840 
	`©h9k_hw_™tdiv_comb_c⁄f_£t
(
sc
->
sc_ah
, &
div_™t_c⁄f
);

841 
	`©h9k_debug_°©_™t
(
sc
, &
div_™t_c⁄f
, 
maö_rssi_avg
, 
Æt_rssi_avg
);

843 
™tcomb
->
sˇn_°¨t_time
 = 
jiffõs
;

844 
™tcomb
->
tŸÆ_pkt_cou¡
 = 0;

845 
™tcomb
->
maö_tŸÆ_rssi
 = 0;

846 
™tcomb
->
Æt_tŸÆ_rssi
 = 0;

847 
™tcomb
->
maö_ªcv_˙t
 = 0;

848 
™tcomb
->
Æt_ªcv_˙t
 = 0;

849 
	}
}

	@ar5008_initvals.h

17 c⁄° 
u32
 
	g¨5416Modes
[][5] = {

84 c⁄° 
u32
 
	g¨5416Comm⁄
[][2] = {

462 c⁄° 
u32
 
	g¨5416B™k0
[][2] = {

468 c⁄° 
u32
 
	g¨5416BB_RfGaö
[][3] = {

536 c⁄° 
u32
 
	g¨5416B™k1
[][2] = {

542 c⁄° 
u32
 
	g¨5416B™k2
[][2] = {

548 c⁄° 
u32
 
	g¨5416B™k3
[][3] = {

553 c⁄° 
u32
 
	g¨5416B™k6
[][3] = {

590 c⁄° 
u32
 
	g¨5416B™k6TPC
[][3] = {

627 c⁄° 
u32
 
	g¨5416B™k7
[][2] = {

634 c⁄° 
u32
 
	g¨5416Addac
[][2] = {

	@ar5008_phy.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~"../ªgd.h
"

20 
	~"¨9002_phy.h
"

21 
	~"¨5008_öôvÆs.h
"

25 
	#AR5008_OFDM_RATES
 8

	)

26 
	#AR5008_HT_SS_RATES
 8

	)

27 
	#AR5008_HT_DS_RATES
 8

	)

29 
	#AR5008_HT20_SHIFT
 16

	)

30 
	#AR5008_HT40_SHIFT
 24

	)

32 
	#AR5008_11NA_OFDM_SHIFT
 0

	)

33 
	#AR5008_11NA_HT_SS_SHIFT
 8

	)

34 
	#AR5008_11NA_HT_DS_SHIFT
 16

	)

36 
	#AR5008_11NG_OFDM_SHIFT
 4

	)

37 
	#AR5008_11NG_HT_SS_SHIFT
 12

	)

38 
	#AR5008_11NG_HT_DS_SHIFT
 20

	)

40 c⁄° 
	gfú°ï_èbÀ
[] =

47 c⁄° 
	gm1ThªshLow_off
 = 127;

48 c⁄° 
	gm2ThªshLow_off
 = 127;

49 c⁄° 
	gm1Thªsh_off
 = 127;

50 c⁄° 
	gm2Thªsh_off
 = 127;

51 c⁄° 
	gm2Cou¡Thr_off
 = 31;

52 c⁄° 
	gm2Cou¡ThrLow_off
 = 63;

53 c⁄° 
	gm1ThªshLowExt_off
 = 127;

54 c⁄° 
	gm2ThªshLowExt_off
 = 127;

55 c⁄° 
	gm1ThªshExt_off
 = 127;

56 c⁄° 
	gm2ThªshExt_off
 = 127;

58 c⁄° 
¨5416IniAºay
 
	gb™k0
 = 
STATIC_INI_ARRAY
(
¨5416B™k0
);

59 c⁄° 
¨5416IniAºay
 
	gb™k1
 = 
STATIC_INI_ARRAY
(
¨5416B™k1
);

60 c⁄° 
¨5416IniAºay
 
	gb™k2
 = 
STATIC_INI_ARRAY
(
¨5416B™k2
);

61 c⁄° 
¨5416IniAºay
 
	gb™k3
 = 
STATIC_INI_ARRAY
(
¨5416B™k3
);

62 c⁄° 
¨5416IniAºay
 
	gb™k7
 = 
STATIC_INI_ARRAY
(
¨5416B™k7
);

64 
	$¨5008_wrôe_b™k6
(
©h_hw
 *
ah
, *
wrôe˙t
)

66 
¨5416IniAºay
 *
¨øy
 = &
ah
->
öiB™k6
;

67 
u32
 *
d©a
 = 
ah
->
™ÆogB™k6D©a
;

68 
r
;

70 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

72 
r
 = 0;Ñ < 
¨øy
->
ü_rows
;Ñ++) {

73 
	`REG_WRITE
(
ah
, 
	`INI_RA
(
¨øy
, 
r
, 0), 
d©a
[r]);

74 
	`DO_DELAY
(*
wrôe˙t
);

77 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

78 
	}
}

91 
	$¨5008_hw_phy_modify_rx_buf„r
(
u32
 *
rfBuf
, u32 
ªg32
,

92 
u32
 
numBôs
, u32 
fú°Bô
,

93 
u32
 
cﬁumn
)

95 
u32
 
tmp32
, 
mask
, 
¨øyE¡ry
, 
œ°Bô
;

96 
öt32_t
 
bôPosôi⁄
, 
bôsLe·
;

98 
tmp32
 = 
	`©h9k_hw_ªvî£_bôs
(
ªg32
, 
numBôs
);

99 
¨øyE¡ry
 = (
fú°Bô
 - 1) / 8;

100 
bôPosôi⁄
 = (
fú°Bô
 - 1) % 8;

101 
bôsLe·
 = 
numBôs
;

102 
bôsLe·
 > 0) {

103 
œ°Bô
 = (
bôPosôi⁄
 + 
bôsLe·
 > 8) ?

104 8 : 
bôPosôi⁄
 + 
bôsLe·
;

105 
mask
 = (((1 << 
œ°Bô
Ë- 1Ë^ ((1 << 
bôPosôi⁄
) - 1)) <<

106 (
cﬁumn
 * 8);

107 
rfBuf
[
¨øyE¡ry
] &~
mask
;

108 
rfBuf
[
¨øyE¡ry
] |((
tmp32
 << 
bôPosôi⁄
) <<

109 (
cﬁumn
 * 8)Ë& 
mask
;

110 
bôsLe·
 -8 - 
bôPosôi⁄
;

111 
tmp32
 =Åmp32 >> (8 - 
bôPosôi⁄
);

112 
bôPosôi⁄
 = 0;

113 
¨øyE¡ry
++;

115 
	}
}

144 
	$¨5008_hw_f‹˚_büs
(
©h_hw
 *
ah
, 
u16
 
sy¡h_‰eq
)

146 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

147 
u32
 
tmp_ªg
;

148 
ªg_wrôes
 = 0;

149 
u32
 
√w_büs
 = 0;

151 i‡(!
	`AR_SREV_5416
(
ah
Ë|| 
sy¡h_‰eq
 >= 3000)

154 
	`BUG_ON
(
	`AR_SREV_9280_20_OR_LATER
(
ah
));

156 i‡(
sy¡h_‰eq
 < 2412)

157 
√w_büs
 = 0;

158 i‡(
sy¡h_‰eq
 < 2422)

159 
√w_büs
 = 1;

161 
√w_büs
 = 2;

164 
tmp_ªg
 = 
	`©h9k_hw_ªvî£_bôs
(
√w_büs
, 3);

166 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "ForceÑf_pwd_icsyndivÅo %1d on %4d\n",

167 
√w_büs
, 
sy¡h_‰eq
);

170 
	`¨5008_hw_phy_modify_rx_buf„r
(
ah
->
™ÆogB™k6D©a
, 
tmp_ªg
, 3, 181, 3);

173 
	`¨5008_wrôe_b™k6
(
ah
, &
ªg_wrôes
);

174 
	}
}

185 
	$¨5008_hw_£t_ch™√l
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

187 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

188 
u32
 
ch™√lSñ
 = 0;

189 
u32
 
bModeSy¡h
 = 0;

190 
u32
 
aModeRefSñ
 = 0;

191 
u32
 
ªg32
 = 0;

192 
u16
 
‰eq
;

193 
ch™_˚¡îs
 
˚¡îs
;

195 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

196 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

198 i‡(
‰eq
 < 4800) {

199 
u32
 
tx˘l
;

201 i‡(((
‰eq
 - 2192) % 5) == 0) {

202 
ch™√lSñ
 = ((
‰eq
 - 672) * 2 - 3040) / 10;

203 
bModeSy¡h
 = 0;

204 } i‡(((
‰eq
 - 2224) % 5) == 0) {

205 
ch™√lSñ
 = ((
‰eq
 - 704) * 2 - 3040) / 10;

206 
bModeSy¡h
 = 1;

208 
	`©h_îr
(
comm⁄
, "InvÆid ch™√»%u MHz\n", 
‰eq
);

209  -
EINVAL
;

212 
ch™√lSñ
 = (channelSel << 2) & 0xff;

213 
ch™√lSñ
 = 
	`©h9k_hw_ªvî£_bôs
(channelSel, 8);

215 
tx˘l
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_TX_CTRL
);

216 i‡(
‰eq
 == 2484) {

218 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_TX_CTRL
,

219 
tx˘l
 | 
AR_PHY_CCK_TX_CTRL_JAPAN
);

221 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_TX_CTRL
,

222 
tx˘l
 & ~
AR_PHY_CCK_TX_CTRL_JAPAN
);

225 } i‡((
‰eq
 % 20) == 0 && freq >= 5120) {

226 
ch™√lSñ
 =

227 
	`©h9k_hw_ªvî£_bôs
(((
‰eq
 - 4800) / 20 << 2), 8);

228 
aModeRefSñ
 = 
	`©h9k_hw_ªvî£_bôs
(1, 2);

229 } i‡((
‰eq
 % 10) == 0) {

230 
ch™√lSñ
 =

231 
	`©h9k_hw_ªvî£_bôs
(((
‰eq
 - 4800) / 10 << 1), 8);

232 i‡(
	`AR_SREV_9100
(
ah
Ë|| 
	`AR_SREV_9160_10_OR_LATER
(ah))

233 
aModeRefSñ
 = 
	`©h9k_hw_ªvî£_bôs
(2, 2);

235 
aModeRefSñ
 = 
	`©h9k_hw_ªvî£_bôs
(1, 2);

236 } i‡((
‰eq
 % 5) == 0) {

237 
ch™√lSñ
 = 
	`©h9k_hw_ªvî£_bôs
((
‰eq
 - 4800) / 5, 8);

238 
aModeRefSñ
 = 
	`©h9k_hw_ªvî£_bôs
(1, 2);

240 
	`©h_îr
(
comm⁄
, "InvÆid ch™√»%u MHz\n", 
‰eq
);

241  -
EINVAL
;

244 
	`¨5008_hw_f‹˚_büs
(
ah
, 
‰eq
);

246 
ªg32
 =

247 (
ch™√lSñ
 << 8Ë| (
aModeRefSñ
 << 2Ë| (
bModeSy¡h
 << 1) |

250 
	`REG_WRITE
(
ah
, 
	`AR_PHY
(0x37), 
ªg32
);

252 
ah
->
curch™
 = 
ch™
;

255 
	}
}

257 
	$¨5008_hw_cmn_•ur_môig©e
(
©h_hw
 *
ah
,

258 
©h9k_ch™√l
 *
ch™
, 
bö
)

260 
cur_bö
;

261 
uµî
, 
lowî
, 
cur_vô_mask
;

262 
i
;

263 
öt8_t
 
mask_m
[123];

264 
öt8_t
 
mask_p
[123];

265 
öt8_t
 
mask_amt
;

266 
tmp_mask
;

267 c⁄° 
pûŸ_mask_ªg
[4] = {

268 
AR_PHY_TIMING7
, 
AR_PHY_TIMING8
,

269 
AR_PHY_PILOT_MASK_01_30
, 
AR_PHY_PILOT_MASK_31_60


271 c⁄° 
ch™_mask_ªg
[4] = {

272 
AR_PHY_TIMING9
, 
AR_PHY_TIMING10
,

273 
AR_PHY_CHANNEL_MASK_01_30
, 
AR_PHY_CHANNEL_MASK_31_60


275 c⁄° 
öc
[4] = { 0, 100, 0, 0 };

277 
cur_bö
 = -6000;

278 
uµî
 = 
bö
 + 100;

279 
lowî
 = 
bö
 - 100;

281 
i
 = 0; i < 4; i++) {

282 
pûŸ_mask
 = 0;

283 
ch™_mask
 = 0;

284 
bp
 = 0;

286 
bp
 = 0; bp < 30; bp++) {

287 i‡((
cur_bö
 > 
lowî
Ë&& (cur_bö < 
uµî
)) {

288 
pûŸ_mask
 =ÖûŸ_mask | 0x1 << 
bp
;

289 
ch™_mask
 = ch™_mask | 0x1 << 
bp
;

291 
cur_bö
 += 100;

293 
cur_bö
 +
öc
[
i
];

294 
	`REG_WRITE
(
ah
, 
pûŸ_mask_ªg
[
i
], 
pûŸ_mask
);

295 
	`REG_WRITE
(
ah
, 
ch™_mask_ªg
[
i
], 
ch™_mask
);

298 
cur_vô_mask
 = 6100;

299 
uµî
 = 
bö
 + 120;

300 
lowî
 = 
bö
 - 120;

302 
i
 = 0; i < 123; i++) {

303 i‡((
cur_vô_mask
 > 
lowî
Ë&& (cur_vô_mask < 
uµî
)) {

305 vﬁ©ûê
tmp_v
 = 
	`abs
(
cur_vô_mask
 - 
bö
);

307 i‡(
tmp_v
 < 75)

308 
mask_amt
 = 1;

310 
mask_amt
 = 0;

311 i‡(
cur_vô_mask
 < 0)

312 
mask_m
[
	`abs
(
cur_vô_mask
 / 100)] = 
mask_amt
;

314 
mask_p
[
cur_vô_mask
 / 100] = 
mask_amt
;

316 
cur_vô_mask
 -= 100;

319 
tmp_mask
 = (
mask_m
[46] << 30) | (mask_m[47] << 28)

320 | (
mask_m
[48] << 26) | (mask_m[49] << 24)

321 | (
mask_m
[50] << 22) | (mask_m[51] << 20)

322 | (
mask_m
[52] << 18) | (mask_m[53] << 16)

323 | (
mask_m
[54] << 14) | (mask_m[55] << 12)

324 | (
mask_m
[56] << 10) | (mask_m[57] << 8)

325 | (
mask_m
[58] << 6) | (mask_m[59] << 4)

326 | (
mask_m
[60] << 2) | (mask_m[61] << 0);

327 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK_1
, 
tmp_mask
);

328 
	`REG_WRITE
(
ah
, 
AR_PHY_VIT_MASK2_M_46_61
, 
tmp_mask
);

330 
tmp_mask
 = (
mask_m
[31] << 28)

331 | (
mask_m
[32] << 26) | (mask_m[33] << 24)

332 | (
mask_m
[34] << 22) | (mask_m[35] << 20)

333 | (
mask_m
[36] << 18) | (mask_m[37] << 16)

334 | (
mask_m
[48] << 14) | (mask_m[39] << 12)

335 | (
mask_m
[40] << 10) | (mask_m[41] << 8)

336 | (
mask_m
[42] << 6) | (mask_m[43] << 4)

337 | (
mask_m
[44] << 2) | (mask_m[45] << 0);

338 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK_2
, 
tmp_mask
);

339 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_M_31_45
, 
tmp_mask
);

341 
tmp_mask
 = (
mask_m
[16] << 30) | (mask_m[16] << 28)

342 | (
mask_m
[18] << 26) | (mask_m[18] << 24)

343 | (
mask_m
[20] << 22) | (mask_m[20] << 20)

344 | (
mask_m
[22] << 18) | (mask_m[22] << 16)

345 | (
mask_m
[24] << 14) | (mask_m[24] << 12)

346 | (
mask_m
[25] << 10) | (mask_m[26] << 8)

347 | (
mask_m
[27] << 6) | (mask_m[28] << 4)

348 | (
mask_m
[29] << 2) | (mask_m[30] << 0);

349 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK_3
, 
tmp_mask
);

350 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_M_16_30
, 
tmp_mask
);

352 
tmp_mask
 = (
mask_m
[0] << 30) | (mask_m[1] << 28)

353 | (
mask_m
[2] << 26) | (mask_m[3] << 24)

354 | (
mask_m
[4] << 22) | (mask_m[5] << 20)

355 | (
mask_m
[6] << 18) | (mask_m[7] << 16)

356 | (
mask_m
[8] << 14) | (mask_m[9] << 12)

357 | (
mask_m
[10] << 10) | (mask_m[11] << 8)

358 | (
mask_m
[12] << 6) | (mask_m[13] << 4)

359 | (
mask_m
[14] << 2) | (mask_m[15] << 0);

360 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK_CTL
, 
tmp_mask
);

361 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_M_00_15
, 
tmp_mask
);

363 
tmp_mask
 = (
mask_p
[15] << 28)

364 | (
mask_p
[14] << 26) | (mask_p[13] << 24)

365 | (
mask_p
[12] << 22) | (mask_p[11] << 20)

366 | (
mask_p
[10] << 18) | (mask_p[9] << 16)

367 | (
mask_p
[8] << 14) | (mask_p[7] << 12)

368 | (
mask_p
[6] << 10) | (mask_p[5] << 8)

369 | (
mask_p
[4] << 6) | (mask_p[3] << 4)

370 | (
mask_p
[2] << 2) | (mask_p[1] << 0);

371 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK2_1
, 
tmp_mask
);

372 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_P_15_01
, 
tmp_mask
);

374 
tmp_mask
 = (
mask_p
[30] << 28)

375 | (
mask_p
[29] << 26) | (mask_p[28] << 24)

376 | (
mask_p
[27] << 22) | (mask_p[26] << 20)

377 | (
mask_p
[25] << 18) | (mask_p[24] << 16)

378 | (
mask_p
[23] << 14) | (mask_p[22] << 12)

379 | (
mask_p
[21] << 10) | (mask_p[20] << 8)

380 | (
mask_p
[19] << 6) | (mask_p[18] << 4)

381 | (
mask_p
[17] << 2) | (mask_p[16] << 0);

382 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK2_2
, 
tmp_mask
);

383 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_P_30_16
, 
tmp_mask
);

385 
tmp_mask
 = (
mask_p
[45] << 28)

386 | (
mask_p
[44] << 26) | (mask_p[43] << 24)

387 | (
mask_p
[42] << 22) | (mask_p[41] << 20)

388 | (
mask_p
[40] << 18) | (mask_p[39] << 16)

389 | (
mask_p
[38] << 14) | (mask_p[37] << 12)

390 | (
mask_p
[36] << 10) | (mask_p[35] << 8)

391 | (
mask_p
[34] << 6) | (mask_p[33] << 4)

392 | (
mask_p
[32] << 2) | (mask_p[31] << 0);

393 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK2_3
, 
tmp_mask
);

394 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_P_45_31
, 
tmp_mask
);

396 
tmp_mask
 = (
mask_p
[61] << 30) | (mask_p[60] << 28)

397 | (
mask_p
[59] << 26) | (mask_p[58] << 24)

398 | (
mask_p
[57] << 22) | (mask_p[56] << 20)

399 | (
mask_p
[55] << 18) | (mask_p[54] << 16)

400 | (
mask_p
[53] << 14) | (mask_p[52] << 12)

401 | (
mask_p
[51] << 10) | (mask_p[50] << 8)

402 | (
mask_p
[49] << 6) | (mask_p[48] << 4)

403 | (
mask_p
[47] << 2) | (mask_p[46] << 0);

404 
	`REG_WRITE
(
ah
, 
AR_PHY_BIN_MASK2_4
, 
tmp_mask
);

405 
	`REG_WRITE
(
ah
, 
AR_PHY_MASK2_P_61_45
, 
tmp_mask
);

406 
	}
}

416 
	$¨5008_hw_•ur_môig©e
(
©h_hw
 *
ah
,

417 
©h9k_ch™√l
 *
ch™
)

419 
bb_•ur
 = 
AR_NO_SPUR
;

420 
bö
;

421 
•ur_‰eq_sd
;

422 
•ur_dñè_pha£
;

423 
díomö©‹
;

424 
tmp
, 
√w
;

425 
i
;

427 
öt8_t
 
mask_m
[123];

428 
öt8_t
 
mask_p
[123];

429 
cur_bb_•ur
;

430 
boﬁ
 
is2GHz
 = 
	`IS_CHAN_2GHZ
(
ch™
);

432 
	`mem£t
(&
mask_m
, 0, (
öt8_t
) * 123);

433 
	`mem£t
(&
mask_p
, 0, (
öt8_t
) * 123);

435 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
; i++) {

436 
cur_bb_•ur
 = 
ah
->
ìp_›s
->
	`gë_•ur_ch™√l
◊h, 
i
, 
is2GHz
);

437 i‡(
AR_NO_SPUR
 =
cur_bb_•ur
)

439 
cur_bb_•ur
 = cur_bb_•u∏- (
ch™
->
ch™√l
 * 10);

440 i‡((
cur_bb_•ur
 > -95) && (cur_bb_spur < 95)) {

441 
bb_•ur
 = 
cur_bb_•ur
;

446 i‡(
AR_NO_SPUR
 =
bb_•ur
)

449 
bö
 = 
bb_•ur
 * 32;

451 
tmp
 = 
	`REG_READ
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0));

452 
√w
 = 
tmp
 | (
AR_PHY_TIMING_CTRL4_ENABLE_SPUR_RSSI
 |

453 
AR_PHY_TIMING_CTRL4_ENABLE_SPUR_FILTER
 |

454 
AR_PHY_TIMING_CTRL4_ENABLE_CHAN_MASK
 |

455 
AR_PHY_TIMING_CTRL4_ENABLE_PILOT_MASK
);

457 
	`REG_WRITE
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0), 
√w
);

459 
√w
 = (
AR_PHY_SPUR_REG_MASK_RATE_CNTL
 |

460 
AR_PHY_SPUR_REG_ENABLE_MASK_PPM
 |

461 
AR_PHY_SPUR_REG_MASK_RATE_SELECT
 |

462 
AR_PHY_SPUR_REG_ENABLE_VIT_SPUR_RSSI
 |

463 
	`SM
(
SPUR_RSSI_THRESH
, 
AR_PHY_SPUR_REG_SPUR_RSSI_THRESH
));

464 
	`REG_WRITE
(
ah
, 
AR_PHY_SPUR_REG
, 
√w
);

466 
•ur_dñè_pha£
 = ((
bb_•ur
 * 524288) / 100) &

467 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
;

469 
díomö©‹
 = 
	`IS_CHAN_2GHZ
(
ch™
) ? 440 : 400;

470 
•ur_‰eq_sd
 = ((
bb_•ur
 * 2048Ë/ 
díomö©‹
) & 0x3ff;

472 
√w
 = (
AR_PHY_TIMING11_USE_SPUR_IN_AGC
 |

473 
	`SM
(
•ur_‰eq_sd
, 
AR_PHY_TIMING11_SPUR_FREQ_SD
) |

474 
	`SM
(
•ur_dñè_pha£
, 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
));

475 
	`REG_WRITE
(
ah
, 
AR_PHY_TIMING11
, 
√w
);

477 
	`¨5008_hw_cmn_•ur_môig©e
(
ah
, 
ch™
, 
bö
);

478 
	}
}

486 
	$¨5008_hw_rf_Æloc_ext_b™ks
(
©h_hw
 *
ah
)

488 
size
 = 
ah
->
öiB™k6
.
ü_rows
 * (
u32
);

490 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

493 
ah
->
™ÆogB™k6D©a
 = 
	`devm_kzÆloc
◊h->
dev
, 
size
, 
GFP_KERNEL
);

494 i‡(!
ah
->
™ÆogB™k6D©a
)

495  -
ENOMEM
;

498 
	}
}

513 
boﬁ
 
	$¨5008_hw_£t_rf_ªgs
(
©h_hw
 *
ah
,

514 
©h9k_ch™√l
 *
ch™
,

515 
u16
 
modesIndex
)

517 
u32
 
ìpMö‹Rev
;

518 
u32
 
ob5GHz
 = 0, 
db5GHz
 = 0;

519 
u32
 
ob2GHz
 = 0, 
db2GHz
 = 0;

520 
ªgWrôes
 = 0;

521 
i
;

528 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

529  
åue
;

532 
ìpMö‹Rev
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_MINOR_REV
);

534 
i
 = 0; i < 
ah
->
öiB™k6
.
ü_rows
; i++)

535 
ah
->
™ÆogB™k6D©a
[
i
] = 
	`INI_RA
(&ah->
öiB™k6
, i, 
modesIndex
);

538 i‡(
ìpMö‹Rev
 >= 2) {

539 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

540 
ob2GHz
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OB_2
);

541 
db2GHz
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_DB_2
);

542 
	`¨5008_hw_phy_modify_rx_buf„r
(
ah
->
™ÆogB™k6D©a
,

543 
ob2GHz
, 3, 197, 0);

544 
	`¨5008_hw_phy_modify_rx_buf„r
(
ah
->
™ÆogB™k6D©a
,

545 
db2GHz
, 3, 194, 0);

547 
ob5GHz
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OB_5
);

548 
db5GHz
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_DB_5
);

549 
	`¨5008_hw_phy_modify_rx_buf„r
(
ah
->
™ÆogB™k6D©a
,

550 
ob5GHz
, 3, 203, 0);

551 
	`¨5008_hw_phy_modify_rx_buf„r
(
ah
->
™ÆogB™k6D©a
,

552 
db5GHz
, 3, 200, 0);

557 
	`REG_WRITE_ARRAY
(&
b™k0
, 1, 
ªgWrôes
);

558 
	`REG_WRITE_ARRAY
(&
b™k1
, 1, 
ªgWrôes
);

559 
	`REG_WRITE_ARRAY
(&
b™k2
, 1, 
ªgWrôes
);

560 
	`REG_WRITE_ARRAY
(&
b™k3
, 
modesIndex
, 
ªgWrôes
);

561 
	`¨5008_wrôe_b™k6
(
ah
, &
ªgWrôes
);

562 
	`REG_WRITE_ARRAY
(&
b™k7
, 1, 
ªgWrôes
);

564  
åue
;

565 
	}
}

567 
	$¨5008_hw_öô_bb
(
©h_hw
 *
ah
,

568 
©h9k_ch™√l
 *
ch™
)

570 
u32
 
sy¡hDñay
;

572 
sy¡hDñay
 = 
	`REG_READ
(
ah
, 
AR_PHY_RX_DELAY
Ë& 
AR_PHY_RX_DELAY_DELAY
;

574 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

576 
	`©h9k_hw_sy¡h_dñay
(
ah
, 
ch™
, 
sy¡hDñay
);

577 
	}
}

579 
	$¨5008_hw_öô_chaö_masks
(
©h_hw
 *
ah
)

581 
rx_chaömask
, 
tx_chaömask
;

583 
rx_chaömask
 = 
ah
->
rxchaömask
;

584 
tx_chaömask
 = 
ah
->
txchaömask
;

587 
rx_chaömask
) {

589 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ANALOG_SWAP
,

590 
AR_PHY_SWAP_ALT_CHAIN
);

592 i‡(
ah
->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_REVISION_5416_10
) {

593 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_CHAINMASK
, 0x7);

594 
	`REG_WRITE
(
ah
, 
AR_PHY_CAL_CHAINMASK
, 0x7);

600 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

601 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_CHAINMASK
, 
rx_chaömask
);

602 
	`REG_WRITE
(
ah
, 
AR_PHY_CAL_CHAINMASK
, 
rx_chaömask
);

605 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

609 
	`REG_WRITE
(
ah
, 
AR_SELFGEN_MASK
, 
tx_chaömask
);

611 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

613 i‡(
tx_chaömask
 == 0x5) {

614 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ANALOG_SWAP
,

615 
AR_PHY_SWAP_ALT_CHAIN
);

617 i‡(
	`AR_SREV_9100
(
ah
))

618 
	`REG_WRITE
(
ah
, 
AR_PHY_ANALOG_SWAP
,

619 
	`REG_READ
(
ah
, 
AR_PHY_ANALOG_SWAP
) | 0x00000001);

620 
	}
}

622 
	$¨5008_hw_ovîride_öi
(
©h_hw
 *
ah
,

623 
©h9k_ch™√l
 *
ch™
)

625 
u32
 
vÆ
;

632 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, (
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
));

634 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

642 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PCU_MISC_MODE2
) &

643 (~
AR_ADHOC_MCAST_KEYID_ENABLE
);

645 i‡(!
	`AR_SREV_9271
(
ah
))

646 
vÆ
 &~
AR_PCU_MISC_MODE2_HWWAR1
;

648 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
))

649 
vÆ
 = vÆ & (~
AR_PCU_MISC_MODE2_HWWAR2
);

651 
vÆ
 |
AR_PCU_MISC_MODE2_CFP_IGNORE
;

653 
	`REG_WRITE
(
ah
, 
AR_PCU_MISC_MODE2
, 
vÆ
);

656 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

662 
	`REG_WRITE
(
ah
, 0x9800 + (651 << 2), 0x11);

668 i‡(
	`AR_SREV_9100
(
ah
Ë|| 
	`AR_SREV_9160
(ah)) {

669 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_HEAVY_CLIP_FACTOR_RIFS
);

670 
vÆ
 &~
AR_PHY_RIFS_INIT_DELAY
;

671 
	`REG_WRITE
(
ah
, 
AR_PHY_HEAVY_CLIP_FACTOR_RIFS
, 
vÆ
);

673 
	}
}

675 
	$¨5008_hw_£t_ch™√l_ªgs
(
©h_hw
 *
ah
,

676 
©h9k_ch™√l
 *
ch™
)

678 
u32
 
phymode
;

679 
u32
 
íabÀDacFifo
 = 0;

681 i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
))

682 
íabÀDacFifo
 = (
	`REG_READ
(
ah
, 
AR_PHY_TURBO
) &

683 
AR_PHY_FC_ENABLE_DAC_FIFO
);

685 
phymode
 = 
AR_PHY_FC_HT_EN
 | 
AR_PHY_FC_SHORT_GI_40


686 | 
AR_PHY_FC_SINGLE_HT_LTF1
 | 
AR_PHY_FC_WALSH
 | 
íabÀDacFifo
;

688 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

689 
phymode
 |
AR_PHY_FC_DYN2040_EN
;

691 i‡(
	`IS_CHAN_HT40PLUS
(
ch™
))

692 
phymode
 |
AR_PHY_FC_DYN2040_PRI_CH
;

695 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

696 
	`REG_WRITE
(
ah
, 
AR_PHY_TURBO
, 
phymode
);

700 
	`©h9k_hw_£t11nmac2040
(
ah
, 
ch™
);

702 
	`REG_WRITE
(
ah
, 
AR_GTXTO
, 25 << 
AR_GTXTO_TIMEOUT_LIMIT_S
);

703 
	`REG_WRITE
(
ah
, 
AR_CST
, 0xF << 
AR_CST_TIMEOUT_LIMIT_S
);

705 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

706 
	}
}

709 
	$¨5008_hw_¥o˚ss_öi
(
©h_hw
 *
ah
,

710 
©h9k_ch™√l
 *
ch™
)

712 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

713 
i
, 
ªgWrôes
 = 0;

714 
u32
 
modesIndex
, 
‰eqIndex
;

716 i‡(
	`IS_CHAN_5GHZ
(
ch™
)) {

717 
‰eqIndex
 = 1;

718 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 2 : 1;

720 
‰eqIndex
 = 2;

721 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 3 : 4;

728 
	`REG_WRITE
(
ah
, 
	`AR_PHY
(0), 0x00000007);

731 
	`REG_WRITE
(
ah
, 
AR_PHY_ADC_SERIAL_CTL
, 
AR_PHY_SEL_EXTERNAL_RADIO
);

732 i‡(
ah
->
ìp_›s
->
£t_addac
)

733 
ah
->
ìp_›s
->
	`£t_addac
◊h, 
ch™
);

735 
	`REG_WRITE_ARRAY
(&
ah
->
öiAddac
, 1, 
ªgWrôes
);

736 
	`REG_WRITE
(
ah
, 
AR_PHY_ADC_SERIAL_CTL
, 
AR_PHY_SEL_INTERNAL_ADDAC
);

738 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

740 
i
 = 0; i < 
ah
->
öiModes
.
ü_rows
; i++) {

741 
u32
 
ªg
 = 
	`INI_RA
(&
ah
->
öiModes
, 
i
, 0);

742 
u32
 
vÆ
 = 
	`INI_RA
(&
ah
->
öiModes
, 
i
, 
modesIndex
);

744 i‡(
ªg
 =
AR_AN_TOP2
 && 
ah
->
√ed_™_t›2_fixup
)

745 
vÆ
 &~
AR_AN_TOP2_PWDCLKIND
;

747 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
);

749 i‡(
ªg
 >= 0x7800 &&Ñeg < 0x78a0

750 && 
ah
->
c⁄fig
.
™Æog_shi·ªg


751 && (
comm⁄
->
bus_›s
->
©h_bus_ty≥
 !
ATH_USB
)) {

752 
	`udñay
(100);

755 
	`DO_DELAY
(
ªgWrôes
);

758 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

760 i‡(
	`AR_SREV_9280
(
ah
Ë|| 
	`AR_SREV_9287_11_OR_LATER
(ah))

761 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesRxGaö
, 
modesIndex
, 
ªgWrôes
);

763 i‡(
	`AR_SREV_9280
(
ah
Ë|| 
	`AR_SREV_9285_12_OR_LATER
(ah) ||

764 
	`AR_SREV_9287_11_OR_LATER
(
ah
))

765 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesTxGaö
, 
modesIndex
, 
ªgWrôes
);

767 i‡(
	`AR_SREV_9271_10
(
ah
)) {

768 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
, 
AR_PHY_SPECTRAL_SCAN_ENA
);

769 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL3
, 
AR_PHY_TX_END_TO_ADC_ON
, 0xa);

772 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

775 
i
 = 0; i < 
ah
->
öiComm⁄
.
ü_rows
; i++) {

776 
u32
 
ªg
 = 
	`INI_RA
(&
ah
->
öiComm⁄
, 
i
, 0);

777 
u32
 
vÆ
 = 
	`INI_RA
(&
ah
->
öiComm⁄
, 
i
, 1);

779 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
);

781 i‡(
ªg
 >= 0x7800 &&Ñeg < 0x78a0

782 && 
ah
->
c⁄fig
.
™Æog_shi·ªg


783 && (
comm⁄
->
bus_›s
->
©h_bus_ty≥
 !
ATH_USB
)) {

784 
	`udñay
(100);

787 
	`DO_DELAY
(
ªgWrôes
);

790 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

792 
	`REG_WRITE_ARRAY
(&
ah
->
öiBB_RfGaö
, 
‰eqIndex
, 
ªgWrôes
);

794 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

795 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesFa°Clock
, 
modesIndex
,

796 
ªgWrôes
);

798 
	`¨5008_hw_ovîride_öi
(
ah
, 
ch™
);

799 
	`¨5008_hw_£t_ch™√l_ªgs
(
ah
, 
ch™
);

800 
	`¨5008_hw_öô_chaö_masks
(
ah
);

801 
	`©h9k_ﬁc_öô
(
ah
);

802 
	`©h9k_hw_≠∂y_txpowî
(
ah
, 
ch™
, 
Ál£
);

805 i‡(!
	`©h9k_hw_£t_rf_ªgs
(
ah
, 
ch™
, 
‰eqIndex
)) {

806 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
), "ar5416SetRfRegs failed\n");

807  -
EIO
;

811 
	}
}

813 
	$¨5008_hw_£t_rfmode
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

815 
u32
 
rfMode
 = 0;

817 i‡(
ch™
 =
NULL
)

820 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

821 
rfMode
 |
AR_PHY_MODE_DYNAMIC
;

823 
rfMode
 |
AR_PHY_MODE_OFDM
;

825 i‡(!
	`AR_SREV_9280_20_OR_LATER
(
ah
))

826 
rfMode
 |(
	`IS_CHAN_5GHZ
(
ch™
)) ?

827 
AR_PHY_MODE_RF5GHZ
 : 
AR_PHY_MODE_RF2GHZ
;

829 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

830 
rfMode
 |(
AR_PHY_MODE_DYNAMIC
 | 
AR_PHY_MODE_DYN_CCK_DISABLE
);

832 
	`REG_WRITE
(
ah
, 
AR_PHY_MODE
, 
rfMode
);

833 
	}
}

835 
	$¨5008_hw_m¨k_phy_öa˘ive
(
©h_hw
 *
ah
)

837 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_DIS
);

838 
	}
}

840 
	$¨5008_hw_£t_dñè_¶›e
(
©h_hw
 *
ah
,

841 
©h9k_ch™√l
 *
ch™
)

843 
u32
 
c€f_sˇÀd
, 
ds_c€f_exp
, 
ds_c€f_m™
;

844 
u32
 
˛ockMhzSˇÀd
 = 0x64000000;

845 
ch™_˚¡îs
 
˚¡îs
;

847 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
))

848 
˛ockMhzSˇÀd
 = clockMhzScaled >> 1;

849 i‡(
	`IS_CHAN_QUARTER_RATE
(
ch™
))

850 
˛ockMhzSˇÀd
 = clockMhzScaled >> 2;

852 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

853 
c€f_sˇÀd
 = 
˛ockMhzSˇÀd
 / 
˚¡îs
.
sy¡h_˚¡î
;

855 
	`©h9k_hw_gë_dñè_¶›e_vÆs
(
ah
, 
c€f_sˇÀd
, &
ds_c€f_m™
,

856 &
ds_c€f_exp
);

858 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING3
,

859 
AR_PHY_TIMING3_DSC_MAN
, 
ds_c€f_m™
);

860 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING3
,

861 
AR_PHY_TIMING3_DSC_EXP
, 
ds_c€f_exp
);

863 
c€f_sˇÀd
 = (9 * coef_scaled) / 10;

865 
	`©h9k_hw_gë_dñè_¶›e_vÆs
(
ah
, 
c€f_sˇÀd
, &
ds_c€f_m™
,

866 &
ds_c€f_exp
);

868 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_HALFGI
,

869 
AR_PHY_HALFGI_DSC_MAN
, 
ds_c€f_m™
);

870 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_HALFGI
,

871 
AR_PHY_HALFGI_DSC_EXP
, 
ds_c€f_exp
);

872 
	}
}

874 
boﬁ
 
	$¨5008_hw_rfbus_ªq
(
©h_hw
 *
ah
)

876 
	`REG_WRITE
(
ah
, 
AR_PHY_RFBUS_REQ
, 
AR_PHY_RFBUS_REQ_EN
);

877  
	`©h9k_hw_waô
(
ah
, 
AR_PHY_RFBUS_GRANT
, 
AR_PHY_RFBUS_GRANT_EN
,

878 
AR_PHY_RFBUS_GRANT_EN
, 
AH_WAIT_TIMEOUT
);

879 
	}
}

881 
	$¨5008_hw_rfbus_d⁄e
(
©h_hw
 *
ah
)

883 
u32
 
sy¡hDñay
 = 
	`REG_READ
(
ah
, 
AR_PHY_RX_DELAY
Ë& 
AR_PHY_RX_DELAY_DELAY
;

885 
	`©h9k_hw_sy¡h_dñay
(
ah
,áh->
curch™
, 
sy¡hDñay
);

887 
	`REG_WRITE
(
ah
, 
AR_PHY_RFBUS_REQ
, 0);

888 
	}
}

890 
	$¨5008_ª°‹e_chaömask
(
©h_hw
 *
ah
)

892 
rx_chaömask
 = 
ah
->
rxchaömask
;

894 i‡((
rx_chaömask
 == 0x5) || (rx_chainmask == 0x3)) {

895 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_CHAINMASK
, 
rx_chaömask
);

896 
	`REG_WRITE
(
ah
, 
AR_PHY_CAL_CHAINMASK
, 
rx_chaömask
);

898 
	}
}

900 
u32
 
	$¨9160_hw_compuã_∂l_c⁄åﬁ
(
©h_hw
 *
ah
,

901 
©h9k_ch™√l
 *
ch™
)

903 
u32
 
∂l
;

905 
∂l
 = 
	`SM
(0x5, 
AR_RTC_9160_PLL_REFDIV
);

907 i‡(
ch™
 && 
	`IS_CHAN_HALF_RATE
(chan))

908 
∂l
 |
	`SM
(0x1, 
AR_RTC_9160_PLL_CLKSEL
);

909 i‡(
ch™
 && 
	`IS_CHAN_QUARTER_RATE
(chan))

910 
∂l
 |
	`SM
(0x2, 
AR_RTC_9160_PLL_CLKSEL
);

912 i‡(
ch™
 && 
	`IS_CHAN_5GHZ
(chan))

913 
∂l
 |
	`SM
(0x50, 
AR_RTC_9160_PLL_DIV
);

915 
∂l
 |
	`SM
(0x58, 
AR_RTC_9160_PLL_DIV
);

917  
∂l
;

918 
	}
}

920 
u32
 
	$¨5008_hw_compuã_∂l_c⁄åﬁ
(
©h_hw
 *
ah
,

921 
©h9k_ch™√l
 *
ch™
)

923 
u32
 
∂l
;

925 
∂l
 = 
AR_RTC_PLL_REFDIV_5
 | 
AR_RTC_PLL_DIV2
;

927 i‡(
ch™
 && 
	`IS_CHAN_HALF_RATE
(chan))

928 
∂l
 |
	`SM
(0x1, 
AR_RTC_PLL_CLKSEL
);

929 i‡(
ch™
 && 
	`IS_CHAN_QUARTER_RATE
(chan))

930 
∂l
 |
	`SM
(0x2, 
AR_RTC_PLL_CLKSEL
);

932 i‡(
ch™
 && 
	`IS_CHAN_5GHZ
(chan))

933 
∂l
 |
	`SM
(0xa, 
AR_RTC_PLL_DIV
);

935 
∂l
 |
	`SM
(0xb, 
AR_RTC_PLL_DIV
);

937  
∂l
;

938 
	}
}

940 
boﬁ
 
	$¨5008_hw_™i_c⁄åﬁ_√w
(
©h_hw
 *
ah
,

941 
©h9k_™i_cmd
 
cmd
,

942 
∑øm
)

944 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

945 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

946 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

947 
s32
 
vÆue
;

949 
cmd
 & 
ah
->
™i_fun˘i⁄
) {

950 
ATH9K_ANI_OFDM_WEAK_SIGNAL_DETECTION
:{

958 
u32
 
⁄
 = 
∑øm
 ? 1 : 0;

960 i‡(
⁄
)

961 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SFCORR_LOW
,

962 
AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
);

964 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SFCORR_LOW
,

965 
AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
);

967 i‡(
⁄
 !
™iSèã
->
ofdmWókSigDëe˘
) {

968 
	`©h_dbg
(
comm⁄
, 
ANI
,

970 
ch™
->
ch™√l
,

971 
™iSèã
->
ofdmWókSigDëe˘
 ?

973 
⁄
 ? "on" : "off");

974 i‡(
⁄
)

975 
ah
->
°©s
.
a°_™i_ofdm⁄
++;

977 
ah
->
°©s
.
a°_™i_ofdmoff
++;

978 
™iSèã
->
ofdmWókSigDëe˘
 = 
⁄
;

982 
ATH9K_ANI_FIRSTEP_LEVEL
:{

983 
u32
 
Àvñ
 = 
∑øm
;

985 
vÆue
 = 
Àvñ
 * 2;

986 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FIND_SIG
,

987 
AR_PHY_FIND_SIG_FIRSTEP
, 
vÆue
);

988 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FIND_SIG_LOW
,

989 
AR_PHY_FIND_SIG_FIRSTEP_LOW
, 
vÆue
);

991 i‡(
Àvñ
 !
™iSèã
->
fú°ïLevñ
) {

992 
	`©h_dbg
(
comm⁄
, 
ANI
,

994 
ch™
->
ch™√l
,

995 
™iSèã
->
fú°ïLevñ
,

996 
Àvñ
,

997 
ATH9K_ANI_FIRSTEP_LVL
,

998 
vÆue
,

999 
™iSèã
->
öiDef
.
fú°ï
);

1000 
	`©h_dbg
(
comm⁄
, 
ANI
,

1002 
ch™
->
ch™√l
,

1003 
™iSèã
->
fú°ïLevñ
,

1004 
Àvñ
,

1005 
ATH9K_ANI_FIRSTEP_LVL
,

1006 
vÆue
,

1007 
™iSèã
->
öiDef
.
fú°ïLow
);

1008 i‡(
Àvñ
 > 
™iSèã
->
fú°ïLevñ
)

1009 
ah
->
°©s
.
a°_™i_°ïup
++;

1010 i‡(
Àvñ
 < 
™iSèã
->
fú°ïLevñ
)

1011 
ah
->
°©s
.
a°_™i_°ïdown
++;

1012 
™iSèã
->
fú°ïLevñ
 = 
Àvñ
;

1016 
ATH9K_ANI_SPUR_IMMUNITY_LEVEL
:{

1017 
u32
 
Àvñ
 = 
∑øm
;

1019 
vÆue
 = (
Àvñ
 + 1) * 2;

1020 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING5
,

1021 
AR_PHY_TIMING5_CYCPWR_THR1
, 
vÆue
);

1023 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA
,

1024 
AR_PHY_EXT_TIMING5_CYCPWR_THR1
, 
vÆue
 - 1);

1026 i‡(
Àvñ
 !
™iSèã
->
•urImmunôyLevñ
) {

1027 
	`©h_dbg
(
comm⁄
, 
ANI
,

1029 
ch™
->
ch™√l
,

1030 
™iSèã
->
•urImmunôyLevñ
,

1031 
Àvñ
,

1032 
ATH9K_ANI_SPUR_IMMUNE_LVL
,

1033 
vÆue
,

1034 
™iSèã
->
öiDef
.
cy˝wrThr1
);

1035 
	`©h_dbg
(
comm⁄
, 
ANI
,

1037 
ch™
->
ch™√l
,

1038 
™iSèã
->
•urImmunôyLevñ
,

1039 
Àvñ
,

1040 
ATH9K_ANI_SPUR_IMMUNE_LVL
,

1041 
vÆue
,

1042 
™iSèã
->
öiDef
.
cy˝wrThr1Ext
);

1043 i‡(
Àvñ
 > 
™iSèã
->
•urImmunôyLevñ
)

1044 
ah
->
°©s
.
a°_™i_•urup
++;

1045 i‡(
Àvñ
 < 
™iSèã
->
•urImmunôyLevñ
)

1046 
ah
->
°©s
.
a°_™i_•urdown
++;

1047 
™iSèã
->
•urImmunôyLevñ
 = 
Àvñ
;

1051 
ATH9K_ANI_MRC_CCK
:

1056 
	`WARN_ON
(1);

1059 
	`©h_dbg
(
comm⁄
, 
ANI
, "övÆid cmd %u\n", 
cmd
);

1060  
Ál£
;

1063 
	`©h_dbg
(
comm⁄
, 
ANI
,

1065 
™iSèã
->
•urImmunôyLevñ
,

1066 
™iSèã
->
ofdmWókSigDëe˘
 ? "on" : "off",

1067 
™iSèã
->
fú°ïLevñ
,

1068 
™iSèã
->
mrcCCK
 ? "on" : "off",

1069 
™iSèã
->
li°íTime
,

1070 
™iSèã
->
ofdmPhyEºCou¡
,

1071 
™iSèã
->
cckPhyEºCou¡
);

1072  
åue
;

1073 
	}
}

1075 
	$¨5008_hw_do_gënf
(
©h_hw
 *
ah
,

1076 
öt16_t
 
nÁºay
[
NUM_NF_READINGS
])

1078 
öt16_t
 
nf
;

1080 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CCA
), 
AR_PHY_MINCCA_PWR
);

1081 
nÁºay
[0] = 
	`sign_exãnd32
(
nf
, 8);

1083 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH1_CCA
), 
AR_PHY_CH1_MINCCA_PWR
);

1084 
nÁºay
[1] = 
	`sign_exãnd32
(
nf
, 8);

1086 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH2_CCA
), 
AR_PHY_CH2_MINCCA_PWR
);

1087 
nÁºay
[2] = 
	`sign_exãnd32
(
nf
, 8);

1089 i‡(!
	`IS_CHAN_HT40
(
ah
->
curch™
))

1092 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_EXT_CCA
), 
AR_PHY_EXT_MINCCA_PWR
);

1093 
nÁºay
[3] = 
	`sign_exãnd32
(
nf
, 8);

1095 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH1_EXT_CCA
), 
AR_PHY_CH1_EXT_MINCCA_PWR
);

1096 
nÁºay
[4] = 
	`sign_exãnd32
(
nf
, 8);

1098 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH2_EXT_CCA
), 
AR_PHY_CH2_EXT_MINCCA_PWR
);

1099 
nÁºay
[5] = 
	`sign_exãnd32
(
nf
, 8);

1100 
	}
}

1107 
	$¨5008_hw_™i_ˇche_öi_ªgs
(
©h_hw
 *
ah
)

1109 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1110 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

1111 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

1112 
©h9k_™i_deÁu…
 *
öiDef
;

1113 
u32
 
vÆ
;

1115 
öiDef
 = &
™iSèã
->iniDef;

1117 
	`©h_dbg
(
comm⁄
, 
ANI
, "ver %d.%d opmode %u chan %d Mhz\n",

1118 
ah
->
hw_vîsi⁄
.
macVîsi⁄
,

1119 
ah
->
hw_vîsi⁄
.
macRev
,

1120 
ah
->
›mode
,

1121 
ch™
->
ch™√l
);

1123 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR
);

1124 
öiDef
->
m1Thªsh
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M1_THRESH
);

1125 
öiDef
->
m2Thªsh
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M2_THRESH
);

1126 
öiDef
->
m2Cou¡Thr
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M2COUNT_THR
);

1128 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR_LOW
);

1129 
öiDef
->
m1ThªshLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M1_THRESH_LOW
);

1130 
öiDef
->
m2ThªshLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M2_THRESH_LOW
);

1131 
öiDef
->
m2Cou¡ThrLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW
);

1133 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR_EXT
);

1134 
öiDef
->
m1ThªshExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M1_THRESH
);

1135 
öiDef
->
m2ThªshExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M2_THRESH
);

1136 
öiDef
->
m1ThªshLowExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M1_THRESH_LOW
);

1137 
öiDef
->
m2ThªshLowExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M2_THRESH_LOW
);

1138 
öiDef
->
fú°ï
 = 
	`REG_READ_FIELD
(
ah
,

1139 
AR_PHY_FIND_SIG
,

1140 
AR_PHY_FIND_SIG_FIRSTEP
);

1141 
öiDef
->
fú°ïLow
 = 
	`REG_READ_FIELD
(
ah
,

1142 
AR_PHY_FIND_SIG_LOW
,

1143 
AR_PHY_FIND_SIG_FIRSTEP_LOW
);

1144 
öiDef
->
cy˝wrThr1
 = 
	`REG_READ_FIELD
(
ah
,

1145 
AR_PHY_TIMING5
,

1146 
AR_PHY_TIMING5_CYCPWR_THR1
);

1147 
öiDef
->
cy˝wrThr1Ext
 = 
	`REG_READ_FIELD
(
ah
,

1148 
AR_PHY_EXT_CCA
,

1149 
AR_PHY_EXT_TIMING5_CYCPWR_THR1
);

1152 
™iSèã
->
•urImmunôyLevñ
 = 
ATH9K_ANI_SPUR_IMMUNE_LVL
;

1153 
™iSèã
->
fú°ïLevñ
 = 
ATH9K_ANI_FIRSTEP_LVL
;

1154 
™iSèã
->
ofdmWókSigDëe˘
 = 
åue
;

1155 
™iSèã
->
mrcCCK
 = 
Ál£
;

1156 
	}
}

1158 
	$¨5008_hw_£t_nf_limôs
(
©h_hw
 *
ah
)

1160 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_5416_2GHZ
;

1161 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_5416_2GHZ
;

1162 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_5416_2GHZ
;

1163 
ah
->
nf_5g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_5416_5GHZ
;

1164 
ah
->
nf_5g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_5416_5GHZ
;

1165 
ah
->
nf_5g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_5416_5GHZ
;

1166 
	}
}

1168 
	$¨5008_hw_£t_ød¨_∑øms
(
©h_hw
 *
ah
,

1169 
©h_hw_ød¨_c⁄f
 *
c⁄f
)

1171 
u32
 
ød¨_0
 = 0, 
ød¨_1
;

1173 i‡(!
c⁄f
) {

1174 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_RADAR_0
, 
AR_PHY_RADAR_0_ENA
);

1178 
ød¨_0
 |
AR_PHY_RADAR_0_ENA
 | 
AR_PHY_RADAR_0_FFT_ENA
;

1179 
ød¨_0
 |
	`SM
(
c⁄f
->
fú_powî
, 
AR_PHY_RADAR_0_FIRPWR
);

1180 
ød¨_0
 |
	`SM
(
c⁄f
->
ød¨_rssi
, 
AR_PHY_RADAR_0_RRSSI
);

1181 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_height
, 
AR_PHY_RADAR_0_HEIGHT
);

1182 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_rssi
, 
AR_PHY_RADAR_0_PRSSI
);

1183 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_öb™d
, 
AR_PHY_RADAR_0_INBAND
);

1185 
ød¨_1
 = 
	`REG_READ
(
ah
, 
AR_PHY_RADAR_1
);

1186 
ød¨_1
 &~(
AR_PHY_RADAR_1_MAXLEN
 | 
AR_PHY_RADAR_1_RELSTEP_THRESH
 |

1187 
AR_PHY_RADAR_1_RELPWR_THRESH
);

1188 
ød¨_1
 |
AR_PHY_RADAR_1_MAX_RRSSI
;

1189 
ød¨_1
 |
AR_PHY_RADAR_1_BLOCK_CHECK
;

1190 
ød¨_1
 |
	`SM
(
c⁄f
->
pul£_maxÀn
, 
AR_PHY_RADAR_1_MAXLEN
);

1191 
ød¨_1
 |
	`SM
(
c⁄f
->
pul£_öb™d_°ï
, 
AR_PHY_RADAR_1_RELSTEP_THRESH
);

1192 
ød¨_1
 |
	`SM
(
c⁄f
->
ød¨_öb™d
, 
AR_PHY_RADAR_1_RELPWR_THRESH
);

1194 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_0
, 
ød¨_0
);

1195 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_1
, 
ød¨_1
);

1196 i‡(
c⁄f
->
ext_ch™√l
)

1197 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RADAR_EXT
, 
AR_PHY_RADAR_EXT_ENA
);

1199 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_RADAR_EXT
, 
AR_PHY_RADAR_EXT_ENA
);

1200 
	}
}

1202 
	$¨5008_hw_£t_ød¨_c⁄f
(
©h_hw
 *
ah
)

1204 
©h_hw_ød¨_c⁄f
 *
c⁄f
 = &
ah
->
ød¨_c⁄f
;

1206 
c⁄f
->
fú_powî
 = -33;

1207 
c⁄f
->
ød¨_rssi
 = 20;

1208 
c⁄f
->
pul£_height
 = 10;

1209 
c⁄f
->
pul£_rssi
 = 15;

1210 
c⁄f
->
pul£_öb™d
 = 15;

1211 
c⁄f
->
pul£_maxÀn
 = 255;

1212 
c⁄f
->
pul£_öb™d_°ï
 = 12;

1213 
c⁄f
->
ød¨_öb™d
 = 8;

1214 
	}
}

1216 
	$¨5008_hw_öô_txpowî_cck
(
©h_hw
 *
ah
, 
öt16_t
 *
øã_¨øy
)

1218 
	#CCK_DELTA
(
x
Ë((
OLC_FOR_AR9280_20_LATER
Ë? 
	`max
((xË- 2, 0Ë: (x))

	)

1219 
ah
->
tx_powî
[0] = 
	`CCK_DELTA
(
øã_¨øy
[
øã1l
]);

1220 
ah
->
tx_powî
[1] = 
	`CCK_DELTA
(
	`mö
(
øã_¨øy
[
øã2l
],

1221 
øã_¨øy
[
øã2s
]));

1222 
ah
->
tx_powî
[2] = 
	`CCK_DELTA
(
	`mö
(
øã_¨øy
[
øã5_5l
],

1223 
øã_¨øy
[
øã5_5s
]));

1224 
ah
->
tx_powî
[3] = 
	`CCK_DELTA
(
	`mö
(
øã_¨øy
[
øã11l
],

1225 
øã_¨øy
[
øã11s
]));

1226 #unde‡
CCK_DELTA


1227 
	}
}

1229 
	$¨5008_hw_öô_txpowî_ofdm
(
©h_hw
 *
ah
, 
öt16_t
 *
øã_¨øy
,

1230 
off£t
)

1232 
i
, 
idx
 = 0;

1234 
i
 = 
off£t
; i < off£à+ 
AR5008_OFDM_RATES
; i++) {

1235 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
idx
];

1236 
idx
++;

1238 
	}
}

1240 
	$¨5008_hw_öô_txpowî_ht
(
©h_hw
 *
ah
, 
öt16_t
 *
øã_¨øy
,

1241 
ss_off£t
, 
ds_off£t
,

1242 
boﬁ
 
is_40
, 
ht40_dñè
)

1244 
i
, 
mcs_idx
 = (
is_40
Ë? 
AR5008_HT40_SHIFT
 : 
AR5008_HT20_SHIFT
;

1246 
i
 = 
ss_off£t
; i < ss_off£à+ 
AR5008_HT_SS_RATES
; i++) {

1247 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
mcs_idx
] + 
ht40_dñè
;

1248 
mcs_idx
++;

1250 
	`mem˝y
(&
ah
->
tx_powî
[
ds_off£t
], &ah->tx_powî[
ss_off£t
],

1251 
AR5008_HT_SS_RATES
);

1252 
	}
}

1254 
	$¨5008_hw_öô_øã_txpowî
(
©h_hw
 *
ah
, 
öt16_t
 *
øã_¨øy
,

1255 
©h9k_ch™√l
 *
ch™
, 
ht40_dñè
)

1257 i‡(
	`IS_CHAN_5GHZ
(
ch™
)) {

1258 
	`¨5008_hw_öô_txpowî_ofdm
(
ah
, 
øã_¨øy
,

1259 
AR5008_11NA_OFDM_SHIFT
);

1260 i‡(
	`IS_CHAN_HT20
(
ch™
Ë|| 
	`IS_CHAN_HT40
(chan)) {

1261 
	`¨5008_hw_öô_txpowî_ht
(
ah
, 
øã_¨øy
,

1262 
AR5008_11NA_HT_SS_SHIFT
,

1263 
AR5008_11NA_HT_DS_SHIFT
,

1264 
	`IS_CHAN_HT40
(
ch™
),

1265 
ht40_dñè
);

1268 
	`¨5008_hw_öô_txpowî_cck
(
ah
, 
øã_¨øy
);

1269 
	`¨5008_hw_öô_txpowî_ofdm
(
ah
, 
øã_¨øy
,

1270 
AR5008_11NG_OFDM_SHIFT
);

1271 i‡(
	`IS_CHAN_HT20
(
ch™
Ë|| 
	`IS_CHAN_HT40
(chan)) {

1272 
	`¨5008_hw_öô_txpowî_ht
(
ah
, 
øã_¨øy
,

1273 
AR5008_11NG_HT_SS_SHIFT
,

1274 
AR5008_11NG_HT_DS_SHIFT
,

1275 
	`IS_CHAN_HT40
(
ch™
),

1276 
ht40_dñè
);

1279 
	}
}

1281 
	$¨5008_hw_gë_adc_íå›y
(
©h_hw
 *
ah
, 
u8
 *
buf
, 
size_t
 
Àn
)

1283 
i
, 
j
;

1285 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_BBB_OBS_SEL
, 1);

1286 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_RX_OBS_SEL_BIT5
);

1287 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST2
, 
AR_PHY_TEST2_RX_OBS_SEL
, 0);

1289 
	`mem£t
(
buf
, 0, 
Àn
);

1290 
i
 = 0; i < 
Àn
; i++) {

1291 
j
 = 0; j < 4; j++) {

1292 
u32
 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_TST_ADC
);

1294 
buf
[
i
] <<= 2;

1295 
buf
[
i
] |(
ªgvÆ
 & 1Ë| (‘egvÆ & 
	`BIT
(9)) >> 8);

1296 
	`udñay
(1);

1299 
	}
}

1301 
	$¨5008_hw_©èch_phy_›s
(
©h_hw
 *
ah
)

1303 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

1304 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

1305 c⁄° 
u32
 
¨5416_cˇ_ªgs
[6] = {

1306 
AR_PHY_CCA
,

1307 
AR_PHY_CH1_CCA
,

1308 
AR_PHY_CH2_CCA
,

1309 
AR_PHY_EXT_CCA
,

1310 
AR_PHY_CH1_EXT_CCA
,

1311 
AR_PHY_CH2_EXT_CCA


1313 
ªt
;

1315 
ªt
 = 
	`¨5008_hw_rf_Æloc_ext_b™ks
(
ah
);

1316 i‡(
ªt
)

1317  
ªt
;

1319 
›s
->
gë_adc_íå›y
 = 
¨5008_hw_gë_adc_íå›y
;

1321 
¥iv_›s
->
rf_£t_‰eq
 = 
¨5008_hw_£t_ch™√l
;

1322 
¥iv_›s
->
•ur_môig©e_‰eq
 = 
¨5008_hw_•ur_môig©e
;

1324 
¥iv_›s
->
£t_rf_ªgs
 = 
¨5008_hw_£t_rf_ªgs
;

1325 
¥iv_›s
->
£t_ch™√l_ªgs
 = 
¨5008_hw_£t_ch™√l_ªgs
;

1326 
¥iv_›s
->
öô_bb
 = 
¨5008_hw_öô_bb
;

1327 
¥iv_›s
->
¥o˚ss_öi
 = 
¨5008_hw_¥o˚ss_öi
;

1328 
¥iv_›s
->
£t_rfmode
 = 
¨5008_hw_£t_rfmode
;

1329 
¥iv_›s
->
m¨k_phy_öa˘ive
 = 
¨5008_hw_m¨k_phy_öa˘ive
;

1330 
¥iv_›s
->
£t_dñè_¶›e
 = 
¨5008_hw_£t_dñè_¶›e
;

1331 
¥iv_›s
->
rfbus_ªq
 = 
¨5008_hw_rfbus_ªq
;

1332 
¥iv_›s
->
rfbus_d⁄e
 = 
¨5008_hw_rfbus_d⁄e
;

1333 
¥iv_›s
->
ª°‹e_chaömask
 = 
¨5008_ª°‹e_chaömask
;

1334 
¥iv_›s
->
do_gënf
 = 
¨5008_hw_do_gënf
;

1335 
¥iv_›s
->
£t_ød¨_∑øms
 = 
¨5008_hw_£t_ød¨_∑øms
;

1337 
¥iv_›s
->
™i_c⁄åﬁ
 = 
¨5008_hw_™i_c⁄åﬁ_√w
;

1338 
¥iv_›s
->
™i_ˇche_öi_ªgs
 = 
¨5008_hw_™i_ˇche_öi_ªgs
;

1340 i‡(
	`AR_SREV_9100
(
ah
Ë|| 
	`AR_SREV_9160_10_OR_LATER
(ah))

1341 
¥iv_›s
->
compuã_∂l_c⁄åﬁ
 = 
¨9160_hw_compuã_∂l_c⁄åﬁ
;

1343 
¥iv_›s
->
compuã_∂l_c⁄åﬁ
 = 
¨5008_hw_compuã_∂l_c⁄åﬁ
;

1345 
	`¨5008_hw_£t_nf_limôs
(
ah
);

1346 
	`¨5008_hw_£t_ød¨_c⁄f
(
ah
);

1347 
	`mem˝y
(
ah
->
nf_ªgs
, 
¨5416_cˇ_ªgs
, (ah->nf_regs));

1349 
	}
}

	@ar9001_initvals.h

17 c⁄° 
u32
 
	g¨5416Modes_9100
[][5] = {

87 c⁄° 
u32
 
	g¨5416Comm⁄_9100
[][2] = {

462 c⁄° 
u32
 
	g¨5416B™k6_9100
[][3] = {

499 c⁄° 
u32
 
	g¨5416B™k6TPC_9100
[][3] = {

536 c⁄° 
u32
 
	g¨5416Addac_9100
[][2] = {

572 c⁄° 
u32
 
	g¨5416Modes_9160
[][5] = {

640 c⁄° 
u32
 
	g¨5416Comm⁄_9160
[][2] = {

1018 c⁄° 
u32
 
	g¨5416Addac_9160
[][2] = {

1054 c⁄° 
u32
 
	g¨5416Addac_9160_1_1
[][2] = {

	@ar9002_calib.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~"¨9002_phy.h
"

21 
	#AR9285_CLCAL_REDO_THRESH
 1

	)

23 
	e¨9002_ˇl_ty≥s
 {

24 
	mADC_GAIN_CAL
 = 
BIT
(0),

25 
	mADC_DC_CAL
 = 
BIT
(1),

26 
	mIQ_MISMATCH_CAL
 = 
BIT
(2),

29 
boﬁ
 
	$¨9002_hw_is_ˇl_suµ‹ãd
(
©h_hw
 *
ah
,

30 
©h9k_ch™√l
 *
ch™
,

31 
¨9002_ˇl_ty≥s
 
ˇl_ty≥
)

33 
boﬁ
 
suµ‹ãd
 = 
Ál£
;

34 
ah
->
suµ_ˇls
 & 
ˇl_ty≥
) {

35 
IQ_MISMATCH_CAL
:

36 
suµ‹ãd
 = 
åue
;

38 
ADC_GAIN_CAL
:

39 
ADC_DC_CAL
:

41 i‡(!((
	`IS_CHAN_2GHZ
(
ch™
Ë|| 
	`IS_CHAN_A_FAST_CLOCK
(
ah
, chan)) &&

42 
	`IS_CHAN_HT20
(
ch™
)))

43 
suµ‹ãd
 = 
åue
;

46  
suµ‹ãd
;

47 
	}
}

49 
	$¨9002_hw_£tup_ˇlibøti⁄
(
©h_hw
 *
ah
,

50 
©h9k_ˇl_li°
 *
cuºCÆ
)

52 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

54 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0),

55 
AR_PHY_TIMING_CTRL4_IQCAL_LOG_COUNT_MAX
,

56 
cuºCÆ
->
ˇlD©a
->
ˇlCou¡Max
);

58 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
) {

59 
IQ_MISMATCH_CAL
:

60 
	`REG_WRITE
(
ah
, 
AR_PHY_CALMODE
, 
AR_PHY_CALMODE_IQ
);

61 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

64 
ADC_GAIN_CAL
:

65 
	`REG_WRITE
(
ah
, 
AR_PHY_CALMODE
, 
AR_PHY_CALMODE_ADC_GAIN
);

66 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "starting ADC Gain Calibration\n");

68 
ADC_DC_CAL
:

69 
	`REG_WRITE
(
ah
, 
AR_PHY_CALMODE
, 
AR_PHY_CALMODE_ADC_DC_PER
);

70 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "starting ADC DC Calibration\n");

74 
	`REG_SET_BIT
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0),

75 
AR_PHY_TIMING_CTRL4_DO_CAL
);

76 
	}
}

78 
boﬁ
 
	$¨9002_hw_≥r_ˇlibøti⁄
(
©h_hw
 *
ah
,

79 
©h9k_ch™√l
 *
ich™
,

80 
u8
 
rxchaömask
,

81 
©h9k_ˇl_li°
 *
cuºCÆ
)

83 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

84 
boﬁ
 
isˇld⁄e
 = 
Ál£
;

86 i‡(
cuºCÆ
->
ˇlSèã
 =
CAL_RUNNING
) {

87 i‡(!(
	`REG_READ
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0)) &

88 
AR_PHY_TIMING_CTRL4_DO_CAL
)) {

90 
cuºCÆ
->
ˇlD©a
->
	`ˇlCﬁÀ˘
(
ah
);

91 
ah
->
ˇl_ßm∂es
++;

93 i‡(
ah
->
ˇl_ßm∂es
 >=

94 
cuºCÆ
->
ˇlD©a
->
ˇlNumSam∂es
) {

95 
i
, 
numChaös
 = 0;

96 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

97 i‡(
rxchaömask
 & (1 << 
i
))

98 
numChaös
++;

101 
cuºCÆ
->
ˇlD©a
->
	`ˇlPo°Proc
(
ah
, 
numChaös
);

102 
ˇld©a
->
CÆVÆid
 |
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
;

103 
cuºCÆ
->
ˇlSèã
 = 
CAL_DONE
;

104 
isˇld⁄e
 = 
åue
;

106 
	`¨9002_hw_£tup_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

109 } i‡(!(
ˇld©a
->
CÆVÆid
 & 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
)) {

110 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

113  
isˇld⁄e
;

114 
	}
}

116 
	$¨9002_hw_iqˇl_cﬁÀ˘
(
©h_hw
 *
ah
)

118 
i
;

120 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

121 
ah
->
tŸÆPowîMósI
[
i
] +=

122 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_0
(
i
));

123 
ah
->
tŸÆPowîMósQ
[
i
] +=

124 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_1
(
i
));

125 
ah
->
tŸÆIqC‹rMós
[
i
] +=

126 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_2
(
i
));

127 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

129 
ah
->
ˇl_ßm∂es
, 
i
,áh->
tŸÆPowîMósI
[i],

130 
ah
->
tŸÆPowîMósQ
[
i
],

131 
ah
->
tŸÆIqC‹rMós
[
i
]);

133 
	}
}

135 
	$¨9002_hw_adc_gaöˇl_cﬁÀ˘
(
©h_hw
 *
ah
)

137 
i
;

139 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

140 
ah
->
tŸÆAdcIOddPha£
[
i
] +=

141 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_0
(
i
));

142 
ah
->
tŸÆAdcIEvíPha£
[
i
] +=

143 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_1
(
i
));

144 
ah
->
tŸÆAdcQOddPha£
[
i
] +=

145 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_2
(
i
));

146 
ah
->
tŸÆAdcQEvíPha£
[
i
] +=

147 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_3
(
i
));

149 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

151 
ah
->
ˇl_ßm∂es
, 
i
,

152 
ah
->
tŸÆAdcIOddPha£
[
i
],

153 
ah
->
tŸÆAdcIEvíPha£
[
i
],

154 
ah
->
tŸÆAdcQOddPha£
[
i
],

155 
ah
->
tŸÆAdcQEvíPha£
[
i
]);

157 
	}
}

159 
	$¨9002_hw_adc_dcˇl_cﬁÀ˘
(
©h_hw
 *
ah
)

161 
i
;

163 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

164 
ah
->
tŸÆAdcDcOff£tIOddPha£
[
i
] +=

165 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_0
(
i
));

166 
ah
->
tŸÆAdcDcOff£tIEvíPha£
[
i
] +=

167 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_1
(
i
));

168 
ah
->
tŸÆAdcDcOff£tQOddPha£
[
i
] +=

169 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_2
(
i
));

170 
ah
->
tŸÆAdcDcOff£tQEvíPha£
[
i
] +=

171 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_3
(
i
));

173 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

175 
ah
->
ˇl_ßm∂es
, 
i
,

176 
ah
->
tŸÆAdcDcOff£tIOddPha£
[
i
],

177 
ah
->
tŸÆAdcDcOff£tIEvíPha£
[
i
],

178 
ah
->
tŸÆAdcDcOff£tQOddPha£
[
i
],

179 
ah
->
tŸÆAdcDcOff£tQEvíPha£
[
i
]);

181 
	}
}

183 
	$¨9002_hw_iqˇlibøã
(
©h_hw
 *
ah
, 
u8
 
numChaös
)

185 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

186 
u32
 
powîMósQ
, 
powîMósI
, 
iqC‹rMós
;

187 
u32
 
qCoffDíom
, 
iCoffDíom
;

188 
öt32_t
 
qCoff
, 
iCoff
;

189 
iqC‹rNeg
, 
i
;

191 
i
 = 0; i < 
numChaös
; i++) {

192 
powîMósI
 = 
ah
->
tŸÆPowîMósI
[
i
];

193 
powîMósQ
 = 
ah
->
tŸÆPowîMósQ
[
i
];

194 
iqC‹rMós
 = 
ah
->
tŸÆIqC‹rMós
[
i
];

196 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

198 
i
);

200 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

202 
i
, 
ah
->
tŸÆIqC‹rMós
[i]);

204 
iqC‹rNeg
 = 0;

206 i‡(
iqC‹rMós
 > 0x80000000) {

207 
iqC‹rMós
 = (0xffffffff - iqCorrMeas) + 1;

208 
iqC‹rNeg
 = 1;

211 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_i = 0x%08x\n",

212 
i
, 
powîMósI
);

213 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_q = 0x%08x\n",

214 
i
, 
powîMósQ
);

215 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "iqC‹rNeg i†0x%08x\n", 
iqC‹rNeg
);

217 
iCoffDíom
 = (
powîMósI
 / 2 + 
powîMósQ
 / 2) / 128;

218 
qCoffDíom
 = 
powîMósQ
 / 64;

220 i‡((
powîMósQ
 !0Ë&& (
iCoffDíom
 != 0) &&

221 (
qCoffDíom
 != 0)) {

222 
iCoff
 = 
iqC‹rMós
 / 
iCoffDíom
;

223 
qCoff
 = 
powîMósI
 / 
qCoffDíom
 - 64;

224 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %d iCoff = 0x%08x\n",

225 
i
, 
iCoff
);

226 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %d qCoff = 0x%08x\n",

227 
i
, 
qCoff
);

229 
iCoff
 = iCoff & 0x3f;

230 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

231 "New: Ch¿%d iCof‡0x%08x\n", 
i
, 
iCoff
);

232 i‡(
iqC‹rNeg
 == 0x0)

233 
iCoff
 = 0x40 - iCoff;

235 i‡(
qCoff
 > 15)

236 
qCoff
 = 15;

237 i‡(
qCoff
 <= -16)

238 
qCoff
 = -16;

240 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

242 
i
, 
iCoff
, 
qCoff
);

244 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(
i
),

245 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
,

246 
iCoff
);

247 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(
i
),

248 
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
,

249 
qCoff
);

250 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

252 
i
);

256 
	`REG_SET_BIT
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0),

257 
AR_PHY_TIMING_CTRL4_IQCORR_ENABLE
);

258 
	}
}

260 
	$¨9002_hw_adc_gaöˇl_ˇlibøã
(
©h_hw
 *
ah
, 
u8
 
numChaös
)

262 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

263 
u32
 
iOddMósOff£t
, 
iEvíMósOff£t
, 
qOddMósOff£t
, 
qEvíMósOff£t
;

264 
u32
 
qGaöMism©ch
, 
iGaöMism©ch
, 
vÆ
, 
i
;

266 
i
 = 0; i < 
numChaös
; i++) {

267 
iOddMósOff£t
 = 
ah
->
tŸÆAdcIOddPha£
[
i
];

268 
iEvíMósOff£t
 = 
ah
->
tŸÆAdcIEvíPha£
[
i
];

269 
qOddMósOff£t
 = 
ah
->
tŸÆAdcQOddPha£
[
i
];

270 
qEvíMósOff£t
 = 
ah
->
tŸÆAdcQEvíPha£
[
i
];

272 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

273 "Sèπög ADC Gaö CÆ f‹ Chaö %d\n", 
i
);

275 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_odd_i = 0x%08x\n",

276 
i
, 
iOddMósOff£t
);

277 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_even_i = 0x%08x\n",

278 
i
, 
iEvíMósOff£t
);

279 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_odd_q = 0x%08x\n",

280 
i
, 
qOddMósOff£t
);

281 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_even_q = 0x%08x\n",

282 
i
, 
qEvíMósOff£t
);

284 i‡(
iOddMósOff£t
 !0 && 
qEvíMósOff£t
 != 0) {

285 
iGaöMism©ch
 =

286 ((
iEvíMósOff£t
 * 32) /

287 
iOddMósOff£t
) & 0x3f;

288 
qGaöMism©ch
 =

289 ((
qOddMósOff£t
 * 32) /

290 
qEvíMósOff£t
) & 0x3f;

292 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

294 
i
, 
iGaöMism©ch
);

295 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

297 
i
, 
qGaöMism©ch
);

299 
vÆ
 = 
	`REG_READ
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(
i
));

300 
vÆ
 &= 0xfffff000;

301 
vÆ
 |(
qGaöMism©ch
Ë| (
iGaöMism©ch
 << 6);

302 
	`REG_WRITE
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(
i
), 
vÆ
);

304 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

305 "ADC Gaö CÆ d⁄êf‹ Chaö %d\n", 
i
);

309 
	`REG_WRITE
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(0),

310 
	`REG_READ
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(0)) |

311 
AR_PHY_NEW_ADC_GAIN_CORR_ENABLE
);

312 
	}
}

314 
	$¨9002_hw_adc_dcˇl_ˇlibøã
(
©h_hw
 *
ah
, 
u8
 
numChaös
)

316 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

317 
u32
 
iOddMósOff£t
, 
iEvíMósOff£t
, 
vÆ
, 
i
;

318 
öt32_t
 
qOddMósOff£t
, 
qEvíMósOff£t
, 
qDcMism©ch
, 
iDcMism©ch
;

319 c⁄° 
©h9k_≥rˇl_d©a
 *
ˇlD©a
 =

320 
ah
->
ˇl_li°_cuº
->
ˇlD©a
;

321 
u32
 
numSam∂es
 =

322 (1 << (
ˇlD©a
->
ˇlCou¡Max
 + 5)Ë* cÆD©a->
ˇlNumSam∂es
;

324 
i
 = 0; i < 
numChaös
; i++) {

325 
iOddMósOff£t
 = 
ah
->
tŸÆAdcDcOff£tIOddPha£
[
i
];

326 
iEvíMósOff£t
 = 
ah
->
tŸÆAdcDcOff£tIEvíPha£
[
i
];

327 
qOddMósOff£t
 = 
ah
->
tŸÆAdcDcOff£tQOddPha£
[
i
];

328 
qEvíMósOff£t
 = 
ah
->
tŸÆAdcDcOff£tQEvíPha£
[
i
];

330 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

331 "Sèπög ADC DC Off£àCÆ f‹ Chaö %d\n", 
i
);

333 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_odd_i = %d\n",

334 
i
, 
iOddMósOff£t
);

335 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_even_i = %d\n",

336 
i
, 
iEvíMósOff£t
);

337 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_odd_q = %d\n",

338 
i
, 
qOddMósOff£t
);

339 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_even_q = %d\n",

340 
i
, 
qEvíMósOff£t
);

342 
iDcMism©ch
 = (((
iEvíMósOff£t
 - 
iOddMósOff£t
) * 2) /

343 
numSam∂es
) & 0x1ff;

344 
qDcMism©ch
 = (((
qOddMósOff£t
 - 
qEvíMósOff£t
) * 2) /

345 
numSam∂es
) & 0x1ff;

347 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

349 
i
, 
iDcMism©ch
);

350 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

352 
i
, 
qDcMism©ch
);

354 
vÆ
 = 
	`REG_READ
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(
i
));

355 
vÆ
 &= 0xc0000fff;

356 
vÆ
 |(
qDcMism©ch
 << 12Ë| (
iDcMism©ch
 << 21);

357 
	`REG_WRITE
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(
i
), 
vÆ
);

359 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

360 "ADC DC Off£àCÆ d⁄êf‹ Chaö %d\n", 
i
);

363 
	`REG_WRITE
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(0),

364 
	`REG_READ
(
ah
, 
	`AR_PHY_NEW_ADC_DC_GAIN_CORR
(0)) |

365 
AR_PHY_NEW_ADC_DC_OFFSET_CORR_ENABLE
);

366 
	}
}

368 
	$¨9287_hw_ﬁc_ãmp_com≥nßti⁄
(
©h_hw
 *
ah
)

370 
u32
 
rdd©a
;

371 
öt32_t
 
dñè
, 
cuºPDADC
, 
¶›e
;

373 
rdd©a
 = 
	`REG_READ
(
ah
, 
AR_PHY_TX_PWRCTRL4
);

374 
cuºPDADC
 = 
	`MS
(
rdd©a
, 
AR_PHY_TX_PWRCTRL_PD_AVG_OUT
);

376 i‡(
ah
->
öôPDADC
 =0 || 
cuºPDADC
 == 0) {

384 
¶›e
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_TEMPSENSE_SLOPE
);

386 i‡(
¶›e
 == 0) {

387 
dñè
 = 0;

389 
dñè
 = ((
cuºPDADC
 - 
ah
->
öôPDADC
)*4Ë/ 
¶›e
;

391 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CH0_TX_PWRCTRL11
,

392 
AR_PHY_TX_PWRCTRL_OLPC_TEMP_COMP
, 
dñè
);

393 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CH1_TX_PWRCTRL11
,

394 
AR_PHY_TX_PWRCTRL_OLPC_TEMP_COMP
, 
dñè
);

396 
	}
}

398 
	$¨9280_hw_ﬁc_ãmp_com≥nßti⁄
(
©h_hw
 *
ah
)

400 
u32
 
rdd©a
, 
i
;

401 
dñè
, 
cuºPDADC
, 
ªgvÆ
;

403 
rdd©a
 = 
	`REG_READ
(
ah
, 
AR_PHY_TX_PWRCTRL4
);

404 
cuºPDADC
 = 
	`MS
(
rdd©a
, 
AR_PHY_TX_PWRCTRL_PD_AVG_OUT
);

406 i‡(
ah
->
öôPDADC
 =0 || 
cuºPDADC
 == 0)

409 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_DAC_HPWR_5G
))

410 
dñè
 = (
cuºPDADC
 - 
ah
->
öôPDADC
 + 4) / 8;

412 
dñè
 = (
cuºPDADC
 - 
ah
->
öôPDADC
 + 5) / 10;

414 i‡(
dñè
 !
ah
->
PDADCdñè
) {

415 
ah
->
PDADCdñè
 = 
dñè
;

416 
i
 = 1; i < 
AR9280_TX_GAIN_TABLE_SIZE
; i++) {

417 
ªgvÆ
 = 
ah
->
‹igöÆGaö
[
i
] - 
dñè
;

418 i‡(
ªgvÆ
 < 0)

419 
ªgvÆ
 = 0;

421 
	`REG_RMW_FIELD
(
ah
,

422 
AR_PHY_TX_GAIN_TBL1
 + 
i
 * 4,

423 
AR_PHY_TX_GAIN
, 
ªgvÆ
);

426 
	}
}

428 
	$¨9271_hw_∑_ˇl
(
©h_hw
 *
ah
, 
boﬁ
 
is_ª£t
)

430 
u32
 
ªgVÆ
;

431 
i
;

432 
u32
 
ªgLi°
[][2] = {

433 { 
AR9285_AN_TOP3
, 0 },

434 { 
AR9285_AN_RXTXBB1
, 0 },

435 { 
AR9285_AN_RF2G1
, 0 },

436 { 
AR9285_AN_RF2G2
, 0 },

437 { 
AR9285_AN_TOP2
, 0 },

438 { 
AR9285_AN_RF2G8
, 0 },

439 { 
AR9285_AN_RF2G7
, 0 },

440 { 
AR9285_AN_RF2G3
, 0 },

443 
	`REG_READ_ARRAY
(
ah
, 
ªgLi°
, 
	`ARRAY_SIZE
(regList));

445 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

447 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G6
, 1 << 0);

449 
	`REG_SET_BIT
(
ah
, 0x9808, 1 << 27);

451 
	`REG_SET_BIT
(
ah
, 
AR9285_AN_TOP3
, 
AR9285_AN_TOP3_PWDDAC
);

453 
	`REG_SET_BIT
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDRXTXBB1
);

455 
	`REG_SET_BIT
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDV2I
);

457 
	`REG_SET_BIT
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDDACIF
);

459 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G2
, 
AR9285_AN_RF2G2_OFFCAL
);

461 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G7
, 
AR9285_AN_RF2G7_PWDDB
);

463 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_ENPACAL
);

465 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPADRV1
);

467 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPADRV2
);

469 
	`REG_CLR_BIT
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPAOUT
);

471 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G8
, 
AR9285_AN_RF2G8_PADRVGN2TAB0
, 7);

476 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G7
, 
AR9285_AN_RF2G7_PADRVGN2TAB0
, 0);

478 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G3
, 
AR9271_AN_RF2G3_CCOMP
, 0xfff);

479 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

485 
	`REG_WRITE
(
ah
, 
AR9285_AN_TOP2
, 0xca0358a0);

486 
	`udñay
(30);

487 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G6
, 
AR9271_AN_RF2G6_OFFS
, 0);

490 
i
 = 6; i > 0; i--) {

491 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR9285_AN_RF2G6
);

492 
ªgVÆ
 |(1 << (20 + 
i
));

493 
	`REG_WRITE
(
ah
, 
AR9285_AN_RF2G6
, 
ªgVÆ
);

494 
	`udñay
(1);

496 
ªgVÆ
 &(~(0x1 << (20 + 
i
)));

497 
ªgVÆ
 |(
	`MS
(
	`REG_READ
(
ah
, 
AR9285_AN_RF2G9
),

498 
AR9285_AN_RXTXBB1_SPARE9
)

499 << (20 + 
i
));

500 
	`REG_WRITE
(
ah
, 
AR9285_AN_RF2G6
, 
ªgVÆ
);

503 
ªgVÆ
 = (regVal >> 20) & 0x7f;

506 i‡((!
is_ª£t
Ë&& (
ah
->
∑ˇl_öfo
.
¥ev_off£t
 =
ªgVÆ
)) {

507 i‡(
ah
->
∑ˇl_öfo
.
max_skùcou¡
 < 
MAX_PACAL_SKIPCOUNT
)

508 
ah
->
∑ˇl_öfo
.
max_skùcou¡
 =

509 2 * 
ah
->
∑ˇl_öfo
.
max_skùcou¡
;

510 
ah
->
∑ˇl_öfo
.
skùcou¡
 =áh->∑ˇl_öfo.
max_skùcou¡
;

512 
ah
->
∑ˇl_öfo
.
max_skùcou¡
 = 1;

513 
ah
->
∑ˇl_öfo
.
skùcou¡
 = 0;

514 
ah
->
∑ˇl_öfo
.
¥ev_off£t
 = 
ªgVÆ
;

518 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

520 
	`REG_SET_BIT
(
ah
, 
AR9285_AN_RF2G6
, 1 << 0);

522 
	`REG_CLR_BIT
(
ah
, 0x9808, 1 << 27);

523 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

525 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

526 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªgLi°
); i++)

527 
	`REG_WRITE
(
ah
, 
ªgLi°
[
i
][0],ÑegList[i][1]);

529 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

530 
	}
}

532 
ölöe
 
	$¨9285_hw_∑_ˇl
(
©h_hw
 *
ah
, 
boﬁ
 
is_ª£t
)

534 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

535 
u32
 
ªgVÆ
;

536 
i
, 
off£t
, 
offs_6_1
, 
offs_0
;

537 
u32
 
ccomp_‹g
, 
ªg_fõld
;

538 
u32
 
ªgLi°
[][2] = {

548 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Running PA Calibration\n");

551 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_TXGAIN_TYPE
) ==

552 
AR5416_EEP_TXGAIN_HIGH_POWER
)

555 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªgLi°
); i++)

556 
ªgLi°
[
i
][1] = 
	`REG_READ
(
ah
,ÑegList[i][0]);

558 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x7834);

559 
ªgVÆ
 &= (~(0x1));

560 
	`REG_WRITE
(
ah
, 0x7834, 
ªgVÆ
);

561 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x9808);

562 
ªgVÆ
 |= (0x1 << 27);

563 
	`REG_WRITE
(
ah
, 0x9808, 
ªgVÆ
);

565 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_TOP3
, 
AR9285_AN_TOP3_PWDDAC
, 1);

566 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDRXTXBB1
, 1);

567 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDV2I
, 1);

568 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RXTXBB1
, 
AR9285_AN_RXTXBB1_PDDACIF
, 1);

569 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G2
, 
AR9285_AN_RF2G2_OFFCAL
, 0);

570 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G7
, 
AR9285_AN_RF2G7_PWDDB
, 0);

571 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_ENPACAL
, 0);

572 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPADRV1
, 0);

573 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPADRV2
, 0);

574 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G1
, 
AR9285_AN_RF2G1_PDPAOUT
, 0);

575 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G8
, 
AR9285_AN_RF2G8_PADRVGN2TAB0
, 7);

576 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G7
, 
AR9285_AN_RF2G7_PADRVGN2TAB0
, 0);

577 
ccomp_‹g
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR9285_AN_RF2G6
), 
AR9285_AN_RF2G6_CCOMP
);

578 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G6
, 
AR9285_AN_RF2G6_CCOMP
, 0xf);

580 
	`REG_WRITE
(
ah
, 
AR9285_AN_TOP2
, 0xca0358a0);

581 
	`udñay
(30);

582 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G6
, 
AR9285_AN_RF2G6_OFFS
, 0);

583 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G3
, 
AR9285_AN_RF2G3_PDVCCOMP
, 0);

585 
i
 = 6; i > 0; i--) {

586 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x7834);

587 
ªgVÆ
 |(1 << (19 + 
i
));

588 
	`REG_WRITE
(
ah
, 0x7834, 
ªgVÆ
);

589 
	`udñay
(1);

590 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x7834);

591 
ªgVÆ
 &(~(0x1 << (19 + 
i
)));

592 
ªg_fõld
 = 
	`MS
(
	`REG_READ
(
ah
, 0x7840), 
AR9285_AN_RXTXBB1_SPARE9
);

593 
ªgVÆ
 |(
ªg_fõld
 << (19 + 
i
));

594 
	`REG_WRITE
(
ah
, 0x7834, 
ªgVÆ
);

597 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G3
, 
AR9285_AN_RF2G3_PDVCCOMP
, 1);

598 
	`udñay
(1);

599 
ªg_fõld
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR9285_AN_RF2G9
), 
AR9285_AN_RXTXBB1_SPARE9
);

600 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G3
, 
AR9285_AN_RF2G3_PDVCCOMP
, 
ªg_fõld
);

601 
offs_6_1
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR9285_AN_RF2G6
), 
AR9285_AN_RF2G6_OFFS
);

602 
offs_0
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR9285_AN_RF2G3
), 
AR9285_AN_RF2G3_PDVCCOMP
);

604 
off£t
 = (
offs_6_1
<<1Ë| 
offs_0
;

605 
off£t
 = offset - 0;

606 
offs_6_1
 = 
off£t
>>1;

607 
offs_0
 = 
off£t
 & 1;

609 i‡((!
is_ª£t
Ë&& (
ah
->
∑ˇl_öfo
.
¥ev_off£t
 =
off£t
)) {

610 i‡(
ah
->
∑ˇl_öfo
.
max_skùcou¡
 < 
MAX_PACAL_SKIPCOUNT
)

611 
ah
->
∑ˇl_öfo
.
max_skùcou¡
 =

612 2 * 
ah
->
∑ˇl_öfo
.
max_skùcou¡
;

613 
ah
->
∑ˇl_öfo
.
skùcou¡
 =áh->∑ˇl_öfo.
max_skùcou¡
;

615 
ah
->
∑ˇl_öfo
.
max_skùcou¡
 = 1;

616 
ah
->
∑ˇl_öfo
.
skùcou¡
 = 0;

617 
ah
->
∑ˇl_öfo
.
¥ev_off£t
 = 
off£t
;

620 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G6
, 
AR9285_AN_RF2G6_OFFS
, 
offs_6_1
);

621 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G3
, 
AR9285_AN_RF2G3_PDVCCOMP
, 
offs_0
);

623 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x7834);

624 
ªgVÆ
 |= 0x1;

625 
	`REG_WRITE
(
ah
, 0x7834, 
ªgVÆ
);

626 
ªgVÆ
 = 
	`REG_READ
(
ah
, 0x9808);

627 
ªgVÆ
 &= (~(0x1 << 27));

628 
	`REG_WRITE
(
ah
, 0x9808, 
ªgVÆ
);

630 
i
 = 0; i < 
	`ARRAY_SIZE
(
ªgLi°
); i++)

631 
	`REG_WRITE
(
ah
, 
ªgLi°
[
i
][0],ÑegList[i][1]);

633 
	`REG_RMW_FIELD
(
ah
, 
AR9285_AN_RF2G6
, 
AR9285_AN_RF2G6_CCOMP
, 
ccomp_‹g
);

634 
	}
}

636 
	$¨9002_hw_∑_ˇl
(
©h_hw
 *
ah
, 
boﬁ
 
is_ª£t
)

638 i‡(
	`AR_SREV_9271
(
ah
)) {

639 i‡(
is_ª£t
 || !
ah
->
∑ˇl_öfo
.
skùcou¡
)

640 
	`¨9271_hw_∑_ˇl
(
ah
, 
is_ª£t
);

642 
ah
->
∑ˇl_öfo
.
skùcou¡
--;

643 } i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
)) {

644 i‡(
is_ª£t
 || !
ah
->
∑ˇl_öfo
.
skùcou¡
)

645 
	`¨9285_hw_∑_ˇl
(
ah
, 
is_ª£t
);

647 
ah
->
∑ˇl_öfo
.
skùcou¡
--;

649 
	}
}

651 
	$¨9002_hw_ﬁc_ãmp_com≥nßti⁄
(
©h_hw
 *
ah
)

653 i‡(
OLC_FOR_AR9287_10_LATER
)

654 
	`¨9287_hw_ﬁc_ãmp_com≥nßti⁄
(
ah
);

655 i‡(
OLC_FOR_AR9280_20_LATER
)

656 
	`¨9280_hw_ﬁc_ãmp_com≥nßti⁄
(
ah
);

657 
	}
}

659 
	$¨9002_hw_ˇlibøã
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

660 
u8
 
rxchaömask
, 
boﬁ
 
l⁄gˇl
)

662 
©h9k_ˇl_li°
 *
cuºCÆ
 = 
ah
->
ˇl_li°_cuº
;

663 
boﬁ
 
nfˇl
, 
nfˇl_≥ndög
 = 
Ál£
, 
≥rˇl_≥ndög
;

664 
ªt
;

666 
nfˇl
 = !!(
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
Ë& 
AR_PHY_AGC_CONTROL_NF
);

667 i‡(
ah
->
ˇld©a
)

668 
nfˇl_≥ndög
 = 
	`ã°_bô
(
NFCAL_PENDING
, &
ah
->
ˇld©a
->
ˇl_Êags
);

670 
≥rˇl_≥ndög
 = (
cuºCÆ
 &&

671 (
cuºCÆ
->
ˇlSèã
 =
CAL_RUNNING
 ||

672 
cuºCÆ
->
ˇlSèã
 =
CAL_WAITING
));

674 i‡(
≥rˇl_≥ndög
 && !
nfˇl
) {

675 i‡(!
	`¨9002_hw_≥r_ˇlibøti⁄
(
ah
, 
ch™
, 
rxchaömask
, 
cuºCÆ
))

678 
ah
->
ˇl_li°_cuº
 = 
cuºCÆ
 = cuºCÆ->
ˇlNext
;

679 i‡(
cuºCÆ
->
ˇlSèã
 =
CAL_WAITING
) {

680 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

686 i‡(
l⁄gˇl
 || 
nfˇl_≥ndög
) {

691 i‡(
	`©h9k_hw_gënf
(
ah
, 
ch™
)) {

698 
ªt
 = 
	`©h9k_hw_lﬂdnf
(
ah
,áh->
curch™
);

699 i‡(
ªt
 < 0)

700  
ªt
;

703 i‡(
l⁄gˇl
) {

704 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
Ál£
);

706 
	`¨9002_hw_∑_ˇl
(
ah
, 
Ál£
);

707 
	`¨9002_hw_ﬁc_ãmp_com≥nßti⁄
(
ah
);

711  !
≥rˇl_≥ndög
;

712 
	}
}

715 
boﬁ
 
	$¨9285_hw_˛_ˇl
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

717 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

719 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_CL_CAL_ENABLE
);

720 i‡(
	`IS_CHAN_HT20
(
ch™
)) {

721 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_PARALLEL_CAL_ENABLE
);

722 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TURBO
, 
AR_PHY_FC_DYN2040_EN
);

723 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

724 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

725 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_CAL_ENABLE
);

726 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_CAL
);

727 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

728 
AR_PHY_AGC_CONTROL_CAL
, 0, 
AH_WAIT_TIMEOUT
)) {

729 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

731 
AH_WAIT_TIMEOUT
 / 1000);

732  
Ál£
;

734 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TURBO
, 
AR_PHY_FC_DYN2040_EN
);

735 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_PARALLEL_CAL_ENABLE
);

736 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_CL_CAL_ENABLE
);

738 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_ADC_CTL
, 
AR_PHY_ADC_CTL_OFF_PWDADC
);

739 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

740 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_CAL_ENABLE
);

741 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_CAL
);

742 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_CAL
,

743 0, 
AH_WAIT_TIMEOUT
)) {

744 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

746 
AH_WAIT_TIMEOUT
 / 1000);

747  
Ál£
;

750 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ADC_CTL
, 
AR_PHY_ADC_CTL_OFF_PWDADC
);

751 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_CL_CAL_ENABLE
);

752 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

754  
åue
;

755 
	}
}

757 
boﬁ
 
	$¨9285_hw_˛c
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

759 
i
;

760 
u_öt32_t
 
txgaö_max
;

761 
u_öt32_t
 
˛c_gaö
, 
gaö_mask
 = 0, 
˛c_num
 = 0;

762 
u_öt32_t
 
ªg_˛c_I0
, 
ªg_˛c_Q0
;

763 
u_öt32_t
 
i0_num
 = 0;

764 
u_öt32_t
 
q0_num
 = 0;

765 
u_öt32_t
 
tŸÆ_num
 = 0;

766 
u_öt32_t
 
ªg_rf2g5_‹g
;

767 
boﬁ
 
ªtv
 = 
åue
;

769 i‡(!(
	`¨9285_hw_˛_ˇl
(
ah
, 
ch™
)))

770  
Ál£
;

772 
txgaö_max
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_TX_PWRCTRL7
),

773 
AR_PHY_TX_PWRCTRL_TX_GAIN_TAB_MAX
);

775 
i
 = 0; i < (
txgaö_max
+1); i++) {

776 
˛c_gaö
 = (
	`REG_READ
(
ah
, (
AR_PHY_TX_GAIN_TBL1
+(
i
<<2))) &

777 
AR_PHY_TX_GAIN_CLC
Ë>> 
AR_PHY_TX_GAIN_CLC_S
;

778 i‡(!(
gaö_mask
 & (1 << 
˛c_gaö
))) {

779 
gaö_mask
 |(1 << 
˛c_gaö
);

780 
˛c_num
++;

784 
i
 = 0; i < 
˛c_num
; i++) {

785 
ªg_˛c_I0
 = (
	`REG_READ
(
ah
, (
AR_PHY_CLC_TBL1
 + (
i
 << 2)))

786 & 
AR_PHY_CLC_I0
Ë>> 
AR_PHY_CLC_I0_S
;

787 
ªg_˛c_Q0
 = (
	`REG_READ
(
ah
, (
AR_PHY_CLC_TBL1
 + (
i
 << 2)))

788 & 
AR_PHY_CLC_Q0
Ë>> 
AR_PHY_CLC_Q0_S
;

789 i‡(
ªg_˛c_I0
 == 0)

790 
i0_num
++;

792 i‡(
ªg_˛c_Q0
 == 0)

793 
q0_num
++;

795 
tŸÆ_num
 = 
i0_num
 + 
q0_num
;

796 i‡(
tŸÆ_num
 > 
AR9285_CLCAL_REDO_THRESH
) {

797 
ªg_rf2g5_‹g
 = 
	`REG_READ
(
ah
, 
AR9285_RF2G5
);

798 i‡(
	`AR_SREV_9285E_20
(
ah
)) {

799 
	`REG_WRITE
(
ah
, 
AR9285_RF2G5
,

800 (
ªg_rf2g5_‹g
 & 
AR9285_RF2G5_IC50TX
) |

801 
AR9285_RF2G5_IC50TX_XE_SET
);

803 
	`REG_WRITE
(
ah
, 
AR9285_RF2G5
,

804 (
ªg_rf2g5_‹g
 & 
AR9285_RF2G5_IC50TX
) |

805 
AR9285_RF2G5_IC50TX_SET
);

807 
ªtv
 = 
	`¨9285_hw_˛_ˇl
(
ah
, 
ch™
);

808 
	`REG_WRITE
(
ah
, 
AR9285_RF2G5
, 
ªg_rf2g5_‹g
);

810  
ªtv
;

811 
	}
}

813 
boﬁ
 
	$¨9002_hw_öô_ˇl
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

815 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

817 i‡(
	`AR_SREV_9271
(
ah
)) {

818 i‡(!
	`¨9285_hw_˛_ˇl
(
ah
, 
ch™
))

819  
Ál£
;

820 } i‡(
	`AR_SREV_9285
(
ah
Ë&& 
	`AR_SREV_9285_12_OR_LATER
(ah)) {

821 i‡(!
	`¨9285_hw_˛c
(
ah
, 
ch™
))

822  
Ál£
;

824 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

825 i‡(!
	`AR_SREV_9287_11_OR_LATER
(
ah
))

826 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_ADC_CTL
,

827 
AR_PHY_ADC_CTL_OFF_PWDADC
);

828 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

829 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

833 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
,

834 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
) |

835 
AR_PHY_AGC_CONTROL_CAL
);

838 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

839 
AR_PHY_AGC_CONTROL_CAL
,

840 0, 
AH_WAIT_TIMEOUT
)) {

841 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

843 
AH_WAIT_TIMEOUT
 / 1000);

844  
Ál£
;

847 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

848 i‡(!
	`AR_SREV_9287_11_OR_LATER
(
ah
))

849 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ADC_CTL
,

850 
AR_PHY_ADC_CTL_OFF_PWDADC
);

851 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

852 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

857 
	`¨9002_hw_∑_ˇl
(
ah
, 
åue
);

858 
	`©h9k_hw_lﬂdnf
(
ah
, 
ch™
);

859 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
åue
);

861 i‡(
ah
->
ˇld©a
)

862 
	`£t_bô
(
NFCAL_PENDING
, &
ah
->
ˇld©a
->
ˇl_Êags
);

864 
ah
->
ˇl_li°
 =áh->
ˇl_li°_œ°
 =áh->
ˇl_li°_cuº
 = 
NULL
;

867 i‡(
	`AR_SREV_9100
(
ah
Ë|| 
	`AR_SREV_9160_10_OR_LATER
(ah)) {

868 
ah
->
suµ_ˇls
 = 
IQ_MISMATCH_CAL
;

870 i‡(
	`AR_SREV_9160_10_OR_LATER
(
ah
))

871 
ah
->
suµ_ˇls
 |
ADC_GAIN_CAL
 | 
ADC_DC_CAL
;

873 i‡(
	`AR_SREV_9287
(
ah
))

874 
ah
->
suµ_ˇls
 &~
ADC_GAIN_CAL
;

876 i‡(
	`¨9002_hw_is_ˇl_suµ‹ãd
(
ah
, 
ch™
, 
ADC_GAIN_CAL
)) {

877 
	`INIT_CAL
(&
ah
->
adcgaö_ˇld©a
);

878 
	`INSERT_CAL
(
ah
, &ah->
adcgaö_ˇld©a
);

879 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

883 i‡(
	`¨9002_hw_is_ˇl_suµ‹ãd
(
ah
, 
ch™
, 
ADC_DC_CAL
)) {

884 
	`INIT_CAL
(&
ah
->
adcdc_ˇld©a
);

885 
	`INSERT_CAL
(
ah
, &ah->
adcdc_ˇld©a
);

886 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

890 i‡(
	`¨9002_hw_is_ˇl_suµ‹ãd
(
ah
, 
ch™
, 
IQ_MISMATCH_CAL
)) {

891 
	`INIT_CAL
(&
ah
->
iq_ˇld©a
);

892 
	`INSERT_CAL
(
ah
, &ah->
iq_ˇld©a
);

893 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "enabling IQ Calibration\n");

896 
ah
->
ˇl_li°_cuº
 =áh->
ˇl_li°
;

898 i‡(
ah
->
ˇl_li°_cuº
)

899 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
,áh->
ˇl_li°_cuº
);

902 i‡(
ah
->
ˇld©a
)

903 
ah
->
ˇld©a
->
CÆVÆid
 = 0;

905  
åue
;

906 
	}
}

908 c⁄° 
©h9k_≥rˇl_d©a
 
	giq_ˇl_mu…i_ßm∂e
 = {

909 
IQ_MISMATCH_CAL
,

910 
MAX_CAL_SAMPLES
,

911 
PER_MIN_LOG_COUNT
,

912 
¨9002_hw_iqˇl_cﬁÀ˘
,

913 
¨9002_hw_iqˇlibøã


915 c⁄° 
©h9k_≥rˇl_d©a
 
	giq_ˇl_sögÀ_ßm∂e
 = {

916 
IQ_MISMATCH_CAL
,

917 
MIN_CAL_SAMPLES
,

918 
PER_MAX_LOG_COUNT
,

919 
¨9002_hw_iqˇl_cﬁÀ˘
,

920 
¨9002_hw_iqˇlibøã


922 c⁄° 
©h9k_≥rˇl_d©a
 
	gadc_gaö_ˇl_mu…i_ßm∂e
 = {

923 
ADC_GAIN_CAL
,

924 
MAX_CAL_SAMPLES
,

925 
PER_MIN_LOG_COUNT
,

926 
¨9002_hw_adc_gaöˇl_cﬁÀ˘
,

927 
¨9002_hw_adc_gaöˇl_ˇlibøã


929 c⁄° 
©h9k_≥rˇl_d©a
 
	gadc_gaö_ˇl_sögÀ_ßm∂e
 = {

930 
ADC_GAIN_CAL
,

931 
MIN_CAL_SAMPLES
,

932 
PER_MAX_LOG_COUNT
,

933 
¨9002_hw_adc_gaöˇl_cﬁÀ˘
,

934 
¨9002_hw_adc_gaöˇl_ˇlibøã


936 c⁄° 
©h9k_≥rˇl_d©a
 
	gadc_dc_ˇl_mu…i_ßm∂e
 = {

937 
ADC_DC_CAL
,

938 
MAX_CAL_SAMPLES
,

939 
PER_MIN_LOG_COUNT
,

940 
¨9002_hw_adc_dcˇl_cﬁÀ˘
,

941 
¨9002_hw_adc_dcˇl_ˇlibøã


943 c⁄° 
©h9k_≥rˇl_d©a
 
	gadc_dc_ˇl_sögÀ_ßm∂e
 = {

944 
ADC_DC_CAL
,

945 
MIN_CAL_SAMPLES
,

946 
PER_MAX_LOG_COUNT
,

947 
¨9002_hw_adc_dcˇl_cﬁÀ˘
,

948 
¨9002_hw_adc_dcˇl_ˇlibøã


951 
	$¨9002_hw_öô_ˇl_£âögs
(
©h_hw
 *
ah
)

953 i‡(
	`AR_SREV_9100
(
ah
)) {

954 
ah
->
iq_ˇld©a
.
ˇlD©a
 = &
iq_ˇl_mu…i_ßm∂e
;

955 
ah
->
suµ_ˇls
 = 
IQ_MISMATCH_CAL
;

959 i‡(
	`AR_SREV_9160_10_OR_LATER
(
ah
)) {

960 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

961 
ah
->
iq_ˇld©a
.
ˇlD©a
 = &
iq_ˇl_sögÀ_ßm∂e
;

962 
ah
->
adcgaö_ˇld©a
.
ˇlD©a
 =

963 &
adc_gaö_ˇl_sögÀ_ßm∂e
;

964 
ah
->
adcdc_ˇld©a
.
ˇlD©a
 =

965 &
adc_dc_ˇl_sögÀ_ßm∂e
;

967 
ah
->
iq_ˇld©a
.
ˇlD©a
 = &
iq_ˇl_mu…i_ßm∂e
;

968 
ah
->
adcgaö_ˇld©a
.
ˇlD©a
 =

969 &
adc_gaö_ˇl_mu…i_ßm∂e
;

970 
ah
->
adcdc_ˇld©a
.
ˇlD©a
 =

971 &
adc_dc_ˇl_mu…i_ßm∂e
;

973 
ah
->
suµ_ˇls
 = 
ADC_GAIN_CAL
 | 
ADC_DC_CAL
 | 
IQ_MISMATCH_CAL
;

975 i‡(
	`AR_SREV_9287
(
ah
))

976 
ah
->
suµ_ˇls
 &~
ADC_GAIN_CAL
;

978 
	}
}

980 
	$¨9002_hw_©èch_ˇlib_›s
(
©h_hw
 *
ah
)

982 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

983 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

985 
¥iv_›s
->
öô_ˇl_£âögs
 = 
¨9002_hw_öô_ˇl_£âögs
;

986 
¥iv_›s
->
öô_ˇl
 = 
¨9002_hw_öô_ˇl
;

987 
¥iv_›s
->
£tup_ˇlibøti⁄
 = 
¨9002_hw_£tup_ˇlibøti⁄
;

989 
›s
->
ˇlibøã
 = 
¨9002_hw_ˇlibøã
;

990 
	}
}

	@ar9002_hw.c

17 
	~<löux/moduÀ∑øm.h
>

18 
	~"hw.h
"

19 
	~"¨5008_öôvÆs.h
"

20 
	~"¨9001_öôvÆs.h
"

21 
	~"¨9002_öôvÆs.h
"

22 
	~"¨9002_phy.h
"

26 
	$¨9002_hw_öô_mode_ªgs
(
©h_hw
 *
ah
)

28 i‡(
	`AR_SREV_9271
(
ah
)) {

29 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨9271Modes_9271
);

30 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨9271Comm⁄_9271
);

31 
	`INIT_INI_ARRAY
(&
ah
->
öiModes_9271_ANI_ªg
, 
¨9271Modes_9271_ANI_ªg
);

35 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

36 
¨9280PcõPhy_˛kªq_Æways_⁄_L1_9280
);

38 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
)) {

39 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨9287Modes_9287_1_1
);

40 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨9287Comm⁄_9287_1_1
);

41 } i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
)) {

42 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨9285Modes_9285_1_2
);

43 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨9285Comm⁄_9285_1_2
);

44 } i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

45 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨9280Modes_9280_2
);

46 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨9280Comm⁄_9280_2
);

48 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

49 
¨9280Modes_Á°_˛ock_9280_2
);

50 } i‡(
	`AR_SREV_9160_10_OR_LATER
(
ah
)) {

51 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨5416Modes_9160
);

52 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨5416Comm⁄_9160
);

53 i‡(
	`AR_SREV_9160_11
(
ah
)) {

54 
	`INIT_INI_ARRAY
(&
ah
->
öiAddac
,

55 
¨5416Addac_9160_1_1
);

57 
	`INIT_INI_ARRAY
(&
ah
->
öiAddac
, 
¨5416Addac_9160
);

59 } i‡(
	`AR_SREV_9100_OR_LATER
(
ah
)) {

60 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨5416Modes_9100
);

61 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨5416Comm⁄_9100
);

62 
	`INIT_INI_ARRAY
(&
ah
->
öiAddac
, 
¨5416Addac_9100
);

64 
	`INIT_INI_ARRAY
(&
ah
->
öiModes
, 
¨5416Modes
);

65 
	`INIT_INI_ARRAY
(&
ah
->
öiComm⁄
, 
¨5416Comm⁄
);

66 
	`INIT_INI_ARRAY
(&
ah
->
öiAddac
, 
¨5416Addac
);

69 i‡(!
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

71 
	`INIT_INI_ARRAY
(&
ah
->
öiBB_RfGaö
, 
¨5416BB_RfGaö
);

74 i‡(!
	`AR_SREV_5416
(
ah
))

75 
	`INIT_INI_ARRAY
(&
ah
->
öiB™k6
, 
¨5416B™k6TPC_9100
);

77 
	`INIT_INI_ARRAY
(&
ah
->
öiB™k6
, 
¨5416B™k6TPC
);

81 i‡(
	`AR_SREV_9160
(
ah
Ë|| !
	`AR_SREV_5416_22_OR_LATER
(ah)) {

82 
¨5416IniAºay
 *
addac
 = &
ah
->
öiAddac
;

83 
u32
 
size
 = (u32Ë* 
addac
->
ü_rows
 *áddac->
ü_cﬁumns
;

84 
u32
 *
d©a
;

86 
d©a
 = 
	`devm_kzÆloc
(
ah
->
dev
, 
size
, 
GFP_KERNEL
);

87 i‡(!
d©a
)

88  -
ENOMEM
;

90 
	`mem˝y
(
d©a
, 
addac
->
ü_¨øy
, 
size
);

91 
addac
->
ü_¨øy
 = 
d©a
;

93 i‡(!
	`AR_SREV_5416_22_OR_LATER
(
ah
)) {

95 
	`INI_RA
(
addac
, 31,1) = 0;

98 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
)) {

99 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúN‹mÆ
,

100 
¨9287Comm⁄_n‹mÆ_cck_fú_c€ff_9287_1_1
);

101 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

102 
¨9287Comm⁄_j≠™_2484_cck_fú_c€ff_9287_1_1
);

105 
	}
}

107 
	$¨9280_20_hw_öô_rxgaö_öi
(
©h_hw
 *
ah
)

109 
u32
 
rxgaö_ty≥
;

111 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_MINOR_REV
) >=

112 
AR5416_EEP_MINOR_VER_17
) {

113 
rxgaö_ty≥
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_RXGAIN_TYPE
);

115 i‡(
rxgaö_ty≥
 =
AR5416_EEP_RXGAIN_13DB_BACKOFF
)

116 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

117 
¨9280Modes_backoff_13db_rxgaö_9280_2
);

118 i‡(
rxgaö_ty≥
 =
AR5416_EEP_RXGAIN_23DB_BACKOFF
)

119 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

120 
¨9280Modes_backoff_23db_rxgaö_9280_2
);

122 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

123 
¨9280Modes_‹igöÆ_rxgaö_9280_2
);

125 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

126 
¨9280Modes_‹igöÆ_rxgaö_9280_2
);

128 
	}
}

130 
	$¨9280_20_hw_öô_txgaö_öi
(
©h_hw
 *
ah
, 
u32
 
txgaö_ty≥
)

132 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_MINOR_REV
) >=

133 
AR5416_EEP_MINOR_VER_19
) {

134 i‡(
txgaö_ty≥
 =
AR5416_EEP_TXGAIN_HIGH_POWER
)

135 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

136 
¨9280Modes_high_powî_tx_gaö_9280_2
);

138 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

139 
¨9280Modes_‹igöÆ_tx_gaö_9280_2
);

141 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

142 
¨9280Modes_‹igöÆ_tx_gaö_9280_2
);

144 
	}
}

146 
	$¨9271_hw_öô_txgaö_öi
(
©h_hw
 *
ah
, 
u32
 
txgaö_ty≥
)

148 i‡(
txgaö_ty≥
 =
AR5416_EEP_TXGAIN_HIGH_POWER
)

149 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

150 
¨9271Modes_high_powî_tx_gaö_9271
);

152 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

153 
¨9271Modes_n‹mÆ_powî_tx_gaö_9271
);

154 
	}
}

156 
	$¨9002_hw_öô_mode_gaö_ªgs
(
©h_hw
 *
ah
)

158 
u32
 
txgaö_ty≥
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_TXGAIN_TYPE
);

160 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
))

161 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

162 
¨9287Modes_rx_gaö_9287_1_1
);

163 i‡(
	`AR_SREV_9280_20
(
ah
))

164 
	`¨9280_20_hw_öô_rxgaö_öi
(
ah
);

166 i‡(
	`AR_SREV_9271
(
ah
)) {

167 
	`¨9271_hw_öô_txgaö_öi
(
ah
, 
txgaö_ty≥
);

168 } i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
)) {

169 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

170 
¨9287Modes_tx_gaö_9287_1_1
);

171 } i‡(
	`AR_SREV_9280_20
(
ah
)) {

172 
	`¨9280_20_hw_öô_txgaö_öi
(
ah
, 
txgaö_ty≥
);

173 } i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
)) {

175 i‡(
txgaö_ty≥
 =
AR5416_EEP_TXGAIN_HIGH_POWER
) {

176 i‡(
	`AR_SREV_9285E_20
(
ah
)) {

177 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

178 
¨9285Modes_XE2_0_high_powî
);

180 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

181 
¨9285Modes_high_powî_tx_gaö_9285_1_2
);

184 i‡(
	`AR_SREV_9285E_20
(
ah
)) {

185 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

186 
¨9285Modes_XE2_0_n‹mÆ_powî
);

188 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

189 
¨9285Modes_‹igöÆ_tx_gaö_9285_1_2
);

193 
	}
}

204 
	$¨9002_hw_c⁄figpcùowîßve
(
©h_hw
 *
ah
,

205 
boﬁ
 
powî_off
)

207 
u8
 
i
;

208 
u32
 
vÆ
;

211 i‡(!
powî_off
 ) {

212 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

218 
i
 = 0; i < 
ah
->
öiPcõSîdes
.
ü_rows
; i++) {

219 
	`REG_WRITE
(
ah
, 
	`INI_RA
(&ah->
öiPcõSîdes
, 
i
, 0),

220 
	`INI_RA
(&
ah
->
öiPcõSîdes
, 
i
, 1));

223 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

225 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x9248fc00);

226 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x24924924);

229 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x28000039);

230 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x53160824);

231 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0xe5980579);

237 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x001defff);

239 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x1aaabe40);

240 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0xbe105554);

241 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x000e3007);

244 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES2
, 0x00000000);

246 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

249 
	`udñay
(1000);

252 i‡(
powî_off
) {

254 
	`REG_CLR_BIT
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PCIE_PM_CTRL_ENA
);

256 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_WA
);

264 i‡(
ah
->
c⁄fig
.
pcõ_w´n
) {

265 i‡(
ah
->
c⁄fig
.
pcõ_w´n
 & 
AR_WA_D3_L1_DISABLE
)

266 
vÆ
 |
AR_WA_D3_L1_DISABLE
;

268 i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
◊hË|| 
	`AR_SREV_9287
(ah)) {

269 i‡(
AR9285_WA_DEFAULT
 & 
AR_WA_D3_L1_DISABLE
)

270 
vÆ
 |
AR_WA_D3_L1_DISABLE
;

271 } i‡(
	`AR_SREV_9280
(
ah
)) {

272 i‡(
AR9280_WA_DEFAULT
 & 
AR_WA_D3_L1_DISABLE
)

273 
vÆ
 |
AR_WA_D3_L1_DISABLE
;

277 i‡(
	`AR_SREV_9280
(
ah
Ë|| 
	`AR_SREV_9285
◊hË|| 
	`AR_SREV_9287
(ah)) {

282 
vÆ
 &~(
AR_WA_BIT6
 | 
AR_WA_BIT7
);

285 i‡(
	`AR_SREV_9280
(
ah
))

286 
vÆ
 |
AR_WA_BIT22
;

288 i‡(
	`AR_SREV_9285E_20
(
ah
))

289 
vÆ
 |
AR_WA_BIT23
;

291 
	`REG_WRITE
(
ah
, 
AR_WA
, 
vÆ
);

293 i‡(
ah
->
c⁄fig
.
pcõ_w´n
) {

294 
vÆ
 = 
ah
->
c⁄fig
.
pcõ_w´n
;

295 
vÆ
 &(~
AR_WA_D3_L1_DISABLE
);

297 i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
◊hË|| 
	`AR_SREV_9287
(ah)) {

298 
vÆ
 = 
AR9285_WA_DEFAULT
;

299 
vÆ
 &(~
AR_WA_D3_L1_DISABLE
);

300 } i‡(
	`AR_SREV_9280
(
ah
)) {

305 
vÆ
 = 
AR9280_WA_DEFAULT
;

306 
vÆ
 &(~
AR_WA_D3_L1_DISABLE
);

308 
vÆ
 = 
AR_WA_DEFAULT
;

313 i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9287
(ah))

314 
vÆ
 |(
AR_WA_BIT6
 | 
AR_WA_BIT7
);

316 i‡(
	`AR_SREV_9285E_20
(
ah
))

317 
vÆ
 |
AR_WA_BIT23
;

319 
	`REG_WRITE
(
ah
, 
AR_WA
, 
vÆ
);

322 
	`REG_SET_BIT
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PCIE_PM_CTRL_ENA
);

324 
	}
}

326 
	$¨9002_hw_gë_ødi‹ev
(
©h_hw
 *
ah
)

328 
u32
 
vÆ
;

329 
i
;

331 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

333 
	`REG_WRITE
(
ah
, 
	`AR_PHY
(0x36), 0x00007058);

334 
i
 = 0; i < 8; i++)

335 
	`REG_WRITE
(
ah
, 
	`AR_PHY
(0x20), 0x00010000);

337 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

339 
vÆ
 = (
	`REG_READ
(
ah
, 
	`AR_PHY
(256)) >> 24) & 0xff;

340 
vÆ
 = ((val & 0xf0) >> 4) | ((val & 0x0f) << 4);

342  
	`©h9k_hw_ªvî£_bôs
(
vÆ
, 8);

343 
	}
}

345 
	$¨9002_hw_rf_˛aim
(
©h_hw
 *
ah
)

347 
u32
 
vÆ
;

349 
	`REG_WRITE
(
ah
, 
	`AR_PHY
(0), 0x00000007);

351 
vÆ
 = 
	`¨9002_hw_gë_ødi‹ev
(
ah
);

352 
vÆ
 & 
AR_RADIO_SREV_MAJOR
) {

354 
vÆ
 = 
AR_RAD5133_SREV_MAJOR
;

356 
AR_RAD5133_SREV_MAJOR
:

357 
AR_RAD5122_SREV_MAJOR
:

358 
AR_RAD2133_SREV_MAJOR
:

359 
AR_RAD2122_SREV_MAJOR
:

362 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

364 
vÆ
 & 
AR_RADIO_SREV_MAJOR
);

365  -
EOPNOTSUPP
;

368 
ah
->
hw_vîsi⁄
.
™Æog5GhzRev
 = 
vÆ
;

371 
	}
}

373 
	$¨9002_hw_íabÀ_async_fifo
(
©h_hw
 *
ah
)

375 i‡(
	`AR_SREV_9287_13_OR_LATER
(
ah
)) {

376 
	`REG_SET_BIT
(
ah
, 
AR_MAC_PCU_ASYNC_FIFO_REG3
,

377 
AR_MAC_PCU_ASYNC_FIFO_REG3_DATAPATH_SEL
);

378 
	`REG_SET_BIT
(
ah
, 
AR_PHY_MODE
, 
AR_PHY_MODE_ASYNCFIFO
);

379 
	`REG_CLR_BIT
(
ah
, 
AR_MAC_PCU_ASYNC_FIFO_REG3
,

380 
AR_MAC_PCU_ASYNC_FIFO_REG3_SOFT_RESET
);

381 
	`REG_SET_BIT
(
ah
, 
AR_MAC_PCU_ASYNC_FIFO_REG3
,

382 
AR_MAC_PCU_ASYNC_FIFO_REG3_SOFT_RESET
);

384 
	}
}

386 
	$¨9002_hw_öô_h™g_checks
(
©h_hw
 *
ah
)

388 i‡(
	`AR_SREV_9100
(
ah
Ë|| 
	`AR_SREV_9160
(ah)) {

389 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_BB_RIFS_HANG
;

390 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_BB_DFS_HANG
;

393 i‡(
	`AR_SREV_9280
(
ah
))

394 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_BB_RX_CLEAR_STUCK_HANG
;

396 i‡(
	`AR_SREV_5416
(
ah
Ë|| 
	`AR_SREV_9100
◊hË|| 
	`AR_SREV_9160
(ah))

397 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_MAC_HANG
;

398 
	}
}

401 
	$¨9002_hw_©èch_›s
(
©h_hw
 *
ah
)

403 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

404 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

405 
ªt
;

407 
ªt
 = 
	`¨9002_hw_öô_mode_ªgs
(
ah
);

408 i‡(
ªt
)

409  
ªt
;

411 
¥iv_›s
->
öô_mode_gaö_ªgs
 = 
¨9002_hw_öô_mode_gaö_ªgs
;

412 
¥iv_›s
->
öô_h™g_checks
 = 
¨9002_hw_öô_h™g_checks
;

414 
›s
->
c⁄fig_pci_powîßve
 = 
¨9002_hw_c⁄figpcùowîßve
;

416 
ªt
 = 
	`¨5008_hw_©èch_phy_›s
(
ah
);

417 i‡(
ªt
)

418  
ªt
;

420 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

421 
	`¨9002_hw_©èch_phy_›s
(
ah
);

423 
	`¨9002_hw_©èch_ˇlib_›s
(
ah
);

424 
	`¨9002_hw_©èch_mac_›s
(
ah
);

426 
	}
}

428 
	$¨9002_hw_lﬂd_™i_ªg
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

430 
u32
 
modesIndex
;

431 
i
;

433 i‡(
	`IS_CHAN_5GHZ
(
ch™
))

434 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 2 : 1;

436 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 3 : 4;

438 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

440 
i
 = 0; i < 
ah
->
öiModes_9271_ANI_ªg
.
ü_rows
; i++) {

441 
u32
 
ªg
 = 
	`INI_RA
(&
ah
->
öiModes_9271_ANI_ªg
, 
i
, 0);

442 
u32
 
vÆ
 = 
	`INI_RA
(&
ah
->
öiModes_9271_ANI_ªg
, 
i
, 
modesIndex
);

443 
u32
 
vÆ_‹ig
;

445 i‡(
ªg
 =
AR_PHY_CCK_DETECT
) {

446 
vÆ_‹ig
 = 
	`REG_READ
(
ah
, 
ªg
);

447 
vÆ
 &
AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK
;

448 
vÆ_‹ig
 &~
AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK
;

450 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
|
vÆ_‹ig
);

452 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
);

455 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

456 
	}
}

	@ar9002_initvals.h

17 c⁄° 
u32
 
	g¨9280Modes_9280_2
[][5] = {

67 c⁄° 
u32
 
	g¨9280Comm⁄_9280_2
[][2] = {

411 c⁄° 
u32
 
	g¨9280Modes_Á°_˛ock_9280_2
[][3] = {

428 c⁄° 
u32
 
	g¨9280Modes_backoff_23db_rxgaö_9280_2
[][5] = {

562 c⁄° 
u32
 
	g¨9280Modes_‹igöÆ_rxgaö_9280_2
[][5] = {

696 c⁄° 
u32
 
	g¨9280Modes_backoff_13db_rxgaö_9280_2
[][5] = {

830 c⁄° 
u32
 
	g¨9280Modes_high_powî_tx_gaö_9280_2
[][5] = {

865 c⁄° 
u32
 
	g¨9280Modes_‹igöÆ_tx_gaö_9280_2
[][5] = {

900 c⁄° 
u32
 
	g¨9280PcõPhy_˛kªq_off_L1_9280
[][2] = {

914 c⁄° 
u32
 
	g¨9280PcõPhy_˛kªq_Æways_⁄_L1_9280
[][2] = {

928 c⁄° 
u32
 
	g¨9285Modes_9285_1_2
[][5] = {

1234 c⁄° 
u32
 
	g¨9285Comm⁄_9285_1_2
[][2] = {

1554 c⁄° 
u32
 
	g¨9285Modes_high_powî_tx_gaö_9285_1_2
[][5] = {

1595 c⁄° 
u32
 
	g¨9285Modes_‹igöÆ_tx_gaö_9285_1_2
[][5] = {

1636 c⁄° 
u32
 
	g¨9285Modes_XE2_0_n‹mÆ_powî
[][5] = {

1677 c⁄° 
u32
 
	g¨9285Modes_XE2_0_high_powî
[][5] = {

1718 c⁄° 
u32
 
	g¨9287Modes_9287_1_1
[][5] = {

1765 c⁄° 
u32
 
	g¨9287Comm⁄_9287_1_1
[][2] = {

2134 c⁄° 
u32
 
	g¨9287Comm⁄_n‹mÆ_cck_fú_c€ff_9287_1_1
[][2] = {

2141 c⁄° 
u32
 
	g¨9287Comm⁄_j≠™_2484_cck_fú_c€ff_9287_1_1
[][2] = {

2148 c⁄° 
u32
 
	g¨9287Modes_tx_gaö_9287_1_1
[][5] = {

2197 c⁄° 
u32
 
	g¨9287Modes_rx_gaö_9287_1_1
[][5] = {

2459 c⁄° 
u32
 
	g¨9271Modes_9271
[][5] = {

2766 c⁄° 
u32
 
	g¨9271Comm⁄_9271
[][2] = {

3095 c⁄° 
u32
 
	g¨9271Modes_9271_ANI_ªg
[][5] = {

3107 c⁄° 
u32
 
	g¨9271Modes_n‹mÆ_powî_tx_gaö_9271
[][5] = {

3144 c⁄° 
u32
 
	g¨9271Modes_high_powî_tx_gaö_9271
[][5] = {

	@ar9002_mac.c

17 
	~"hw.h
"

18 
	~<löux/exp‹t.h
>

20 
	#AR_BufLí
 0x00000fff

	)

22 
	$¨9002_hw_rx_íabÀ
(
©h_hw
 *
ah
)

24 
	`REG_WRITE
(
ah
, 
AR_CR
, 
AR_CR_RXE
);

25 
	}
}

27 
	$¨9002_hw_£t_desc_lök
(*
ds
, 
u32
 
ds_lök
)

29 ((
©h_desc
*Ë
ds
)->
ds_lök
 = ds_link;

30 
	}
}

32 
boﬁ
 
	$¨9002_hw_gë_i§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
,

33 
u32
 *
sync_ˇu£_p
)

35 
u32
 
i§
 = 0;

36 
u32
 
mask2
 = 0;

37 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

38 
u32
 
sync_ˇu£
 = 0;

39 
boﬁ
 
Áèl_öt
 = 
Ál£
;

40 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

42 i‡(!
	`AR_SREV_9100
(
ah
)) {

43 i‡(
	`REG_READ
(
ah
, 
AR_INTR_ASYNC_CAUSE
Ë& 
AR_INTR_MAC_IRQ
) {

44 i‡((
	`REG_READ
(
ah
, 
AR_RTC_STATUS
Ë& 
AR_RTC_STATUS_M
)

45 =
AR_RTC_STATUS_ON
) {

46 
i§
 = 
	`REG_READ
(
ah
, 
AR_ISR
);

50 
sync_ˇu£
 = 
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE
) &

51 
AR_INTR_SYNC_DEFAULT
;

53 *
masked
 = 0;

55 i‡(!
i§
 && !
sync_ˇu£
)

56  
Ál£
;

58 *
masked
 = 0;

59 
i§
 = 
	`REG_READ
(
ah
, 
AR_ISR
);

62 i‡(
i§
) {

63 i‡(
i§
 & 
AR_ISR_BCNMISC
) {

64 
u32
 
i§2
;

65 
i§2
 = 
	`REG_READ
(
ah
, 
AR_ISR_S2
);

66 i‡(
i§2
 & 
AR_ISR_S2_TIM
)

67 
mask2
 |
ATH9K_INT_TIM
;

68 i‡(
i§2
 & 
AR_ISR_S2_DTIM
)

69 
mask2
 |
ATH9K_INT_DTIM
;

70 i‡(
i§2
 & 
AR_ISR_S2_DTIMSYNC
)

71 
mask2
 |
ATH9K_INT_DTIMSYNC
;

72 i‡(
i§2
 & (
AR_ISR_S2_CABEND
))

73 
mask2
 |
ATH9K_INT_CABEND
;

74 i‡(
i§2
 & 
AR_ISR_S2_GTT
)

75 
mask2
 |
ATH9K_INT_GTT
;

76 i‡(
i§2
 & 
AR_ISR_S2_CST
)

77 
mask2
 |
ATH9K_INT_CST
;

78 i‡(
i§2
 & 
AR_ISR_S2_TSFOOR
)

79 
mask2
 |
ATH9K_INT_TSFOOR
;

81 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

82 
	`REG_WRITE
(
ah
, 
AR_ISR_S2
, 
i§2
);

83 
i§
 &~
AR_ISR_BCNMISC
;

87 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)

88 
i§
 = 
	`REG_READ
(
ah
, 
AR_ISR_RAC
);

90 i‡(
i§
 == 0xffffffff) {

91 *
masked
 = 0;

92  
Ál£
;

95 *
masked
 = 
i§
 & 
ATH9K_INT_COMMON
;

97 i‡(
i§
 & (
AR_ISR_RXMINTR
 | 
AR_ISR_RXINTM
 |

98 
AR_ISR_RXOK
 | 
AR_ISR_RXERR
))

99 *
masked
 |
ATH9K_INT_RX
;

101 i‡(
i§
 &

102 (
AR_ISR_TXOK
 | 
AR_ISR_TXDESC
 | 
AR_ISR_TXERR
 |

103 
AR_ISR_TXEOL
)) {

104 
u32
 
s0_s
, 
s1_s
;

106 *
masked
 |
ATH9K_INT_TX
;

108 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
) {

109 
s0_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S0_S
);

110 
s1_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S1_S
);

112 
s0_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S0
);

113 
	`REG_WRITE
(
ah
, 
AR_ISR_S0
, 
s0_s
);

114 
s1_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S1
);

115 
	`REG_WRITE
(
ah
, 
AR_ISR_S1
, 
s1_s
);

117 
i§
 &~(
AR_ISR_TXOK
 |

118 
AR_ISR_TXDESC
 |

119 
AR_ISR_TXERR
 |

120 
AR_ISR_TXEOL
);

123 
ah
->
öå_txqs
 |
	`MS
(
s0_s
, 
AR_ISR_S0_QCU_TXOK
);

124 
ah
->
öå_txqs
 |
	`MS
(
s0_s
, 
AR_ISR_S0_QCU_TXDESC
);

125 
ah
->
öå_txqs
 |
	`MS
(
s1_s
, 
AR_ISR_S1_QCU_TXERR
);

126 
ah
->
öå_txqs
 |
	`MS
(
s1_s
, 
AR_ISR_S1_QCU_TXEOL
);

129 i‡(
i§
 & 
AR_ISR_RXORN
) {

130 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
,

134 *
masked
 |
mask2
;

137 i‡(!
	`AR_SREV_9100
(
ah
Ë&& (
i§
 & 
AR_ISR_GENTMR
)) {

138 
u32
 
s5_s
;

140 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
) {

141 
s5_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S5_S
);

143 
s5_s
 = 
	`REG_READ
(
ah
, 
AR_ISR_S5
);

146 
ah
->
öå_gí_timî_åiggî
 =

147 
	`MS
(
s5_s
, 
AR_ISR_S5_GENTIMER_TRIG
);

149 
ah
->
öå_gí_timî_thªsh
 =

150 
	`MS
(
s5_s
, 
AR_ISR_S5_GENTIMER_THRESH
);

152 i‡(
ah
->
öå_gí_timî_åiggî
)

153 *
masked
 |
ATH9K_INT_GENTIMER
;

155 i‡((
s5_s
 & 
AR_ISR_S5_TIM_TIMER
) &&

156 !(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
))

157 *
masked
 |
ATH9K_INT_TIM_TIMER
;

159 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

160 
	`REG_WRITE
(
ah
, 
AR_ISR_S5
, 
s5_s
);

161 
i§
 &~
AR_ISR_GENTMR
;

165 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

166 
	`REG_WRITE
(
ah
, 
AR_ISR
, 
i§
);

167 
	`REG_READ
(
ah
, 
AR_ISR
);

170 i‡(
	`AR_SREV_9100
(
ah
))

171  
åue
;

173 i‡(
sync_ˇu£
) {

174 i‡(
sync_ˇu£_p
)

175 *
sync_ˇu£_p
 = 
sync_ˇu£
;

176 
Áèl_öt
 =

177 (
sync_ˇu£
 &

178 (
AR_INTR_SYNC_HOST1_FATAL
 | 
AR_INTR_SYNC_HOST1_PERR
))

179 ? 
åue
 : 
Ál£
;

181 i‡(
Áèl_öt
) {

182 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_FATAL
) {

183 
	`©h_dbg
(
comm⁄
, 
ANY
,

186 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_PERR
) {

187 
	`©h_dbg
(
comm⁄
, 
ANY
,

190 *
masked
 |
ATH9K_INT_FATAL
;

192 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_TIMEOUT
) {

193 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
,

195 
	`REG_WRITE
(
ah
, 
AR_RC
, 
AR_RC_HOSTIF
);

196 
	`REG_WRITE
(
ah
, 
AR_RC
, 0);

197 *
masked
 |
ATH9K_INT_FATAL
;

199 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_LOCAL_TIMEOUT
) {

200 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
,

204 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_CAUSE_CLR
, 
sync_ˇu£
);

205 (Ë
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE_CLR
);

208  
åue
;

209 
	}
}

212 
	$¨9002_£t_txdesc
(
©h_hw
 *
ah
, *
ds
, 
©h_tx_öfo
 *
i
)

214 
¨5416_desc
 *
ads
 = 
	`AR5416DESC
(
ds
);

215 
u32
 
˘l1
, 
˘l6
;

217 
ads
->
ds_tx°©us0
 =áds->
ds_tx°©us1
 = 0;

218 
ads
->
ds_tx°©us2
 =áds->
ds_tx°©us3
 = 0;

219 
ads
->
ds_tx°©us4
 =áds->
ds_tx°©us5
 = 0;

220 
ads
->
ds_tx°©us6
 =áds->
ds_tx°©us7
 = 0;

221 
ads
->
ds_tx°©us8
 =áds->
ds_tx°©us9
 = 0;

223 
	`ACCESS_ONCE
(
ads
->
ds_lök
Ë
i
->
lök
;

224 
	`ACCESS_ONCE
(
ads
->
ds_d©a
Ë
i
->
buf_addr
[0];

226 
˘l1
 = 
i
->
buf_Àn
[0] | (i->
is_œ°
 ? 0 : 
AR_TxM‹e
);

227 
˘l6
 = 
	`SM
(
i
->
keyty≥
, 
AR_En¸Ty≥
);

229 i‡(
	`AR_SREV_9285
(
ah
)) {

230 
ads
->
ds_˘l8
 = 0;

231 
ads
->
ds_˘l9
 = 0;

232 
ads
->
ds_˘l10
 = 0;

233 
ads
->
ds_˘l11
 = 0;

236 i‡((
i
->
is_fú°
 || i->
is_œ°
) &&

237 
i
->
aggr
 !
AGGR_BUF_MIDDLE
 && i->agg∏!
AGGR_BUF_LAST
) {

238 
	`ACCESS_ONCE
(
ads
->
ds_˘l2
Ë
	`£t11nTrõs
(
i
->
øãs
, 0)

239 | 
	`£t11nTrõs
(
i
->
øãs
, 1)

240 | 
	`£t11nTrõs
(
i
->
øãs
, 2)

241 | 
	`£t11nTrõs
(
i
->
øãs
, 3)

242 | (
i
->
dur_upd©e
 ? 
AR_DurUpd©eE«
 : 0)

243 | 
	`SM
(0, 
AR_Bur°Dur
);

245 
	`ACCESS_ONCE
(
ads
->
ds_˘l3
Ë
	`£t11nR©e
(
i
->
øãs
, 0)

246 | 
	`£t11nR©e
(
i
->
øãs
, 1)

247 | 
	`£t11nR©e
(
i
->
øãs
, 2)

248 | 
	`£t11nR©e
(
i
->
øãs
, 3);

250 
	`ACCESS_ONCE
(
ads
->
ds_˘l2
) = 0;

251 
	`ACCESS_ONCE
(
ads
->
ds_˘l3
) = 0;

254 i‡(!
i
->
is_fú°
) {

255 
	`ACCESS_ONCE
(
ads
->
ds_˘l0
) = 0;

256 
	`ACCESS_ONCE
(
ads
->
ds_˘l1
Ë
˘l1
;

257 
	`ACCESS_ONCE
(
ads
->
ds_˘l6
Ë
˘l6
;

261 
˘l1
 |(
i
->
keyix
 !
ATH9K_TXKEYIX_INVALID
 ? 
	`SM
(i->keyix, 
AR_De°Idx
) : 0)

262 | 
	`SM
(
i
->
ty≥
, 
AR_FømeTy≥
)

263 | (
i
->
Êags
 & 
ATH9K_TXDESC_NOACK
 ? 
AR_NoAck
 : 0)

264 | (
i
->
Êags
 & 
ATH9K_TXDESC_EXT_ONLY
 ? 
AR_ExtO∆y
 : 0)

265 | (
i
->
Êags
 & 
ATH9K_TXDESC_EXT_AND_CTL
 ? 
AR_ExtAndCé
 : 0);

267 
i
->
aggr
) {

268 
AGGR_BUF_FIRST
:

269 
˘l6
 |
	`SM
(
i
->
aggr_Àn
, 
AR_AggrLí
);

271 
AGGR_BUF_MIDDLE
:

272 
˘l1
 |
AR_IsAggr
 | 
AR_M‹eAggr
;

273 
˘l6
 |
	`SM
(
i
->
ndñim
, 
AR_PadDñim
);

275 
AGGR_BUF_LAST
:

276 
˘l1
 |
AR_IsAggr
;

278 
AGGR_BUF_NONE
:

282 
	`ACCESS_ONCE
(
ads
->
ds_˘l0
Ë(
i
->
pkt_Àn
 & 
AR_FømeLí
)

283 | (
i
->
Êags
 & 
ATH9K_TXDESC_VMF
 ? 
AR_VútM‹eFøg
 : 0)

284 | 
	`SM
(
i
->
txpowî
[0], 
AR_XmôPowî0
)

285 | (
i
->
Êags
 & 
ATH9K_TXDESC_VEOL
 ? 
AR_VEOL
 : 0)

286 | (
i
->
Êags
 & 
ATH9K_TXDESC_INTREQ
 ? 
AR_TxI¡rReq
 : 0)

287 | (
i
->
keyix
 !
ATH9K_TXKEYIX_INVALID
 ? 
AR_De°IdxVÆid
 : 0)

288 | (
i
->
Êags
 & 
ATH9K_TXDESC_CLRDMASK
 ? 
AR_CÃDe°Mask
 : 0)

289 | (
i
->
Êags
 & 
ATH9K_TXDESC_RTSENA
 ? 
AR_RTSE«bÀ
 :

290 (
i
->
Êags
 & 
ATH9K_TXDESC_CTSENA
 ? 
AR_CTSE«bÀ
 : 0));

292 
	`ACCESS_ONCE
(
ads
->
ds_˘l1
Ë
˘l1
;

293 
	`ACCESS_ONCE
(
ads
->
ds_˘l6
Ë
˘l6
;

295 i‡(
i
->
aggr
 =
AGGR_BUF_MIDDLE
 || i->agg∏=
AGGR_BUF_LAST
)

298 
	`ACCESS_ONCE
(
ads
->
ds_˘l4
Ë
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 0)

299 | 
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 1);

301 
	`ACCESS_ONCE
(
ads
->
ds_˘l5
Ë
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 2)

302 | 
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 3);

304 
	`ACCESS_ONCE
(
ads
->
ds_˘l7
Ë
	`£t11nR©eFœgs
(
i
->
øãs
, 0)

305 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 1)

306 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 2)

307 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 3)

308 | 
	`SM
(
i
->
πs˘s_øã
, 
AR_RTSCTSR©e
);

310 
	`ACCESS_ONCE
(
ads
->
ds_˘l9
Ë
	`SM
(
i
->
txpowî
[1], 
AR_XmôPowî1
);

311 
	`ACCESS_ONCE
(
ads
->
ds_˘l10
Ë
	`SM
(
i
->
txpowî
[2], 
AR_XmôPowî2
);

312 
	`ACCESS_ONCE
(
ads
->
ds_˘l11
Ë
	`SM
(
i
->
txpowî
[3], 
AR_XmôPowî3
);

313 
	}
}

315 
	$¨9002_hw_¥oc_txdesc
(
©h_hw
 *
ah
, *
ds
,

316 
©h_tx_°©us
 *
ts
)

318 
¨5416_desc
 *
ads
 = 
	`AR5416DESC
(
ds
);

319 
u32
 
°©us
;

321 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
ds_tx°©us9
);

322 i‡((
°©us
 & 
AR_TxD⁄e
) == 0)

323  -
EINPROGRESS
;

325 
ts
->
ts_t°amp
 = 
ads
->
AR_SídTime°amp
;

326 
ts
->
ts_°©us
 = 0;

327 
ts
->
ts_Êags
 = 0;

329 i‡(
°©us
 & 
AR_TxOpEx˚eded
)

330 
ts
->
ts_°©us
 |
ATH9K_TXERR_XTXOP
;

331 
ts
->
tid
 = 
	`MS
(
°©us
, 
AR_TxTid
);

332 
ts
->
ts_øãödex
 = 
	`MS
(
°©us
, 
AR_FöÆTxIdx
);

333 
ts
->
ts_£qnum
 = 
	`MS
(
°©us
, 
AR_SeqNum
);

335 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
ds_tx°©us0
);

336 
ts
->
ts_rssi_˘l0
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡00
);

337 
ts
->
ts_rssi_˘l1
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡01
);

338 
ts
->
ts_rssi_˘l2
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡02
);

339 i‡(
°©us
 & 
AR_TxBaSètus
) {

340 
ts
->
ts_Êags
 |
ATH9K_TX_BA
;

341 
ts
->
ba_low
 = 
ads
->
AR_BaBôm≠Low
;

342 
ts
->
ba_high
 = 
ads
->
AR_BaBôm≠High
;

345 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
ds_tx°©us1
);

346 i‡(
°©us
 & 
AR_FrmXmôOK
)

347 
ts
->
ts_°©us
 |
ATH9K_TX_ACKED
;

349 i‡(
°©us
 & 
AR_Ex˚ssiveRërõs
)

350 
ts
->
ts_°©us
 |
ATH9K_TXERR_XRETRY
;

351 i‡(
°©us
 & 
AR_Fûãªd
)

352 
ts
->
ts_°©us
 |
ATH9K_TXERR_FILT
;

353 i‡(
°©us
 & 
AR_FIFOUndîrun
) {

354 
ts
->
ts_°©us
 |
ATH9K_TXERR_FIFO
;

355 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

358 i‡(
°©us
 & 
AR_TxTimîExpúed
)

359 
ts
->
ts_°©us
 |
ATH9K_TXERR_TIMER_EXPIRED
;

360 i‡(
°©us
 & 
AR_DescCfgEº
)

361 
ts
->
ts_Êags
 |
ATH9K_TX_DESC_CFG_ERR
;

362 i‡(
°©us
 & 
AR_TxD©aUndîrun
) {

363 
ts
->
ts_Êags
 |
ATH9K_TX_DATA_UNDERRUN
;

364 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

366 i‡(
°©us
 & 
AR_TxDñimUndîrun
) {

367 
ts
->
ts_Êags
 |
ATH9K_TX_DELIM_UNDERRUN
;

368 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

370 
ts
->
ts_sh‹åëry
 = 
	`MS
(
°©us
, 
AR_RTSFaûC¡
);

371 
ts
->
ts_l⁄gªåy
 = 
	`MS
(
°©us
, 
AR_D©aFaûC¡
);

372 
ts
->
ts_vútcﬁ
 = 
	`MS
(
°©us
, 
AR_VútRëryC¡
);

374 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
ds_tx°©us5
);

375 
ts
->
ts_rssi
 = 
	`MS
(
°©us
, 
AR_TxRSSIComböed
);

376 
ts
->
ts_rssi_ext0
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡10
);

377 
ts
->
ts_rssi_ext1
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡11
);

378 
ts
->
ts_rssi_ext2
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡12
);

380 
ts
->
evm0
 = 
ads
->
AR_TxEVM0
;

381 
ts
->
evm1
 = 
ads
->
AR_TxEVM1
;

382 
ts
->
evm2
 = 
ads
->
AR_TxEVM2
;

385 
	}
}

387 
	$¨9002_hw_gë_duøti⁄
(
©h_hw
 *
ah
, c⁄° *
ds
, 
ödex
)

389 
¨5416_desc
 *
ads
 = 
	`AR5416DESC
(
ds
);

391 
ödex
) {

393  
	`MS
(
	`ACCESS_ONCE
(
ads
->
ds_˘l4
), 
AR_PackëDur0
);

395  
	`MS
(
	`ACCESS_ONCE
(
ads
->
ds_˘l4
), 
AR_PackëDur1
);

397  
	`MS
(
	`ACCESS_ONCE
(
ads
->
ds_˘l5
), 
AR_PackëDur2
);

399  
	`MS
(
	`ACCESS_ONCE
(
ads
->
ds_˘l5
), 
AR_PackëDur3
);

403 
	}
}

405 
	$©h9k_hw_£tu¥xdesc
(
©h_hw
 *
ah
, 
©h_desc
 *
ds
,

406 
u32
 
size
, u32 
Êags
)

408 
¨5416_desc
 *
ads
 = 
	`AR5416DESC
(
ds
);

410 
ads
->
ds_˘l1
 = 
size
 & 
AR_BufLí
;

411 i‡(
Êags
 & 
ATH9K_RXDESC_INTREQ
)

412 
ads
->
ds_˘l1
 |
AR_RxI¡rReq
;

414 
	`mem£t
(&
ads
->
u
.
rx
, 0, (ads->u.rx));

415 
	}
}

416 
EXPORT_SYMBOL
(
©h9k_hw_£tu¥xdesc
);

418 
	$¨9002_hw_©èch_mac_›s
(
©h_hw
 *
ah
)

420 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

422 
›s
->
rx_íabÀ
 = 
¨9002_hw_rx_íabÀ
;

423 
›s
->
£t_desc_lök
 = 
¨9002_hw_£t_desc_lök
;

424 
›s
->
gë_i§
 = 
¨9002_hw_gë_i§
;

425 
›s
->
£t_txdesc
 = 
¨9002_£t_txdesc
;

426 
›s
->
¥oc_txdesc
 = 
¨9002_hw_¥oc_txdesc
;

427 
›s
->
gë_duøti⁄
 = 
¨9002_hw_gë_duøti⁄
;

428 
	}
}

	@ar9002_phy.c

42 
	~"hw.h
"

43 
	~"¨9002_phy.h
"

66 
	$¨9002_hw_£t_ch™√l
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

68 
u16
 
bMode
, 
‰acMode
, 
aModeRefSñ
 = 0;

69 
u32
 
‰eq
, 
ndiv
, 
ch™√lSñ
 = 0, 
ch™√lFøc
 = 0, 
ªg32
 = 0;

70 
ch™_˚¡îs
 
˚¡îs
;

71 
u32
 
ªfDivA
 = 24;

73 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

74 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

76 
ªg32
 = 
	`REG_READ
(
ah
, 
AR_PHY_SYNTH_CONTROL
);

77 
ªg32
 &= 0xc0000000;

79 i‡(
‰eq
 < 4800) {

80 
u32
 
tx˘l
;

81 
ªgWrôes
 = 0;

83 
bMode
 = 1;

84 
‰acMode
 = 1;

85 
aModeRefSñ
 = 0;

86 
ch™√lSñ
 = 
	`CHANSEL_2G
(
‰eq
);

88 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
)) {

89 i‡(
‰eq
 == 2484) {

91 
	`REG_WRITE_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

92 1, 
ªgWrôes
);

94 
	`REG_WRITE_ARRAY
(&
ah
->
öiCckfúN‹mÆ
,

95 1, 
ªgWrôes
);

98 
tx˘l
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_TX_CTRL
);

99 i‡(
‰eq
 == 2484) {

101 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_TX_CTRL
,

102 
tx˘l
 | 
AR_PHY_CCK_TX_CTRL_JAPAN
);

104 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_TX_CTRL
,

105 
tx˘l
 & ~
AR_PHY_CCK_TX_CTRL_JAPAN
);

109 
bMode
 = 0;

110 
‰acMode
 = 0;

112 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_FRAC_N_5G
)) {

114 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
Ë|| 
	`IS_CHAN_QUARTER_RATE
(chan))

115 
aModeRefSñ
 = 0;

116 i‡((
‰eq
 % 20) == 0)

117 
aModeRefSñ
 = 3;

118 i‡((
‰eq
 % 10) == 0)

119 
aModeRefSñ
 = 2;

120 i‡(
aModeRefSñ
)

124 
aModeRefSñ
 = 0;

129 
‰acMode
 = 1;

130 
ªfDivA
 = 1;

131 
ch™√lSñ
 = 
	`CHANSEL_5G
(
‰eq
);

134 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_SYNTH9
,

135 
AR_AN_SYNTH9_REFDIVA
,

136 
AR_AN_SYNTH9_REFDIVA_S
, 
ªfDivA
);

140 i‡(!
‰acMode
) {

141 
ndiv
 = (
‰eq
 * (
ªfDivA
 >> 
aModeRefSñ
)) / 60;

142 
ch™√lSñ
 = 
ndiv
 & 0x1ff;

143 
ch™√lFøc
 = (
ndiv
 & 0xfffffe00) * 2;

144 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™√lFøc
;

148 
ªg32
 =Ñeg32 |

149 (
bMode
 << 29) |

150 (
‰acMode
 << 28Ë| (
aModeRefSñ
 << 26Ë| (
ch™√lSñ
);

152 
	`REG_WRITE
(
ah
, 
AR_PHY_SYNTH_CONTROL
, 
ªg32
);

154 
ah
->
curch™
 = 
ch™
;

157 
	}
}

167 
	$¨9002_hw_•ur_môig©e
(
©h_hw
 *
ah
,

168 
©h9k_ch™√l
 *
ch™
)

170 
bb_•ur
 = 
AR_NO_SPUR
;

171 
‰eq
;

172 
bö
;

173 
bb_•ur_off
, 
•ur_subch™√l_sd
;

174 
•ur_‰eq_sd
;

175 
•ur_dñè_pha£
;

176 
díomö©‹
;

177 
tmp
, 
√wVÆ
;

178 
i
;

179 
ch™_˚¡îs
 
˚¡îs
;

181 
öt8_t
 
mask_m
[123];

182 
öt8_t
 
mask_p
[123];

183 
cur_bb_•ur
;

184 
boﬁ
 
is2GHz
 = 
	`IS_CHAN_2GHZ
(
ch™
);

186 
	`mem£t
(&
mask_m
, 0, (
öt8_t
) * 123);

187 
	`mem£t
(&
mask_p
, 0, (
öt8_t
) * 123);

189 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

190 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

192 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
; i++) {

193 
cur_bb_•ur
 = 
ah
->
ìp_›s
->
	`gë_•ur_ch™√l
◊h, 
i
, 
is2GHz
);

195 i‡(
AR_NO_SPUR
 =
cur_bb_•ur
)

198 i‡(
is2GHz
)

199 
cur_bb_•ur
 = (cur_bb_•u∏/ 10Ë+ 
AR_BASE_FREQ_2GHZ
;

201 
cur_bb_•ur
 = (cur_bb_•u∏/ 10Ë+ 
AR_BASE_FREQ_5GHZ
;

203 
cur_bb_•ur
 = cur_bb_•u∏- 
‰eq
;

205 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

206 i‡((
cur_bb_•ur
 > -
AR_SPUR_FEEQ_BOUND_HT40
) &&

207 (
cur_bb_•ur
 < 
AR_SPUR_FEEQ_BOUND_HT40
)) {

208 
bb_•ur
 = 
cur_bb_•ur
;

211 } i‡((
cur_bb_•ur
 > -
AR_SPUR_FEEQ_BOUND_HT20
) &&

212 (
cur_bb_•ur
 < 
AR_SPUR_FEEQ_BOUND_HT20
)) {

213 
bb_•ur
 = 
cur_bb_•ur
;

218 i‡(
AR_NO_SPUR
 =
bb_•ur
) {

219 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_FORCE_CLKEN_CCK
,

220 
AR_PHY_FORCE_CLKEN_CCK_MRC_MUX
);

223 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_FORCE_CLKEN_CCK
,

224 
AR_PHY_FORCE_CLKEN_CCK_MRC_MUX
);

227 
bö
 = 
bb_•ur
 * 320;

229 
tmp
 = 
	`REG_READ
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0));

231 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

233 
√wVÆ
 = 
tmp
 | (
AR_PHY_TIMING_CTRL4_ENABLE_SPUR_RSSI
 |

234 
AR_PHY_TIMING_CTRL4_ENABLE_SPUR_FILTER
 |

235 
AR_PHY_TIMING_CTRL4_ENABLE_CHAN_MASK
 |

236 
AR_PHY_TIMING_CTRL4_ENABLE_PILOT_MASK
);

237 
	`REG_WRITE
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0), 
√wVÆ
);

239 
√wVÆ
 = (
AR_PHY_SPUR_REG_MASK_RATE_CNTL
 |

240 
AR_PHY_SPUR_REG_ENABLE_MASK_PPM
 |

241 
AR_PHY_SPUR_REG_MASK_RATE_SELECT
 |

242 
AR_PHY_SPUR_REG_ENABLE_VIT_SPUR_RSSI
 |

243 
	`SM
(
SPUR_RSSI_THRESH
, 
AR_PHY_SPUR_REG_SPUR_RSSI_THRESH
));

244 
	`REG_WRITE
(
ah
, 
AR_PHY_SPUR_REG
, 
√wVÆ
);

246 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

247 i‡(
bb_•ur
 < 0) {

248 
•ur_subch™√l_sd
 = 1;

249 
bb_•ur_off
 = 
bb_•ur
 + 10;

251 
•ur_subch™√l_sd
 = 0;

252 
bb_•ur_off
 = 
bb_•ur
 - 10;

255 
•ur_subch™√l_sd
 = 0;

256 
bb_•ur_off
 = 
bb_•ur
;

259 i‡(
	`IS_CHAN_HT40
(
ch™
))

260 
•ur_dñè_pha£
 =

261 ((
bb_•ur
 * 262144) /

262 10Ë& 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
;

264 
•ur_dñè_pha£
 =

265 ((
bb_•ur
 * 524288) /

266 10Ë& 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
;

268 
díomö©‹
 = 
	`IS_CHAN_2GHZ
(
ch™
) ? 44 : 40;

269 
•ur_‰eq_sd
 = ((
bb_•ur_off
 * 2048Ë/ 
díomö©‹
) & 0x3ff;

271 
√wVÆ
 = (
AR_PHY_TIMING11_USE_SPUR_IN_AGC
 |

272 
	`SM
(
•ur_‰eq_sd
, 
AR_PHY_TIMING11_SPUR_FREQ_SD
) |

273 
	`SM
(
•ur_dñè_pha£
, 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
));

274 
	`REG_WRITE
(
ah
, 
AR_PHY_TIMING11
, 
√wVÆ
);

276 
√wVÆ
 = 
•ur_subch™√l_sd
 << 
AR_PHY_SFCORR_SPUR_SUBCHNL_SD_S
;

277 
	`REG_WRITE
(
ah
, 
AR_PHY_SFCORR_EXT
, 
√wVÆ
);

279 
	`¨5008_hw_cmn_•ur_môig©e
(
ah
, 
ch™
, 
bö
);

281 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

282 
	}
}

284 
	$¨9002_ﬁc_öô
(
©h_hw
 *
ah
)

286 
u32
 
i
;

288 i‡(!
OLC_FOR_AR9280_20_LATER
)

291 i‡(
OLC_FOR_AR9287_10_LATER
) {

292 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TX_PWRCTRL9
,

293 
AR_PHY_TX_PWRCTRL9_RES_DC_REMOVAL
);

294 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR9287_AN_TXPC0
,

295 
AR9287_AN_TXPC0_TXPCMODE
,

296 
AR9287_AN_TXPC0_TXPCMODE_S
,

297 
AR9287_AN_TXPC0_TXPCMODE_TEMPSENSE
);

298 
	`udñay
(100);

300 
i
 = 0; i < 
AR9280_TX_GAIN_TABLE_SIZE
; i++)

301 
ah
->
‹igöÆGaö
[
i
] =

302 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_TX_GAIN_TBL1
 + 
i
 * 4),

303 
AR_PHY_TX_GAIN
);

304 
ah
->
PDADCdñè
 = 0;

306 
	}
}

308 
u32
 
	$¨9002_hw_compuã_∂l_c⁄åﬁ
(
©h_hw
 *
ah
,

309 
©h9k_ch™√l
 *
ch™
)

311 
ªf_div
 = 5;

312 
∂l_div
 = 0x2c;

313 
u32
 
∂l
;

315 i‡(
ch™
 && 
	`IS_CHAN_5GHZ
(ch™Ë&& !
	`IS_CHAN_A_FAST_CLOCK
(
ah
, chan)) {

316 i‡(
	`AR_SREV_9280_20
(
ah
)) {

317 
ªf_div
 = 10;

318 
∂l_div
 = 0x50;

320 
∂l_div
 = 0x28;

324 
∂l
 = 
	`SM
(
ªf_div
, 
AR_RTC_9160_PLL_REFDIV
);

325 
∂l
 |
	`SM
(
∂l_div
, 
AR_RTC_9160_PLL_DIV
);

327 i‡(
ch™
 && 
	`IS_CHAN_HALF_RATE
(chan))

328 
∂l
 |
	`SM
(0x1, 
AR_RTC_9160_PLL_CLKSEL
);

329 i‡(
ch™
 && 
	`IS_CHAN_QUARTER_RATE
(chan))

330 
∂l
 |
	`SM
(0x2, 
AR_RTC_9160_PLL_CLKSEL
);

332  
∂l
;

333 
	}
}

335 
	$¨9002_hw_do_gënf
(
©h_hw
 *
ah
,

336 
öt16_t
 
nÁºay
[
NUM_NF_READINGS
])

338 
öt16_t
 
nf
;

340 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CCA
), 
AR9280_PHY_MINCCA_PWR
);

341 
nÁºay
[0] = 
	`sign_exãnd32
(
nf
, 8);

343 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_EXT_CCA
), 
AR9280_PHY_EXT_MINCCA_PWR
);

344 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
))

345 
nÁºay
[3] = 
	`sign_exãnd32
(
nf
, 8);

347 i‡(!(
ah
->
rxchaömask
 & 
	`BIT
(1)))

350 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH1_CCA
), 
AR9280_PHY_CH1_MINCCA_PWR
);

351 
nÁºay
[1] = 
	`sign_exãnd32
(
nf
, 8);

353 
nf
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_CH1_EXT_CCA
), 
AR9280_PHY_CH1_EXT_MINCCA_PWR
);

354 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
))

355 
nÁºay
[4] = 
	`sign_exãnd32
(
nf
, 8);

356 
	}
}

358 
	$¨9002_hw_£t_nf_limôs
(
©h_hw
 *
ah
)

360 i‡(
	`AR_SREV_9285
(
ah
)) {

361 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9285_2GHZ
;

362 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9285_2GHZ
;

363 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9285_2GHZ
;

364 } i‡(
	`AR_SREV_9287
(
ah
)) {

365 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9287_2GHZ
;

366 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9287_2GHZ
;

367 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9287_2GHZ
;

368 } i‡(
	`AR_SREV_9271
(
ah
)) {

369 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9271_2GHZ
;

370 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9271_2GHZ
;

371 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9271_2GHZ
;

373 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9280_2GHZ
;

374 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9280_2GHZ
;

375 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9280_2GHZ
;

376 
ah
->
nf_5g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9280_5GHZ
;

377 
ah
->
nf_5g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9280_5GHZ
;

378 
ah
->
nf_5g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9280_5GHZ
;

380 
	}
}

382 
	$¨9002_hw_™tdiv_comb_c⁄f_gë
(
©h_hw
 *
ah
,

383 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

385 
u32
 
ªgvÆ
;

387 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

388 
™tc⁄f
->
maö_ a_c⁄f
 = (
ªgvÆ
 & 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
) >>

389 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF_S
;

390 
™tc⁄f
->
Æt_ a_c⁄f
 = (
ªgvÆ
 & 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
) >>

391 
AR_PHY_9285_ANT_DIV_ALT_LNACONF_S
;

392 
™tc⁄f
->
Á°_div_büs
 = (
ªgvÆ
 & 
AR_PHY_9285_FAST_DIV_BIAS
) >>

393 
AR_PHY_9285_FAST_DIV_BIAS_S
;

394 
™tc⁄f
->
 a1_ a2_swôch_dñè
 = -1;

395 
™tc⁄f
->
 a1_ a2_dñè
 = -3;

396 
™tc⁄f
->
div_group
 = 0;

397 
	}
}

399 
	$¨9002_hw_™tdiv_comb_c⁄f_£t
(
©h_hw
 *
ah
,

400 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

402 
u32
 
ªgvÆ
;

404 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

405 
ªgvÆ
 &~(
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
 |

406 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
 |

407 
AR_PHY_9285_FAST_DIV_BIAS
);

408 
ªgvÆ
 |((
™tc⁄f
->
maö_ a_c⁄f
 << 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF_S
)

409 & 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
);

410 
ªgvÆ
 |((
™tc⁄f
->
Æt_ a_c⁄f
 << 
AR_PHY_9285_ANT_DIV_ALT_LNACONF_S
)

411 & 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
);

412 
ªgvÆ
 |((
™tc⁄f
->
Á°_div_büs
 << 
AR_PHY_9285_FAST_DIV_BIAS_S
)

413 & 
AR_PHY_9285_FAST_DIV_BIAS
);

415 
	`REG_WRITE
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
, 
ªgvÆ
);

416 
	}
}

418 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


420 
	$¨9002_hw_£t_bt_™t_divîsôy
(
©h_hw
 *
ah
, 
boﬁ
 
íabÀ
)

422 
©h_btc€x_hw
 *
btc€x
 = &
ah
->
btc€x_hw
;

423 
u8
 
™tdiv_˘æ1
, 
™tdiv_˘æ2
;

424 
u32
 
ªgvÆ
;

426 i‡(
íabÀ
) {

427 
™tdiv_˘æ1
 = 
ATH_BT_COEX_ANTDIV_CONTROL1_ENABLE
;

428 
™tdiv_˘æ2
 = 
ATH_BT_COEX_ANTDIV_CONTROL2_ENABLE
;

433 
btc€x
->
bt_c€x_mode2
 &(~(
AR_BT_DISABLE_BT_ANT
));

434 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE2
, 
btc€x
->
bt_c€x_mode2
);

436 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_COM
, 
ATH_BT_COEX_ANT_DIV_SWITCH_COM
);

437 
	`REG_RMW
(
ah
, 
AR_PHY_SWITCH_CHAIN_0
, 0, 0xf0000000);

442 
™tdiv_˘æ1
 = 
ATH_BT_COEX_ANTDIV_CONTROL1_FIXED_A
;

443 
™tdiv_˘æ2
 = 
ATH_BT_COEX_ANTDIV_CONTROL2_FIXED_A
;

448 
btc€x
->
bt_c€x_mode2
 |
AR_BT_DISABLE_BT_ANT
;

449 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE2
, 
btc€x
->
bt_c€x_mode2
);

455 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_COM
, 0);

456 
	`REG_RMW
(
ah
, 
AR_PHY_SWITCH_CHAIN_0
, 0, 0xf0000000);

459 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

460 
ªgvÆ
 &(~(
AR_PHY_9285_ANT_DIV_CTL_ALL
));

465 
ªgvÆ
 &(~(
AR_PHY_9285_FAST_DIV_BIAS
));

466 
ªgvÆ
 |
	`SM
(
™tdiv_˘æ1
, 
AR_PHY_9285_ANT_DIV_CTL
);

467 
ªgvÆ
 |
	`SM
(
™tdiv_˘æ2
, 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
);

468 
ªgvÆ
 |
	`SM
((
™tdiv_˘æ2
 >> 2), 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
);

469 
ªgvÆ
 |
	`SM
((
™tdiv_˘æ1
 >> 1), 
AR_PHY_9285_ANT_DIV_ALT_GAINTB
);

470 
ªgvÆ
 |
	`SM
((
™tdiv_˘æ1
 >> 2), 
AR_PHY_9285_ANT_DIV_MAIN_GAINTB
);

471 
	`REG_WRITE
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
, 
ªgvÆ
);

473 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_DETECT
);

474 
ªgvÆ
 &(~
AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
);

475 
ªgvÆ
 |
	`SM
((
™tdiv_˘æ1
 >> 3), 
AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
);

476 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_DETECT
, 
ªgvÆ
);

477 
	}
}

481 
	$¨9002_hw_•e˘øl_sˇn_c⁄fig
(
©h_hw
 *
ah
,

482 
©h_•ec_sˇn
 *
∑øm
)

484 
u8
 
cou¡
;

486 i‡(!
∑øm
->
íabÀd
) {

487 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

488 
AR_PHY_SPECTRAL_SCAN_ENABLE
);

491 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RADAR_0
, 
AR_PHY_RADAR_0_FFT_ENA
);

492 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
, 
AR_PHY_SPECTRAL_SCAN_ENABLE
);

494 i‡(
∑øm
->
sh‹t_ª≥©
)

495 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

496 
AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
);

498 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

499 
AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
);

505 
cou¡
 = 
∑øm
->count;

506 i‡(
∑øm
->
ídÀss
) {

507 i‡(
	`AR_SREV_9271
(
ah
))

508 
cou¡
 = 0;

510 
cou¡
 = 0x80;

511 } i‡(
cou¡
 & 0x80)

512 
cou¡
 = 0x7f;

514 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

515 
AR_PHY_SPECTRAL_SCAN_COUNT
, 
cou¡
);

516 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

517 
AR_PHY_SPECTRAL_SCAN_PERIOD
, 
∑øm
->
≥riod
);

518 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

519 
AR_PHY_SPECTRAL_SCAN_FFT_PERIOD
, 
∑øm
->
f·_≥riod
);

522 
	}
}

524 
	$¨9002_hw_•e˘øl_sˇn_åiggî
(
©h_hw
 *
ah
)

526 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
, 
AR_PHY_SPECTRAL_SCAN_ENABLE
);

528 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

529 
AR_PHY_SPECTRAL_SCAN_ACTIVE
);

530 
	}
}

532 
	$¨9002_hw_•e˘øl_sˇn_waô
(
©h_hw
 *
ah
)

534 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

537 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

538 
AR_PHY_SPECTRAL_SCAN_ACTIVE
,

539 0, 
AH_WAIT_TIMEOUT
)) {

540 
	`©h_îr
(
comm⁄
, "spectral scan wait failed\n");

543 
	}
}

545 
	$¨9002_hw_tx99_°¨t
(
©h_hw
 *
ah
, 
u32
 
qnum
)

547 
	`REG_SET_BIT
(
ah
, 0x9864, 0x7f000);

548 
	`REG_SET_BIT
(
ah
, 0x9924, 0x7f00fe);

549 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

550 
	`REG_WRITE
(
ah
, 
AR_CR
, 
AR_CR_RXD
);

551 
	`REG_WRITE
(
ah
, 
	`AR_DLCL_IFS
(
qnum
), 0);

552 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_SIFS
, 20);

553 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_EIFS
, 20);

554 
	`REG_WRITE
(
ah
, 
AR_D_FPCTL
, 0x10|
qnum
);

555 
	`REG_WRITE
(
ah
, 
AR_TIME_OUT
, 0x00000400);

556 
	`REG_WRITE
(
ah
, 
	`AR_DRETRY_LIMIT
(
qnum
), 0xffffffff);

557 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
qnum
), 
AR_Q_MISC_DCU_EARLY_TERM_REQ
);

558 
	}
}

560 
	$¨9002_hw_tx99_°›
(
©h_hw
 *
ah
)

562 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

563 
	}
}

565 
	$¨9002_hw_©èch_phy_›s
(
©h_hw
 *
ah
)

567 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

568 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

570 
¥iv_›s
->
£t_rf_ªgs
 = 
NULL
;

571 
¥iv_›s
->
rf_£t_‰eq
 = 
¨9002_hw_£t_ch™√l
;

572 
¥iv_›s
->
•ur_môig©e_‰eq
 = 
¨9002_hw_•ur_môig©e
;

573 
¥iv_›s
->
ﬁc_öô
 = 
¨9002_ﬁc_öô
;

574 
¥iv_›s
->
compuã_∂l_c⁄åﬁ
 = 
¨9002_hw_compuã_∂l_c⁄åﬁ
;

575 
¥iv_›s
->
do_gënf
 = 
¨9002_hw_do_gënf
;

577 
›s
->
™tdiv_comb_c⁄f_gë
 = 
¨9002_hw_™tdiv_comb_c⁄f_gë
;

578 
›s
->
™tdiv_comb_c⁄f_£t
 = 
¨9002_hw_™tdiv_comb_c⁄f_£t
;

579 
›s
->
•e˘øl_sˇn_c⁄fig
 = 
¨9002_hw_•e˘øl_sˇn_c⁄fig
;

580 
›s
->
•e˘øl_sˇn_åiggî
 = 
¨9002_hw_•e˘øl_sˇn_åiggî
;

581 
›s
->
•e˘øl_sˇn_waô
 = 
¨9002_hw_•e˘øl_sˇn_waô
;

583 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


584 
›s
->
£t_bt_™t_divîsôy
 = 
¨9002_hw_£t_bt_™t_divîsôy
;

586 
›s
->
tx99_°¨t
 = 
¨9002_hw_tx99_°¨t
;

587 
›s
->
tx99_°›
 = 
¨9002_hw_tx99_°›
;

589 
	`¨9002_hw_£t_nf_limôs
(
ah
);

590 
	}
}

	@ar9002_phy.h

16 #i‚de‡
AR9002_PHY_H


17 
	#AR9002_PHY_H


	)

19 
	#AR_PHY_TEST
 0x9800

	)

20 
	#PHY_AGC_CLR
 0x10000000

	)

21 
	#RFSILENT_BB
 0x00002000

	)

23 
	#AR_PHY_TEST_BBB_OBS_SEL
 0x780000

	)

24 
	#AR_PHY_TEST_BBB_OBS_SEL_S
 19

	)

26 
	#AR_PHY_TEST_RX_OBS_SEL_BIT5_S
 23

	)

27 
	#AR_PHY_TEST_RX_OBS_SEL_BIT5
 (1 << 
AR_PHY_TEST_RX_OBS_SEL_BIT5_S
)

	)

29 
	#AR_PHY_TURBO
 0x9804

	)

30 
	#AR_PHY_FC_TURBO_MODE
 0x00000001

	)

31 
	#AR_PHY_FC_TURBO_SHORT
 0x00000002

	)

32 
	#AR_PHY_FC_DYN2040_EN
 0x00000004

	)

33 
	#AR_PHY_FC_DYN2040_PRI_ONLY
 0x00000008

	)

34 
	#AR_PHY_FC_DYN2040_PRI_CH
 0x00000010

	)

36 
	#AR_PHY_FC_DYN2040_EXT_CH
 0x00000020

	)

37 
	#AR_PHY_FC_HT_EN
 0x00000040

	)

38 
	#AR_PHY_FC_SHORT_GI_40
 0x00000080

	)

39 
	#AR_PHY_FC_WALSH
 0x00000100

	)

40 
	#AR_PHY_FC_SINGLE_HT_LTF1
 0x00000200

	)

41 
	#AR_PHY_FC_ENABLE_DAC_FIFO
 0x00000800

	)

43 
	#AR_PHY_TEST2
 0x9808

	)

45 
	#AR_PHY_TEST2_RX_OBS_SEL
 0x3C00

	)

46 
	#AR_PHY_TEST2_RX_OBS_SEL_S
 10

	)

48 
	#AR_PHY_TIMING2
 0x9810

	)

49 
	#AR_PHY_TIMING3
 0x9814

	)

50 
	#AR_PHY_TIMING3_DSC_MAN
 0xFFFE0000

	)

51 
	#AR_PHY_TIMING3_DSC_MAN_S
 17

	)

52 
	#AR_PHY_TIMING3_DSC_EXP
 0x0001E000

	)

53 
	#AR_PHY_TIMING3_DSC_EXP_S
 13

	)

55 
	#AR_PHY_CHIP_ID_REV_0
 0x80

	)

56 
	#AR_PHY_CHIP_ID_REV_1
 0x81

	)

57 
	#AR_PHY_CHIP_ID_9160_REV_0
 0xb0

	)

59 
	#AR_PHY_ACTIVE
 0x981C

	)

60 
	#AR_PHY_ACTIVE_EN
 0x00000001

	)

61 
	#AR_PHY_ACTIVE_DIS
 0x00000000

	)

63 
	#AR_PHY_RF_CTL2
 0x9824

	)

64 
	#AR_PHY_TX_END_DATA_START
 0x000000FF

	)

65 
	#AR_PHY_TX_END_DATA_START_S
 0

	)

66 
	#AR_PHY_TX_END_PA_ON
 0x0000FF00

	)

67 
	#AR_PHY_TX_END_PA_ON_S
 8

	)

69 
	#AR_PHY_RF_CTL3
 0x9828

	)

70 
	#AR_PHY_TX_END_TO_A2_RX_ON
 0x00FF0000

	)

71 
	#AR_PHY_TX_END_TO_A2_RX_ON_S
 16

	)

72 
	#AR_PHY_TX_END_TO_ADC_ON
 0xFF000000

	)

73 
	#AR_PHY_TX_END_TO_ADC_ON_S
 24

	)

75 
	#AR_PHY_ADC_CTL
 0x982C

	)

76 
	#AR_PHY_ADC_CTL_OFF_INBUFGAIN
 0x00000003

	)

77 
	#AR_PHY_ADC_CTL_OFF_INBUFGAIN_S
 0

	)

78 
	#AR_PHY_ADC_CTL_OFF_PWDDAC
 0x00002000

	)

79 
	#AR_PHY_ADC_CTL_OFF_PWDBANDGAP
 0x00004000

	)

80 
	#AR_PHY_ADC_CTL_OFF_PWDADC
 0x00008000

	)

81 
	#AR_PHY_ADC_CTL_ON_INBUFGAIN
 0x00030000

	)

82 
	#AR_PHY_ADC_CTL_ON_INBUFGAIN_S
 16

	)

84 
	#AR_PHY_ADC_SERIAL_CTL
 0x9830

	)

85 
	#AR_PHY_SEL_INTERNAL_ADDAC
 0x00000000

	)

86 
	#AR_PHY_SEL_EXTERNAL_RADIO
 0x00000001

	)

88 
	#AR_PHY_RF_CTL4
 0x9834

	)

89 
	#AR_PHY_RF_CTL4_TX_END_XPAB_OFF
 0xFF000000

	)

90 
	#AR_PHY_RF_CTL4_TX_END_XPAB_OFF_S
 24

	)

91 
	#AR_PHY_RF_CTL4_TX_END_XPAA_OFF
 0x00FF0000

	)

92 
	#AR_PHY_RF_CTL4_TX_END_XPAA_OFF_S
 16

	)

93 
	#AR_PHY_RF_CTL4_FRAME_XPAB_ON
 0x0000FF00

	)

94 
	#AR_PHY_RF_CTL4_FRAME_XPAB_ON_S
 8

	)

95 
	#AR_PHY_RF_CTL4_FRAME_XPAA_ON
 0x000000FF

	)

96 
	#AR_PHY_RF_CTL4_FRAME_XPAA_ON_S
 0

	)

98 
	#AR_PHY_TSTDAC_CONST
 0x983c

	)

100 
	#AR_PHY_SETTLING
 0x9844

	)

101 
	#AR_PHY_SETTLING_SWITCH
 0x00003F80

	)

102 
	#AR_PHY_SETTLING_SWITCH_S
 7

	)

104 
	#AR_PHY_RXGAIN
 0x9848

	)

105 
	#AR_PHY_RXGAIN_TXRX_ATTEN
 0x0003F000

	)

106 
	#AR_PHY_RXGAIN_TXRX_ATTEN_S
 12

	)

107 
	#AR_PHY_RXGAIN_TXRX_RF_MAX
 0x007C0000

	)

108 
	#AR_PHY_RXGAIN_TXRX_RF_MAX_S
 18

	)

109 
	#AR9280_PHY_RXGAIN_TXRX_ATTEN
 0x00003F80

	)

110 
	#AR9280_PHY_RXGAIN_TXRX_ATTEN_S
 7

	)

111 
	#AR9280_PHY_RXGAIN_TXRX_MARGIN
 0x001FC000

	)

112 
	#AR9280_PHY_RXGAIN_TXRX_MARGIN_S
 14

	)

114 
	#AR_PHY_DESIRED_SZ
 0x9850

	)

115 
	#AR_PHY_DESIRED_SZ_ADC
 0x000000FF

	)

116 
	#AR_PHY_DESIRED_SZ_ADC_S
 0

	)

117 
	#AR_PHY_DESIRED_SZ_PGA
 0x0000FF00

	)

118 
	#AR_PHY_DESIRED_SZ_PGA_S
 8

	)

119 
	#AR_PHY_DESIRED_SZ_TOT_DES
 0x0FF00000

	)

120 
	#AR_PHY_DESIRED_SZ_TOT_DES_S
 20

	)

122 
	#AR_PHY_FIND_SIG
 0x9858

	)

123 
	#AR_PHY_FIND_SIG_FIRSTEP
 0x0003F000

	)

124 
	#AR_PHY_FIND_SIG_FIRSTEP_S
 12

	)

125 
	#AR_PHY_FIND_SIG_FIRPWR
 0x03FC0000

	)

126 
	#AR_PHY_FIND_SIG_FIRPWR_S
 18

	)

128 
	#AR_PHY_FIND_SIG_LOW
 0x9840

	)

129 
	#AR_PHY_FIND_SIG_FIRSTEP_LOW
 0x00000FC0L

	)

130 
	#AR_PHY_FIND_SIG_FIRSTEP_LOW_S
 6

	)

132 
	#AR_PHY_AGC_CTL1
 0x985C

	)

133 
	#AR_PHY_AGC_CTL1_COARSE_LOW
 0x00007F80

	)

134 
	#AR_PHY_AGC_CTL1_COARSE_LOW_S
 7

	)

135 
	#AR_PHY_AGC_CTL1_COARSE_HIGH
 0x003F8000

	)

136 
	#AR_PHY_AGC_CTL1_COARSE_HIGH_S
 15

	)

138 
	#AR_PHY_CCA
 0x9864

	)

139 
	#AR_PHY_MINCCA_PWR
 0x0FF80000

	)

140 
	#AR_PHY_MINCCA_PWR_S
 19

	)

141 
	#AR_PHY_CCA_THRESH62
 0x0007F000

	)

142 
	#AR_PHY_CCA_THRESH62_S
 12

	)

143 
	#AR9280_PHY_MINCCA_PWR
 0x1FF00000

	)

144 
	#AR9280_PHY_MINCCA_PWR_S
 20

	)

145 
	#AR9280_PHY_CCA_THRESH62
 0x000FF000

	)

146 
	#AR9280_PHY_CCA_THRESH62_S
 12

	)

148 
	#AR_PHY_SFCORR_LOW
 0x986C

	)

149 
	#AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
 0x00000001

	)

150 
	#AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW
 0x00003F00

	)

151 
	#AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW_S
 8

	)

152 
	#AR_PHY_SFCORR_LOW_M1_THRESH_LOW
 0x001FC000

	)

153 
	#AR_PHY_SFCORR_LOW_M1_THRESH_LOW_S
 14

	)

154 
	#AR_PHY_SFCORR_LOW_M2_THRESH_LOW
 0x0FE00000

	)

155 
	#AR_PHY_SFCORR_LOW_M2_THRESH_LOW_S
 21

	)

157 
	#AR_PHY_SFCORR
 0x9868

	)

158 
	#AR_PHY_SFCORR_M2COUNT_THR
 0x0000001F

	)

159 
	#AR_PHY_SFCORR_M2COUNT_THR_S
 0

	)

160 
	#AR_PHY_SFCORR_M1_THRESH
 0x00FE0000

	)

161 
	#AR_PHY_SFCORR_M1_THRESH_S
 17

	)

162 
	#AR_PHY_SFCORR_M2_THRESH
 0x7F000000

	)

163 
	#AR_PHY_SFCORR_M2_THRESH_S
 24

	)

165 
	#AR_PHY_SLEEP_CTR_CONTROL
 0x9870

	)

166 
	#AR_PHY_SLEEP_CTR_LIMIT
 0x9874

	)

167 
	#AR_PHY_SYNTH_CONTROL
 0x9874

	)

168 
	#AR_PHY_SLEEP_SCAL
 0x9878

	)

170 
	#AR_PHY_PLL_CTL
 0x987c

	)

171 
	#AR_PHY_PLL_CTL_40
 0xØ

	)

172 
	#AR_PHY_PLL_CTL_40_5413
 0x04

	)

173 
	#AR_PHY_PLL_CTL_44
 0xab

	)

174 
	#AR_PHY_PLL_CTL_44_2133
 0xeb

	)

175 
	#AR_PHY_PLL_CTL_40_2133
 0xó

	)

177 
	#AR_PHY_SPECTRAL_SCAN
 0x9910

	)

178 
	#AR_PHY_SPECTRAL_SCAN_ENABLE
 0x1

	)

179 
	#AR_PHY_SPECTRAL_SCAN_ENA
 0x00000001

	)

180 
	#AR_PHY_SPECTRAL_SCAN_ENA_S
 0

	)

181 
	#AR_PHY_SPECTRAL_SCAN_ACTIVE
 0x00000002

	)

182 
	#AR_PHY_SPECTRAL_SCAN_ACTIVE_S
 1

	)

183 
	#AR_PHY_SPECTRAL_SCAN_FFT_PERIOD
 0x000000F0

	)

184 
	#AR_PHY_SPECTRAL_SCAN_FFT_PERIOD_S
 4

	)

185 
	#AR_PHY_SPECTRAL_SCAN_PERIOD
 0x0000FF00

	)

186 
	#AR_PHY_SPECTRAL_SCAN_PERIOD_S
 8

	)

187 
	#AR_PHY_SPECTRAL_SCAN_COUNT
 0x00FF0000

	)

188 
	#AR_PHY_SPECTRAL_SCAN_COUNT_S
 16

	)

189 
	#AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
 0x01000000

	)

190 
	#AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT_S
 24

	)

192 
	#AR_PHY_RX_DELAY
 0x9914

	)

193 
	#AR_PHY_SEARCH_START_DELAY
 0x9918

	)

194 
	#AR_PHY_RX_DELAY_DELAY
 0x00003FFF

	)

196 
	#AR_PHY_TIMING_CTRL4
(
_i
Ë(0x9920 + ((_iË<< 12))

	)

197 
	#AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
 0x01F

	)

198 
	#AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF_S
 0

	)

199 
	#AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
 0x7E0

	)

200 
	#AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF_S
 5

	)

201 
	#AR_PHY_TIMING_CTRL4_IQCORR_ENABLE
 0x800

	)

202 
	#AR_PHY_TIMING_CTRL4_IQCAL_LOG_COUNT_MAX
 0xF000

	)

203 
	#AR_PHY_TIMING_CTRL4_IQCAL_LOG_COUNT_MAX_S
 12

	)

204 
	#AR_PHY_TIMING_CTRL4_DO_CAL
 0x10000

	)

206 
	#AR_PHY_TIMING_CTRL4_ENABLE_SPUR_RSSI
 0x80000000

	)

207 
	#AR_PHY_TIMING_CTRL4_ENABLE_SPUR_FILTER
 0x40000000

	)

208 
	#AR_PHY_TIMING_CTRL4_ENABLE_CHAN_MASK
 0x20000000

	)

209 
	#AR_PHY_TIMING_CTRL4_ENABLE_PILOT_MASK
 0x10000000

	)

211 
	#AR_PHY_TIMING5
 0x9924

	)

212 
	#AR_PHY_TIMING5_CYCPWR_THR1
 0x000000FE

	)

213 
	#AR_PHY_TIMING5_CYCPWR_THR1_S
 1

	)

215 
	#AR_PHY_POWER_TX_RATE1
 0x9934

	)

216 
	#AR_PHY_POWER_TX_RATE2
 0x9938

	)

217 
	#AR_PHY_POWER_TX_RATE_MAX
 0x993c

	)

218 
	#AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
 0x00000040

	)

220 
	#AR_PHY_FRAME_CTL
 0x9944

	)

221 
	#AR_PHY_FRAME_CTL_TX_CLIP
 0x00000038

	)

222 
	#AR_PHY_FRAME_CTL_TX_CLIP_S
 3

	)

224 
	#AR_PHY_TXPWRADJ
 0x994C

	)

225 
	#AR_PHY_TXPWRADJ_CCK_GAIN_DELTA
 0x00000FC0

	)

226 
	#AR_PHY_TXPWRADJ_CCK_GAIN_DELTA_S
 6

	)

227 
	#AR_PHY_TXPWRADJ_CCK_PCDAC_INDEX
 0x00FC0000

	)

228 
	#AR_PHY_TXPWRADJ_CCK_PCDAC_INDEX_S
 18

	)

230 
	#AR_PHY_RADAR_EXT
 0x9940

	)

231 
	#AR_PHY_RADAR_EXT_ENA
 0x00004000

	)

233 
	#AR_PHY_RADAR_0
 0x9954

	)

234 
	#AR_PHY_RADAR_0_ENA
 0x00000001

	)

235 
	#AR_PHY_RADAR_0_FFT_ENA
 0x80000000

	)

236 
	#AR_PHY_RADAR_0_INBAND
 0x0000003e

	)

237 
	#AR_PHY_RADAR_0_INBAND_S
 1

	)

238 
	#AR_PHY_RADAR_0_PRSSI
 0x00000FC0

	)

239 
	#AR_PHY_RADAR_0_PRSSI_S
 6

	)

240 
	#AR_PHY_RADAR_0_HEIGHT
 0x0003F000

	)

241 
	#AR_PHY_RADAR_0_HEIGHT_S
 12

	)

242 
	#AR_PHY_RADAR_0_RRSSI
 0x00FC0000

	)

243 
	#AR_PHY_RADAR_0_RRSSI_S
 18

	)

244 
	#AR_PHY_RADAR_0_FIRPWR
 0x7F000000

	)

245 
	#AR_PHY_RADAR_0_FIRPWR_S
 24

	)

247 
	#AR_PHY_RADAR_1
 0x9958

	)

248 
	#AR_PHY_RADAR_1_RELPWR_ENA
 0x00800000

	)

249 
	#AR_PHY_RADAR_1_USE_FIR128
 0x00400000

	)

250 
	#AR_PHY_RADAR_1_RELPWR_THRESH
 0x003F0000

	)

251 
	#AR_PHY_RADAR_1_RELPWR_THRESH_S
 16

	)

252 
	#AR_PHY_RADAR_1_BLOCK_CHECK
 0x00008000

	)

253 
	#AR_PHY_RADAR_1_MAX_RRSSI
 0x00004000

	)

254 
	#AR_PHY_RADAR_1_RELSTEP_CHECK
 0x00002000

	)

255 
	#AR_PHY_RADAR_1_RELSTEP_THRESH
 0x00001F00

	)

256 
	#AR_PHY_RADAR_1_RELSTEP_THRESH_S
 8

	)

257 
	#AR_PHY_RADAR_1_MAXLEN
 0x000000FF

	)

258 
	#AR_PHY_RADAR_1_MAXLEN_S
 0

	)

260 
	#AR_PHY_SWITCH_CHAIN_0
 0x9960

	)

261 
	#AR_PHY_SWITCH_COM
 0x9964

	)

263 
	#AR_PHY_SIGMA_DELTA
 0x996C

	)

264 
	#AR_PHY_SIGMA_DELTA_ADC_SEL
 0x00000003

	)

265 
	#AR_PHY_SIGMA_DELTA_ADC_SEL_S
 0

	)

266 
	#AR_PHY_SIGMA_DELTA_FILT2
 0x000000F8

	)

267 
	#AR_PHY_SIGMA_DELTA_FILT2_S
 3

	)

268 
	#AR_PHY_SIGMA_DELTA_FILT1
 0x00001F00

	)

269 
	#AR_PHY_SIGMA_DELTA_FILT1_S
 8

	)

270 
	#AR_PHY_SIGMA_DELTA_ADC_CLIP
 0x01FFE000

	)

271 
	#AR_PHY_SIGMA_DELTA_ADC_CLIP_S
 13

	)

273 
	#AR_PHY_RESTART
 0x9970

	)

274 
	#AR_PHY_RESTART_DIV_GC
 0x001C0000

	)

275 
	#AR_PHY_RESTART_DIV_GC_S
 18

	)

277 
	#AR_PHY_RFBUS_REQ
 0x997C

	)

278 
	#AR_PHY_RFBUS_REQ_EN
 0x00000001

	)

280 
	#AR_PHY_TIMING7
 0x9980

	)

281 
	#AR_PHY_TIMING8
 0x9984

	)

282 
	#AR_PHY_TIMING8_PILOT_MASK_2
 0x000FFFFF

	)

283 
	#AR_PHY_TIMING8_PILOT_MASK_2_S
 0

	)

285 
	#AR_PHY_BIN_MASK2_1
 0x9988

	)

286 
	#AR_PHY_BIN_MASK2_2
 0x998c

	)

287 
	#AR_PHY_BIN_MASK2_3
 0x9990

	)

288 
	#AR_PHY_BIN_MASK2_4
 0x9994

	)

290 
	#AR_PHY_BIN_MASK_1
 0x9900

	)

291 
	#AR_PHY_BIN_MASK_2
 0x9904

	)

292 
	#AR_PHY_BIN_MASK_3
 0x9908

	)

294 
	#AR_PHY_MASK_CTL
 0x990c

	)

296 
	#AR_PHY_BIN_MASK2_4_MASK_4
 0x00003FFF

	)

297 
	#AR_PHY_BIN_MASK2_4_MASK_4_S
 0

	)

299 
	#AR_PHY_TIMING9
 0x9998

	)

300 
	#AR_PHY_TIMING10
 0x999c

	)

301 
	#AR_PHY_TIMING10_PILOT_MASK_2
 0x000FFFFF

	)

302 
	#AR_PHY_TIMING10_PILOT_MASK_2_S
 0

	)

304 
	#AR_PHY_TIMING11
 0x99a0

	)

305 
	#AR_PHY_TIMING11_SPUR_DELTA_PHASE
 0x000FFFFF

	)

306 
	#AR_PHY_TIMING11_SPUR_DELTA_PHASE_S
 0

	)

307 
	#AR_PHY_TIMING11_USE_SPUR_IN_AGC
 0x40000000

	)

308 
	#AR_PHY_TIMING11_USE_SPUR_IN_SELFCOR
 0x80000000

	)

310 
	#AR_PHY_RX_CHAINMASK
 0x99a4

	)

311 
	#AR_PHY_NEW_ADC_DC_GAIN_CORR
(
_i
Ë(0x99b4 + ((_iË<< 12))

	)

312 
	#AR_PHY_NEW_ADC_GAIN_CORR_ENABLE
 0x40000000

	)

313 
	#AR_PHY_NEW_ADC_DC_OFFSET_CORR_ENABLE
 0x80000000

	)

315 
	#AR_PHY_MULTICHAIN_GAIN_CTL
 0x99ac

	)

316 
	#AR_PHY_9285_FAST_DIV_BIAS
 0x00007E00

	)

317 
	#AR_PHY_9285_FAST_DIV_BIAS_S
 9

	)

318 
	#AR_PHY_9285_ANT_DIV_CTL_ALL
 0x7f000000

	)

319 
	#AR_PHY_9285_ANT_DIV_CTL
 0x01000000

	)

320 
	#AR_PHY_9285_ANT_DIV_CTL_S
 24

	)

321 
	#AR_PHY_9285_ANT_DIV_ALT_LNACONF
 0x06000000

	)

322 
	#AR_PHY_9285_ANT_DIV_ALT_LNACONF_S
 25

	)

323 
	#AR_PHY_9285_ANT_DIV_MAIN_LNACONF
 0x18000000

	)

324 
	#AR_PHY_9285_ANT_DIV_MAIN_LNACONF_S
 27

	)

325 
	#AR_PHY_9285_ANT_DIV_ALT_GAINTB
 0x20000000

	)

326 
	#AR_PHY_9285_ANT_DIV_ALT_GAINTB_S
 29

	)

327 
	#AR_PHY_9285_ANT_DIV_MAIN_GAINTB
 0x40000000

	)

328 
	#AR_PHY_9285_ANT_DIV_MAIN_GAINTB_S
 30

	)

329 
	#AR_PHY_9285_ANT_DIV_GAINTB_0
 0

	)

330 
	#AR_PHY_9285_ANT_DIV_GAINTB_1
 1

	)

332 
	#ATH_BT_COEX_ANTDIV_CONTROL1_ENABLE
 0x0b

	)

333 
	#ATH_BT_COEX_ANTDIV_CONTROL2_ENABLE
 0x09

	)

334 
	#ATH_BT_COEX_ANTDIV_CONTROL1_FIXED_A
 0x04

	)

335 
	#ATH_BT_COEX_ANTDIV_CONTROL2_FIXED_A
 0x09

	)

336 
	#ATH_BT_COEX_ANT_DIV_SWITCH_COM
 0x66666666

	)

338 
	#AR_PHY_EXT_CCA0
 0x99b8

	)

339 
	#AR_PHY_EXT_CCA0_THRESH62
 0x000000FF

	)

340 
	#AR_PHY_EXT_CCA0_THRESH62_S
 0

	)

342 
	#AR_PHY_EXT_CCA
 0x99bc

	)

343 
	#AR_PHY_EXT_CCA_CYCPWR_THR1
 0x0000FE00

	)

344 
	#AR_PHY_EXT_CCA_CYCPWR_THR1_S
 9

	)

345 
	#AR_PHY_EXT_CCA_THRESH62
 0x007F0000

	)

346 
	#AR_PHY_EXT_CCA_THRESH62_S
 16

	)

347 
	#AR_PHY_EXT_TIMING5_CYCPWR_THR1
 0x0000FE00L

	)

348 
	#AR_PHY_EXT_TIMING5_CYCPWR_THR1_S
 9

	)

350 
	#AR_PHY_EXT_MINCCA_PWR
 0xFF800000

	)

351 
	#AR_PHY_EXT_MINCCA_PWR_S
 23

	)

352 
	#AR9280_PHY_EXT_MINCCA_PWR
 0x01FF0000

	)

353 
	#AR9280_PHY_EXT_MINCCA_PWR_S
 16

	)

355 
	#AR_PHY_SFCORR_EXT
 0x99c0

	)

356 
	#AR_PHY_SFCORR_EXT_M1_THRESH
 0x0000007F

	)

357 
	#AR_PHY_SFCORR_EXT_M1_THRESH_S
 0

	)

358 
	#AR_PHY_SFCORR_EXT_M2_THRESH
 0x00003F80

	)

359 
	#AR_PHY_SFCORR_EXT_M2_THRESH_S
 7

	)

360 
	#AR_PHY_SFCORR_EXT_M1_THRESH_LOW
 0x001FC000

	)

361 
	#AR_PHY_SFCORR_EXT_M1_THRESH_LOW_S
 14

	)

362 
	#AR_PHY_SFCORR_EXT_M2_THRESH_LOW
 0x0FE00000

	)

363 
	#AR_PHY_SFCORR_EXT_M2_THRESH_LOW_S
 21

	)

364 
	#AR_PHY_SFCORR_SPUR_SUBCHNL_SD_S
 28

	)

366 
	#AR_PHY_HALFGI
 0x99D0

	)

367 
	#AR_PHY_HALFGI_DSC_MAN
 0x0007FFF0

	)

368 
	#AR_PHY_HALFGI_DSC_MAN_S
 4

	)

369 
	#AR_PHY_HALFGI_DSC_EXP
 0x0000000F

	)

370 
	#AR_PHY_HALFGI_DSC_EXP_S
 0

	)

372 
	#AR_PHY_CHAN_INFO_MEMORY
 0x99DC

	)

373 
	#AR_PHY_CHAN_INFO_MEMORY_CAPTURE_MASK
 0x0001

	)

375 
	#AR_PHY_HEAVY_CLIP_ENABLE
 0x99E0

	)

377 
	#AR_PHY_HEAVY_CLIP_FACTOR_RIFS
 0x99EC

	)

378 
	#AR_PHY_RIFS_INIT_DELAY
 0x03ff0000

	)

380 
	#AR_PHY_M_SLEEP
 0x99f0

	)

381 
	#AR_PHY_REFCLKDLY
 0x99f4

	)

382 
	#AR_PHY_REFCLKPD
 0x99f8

	)

384 
	#AR_PHY_CALMODE
 0x99f0

	)

386 
	#AR_PHY_CALMODE_IQ
 0x00000000

	)

387 
	#AR_PHY_CALMODE_ADC_GAIN
 0x00000001

	)

388 
	#AR_PHY_CALMODE_ADC_DC_PER
 0x00000002

	)

389 
	#AR_PHY_CALMODE_ADC_DC_INIT
 0x00000003

	)

391 
	#AR_PHY_CAL_MEAS_0
(
_i
Ë(0x9c10 + ((_iË<< 12))

	)

392 
	#AR_PHY_CAL_MEAS_1
(
_i
Ë(0x9c14 + ((_iË<< 12))

	)

393 
	#AR_PHY_CAL_MEAS_2
(
_i
Ë(0x9c18 + ((_iË<< 12))

	)

394 
	#AR_PHY_CAL_MEAS_3
(
_i
Ë(0x9c1¯+ ((_iË<< 12))

	)

396 
	#AR_PHY_CURRENT_RSSI
 0x9c1c

	)

397 
	#AR9280_PHY_CURRENT_RSSI
 0x9c3c

	)

399 
	#AR_PHY_RFBUS_GRANT
 0x9C20

	)

400 
	#AR_PHY_RFBUS_GRANT_EN
 0x00000001

	)

402 
	#AR_PHY_TST_ADC
 0x9C24

	)

404 
	#AR_PHY_CHAN_INFO_GAIN_DIFF
 0x9CF4

	)

405 
	#AR_PHY_CHAN_INFO_GAIN_DIFF_UPPER_LIMIT
 320

	)

407 
	#AR_PHY_CHAN_INFO_GAIN
 0x9CFC

	)

409 
	#AR_PHY_MODE
 0xA200

	)

410 
	#AR_PHY_MODE_ASYNCFIFO
 0x80

	)

411 
	#AR_PHY_MODE_AR2133
 0x08

	)

412 
	#AR_PHY_MODE_AR5111
 0x00

	)

413 
	#AR_PHY_MODE_AR5112
 0x08

	)

414 
	#AR_PHY_MODE_DYNAMIC
 0x04

	)

415 
	#AR_PHY_MODE_RF2GHZ
 0x02

	)

416 
	#AR_PHY_MODE_RF5GHZ
 0x00

	)

417 
	#AR_PHY_MODE_CCK
 0x01

	)

418 
	#AR_PHY_MODE_OFDM
 0x00

	)

419 
	#AR_PHY_MODE_DYN_CCK_DISABLE
 0x100

	)

421 
	#AR_PHY_CCK_TX_CTRL
 0xA204

	)

422 
	#AR_PHY_CCK_TX_CTRL_JAPAN
 0x00000010

	)

423 
	#AR_PHY_CCK_TX_CTRL_TX_DAC_SCALE_CCK
 0x0000000C

	)

424 
	#AR_PHY_CCK_TX_CTRL_TX_DAC_SCALE_CCK_S
 2

	)

426 
	#AR_PHY_CCK_DETECT
 0xA208

	)

427 
	#AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK
 0x0000003F

	)

428 
	#AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK_S
 0

	)

430 
	#AR_PHY_CCK_DETECT_ANT_SWITCH_TIME
 0x00001FC0

	)

431 
	#AR_PHY_CCK_DETECT_ANT_SWITCH_TIME_S
 6

	)

432 
	#AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
 0x2000

	)

433 
	#AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV_S
 13

	)

435 
	#AR_PHY_GAIN_2GHZ
 0xA20C

	)

436 
	#AR_PHY_GAIN_2GHZ_RXTX_MARGIN
 0x00FC0000

	)

437 
	#AR_PHY_GAIN_2GHZ_RXTX_MARGIN_S
 18

	)

438 
	#AR_PHY_GAIN_2GHZ_BSW_MARGIN
 0x00003C00

	)

439 
	#AR_PHY_GAIN_2GHZ_BSW_MARGIN_S
 10

	)

440 
	#AR_PHY_GAIN_2GHZ_BSW_ATTEN
 0x0000001F

	)

441 
	#AR_PHY_GAIN_2GHZ_BSW_ATTEN_S
 0

	)

443 
	#AR_PHY_GAIN_2GHZ_XATTEN2_MARGIN
 0x003E0000

	)

444 
	#AR_PHY_GAIN_2GHZ_XATTEN2_MARGIN_S
 17

	)

445 
	#AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN
 0x0001F000

	)

446 
	#AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN_S
 12

	)

447 
	#AR_PHY_GAIN_2GHZ_XATTEN2_DB
 0x00000FC0

	)

448 
	#AR_PHY_GAIN_2GHZ_XATTEN2_DB_S
 6

	)

449 
	#AR_PHY_GAIN_2GHZ_XATTEN1_DB
 0x0000003F

	)

450 
	#AR_PHY_GAIN_2GHZ_XATTEN1_DB_S
 0

	)

452 
	#AR_PHY_CCK_RXCTRL4
 0xA21C

	)

453 
	#AR_PHY_CCK_RXCTRL4_FREQ_EST_SHORT
 0x01F80000

	)

454 
	#AR_PHY_CCK_RXCTRL4_FREQ_EST_SHORT_S
 19

	)

456 
	#AR_PHY_DAG_CTRLCCK
 0xA228

	)

457 
	#AR_PHY_DAG_CTRLCCK_EN_RSSI_THR
 0x00000200

	)

458 
	#AR_PHY_DAG_CTRLCCK_RSSI_THR
 0x0001FC00

	)

459 
	#AR_PHY_DAG_CTRLCCK_RSSI_THR_S
 10

	)

461 
	#AR_PHY_FORCE_CLKEN_CCK
 0xA22C

	)

462 
	#AR_PHY_FORCE_CLKEN_CCK_MRC_MUX
 0x00000040

	)

464 
	#AR_PHY_POWER_TX_RATE3
 0xA234

	)

465 
	#AR_PHY_POWER_TX_RATE4
 0xA238

	)

467 
	#AR_PHY_SCRM_SEQ_XR
 0xA23C

	)

468 
	#AR_PHY_HEADER_DETECT_XR
 0xA240

	)

469 
	#AR_PHY_CHIRP_DETECTED_XR
 0xA244

	)

470 
	#AR_PHY_BLUETOOTH
 0xA254

	)

472 
	#AR_PHY_TPCRG1
 0xA258

	)

473 
	#AR_PHY_TPCRG1_NUM_PD_GAIN
 0x0000c000

	)

474 
	#AR_PHY_TPCRG1_NUM_PD_GAIN_S
 14

	)

476 
	#AR_PHY_TPCRG1_PD_GAIN_1
 0x00030000

	)

477 
	#AR_PHY_TPCRG1_PD_GAIN_1_S
 16

	)

478 
	#AR_PHY_TPCRG1_PD_GAIN_2
 0x000C0000

	)

479 
	#AR_PHY_TPCRG1_PD_GAIN_2_S
 18

	)

480 
	#AR_PHY_TPCRG1_PD_GAIN_3
 0x00300000

	)

481 
	#AR_PHY_TPCRG1_PD_GAIN_3_S
 20

	)

483 
	#AR_PHY_TPCRG1_PD_CAL_ENABLE
 0x00400000

	)

484 
	#AR_PHY_TPCRG1_PD_CAL_ENABLE_S
 22

	)

486 
	#AR_PHY_TX_PWRCTRL4
 0xa264

	)

487 
	#AR_PHY_TX_PWRCTRL_PD_AVG_VALID
 0x00000001

	)

488 
	#AR_PHY_TX_PWRCTRL_PD_AVG_VALID_S
 0

	)

489 
	#AR_PHY_TX_PWRCTRL_PD_AVG_OUT
 0x000001FE

	)

490 
	#AR_PHY_TX_PWRCTRL_PD_AVG_OUT_S
 1

	)

492 
	#AR_PHY_TX_PWRCTRL6_0
 0xa270

	)

493 
	#AR_PHY_TX_PWRCTRL6_1
 0xb270

	)

494 
	#AR_PHY_TX_PWRCTRL_ERR_EST_MODE
 0x03000000

	)

495 
	#AR_PHY_TX_PWRCTRL_ERR_EST_MODE_S
 24

	)

497 
	#AR_PHY_TX_PWRCTRL7
 0xa274

	)

498 
	#AR_PHY_TX_PWRCTRL_INIT_TX_GAIN
 0x01F80000

	)

499 
	#AR_PHY_TX_PWRCTRL_INIT_TX_GAIN_S
 19

	)

501 
	#AR_PHY_TX_PWRCTRL8
 0xa278

	)

503 
	#AR_PHY_TX_PWRCTRL9
 0xa27C

	)

505 
	#AR_PHY_TX_PWRCTRL10
 0xa394

	)

506 
	#AR_PHY_TX_DESIRED_SCALE_CCK
 0x00007C00

	)

507 
	#AR_PHY_TX_DESIRED_SCALE_CCK_S
 10

	)

508 
	#AR_PHY_TX_PWRCTRL9_RES_DC_REMOVAL
 0x80000000

	)

509 
	#AR_PHY_TX_PWRCTRL9_RES_DC_REMOVAL_S
 31

	)

511 
	#AR_PHY_TX_GAIN_TBL1
 0xa300

	)

512 
	#AR_PHY_TX_GAIN
 0x0007F000

	)

513 
	#AR_PHY_TX_GAIN_S
 12

	)

515 
	#AR_PHY_CH0_TX_PWRCTRL11
 0xa398

	)

516 
	#AR_PHY_CH1_TX_PWRCTRL11
 0xb398

	)

517 
	#AR_PHY_CH0_TX_PWRCTRL12
 0xa3dc

	)

518 
	#AR_PHY_CH0_TX_PWRCTRL13
 0xa3e0

	)

519 
	#AR_PHY_TX_PWRCTRL_OLPC_TEMP_COMP
 0x0000FC00

	)

520 
	#AR_PHY_TX_PWRCTRL_OLPC_TEMP_COMP_S
 10

	)

522 
	#AR_PHY_VIT_MASK2_M_46_61
 0xa3a0

	)

523 
	#AR_PHY_MASK2_M_31_45
 0xa3a4

	)

524 
	#AR_PHY_MASK2_M_16_30
 0xa3a8

	)

525 
	#AR_PHY_MASK2_M_00_15
 0xa3ac

	)

526 
	#AR_PHY_MASK2_P_15_01
 0xa3b8

	)

527 
	#AR_PHY_MASK2_P_30_16
 0xa3bc

	)

528 
	#AR_PHY_MASK2_P_45_31
 0xa3c0

	)

529 
	#AR_PHY_MASK2_P_61_45
 0xa3c4

	)

530 
	#AR_PHY_SPUR_REG
 0x994c

	)

532 
	#AR_PHY_SPUR_REG_MASK_RATE_CNTL
 (0xFF << 18)

	)

533 
	#AR_PHY_SPUR_REG_MASK_RATE_CNTL_S
 18

	)

535 
	#AR_PHY_SPUR_REG_ENABLE_MASK_PPM
 0x20000

	)

536 
	#AR_PHY_SPUR_REG_MASK_RATE_SELECT
 (0xFF << 9)

	)

537 
	#AR_PHY_SPUR_REG_MASK_RATE_SELECT_S
 9

	)

538 
	#AR_PHY_SPUR_REG_ENABLE_VIT_SPUR_RSSI
 0x100

	)

539 
	#AR_PHY_SPUR_REG_SPUR_RSSI_THRESH
 0x7F

	)

540 
	#AR_PHY_SPUR_REG_SPUR_RSSI_THRESH_S
 0

	)

542 
	#AR_PHY_PILOT_MASK_01_30
 0xa3b0

	)

543 
	#AR_PHY_PILOT_MASK_31_60
 0xa3b4

	)

545 
	#AR_PHY_CHANNEL_MASK_01_30
 0x99d4

	)

546 
	#AR_PHY_CHANNEL_MASK_31_60
 0x99d8

	)

548 
	#AR_PHY_ANALOG_SWAP
 0xa268

	)

549 
	#AR_PHY_SWAP_ALT_CHAIN
 0x00000040

	)

551 
	#AR_PHY_TPCRG5
 0xA26C

	)

552 
	#AR_PHY_TPCRG5_PD_GAIN_OVERLAP
 0x0000000F

	)

553 
	#AR_PHY_TPCRG5_PD_GAIN_OVERLAP_S
 0

	)

554 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1
 0x000003F0

	)

555 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1_S
 4

	)

556 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2
 0x0000FC00

	)

557 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2_S
 10

	)

558 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3
 0x003F0000

	)

559 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3_S
 16

	)

560 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4
 0x0FC00000

	)

561 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4_S
 22

	)

564 
	#AR_PHY_CL_CAL_CTL
 0xA358

	)

565 
	#AR_PHY_CL_CAL_ENABLE
 0x00000002

	)

566 
	#AR_PHY_PARALLEL_CAL_ENABLE
 0x00000001

	)

568 
	#AR_PHY_POWER_TX_RATE5
 0xA38C

	)

569 
	#AR_PHY_POWER_TX_RATE6
 0xA390

	)

571 
	#AR_PHY_CAL_CHAINMASK
 0xA39C

	)

573 
	#AR_PHY_POWER_TX_SUB
 0xA3C8

	)

574 
	#AR_PHY_POWER_TX_RATE7
 0xA3CC

	)

575 
	#AR_PHY_POWER_TX_RATE8
 0xA3D0

	)

576 
	#AR_PHY_POWER_TX_RATE9
 0xA3D4

	)

578 
	#AR_PHY_XPA_CFG
 0xA3D8

	)

579 
	#AR_PHY_FORCE_XPA_CFG
 0x000000001

	)

580 
	#AR_PHY_FORCE_XPA_CFG_S
 0

	)

582 
	#AR_PHY_CH1_CCA
 0xa864

	)

583 
	#AR_PHY_CH1_MINCCA_PWR
 0x0FF80000

	)

584 
	#AR_PHY_CH1_MINCCA_PWR_S
 19

	)

585 
	#AR9280_PHY_CH1_MINCCA_PWR
 0x1FF00000

	)

586 
	#AR9280_PHY_CH1_MINCCA_PWR_S
 20

	)

588 
	#AR_PHY_CH2_CCA
 0xb864

	)

589 
	#AR_PHY_CH2_MINCCA_PWR
 0x0FF80000

	)

590 
	#AR_PHY_CH2_MINCCA_PWR_S
 19

	)

592 
	#AR_PHY_CH1_EXT_CCA
 0xa9bc

	)

593 
	#AR_PHY_CH1_EXT_MINCCA_PWR
 0xFF800000

	)

594 
	#AR_PHY_CH1_EXT_MINCCA_PWR_S
 23

	)

595 
	#AR9280_PHY_CH1_EXT_MINCCA_PWR
 0x01FF0000

	)

596 
	#AR9280_PHY_CH1_EXT_MINCCA_PWR_S
 16

	)

598 
	#AR_PHY_CH2_EXT_CCA
 0xb9bc

	)

599 
	#AR_PHY_CH2_EXT_MINCCA_PWR
 0xFF800000

	)

600 
	#AR_PHY_CH2_EXT_MINCCA_PWR_S
 23

	)

602 
	#AR_PHY_CCA_NOM_VAL_5416_2GHZ
 -90

	)

603 
	#AR_PHY_CCA_NOM_VAL_5416_5GHZ
 -100

	)

604 
	#AR_PHY_CCA_MIN_GOOD_VAL_5416_2GHZ
 -100

	)

605 
	#AR_PHY_CCA_MIN_GOOD_VAL_5416_5GHZ
 -110

	)

606 
	#AR_PHY_CCA_MAX_GOOD_VAL_5416_2GHZ
 -80

	)

607 
	#AR_PHY_CCA_MAX_GOOD_VAL_5416_5GHZ
 -90

	)

609 
	#AR_PHY_CCA_NOM_VAL_9280_2GHZ
 -112

	)

610 
	#AR_PHY_CCA_NOM_VAL_9280_5GHZ
 -112

	)

611 
	#AR_PHY_CCA_MIN_GOOD_VAL_9280_2GHZ
 -127

	)

612 
	#AR_PHY_CCA_MIN_GOOD_VAL_9280_5GHZ
 -122

	)

613 
	#AR_PHY_CCA_MAX_GOOD_VAL_9280_2GHZ
 -97

	)

614 
	#AR_PHY_CCA_MAX_GOOD_VAL_9280_5GHZ
 -102

	)

616 
	#AR_PHY_CCA_NOM_VAL_9285_2GHZ
 -118

	)

617 
	#AR_PHY_CCA_MIN_GOOD_VAL_9285_2GHZ
 -127

	)

618 
	#AR_PHY_CCA_MAX_GOOD_VAL_9285_2GHZ
 -108

	)

620 
	#AR_PHY_CCA_NOM_VAL_9271_2GHZ
 -118

	)

621 
	#AR_PHY_CCA_MIN_GOOD_VAL_9271_2GHZ
 -127

	)

622 
	#AR_PHY_CCA_MAX_GOOD_VAL_9271_2GHZ
 -116

	)

624 
	#AR_PHY_CCA_NOM_VAL_9287_2GHZ
 -112

	)

625 
	#AR_PHY_CCA_MIN_GOOD_VAL_9287_2GHZ
 -127

	)

626 
	#AR_PHY_CCA_MAX_GOOD_VAL_9287_2GHZ
 -97

	)

	@ar9003_2p2_initvals.h

18 #i‚de‡
INITVALS_9003_2P2_H


19 
	#INITVALS_9003_2P2_H


	)

23 c⁄° 
u32
 
	g¨9300_2p2_ødio_po°ambÀ
[][5] = {

36 c⁄° 
u32
 
	g¨9300Modes_lowe°_ob_db_tx_gaö_èbÀ_2p2
[][5] = {

142 c⁄° 
u32
 
	g¨9300Modes_Á°_˛ock_2p2
[][3] = {

155 c⁄° 
u32
 
	g¨9300_2p2_ødio_c‹e
[][2] = {

299 c⁄° 
u32
 
	g¨9300_2p2_mac_po°ambÀ
[][5] = {

311 c⁄° 
u32
 
	g¨9300_2p2_soc_po°ambÀ
[][5] = {

316 c⁄° 
u32
 
	g¨9300_2p2_ba£b™d_po°ambÀ
[][5] = {

372 c⁄° 
u32
 
	g¨9300_2p2_ba£b™d_c‹e
[][2] = {

535 c⁄° 
u32
 
	g¨9300Modes_high_powî_tx_gaö_èbÀ_2p2
[][5] = {

641 c⁄° 
u32
 
	g¨9300Modes_high_ob_db_tx_gaö_èbÀ_2p2
[][5] = {

747 c⁄° 
u32
 
	g¨9300Modes_mixed_ob_db_tx_gaö_èbÀ_2p2
[][5] = {

853 c⁄° 
u32
 
	g¨9300Modes_ty≥5_tx_gaö_èbÀ_2p2
[][5] = {

927 c⁄° 
u32
 
	g¨9300Comm⁄_rx_gaö_èbÀ_2p2
[][2] = {

1187 c⁄° 
u32
 
	g¨9300Modes_low_ob_db_tx_gaö_èbÀ_2p2
[][5] = {

1293 c⁄° 
u32
 
	g¨9300_2p2_mac_c‹e
[][2] = {

1450 c⁄° 
u32
 
	g¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2
[][2] = {

1710 c⁄° 
u32
 
	g¨9300_2p2_soc_¥ómbÀ
[][2] = {

1720 c⁄° 
u32
 
	g¨9300PcõPhy_∂l_⁄_˛kªq_dißbÀ_L1_2p2
[][2] = {

1727 c⁄° 
u32
 
	g¨9300PcõPhy_˛kªq_íabÀ_L1_2p2
[][2] = {

1734 c⁄° 
u32
 
	g¨9300PcõPhy_˛kªq_dißbÀ_L1_2p2
[][2] = {

1741 c⁄° 
u32
 
	g¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
[][2] = {

1748 c⁄° 
u32
 
	g¨9300_2p2_ba£b™d_po°ambÀ_dfs_ch™√l
[][3] = {

	@ar9003_aic.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~"¨9003_mci.h
"

20 
	~"¨9003_aic.h
"

21 
	~"¨9003_phy.h
"

22 
	~"ªg_aic.h
"

24 c⁄° 
u8
 
	gcom_©t_db_èbÀ
[
ATH_AIC_MAX_COM_ATT_DB_TABLE
] = {

28 c⁄° 
u16
 
	gaic_lö_èbÀ
[
ATH_AIC_MAX_AIC_LIN_TABLE
] = {

40 
boﬁ
 
	$¨9003_hw_is_aic_íabÀd
(
©h_hw
 *
ah
)

42 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

48  
Ál£
;

50 i‡(
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_AIC
)

51  
Ál£
;

53  
åue
;

54 
	}
}

56 
öt16_t
 
	$¨9003_aic_föd_vÆid
(
©h_aic_§am_öfo
 *
ˇl_§am
,

57 
boﬁ
 
dú
, 
u8
 
ödex
)

59 
öt16_t
 
i
;

61 i‡(
dú
) {

62 
i
 = 
ödex
 + 1; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

63 i‡(
ˇl_§am
[
i
].
vÆid
)

67 
i
 = 
ödex
 - 1; i >= 0; i--) {

68 i‡(
ˇl_§am
[
i
].
vÆid
)

73 i‡((
i
 >
ATH_AIC_MAX_BT_CHANNEL
) || (i < 0))

74 
i
 = -1;

76  
i
;

77 
	}
}

82 
öt16_t
 
	$¨9003_aic_föd_ödex
(
u8
 
ty≥
, 
öt16_t
 
vÆue
)

84 
öt16_t
 
i
 = -1;

86 i‡(
ty≥
 == 0) {

87 
i
 = 
ATH_AIC_MAX_AIC_LIN_TABLE
 - 1; i >= 0; i--) {

88 i‡(
aic_lö_èbÀ
[
i
] >
vÆue
)

91 } i‡(
ty≥
 == 1) {

92 
i
 = 0; i < 
ATH_AIC_MAX_COM_ATT_DB_TABLE
; i++) {

93 i‡(
com_©t_db_èbÀ
[
i
] > 
vÆue
) {

94 
i
--;

99 i‡(
i
 >
ATH_AIC_MAX_COM_ATT_DB_TABLE
)

100 
i
 = -1;

103  
i
;

104 
	}
}

106 
	$¨9003_aic_gaö_èbÀ
(
©h_hw
 *
ah
)

108 
u32
 
aic_©ãn_w‹d
[19], 
i
;

111 
	`REG_WRITE
(
ah
, 
AR_PHY_BT_COEX_4
, 0x2c200a00);

112 
	`REG_WRITE
(
ah
, 
AR_PHY_BT_COEX_5
, 0x5c4e4438);

115 
aic_©ãn_w‹d
[0] = (0x1 & 0xf) << 14 | (0x1f & 0x1f) << 9 | (0x0 & 0xf) << 5 |

117 
aic_©ãn_w‹d
[1] = (0x3 & 0xf) << 14 | (0x1f & 0x1f) << 9 | (0x2 & 0xf) << 5 |

119 
aic_©ãn_w‹d
[2] = (0x5 & 0xf) << 14 | (0x1f & 0x1f) << 9 | (0x4 & 0xf) << 5 |

121 
aic_©ãn_w‹d
[3] = (0x1 & 0xf) << 14 | (0x1e & 0x1f) << 9 | (0x0 & 0xf) << 5 |

123 
aic_©ãn_w‹d
[4] = (0x3 & 0xf) << 14 | (0x1e & 0x1f) << 9 | (0x2 & 0xf) << 5 |

125 
aic_©ãn_w‹d
[5] = (0x5 & 0xf) << 14 | (0x1e & 0x1f) << 9 | (0x4 & 0xf) << 5 |

127 
aic_©ãn_w‹d
[6] = (0x1 & 0xf) << 14 | (0xf & 0x1f) << 9 | (0x0 & 0xf) << 5 |

129 
aic_©ãn_w‹d
[7] = (0x3 & 0xf) << 14 | (0xf & 0x1f) << 9 | (0x2 & 0xf) << 5 |

131 
aic_©ãn_w‹d
[8] = (0x5 & 0xf) << 14 | (0xf & 0x1f) << 9 | (0x4 & 0xf) << 5 |

133 
aic_©ãn_w‹d
[9] = (0x1 & 0xf) << 14 | (0x7 & 0x1f) << 9 | (0x0 & 0xf) << 5 |

135 
aic_©ãn_w‹d
[10] = (0x3 & 0xf) << 14 | (0x7 & 0x1f) << 9 | (0x2 & 0xf) << 5 |

137 
aic_©ãn_w‹d
[11] = (0x5 & 0xf) << 14 | (0x7 & 0x1f) << 9 | (0x4 & 0xf) << 5 |

139 
aic_©ãn_w‹d
[12] = (0x7 & 0xf) << 14 | (0x7 & 0x1f) << 9 | (0x6 & 0xf) << 5 |

141 
aic_©ãn_w‹d
[13] = (0x3 & 0xf) << 14 | (0x3 & 0x1f) << 9 | (0x2 & 0xf) << 5 |

143 
aic_©ãn_w‹d
[14] = (0x5 & 0xf) << 14 | (0x3 & 0x1f) << 9 | (0x4 & 0xf) << 5 |

145 
aic_©ãn_w‹d
[15] = (0x1 & 0xf) << 14 | (0x1 & 0x1f) << 9 | (0x0 & 0xf) << 5 |

147 
aic_©ãn_w‹d
[16] = (0x3 & 0xf) << 14 | (0x1 & 0x1f) << 9 | (0x2 & 0xf) << 5 |

149 
aic_©ãn_w‹d
[17] = (0x5 & 0xf) << 14 | (0x1 & 0x1f) << 9 | (0x4 & 0xf) << 5 |

151 
aic_©ãn_w‹d
[18] = (0x7 & 0xf) << 14 | (0x1 & 0x1f) << 9 | (0x6 & 0xf) << 5 |

155 
	`REG_WRITE
(
ah
, (
AR_PHY_AIC_SRAM_ADDR_B0
 + 0x3000),

156 (
ATH_AIC_SRAM_AUTO_INCREMENT
 |

157 
ATH_AIC_SRAM_GAIN_TABLE_OFFSET
));

159 
i
 = 0; i < 19; i++) {

160 
	`REG_WRITE
(
ah
, (
AR_PHY_AIC_SRAM_DATA_B0
 + 0x3000),

161 
aic_©ãn_w‹d
[
i
]);

163 
	}
}

165 
u8
 
	$¨9003_aic_ˇl_°¨t
(
©h_hw
 *
ah
, 
u8
 
mö_vÆid_cou¡
)

167 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

168 
i
;

171 
	`REG_WRITE
(
ah
, (
AR_PHY_AIC_SRAM_ADDR_B0
 + 0x3000),

172 (
ATH_AIC_SRAM_AUTO_INCREMENT
 |

173 
ATH_AIC_SRAM_CAL_OFFSET
));

175 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

176 
	`REG_WRITE
(
ah
, (
AR_PHY_AIC_SRAM_DATA_B0
 + 0x3000), 0);

177 
aic
->
aic_§am
[
i
] = 0;

180 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_0_B0
,

181 (
	`SM
(0, 
AR_PHY_AIC_MON_ENABLE
) |

182 
	`SM
(127, 
AR_PHY_AIC_CAL_MAX_HOP_COUNT
) |

183 
	`SM
(
mö_vÆid_cou¡
, 
AR_PHY_AIC_CAL_MIN_VALID_COUNT
) |

184 
	`SM
(37, 
AR_PHY_AIC_F_WLAN
) |

185 
	`SM
(1, 
AR_PHY_AIC_CAL_CH_VALID_RESET
) |

186 
	`SM
(0, 
AR_PHY_AIC_CAL_ENABLE
) |

187 
	`SM
(0x40, 
AR_PHY_AIC_BTTX_PWR_THR
) |

188 
	`SM
(0, 
AR_PHY_AIC_ENABLE
)));

190 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
,

191 (
	`SM
(0, 
AR_PHY_AIC_MON_ENABLE
) |

192 
	`SM
(1, 
AR_PHY_AIC_CAL_CH_VALID_RESET
) |

193 
	`SM
(0, 
AR_PHY_AIC_CAL_ENABLE
) |

194 
	`SM
(0x40, 
AR_PHY_AIC_BTTX_PWR_THR
) |

195 
	`SM
(0, 
AR_PHY_AIC_ENABLE
)));

197 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_1_B0
,

198 (
	`SM
(8, 
AR_PHY_AIC_CAL_BT_REF_DELAY
) |

199 
	`SM
(0, 
AR_PHY_AIC_BT_IDLE_CFG
) |

200 
	`SM
(1, 
AR_PHY_AIC_STDBY_COND
) |

201 
	`SM
(37, 
AR_PHY_AIC_STDBY_ROT_ATT_DB
) |

202 
	`SM
(5, 
AR_PHY_AIC_STDBY_COM_ATT_DB
) |

203 
	`SM
(15, 
AR_PHY_AIC_RSSI_MAX
) |

204 
	`SM
(0, 
AR_PHY_AIC_RSSI_MIN
)));

206 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_1_B1
,

207 (
	`SM
(15, 
AR_PHY_AIC_RSSI_MAX
) |

208 
	`SM
(0, 
AR_PHY_AIC_RSSI_MIN
)));

210 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_2_B0
,

211 (
	`SM
(44, 
AR_PHY_AIC_RADIO_DELAY
) |

212 
	`SM
(8, 
AR_PHY_AIC_CAL_STEP_SIZE_CORR
) |

213 
	`SM
(12, 
AR_PHY_AIC_CAL_ROT_IDX_CORR
) |

214 
	`SM
(2, 
AR_PHY_AIC_CAL_CONV_CHECK_FACTOR
) |

215 
	`SM
(5, 
AR_PHY_AIC_ROT_IDX_COUNT_MAX
) |

216 
	`SM
(0, 
AR_PHY_AIC_CAL_SYNTH_TOGGLE
) |

217 
	`SM
(0, 
AR_PHY_AIC_CAL_SYNTH_AFTER_BTRX
) |

218 
	`SM
(200, 
AR_PHY_AIC_CAL_SYNTH_SETTLING
)));

220 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_3_B0
,

221 (
	`SM
(2, 
AR_PHY_AIC_MON_MAX_HOP_COUNT
) |

222 
	`SM
(1, 
AR_PHY_AIC_MON_MIN_STALE_COUNT
) |

223 
	`SM
(1, 
AR_PHY_AIC_MON_PWR_EST_LONG
) |

224 
	`SM
(2, 
AR_PHY_AIC_MON_PD_TALLY_SCALING
) |

225 
	`SM
(10, 
AR_PHY_AIC_MON_PERF_THR
) |

226 
	`SM
(2, 
AR_PHY_AIC_CAL_TARGET_MAG_SETTING
) |

227 
	`SM
(1, 
AR_PHY_AIC_CAL_PERF_CHECK_FACTOR
) |

228 
	`SM
(1, 
AR_PHY_AIC_CAL_PWR_EST_LONG
)));

230 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_4_B0
,

231 (
	`SM
(2, 
AR_PHY_AIC_CAL_ROT_ATT_DB_EST_ISO
) |

232 
	`SM
(3, 
AR_PHY_AIC_CAL_COM_ATT_DB_EST_ISO
) |

233 
	`SM
(0, 
AR_PHY_AIC_CAL_ISO_EST_INIT_SETTING
) |

234 
	`SM
(2, 
AR_PHY_AIC_CAL_COM_ATT_DB_BACKOFF
) |

235 
	`SM
(1, 
AR_PHY_AIC_CAL_COM_ATT_DB_FIXED
)));

237 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_CTRL_4_B1
,

238 (
	`SM
(2, 
AR_PHY_AIC_CAL_ROT_ATT_DB_EST_ISO
) |

239 
	`SM
(3, 
AR_PHY_AIC_CAL_COM_ATT_DB_EST_ISO
) |

240 
	`SM
(0, 
AR_PHY_AIC_CAL_ISO_EST_INIT_SETTING
) |

241 
	`SM
(2, 
AR_PHY_AIC_CAL_COM_ATT_DB_BACKOFF
) |

242 
	`SM
(1, 
AR_PHY_AIC_CAL_COM_ATT_DB_FIXED
)));

244 
	`¨9003_aic_gaö_èbÀ
(
ah
);

247 
	`REG_WRITE
(
ah
, 
ATH_AIC_BT_JUPITER_CTRL
,

248 (
	`REG_READ
(
ah
, 
ATH_AIC_BT_JUPITER_CTRL
) |

249 
ATH_AIC_BT_AIC_ENABLE
));

251 
aic
->
aic_ˇl_°¨t_time
 = 
	`REG_READ
(
ah
, 
AR_TSF_L32
);

254 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
, 
AR_PHY_AIC_CAL_ENABLE
);

255 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
, 
AR_PHY_AIC_CAL_CH_VALID_RESET
);

256 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
, 
AR_PHY_AIC_CAL_ENABLE
);

258 
aic
->
aic_ˇÀd_ch™
 = 0;

259 
aic
->
aic_ˇl_°©e
 = 
AIC_CAL_STATE_STARTED
;

261  
aic
->
aic_ˇl_°©e
;

262 
	}
}

264 
boﬁ
 
	$¨9003_aic_ˇl_po°_¥o˚ss
(
©h_hw
 *
ah
)

266 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

267 
©h_aic_§am_öfo
 
ˇl_§am
[
ATH_AIC_MAX_BT_CHANNEL
];

268 
©h_aic_out_öfo
 
aic_§am
[
ATH_AIC_MAX_BT_CHANNEL
];

269 
u32
 
dú_∑th_gaö_idx
, 
quad_∑th_gaö_idx
, 
vÆue
;

270 
u32
 
fixed_com_©t_db
;

271 
öt8_t
 
dú_∑th_sign
, 
quad_∑th_sign
;

272 
öt16_t
 
i
;

273 
boﬁ
 
ªt
 = 
åue
;

275 
	`mem£t
(&
ˇl_§am
, 0, (cal_sram));

276 
	`mem£t
(&
aic_§am
, 0, (aic_sram));

278 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

279 
vÆue
 = 
aic
->
aic_§am
[
i
];

281 
ˇl_§am
[
i
].
vÆid
 =

282 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_VALID
);

283 
ˇl_§am
[
i
].
rŸ_quad_©t_db
 =

284 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_ROT_QUAD_ATT_DB
);

285 
ˇl_§am
[
i
].
vga_quad_sign
 =

286 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_VGA_QUAD_SIGN
);

287 
ˇl_§am
[
i
].
rŸ_dú_©t_db
 =

288 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_ROT_DIR_ATT_DB
);

289 
ˇl_§am
[
i
].
vga_dú_sign
 =

290 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_VGA_DIR_SIGN
);

291 
ˇl_§am
[
i
].
com_©t_6db
 =

292 
	`MS
(
vÆue
, 
AR_PHY_AIC_SRAM_COM_ATT_6DB
);

294 i‡(
ˇl_§am
[
i
].
vÆid
) {

295 
dú_∑th_gaö_idx
 = 
ˇl_§am
[
i
].
rŸ_dú_©t_db
 +

296 
com_©t_db_èbÀ
[
ˇl_§am
[
i
].
com_©t_6db
];

297 
quad_∑th_gaö_idx
 = 
ˇl_§am
[
i
].
rŸ_quad_©t_db
 +

298 
com_©t_db_èbÀ
[
ˇl_§am
[
i
].
com_©t_6db
];

300 
dú_∑th_sign
 = (
ˇl_§am
[
i
].
vga_dú_sign
) ? 1 : -1;

301 
quad_∑th_sign
 = (
ˇl_§am
[
i
].
vga_quad_sign
) ? 1 : -1;

303 
aic_§am
[
i
].
dú_∑th_gaö_lö
 = 
dú_∑th_sign
 *

304 
aic_lö_èbÀ
[
dú_∑th_gaö_idx
];

305 
aic_§am
[
i
].
quad_∑th_gaö_lö
 = 
quad_∑th_sign
 *

306 
aic_lö_èbÀ
[
quad_∑th_gaö_idx
];

310 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

311 
öt16_t
 
°¨t_idx
, 
íd_idx
;

313 i‡(
ˇl_§am
[
i
].
vÆid
)

316 
°¨t_idx
 = 
	`¨9003_aic_föd_vÆid
(
ˇl_§am
, 0, 
i
);

317 
íd_idx
 = 
	`¨9003_aic_föd_vÆid
(
ˇl_§am
, 1, 
i
);

319 i‡(
°¨t_idx
 < 0) {

321 
°¨t_idx
 = 
íd_idx
;

322 
íd_idx
 = 
	`¨9003_aic_föd_vÆid
(
ˇl_§am
, 1, 
°¨t_idx
);

324 i‡(
íd_idx
 < 0) {

325 
ªt
 = 
Ál£
;

329 
aic_§am
[
i
].
dú_∑th_gaö_lö
 =

330 ((
aic_§am
[
°¨t_idx
].
dú_∑th_gaö_lö
 -

331 
aic_§am
[
íd_idx
].
dú_∑th_gaö_lö
) *

332 (
°¨t_idx
 - 
i
Ë+ ((
íd_idx
 - i) >> 1)) /

333 (
íd_idx
 - 
i
) +

334 
aic_§am
[
°¨t_idx
].
dú_∑th_gaö_lö
;

335 
aic_§am
[
i
].
quad_∑th_gaö_lö
 =

336 ((
aic_§am
[
°¨t_idx
].
quad_∑th_gaö_lö
 -

337 
aic_§am
[
íd_idx
].
quad_∑th_gaö_lö
) *

338 (
°¨t_idx
 - 
i
Ë+ ((
íd_idx
 - i) >> 1)) /

339 (
íd_idx
 - 
i
) +

340 
aic_§am
[
°¨t_idx
].
quad_∑th_gaö_lö
;

343 i‡(
íd_idx
 < 0) {

345 
íd_idx
 = 
	`¨9003_aic_föd_vÆid
(
ˇl_§am
, 0, 
°¨t_idx
);

347 i‡(
íd_idx
 < 0) {

348 
ªt
 = 
Ál£
;

352 
aic_§am
[
i
].
dú_∑th_gaö_lö
 =

353 ((
aic_§am
[
°¨t_idx
].
dú_∑th_gaö_lö
 -

354 
aic_§am
[
íd_idx
].
dú_∑th_gaö_lö
) *

355 (
i
 - 
°¨t_idx
Ë+ ((°¨t_idx - 
íd_idx
) >> 1)) /

356 (
°¨t_idx
 - 
íd_idx
) +

357 
aic_§am
[
°¨t_idx
].
dú_∑th_gaö_lö
;

358 
aic_§am
[
i
].
quad_∑th_gaö_lö
 =

359 ((
aic_§am
[
°¨t_idx
].
quad_∑th_gaö_lö
 -

360 
aic_§am
[
íd_idx
].
quad_∑th_gaö_lö
) *

361 (
i
 - 
°¨t_idx
Ë+ ((°¨t_idx - 
íd_idx
) >> 1)) /

362 (
°¨t_idx
 - 
íd_idx
) +

363 
aic_§am
[
°¨t_idx
].
quad_∑th_gaö_lö
;

365 } i‡(
°¨t_idx
 >= 0){

367 
aic_§am
[
i
].
dú_∑th_gaö_lö
 =

368 (((
íd_idx
 - 
i
Ë* 
aic_§am
[
°¨t_idx
].
dú_∑th_gaö_lö
) +

369 ((
i
 - 
°¨t_idx
Ë* 
aic_§am
[
íd_idx
].
dú_∑th_gaö_lö
) +

370 ((
íd_idx
 - 
°¨t_idx
) >> 1)) /

371 (
íd_idx
 - 
°¨t_idx
);

372 
aic_§am
[
i
].
quad_∑th_gaö_lö
 =

373 (((
íd_idx
 - 
i
Ë* 
aic_§am
[
°¨t_idx
].
quad_∑th_gaö_lö
) +

374 ((
i
 - 
°¨t_idx
Ë* 
aic_§am
[
íd_idx
].
quad_∑th_gaö_lö
) +

375 ((
íd_idx
 - 
°¨t_idx
) >> 1))/

376 (
íd_idx
 - 
°¨t_idx
);

381 
i
 = 
	`¨9003_aic_föd_vÆid
(
ˇl_§am
, 1, 0);

382 i‡(
i
 < 0) {

383 
i
 = 0;

384 
ªt
 = 
Ál£
;

386 
fixed_com_©t_db
 = 
com_©t_db_èbÀ
[
ˇl_§am
[
i
].
com_©t_6db
];

388 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

389 
öt16_t
 
rŸ_dú_∑th_©t_db
, 
rŸ_quad_∑th_©t_db
;

391 
aic_§am
[
i
].
§am
.
vga_dú_sign
 =

392 (
aic_§am
[
i
].
dú_∑th_gaö_lö
 >= 0) ? 1 : 0;

393 
aic_§am
[
i
].
§am
.
vga_quad_sign
=

394 (
aic_§am
[
i
].
quad_∑th_gaö_lö
 >= 0) ? 1 : 0;

396 
rŸ_dú_∑th_©t_db
 =

397 
	`¨9003_aic_föd_ödex
(0, 
	`abs
(
aic_§am
[
i
].
dú_∑th_gaö_lö
)) -

398 
fixed_com_©t_db
;

399 
rŸ_quad_∑th_©t_db
 =

400 
	`¨9003_aic_föd_ödex
(0, 
	`abs
(
aic_§am
[
i
].
quad_∑th_gaö_lö
)) -

401 
fixed_com_©t_db
;

403 
aic_§am
[
i
].
§am
.
com_©t_6db
 =

404 
	`¨9003_aic_föd_ödex
(1, 
fixed_com_©t_db
);

406 
aic_§am
[
i
].
§am
.
vÆid
 = 1;

408 
aic_§am
[
i
].
§am
.
rŸ_dú_©t_db
 =

409 
	`mö
(
	`max
(
rŸ_dú_∑th_©t_db
,

410 (
öt16_t
)
ATH_AIC_MIN_ROT_DIR_ATT_DB
),

411 
ATH_AIC_MAX_ROT_DIR_ATT_DB
);

412 
aic_§am
[
i
].
§am
.
rŸ_quad_©t_db
 =

413 
	`mö
(
	`max
(
rŸ_quad_∑th_©t_db
,

414 (
öt16_t
)
ATH_AIC_MIN_ROT_QUAD_ATT_DB
),

415 
ATH_AIC_MAX_ROT_QUAD_ATT_DB
);

418 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

419 
aic
->
aic_§am
[
i
] = (
	`SM
◊ic_§am[i].
§am
.
vga_dú_sign
,

420 
AR_PHY_AIC_SRAM_VGA_DIR_SIGN
) |

421 
	`SM
(
aic_§am
[
i
].
§am
.
vga_quad_sign
,

422 
AR_PHY_AIC_SRAM_VGA_QUAD_SIGN
) |

423 
	`SM
(
aic_§am
[
i
].
§am
.
com_©t_6db
,

424 
AR_PHY_AIC_SRAM_COM_ATT_6DB
) |

425 
	`SM
(
aic_§am
[
i
].
§am
.
vÆid
,

426 
AR_PHY_AIC_SRAM_VALID
) |

427 
	`SM
(
aic_§am
[
i
].
§am
.
rŸ_dú_©t_db
,

428 
AR_PHY_AIC_SRAM_ROT_DIR_ATT_DB
) |

429 
	`SM
(
aic_§am
[
i
].
§am
.
rŸ_quad_©t_db
,

430 
AR_PHY_AIC_SRAM_ROT_QUAD_ATT_DB
));

433  
ªt
;

434 
	}
}

436 
	$¨9003_aic_ˇl_d⁄e
(
©h_hw
 *
ah
)

438 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

441 
	`REG_WRITE
(
ah
, 
ATH_AIC_BT_JUPITER_CTRL
,

442 (
	`REG_READ
(
ah
, 
ATH_AIC_BT_JUPITER_CTRL
) &

443 ~
ATH_AIC_BT_AIC_ENABLE
));

445 i‡(
	`¨9003_aic_ˇl_po°_¥o˚ss
(
ah
))

446 
aic
->
aic_ˇl_°©e
 = 
AIC_CAL_STATE_DONE
;

448 
aic
->
aic_ˇl_°©e
 = 
AIC_CAL_STATE_ERROR
;

449 
	}
}

451 
u8
 
	$¨9003_aic_ˇl_c⁄töue
(
©h_hw
 *
ah
, 
boﬁ
 
ˇl_⁄˚
)

453 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

454 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

455 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

456 
i
, 
num_ch™
;

458 
num_ch™
 = 
	`MS
(
mci_hw
->
c⁄fig
, 
ATH_MCI_CONFIG_AIC_CAL_NUM_CHAN
);

460 i‡(!
num_ch™
) {

461 
aic
->
aic_ˇl_°©e
 = 
AIC_CAL_STATE_ERROR
;

462  
aic
->
aic_ˇl_°©e
;

465 i‡(
ˇl_⁄˚
) {

466 
i
 = 0; i < 10000; i++) {

467 i‡((
	`REG_READ
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
) &

468 
AR_PHY_AIC_CAL_ENABLE
) == 0)

471 
	`udñay
(100);

479 i‡((
	`REG_READ
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
) &

480 
AR_PHY_AIC_CAL_ENABLE
) != 0) {

481 
	`©h_dbg
(
comm⁄
, 
MCI
, "AIC cal isÇot doneáfter 40ms");

482 
exô
;

485 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_SRAM_ADDR_B1
,

486 (
ATH_AIC_SRAM_CAL_OFFSET
 | 
ATH_AIC_SRAM_AUTO_INCREMENT
));

488 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

489 
u32
 
vÆue
;

491 
vÆue
 = 
	`REG_READ
(
ah
, 
AR_PHY_AIC_SRAM_DATA_B1
);

493 i‡(
vÆue
 & 0x01) {

494 i‡(
aic
->
aic_§am
[
i
] == 0)

495 
aic
->
aic_ˇÀd_ch™
++;

497 
aic
->
aic_§am
[
i
] = 
vÆue
;

499 i‡(!
ˇl_⁄˚
)

504 i‡((
aic
->
aic_ˇÀd_ch™
 >
num_ch™
Ë|| 
ˇl_⁄˚
) {

505 
	`¨9003_aic_ˇl_d⁄e
(
ah
);

508 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
, 
AR_PHY_AIC_CAL_ENABLE
);

509 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
,

510 
AR_PHY_AIC_CAL_CH_VALID_RESET
);

511 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AIC_CTRL_0_B1
, 
AR_PHY_AIC_CAL_ENABLE
);

513 
exô
:

514  
aic
->
aic_ˇl_°©e
;

516 
	}
}

518 
u8
 
	$¨9003_aic_ˇlibøti⁄
(
©h_hw
 *
ah
)

520 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

521 
u8
 
ˇl_ªt
 = 
AIC_CAL_STATE_ERROR
;

523 
aic
->
aic_ˇl_°©e
) {

524 
AIC_CAL_STATE_IDLE
:

525 
ˇl_ªt
 = 
	`¨9003_aic_ˇl_°¨t
(
ah
, 1);

527 
AIC_CAL_STATE_STARTED
:

528 
ˇl_ªt
 = 
	`¨9003_aic_ˇl_c⁄töue
(
ah
, 
Ál£
);

530 
AIC_CAL_STATE_DONE
:

531 
ˇl_ªt
 = 
AIC_CAL_STATE_DONE
;

537  
ˇl_ªt
;

538 
	}
}

540 
u8
 
	$¨9003_aic_°¨t_n‹mÆ
(
©h_hw
 *
ah
)

542 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

543 
öt16_t
 
i
;

545 i‡(
aic
->
aic_ˇl_°©e
 !
AIC_CAL_STATE_DONE
)

548 
	`¨9003_aic_gaö_èbÀ
(
ah
);

550 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_SRAM_ADDR_B1
, 
ATH_AIC_SRAM_AUTO_INCREMENT
);

552 
i
 = 0; i < 
ATH_AIC_MAX_BT_CHANNEL
; i++) {

553 
	`REG_WRITE
(
ah
, 
AR_PHY_AIC_SRAM_DATA_B1
, 
aic
->
aic_§am
[
i
]);

557 
	`REG_WRITE
(
ah
, 0xa6b0, 0x80);

558 
	`REG_WRITE
(
ah
, 0xa6b4, 0x5b2df0);

559 
	`REG_WRITE
(
ah
, 0xa6b8, 0x10762cc8);

560 
	`REG_WRITE
(
ah
, 0xa6bc, 0x1219a4b);

561 
	`REG_WRITE
(
ah
, 0xa6c0, 0x1e01);

562 
	`REG_WRITE
(
ah
, 0xb6b4, 0xf0);

563 
	`REG_WRITE
(
ah
, 0xb6c0, 0x1e01);

564 
	`REG_WRITE
(
ah
, 0xb6b0, 0x81);

565 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH1_RXTX4
, 0x40000000);

567 
aic
->
aic_íabÀd
 = 
åue
;

570 
	}
}

572 
u8
 
	$¨9003_aic_ˇl_ª£t
(
©h_hw
 *
ah
)

574 
©h9k_hw_aic
 *
aic
 = &
ah
->
btc€x_hw
.aic;

576 
aic
->
aic_ˇl_°©e
 = 
AIC_CAL_STATE_IDLE
;

577  
aic
->
aic_ˇl_°©e
;

578 
	}
}

580 
u8
 
	$¨9003_aic_ˇlibøti⁄_sögÀ
(
©h_hw
 *
ah
)

582 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

583 
u8
 
ˇl_ªt
;

584 
num_ch™
;

586 
num_ch™
 = 
	`MS
(
mci_hw
->
c⁄fig
, 
ATH_MCI_CONFIG_AIC_CAL_NUM_CHAN
);

588 (Ë
	`¨9003_aic_ˇl_°¨t
(
ah
, 
num_ch™
);

589 
ˇl_ªt
 = 
	`¨9003_aic_ˇl_c⁄töue
(
ah
, 
åue
);

591  
ˇl_ªt
;

592 
	}
}

594 
	$¨9003_hw_©èch_aic_›s
(
©h_hw
 *
ah
)

596 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

598 
¥iv_›s
->
is_aic_íabÀd
 = 
¨9003_hw_is_aic_íabÀd
;

599 
	}
}

	@ar9003_aic.h

17 #i‚de‡
AR9003_AIC_H


18 
	#AR9003_AIC_H


	)

20 
	#ATH_AIC_MAX_COM_ATT_DB_TABLE
 6

	)

21 
	#ATH_AIC_MAX_AIC_LIN_TABLE
 69

	)

22 
	#ATH_AIC_MIN_ROT_DIR_ATT_DB
 0

	)

23 
	#ATH_AIC_MIN_ROT_QUAD_ATT_DB
 0

	)

24 
	#ATH_AIC_MAX_ROT_DIR_ATT_DB
 37

	)

25 
	#ATH_AIC_MAX_ROT_QUAD_ATT_DB
 37

	)

26 
	#ATH_AIC_SRAM_AUTO_INCREMENT
 0x80000000

	)

27 
	#ATH_AIC_SRAM_GAIN_TABLE_OFFSET
 0x280

	)

28 
	#ATH_AIC_SRAM_CAL_OFFSET
 0x140

	)

29 
	#ATH_AIC_SRAM_OFFSET
 0x00

	)

30 
	#ATH_AIC_MEAS_MAG_THRESH
 20

	)

31 
	#ATH_AIC_BT_JUPITER_CTRL
 0x66820

	)

32 
	#ATH_AIC_BT_AIC_ENABLE
 0x02

	)

34 
	eaic_ˇl_°©e
 {

35 
	mAIC_CAL_STATE_IDLE
 = 0,

36 
	mAIC_CAL_STATE_STARTED
,

37 
	mAIC_CAL_STATE_DONE
,

38 
	mAIC_CAL_STATE_ERROR


41 
	s©h_aic_§am_öfo
 {

42 
boﬁ
 
	mvÆid
:1;

43 
boﬁ
 
	mvga_quad_sign
:1;

44 
boﬁ
 
	mvga_dú_sign
:1;

45 
u8
 
	mrŸ_quad_©t_db
;

46 
u8
 
	mrŸ_dú_©t_db
;

47 
u8
 
	mcom_©t_6db
;

50 
	s©h_aic_out_öfo
 {

51 
öt16_t
 
	mdú_∑th_gaö_lö
;

52 
öt16_t
 
	mquad_∑th_gaö_lö
;

53 
©h_aic_§am_öfo
 
	m§am
;

56 
u8
 
¨9003_aic_ˇlibøti⁄
(
©h_hw
 *
ah
);

57 
u8
 
¨9003_aic_°¨t_n‹mÆ
(
©h_hw
 *
ah
);

58 
u8
 
¨9003_aic_ˇl_ª£t
(
©h_hw
 *
ah
);

59 
u8
 
¨9003_aic_ˇlibøti⁄_sögÀ
(
©h_hw
 *
ah
);

	@ar9003_buffalo_initvals.h

17 #i‚de‡
INITVALS_9003_BUFFALO_H


18 
	#INITVALS_9003_BUFFALO_H


	)

20 c⁄° 
u32
 
	g¨9300Modes_high_powî_tx_gaö_èbÀ_bufÁlo
[][5] = {

	@ar9003_calib.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~"¨9003_phy.h
"

20 
	~"¨9003_πt.h
"

21 
	~"¨9003_mci.h
"

23 
	#MAX_MEASUREMENT
 
MAX_IQCAL_MEASUREMENT


	)

24 
	#MAX_MAG_DELTA
 11

	)

25 
	#MAX_PHS_DELTA
 10

	)

26 
	#MAXIQCAL
 3

	)

28 
	sc€ff
 {

29 
	mmag_c€ff
[
AR9300_MAX_CHAINS
][
MAX_MEASUREMENT
][
MAXIQCAL
];

30 
	mphs_c€ff
[
AR9300_MAX_CHAINS
][
MAX_MEASUREMENT
][
MAXIQCAL
];

31 
	miqc_c€ff
[2];

34 
	e¨9003_ˇl_ty≥s
 {

35 
	mIQ_MISMATCH_CAL
 = 
BIT
(0),

38 
	$¨9003_hw_£tup_ˇlibøti⁄
(
©h_hw
 *
ah
,

39 
©h9k_ˇl_li°
 *
cuºCÆ
)

41 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

44 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
) {

45 
IQ_MISMATCH_CAL
:

50 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

51 
AR_PHY_TIMING4_IQCAL_LOG_COUNT_MAX
,

52 
cuºCÆ
->
ˇlD©a
->
ˇlCou¡Max
);

53 
	`REG_WRITE
(
ah
, 
AR_PHY_CALMODE
, 
AR_PHY_CALMODE_IQ
);

55 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

59 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TIMING4
, 
AR_PHY_TIMING4_DO_CAL
);

62 
	`©h_îr
(
comm⁄
, "Invalid calibrationÅype\n");

65 
	}
}

72 
boﬁ
 
	$¨9003_hw_≥r_ˇlibøti⁄
(
©h_hw
 *
ah
,

73 
©h9k_ch™√l
 *
ich™
,

74 
u8
 
rxchaömask
,

75 
©h9k_ˇl_li°
 *
cuºCÆ
)

77 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

79 
boﬁ
 
isˇld⁄e
 = 
Ál£
;

82 i‡(
cuºCÆ
->
ˇlSèã
 =
CAL_RUNNING
) {

84 i‡(!(
	`REG_READ
(
ah
, 
AR_PHY_TIMING4
Ë& 
AR_PHY_TIMING4_DO_CAL
)) {

88 
cuºCÆ
->
ˇlD©a
->
	`ˇlCﬁÀ˘
(
ah
);

89 
ah
->
ˇl_ßm∂es
++;

91 i‡(
ah
->
ˇl_ßm∂es
 >=

92 
cuºCÆ
->
ˇlD©a
->
ˇlNumSam∂es
) {

93 
i
, 
numChaös
 = 0;

94 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

95 i‡(
rxchaömask
 & (1 << 
i
))

96 
numChaös
++;

102 
cuºCÆ
->
ˇlD©a
->
	`ˇlPo°Proc
(
ah
, 
numChaös
);

105 
ˇld©a
->
CÆVÆid
 |
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
;

106 
cuºCÆ
->
ˇlSèã
 = 
CAL_DONE
;

107 
isˇld⁄e
 = 
åue
;

113 
	`¨9003_hw_£tup_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

116 } i‡(!(
ˇld©a
->
CÆVÆid
 & 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
)) {

118 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

121  
isˇld⁄e
;

122 
	}
}

124 
	$¨9003_hw_ˇlibøã
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

125 
u8
 
rxchaömask
, 
boﬁ
 
l⁄gˇl
)

127 
boﬁ
 
isˇld⁄e
 = 
åue
;

128 
©h9k_ˇl_li°
 *
cuºCÆ
 = 
ah
->
ˇl_li°_cuº
;

129 
ªt
;

140 i‡(
cuºCÆ
 &&

141 (
cuºCÆ
->
ˇlSèã
 =
CAL_RUNNING
 ||

142 
cuºCÆ
->
ˇlSèã
 =
CAL_WAITING
)) {

143 
isˇld⁄e
 = 
	`¨9003_hw_≥r_ˇlibøti⁄
(
ah
, 
ch™
,

144 
rxchaömask
, 
cuºCÆ
);

145 i‡(
isˇld⁄e
) {

146 
ah
->
ˇl_li°_cuº
 = 
cuºCÆ
 = cuºCÆ->
ˇlNext
;

148 i‡(
cuºCÆ
->
ˇlSèã
 =
CAL_WAITING
) {

149 
isˇld⁄e
 = 
Ál£
;

150 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

159 i‡(
l⁄gˇl
 && 
	`©h9k_hw_gënf
(
ah
, 
ch™
)) {

165 
ªt
 = 
	`©h9k_hw_lﬂdnf
(
ah
,áh->
curch™
);

166 i‡(
ªt
 < 0)

167  
ªt
;

170 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
Ál£
);

173  
isˇld⁄e
;

174 
	}
}

176 
	$¨9003_hw_iqˇl_cﬁÀ˘
(
©h_hw
 *
ah
)

178 
i
;

181 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

182 i‡(
ah
->
txchaömask
 & 
	`BIT
(
i
)) {

183 
ah
->
tŸÆPowîMósI
[
i
] +=

184 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_0
(
i
));

185 
ah
->
tŸÆPowîMósQ
[
i
] +=

186 
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_1
(
i
));

187 
ah
->
tŸÆIqC‹rMós
[
i
] +=

188 (
öt32_t
Ë
	`REG_READ
(
ah
, 
	`AR_PHY_CAL_MEAS_2
(
i
));

189 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

191 
ah
->
ˇl_ßm∂es
, 
i
,áh->
tŸÆPowîMósI
[i],

192 
ah
->
tŸÆPowîMósQ
[
i
],

193 
ah
->
tŸÆIqC‹rMós
[
i
]);

196 
	}
}

198 
	$¨9003_hw_iqˇlibøã
(
©h_hw
 *
ah
, 
u8
 
numChaös
)

200 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

201 
u32
 
powîMósQ
, 
powîMósI
, 
iqC‹rMós
;

202 
u32
 
qCoffDíom
, 
iCoffDíom
;

203 
öt32_t
 
qCoff
, 
iCoff
;

204 
iqC‹rNeg
, 
i
;

205 c⁄° 
u_öt32_t
 
off£t_¨øy
[3] = {

206 
AR_PHY_RX_IQCAL_CORR_B0
,

207 
AR_PHY_RX_IQCAL_CORR_B1
,

208 
AR_PHY_RX_IQCAL_CORR_B2
,

211 
i
 = 0; i < 
numChaös
; i++) {

212 
powîMósI
 = 
ah
->
tŸÆPowîMósI
[
i
];

213 
powîMósQ
 = 
ah
->
tŸÆPowîMósQ
[
i
];

214 
iqC‹rMós
 = 
ah
->
tŸÆIqC‹rMós
[
i
];

216 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

217 "Sèπög IQ CÆánd C‹ª˘i⁄ f‹ Chaö %d\n", 
i
);

219 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

221 
i
, 
ah
->
tŸÆIqC‹rMós
[i]);

223 
iqC‹rNeg
 = 0;

225 i‡(
iqC‹rMós
 > 0x80000000) {

226 
iqC‹rMós
 = (0xffffffff - iqCorrMeas) + 1;

227 
iqC‹rNeg
 = 1;

230 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_i = 0x%08x\n",

231 
i
, 
powîMósI
);

232 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %dÖwr_meas_q = 0x%08x\n",

233 
i
, 
powîMósQ
);

234 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "iqC‹rNeg i†0x%08x\n", 
iqC‹rNeg
);

236 
iCoffDíom
 = (
powîMósI
 / 2 + 
powîMósQ
 / 2) / 256;

237 
qCoffDíom
 = 
powîMósQ
 / 64;

239 i‡((
iCoffDíom
 !0Ë&& (
qCoffDíom
 != 0)) {

240 
iCoff
 = 
iqC‹rMós
 / 
iCoffDíom
;

241 
qCoff
 = 
powîMósI
 / 
qCoffDíom
 - 64;

242 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %d iCoff = 0x%08x\n",

243 
i
, 
iCoff
);

244 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Chn %d qCoff = 0x%08x\n",

245 
i
, 
qCoff
);

248 i‡(
iCoff
 >= 63)

249 
iCoff
 = 63;

250 i‡(
iCoff
 <= -63)

251 
iCoff
 = -63;

254 i‡(
iqC‹rNeg
 == 0x0)

255 
iCoff
 = -iCoff;

258 i‡(
qCoff
 >= 63)

259 
qCoff
 = 63;

260 i‡(
qCoff
 <= -63)

261 
qCoff
 = -63;

263 
iCoff
 = iCoff & 0x7f;

264 
qCoff
 = qCoff & 0x7f;

266 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

268 
i
, 
iCoff
, 
qCoff
);

269 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

271 
off£t_¨øy
[
i
],

272 
	`REG_READ
(
ah
, 
off£t_¨øy
[
i
]));

274 i‡(
	`AR_SREV_9565
(
ah
) &&

275 (
iCoff
 =63 || 
qCoff
 == 63 ||

276 
iCoff
 =-63 || 
qCoff
 == -63))

279 
	`REG_RMW_FIELD
(
ah
, 
off£t_¨øy
[
i
],

280 
AR_PHY_RX_IQCAL_CORR_IQCORR_Q_I_COFF
,

281 
iCoff
);

282 
	`REG_RMW_FIELD
(
ah
, 
off£t_¨øy
[
i
],

283 
AR_PHY_RX_IQCAL_CORR_IQCORR_Q_Q_COFF
,

284 
qCoff
);

285 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

287 
off£t_¨øy
[
i
],

288 
AR_PHY_RX_IQCAL_CORR_IQCORR_Q_I_COFF
,

289 
	`REG_READ
(
ah
, 
off£t_¨øy
[
i
]));

290 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

292 
off£t_¨øy
[
i
],

293 
AR_PHY_RX_IQCAL_CORR_IQCORR_Q_Q_COFF
,

294 
	`REG_READ
(
ah
, 
off£t_¨øy
[
i
]));

296 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

297 "IQ CÆánd C‹ª˘i⁄ d⁄êf‹ Chaö %d\n", 
i
);

301 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RX_IQCAL_CORR_B0
,

302 
AR_PHY_RX_IQCAL_CORR_IQCORR_ENABLE
);

303 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

305 (Ë(
AR_PHY_RX_IQCAL_CORR_B0
),

306 
AR_PHY_RX_IQCAL_CORR_IQCORR_ENABLE
,

307 
	`REG_READ
(
ah
, 
AR_PHY_RX_IQCAL_CORR_B0
));

308 
	}
}

310 c⁄° 
©h9k_≥rˇl_d©a
 
	giq_ˇl_sögÀ_ßm∂e
 = {

311 
IQ_MISMATCH_CAL
,

312 
MIN_CAL_SAMPLES
,

313 
PER_MAX_LOG_COUNT
,

314 
¨9003_hw_iqˇl_cﬁÀ˘
,

315 
¨9003_hw_iqˇlibøã


318 
	$¨9003_hw_öô_ˇl_£âögs
(
©h_hw
 *
ah
)

320 
ah
->
iq_ˇld©a
.
ˇlD©a
 = &
iq_ˇl_sögÀ_ßm∂e
;

322 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

323 
ah
->
íabÀd_ˇls
 |
TX_IQ_CAL
;

324 i‡(
	`AR_SREV_9485_OR_LATER
(
ah
Ë&& !
	`AR_SREV_9340
(ah))

325 
ah
->
íabÀd_ˇls
 |
TX_IQ_ON_AGC_CAL
;

328 
ah
->
suµ_ˇls
 = 
IQ_MISMATCH_CAL
;

329 
	}
}

331 
	#OFF_UPPER_LT
 24

	)

332 
	#OFF_LOWER_LT
 7

	)

334 
boﬁ
 
	$¨9003_hw_dy«mic_osdac_£À˘i⁄
(
©h_hw
 *
ah
,

335 
boﬁ
 
txiqˇl_d⁄e
)

337 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

338 
ch0_d⁄e
, 
osdac_ch0
, 
dc_off_ch0_i1
, 
dc_off_ch0_q1
, 
dc_off_ch0_i2
,

339 
dc_off_ch0_q2
, 
dc_off_ch0_i3
, 
dc_off_ch0_q3
;

340 
ch1_d⁄e
, 
osdac_ch1
, 
dc_off_ch1_i1
, 
dc_off_ch1_q1
, 
dc_off_ch1_i2
,

341 
dc_off_ch1_q2
, 
dc_off_ch1_i3
, 
dc_off_ch1_q3
;

342 
ch2_d⁄e
, 
osdac_ch2
, 
dc_off_ch2_i1
, 
dc_off_ch2_q1
, 
dc_off_ch2_i2
,

343 
dc_off_ch2_q2
, 
dc_off_ch2_i3
, 
dc_off_ch2_q3
;

344 
boﬁ
 
°©us
;

345 
u32
 
ãmp
, 
vÆ
;

350 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

351 
AR_PHY_AGC_CONTROL_OFFSET_CAL
);

352 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

353 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
);

354 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
,

355 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
Ë| 
AR_PHY_AGC_CONTROL_CAL
);

357 
°©us
 = 
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

358 
AR_PHY_AGC_CONTROL_CAL
,

359 0, 
AH_WAIT_TIMEOUT
);

360 i‡(!
°©us
) {

361 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

363  
Ál£
;

371 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

372 
AR_PHY_AGC_CONTROL_OFFSET_CAL
);

373 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
,

374 
AR_PHY_CL_CAL_ENABLE
);

375 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

376 
AR_PHY_AGC_CONTROL_FLTR_CAL
);

377 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

378 
AR_PHY_AGC_CONTROL_PKDET_CAL
);

380 
ch0_d⁄e
 = 0;

381 
ch1_d⁄e
 = 0;

382 
ch2_d⁄e
 = 0;

384 (
ch0_d⁄e
 =0Ë|| (
ch1_d⁄e
 =0Ë|| (
ch2_d⁄e
 == 0)) {

385 
osdac_ch0
 = (
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB1
) >> 30) & 0x3;

386 
osdac_ch1
 = (
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB1
) >> 30) & 0x3;

387 
osdac_ch2
 = (
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB1
) >> 30) & 0x3;

389 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

391 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
,

392 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
Ë| 
AR_PHY_AGC_CONTROL_CAL
);

394 
°©us
 = 
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

395 
AR_PHY_AGC_CONTROL_CAL
,

396 0, 
AH_WAIT_TIMEOUT
);

397 i‡(!
°©us
) {

398 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

400  
Ál£
;

403 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

408 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BB3
,

409 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
) & 0xfffffcff) | (1 << 8)));

410 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH1_BB3
,

411 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
) & 0xfffffcff) | (1 << 8)));

412 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH2_BB3
,

413 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
) & 0xfffffcff) | (1 << 8)));

415 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
);

416 
dc_off_ch0_i1
 = (
ãmp
 >> 26) & 0x1f;

417 
dc_off_ch0_q1
 = (
ãmp
 >> 21) & 0x1f;

419 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
);

420 
dc_off_ch1_i1
 = (
ãmp
 >> 26) & 0x1f;

421 
dc_off_ch1_q1
 = (
ãmp
 >> 21) & 0x1f;

423 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
);

424 
dc_off_ch2_i1
 = (
ãmp
 >> 26) & 0x1f;

425 
dc_off_ch2_q1
 = (
ãmp
 >> 21) & 0x1f;

430 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BB3
,

431 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
) & 0xfffffcff) | (2 << 8)));

432 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH1_BB3
,

433 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
) & 0xfffffcff) | (2 << 8)));

434 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH2_BB3
,

435 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
) & 0xfffffcff) | (2 << 8)));

437 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
);

438 
dc_off_ch0_i2
 = (
ãmp
 >> 26) & 0x1f;

439 
dc_off_ch0_q2
 = (
ãmp
 >> 21) & 0x1f;

441 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
);

442 
dc_off_ch1_i2
 = (
ãmp
 >> 26) & 0x1f;

443 
dc_off_ch1_q2
 = (
ãmp
 >> 21) & 0x1f;

445 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
);

446 
dc_off_ch2_i2
 = (
ãmp
 >> 26) & 0x1f;

447 
dc_off_ch2_q2
 = (
ãmp
 >> 21) & 0x1f;

452 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BB3
,

453 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
) & 0xfffffcff) | (3 << 8)));

454 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH1_BB3
,

455 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
) & 0xfffffcff) | (3 << 8)));

456 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH2_BB3
,

457 ((
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
) & 0xfffffcff) | (3 << 8)));

459 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB3
);

460 
dc_off_ch0_i3
 = (
ãmp
 >> 26) & 0x1f;

461 
dc_off_ch0_q3
 = (
ãmp
 >> 21) & 0x1f;

463 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB3
);

464 
dc_off_ch1_i3
 = (
ãmp
 >> 26) & 0x1f;

465 
dc_off_ch1_q3
 = (
ãmp
 >> 21) & 0x1f;

467 
ãmp
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB3
);

468 
dc_off_ch2_i3
 = (
ãmp
 >> 26) & 0x1f;

469 
dc_off_ch2_q3
 = (
ãmp
 >> 21) & 0x1f;

471 i‡((
dc_off_ch0_i1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_i1 < 
OFF_LOWER_LT
) ||

472 (
dc_off_ch0_i2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_i2 < 
OFF_LOWER_LT
) ||

473 (
dc_off_ch0_i3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_i3 < 
OFF_LOWER_LT
) ||

474 (
dc_off_ch0_q1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_q1 < 
OFF_LOWER_LT
) ||

475 (
dc_off_ch0_q2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_q2 < 
OFF_LOWER_LT
) ||

476 (
dc_off_ch0_q3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch0_q3 < 
OFF_LOWER_LT
)) {

477 i‡(
osdac_ch0
 == 3) {

478 
ch0_d⁄e
 = 1;

480 
osdac_ch0
++;

482 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BB1
) & 0x3fffffff;

483 
vÆ
 |(
osdac_ch0
 << 30);

484 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BB1
, 
vÆ
);

486 
ch0_d⁄e
 = 0;

489 
ch0_d⁄e
 = 1;

492 i‡((
dc_off_ch1_i1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_i1 < 
OFF_LOWER_LT
) ||

493 (
dc_off_ch1_i2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_i2 < 
OFF_LOWER_LT
) ||

494 (
dc_off_ch1_i3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_i3 < 
OFF_LOWER_LT
) ||

495 (
dc_off_ch1_q1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_q1 < 
OFF_LOWER_LT
) ||

496 (
dc_off_ch1_q2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_q2 < 
OFF_LOWER_LT
) ||

497 (
dc_off_ch1_q3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch1_q3 < 
OFF_LOWER_LT
)) {

498 i‡(
osdac_ch1
 == 3) {

499 
ch1_d⁄e
 = 1;

501 
osdac_ch1
++;

503 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH1_BB1
) & 0x3fffffff;

504 
vÆ
 |(
osdac_ch1
 << 30);

505 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH1_BB1
, 
vÆ
);

507 
ch1_d⁄e
 = 0;

510 
ch1_d⁄e
 = 1;

513 i‡((
dc_off_ch2_i1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_i1 < 
OFF_LOWER_LT
) ||

514 (
dc_off_ch2_i2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_i2 < 
OFF_LOWER_LT
) ||

515 (
dc_off_ch2_i3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_i3 < 
OFF_LOWER_LT
) ||

516 (
dc_off_ch2_q1
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_q1 < 
OFF_LOWER_LT
) ||

517 (
dc_off_ch2_q2
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_q2 < 
OFF_LOWER_LT
) ||

518 (
dc_off_ch2_q3
 > 
OFF_UPPER_LT
Ë|| (dc_off_ch2_q3 < 
OFF_LOWER_LT
)) {

519 i‡(
osdac_ch2
 == 3) {

520 
ch2_d⁄e
 = 1;

522 
osdac_ch2
++;

524 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH2_BB1
) & 0x3fffffff;

525 
vÆ
 |(
osdac_ch2
 << 30);

526 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH2_BB1
, 
vÆ
);

528 
ch2_d⁄e
 = 0;

531 
ch2_d⁄e
 = 1;

535 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

536 
AR_PHY_AGC_CONTROL_OFFSET_CAL
);

537 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

543 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

544 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
);

546  
åue
;

547 
	}
}

552 
boﬁ
 
	$¨9003_hw_sﬁve_iq_ˇl
(
©h_hw
 *
ah
,

553 
s32
 
sö_2phi_1
,

554 
s32
 
cos_2phi_1
,

555 
s32
 
sö_2phi_2
,

556 
s32
 
cos_2phi_2
,

557 
s32
 
mag_a0_d0
,

558 
s32
 
phs_a0_d0
,

559 
s32
 
mag_a1_d0
,

560 
s32
 
phs_a1_d0
,

561 
s32
 
sﬁved_eq
[])

563 
s32
 
f1
 = 
cos_2phi_1
 - 
cos_2phi_2
,

564 
f3
 = 
sö_2phi_1
 - 
sö_2phi_2
,

565 
f2
;

566 
s32
 
mag_tx
, 
phs_tx
, 
mag_rx
, 
phs_rx
;

567 c⁄° 
s32
 
ªsu…_shi·
 = 1 << 15;

568 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

570 
f2
 = ((
f1
 >> 3Ë* (f1 >> 3Ë+ (
f3
 >> 3) * (f3 >> 3)) >> 9;

572 i‡(!
f2
) {

573 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Divide by 0\n");

574  
Ál£
;

578 
mag_tx
 = 
f1
 * (
mag_a0_d0
 - 
mag_a1_d0
Ë+ 
f3
 * (
phs_a0_d0
 - 
phs_a1_d0
);

580 
phs_tx
 = 
f3
 * (-
mag_a0_d0
 + 
mag_a1_d0
Ë+ 
f1
 * (
phs_a0_d0
 - 
phs_a1_d0
);

582 
mag_tx
 = (mag_tx / 
f2
);

583 
phs_tx
 = (phs_tx / 
f2
);

586 
mag_rx
 = 
mag_a0_d0
 - (
cos_2phi_1
 * 
mag_tx
 + 
sö_2phi_1
 * 
phs_tx
) /

587 
ªsu…_shi·
;

589 
phs_rx
 = 
phs_a0_d0
 + (
sö_2phi_1
 * 
mag_tx
 - 
cos_2phi_1
 * 
phs_tx
) /

590 
ªsu…_shi·
;

592 
sﬁved_eq
[0] = 
mag_tx
;

593 
sﬁved_eq
[1] = 
phs_tx
;

594 
sﬁved_eq
[2] = 
mag_rx
;

595 
sﬁved_eq
[3] = 
phs_rx
;

597  
åue
;

598 
	}
}

600 
s32
 
	$¨9003_hw_föd_mag_≠¥ox
(
©h_hw
 *
ah
, 
s32
 
ö_ª
, s32 
ö_im
)

602 
s32
 
abs_i
 = 
	`abs
(
ö_ª
),

603 
abs_q
 = 
	`abs
(
ö_im
),

604 
max_abs
, 
mö_abs
;

606 i‡(
abs_i
 > 
abs_q
) {

607 
max_abs
 = 
abs_i
;

608 
mö_abs
 = 
abs_q
;

610 
max_abs
 = 
abs_q
;

611 
mö_abs
 = 
abs_i
;

614  
max_abs
 - (max_ab†/ 32Ë+ (
mö_abs
 / 8) + (min_abs / 4);

615 
	}
}

617 
	#DELPT
 32

	)

619 
boﬁ
 
	$¨9003_hw_ˇlc_iq_c‹r
(
©h_hw
 *
ah
,

620 
s32
 
chaö_idx
,

621 c⁄° 
s32
 
iq_ªs
[],

622 
s32
 
iqc_c€ff
[])

624 
s32
 
i2_m_q2_a0_d0
, 
i2_p_q2_a0_d0
, 
iq_c‹r_a0_d0
,

625 
i2_m_q2_a0_d1
, 
i2_p_q2_a0_d1
, 
iq_c‹r_a0_d1
,

626 
i2_m_q2_a1_d0
, 
i2_p_q2_a1_d0
, 
iq_c‹r_a1_d0
,

627 
i2_m_q2_a1_d1
, 
i2_p_q2_a1_d1
, 
iq_c‹r_a1_d1
;

628 
s32
 
mag_a0_d0
, 
mag_a1_d0
, 
mag_a0_d1
, 
mag_a1_d1
,

629 
phs_a0_d0
, 
phs_a1_d0
, 
phs_a0_d1
, 
phs_a1_d1
,

630 
sö_2phi_1
, 
cos_2phi_1
,

631 
sö_2phi_2
, 
cos_2phi_2
;

632 
s32
 
mag_tx
, 
phs_tx
, 
mag_rx
, 
phs_rx
;

633 
s32
 
sﬁved_eq
[4], 
mag_c‹r_tx
, 
phs_c‹r_tx
, 
mag_c‹r_rx
, 
phs_c‹r_rx
,

634 
q_q_coff
, 
q_i_coff
;

635 c⁄° 
s32
 
ªs_sˇÀ
 = 1 << 15;

636 c⁄° 
s32
 
dñ±_shi·
 = 1 << 8;

637 
s32
 
mag1
, 
mag2
;

638 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

640 
i2_m_q2_a0_d0
 = 
iq_ªs
[0] & 0xfff;

641 
i2_p_q2_a0_d0
 = (
iq_ªs
[0] >> 12) & 0xfff;

642 
iq_c‹r_a0_d0
 = ((
iq_ªs
[0] >> 24) & 0xff) + ((iq_res[1] & 0xf) << 8);

644 i‡(
i2_m_q2_a0_d0
 > 0x800)

645 
i2_m_q2_a0_d0
 = -((0xfff - i2_m_q2_a0_d0) + 1);

647 i‡(
i2_p_q2_a0_d0
 > 0x800)

648 
i2_p_q2_a0_d0
 = -((0xfff - i2_p_q2_a0_d0) + 1);

650 i‡(
iq_c‹r_a0_d0
 > 0x800)

651 
iq_c‹r_a0_d0
 = -((0xfff - iq_corr_a0_d0) + 1);

653 
i2_m_q2_a0_d1
 = (
iq_ªs
[1] >> 4) & 0xfff;

654 
i2_p_q2_a0_d1
 = (
iq_ªs
[2] & 0xfff);

655 
iq_c‹r_a0_d1
 = (
iq_ªs
[2] >> 12) & 0xfff;

657 i‡(
i2_m_q2_a0_d1
 > 0x800)

658 
i2_m_q2_a0_d1
 = -((0xfff - i2_m_q2_a0_d1) + 1);

660 i‡(
iq_c‹r_a0_d1
 > 0x800)

661 
iq_c‹r_a0_d1
 = -((0xfff - iq_corr_a0_d1) + 1);

663 
i2_m_q2_a1_d0
 = ((
iq_ªs
[2] >> 24) & 0xff) + ((iq_res[3] & 0xf) << 8);

664 
i2_p_q2_a1_d0
 = (
iq_ªs
[3] >> 4) & 0xfff;

665 
iq_c‹r_a1_d0
 = 
iq_ªs
[4] & 0xfff;

667 i‡(
i2_m_q2_a1_d0
 > 0x800)

668 
i2_m_q2_a1_d0
 = -((0xfff - i2_m_q2_a1_d0) + 1);

670 i‡(
i2_p_q2_a1_d0
 > 0x800)

671 
i2_p_q2_a1_d0
 = -((0xfff - i2_p_q2_a1_d0) + 1);

673 i‡(
iq_c‹r_a1_d0
 > 0x800)

674 
iq_c‹r_a1_d0
 = -((0xfff - iq_corr_a1_d0) + 1);

676 
i2_m_q2_a1_d1
 = (
iq_ªs
[4] >> 12) & 0xfff;

677 
i2_p_q2_a1_d1
 = ((
iq_ªs
[4] >> 24) & 0xff) + ((iq_res[5] & 0xf) << 8);

678 
iq_c‹r_a1_d1
 = (
iq_ªs
[5] >> 4) & 0xfff;

680 i‡(
i2_m_q2_a1_d1
 > 0x800)

681 
i2_m_q2_a1_d1
 = -((0xfff - i2_m_q2_a1_d1) + 1);

683 i‡(
i2_p_q2_a1_d1
 > 0x800)

684 
i2_p_q2_a1_d1
 = -((0xfff - i2_p_q2_a1_d1) + 1);

686 i‡(
iq_c‹r_a1_d1
 > 0x800)

687 
iq_c‹r_a1_d1
 = -((0xfff - iq_corr_a1_d1) + 1);

689 i‡((
i2_p_q2_a0_d0
 =0Ë|| (
i2_p_q2_a0_d1
 == 0) ||

690 (
i2_p_q2_a1_d0
 =0Ë|| (
i2_p_q2_a1_d1
 == 0)) {

691 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

697 
i2_p_q2_a0_d0
, 
i2_p_q2_a0_d1
,

698 
i2_p_q2_a1_d0
, 
i2_p_q2_a1_d1
);

699  
Ál£
;

702 i‡((
i2_p_q2_a0_d0
 < 1024) || (i2_p_q2_a0_d0 > 2047) ||

703 (
i2_p_q2_a1_d0
 < 0Ë|| (
i2_p_q2_a1_d1
 < 0) ||

704 (
i2_p_q2_a0_d0
 <
i2_m_q2_a0_d0
) ||

705 (
i2_p_q2_a0_d0
 <
iq_c‹r_a0_d0
) ||

706 (
i2_p_q2_a0_d1
 <
i2_m_q2_a0_d1
) ||

707 (
i2_p_q2_a0_d1
 <
iq_c‹r_a0_d1
) ||

708 (
i2_p_q2_a1_d0
 <
i2_m_q2_a1_d0
) ||

709 (
i2_p_q2_a1_d0
 <
iq_c‹r_a1_d0
) ||

710 (
i2_p_q2_a1_d1
 <
i2_m_q2_a1_d1
) ||

711 (
i2_p_q2_a1_d1
 <
iq_c‹r_a1_d1
)) {

712  
Ál£
;

715 
mag_a0_d0
 = (
i2_m_q2_a0_d0
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a0_d0
;

716 
phs_a0_d0
 = (
iq_c‹r_a0_d0
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a0_d0
;

718 
mag_a0_d1
 = (
i2_m_q2_a0_d1
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a0_d1
;

719 
phs_a0_d1
 = (
iq_c‹r_a0_d1
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a0_d1
;

721 
mag_a1_d0
 = (
i2_m_q2_a1_d0
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a1_d0
;

722 
phs_a1_d0
 = (
iq_c‹r_a1_d0
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a1_d0
;

724 
mag_a1_d1
 = (
i2_m_q2_a1_d1
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a1_d1
;

725 
phs_a1_d1
 = (
iq_c‹r_a1_d1
 * 
ªs_sˇÀ
Ë/ 
i2_p_q2_a1_d1
;

728 
sö_2phi_1
 = (((
mag_a0_d0
 - 
mag_a0_d1
Ë* 
dñ±_shi·
Ë/ 
DELPT
);

730 
cos_2phi_1
 = (((
phs_a0_d1
 - 
phs_a0_d0
Ë* 
dñ±_shi·
Ë/ 
DELPT
);

732 
sö_2phi_2
 = (((
mag_a1_d0
 - 
mag_a1_d1
Ë* 
dñ±_shi·
Ë/ 
DELPT
);

734 
cos_2phi_2
 = (((
phs_a1_d1
 - 
phs_a1_d0
Ë* 
dñ±_shi·
Ë/ 
DELPT
);

740 
mag1
 = 
	`¨9003_hw_föd_mag_≠¥ox
(
ah
, 
cos_2phi_1
, 
sö_2phi_1
);

741 
mag2
 = 
	`¨9003_hw_föd_mag_≠¥ox
(
ah
, 
cos_2phi_2
, 
sö_2phi_2
);

743 i‡((
mag1
 =0Ë|| (
mag2
 == 0)) {

744 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Divide by 0: mag1=%d, mag2=%d\n",

745 
mag1
, 
mag2
);

746  
Ál£
;

750 
sö_2phi_1
 = (sö_2phi_1 * 
ªs_sˇÀ
 / 
mag1
);

751 
cos_2phi_1
 = (cos_2phi_1 * 
ªs_sˇÀ
 / 
mag1
);

752 
sö_2phi_2
 = (sö_2phi_2 * 
ªs_sˇÀ
 / 
mag2
);

753 
cos_2phi_2
 = (cos_2phi_2 * 
ªs_sˇÀ
 / 
mag2
);

756 i‡(!
	`¨9003_hw_sﬁve_iq_ˇl
(
ah
,

757 
sö_2phi_1
, 
cos_2phi_1
,

758 
sö_2phi_2
, 
cos_2phi_2
,

759 
mag_a0_d0
, 
phs_a0_d0
,

760 
mag_a1_d0
,

761 
phs_a1_d0
, 
sﬁved_eq
)) {

762 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

764  
Ál£
;

767 
mag_tx
 = 
sﬁved_eq
[0];

768 
phs_tx
 = 
sﬁved_eq
[1];

769 
mag_rx
 = 
sﬁved_eq
[2];

770 
phs_rx
 = 
sﬁved_eq
[3];

772 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

774 
chaö_idx
, 
mag_tx
/
ªs_sˇÀ
, 
phs_tx
/res_scale);

776 i‡(
ªs_sˇÀ
 =
mag_tx
) {

777 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

779 
mag_tx
, 
ªs_sˇÀ
);

780  
Ál£
;

784 
mag_c‹r_tx
 = (
mag_tx
 * 
ªs_sˇÀ
) / (res_scale - mag_tx);

785 
phs_c‹r_tx
 = -
phs_tx
;

787 
q_q_coff
 = (
mag_c‹r_tx
 * 128 / 
ªs_sˇÀ
);

788 
q_i_coff
 = (
phs_c‹r_tx
 * 256 / 
ªs_sˇÀ
);

790 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "tx chain %d: mag corr=%dÖhase corr=%d\n",

791 
chaö_idx
, 
q_q_coff
, 
q_i_coff
);

793 i‡(
q_i_coff
 < -63)

794 
q_i_coff
 = -63;

795 i‡(
q_i_coff
 > 63)

796 
q_i_coff
 = 63;

797 i‡(
q_q_coff
 < -63)

798 
q_q_coff
 = -63;

799 i‡(
q_q_coff
 > 63)

800 
q_q_coff
 = 63;

802 
iqc_c€ff
[0] = (
q_q_coff
 * 128Ë+ (0x7‡& 
q_i_coff
);

804 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "tx chain %d: iq corr coeff=%x\n",

805 
chaö_idx
, 
iqc_c€ff
[0]);

807 i‡(-
mag_rx
 =
ªs_sˇÀ
) {

808 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

810 
mag_rx
, 
ªs_sˇÀ
);

811  
Ál£
;

815 
mag_c‹r_rx
 = (-
mag_rx
 * 
ªs_sˇÀ
) / (res_scale + mag_rx);

816 
phs_c‹r_rx
 = -
phs_rx
;

818 
q_q_coff
 = (
mag_c‹r_rx
 * 128 / 
ªs_sˇÀ
);

819 
q_i_coff
 = (
phs_c‹r_rx
 * 256 / 
ªs_sˇÀ
);

821 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "rx chain %d: mag corr=%dÖhase corr=%d\n",

822 
chaö_idx
, 
q_q_coff
, 
q_i_coff
);

824 i‡(
q_i_coff
 < -63)

825 
q_i_coff
 = -63;

826 i‡(
q_i_coff
 > 63)

827 
q_i_coff
 = 63;

828 i‡(
q_q_coff
 < -63)

829 
q_q_coff
 = -63;

830 i‡(
q_q_coff
 > 63)

831 
q_q_coff
 = 63;

833 
iqc_c€ff
[1] = (
q_q_coff
 * 128Ë+ (0x7‡& 
q_i_coff
);

835 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "rx chain %d: iq corr coeff=%x\n",

836 
chaö_idx
, 
iqc_c€ff
[1]);

838  
åue
;

839 
	}
}

841 
	$¨9003_hw_dëe˘_ouéõr
(
mp_c€ff
[][
MAXIQCAL
],

842 
nmósuªmít
,

843 
max_dñè
)

845 
mp_max
 = -64, 
max_idx
 = 0;

846 
mp_mö
 = 63, 
mö_idx
 = 0;

847 
mp_avg
 = 0, 
i
, 
ouéõr_idx
 = 0, 
mp_cou¡
 = 0;

850 
i
 = 0; i < 
nmósuªmít
; i++) {

851 i‡(
mp_c€ff
[
i
][0] > 
mp_max
) {

852 
mp_max
 = 
mp_c€ff
[
i
][0];

853 
max_idx
 = 
i
;

854 } i‡(
mp_c€ff
[
i
][0] < 
mp_mö
) {

855 
mp_mö
 = 
mp_c€ff
[
i
][0];

856 
mö_idx
 = 
i
;

861 
i
 = 0; i < 
nmósuªmít
; i++) {

862 i‡((
	`abs
(
mp_c€ff
[
i
][0]Ë<ábs(
mp_max
)) ||

863 (
	`abs
(
mp_c€ff
[
i
][0]Ë<ábs(
mp_mö
))) {

864 
mp_avg
 +
mp_c€ff
[
i
][0];

865 
mp_cou¡
++;

873 i‡(
mp_cou¡
)

874 
mp_avg
 /
mp_cou¡
;

876 
mp_avg
 = 
mp_c€ff
[
nmósuªmít
 - 1][0];

879 i‡(
	`abs
(
mp_max
 - 
mp_mö
Ë> 
max_dñè
) {

880 i‡(
	`abs
(
mp_max
 - 
mp_avg
Ë>ábs(
mp_mö
 - mp_avg))

881 
ouéõr_idx
 = 
max_idx
;

883 
ouéõr_idx
 = 
mö_idx
;

885 
mp_c€ff
[
ouéõr_idx
][0] = 
mp_avg
;

887 
	}
}

889 
	$¨9003_hw_tx_iq_ˇl_ouéõr_dëe˘i⁄
(
©h_hw
 *
ah
,

890 
c€ff
 *coeff,

891 
boﬁ
 
is_ªußbÀ
)

893 
i
, 
im
, 
nmósuªmít
;

894 
magnôude
, 
pha£
;

895 
u32
 
tx_c‹r_c€ff
[
MAX_MEASUREMENT
][
AR9300_MAX_CHAINS
];

896 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

898 
	`mem£t
(
tx_c‹r_c€ff
, 0, (tx_corr_coeff));

899 
i
 = 0; i < 
MAX_MEASUREMENT
 / 2; i++) {

900 
tx_c‹r_c€ff
[
i
 * 2][0] =Åx_corr_coeff[(i * 2) + 1][0] =

901 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B0
(
i
);

902 i‡(!
	`AR_SREV_9485
(
ah
)) {

903 
tx_c‹r_c€ff
[
i
 * 2][1] =

904 
tx_c‹r_c€ff
[(
i
 * 2) + 1][1] =

905 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B1
(
i
);

907 
tx_c‹r_c€ff
[
i
 * 2][2] =

908 
tx_c‹r_c€ff
[(
i
 * 2) + 1][2] =

909 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B2
(
i
);

914 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

915 i‡(!(
ah
->
txchaömask
 & (1 << 
i
)))

917 
nmósuªmít
 = 
	`REG_READ_FIELD
(
ah
,

918 
AR_PHY_TX_IQCAL_STATUS_B0
,

919 
AR_PHY_CALIBRATED_GAINS_0
);

921 i‡(
nmósuªmít
 > 
MAX_MEASUREMENT
)

922 
nmósuªmít
 = 
MAX_MEASUREMENT
;

927 i‡(!
	`AR_SREV_9550
(
ah
)) {

929 i‡(
nmósuªmít
 > 1) {

931 
	`¨9003_hw_dëe˘_ouéõr
(
c€ff
->
mag_c€ff
[
i
],

932 
nmósuªmít
,

933 
MAX_MAG_DELTA
);

936 
	`¨9003_hw_dëe˘_ouéõr
(
c€ff
->
phs_c€ff
[
i
],

937 
nmósuªmít
,

938 
MAX_PHS_DELTA
);

942 
im
 = 0; im < 
nmósuªmít
; im++) {

943 
magnôude
 = 
c€ff
->
mag_c€ff
[
i
][
im
][0];

944 
pha£
 = 
c€ff
->
phs_c€ff
[
i
][
im
][0];

946 
c€ff
->
iqc_c€ff
[0] =

947 (
pha£
 & 0x7fË| ((
magnôude
 & 0x7f) << 7);

949 i‡((
im
 % 2) == 0)

950 
	`REG_RMW_FIELD
(
ah
, 
tx_c‹r_c€ff
[
im
][
i
],

951 
AR_PHY_TX_IQCAL_CORR_COEFF_00_COEFF_TABLE
,

952 
c€ff
->
iqc_c€ff
[0]);

954 
	`REG_RMW_FIELD
(
ah
, 
tx_c‹r_c€ff
[
im
][
i
],

955 
AR_PHY_TX_IQCAL_CORR_COEFF_01_COEFF_TABLE
,

956 
c€ff
->
iqc_c€ff
[0]);

958 i‡(
ˇld©a
)

959 
ˇld©a
->
tx_c‹r_c€ff
[
im
][
i
] =

960 
c€ff
->
iqc_c€ff
[0];

962 i‡(
ˇld©a
)

963 
ˇld©a
->
num_mósuªs
[
i
] = 
nmósuªmít
;

966 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_3
,

967 
AR_PHY_TX_IQCAL_CONTROL_3_IQCORR_EN
, 0x1);

968 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RX_IQCAL_CORR_B0
,

969 
AR_PHY_RX_IQCAL_CORR_B0_LOOPBACK_IQCORR_EN
, 0x1);

971 i‡(
ˇld©a
) {

972 i‡(
is_ªußbÀ
)

973 
	`£t_bô
(
TXIQCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

975 
	`˛ór_bô
(
TXIQCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

979 
	}
}

981 
boﬁ
 
	$¨9003_hw_tx_iq_ˇl_run
(
©h_hw
 *
ah
)

983 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

984 
u8
 
tx_gaö_f‹˚d
;

986 
tx_gaö_f‹˚d
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

987 
AR_PHY_TXGAIN_FORCE
);

988 i‡(
tx_gaö_f‹˚d
)

989 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

990 
AR_PHY_TXGAIN_FORCE
, 0);

992 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_START
,

993 
AR_PHY_TX_IQCAL_START_DO_CAL
, 1);

995 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_TX_IQCAL_START
,

996 
AR_PHY_TX_IQCAL_START_DO_CAL
, 0,

997 
AH_WAIT_TIMEOUT
)) {

998 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Tx IQ Cal isÇot completed\n");

999  
Ál£
;

1001  
åue
;

1002 
	}
}

1004 
	$__¨955x_tx_iq_ˇl_s‹t
(
©h_hw
 *
ah
,

1005 
c€ff
 *coeff,

1006 
i
, 
nmósuªmít
)

1008 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1009 
im
, 
ix
, 
iy
, 
ãmp
;

1011 
im
 = 0; im < 
nmósuªmít
; im++) {

1012 
ix
 = 0; ix < 
MAXIQCAL
 - 1; ix++) {

1013 
iy
 = 
ix
 + 1; iy <
MAXIQCAL
 - 1; iy++) {

1014 i‡(
c€ff
->
mag_c€ff
[
i
][
im
][
iy
] <

1015 
c€ff
->
mag_c€ff
[
i
][
im
][
ix
]) {

1016 
ãmp
 = 
c€ff
->
mag_c€ff
[
i
][
im
][
ix
];

1017 
c€ff
->
mag_c€ff
[
i
][
im
][
ix
] =

1018 
c€ff
->
mag_c€ff
[
i
][
im
][
iy
];

1019 
c€ff
->
mag_c€ff
[
i
][
im
][
iy
] = 
ãmp
;

1021 i‡(
c€ff
->
phs_c€ff
[
i
][
im
][
iy
] <

1022 
c€ff
->
phs_c€ff
[
i
][
im
][
ix
]) {

1023 
ãmp
 = 
c€ff
->
phs_c€ff
[
i
][
im
][
ix
];

1024 
c€ff
->
phs_c€ff
[
i
][
im
][
ix
] =

1025 
c€ff
->
phs_c€ff
[
i
][
im
][
iy
];

1026 
c€ff
->
phs_c€ff
[
i
][
im
][
iy
] = 
ãmp
;

1030 
c€ff
->
mag_c€ff
[
i
][
im
][0] = c€ff->mag_c€ff[i][im][
MAXIQCAL
 / 2];

1031 
c€ff
->
phs_c€ff
[
i
][
im
][0] = c€ff->phs_c€ff[i][im][
MAXIQCAL
 / 2];

1033 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1035 
i
, 
im
,

1036 
c€ff
->
mag_c€ff
[
i
][
im
][0],

1037 
c€ff
->
phs_c€ff
[
i
][
im
][0]);

1039 
	}
}

1041 
boﬁ
 
	$¨955x_tx_iq_ˇl_medün
(
©h_hw
 *
ah
,

1042 
c€ff
 *coeff,

1043 
iqˇl_idx
,

1044 
nmósuªmít
)

1046 
i
;

1048 i‡((
iqˇl_idx
 + 1Ë!
MAXIQCAL
)

1049  
Ál£
;

1051 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1052 
	`__¨955x_tx_iq_ˇl_s‹t
(
ah
, 
c€ff
, 
i
, 
nmósuªmít
);

1055  
åue
;

1056 
	}
}

1058 
	$¨9003_hw_tx_iq_ˇl_po°_¥oc
(
©h_hw
 *
ah
,

1059 
iqˇl_idx
,

1060 
boﬁ
 
is_ªußbÀ
)

1062 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1063 c⁄° 
u32
 
txiqˇl_°©us
[
AR9300_MAX_CHAINS
] = {

1064 
AR_PHY_TX_IQCAL_STATUS_B0
,

1065 
AR_PHY_TX_IQCAL_STATUS_B1
,

1066 
AR_PHY_TX_IQCAL_STATUS_B2
,

1068 c⁄° 
u_öt32_t
 
ch™_öfo_èb
[] = {

1069 
AR_PHY_CHAN_INFO_TAB_0
,

1070 
AR_PHY_CHAN_INFO_TAB_1
,

1071 
AR_PHY_CHAN_INFO_TAB_2
,

1073 
c€ff
 coeff;

1074 
s32
 
iq_ªs
[6];

1075 
i
, 
im
, 
j
;

1076 
nmósuªmít
 = 0;

1077 
boﬁ
 
ouéõr_dëe˘
 = 
åue
;

1079 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1080 i‡(!(
ah
->
txchaömask
 & (1 << 
i
)))

1083 
nmósuªmít
 = 
	`REG_READ_FIELD
(
ah
,

1084 
AR_PHY_TX_IQCAL_STATUS_B0
,

1085 
AR_PHY_CALIBRATED_GAINS_0
);

1086 i‡(
nmósuªmít
 > 
MAX_MEASUREMENT
)

1087 
nmósuªmít
 = 
MAX_MEASUREMENT
;

1089 
im
 = 0; im < 
nmósuªmít
; im++) {

1090 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1091 "Doög Tx IQ CÆ f‹ chaö %d\n", 
i
);

1093 i‡(
	`REG_READ
(
ah
, 
txiqˇl_°©us
[
i
]) &

1094 
AR_PHY_TX_IQCAL_STATUS_FAILED
) {

1095 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1096 "Tx IQ CÆ faûed f‹ chaö %d\n", 
i
);

1097 
tx_iqˇl_Áû
;

1100 
j
 = 0; j < 3; j++) {

1101 
u32
 
idx
 = 2 * 
j
, 
off£t
 = 4 * (3 * 
im
 + j);

1103 
	`REG_RMW_FIELD
(
ah
,

1104 
AR_PHY_CHAN_INFO_MEMORY
,

1105 
AR_PHY_CHAN_INFO_TAB_S2_READ
,

1109 
iq_ªs
[
idx
] = 
	`REG_READ
(
ah
,

1110 
ch™_öfo_èb
[
i
] +

1111 
off£t
);

1113 
	`REG_RMW_FIELD
(
ah
,

1114 
AR_PHY_CHAN_INFO_MEMORY
,

1115 
AR_PHY_CHAN_INFO_TAB_S2_READ
,

1119 
iq_ªs
[
idx
 + 1] = 0xfff‡& 
	`REG_READ
(
ah
,

1120 
ch™_öfo_èb
[
i
] + 
off£t
);

1122 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1124 
idx
, 
iq_ªs
[idx], idx + 1,

1125 
iq_ªs
[
idx
 + 1]);

1128 i‡(!
	`¨9003_hw_ˇlc_iq_c‹r
(
ah
, 
i
, 
iq_ªs
,

1129 
c€ff
.
iqc_c€ff
)) {

1130 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1132 
tx_iqˇl_Áû
;

1135 
c€ff
.
phs_c€ff
[
i
][
im
][
iqˇl_idx
] =

1136 
c€ff
.
iqc_c€ff
[0] & 0x7f;

1137 
c€ff
.
mag_c€ff
[
i
][
im
][
iqˇl_idx
] =

1138 (
c€ff
.
iqc_c€ff
[0] >> 7) & 0x7f;

1140 i‡(
c€ff
.
mag_c€ff
[
i
][
im
][
iqˇl_idx
] > 63)

1141 
c€ff
.
mag_c€ff
[
i
][
im
][
iqˇl_idx
] -= 128;

1142 i‡(
c€ff
.
phs_c€ff
[
i
][
im
][
iqˇl_idx
] > 63)

1143 
c€ff
.
phs_c€ff
[
i
][
im
][
iqˇl_idx
] -= 128;

1147 i‡(
	`AR_SREV_9550
(
ah
))

1148 
ouéõr_dëe˘
 = 
	`¨955x_tx_iq_ˇl_medün
(
ah
, &
c€ff
,

1149 
iqˇl_idx
, 
nmósuªmít
);

1150 i‡(
ouéõr_dëe˘
)

1151 
	`¨9003_hw_tx_iq_ˇl_ouéõr_dëe˘i⁄
(
ah
, &
c€ff
, 
is_ªußbÀ
);

1155 
tx_iqˇl_Áû
:

1156 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Tx IQ Cal failed\n");

1158 
	}
}

1160 
	$¨9003_hw_tx_iq_ˇl_ªlﬂd
(
©h_hw
 *
ah
)

1162 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

1163 
u32
 
tx_c‹r_c€ff
[
MAX_MEASUREMENT
][
AR9300_MAX_CHAINS
];

1164 
i
, 
im
;

1166 
	`mem£t
(
tx_c‹r_c€ff
, 0, (tx_corr_coeff));

1167 
i
 = 0; i < 
MAX_MEASUREMENT
 / 2; i++) {

1168 
tx_c‹r_c€ff
[
i
 * 2][0] =Åx_corr_coeff[(i * 2) + 1][0] =

1169 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B0
(
i
);

1170 i‡(!
	`AR_SREV_9485
(
ah
)) {

1171 
tx_c‹r_c€ff
[
i
 * 2][1] =

1172 
tx_c‹r_c€ff
[(
i
 * 2) + 1][1] =

1173 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B1
(
i
);

1175 
tx_c‹r_c€ff
[
i
 * 2][2] =

1176 
tx_c‹r_c€ff
[(
i
 * 2) + 1][2] =

1177 
	`AR_PHY_TX_IQCAL_CORR_COEFF_B2
(
i
);

1181 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1182 i‡(!(
ah
->
txchaömask
 & (1 << 
i
)))

1185 
im
 = 0; im < 
ˇld©a
->
num_mósuªs
[
i
]; im++) {

1186 i‡((
im
 % 2) == 0)

1187 
	`REG_RMW_FIELD
(
ah
, 
tx_c‹r_c€ff
[
im
][
i
],

1188 
AR_PHY_TX_IQCAL_CORR_COEFF_00_COEFF_TABLE
,

1189 
ˇld©a
->
tx_c‹r_c€ff
[
im
][
i
]);

1191 
	`REG_RMW_FIELD
(
ah
, 
tx_c‹r_c€ff
[
im
][
i
],

1192 
AR_PHY_TX_IQCAL_CORR_COEFF_01_COEFF_TABLE
,

1193 
ˇld©a
->
tx_c‹r_c€ff
[
im
][
i
]);

1197 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_3
,

1198 
AR_PHY_TX_IQCAL_CONTROL_3_IQCORR_EN
, 0x1);

1199 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RX_IQCAL_CORR_B0
,

1200 
AR_PHY_RX_IQCAL_CORR_B0_LOOPBACK_IQCORR_EN
, 0x1);

1201 
	}
}

1203 
	$¨9003_hw_m™uÆ_≥ak_ˇl
(
©h_hw
 *
ah
, 
u8
 
chaö
, 
boﬁ
 
is_2g
)

1205 
off£t
[8] = {0}, 
tŸÆ
 = 0, 
ã°
;

1206 
agc_out
, 
i
, 
≥ak_dëe˘_thªshﬁd
;

1208 i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
(ah))

1209 
≥ak_dëe˘_thªshﬁd
 = 8;

1211 
≥ak_dëe˘_thªshﬁd
 = 0;

1216 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_GAINSTAGES
(
chaö
),

1217 
AR_PHY_65NM_RXRF_GAINSTAGES_RX_OVERRIDE
, 0x1);

1218 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_GAINSTAGES
(
chaö
),

1219 
AR_PHY_65NM_RXRF_GAINSTAGES_LNAON_CALDC
, 0x0);

1221 i‡(
	`AR_SREV_9003_PCOEM
(
ah
Ë|| 
	`AR_SREV_9330_11
(ah)) {

1222 i‡(
is_2g
)

1223 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_GAINSTAGES
(
chaö
),

1224 
AR_PHY_65NM_RXRF_GAINSTAGES_LNA2G_GAIN_OVR
, 0x0);

1226 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_GAINSTAGES
(
chaö
),

1227 
AR_PHY_65NM_RXRF_GAINSTAGES_LNA5G_GAIN_OVR
, 0x0);

1233 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXTX2
(
chaö
),

1234 
AR_PHY_65NM_RXTX2_RXON_OVR
, 0x1);

1235 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXTX2
(
chaö
),

1236 
AR_PHY_65NM_RXTX2_RXON
, 0x0);

1241 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1242 
AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE
, 0x1);

1243 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1244 
AR_PHY_65NM_RXRF_AGC_AGC_ON_OVR
, 0x1);

1245 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1246 
AR_PHY_65NM_RXRF_AGC_AGC_CAL_OVR
, 0x1);

1248 i‡(
	`AR_SREV_9330_11
(
ah
))

1249 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1250 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
, 0x0);

1252 i‡(
	`AR_SREV_9003_PCOEM
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9531
(ah) ||

1253 
	`AR_SREV_9561
(
ah
)) {

1254 i‡(
is_2g
)

1255 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1256 
AR_PHY_65NM_RXRF_AGC_AGC2G_DBDAC_OVR
,

1257 
≥ak_dëe˘_thªshﬁd
);

1259 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1260 
AR_PHY_65NM_RXRF_AGC_AGC5G_DBDAC_OVR
,

1261 
≥ak_dëe˘_thªshﬁd
);

1264 
i
 = 6; i > 0; i--) {

1265 
off£t
[
i
] = 
	`BIT
(i - 1);

1266 
ã°
 = 
tŸÆ
 + 
off£t
[
i
];

1268 i‡(
is_2g
)

1269 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1270 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
,

1271 
ã°
);

1273 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1274 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
,

1275 
ã°
);

1276 
	`udñay
(100);

1277 
agc_out
 = 
	`REG_READ_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1278 
AR_PHY_65NM_RXRF_AGC_AGC_OUT
);

1279 
off£t
[
i
] = (
agc_out
) ? 0 : 1;

1280 
tŸÆ
 +(
off£t
[
i
] << (i - 1));

1283 i‡(
is_2g
)

1284 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1285 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
, 
tŸÆ
);

1287 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1288 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
, 
tŸÆ
);

1293 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_GAINSTAGES
(
chaö
),

1294 
AR_PHY_65NM_RXRF_GAINSTAGES_RX_OVERRIDE
, 0);

1298 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXTX2
(
chaö
),

1299 
AR_PHY_65NM_RXTX2_RXON_OVR
, 0);

1303 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

1304 
AR_PHY_65NM_RXRF_AGC_AGC_CAL_OVR
, 0);

1305 
	}
}

1307 
	$¨9003_hw_do_pc€m_m™uÆ_≥ak_ˇl
(
©h_hw
 *
ah
,

1308 
©h9k_ch™√l
 *
ch™
,

1309 
boﬁ
 
run_πt_ˇl
)

1311 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

1312 
i
;

1314 i‡(!
	`AR_SREV_9462
(
ah
Ë&& !
	`AR_SREV_9565
◊hË&& !
	`AR_SREV_9485
(ah))

1317 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RTT
Ë&& !
run_πt_ˇl
)

1320 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1321 i‡(!(
ah
->
rxchaömask
 & (1 << 
i
)))

1323 
	`¨9003_hw_m™uÆ_≥ak_ˇl
(
ah
, 
i
, 
	`IS_CHAN_2GHZ
(
ch™
));

1326 i‡(
ˇld©a
)

1327 
	`£t_bô
(
SW_PKDET_DONE
, &
ˇld©a
->
ˇl_Êags
);

1329 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RTT
Ë&& 
ˇld©a
) {

1330 i‡(
	`IS_CHAN_2GHZ
(
ch™
)){

1331 
ˇld©a
->
ˇldac
[0] = 
	`REG_READ_FIELD
(
ah
,

1332 
	`AR_PHY_65NM_RXRF_AGC
(0),

1333 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
);

1334 
ˇld©a
->
ˇldac
[1] = 
	`REG_READ_FIELD
(
ah
,

1335 
	`AR_PHY_65NM_RXRF_AGC
(1),

1336 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
);

1338 
ˇld©a
->
ˇldac
[0] = 
	`REG_READ_FIELD
(
ah
,

1339 
	`AR_PHY_65NM_RXRF_AGC
(0),

1340 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
);

1341 
ˇld©a
->
ˇldac
[1] = 
	`REG_READ_FIELD
(
ah
,

1342 
	`AR_PHY_65NM_RXRF_AGC
(1),

1343 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
);

1346 
	}
}

1348 
	$¨9003_hw_˛_ˇl_po°_¥oc
(
©h_hw
 *
ah
, 
boﬁ
 
is_ªußbÀ
)

1350 
u32
 
˛_idx
[
AR9300_MAX_CHAINS
] = { 
AR_PHY_CL_TAB_0
,

1351 
AR_PHY_CL_TAB_1
,

1352 
AR_PHY_CL_TAB_2
 };

1353 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

1354 
boﬁ
 
tx˛ˇl_d⁄e
 = 
Ál£
;

1355 
i
, 
j
;

1357 i‡(!
ˇld©a
 || !(
ah
->
íabÀd_ˇls
 & 
TX_CL_CAL
))

1360 
tx˛ˇl_d⁄e
 = !!(
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
) &

1361 
AR_PHY_AGC_CONTROL_CLC_SUCCESS
);

1363 i‡(
	`ã°_bô
(
TXCLCAL_DONE
, &
ˇld©a
->
ˇl_Êags
)) {

1364 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1365 i‡(!(
ah
->
txchaömask
 & (1 << 
i
)))

1367 
j
 = 0; j < 
MAX_CL_TAB_ENTRY
; j++)

1368 
	`REG_WRITE
(
ah
, 
	`CL_TAB_ENTRY
(
˛_idx
[
i
]),

1369 
ˇld©a
->
tx_˛ˇl
[
i
][
j
]);

1371 } i‡(
is_ªußbÀ
 && 
tx˛ˇl_d⁄e
) {

1372 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1373 i‡(!(
ah
->
txchaömask
 & (1 << 
i
)))

1375 
j
 = 0; j < 
MAX_CL_TAB_ENTRY
; j++)

1376 
ˇld©a
->
tx_˛ˇl
[
i
][
j
] =

1377 
	`REG_READ
(
ah
, 
	`CL_TAB_ENTRY
(
˛_idx
[
i
]));

1379 
	`£t_bô
(
TXCLCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

1381 
	}
}

1383 
boﬁ
 
	$¨9003_hw_öô_ˇl_pc€m
(
©h_hw
 *
ah
,

1384 
©h9k_ch™√l
 *
ch™
)

1386 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1387 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

1388 
boﬁ
 
txiqˇl_d⁄e
 = 
Ál£
;

1389 
boﬁ
 
is_ªußbÀ
 = 
åue
, 
°©us
 =Årue;

1390 
boﬁ
 
run_πt_ˇl
 = 
Ál£
, 
run_agc_ˇl
;

1391 
boﬁ
 
πt
 = !!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RTT
);

1392 
u32
 
rx_dñay
 = 0;

1393 
u32
 
agc_˘æ
 = 0, 
agc_suµ_ˇls
 = 
AR_PHY_AGC_CONTROL_OFFSET_CAL
 |

1394 
AR_PHY_AGC_CONTROL_FLTR_CAL
 |

1395 
AR_PHY_AGC_CONTROL_PKDET_CAL
;

1398 
	`¨9003_hw_£t_chaö_masks
(
ah
,áh->
ˇps
.
rx_chaömask
,áh->ˇps.
tx_chaömask
);

1400 i‡(
πt
) {

1401 i‡(!
	`¨9003_hw_πt_ª°‹e
(
ah
, 
ch™
))

1402 
run_πt_ˇl
 = 
åue
;

1404 i‡(
run_πt_ˇl
)

1405 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "RTT calibrationÅo be done\n");

1408 
run_agc_ˇl
 = 
run_πt_ˇl
;

1410 i‡(
run_πt_ˇl
) {

1411 
	`¨9003_hw_πt_íabÀ
(
ah
);

1412 
	`¨9003_hw_πt_£t_mask
(
ah
, 0x00);

1413 
	`¨9003_hw_πt_˛ór_hi°
(
ah
);

1416 i‡(
πt
) {

1417 i‡(!
run_πt_ˇl
) {

1418 
agc_˘æ
 = 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
);

1419 
agc_suµ_ˇls
 &
agc_˘æ
;

1420 
agc_˘æ
 &~(
AR_PHY_AGC_CONTROL_OFFSET_CAL
 |

1421 
AR_PHY_AGC_CONTROL_FLTR_CAL
 |

1422 
AR_PHY_AGC_CONTROL_PKDET_CAL
);

1423 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
, 
agc_˘æ
);

1425 i‡(
ah
->
ah_Êags
 & 
AH_FASTCC
)

1426 
run_agc_ˇl
 = 
åue
;

1430 i‡(
ah
->
íabÀd_ˇls
 & 
TX_CL_CAL
) {

1431 i‡(
ˇld©a
 && 
	`ã°_bô
(
TXCLCAL_DONE
, &ˇld©a->
ˇl_Êags
))

1432 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
,

1433 
AR_PHY_CL_CAL_ENABLE
);

1435 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
,

1436 
AR_PHY_CL_CAL_ENABLE
);

1437 
run_agc_ˇl
 = 
åue
;

1441 i‡((
	`IS_CHAN_HALF_RATE
(
ch™
Ë|| 
	`IS_CHAN_QUARTER_RATE
(chan)) ||

1442 !(
ah
->
íabÀd_ˇls
 & 
TX_IQ_CAL
))

1443 
skù_tx_iqˇl
;

1446 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_1
,

1447 
AR_PHY_TX_IQCAL_CONTROL_1_IQCORR_I_Q_COFF_DELPT
,

1448 
DELPT
);

1454 i‡(
ah
->
íabÀd_ˇls
 & 
TX_IQ_ON_AGC_CAL
) {

1455 i‡(
ˇld©a
 && !
	`ã°_bô
(
TXIQCAL_DONE
, &ˇld©a->
ˇl_Êags
))

1456 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

1457 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
);

1459 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

1460 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
);

1461 
txiqˇl_d⁄e
 = 
run_agc_ˇl
 = 
åue
;

1464 
skù_tx_iqˇl
:

1465 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
Ë&& 
	`IS_CHAN_2GHZ
(
ch™
Ë&& 
run_agc_ˇl
)

1466 
	`¨9003_mci_öô_ˇl_ªq
(
ah
, &
is_ªußbÀ
);

1468 i‡(
	`REG_READ
(
ah
, 
AR_PHY_CL_CAL_CTL
Ë& 
AR_PHY_CL_CAL_ENABLE
) {

1469 
rx_dñay
 = 
	`REG_READ
(
ah
, 
AR_PHY_RX_DELAY
);

1471 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_DIS
);

1472 
	`udñay
(5);

1473 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_DELAY
, 
AR_PHY_RX_DELAY_DELAY
);

1474 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

1477 i‡(
run_agc_ˇl
 || !(
ah
->
ah_Êags
 & 
AH_FASTCC
)) {

1479 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
,

1480 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
) |

1481 
AR_PHY_AGC_CONTROL_CAL
);

1484 
°©us
 = 
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

1485 
AR_PHY_AGC_CONTROL_CAL
,

1486 0, 
AH_WAIT_TIMEOUT
);

1488 
	`¨9003_hw_do_pc€m_m™uÆ_≥ak_ˇl
(
ah
, 
ch™
, 
run_πt_ˇl
);

1491 i‡(
	`REG_READ
(
ah
, 
AR_PHY_CL_CAL_CTL
Ë& 
AR_PHY_CL_CAL_ENABLE
) {

1492 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_DELAY
, 
rx_dñay
);

1493 
	`udñay
(5);

1496 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
Ë&& 
	`IS_CHAN_2GHZ
(
ch™
Ë&& 
run_agc_ˇl
)

1497 
	`¨9003_mci_öô_ˇl_d⁄e
(
ah
);

1499 i‡(
πt
 && !
run_πt_ˇl
) {

1500 
agc_˘æ
 |
agc_suµ_ˇls
;

1501 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
, 
agc_˘æ
);

1504 i‡(!
°©us
) {

1505 i‡(
run_πt_ˇl
)

1506 
	`¨9003_hw_πt_dißbÀ
(
ah
);

1508 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1510 
AH_WAIT_TIMEOUT
 / 1000);

1511  
Ál£
;

1514 i‡(
txiqˇl_d⁄e
)

1515 
	`¨9003_hw_tx_iq_ˇl_po°_¥oc
(
ah
, 0, 
is_ªußbÀ
);

1516 i‡(
ˇld©a
 && 
	`ã°_bô
(
TXIQCAL_DONE
, &ˇld©a->
ˇl_Êags
))

1517 
	`¨9003_hw_tx_iq_ˇl_ªlﬂd
(
ah
);

1519 
	`¨9003_hw_˛_ˇl_po°_¥oc
(
ah
, 
is_ªußbÀ
);

1521 i‡(
run_πt_ˇl
 && 
ˇld©a
) {

1522 i‡(
is_ªußbÀ
) {

1523 i‡(!
	`©h9k_hw_rfbus_ªq
(
ah
)) {

1524 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

1527 
	`¨9003_hw_πt_fûl_hi°
(
ah
);

1529 i‡(
	`ã°_bô
(
SW_PKDET_DONE
, &
ˇld©a
->
ˇl_Êags
))

1530 
	`¨9003_hw_πt_lﬂd_hi°
(
ah
);

1533 
	`©h9k_hw_rfbus_d⁄e
(
ah
);

1536 
	`¨9003_hw_πt_dißbÀ
(
ah
);

1540 
	`¨9003_hw_£t_chaö_masks
(
ah
,áh->
rxchaömask
,áh->
txchaömask
);

1543 
ah
->
ˇl_li°
 =áh->
ˇl_li°_œ°
 =áh->
ˇl_li°_cuº
 = 
NULL
;

1545 
	`INIT_CAL
(&
ah
->
iq_ˇld©a
);

1546 
	`INSERT_CAL
(
ah
, &ah->
iq_ˇld©a
);

1547 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "enabling IQ Calibration\n");

1550 
ah
->
ˇl_li°_cuº
 =áh->
ˇl_li°
;

1552 i‡(
ah
->
ˇl_li°_cuº
)

1553 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
,áh->
ˇl_li°_cuº
);

1555 i‡(
ˇld©a
)

1556 
ˇld©a
->
CÆVÆid
 = 0;

1558  
åue
;

1559 
	}
}

1561 
boﬁ
 
	$do_¨9003_agc_ˇl
(
©h_hw
 *
ah
)

1563 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1564 
boﬁ
 
°©us
;

1566 
	`REG_WRITE
(
ah
, 
AR_PHY_AGC_CONTROL
,

1567 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
) |

1568 
AR_PHY_AGC_CONTROL_CAL
);

1570 
°©us
 = 
	`©h9k_hw_waô
(
ah
, 
AR_PHY_AGC_CONTROL
,

1571 
AR_PHY_AGC_CONTROL_CAL
,

1572 0, 
AH_WAIT_TIMEOUT
);

1573 i‡(!
°©us
) {

1574 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

1577 
AH_WAIT_TIMEOUT
 / 1000);

1578  
Ál£
;

1581  
åue
;

1582 
	}
}

1584 
boﬁ
 
	$¨9003_hw_öô_ˇl_soc
(
©h_hw
 *
ah
,

1585 
©h9k_ch™√l
 *
ch™
)

1587 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1588 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

1589 
boﬁ
 
txiqˇl_d⁄e
 = 
Ál£
;

1590 
boﬁ
 
°©us
 = 
åue
;

1591 
boﬁ
 
run_agc_ˇl
 = 
Ál£
, 
£p_iq_ˇl
 = false;

1592 
i
 = 0;

1595 
	`¨9003_hw_£t_chaö_masks
(
ah
,áh->
ˇps
.
rx_chaömask
,áh->ˇps.
tx_chaömask
);

1597 i‡(
ah
->
íabÀd_ˇls
 & 
TX_CL_CAL
) {

1598 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CL_CAL_CTL
, 
AR_PHY_CL_CAL_ENABLE
);

1599 
run_agc_ˇl
 = 
åue
;

1602 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
Ë|| 
	`IS_CHAN_QUARTER_RATE
(chan))

1603 
skù_tx_iqˇl
;

1606 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_1
,

1607 
AR_PHY_TX_IQCAL_CONTROL_1_IQCORR_I_Q_COFF_DELPT
,

1608 
DELPT
);

1614 i‡(
ah
->
íabÀd_ˇls
 & 
TX_IQ_ON_AGC_CAL
) {

1615 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

1616 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
)) {

1617 
txiqˇl_d⁄e
 = 
åue
;

1619 
txiqˇl_d⁄e
 = 
Ál£
;

1621 
run_agc_ˇl
 = 
åue
;

1623 
£p_iq_ˇl
 = 
åue
;

1624 
run_agc_ˇl
 = 
åue
;

1630 i‡(
£p_iq_ˇl
) {

1631 
txiqˇl_d⁄e
 = 
	`¨9003_hw_tx_iq_ˇl_run
(
ah
);

1632 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_DIS
);

1633 
	`udñay
(5);

1634 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

1637 i‡(
	`AR_SREV_9550
(
ah
Ë&& 
	`IS_CHAN_2GHZ
(
ch™
)) {

1638 i‡(!
	`¨9003_hw_dy«mic_osdac_£À˘i⁄
(
ah
, 
txiqˇl_d⁄e
))

1639  
Ál£
;

1642 
skù_tx_iqˇl
:

1643 i‡(
run_agc_ˇl
 || !(
ah
->
ah_Êags
 & 
AH_FASTCC
)) {

1644 i‡(
	`AR_SREV_9330_11
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9550
(ah) ||

1645 
	`AR_SREV_9561
(
ah
)) {

1646 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1647 i‡(!(
ah
->
rxchaömask
 & (1 << 
i
)))

1649 
	`¨9003_hw_m™uÆ_≥ak_ˇl
(
ah
, 
i
,

1650 
	`IS_CHAN_2GHZ
(
ch™
));

1662 i‡(!
	`AR_SREV_9550
(
ah
)) {

1663 
°©us
 = 
	`do_¨9003_agc_ˇl
(
ah
);

1664 i‡(!
°©us
)

1665  
Ál£
;

1667 i‡(
txiqˇl_d⁄e
)

1668 
	`¨9003_hw_tx_iq_ˇl_po°_¥oc
(
ah
, 0, 
Ál£
);

1670 i‡(!
txiqˇl_d⁄e
) {

1671 
°©us
 = 
	`do_¨9003_agc_ˇl
(
ah
);

1672 i‡(!
°©us
)

1673  
Ál£
;

1675 
i
 = 0; i < 
MAXIQCAL
; i++) {

1676 
°©us
 = 
	`do_¨9003_agc_ˇl
(
ah
);

1677 i‡(!
°©us
)

1678  
Ál£
;

1679 
	`¨9003_hw_tx_iq_ˇl_po°_¥oc
(
ah
, 
i
, 
Ál£
);

1686 
	`¨9003_hw_£t_chaö_masks
(
ah
,áh->
rxchaömask
,áh->
txchaömask
);

1689 
ah
->
ˇl_li°
 =áh->
ˇl_li°_œ°
 =áh->
ˇl_li°_cuº
 = 
NULL
;

1691 
	`INIT_CAL
(&
ah
->
iq_ˇld©a
);

1692 
	`INSERT_CAL
(
ah
, &ah->
iq_ˇld©a
);

1693 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "enabling IQ Calibration\n");

1696 
ah
->
ˇl_li°_cuº
 =áh->
ˇl_li°
;

1698 i‡(
ah
->
ˇl_li°_cuº
)

1699 
	`©h9k_hw_ª£t_ˇlibøti⁄
(
ah
,áh->
ˇl_li°_cuº
);

1701 i‡(
ˇld©a
)

1702 
ˇld©a
->
CÆVÆid
 = 0;

1704  
åue
;

1705 
	}
}

1707 
	$¨9003_hw_©èch_ˇlib_›s
(
©h_hw
 *
ah
)

1709 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

1710 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

1712 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9462
◊hË|| 
	`AR_SREV_9565
(ah))

1713 
¥iv_›s
->
öô_ˇl
 = 
¨9003_hw_öô_ˇl_pc€m
;

1715 
¥iv_›s
->
öô_ˇl
 = 
¨9003_hw_öô_ˇl_soc
;

1717 
¥iv_›s
->
öô_ˇl_£âögs
 = 
¨9003_hw_öô_ˇl_£âögs
;

1718 
¥iv_›s
->
£tup_ˇlibøti⁄
 = 
¨9003_hw_£tup_ˇlibøti⁄
;

1720 
›s
->
ˇlibøã
 = 
¨9003_hw_ˇlibøã
;

1721 
	}
}

	@ar9003_eeprom.c

17 
	~<asm/u«lig√d.h
>

18 
	~"hw.h
"

19 
	~"¨9003_phy.h
"

20 
	~"¨9003_ì¥om.h
"

21 
	~"¨9003_mci.h
"

23 
	#COMP_HDR_LEN
 4

	)

24 
	#COMP_CKSUM_LEN
 2

	)

26 
	#LE16
(
x
Ë
	`˝u_to_À16
(x)

	)

27 
	#LE32
(
x
Ë
	`˝u_to_À32
(x)

	)

30 
	#EXT_ADDITIVE
 (0x8000)

	)

31 
	#CTL_11A_EXT
 (
CTL_11A
 | 
EXT_ADDITIVE
)

	)

32 
	#CTL_11G_EXT
 (
CTL_11G
 | 
EXT_ADDITIVE
)

	)

33 
	#CTL_11B_EXT
 (
CTL_11B
 | 
EXT_ADDITIVE
)

	)

35 
	#SUB_NUM_CTL_MODES_AT_5G_40
 2

	)

36 
	#SUB_NUM_CTL_MODES_AT_2G_40
 3

	)

38 
	#CTL
(
_çowî
, 
_Êag
Ë((_çowîË| ((_ÊagË<< 6))

	)

40 
	#EEPROM_DATA_LEN_9485
 1088

	)

42 
¨9003_hw_powî_öãΩﬁ©e
(
öt32_t
 
x
,

43 
öt32_t
 *
px
, i¡32_à*
py
, 
u_öt16_t
 
≈
);

45 c⁄° 
¨9300_ì¥om
 
	g¨9300_deÁu…
 = {

46 .
ì¥omVîsi⁄
 = 2,

47 .
	gãm∂©eVîsi⁄
 = 2,

48 .
	gmacAddr
 = {0, 2, 3, 4, 5, 6},

49 .
	gcu°D©a
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

51 .
	gba£EïHódî
 = {

52 .
ªgDmn
 = { 
LE16
(0), LE16(0x1f) },

53 .
	gtxrxMask
 = 0x77,

54 .
	g›C≠Fœgs
 = {

55 .
›Fœgs
 = 
AR5416_OPFLAGS_11G
 | 
AR5416_OPFLAGS_11A
,

56 .
	gìpMisc
 = 0,

58 .
	grfSûít
 = 0,

59 .
	gblueToŸhO±i⁄s
 = 0,

60 .
	gdevi˚C≠
 = 0,

61 .
	gdevi˚Ty≥
 = 5,

62 .
	gpwrTabÀOff£t
 = 
AR9300_PWR_TABLE_OFFSET
,

63 .
	g∑øms_f‹_tunög_ˇps
 = {0, 0},

64 .
	g„©uªE«bÀ
 = 0x0c,

73 .
	gmiscC⁄figuøti⁄
 = 0,

74 .
	gì¥omWrôeE«bÀGpio
 = 3,

75 .
	gwœnDißbÀGpio
 = 0,

76 .
	gwœnLedGpio
 = 8,

77 .
	grxB™dSñe˘Gpio
 = 0xff,

78 .
	gtxrxgaö
 = 0,

79 .
	gswªg
 = 0,

81 .
	gmodÆHódî2G
 = {

84 .
™tCålComm⁄
 = 
LE32
(0x110),

86 .
	g™tCålComm⁄2
 = 
LE32
(0x22222),

92 .
	g™tCålChaö
 = { 
LE16
(0x150), LE16(0x150), LE16(0x150) },

98 .
	gx©ãn1DB
 = {0, 0, 0},

104 .
	gx©ãn1M¨gö
 = {0, 0, 0},

105 .
	gãmpSl›e
 = 36,

106 .
	gvﬁtSl›e
 = 0,

112 .
	g•urCh™s
 = {0, 0, 0, 0, 0},

118 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

119 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

120 .
	gquick_dr›
 = 0,

121 .
	gx∑BüsLvl
 = 0,

122 .
	gtxFømeToD©aSèπ
 = 0x0e,

123 .
	gtxFømeToPaOn
 = 0x0e,

124 .
	gtxClù
 = 3,

125 .
	g™ã¬aGaö
 = 0,

126 .
	gswôchSëéög
 = 0x2c,

127 .
	gadcDesúedSize
 = -30,

128 .
	gtxEndToX∑Off
 = 0,

129 .
	gtxEndToRxOn
 = 0x2,

130 .
	gtxFømeToX∑On
 = 0xe,

131 .
	gthªsh62
 = 28,

132 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0cf0e0e0),

133 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x6cf0e0e0),

134 .
	gswôchcom•dt
 = 0,

135 .
	gx a_büs_°ªngth
 = 0,

136 .
	gfutuªModÆ
 = {

140 .
	gba£_ext1
 = {

141 .
™t_div_c⁄åﬁ
 = 0,

142 .
	gfutuª
 = {0, 0},

143 .
	gãmp¶›exãnsi⁄
 = {0, 0, 0, 0, 0, 0, 0, 0}

145 .
	gˇlFªqPõr2G
 = {

146 
FREQ2FBIN
(2412, 1),

147 
FREQ2FBIN
(2437, 1),

148 
FREQ2FBIN
(2472, 1),

151 .
	gˇlPõrD©a2G
 = {

156 .
	gˇlT¨gë_‰eqbö_Cck
 = {

157 
FREQ2FBIN
(2412, 1),

158 
FREQ2FBIN
(2484, 1),

160 .
	gˇlT¨gë_‰eqbö_2G
 = {

161 
FREQ2FBIN
(2412, 1),

162 
FREQ2FBIN
(2437, 1),

163 
FREQ2FBIN
(2472, 1)

165 .
	gˇlT¨gë_‰eqbö_2GHT20
 = {

166 
FREQ2FBIN
(2412, 1),

167 
FREQ2FBIN
(2437, 1),

168 
FREQ2FBIN
(2472, 1)

170 .
	gˇlT¨gë_‰eqbö_2GHT40
 = {

171 
FREQ2FBIN
(2412, 1),

172 
FREQ2FBIN
(2437, 1),

173 
FREQ2FBIN
(2472, 1)

175 .
	gˇlT¨gëPowîCck
 = {

180 .
	gˇlT¨gëPowî2G
 = {

186 .
	gˇlT¨gëPowî2GHT20
 = {

191 .
	gˇlT¨gëPowî2GHT40
 = {

196 .
	g˘lIndex_2G
 = {

200 .
	g˘l_‰eqbö_2G
 = {

202 
FREQ2FBIN
(2412, 1),

203 
FREQ2FBIN
(2417, 1),

204 
FREQ2FBIN
(2457, 1),

205 
FREQ2FBIN
(2462, 1)

208 
FREQ2FBIN
(2412, 1),

209 
FREQ2FBIN
(2417, 1),

210 
FREQ2FBIN
(2462, 1),

215 
FREQ2FBIN
(2412, 1),

216 
FREQ2FBIN
(2417, 1),

217 
FREQ2FBIN
(2462, 1),

221 
FREQ2FBIN
(2422, 1),

222 
FREQ2FBIN
(2427, 1),

223 
FREQ2FBIN
(2447, 1),

224 
FREQ2FBIN
(2452, 1)

228  
FREQ2FBIN
(2412, 1),

229  
FREQ2FBIN
(2417, 1),

230  
FREQ2FBIN
(2472, 1),

231  
FREQ2FBIN
(2484, 1),

235  
FREQ2FBIN
(2412, 1),

236  
FREQ2FBIN
(2417, 1),

237  
FREQ2FBIN
(2472, 1),

242  
FREQ2FBIN
(2412, 1),

243  
FREQ2FBIN
(2417, 1),

244 
FREQ2FBIN
(2472, 1),

249  
FREQ2FBIN
(2422, 1),

250  
FREQ2FBIN
(2427, 1),

251  
FREQ2FBIN
(2447, 1),

252  
FREQ2FBIN
(2462, 1),

256  
FREQ2FBIN
(2412, 1),

257  
FREQ2FBIN
(2417, 1),

258  
FREQ2FBIN
(2472, 1),

262  
FREQ2FBIN
(2412, 1),

263  
FREQ2FBIN
(2417, 1),

264  
FREQ2FBIN
(2472, 1),

269  
FREQ2FBIN
(2412, 1),

270  
FREQ2FBIN
(2417, 1),

271  
FREQ2FBIN
(2472, 1),

276  
FREQ2FBIN
(2422, 1),

277  
FREQ2FBIN
(2427, 1),

278  
FREQ2FBIN
(2447, 1),

279  
FREQ2FBIN
(2462, 1),

282 .
	g˘lPowîD©a_2G
 = {

283 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

284 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

285 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 1) } },

287 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0) } },

288 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

289 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

291 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0) } },

292 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

293 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

295 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

296 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

297 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

299 .
	gmodÆHódî5G
 = {

301 .
™tCålComm⁄
 = 
LE32
(0x110),

303 .
	g™tCålComm⁄2
 = 
LE32
(0x22222),

305 .
	g™tCålChaö
 = {

306 
LE16
(0x000), LE16(0x000), LE16(0x000),

309 .
	gx©ãn1DB
 = {0, 0, 0},

315 .
	gx©ãn1M¨gö
 = {0, 0, 0},

316 .
	gãmpSl›e
 = 68,

317 .
	gvﬁtSl›e
 = 0,

319 .
	g•urCh™s
 = {0, 0, 0, 0, 0},

321 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

322 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

323 .
	gquick_dr›
 = 0,

324 .
	gx∑BüsLvl
 = 0,

325 .
	gtxFømeToD©aSèπ
 = 0x0e,

326 .
	gtxFømeToPaOn
 = 0x0e,

327 .
	gtxClù
 = 3,

328 .
	g™ã¬aGaö
 = 0,

329 .
	gswôchSëéög
 = 0x2d,

330 .
	gadcDesúedSize
 = -30,

331 .
	gtxEndToX∑Off
 = 0,

332 .
	gtxEndToRxOn
 = 0x2,

333 .
	gtxFømeToX∑On
 = 0xe,

334 .
	gthªsh62
 = 28,

335 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0c80c080),

336 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x0080c080),

337 .
	gswôchcom•dt
 = 0,

338 .
	gx a_büs_°ªngth
 = 0,

339 .
	gfutuªModÆ
 = {

343 .
	gba£_ext2
 = {

344 .
ãmpSl›eLow
 = 0,

345 .
	gãmpSl›eHigh
 = 0,

346 .
	gx©ãn1DBLow
 = {0, 0, 0},

347 .
	gx©ãn1M¨göLow
 = {0, 0, 0},

348 .
	gx©ãn1DBHigh
 = {0, 0, 0},

349 .
	gx©ãn1M¨göHigh
 = {0, 0, 0}

351 .
	gˇlFªqPõr5G
 = {

352 
FREQ2FBIN
(5180, 0),

353 
FREQ2FBIN
(5220, 0),

354 
FREQ2FBIN
(5320, 0),

355 
FREQ2FBIN
(5400, 0),

356 
FREQ2FBIN
(5500, 0),

357 
FREQ2FBIN
(5600, 0),

358 
FREQ2FBIN
(5725, 0),

359 
FREQ2FBIN
(5825, 0)

361 .
	gˇlPõrD©a5G
 = {

394 .
	gˇlT¨gë_‰eqbö_5G
 = {

395 
FREQ2FBIN
(5180, 0),

396 
FREQ2FBIN
(5220, 0),

397 
FREQ2FBIN
(5320, 0),

398 
FREQ2FBIN
(5400, 0),

399 
FREQ2FBIN
(5500, 0),

400 
FREQ2FBIN
(5600, 0),

401 
FREQ2FBIN
(5725, 0),

402 
FREQ2FBIN
(5825, 0)

404 .
	gˇlT¨gë_‰eqbö_5GHT20
 = {

405 
FREQ2FBIN
(5180, 0),

406 
FREQ2FBIN
(5240, 0),

407 
FREQ2FBIN
(5320, 0),

408 
FREQ2FBIN
(5500, 0),

409 
FREQ2FBIN
(5700, 0),

410 
FREQ2FBIN
(5745, 0),

411 
FREQ2FBIN
(5725, 0),

412 
FREQ2FBIN
(5825, 0)

414 .
	gˇlT¨gë_‰eqbö_5GHT40
 = {

415 
FREQ2FBIN
(5180, 0),

416 
FREQ2FBIN
(5240, 0),

417 
FREQ2FBIN
(5320, 0),

418 
FREQ2FBIN
(5500, 0),

419 
FREQ2FBIN
(5700, 0),

420 
FREQ2FBIN
(5745, 0),

421 
FREQ2FBIN
(5725, 0),

422 
FREQ2FBIN
(5825, 0)

424 .
	gˇlT¨gëPowî5G
 = {

435 .
	gˇlT¨gëPowî5GHT20
 = {

449 .
	gˇlT¨gëPowî5GHT40
 = {

463 .
	g˘lIndex_5G
 = {

467 .
	g˘l_‰eqbö_5G
 = {

469  
FREQ2FBIN
(5180, 0),

470  
FREQ2FBIN
(5260, 0),

471  
FREQ2FBIN
(5280, 0),

472  
FREQ2FBIN
(5500, 0),

473  
FREQ2FBIN
(5600, 0),

474  
FREQ2FBIN
(5700, 0),

475  
FREQ2FBIN
(5745, 0),

476  
FREQ2FBIN
(5825, 0)

479  
FREQ2FBIN
(5180, 0),

480  
FREQ2FBIN
(5260, 0),

481  
FREQ2FBIN
(5280, 0),

482  
FREQ2FBIN
(5500, 0),

483  
FREQ2FBIN
(5520, 0),

484  
FREQ2FBIN
(5700, 0),

485  
FREQ2FBIN
(5745, 0),

486  
FREQ2FBIN
(5825, 0)

490  
FREQ2FBIN
(5190, 0),

491  
FREQ2FBIN
(5230, 0),

492  
FREQ2FBIN
(5270, 0),

493  
FREQ2FBIN
(5310, 0),

494  
FREQ2FBIN
(5510, 0),

495  
FREQ2FBIN
(5550, 0),

496  
FREQ2FBIN
(5670, 0),

497  
FREQ2FBIN
(5755, 0)

501  
FREQ2FBIN
(5180, 0),

502  
FREQ2FBIN
(5200, 0),

503  
FREQ2FBIN
(5260, 0),

504  
FREQ2FBIN
(5320, 0),

505  
FREQ2FBIN
(5500, 0),

506  
FREQ2FBIN
(5700, 0),

512  
FREQ2FBIN
(5180, 0),

513  
FREQ2FBIN
(5260, 0),

514  
FREQ2FBIN
(5500, 0),

515  
FREQ2FBIN
(5700, 0),

523  
FREQ2FBIN
(5190, 0),

524  
FREQ2FBIN
(5270, 0),

525  
FREQ2FBIN
(5310, 0),

526  
FREQ2FBIN
(5510, 0),

527  
FREQ2FBIN
(5590, 0),

528  
FREQ2FBIN
(5670, 0),

534  
FREQ2FBIN
(5180, 0),

535  
FREQ2FBIN
(5200, 0),

536  
FREQ2FBIN
(5220, 0),

537  
FREQ2FBIN
(5260, 0),

538  
FREQ2FBIN
(5500, 0),

539  
FREQ2FBIN
(5600, 0),

540  
FREQ2FBIN
(5700, 0),

541  
FREQ2FBIN
(5745, 0)

545  
FREQ2FBIN
(5180, 0),

546  
FREQ2FBIN
(5260, 0),

547  
FREQ2FBIN
(5320, 0),

548  
FREQ2FBIN
(5500, 0),

549  
FREQ2FBIN
(5560, 0),

550  
FREQ2FBIN
(5700, 0),

551  
FREQ2FBIN
(5745, 0),

552  
FREQ2FBIN
(5825, 0)

556  
FREQ2FBIN
(5190, 0),

557  
FREQ2FBIN
(5230, 0),

558  
FREQ2FBIN
(5270, 0),

559  
FREQ2FBIN
(5510, 0),

560  
FREQ2FBIN
(5550, 0),

561  
FREQ2FBIN
(5670, 0),

562  
FREQ2FBIN
(5755, 0),

563  
FREQ2FBIN
(5795, 0)

566 .
	g˘lPowîD©a_5G
 = {

569 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

570 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

575 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

576 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

581 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 1),

582 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

587 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0),

588 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

593 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

594 
CTL
(60, 0), CTL(60, 0), CTL(60, 0), CTL(60, 0),

599 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

600 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

605 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

606 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

611 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

612 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

617 
CTL
(60, 1), CTL(60, 0), CTL(60, 1), CTL(60, 1),

618 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

624 c⁄° 
¨9300_ì¥om
 
	g¨9300_x113
 = {

625 .
ì¥omVîsi⁄
 = 2,

626 .
	gãm∂©eVîsi⁄
 = 6,

627 .
	gmacAddr
 = {0x00, 0x03, 0x7f, 0x0, 0x0, 0x0},

628 .
	gcu°D©a
 = {"x113-023-f0000"},

629 .
	gba£EïHódî
 = {

630 .
ªgDmn
 = { 
LE16
(0), LE16(0x1f) },

631 .
	gtxrxMask
 = 0x77,

632 .
	g›C≠Fœgs
 = {

633 .
›Fœgs
 = 
AR5416_OPFLAGS_11A
,

634 .
	gìpMisc
 = 0,

636 .
	grfSûít
 = 0,

637 .
	gblueToŸhO±i⁄s
 = 0,

638 .
	gdevi˚C≠
 = 0,

639 .
	gdevi˚Ty≥
 = 5,

640 .
	gpwrTabÀOff£t
 = 
AR9300_PWR_TABLE_OFFSET
,

641 .
	g∑øms_f‹_tunög_ˇps
 = {0, 0},

642 .
	g„©uªE«bÀ
 = 0x0d,

651 .
	gmiscC⁄figuøti⁄
 = 0,

652 .
	gì¥omWrôeE«bÀGpio
 = 6,

653 .
	gwœnDißbÀGpio
 = 0,

654 .
	gwœnLedGpio
 = 8,

655 .
	grxB™dSñe˘Gpio
 = 0xff,

656 .
	gtxrxgaö
 = 0x21,

657 .
	gswªg
 = 0,

659 .
	gmodÆHódî2G
 = {

662 .
™tCålComm⁄
 = 
LE32
(0x110),

664 .
	g™tCålComm⁄2
 = 
LE32
(0x44444),

670 .
	g™tCålChaö
 = { 
LE16
(0x150), LE16(0x150), LE16(0x150) },

676 .
	gx©ãn1DB
 = {0, 0, 0},

682 .
	gx©ãn1M¨gö
 = {0, 0, 0},

683 .
	gãmpSl›e
 = 25,

684 .
	gvﬁtSl›e
 = 0,

690 .
	g•urCh™s
 = {
FREQ2FBIN
(2464, 1), 0, 0, 0, 0},

696 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

697 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

698 .
	gquick_dr›
 = 0,

699 .
	gx∑BüsLvl
 = 0,

700 .
	gtxFømeToD©aSèπ
 = 0x0e,

701 .
	gtxFømeToPaOn
 = 0x0e,

702 .
	gtxClù
 = 3,

703 .
	g™ã¬aGaö
 = 0,

704 .
	gswôchSëéög
 = 0x2c,

705 .
	gadcDesúedSize
 = -30,

706 .
	gtxEndToX∑Off
 = 0,

707 .
	gtxEndToRxOn
 = 0x2,

708 .
	gtxFømeToX∑On
 = 0xe,

709 .
	gthªsh62
 = 28,

710 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0c80c080),

711 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x0080c080),

712 .
	gswôchcom•dt
 = 0,

713 .
	gx a_büs_°ªngth
 = 0,

714 .
	gfutuªModÆ
 = {

718 .
	gba£_ext1
 = {

719 .
™t_div_c⁄åﬁ
 = 0,

720 .
	gfutuª
 = {0, 0},

721 .
	gãmp¶›exãnsi⁄
 = {0, 0, 0, 0, 0, 0, 0, 0}

723 .
	gˇlFªqPõr2G
 = {

724 
FREQ2FBIN
(2412, 1),

725 
FREQ2FBIN
(2437, 1),

726 
FREQ2FBIN
(2472, 1),

729 .
	gˇlPõrD©a2G
 = {

734 .
	gˇlT¨gë_‰eqbö_Cck
 = {

735 
FREQ2FBIN
(2412, 1),

736 
FREQ2FBIN
(2472, 1),

738 .
	gˇlT¨gë_‰eqbö_2G
 = {

739 
FREQ2FBIN
(2412, 1),

740 
FREQ2FBIN
(2437, 1),

741 
FREQ2FBIN
(2472, 1)

743 .
	gˇlT¨gë_‰eqbö_2GHT20
 = {

744 
FREQ2FBIN
(2412, 1),

745 
FREQ2FBIN
(2437, 1),

746 
FREQ2FBIN
(2472, 1)

748 .
	gˇlT¨gë_‰eqbö_2GHT40
 = {

749 
FREQ2FBIN
(2412, 1),

750 
FREQ2FBIN
(2437, 1),

751 
FREQ2FBIN
(2472, 1)

753 .
	gˇlT¨gëPowîCck
 = {

758 .
	gˇlT¨gëPowî2G
 = {

764 .
	gˇlT¨gëPowî2GHT20
 = {

769 .
	gˇlT¨gëPowî2GHT40
 = {

774 .
	g˘lIndex_2G
 = {

778 .
	g˘l_‰eqbö_2G
 = {

780 
FREQ2FBIN
(2412, 1),

781 
FREQ2FBIN
(2417, 1),

782 
FREQ2FBIN
(2457, 1),

783 
FREQ2FBIN
(2462, 1)

786 
FREQ2FBIN
(2412, 1),

787 
FREQ2FBIN
(2417, 1),

788 
FREQ2FBIN
(2462, 1),

793 
FREQ2FBIN
(2412, 1),

794 
FREQ2FBIN
(2417, 1),

795 
FREQ2FBIN
(2462, 1),

799 
FREQ2FBIN
(2422, 1),

800 
FREQ2FBIN
(2427, 1),

801 
FREQ2FBIN
(2447, 1),

802 
FREQ2FBIN
(2452, 1)

806  
FREQ2FBIN
(2412, 1),

807  
FREQ2FBIN
(2417, 1),

808  
FREQ2FBIN
(2472, 1),

809  
FREQ2FBIN
(2484, 1),

813  
FREQ2FBIN
(2412, 1),

814  
FREQ2FBIN
(2417, 1),

815  
FREQ2FBIN
(2472, 1),

820  
FREQ2FBIN
(2412, 1),

821  
FREQ2FBIN
(2417, 1),

822 
FREQ2FBIN
(2472, 1),

827  
FREQ2FBIN
(2422, 1),

828  
FREQ2FBIN
(2427, 1),

829  
FREQ2FBIN
(2447, 1),

830  
FREQ2FBIN
(2462, 1),

834  
FREQ2FBIN
(2412, 1),

835  
FREQ2FBIN
(2417, 1),

836  
FREQ2FBIN
(2472, 1),

840  
FREQ2FBIN
(2412, 1),

841  
FREQ2FBIN
(2417, 1),

842  
FREQ2FBIN
(2472, 1),

847  
FREQ2FBIN
(2412, 1),

848  
FREQ2FBIN
(2417, 1),

849  
FREQ2FBIN
(2472, 1),

854  
FREQ2FBIN
(2422, 1),

855  
FREQ2FBIN
(2427, 1),

856  
FREQ2FBIN
(2447, 1),

857  
FREQ2FBIN
(2462, 1),

860 .
	g˘lPowîD©a_2G
 = {

861 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

862 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

863 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 1) } },

865 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0) } },

866 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

867 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

869 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0) } },

870 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

871 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

873 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

874 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

875 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

877 .
	gmodÆHódî5G
 = {

879 .
™tCålComm⁄
 = 
LE32
(0x220),

881 .
	g™tCålComm⁄2
 = 
LE32
(0x11111),

883 .
	g™tCålChaö
 = {

884 
LE16
(0x150), LE16(0x150), LE16(0x150),

887 .
	gx©ãn1DB
 = {0, 0, 0},

893 .
	gx©ãn1M¨gö
 = {0, 0, 0},

894 .
	gãmpSl›e
 = 68,

895 .
	gvﬁtSl›e
 = 0,

897 .
	g•urCh™s
 = {
FREQ2FBIN
(5500, 0), 0, 0, 0, 0},

899 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

900 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

901 .
	gquick_dr›
 = 0,

902 .
	gx∑BüsLvl
 = 0xf,

903 .
	gtxFømeToD©aSèπ
 = 0x0e,

904 .
	gtxFømeToPaOn
 = 0x0e,

905 .
	gtxClù
 = 3,

906 .
	g™ã¬aGaö
 = 0,

907 .
	gswôchSëéög
 = 0x2d,

908 .
	gadcDesúedSize
 = -30,

909 .
	gtxEndToX∑Off
 = 0,

910 .
	gtxEndToRxOn
 = 0x2,

911 .
	gtxFømeToX∑On
 = 0xe,

912 .
	gthªsh62
 = 28,

913 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0cf0e0e0),

914 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x6cf0e0e0),

915 .
	gswôchcom•dt
 = 0,

916 .
	gx a_büs_°ªngth
 = 0,

917 .
	gfutuªModÆ
 = {

921 .
	gba£_ext2
 = {

922 .
ãmpSl›eLow
 = 72,

923 .
	gãmpSl›eHigh
 = 105,

924 .
	gx©ãn1DBLow
 = {0, 0, 0},

925 .
	gx©ãn1M¨göLow
 = {0, 0, 0},

926 .
	gx©ãn1DBHigh
 = {0, 0, 0},

927 .
	gx©ãn1M¨göHigh
 = {0, 0, 0}

929 .
	gˇlFªqPõr5G
 = {

930 
FREQ2FBIN
(5180, 0),

931 
FREQ2FBIN
(5240, 0),

932 
FREQ2FBIN
(5320, 0),

933 
FREQ2FBIN
(5400, 0),

934 
FREQ2FBIN
(5500, 0),

935 
FREQ2FBIN
(5600, 0),

936 
FREQ2FBIN
(5745, 0),

937 
FREQ2FBIN
(5785, 0)

939 .
	gˇlPõrD©a5G
 = {

972 .
	gˇlT¨gë_‰eqbö_5G
 = {

973 
FREQ2FBIN
(5180, 0),

974 
FREQ2FBIN
(5220, 0),

975 
FREQ2FBIN
(5320, 0),

976 
FREQ2FBIN
(5400, 0),

977 
FREQ2FBIN
(5500, 0),

978 
FREQ2FBIN
(5600, 0),

979 
FREQ2FBIN
(5745, 0),

980 
FREQ2FBIN
(5785, 0)

982 .
	gˇlT¨gë_‰eqbö_5GHT20
 = {

983 
FREQ2FBIN
(5180, 0),

984 
FREQ2FBIN
(5240, 0),

985 
FREQ2FBIN
(5320, 0),

986 
FREQ2FBIN
(5400, 0),

987 
FREQ2FBIN
(5500, 0),

988 
FREQ2FBIN
(5700, 0),

989 
FREQ2FBIN
(5745, 0),

990 
FREQ2FBIN
(5825, 0)

992 .
	gˇlT¨gë_‰eqbö_5GHT40
 = {

993 
FREQ2FBIN
(5190, 0),

994 
FREQ2FBIN
(5230, 0),

995 
FREQ2FBIN
(5320, 0),

996 
FREQ2FBIN
(5410, 0),

997 
FREQ2FBIN
(5510, 0),

998 
FREQ2FBIN
(5670, 0),

999 
FREQ2FBIN
(5755, 0),

1000 
FREQ2FBIN
(5825, 0)

1002 .
	gˇlT¨gëPowî5G
 = {

1013 .
	gˇlT¨gëPowî5GHT20
 = {

1027 .
	gˇlT¨gëPowî5GHT40
 = {

1041 .
	g˘lIndex_5G
 = {

1045 .
	g˘l_‰eqbö_5G
 = {

1047  
FREQ2FBIN
(5180, 0),

1048  
FREQ2FBIN
(5260, 0),

1049  
FREQ2FBIN
(5280, 0),

1050  
FREQ2FBIN
(5500, 0),

1051  
FREQ2FBIN
(5600, 0),

1052  
FREQ2FBIN
(5700, 0),

1053  
FREQ2FBIN
(5745, 0),

1054  
FREQ2FBIN
(5825, 0)

1057  
FREQ2FBIN
(5180, 0),

1058  
FREQ2FBIN
(5260, 0),

1059  
FREQ2FBIN
(5280, 0),

1060  
FREQ2FBIN
(5500, 0),

1061  
FREQ2FBIN
(5520, 0),

1062  
FREQ2FBIN
(5700, 0),

1063  
FREQ2FBIN
(5745, 0),

1064  
FREQ2FBIN
(5825, 0)

1068  
FREQ2FBIN
(5190, 0),

1069  
FREQ2FBIN
(5230, 0),

1070  
FREQ2FBIN
(5270, 0),

1071  
FREQ2FBIN
(5310, 0),

1072  
FREQ2FBIN
(5510, 0),

1073  
FREQ2FBIN
(5550, 0),

1074  
FREQ2FBIN
(5670, 0),

1075  
FREQ2FBIN
(5755, 0)

1079  
FREQ2FBIN
(5180, 0),

1080  
FREQ2FBIN
(5200, 0),

1081  
FREQ2FBIN
(5260, 0),

1082  
FREQ2FBIN
(5320, 0),

1083  
FREQ2FBIN
(5500, 0),

1084  
FREQ2FBIN
(5700, 0),

1090  
FREQ2FBIN
(5180, 0),

1091  
FREQ2FBIN
(5260, 0),

1092  
FREQ2FBIN
(5500, 0),

1093  
FREQ2FBIN
(5700, 0),

1101  
FREQ2FBIN
(5190, 0),

1102  
FREQ2FBIN
(5270, 0),

1103  
FREQ2FBIN
(5310, 0),

1104  
FREQ2FBIN
(5510, 0),

1105  
FREQ2FBIN
(5590, 0),

1106  
FREQ2FBIN
(5670, 0),

1112  
FREQ2FBIN
(5180, 0),

1113  
FREQ2FBIN
(5200, 0),

1114  
FREQ2FBIN
(5220, 0),

1115  
FREQ2FBIN
(5260, 0),

1116  
FREQ2FBIN
(5500, 0),

1117  
FREQ2FBIN
(5600, 0),

1118  
FREQ2FBIN
(5700, 0),

1119  
FREQ2FBIN
(5745, 0)

1123  
FREQ2FBIN
(5180, 0),

1124  
FREQ2FBIN
(5260, 0),

1125  
FREQ2FBIN
(5320, 0),

1126  
FREQ2FBIN
(5500, 0),

1127  
FREQ2FBIN
(5560, 0),

1128  
FREQ2FBIN
(5700, 0),

1129  
FREQ2FBIN
(5745, 0),

1130  
FREQ2FBIN
(5825, 0)

1134  
FREQ2FBIN
(5190, 0),

1135  
FREQ2FBIN
(5230, 0),

1136  
FREQ2FBIN
(5270, 0),

1137  
FREQ2FBIN
(5510, 0),

1138  
FREQ2FBIN
(5550, 0),

1139  
FREQ2FBIN
(5670, 0),

1140  
FREQ2FBIN
(5755, 0),

1141  
FREQ2FBIN
(5795, 0)

1144 .
	g˘lPowîD©a_5G
 = {

1147 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1148 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1153 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1154 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1159 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1160 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1165 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1166 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1171 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1172 
CTL
(60, 0), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1177 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1178 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1183 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1184 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1189 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1190 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1195 
CTL
(60, 1), CTL(60, 0), CTL(60, 1), CTL(60, 1),

1196 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1203 c⁄° 
¨9300_ì¥om
 
	g¨9300_h112
 = {

1204 .
ì¥omVîsi⁄
 = 2,

1205 .
	gãm∂©eVîsi⁄
 = 3,

1206 .
	gmacAddr
 = {0x00, 0x03, 0x7f, 0x0, 0x0, 0x0},

1207 .
	gcu°D©a
 = {"h112-241-f0000"},

1208 .
	gba£EïHódî
 = {

1209 .
ªgDmn
 = { 
LE16
(0), LE16(0x1f) },

1210 .
	gtxrxMask
 = 0x77,

1211 .
	g›C≠Fœgs
 = {

1212 .
›Fœgs
 = 
AR5416_OPFLAGS_11G
 | 
AR5416_OPFLAGS_11A
,

1213 .
	gìpMisc
 = 0,

1215 .
	grfSûít
 = 0,

1216 .
	gblueToŸhO±i⁄s
 = 0,

1217 .
	gdevi˚C≠
 = 0,

1218 .
	gdevi˚Ty≥
 = 5,

1219 .
	gpwrTabÀOff£t
 = 
AR9300_PWR_TABLE_OFFSET
,

1220 .
	g∑øms_f‹_tunög_ˇps
 = {0, 0},

1221 .
	g„©uªE«bÀ
 = 0x0d,

1230 .
	gmiscC⁄figuøti⁄
 = 0,

1231 .
	gì¥omWrôeE«bÀGpio
 = 6,

1232 .
	gwœnDißbÀGpio
 = 0,

1233 .
	gwœnLedGpio
 = 8,

1234 .
	grxB™dSñe˘Gpio
 = 0xff,

1235 .
	gtxrxgaö
 = 0x10,

1236 .
	gswªg
 = 0,

1238 .
	gmodÆHódî2G
 = {

1241 .
™tCålComm⁄
 = 
LE32
(0x110),

1243 .
	g™tCålComm⁄2
 = 
LE32
(0x44444),

1249 .
	g™tCålChaö
 = { 
LE16
(0x150), LE16(0x150), LE16(0x150) },

1255 .
	gx©ãn1DB
 = {0, 0, 0},

1261 .
	gx©ãn1M¨gö
 = {0, 0, 0},

1262 .
	gãmpSl›e
 = 25,

1263 .
	gvﬁtSl›e
 = 0,

1269 .
	g•urCh™s
 = {
FREQ2FBIN
(2464, 1), 0, 0, 0, 0},

1275 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

1276 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

1277 .
	gquick_dr›
 = 0,

1278 .
	gx∑BüsLvl
 = 0,

1279 .
	gtxFømeToD©aSèπ
 = 0x0e,

1280 .
	gtxFømeToPaOn
 = 0x0e,

1281 .
	gtxClù
 = 3,

1282 .
	g™ã¬aGaö
 = 0,

1283 .
	gswôchSëéög
 = 0x2c,

1284 .
	gadcDesúedSize
 = -30,

1285 .
	gtxEndToX∑Off
 = 0,

1286 .
	gtxEndToRxOn
 = 0x2,

1287 .
	gtxFømeToX∑On
 = 0xe,

1288 .
	gthªsh62
 = 28,

1289 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0c80c080),

1290 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x0080c080),

1291 .
	gswôchcom•dt
 = 0,

1292 .
	gx a_büs_°ªngth
 = 0,

1293 .
	gfutuªModÆ
 = {

1297 .
	gba£_ext1
 = {

1298 .
™t_div_c⁄åﬁ
 = 0,

1299 .
	gfutuª
 = {0, 0},

1300 .
	gãmp¶›exãnsi⁄
 = {0, 0, 0, 0, 0, 0, 0, 0}

1302 .
	gˇlFªqPõr2G
 = {

1303 
FREQ2FBIN
(2412, 1),

1304 
FREQ2FBIN
(2437, 1),

1305 
FREQ2FBIN
(2462, 1),

1308 .
	gˇlPõrD©a2G
 = {

1313 .
	gˇlT¨gë_‰eqbö_Cck
 = {

1314 
FREQ2FBIN
(2412, 1),

1315 
FREQ2FBIN
(2472, 1),

1317 .
	gˇlT¨gë_‰eqbö_2G
 = {

1318 
FREQ2FBIN
(2412, 1),

1319 
FREQ2FBIN
(2437, 1),

1320 
FREQ2FBIN
(2472, 1)

1322 .
	gˇlT¨gë_‰eqbö_2GHT20
 = {

1323 
FREQ2FBIN
(2412, 1),

1324 
FREQ2FBIN
(2437, 1),

1325 
FREQ2FBIN
(2472, 1)

1327 .
	gˇlT¨gë_‰eqbö_2GHT40
 = {

1328 
FREQ2FBIN
(2412, 1),

1329 
FREQ2FBIN
(2437, 1),

1330 
FREQ2FBIN
(2472, 1)

1332 .
	gˇlT¨gëPowîCck
 = {

1337 .
	gˇlT¨gëPowî2G
 = {

1343 .
	gˇlT¨gëPowî2GHT20
 = {

1348 .
	gˇlT¨gëPowî2GHT40
 = {

1353 .
	g˘lIndex_2G
 = {

1357 .
	g˘l_‰eqbö_2G
 = {

1359 
FREQ2FBIN
(2412, 1),

1360 
FREQ2FBIN
(2417, 1),

1361 
FREQ2FBIN
(2457, 1),

1362 
FREQ2FBIN
(2462, 1)

1365 
FREQ2FBIN
(2412, 1),

1366 
FREQ2FBIN
(2417, 1),

1367 
FREQ2FBIN
(2462, 1),

1372 
FREQ2FBIN
(2412, 1),

1373 
FREQ2FBIN
(2417, 1),

1374 
FREQ2FBIN
(2462, 1),

1378 
FREQ2FBIN
(2422, 1),

1379 
FREQ2FBIN
(2427, 1),

1380 
FREQ2FBIN
(2447, 1),

1381 
FREQ2FBIN
(2452, 1)

1385  
FREQ2FBIN
(2412, 1),

1386  
FREQ2FBIN
(2417, 1),

1387  
FREQ2FBIN
(2472, 1),

1388  
FREQ2FBIN
(2484, 1),

1392  
FREQ2FBIN
(2412, 1),

1393  
FREQ2FBIN
(2417, 1),

1394  
FREQ2FBIN
(2472, 1),

1399  
FREQ2FBIN
(2412, 1),

1400  
FREQ2FBIN
(2417, 1),

1401 
FREQ2FBIN
(2472, 1),

1406  
FREQ2FBIN
(2422, 1),

1407  
FREQ2FBIN
(2427, 1),

1408  
FREQ2FBIN
(2447, 1),

1409  
FREQ2FBIN
(2462, 1),

1413  
FREQ2FBIN
(2412, 1),

1414  
FREQ2FBIN
(2417, 1),

1415  
FREQ2FBIN
(2472, 1),

1419  
FREQ2FBIN
(2412, 1),

1420  
FREQ2FBIN
(2417, 1),

1421  
FREQ2FBIN
(2472, 1),

1426  
FREQ2FBIN
(2412, 1),

1427  
FREQ2FBIN
(2417, 1),

1428  
FREQ2FBIN
(2472, 1),

1433  
FREQ2FBIN
(2422, 1),

1434  
FREQ2FBIN
(2427, 1),

1435  
FREQ2FBIN
(2447, 1),

1436  
FREQ2FBIN
(2462, 1),

1439 .
	g˘lPowîD©a_2G
 = {

1440 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1441 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1442 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 1) } },

1444 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0) } },

1445 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1446 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1448 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0) } },

1449 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1450 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1452 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

1453 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

1454 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

1456 .
	gmodÆHódî5G
 = {

1458 .
™tCålComm⁄
 = 
LE32
(0x220),

1460 .
	g™tCålComm⁄2
 = 
LE32
(0x44444),

1462 .
	g™tCålChaö
 = {

1463 
LE16
(0x150), LE16(0x150), LE16(0x150),

1466 .
	gx©ãn1DB
 = {0, 0, 0},

1472 .
	gx©ãn1M¨gö
 = {0, 0, 0},

1473 .
	gãmpSl›e
 = 45,

1474 .
	gvﬁtSl›e
 = 0,

1476 .
	g•urCh™s
 = {0, 0, 0, 0, 0},

1478 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

1479 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

1480 .
	gquick_dr›
 = 0,

1481 .
	gx∑BüsLvl
 = 0,

1482 .
	gtxFømeToD©aSèπ
 = 0x0e,

1483 .
	gtxFømeToPaOn
 = 0x0e,

1484 .
	gtxClù
 = 3,

1485 .
	g™ã¬aGaö
 = 0,

1486 .
	gswôchSëéög
 = 0x2d,

1487 .
	gadcDesúedSize
 = -30,

1488 .
	gtxEndToX∑Off
 = 0,

1489 .
	gtxEndToRxOn
 = 0x2,

1490 .
	gtxFømeToX∑On
 = 0xe,

1491 .
	gthªsh62
 = 28,

1492 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0cf0e0e0),

1493 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x6cf0e0e0),

1494 .
	gswôchcom•dt
 = 0,

1495 .
	gx a_büs_°ªngth
 = 0,

1496 .
	gfutuªModÆ
 = {

1500 .
	gba£_ext2
 = {

1501 .
ãmpSl›eLow
 = 40,

1502 .
	gãmpSl›eHigh
 = 50,

1503 .
	gx©ãn1DBLow
 = {0, 0, 0},

1504 .
	gx©ãn1M¨göLow
 = {0, 0, 0},

1505 .
	gx©ãn1DBHigh
 = {0, 0, 0},

1506 .
	gx©ãn1M¨göHigh
 = {0, 0, 0}

1508 .
	gˇlFªqPõr5G
 = {

1509 
FREQ2FBIN
(5180, 0),

1510 
FREQ2FBIN
(5220, 0),

1511 
FREQ2FBIN
(5320, 0),

1512 
FREQ2FBIN
(5400, 0),

1513 
FREQ2FBIN
(5500, 0),

1514 
FREQ2FBIN
(5600, 0),

1515 
FREQ2FBIN
(5700, 0),

1516 
FREQ2FBIN
(5785, 0)

1518 .
	gˇlPõrD©a5G
 = {

1551 .
	gˇlT¨gë_‰eqbö_5G
 = {

1552 
FREQ2FBIN
(5180, 0),

1553 
FREQ2FBIN
(5240, 0),

1554 
FREQ2FBIN
(5320, 0),

1555 
FREQ2FBIN
(5400, 0),

1556 
FREQ2FBIN
(5500, 0),

1557 
FREQ2FBIN
(5600, 0),

1558 
FREQ2FBIN
(5700, 0),

1559 
FREQ2FBIN
(5825, 0)

1561 .
	gˇlT¨gë_‰eqbö_5GHT20
 = {

1562 
FREQ2FBIN
(5180, 0),

1563 
FREQ2FBIN
(5240, 0),

1564 
FREQ2FBIN
(5320, 0),

1565 
FREQ2FBIN
(5400, 0),

1566 
FREQ2FBIN
(5500, 0),

1567 
FREQ2FBIN
(5700, 0),

1568 
FREQ2FBIN
(5745, 0),

1569 
FREQ2FBIN
(5825, 0)

1571 .
	gˇlT¨gë_‰eqbö_5GHT40
 = {

1572 
FREQ2FBIN
(5180, 0),

1573 
FREQ2FBIN
(5240, 0),

1574 
FREQ2FBIN
(5320, 0),

1575 
FREQ2FBIN
(5400, 0),

1576 
FREQ2FBIN
(5500, 0),

1577 
FREQ2FBIN
(5700, 0),

1578 
FREQ2FBIN
(5745, 0),

1579 
FREQ2FBIN
(5825, 0)

1581 .
	gˇlT¨gëPowî5G
 = {

1592 .
	gˇlT¨gëPowî5GHT20
 = {

1606 .
	gˇlT¨gëPowî5GHT40
 = {

1620 .
	g˘lIndex_5G
 = {

1624 .
	g˘l_‰eqbö_5G
 = {

1626  
FREQ2FBIN
(5180, 0),

1627  
FREQ2FBIN
(5260, 0),

1628  
FREQ2FBIN
(5280, 0),

1629  
FREQ2FBIN
(5500, 0),

1630  
FREQ2FBIN
(5600, 0),

1631  
FREQ2FBIN
(5700, 0),

1632  
FREQ2FBIN
(5745, 0),

1633  
FREQ2FBIN
(5825, 0)

1636  
FREQ2FBIN
(5180, 0),

1637  
FREQ2FBIN
(5260, 0),

1638  
FREQ2FBIN
(5280, 0),

1639  
FREQ2FBIN
(5500, 0),

1640  
FREQ2FBIN
(5520, 0),

1641  
FREQ2FBIN
(5700, 0),

1642  
FREQ2FBIN
(5745, 0),

1643  
FREQ2FBIN
(5825, 0)

1647  
FREQ2FBIN
(5190, 0),

1648  
FREQ2FBIN
(5230, 0),

1649  
FREQ2FBIN
(5270, 0),

1650  
FREQ2FBIN
(5310, 0),

1651  
FREQ2FBIN
(5510, 0),

1652  
FREQ2FBIN
(5550, 0),

1653  
FREQ2FBIN
(5670, 0),

1654  
FREQ2FBIN
(5755, 0)

1658  
FREQ2FBIN
(5180, 0),

1659  
FREQ2FBIN
(5200, 0),

1660  
FREQ2FBIN
(5260, 0),

1661  
FREQ2FBIN
(5320, 0),

1662  
FREQ2FBIN
(5500, 0),

1663  
FREQ2FBIN
(5700, 0),

1669  
FREQ2FBIN
(5180, 0),

1670  
FREQ2FBIN
(5260, 0),

1671  
FREQ2FBIN
(5500, 0),

1672  
FREQ2FBIN
(5700, 0),

1680  
FREQ2FBIN
(5190, 0),

1681  
FREQ2FBIN
(5270, 0),

1682  
FREQ2FBIN
(5310, 0),

1683  
FREQ2FBIN
(5510, 0),

1684  
FREQ2FBIN
(5590, 0),

1685  
FREQ2FBIN
(5670, 0),

1691  
FREQ2FBIN
(5180, 0),

1692  
FREQ2FBIN
(5200, 0),

1693  
FREQ2FBIN
(5220, 0),

1694  
FREQ2FBIN
(5260, 0),

1695  
FREQ2FBIN
(5500, 0),

1696  
FREQ2FBIN
(5600, 0),

1697  
FREQ2FBIN
(5700, 0),

1698  
FREQ2FBIN
(5745, 0)

1702  
FREQ2FBIN
(5180, 0),

1703  
FREQ2FBIN
(5260, 0),

1704  
FREQ2FBIN
(5320, 0),

1705  
FREQ2FBIN
(5500, 0),

1706  
FREQ2FBIN
(5560, 0),

1707  
FREQ2FBIN
(5700, 0),

1708  
FREQ2FBIN
(5745, 0),

1709  
FREQ2FBIN
(5825, 0)

1713  
FREQ2FBIN
(5190, 0),

1714  
FREQ2FBIN
(5230, 0),

1715  
FREQ2FBIN
(5270, 0),

1716  
FREQ2FBIN
(5510, 0),

1717  
FREQ2FBIN
(5550, 0),

1718  
FREQ2FBIN
(5670, 0),

1719  
FREQ2FBIN
(5755, 0),

1720  
FREQ2FBIN
(5795, 0)

1723 .
	g˘lPowîD©a_5G
 = {

1726 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1727 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1732 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1733 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1738 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1739 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1744 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1745 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1750 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1751 
CTL
(60, 0), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1756 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1757 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

1762 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1763 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

1768 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1769 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

1774 
CTL
(60, 1), CTL(60, 0), CTL(60, 1), CTL(60, 1),

1775 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

1782 c⁄° 
¨9300_ì¥om
 
	g¨9300_x112
 = {

1783 .
ì¥omVîsi⁄
 = 2,

1784 .
	gãm∂©eVîsi⁄
 = 5,

1785 .
	gmacAddr
 = {0x00, 0x03, 0x7f, 0x0, 0x0, 0x0},

1786 .
	gcu°D©a
 = {"x112-041-f0000"},

1787 .
	gba£EïHódî
 = {

1788 .
ªgDmn
 = { 
LE16
(0), LE16(0x1f) },

1789 .
	gtxrxMask
 = 0x77,

1790 .
	g›C≠Fœgs
 = {

1791 .
›Fœgs
 = 
AR5416_OPFLAGS_11G
 | 
AR5416_OPFLAGS_11A
,

1792 .
	gìpMisc
 = 0,

1794 .
	grfSûít
 = 0,

1795 .
	gblueToŸhO±i⁄s
 = 0,

1796 .
	gdevi˚C≠
 = 0,

1797 .
	gdevi˚Ty≥
 = 5,

1798 .
	gpwrTabÀOff£t
 = 
AR9300_PWR_TABLE_OFFSET
,

1799 .
	g∑øms_f‹_tunög_ˇps
 = {0, 0},

1800 .
	g„©uªE«bÀ
 = 0x0d,

1809 .
	gmiscC⁄figuøti⁄
 = 0,

1810 .
	gì¥omWrôeE«bÀGpio
 = 6,

1811 .
	gwœnDißbÀGpio
 = 0,

1812 .
	gwœnLedGpio
 = 8,

1813 .
	grxB™dSñe˘Gpio
 = 0xff,

1814 .
	gtxrxgaö
 = 0x0,

1815 .
	gswªg
 = 0,

1817 .
	gmodÆHódî2G
 = {

1820 .
™tCålComm⁄
 = 
LE32
(0x110),

1822 .
	g™tCålComm⁄2
 = 
LE32
(0x22222),

1828 .
	g™tCålChaö
 = { 
LE16
(0x10), LE16(0x10), LE16(0x10) },

1834 .
	gx©ãn1DB
 = {0x1b, 0x1b, 0x1b},

1840 .
	gx©ãn1M¨gö
 = {0x15, 0x15, 0x15},

1841 .
	gãmpSl›e
 = 50,

1842 .
	gvﬁtSl›e
 = 0,

1848 .
	g•urCh™s
 = {
FREQ2FBIN
(2464, 1), 0, 0, 0, 0},

1854 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

1855 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

1856 .
	gquick_dr›
 = 0,

1857 .
	gx∑BüsLvl
 = 0,

1858 .
	gtxFømeToD©aSèπ
 = 0x0e,

1859 .
	gtxFømeToPaOn
 = 0x0e,

1860 .
	gtxClù
 = 3,

1861 .
	g™ã¬aGaö
 = 0,

1862 .
	gswôchSëéög
 = 0x2c,

1863 .
	gadcDesúedSize
 = -30,

1864 .
	gtxEndToX∑Off
 = 0,

1865 .
	gtxEndToRxOn
 = 0x2,

1866 .
	gtxFømeToX∑On
 = 0xe,

1867 .
	gthªsh62
 = 28,

1868 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0c80c080),

1869 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x0080c080),

1870 .
	gswôchcom•dt
 = 0,

1871 .
	gx a_büs_°ªngth
 = 0,

1872 .
	gfutuªModÆ
 = {

1876 .
	gba£_ext1
 = {

1877 .
™t_div_c⁄åﬁ
 = 0,

1878 .
	gfutuª
 = {0, 0},

1879 .
	gãmp¶›exãnsi⁄
 = {0, 0, 0, 0, 0, 0, 0, 0}

1881 .
	gˇlFªqPõr2G
 = {

1882 
FREQ2FBIN
(2412, 1),

1883 
FREQ2FBIN
(2437, 1),

1884 
FREQ2FBIN
(2472, 1),

1887 .
	gˇlPõrD©a2G
 = {

1892 .
	gˇlT¨gë_‰eqbö_Cck
 = {

1893 
FREQ2FBIN
(2412, 1),

1894 
FREQ2FBIN
(2472, 1),

1896 .
	gˇlT¨gë_‰eqbö_2G
 = {

1897 
FREQ2FBIN
(2412, 1),

1898 
FREQ2FBIN
(2437, 1),

1899 
FREQ2FBIN
(2472, 1)

1901 .
	gˇlT¨gë_‰eqbö_2GHT20
 = {

1902 
FREQ2FBIN
(2412, 1),

1903 
FREQ2FBIN
(2437, 1),

1904 
FREQ2FBIN
(2472, 1)

1906 .
	gˇlT¨gë_‰eqbö_2GHT40
 = {

1907 
FREQ2FBIN
(2412, 1),

1908 
FREQ2FBIN
(2437, 1),

1909 
FREQ2FBIN
(2472, 1)

1911 .
	gˇlT¨gëPowîCck
 = {

1916 .
	gˇlT¨gëPowî2G
 = {

1922 .
	gˇlT¨gëPowî2GHT20
 = {

1927 .
	gˇlT¨gëPowî2GHT40
 = {

1932 .
	g˘lIndex_2G
 = {

1936 .
	g˘l_‰eqbö_2G
 = {

1938 
FREQ2FBIN
(2412, 1),

1939 
FREQ2FBIN
(2417, 1),

1940 
FREQ2FBIN
(2457, 1),

1941 
FREQ2FBIN
(2462, 1)

1944 
FREQ2FBIN
(2412, 1),

1945 
FREQ2FBIN
(2417, 1),

1946 
FREQ2FBIN
(2462, 1),

1951 
FREQ2FBIN
(2412, 1),

1952 
FREQ2FBIN
(2417, 1),

1953 
FREQ2FBIN
(2462, 1),

1957 
FREQ2FBIN
(2422, 1),

1958 
FREQ2FBIN
(2427, 1),

1959 
FREQ2FBIN
(2447, 1),

1960 
FREQ2FBIN
(2452, 1)

1964  
FREQ2FBIN
(2412, 1),

1965  
FREQ2FBIN
(2417, 1),

1966  
FREQ2FBIN
(2472, 1),

1967  
FREQ2FBIN
(2484, 1),

1971  
FREQ2FBIN
(2412, 1),

1972  
FREQ2FBIN
(2417, 1),

1973  
FREQ2FBIN
(2472, 1),

1978  
FREQ2FBIN
(2412, 1),

1979  
FREQ2FBIN
(2417, 1),

1980 
FREQ2FBIN
(2472, 1),

1985  
FREQ2FBIN
(2422, 1),

1986  
FREQ2FBIN
(2427, 1),

1987  
FREQ2FBIN
(2447, 1),

1988  
FREQ2FBIN
(2462, 1),

1992  
FREQ2FBIN
(2412, 1),

1993  
FREQ2FBIN
(2417, 1),

1994  
FREQ2FBIN
(2472, 1),

1998  
FREQ2FBIN
(2412, 1),

1999  
FREQ2FBIN
(2417, 1),

2000  
FREQ2FBIN
(2472, 1),

2005  
FREQ2FBIN
(2412, 1),

2006  
FREQ2FBIN
(2417, 1),

2007  
FREQ2FBIN
(2472, 1),

2012  
FREQ2FBIN
(2422, 1),

2013  
FREQ2FBIN
(2427, 1),

2014  
FREQ2FBIN
(2447, 1),

2015  
FREQ2FBIN
(2462, 1),

2018 .
	g˘lPowîD©a_2G
 = {

2019 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2020 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2021 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 1) } },

2023 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0) } },

2024 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2025 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2027 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0) } },

2028 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2029 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2031 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2032 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

2033 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

2035 .
	gmodÆHódî5G
 = {

2037 .
™tCålComm⁄
 = 
LE32
(0x110),

2039 .
	g™tCålComm⁄2
 = 
LE32
(0x22222),

2041 .
	g™tCålChaö
 = {

2042 
LE16
(0x0), LE16(0x0), LE16(0x0),

2045 .
	gx©ãn1DB
 = {0x13, 0x19, 0x17},

2051 .
	gx©ãn1M¨gö
 = {0x19, 0x19, 0x19},

2052 .
	gãmpSl›e
 = 70,

2053 .
	gvﬁtSl›e
 = 15,

2055 .
	g•urCh™s
 = {0, 0, 0, 0, 0},

2057 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

2058 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

2059 .
	gquick_dr›
 = 0,

2060 .
	gx∑BüsLvl
 = 0,

2061 .
	gtxFømeToD©aSèπ
 = 0x0e,

2062 .
	gtxFømeToPaOn
 = 0x0e,

2063 .
	gtxClù
 = 3,

2064 .
	g™ã¬aGaö
 = 0,

2065 .
	gswôchSëéög
 = 0x2d,

2066 .
	gadcDesúedSize
 = -30,

2067 .
	gtxEndToX∑Off
 = 0,

2068 .
	gtxEndToRxOn
 = 0x2,

2069 .
	gtxFømeToX∑On
 = 0xe,

2070 .
	gthªsh62
 = 28,

2071 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0cf0e0e0),

2072 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x6cf0e0e0),

2073 .
	gswôchcom•dt
 = 0,

2074 .
	gx a_büs_°ªngth
 = 0,

2075 .
	gfutuªModÆ
 = {

2079 .
	gba£_ext2
 = {

2080 .
ãmpSl›eLow
 = 72,

2081 .
	gãmpSl›eHigh
 = 105,

2082 .
	gx©ãn1DBLow
 = {0x10, 0x14, 0x10},

2083 .
	gx©ãn1M¨göLow
 = {0x19, 0x19 , 0x19},

2084 .
	gx©ãn1DBHigh
 = {0x1d, 0x20, 0x24},

2085 .
	gx©ãn1M¨göHigh
 = {0x10, 0x10, 0x10}

2087 .
	gˇlFªqPõr5G
 = {

2088 
FREQ2FBIN
(5180, 0),

2089 
FREQ2FBIN
(5220, 0),

2090 
FREQ2FBIN
(5320, 0),

2091 
FREQ2FBIN
(5400, 0),

2092 
FREQ2FBIN
(5500, 0),

2093 
FREQ2FBIN
(5600, 0),

2094 
FREQ2FBIN
(5700, 0),

2095 
FREQ2FBIN
(5785, 0)

2097 .
	gˇlPõrD©a5G
 = {

2130 .
	gˇlT¨gë_‰eqbö_5G
 = {

2131 
FREQ2FBIN
(5180, 0),

2132 
FREQ2FBIN
(5220, 0),

2133 
FREQ2FBIN
(5320, 0),

2134 
FREQ2FBIN
(5400, 0),

2135 
FREQ2FBIN
(5500, 0),

2136 
FREQ2FBIN
(5600, 0),

2137 
FREQ2FBIN
(5725, 0),

2138 
FREQ2FBIN
(5825, 0)

2140 .
	gˇlT¨gë_‰eqbö_5GHT20
 = {

2141 
FREQ2FBIN
(5180, 0),

2142 
FREQ2FBIN
(5220, 0),

2143 
FREQ2FBIN
(5320, 0),

2144 
FREQ2FBIN
(5400, 0),

2145 
FREQ2FBIN
(5500, 0),

2146 
FREQ2FBIN
(5600, 0),

2147 
FREQ2FBIN
(5725, 0),

2148 
FREQ2FBIN
(5825, 0)

2150 .
	gˇlT¨gë_‰eqbö_5GHT40
 = {

2151 
FREQ2FBIN
(5180, 0),

2152 
FREQ2FBIN
(5220, 0),

2153 
FREQ2FBIN
(5320, 0),

2154 
FREQ2FBIN
(5400, 0),

2155 
FREQ2FBIN
(5500, 0),

2156 
FREQ2FBIN
(5600, 0),

2157 
FREQ2FBIN
(5725, 0),

2158 
FREQ2FBIN
(5825, 0)

2160 .
	gˇlT¨gëPowî5G
 = {

2171 .
	gˇlT¨gëPowî5GHT20
 = {

2185 .
	gˇlT¨gëPowî5GHT40
 = {

2199 .
	g˘lIndex_5G
 = {

2203 .
	g˘l_‰eqbö_5G
 = {

2205  
FREQ2FBIN
(5180, 0),

2206  
FREQ2FBIN
(5260, 0),

2207  
FREQ2FBIN
(5280, 0),

2208  
FREQ2FBIN
(5500, 0),

2209  
FREQ2FBIN
(5600, 0),

2210  
FREQ2FBIN
(5700, 0),

2211  
FREQ2FBIN
(5745, 0),

2212  
FREQ2FBIN
(5825, 0)

2215  
FREQ2FBIN
(5180, 0),

2216  
FREQ2FBIN
(5260, 0),

2217  
FREQ2FBIN
(5280, 0),

2218  
FREQ2FBIN
(5500, 0),

2219  
FREQ2FBIN
(5520, 0),

2220  
FREQ2FBIN
(5700, 0),

2221  
FREQ2FBIN
(5745, 0),

2222  
FREQ2FBIN
(5825, 0)

2226  
FREQ2FBIN
(5190, 0),

2227  
FREQ2FBIN
(5230, 0),

2228  
FREQ2FBIN
(5270, 0),

2229  
FREQ2FBIN
(5310, 0),

2230  
FREQ2FBIN
(5510, 0),

2231  
FREQ2FBIN
(5550, 0),

2232  
FREQ2FBIN
(5670, 0),

2233  
FREQ2FBIN
(5755, 0)

2237  
FREQ2FBIN
(5180, 0),

2238  
FREQ2FBIN
(5200, 0),

2239  
FREQ2FBIN
(5260, 0),

2240  
FREQ2FBIN
(5320, 0),

2241  
FREQ2FBIN
(5500, 0),

2242  
FREQ2FBIN
(5700, 0),

2248  
FREQ2FBIN
(5180, 0),

2249  
FREQ2FBIN
(5260, 0),

2250  
FREQ2FBIN
(5500, 0),

2251  
FREQ2FBIN
(5700, 0),

2259  
FREQ2FBIN
(5190, 0),

2260  
FREQ2FBIN
(5270, 0),

2261  
FREQ2FBIN
(5310, 0),

2262  
FREQ2FBIN
(5510, 0),

2263  
FREQ2FBIN
(5590, 0),

2264  
FREQ2FBIN
(5670, 0),

2270  
FREQ2FBIN
(5180, 0),

2271  
FREQ2FBIN
(5200, 0),

2272  
FREQ2FBIN
(5220, 0),

2273  
FREQ2FBIN
(5260, 0),

2274  
FREQ2FBIN
(5500, 0),

2275  
FREQ2FBIN
(5600, 0),

2276  
FREQ2FBIN
(5700, 0),

2277  
FREQ2FBIN
(5745, 0)

2281  
FREQ2FBIN
(5180, 0),

2282  
FREQ2FBIN
(5260, 0),

2283  
FREQ2FBIN
(5320, 0),

2284  
FREQ2FBIN
(5500, 0),

2285  
FREQ2FBIN
(5560, 0),

2286  
FREQ2FBIN
(5700, 0),

2287  
FREQ2FBIN
(5745, 0),

2288  
FREQ2FBIN
(5825, 0)

2292  
FREQ2FBIN
(5190, 0),

2293  
FREQ2FBIN
(5230, 0),

2294  
FREQ2FBIN
(5270, 0),

2295  
FREQ2FBIN
(5510, 0),

2296  
FREQ2FBIN
(5550, 0),

2297  
FREQ2FBIN
(5670, 0),

2298  
FREQ2FBIN
(5755, 0),

2299  
FREQ2FBIN
(5795, 0)

2302 .
	g˘lPowîD©a_5G
 = {

2305 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2306 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2311 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2312 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2317 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2318 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2323 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2324 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2329 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2330 
CTL
(60, 0), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2335 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2336 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2341 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2342 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2347 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2348 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2353 
CTL
(60, 1), CTL(60, 0), CTL(60, 1), CTL(60, 1),

2354 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2360 c⁄° 
¨9300_ì¥om
 
	g¨9300_h116
 = {

2361 .
ì¥omVîsi⁄
 = 2,

2362 .
	gãm∂©eVîsi⁄
 = 4,

2363 .
	gmacAddr
 = {0x00, 0x03, 0x7f, 0x0, 0x0, 0x0},

2364 .
	gcu°D©a
 = {"h116-041-f0000"},

2365 .
	gba£EïHódî
 = {

2366 .
ªgDmn
 = { 
LE16
(0), LE16(0x1f) },

2367 .
	gtxrxMask
 = 0x33,

2368 .
	g›C≠Fœgs
 = {

2369 .
›Fœgs
 = 
AR5416_OPFLAGS_11G
 | 
AR5416_OPFLAGS_11A
,

2370 .
	gìpMisc
 = 0,

2372 .
	grfSûít
 = 0,

2373 .
	gblueToŸhO±i⁄s
 = 0,

2374 .
	gdevi˚C≠
 = 0,

2375 .
	gdevi˚Ty≥
 = 5,

2376 .
	gpwrTabÀOff£t
 = 
AR9300_PWR_TABLE_OFFSET
,

2377 .
	g∑øms_f‹_tunög_ˇps
 = {0, 0},

2378 .
	g„©uªE«bÀ
 = 0x0d,

2387 .
	gmiscC⁄figuøti⁄
 = 0,

2388 .
	gì¥omWrôeE«bÀGpio
 = 6,

2389 .
	gwœnDißbÀGpio
 = 0,

2390 .
	gwœnLedGpio
 = 8,

2391 .
	grxB™dSñe˘Gpio
 = 0xff,

2392 .
	gtxrxgaö
 = 0x10,

2393 .
	gswªg
 = 0,

2395 .
	gmodÆHódî2G
 = {

2398 .
™tCålComm⁄
 = 
LE32
(0x110),

2400 .
	g™tCålComm⁄2
 = 
LE32
(0x44444),

2406 .
	g™tCålChaö
 = { 
LE16
(0x10), LE16(0x10), LE16(0x10) },

2412 .
	gx©ãn1DB
 = {0x1f, 0x1f, 0x1f},

2418 .
	gx©ãn1M¨gö
 = {0x12, 0x12, 0x12},

2419 .
	gãmpSl›e
 = 25,

2420 .
	gvﬁtSl›e
 = 0,

2426 .
	g•urCh™s
 = {
FREQ2FBIN
(2464, 1), 0, 0, 0, 0},

2432 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

2433 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

2434 .
	gquick_dr›
 = 0,

2435 .
	gx∑BüsLvl
 = 0,

2436 .
	gtxFømeToD©aSèπ
 = 0x0e,

2437 .
	gtxFømeToPaOn
 = 0x0e,

2438 .
	gtxClù
 = 3,

2439 .
	g™ã¬aGaö
 = 0,

2440 .
	gswôchSëéög
 = 0x2c,

2441 .
	gadcDesúedSize
 = -30,

2442 .
	gtxEndToX∑Off
 = 0,

2443 .
	gtxEndToRxOn
 = 0x2,

2444 .
	gtxFømeToX∑On
 = 0xe,

2445 .
	gthªsh62
 = 28,

2446 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0c80C080),

2447 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x0080C080),

2448 .
	gswôchcom•dt
 = 0,

2449 .
	gx a_büs_°ªngth
 = 0,

2450 .
	gfutuªModÆ
 = {

2454 .
	gba£_ext1
 = {

2455 .
™t_div_c⁄åﬁ
 = 0,

2456 .
	gfutuª
 = {0, 0},

2457 .
	gãmp¶›exãnsi⁄
 = {0, 0, 0, 0, 0, 0, 0, 0}

2459 .
	gˇlFªqPõr2G
 = {

2460 
FREQ2FBIN
(2412, 1),

2461 
FREQ2FBIN
(2437, 1),

2462 
FREQ2FBIN
(2462, 1),

2465 .
	gˇlPõrD©a2G
 = {

2470 .
	gˇlT¨gë_‰eqbö_Cck
 = {

2471 
FREQ2FBIN
(2412, 1),

2472 
FREQ2FBIN
(2472, 1),

2474 .
	gˇlT¨gë_‰eqbö_2G
 = {

2475 
FREQ2FBIN
(2412, 1),

2476 
FREQ2FBIN
(2437, 1),

2477 
FREQ2FBIN
(2472, 1)

2479 .
	gˇlT¨gë_‰eqbö_2GHT20
 = {

2480 
FREQ2FBIN
(2412, 1),

2481 
FREQ2FBIN
(2437, 1),

2482 
FREQ2FBIN
(2472, 1)

2484 .
	gˇlT¨gë_‰eqbö_2GHT40
 = {

2485 
FREQ2FBIN
(2412, 1),

2486 
FREQ2FBIN
(2437, 1),

2487 
FREQ2FBIN
(2472, 1)

2489 .
	gˇlT¨gëPowîCck
 = {

2494 .
	gˇlT¨gëPowî2G
 = {

2500 .
	gˇlT¨gëPowî2GHT20
 = {

2505 .
	gˇlT¨gëPowî2GHT40
 = {

2510 .
	g˘lIndex_2G
 = {

2514 .
	g˘l_‰eqbö_2G
 = {

2516 
FREQ2FBIN
(2412, 1),

2517 
FREQ2FBIN
(2417, 1),

2518 
FREQ2FBIN
(2457, 1),

2519 
FREQ2FBIN
(2462, 1)

2522 
FREQ2FBIN
(2412, 1),

2523 
FREQ2FBIN
(2417, 1),

2524 
FREQ2FBIN
(2462, 1),

2529 
FREQ2FBIN
(2412, 1),

2530 
FREQ2FBIN
(2417, 1),

2531 
FREQ2FBIN
(2462, 1),

2535 
FREQ2FBIN
(2422, 1),

2536 
FREQ2FBIN
(2427, 1),

2537 
FREQ2FBIN
(2447, 1),

2538 
FREQ2FBIN
(2452, 1)

2542  
FREQ2FBIN
(2412, 1),

2543  
FREQ2FBIN
(2417, 1),

2544  
FREQ2FBIN
(2472, 1),

2545  
FREQ2FBIN
(2484, 1),

2549  
FREQ2FBIN
(2412, 1),

2550  
FREQ2FBIN
(2417, 1),

2551  
FREQ2FBIN
(2472, 1),

2556  
FREQ2FBIN
(2412, 1),

2557  
FREQ2FBIN
(2417, 1),

2558 
FREQ2FBIN
(2472, 1),

2563  
FREQ2FBIN
(2422, 1),

2564  
FREQ2FBIN
(2427, 1),

2565  
FREQ2FBIN
(2447, 1),

2566  
FREQ2FBIN
(2462, 1),

2570  
FREQ2FBIN
(2412, 1),

2571  
FREQ2FBIN
(2417, 1),

2572  
FREQ2FBIN
(2472, 1),

2576  
FREQ2FBIN
(2412, 1),

2577  
FREQ2FBIN
(2417, 1),

2578  
FREQ2FBIN
(2472, 1),

2583  
FREQ2FBIN
(2412, 1),

2584  
FREQ2FBIN
(2417, 1),

2585  
FREQ2FBIN
(2472, 1),

2590  
FREQ2FBIN
(2422, 1),

2591  
FREQ2FBIN
(2427, 1),

2592  
FREQ2FBIN
(2447, 1),

2593  
FREQ2FBIN
(2462, 1),

2596 .
	g˘lPowîD©a_2G
 = {

2597 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2598 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2599 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 1) } },

2601 { { 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0) } },

2602 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2603 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2605 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0) } },

2606 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2607 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2609 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 0) } },

2610 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

2611 { { 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 1) } },

2613 .
	gmodÆHódî5G
 = {

2615 .
™tCålComm⁄
 = 
LE32
(0x220),

2617 .
	g™tCålComm⁄2
 = 
LE32
(0x44444),

2619 .
	g™tCålChaö
 = {

2620 
LE16
(0x150), LE16(0x150), LE16(0x150),

2623 .
	gx©ãn1DB
 = {0x19, 0x19, 0x19},

2629 .
	gx©ãn1M¨gö
 = {0x14, 0x14, 0x14},

2630 .
	gãmpSl›e
 = 70,

2631 .
	gvﬁtSl›e
 = 0,

2633 .
	g•urCh™s
 = {0, 0, 0, 0, 0},

2635 .
	gnoi£Flo‹ThªshCh
 = {-1, 0, 0},

2636 .
	gª£rved
 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

2637 .
	gquick_dr›
 = 0,

2638 .
	gx∑BüsLvl
 = 0,

2639 .
	gtxFømeToD©aSèπ
 = 0x0e,

2640 .
	gtxFømeToPaOn
 = 0x0e,

2641 .
	gtxClù
 = 3,

2642 .
	g™ã¬aGaö
 = 0,

2643 .
	gswôchSëéög
 = 0x2d,

2644 .
	gadcDesúedSize
 = -30,

2645 .
	gtxEndToX∑Off
 = 0,

2646 .
	gtxEndToRxOn
 = 0x2,

2647 .
	gtxFømeToX∑On
 = 0xe,

2648 .
	gthªsh62
 = 28,

2649 .
	g∑pdR©eMaskHt20
 = 
LE32
(0x0cf0e0e0),

2650 .
	g∑pdR©eMaskHt40
 = 
LE32
(0x6cf0e0e0),

2651 .
	gswôchcom•dt
 = 0,

2652 .
	gx a_büs_°ªngth
 = 0,

2653 .
	gfutuªModÆ
 = {

2657 .
	gba£_ext2
 = {

2658 .
ãmpSl›eLow
 = 35,

2659 .
	gãmpSl›eHigh
 = 50,

2660 .
	gx©ãn1DBLow
 = {0, 0, 0},

2661 .
	gx©ãn1M¨göLow
 = {0, 0, 0},

2662 .
	gx©ãn1DBHigh
 = {0, 0, 0},

2663 .
	gx©ãn1M¨göHigh
 = {0, 0, 0}

2665 .
	gˇlFªqPõr5G
 = {

2666 
FREQ2FBIN
(5160, 0),

2667 
FREQ2FBIN
(5220, 0),

2668 
FREQ2FBIN
(5320, 0),

2669 
FREQ2FBIN
(5400, 0),

2670 
FREQ2FBIN
(5500, 0),

2671 
FREQ2FBIN
(5600, 0),

2672 
FREQ2FBIN
(5700, 0),

2673 
FREQ2FBIN
(5785, 0)

2675 .
	gˇlPõrD©a5G
 = {

2708 .
	gˇlT¨gë_‰eqbö_5G
 = {

2709 
FREQ2FBIN
(5180, 0),

2710 
FREQ2FBIN
(5240, 0),

2711 
FREQ2FBIN
(5320, 0),

2712 
FREQ2FBIN
(5400, 0),

2713 
FREQ2FBIN
(5500, 0),

2714 
FREQ2FBIN
(5600, 0),

2715 
FREQ2FBIN
(5700, 0),

2716 
FREQ2FBIN
(5825, 0)

2718 .
	gˇlT¨gë_‰eqbö_5GHT20
 = {

2719 
FREQ2FBIN
(5180, 0),

2720 
FREQ2FBIN
(5240, 0),

2721 
FREQ2FBIN
(5320, 0),

2722 
FREQ2FBIN
(5400, 0),

2723 
FREQ2FBIN
(5500, 0),

2724 
FREQ2FBIN
(5700, 0),

2725 
FREQ2FBIN
(5745, 0),

2726 
FREQ2FBIN
(5825, 0)

2728 .
	gˇlT¨gë_‰eqbö_5GHT40
 = {

2729 
FREQ2FBIN
(5180, 0),

2730 
FREQ2FBIN
(5240, 0),

2731 
FREQ2FBIN
(5320, 0),

2732 
FREQ2FBIN
(5400, 0),

2733 
FREQ2FBIN
(5500, 0),

2734 
FREQ2FBIN
(5700, 0),

2735 
FREQ2FBIN
(5745, 0),

2736 
FREQ2FBIN
(5825, 0)

2738 .
	gˇlT¨gëPowî5G
 = {

2749 .
	gˇlT¨gëPowî5GHT20
 = {

2763 .
	gˇlT¨gëPowî5GHT40
 = {

2777 .
	g˘lIndex_5G
 = {

2781 .
	g˘l_‰eqbö_5G
 = {

2783  
FREQ2FBIN
(5180, 0),

2784  
FREQ2FBIN
(5260, 0),

2785  
FREQ2FBIN
(5280, 0),

2786  
FREQ2FBIN
(5500, 0),

2787  
FREQ2FBIN
(5600, 0),

2788  
FREQ2FBIN
(5700, 0),

2789  
FREQ2FBIN
(5745, 0),

2790  
FREQ2FBIN
(5825, 0)

2793  
FREQ2FBIN
(5180, 0),

2794  
FREQ2FBIN
(5260, 0),

2795  
FREQ2FBIN
(5280, 0),

2796  
FREQ2FBIN
(5500, 0),

2797  
FREQ2FBIN
(5520, 0),

2798  
FREQ2FBIN
(5700, 0),

2799  
FREQ2FBIN
(5745, 0),

2800  
FREQ2FBIN
(5825, 0)

2804  
FREQ2FBIN
(5190, 0),

2805  
FREQ2FBIN
(5230, 0),

2806  
FREQ2FBIN
(5270, 0),

2807  
FREQ2FBIN
(5310, 0),

2808  
FREQ2FBIN
(5510, 0),

2809  
FREQ2FBIN
(5550, 0),

2810  
FREQ2FBIN
(5670, 0),

2811  
FREQ2FBIN
(5755, 0)

2815  
FREQ2FBIN
(5180, 0),

2816  
FREQ2FBIN
(5200, 0),

2817  
FREQ2FBIN
(5260, 0),

2818  
FREQ2FBIN
(5320, 0),

2819  
FREQ2FBIN
(5500, 0),

2820  
FREQ2FBIN
(5700, 0),

2826  
FREQ2FBIN
(5180, 0),

2827  
FREQ2FBIN
(5260, 0),

2828  
FREQ2FBIN
(5500, 0),

2829  
FREQ2FBIN
(5700, 0),

2837  
FREQ2FBIN
(5190, 0),

2838  
FREQ2FBIN
(5270, 0),

2839  
FREQ2FBIN
(5310, 0),

2840  
FREQ2FBIN
(5510, 0),

2841  
FREQ2FBIN
(5590, 0),

2842  
FREQ2FBIN
(5670, 0),

2848  
FREQ2FBIN
(5180, 0),

2849  
FREQ2FBIN
(5200, 0),

2850  
FREQ2FBIN
(5220, 0),

2851  
FREQ2FBIN
(5260, 0),

2852  
FREQ2FBIN
(5500, 0),

2853  
FREQ2FBIN
(5600, 0),

2854  
FREQ2FBIN
(5700, 0),

2855  
FREQ2FBIN
(5745, 0)

2859  
FREQ2FBIN
(5180, 0),

2860  
FREQ2FBIN
(5260, 0),

2861  
FREQ2FBIN
(5320, 0),

2862  
FREQ2FBIN
(5500, 0),

2863  
FREQ2FBIN
(5560, 0),

2864  
FREQ2FBIN
(5700, 0),

2865  
FREQ2FBIN
(5745, 0),

2866  
FREQ2FBIN
(5825, 0)

2870  
FREQ2FBIN
(5190, 0),

2871  
FREQ2FBIN
(5230, 0),

2872  
FREQ2FBIN
(5270, 0),

2873  
FREQ2FBIN
(5510, 0),

2874  
FREQ2FBIN
(5550, 0),

2875  
FREQ2FBIN
(5670, 0),

2876  
FREQ2FBIN
(5755, 0),

2877  
FREQ2FBIN
(5795, 0)

2880 .
	g˘lPowîD©a_5G
 = {

2883 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2884 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2889 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2890 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2895 
CTL
(60, 0), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2896 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2901 
CTL
(60, 0), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2902 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2907 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2908 
CTL
(60, 0), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2913 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2914 
CTL
(60, 1), CTL(60, 0), CTL(60, 0), CTL(60, 0),

2919 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2920 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 1),

2925 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2926 
CTL
(60, 1), CTL(60, 1), CTL(60, 1), CTL(60, 0),

2931 
CTL
(60, 1), CTL(60, 0), CTL(60, 1), CTL(60, 1),

2932 
CTL
(60, 1), CTL(60, 1), CTL(60, 0), CTL(60, 1),

2939 c⁄° 
¨9300_ì¥om
 *
	g¨9300_ìp_ãm∂©es
[] = {

2940 &
¨9300_deÁu…
,

2941 &
¨9300_x112
,

2942 &
¨9300_h116
,

2943 &
¨9300_h112
,

2944 &
¨9300_x113
,

2947 c⁄° 
¨9300_ì¥om
 *
	$¨9003_ì¥om_°ru˘_föd_by_id
(
id
)

2949 
	#N_LOOP
 ((
¨9300_ìp_ãm∂©es
Ë/ ◊r9300_ìp_ãm∂©es[0]))

	)

2950 
ô
;

2952 
ô
 = 0; ià< 
N_LOOP
; it++)

2953 i‡(
¨9300_ìp_ãm∂©es
[
ô
]->
ãm∂©eVîsi⁄
 =
id
)

2954  
¨9300_ìp_ãm∂©es
[
ô
];

2955  
NULL
;

2956 #unde‡
N_LOOP


2957 
	}
}

2959 
	$©h9k_hw_¨9300_check_ì¥om
(
©h_hw
 *
ah
)

2962 
	}
}

2964 
	$öãΩﬁ©e
(
x
, 
xa
, 
xb
, 
ya
, 
yb
)

2966 
bf
, 
Á˘‹
, 
∂us
;

2968 
bf
 = 2 * (
yb
 - 
ya
Ë* (
x
 - 
xa
Ë/ (
xb
 - xa);

2969 
Á˘‹
 = 
bf
 / 2;

2970 
∂us
 = 
bf
 % 2;

2971  
ya
 + 
Á˘‹
 + 
∂us
;

2972 
	}
}

2974 
u32
 
	$©h9k_hw_¨9300_gë_ì¥om
(
©h_hw
 *
ah
,

2975 
ì¥om_∑øm
 
∑øm
)

2977 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

2978 
¨9300_ba£_ìp_hdr
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

2980 
∑øm
) {

2981 
EEP_MAC_LSW
:

2982  
	`gë_u«lig√d_be16
(
ìp
->
macAddr
);

2983 
EEP_MAC_MID
:

2984  
	`gë_u«lig√d_be16
(
ìp
->
macAddr
 + 2);

2985 
EEP_MAC_MSW
:

2986  
	`gë_u«lig√d_be16
(
ìp
->
macAddr
 + 4);

2987 
EEP_REG_0
:

2988  
	`À16_to_˝u
(
pBa£
->
ªgDmn
[0]);

2989 
EEP_OP_CAP
:

2990  
pBa£
->
devi˚C≠
;

2991 
EEP_OP_MODE
:

2992  
pBa£
->
›C≠Fœgs
.
›Fœgs
;

2993 
EEP_RF_SILENT
:

2994  
pBa£
->
rfSûít
;

2995 
EEP_TX_MASK
:

2996  (
pBa£
->
txrxMask
 >> 4) & 0xf;

2997 
EEP_RX_MASK
:

2998  
pBa£
->
txrxMask
 & 0xf;

2999 
EEP_PAPRD
:

3000  !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(5));

3001 
EEP_CHAIN_MASK_REDUCE
:

3002  (
pBa£
->
miscC⁄figuøti⁄
 >> 0x3) & 0x1;

3003 
EEP_ANT_DIV_CTL1
:

3004 i‡(
	`AR_SREV_9565
(
ah
))

3005  
AR9300_EEP_ANTDIV_CONTROL_DEFAULT_VALUE
;

3007  
ìp
->
ba£_ext1
.
™t_div_c⁄åﬁ
;

3008 
EEP_ANTENNA_GAIN_5G
:

3009  
ìp
->
modÆHódî5G
.
™ã¬aGaö
;

3010 
EEP_ANTENNA_GAIN_2G
:

3011  
ìp
->
modÆHódî2G
.
™ã¬aGaö
;

3015 
	}
}

3017 
boﬁ
 
	$¨9300_ì¥om_ªad_byã
(
©h_hw
 *
ah
, 
addªss
,

3018 
u8
 *
buf„r
)

3020 
u16
 
vÆ
;

3022 i‡(
	`u∆ikñy
(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
addªss
 / 2, &
vÆ
)))

3023  
Ál£
;

3025 *
buf„r
 = (
vÆ
 >> (8 * (
addªss
 % 2))) & 0xff;

3026  
åue
;

3027 
	}
}

3029 
boﬁ
 
	$¨9300_ì¥om_ªad_w‹d
(
©h_hw
 *
ah
, 
addªss
,

3030 
u8
 *
buf„r
)

3032 
u16
 
vÆ
;

3034 i‡(
	`u∆ikñy
(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
addªss
 / 2, &
vÆ
)))

3035  
Ál£
;

3037 
buf„r
[0] = 
vÆ
 >> 8;

3038 
buf„r
[1] = 
vÆ
 & 0xff;

3040  
åue
;

3041 
	}
}

3043 
boﬁ
 
	$¨9300_ªad_ì¥om
(
©h_hw
 *
ah
, 
addªss
, 
u8
 *
buf„r
,

3044 
cou¡
)

3046 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

3047 
i
;

3049 i‡((
addªss
 < 0Ë|| (◊ddªs†+ 
cou¡
Ë/ 2 > 
AR9300_EEPROM_SIZE
 - 1)) {

3050 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "eepromáddressÇot inÑange\n");

3051  
Ál£
;

3059 i‡(
addªss
 % 2 == 0) {

3060 i‡(!
	`¨9300_ì¥om_ªad_byã
(
ah
, 
addªss
--, 
buf„r
++))

3061 
îr‹
;

3063 
cou¡
--;

3066 
i
 = 0; i < 
cou¡
 / 2; i++) {

3067 i‡(!
	`¨9300_ì¥om_ªad_w‹d
(
ah
, 
addªss
, 
buf„r
))

3068 
îr‹
;

3070 
addªss
 -= 2;

3071 
buf„r
 += 2;

3074 i‡(
cou¡
 % 2)

3075 i‡(!
	`¨9300_ì¥om_ªad_byã
(
ah
, 
addªss
, 
buf„r
))

3076 
îr‹
;

3078  
åue
;

3080 
îr‹
:

3081 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "unableÅoÑeadÉepromÑegionát offset %d\n",

3082 
addªss
);

3083  
Ál£
;

3084 
	}
}

3086 
boﬁ
 
	$¨9300_Ÿp_ªad_w‹d
(
©h_hw
 *
ah
, 
addr
, 
u32
 *
d©a
)

3088 
	`REG_READ
(
ah
, 
AR9300_OTP_BASE
 + (4 * 
addr
));

3090 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR9300_OTP_STATUS
, 
AR9300_OTP_STATUS_TYPE
,

3091 
AR9300_OTP_STATUS_VALID
, 1000))

3092  
Ál£
;

3094 *
d©a
 = 
	`REG_READ
(
ah
, 
AR9300_OTP_READ_DATA
);

3095  
åue
;

3096 
	}
}

3098 
boﬁ
 
	$¨9300_ªad_Ÿp
(
©h_hw
 *
ah
, 
addªss
, 
u8
 *
buf„r
,

3099 
cou¡
)

3101 
u32
 
d©a
;

3102 
i
;

3104 
i
 = 0; i < 
cou¡
; i++) {

3105 
off£t
 = 8 * ((
addªss
 - 
i
) % 4);

3106 i‡(!
	`¨9300_Ÿp_ªad_w‹d
(
ah
, (
addªss
 - 
i
Ë/ 4, &
d©a
))

3107  
Ál£
;

3109 
buf„r
[
i
] = (
d©a
 >> 
off£t
) & 0xff;

3112  
åue
;

3113 
	}
}

3116 
	$¨9300_comp_hdr_u≈ack
(
u8
 *
be°
, *
code
, *
ª„ªn˚
,

3117 *
Àngth
, *
maj‹
, *
mö‹
)

3119 
vÆue
[4];

3121 
vÆue
[0] = 
be°
[0];

3122 
vÆue
[1] = 
be°
[1];

3123 
vÆue
[2] = 
be°
[2];

3124 
vÆue
[3] = 
be°
[3];

3125 *
code
 = ((
vÆue
[0] >> 5) & 0x0007);

3126 *
ª„ªn˚
 = (
vÆue
[0] & 0x001f) | ((value[1] >> 2) & 0x0020);

3127 *
Àngth
 = ((
vÆue
[1] << 4) & 0x07f0) | ((value[2] >> 4) & 0x000f);

3128 *
maj‹
 = (
vÆue
[2] & 0x000f);

3129 *
mö‹
 = (
vÆue
[3] & 0x00ff);

3130 
	}
}

3132 
u16
 
	$¨9300_comp_cksum
(
u8
 *
d©a
, 
dsize
)

3134 
ô
, 
checksum
 = 0;

3136 
ô
 = 0; ià< 
dsize
; it++) {

3137 
checksum
 +
d©a
[
ô
];

3138 
checksum
 &= 0xffff;

3141  
checksum
;

3142 
	}
}

3144 
boﬁ
 
	$¨9300_uncom¥ess_block
(
©h_hw
 *
ah
,

3145 
u8
 *
m±r
,

3146 
md©aSize
,

3147 
u8
 *
block
,

3148 
size
)

3150 
ô
;

3151 
•Ÿ
;

3152 
off£t
;

3153 
Àngth
;

3154 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

3156 
•Ÿ
 = 0;

3158 
ô
 = 0; ià< 
size
; ià+(
Àngth
+2)) {

3159 
off£t
 = 
block
[
ô
];

3160 
off£t
 &= 0xff;

3161 
•Ÿ
 +
off£t
;

3162 
Àngth
 = 
block
[
ô
+1];

3163 
Àngth
 &= 0xff;

3165 i‡(
Àngth
 > 0 && 
•Ÿ
 >0 && spŸ+Àngth <
md©aSize
) {

3166 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3168 
ô
, 
•Ÿ
, 
off£t
, 
Àngth
);

3169 
	`mem˝y
(&
m±r
[
•Ÿ
], &
block
[
ô
+2], 
Àngth
);

3170 
•Ÿ
 +
Àngth
;

3171 } i‡(
Àngth
 > 0) {

3172 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3174 
ô
, 
•Ÿ
, 
off£t
, 
Àngth
);

3175  
Ál£
;

3178  
åue
;

3179 
	}
}

3181 
	$¨9300_com¥ess_decisi⁄
(
©h_hw
 *
ah
,

3182 
ô
,

3183 
code
,

3184 
ª„ªn˚
,

3185 
u8
 *
m±r
,

3186 
u8
 *
w‹d
, 
Àngth
, 
md©a_size
)

3188 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

3189 c⁄° 
¨9300_ì¥om
 *
ìp
 = 
NULL
;

3191 
code
) {

3192 
_Com¥essN⁄e
:

3193 i‡(
Àngth
 !
md©a_size
) {

3194 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3196 
md©a_size
, 
Àngth
);

3199 
	`mem˝y
(
m±r
, 
w‹d
 + 
COMP_HDR_LEN
, 
Àngth
);

3200 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3202 
ô
, 
Àngth
);

3204 
_Com¥essBlock
:

3205 i‡(
ª„ªn˚
 == 0) {

3207 
ìp
 = 
	`¨9003_ì¥om_°ru˘_föd_by_id
(
ª„ªn˚
);

3208 i‡(
ìp
 =
NULL
) {

3209 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3211 
ª„ªn˚
);

3214 
	`mem˝y
(
m±r
, 
ìp
, 
md©a_size
);

3216 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3218 
ô
, 
ª„ªn˚
, 
Àngth
);

3219 
	`¨9300_uncom¥ess_block
(
ah
, 
m±r
, 
md©a_size
,

3220 (
w‹d
 + 
COMP_HDR_LEN
), 
Àngth
);

3223 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "unknow¿com¥essi⁄ codê%d\n", 
code
);

3227 
	}
}

3229 
	$boﬁ
 (*
	tì¥om_ªad_›
)(
	t©h_hw
 *
	tah
, 
	taddªss
, 
	tu8
 *
	tbuf„r
,

3230 
	tcou¡
);

3232 
boﬁ
 
	$¨9300_check_hódî
(*
d©a
)

3234 
u32
 *
w‹d
 = 
d©a
;

3235  !(*
w‹d
 == 0 || *word == ~0);

3236 
	}
}

3238 
boﬁ
 
	$¨9300_check_ì¥om_hódî
(
©h_hw
 *
ah
, 
ì¥om_ªad_›
 
ªad
,

3239 
ba£_addr
)

3241 
u8
 
hódî
[4];

3243 i‡(!
	`ªad
(
ah
, 
ba£_addr
, 
hódî
, 4))

3244  
Ál£
;

3246  
	`¨9300_check_hódî
(
hódî
);

3247 
	}
}

3249 
	$¨9300_ì¥om_ª°‹e_Êash
(
©h_hw
 *
ah
, 
u8
 *
m±r
,

3250 
md©a_size
)

3252 
u16
 *
d©a
 = (u16 *Ë
m±r
;

3253 
i
;

3255 
i
 = 0; i < 
md©a_size
 / 2; i++, 
d©a
++)

3256 
	`©h9k_hw_nvøm_ªad
(
ah
, 
i
, 
d©a
);

3259 
	}
}

3267 
	$¨9300_ì¥om_ª°‹e_öã∫Æ
(
©h_hw
 *
ah
,

3268 
u8
 *
m±r
, 
md©a_size
)

3270 
	#MDEFAULT
 15

	)

3271 
	#MSTATE
 100

	)

3272 
˝å
;

3273 
u8
 *
w‹d
;

3274 
code
;

3275 
ª„ªn˚
, 
Àngth
, 
maj‹
, 
mö‹
;

3276 
osize
;

3277 
ô
;

3278 
u16
 
checksum
, 
mchecksum
;

3279 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

3280 
¨9300_ì¥om
 *
ìp
;

3281 
ì¥om_ªad_›
 
ªad
;

3283 i‡(
	`©h9k_hw_u£_Êash
(
ah
)) {

3284 
u8
 
txrx
;

3286 
	`¨9300_ì¥om_ª°‹e_Êash
(
ah
, 
m±r
, 
md©a_size
);

3289 
ìp
 = (
¨9300_ì¥om
 *Ë
m±r
;

3290 
txrx
 = 
ìp
->
ba£EïHódî
.
txrxMask
;

3291 i‡(
txrx
 != 0 &&Åxrx != 0xff)

3295 
w‹d
 = 
	`kzÆloc
(2048, 
GFP_KERNEL
);

3296 i‡(!
w‹d
)

3297  -
ENOMEM
;

3299 
	`mem˝y
(
m±r
, &
¨9300_deÁu…
, 
md©a_size
);

3301 
ªad
 = 
¨9300_ªad_ì¥om
;

3302 i‡(
	`AR_SREV_9485
(
ah
))

3303 
˝å
 = 
AR9300_BASE_ADDR_4K
;

3304 i‡(
	`AR_SREV_9330
(
ah
))

3305 
˝å
 = 
AR9300_BASE_ADDR_512
;

3307 
˝å
 = 
AR9300_BASE_ADDR
;

3308 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Trying EEPROMáccessát Address 0x%04x\n",

3309 
˝å
);

3310 i‡(
	`¨9300_check_ì¥om_hódî
(
ah
, 
ªad
, 
˝å
))

3311 
found
;

3313 
˝å
 = 
AR9300_BASE_ADDR_512
;

3314 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Trying EEPROMáccessát Address 0x%04x\n",

3315 
˝å
);

3316 i‡(
	`¨9300_check_ì¥om_hódî
(
ah
, 
ªad
, 
˝å
))

3317 
found
;

3319 
ªad
 = 
¨9300_ªad_Ÿp
;

3320 
˝å
 = 
AR9300_BASE_ADDR
;

3321 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Tryög OTPác˚s†© Addªs†0x%04x\n", 
˝å
);

3322 i‡(
	`¨9300_check_ì¥om_hódî
(
ah
, 
ªad
, 
˝å
))

3323 
found
;

3325 
˝å
 = 
AR9300_BASE_ADDR_512
;

3326 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Tryög OTPác˚s†© Addªs†0x%04x\n", 
˝å
);

3327 i‡(
	`¨9300_check_ì¥om_hódî
(
ah
, 
ªad
, 
˝å
))

3328 
found
;

3330 
Áû
;

3332 
found
:

3333 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Found valid EEPROM data\n");

3335 
ô
 = 0; ià< 
MSTATE
; it++) {

3336 i‡(!
	`ªad
(
ah
, 
˝å
, 
w‹d
, 
COMP_HDR_LEN
))

3337 
Áû
;

3339 i‡(!
	`¨9300_check_hódî
(
w‹d
))

3342 
	`¨9300_comp_hdr_u≈ack
(
w‹d
, &
code
, &
ª„ªn˚
,

3343 &
Àngth
, &
maj‹
, &
mö‹
);

3344 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3346 
˝å
, 
code
, 
ª„ªn˚
, 
Àngth
, 
maj‹
, 
mö‹
);

3347 i‡((!
	`AR_SREV_9485
(
ah
Ë&& 
Àngth
 >= 1024) ||

3348 (
	`AR_SREV_9485
(
ah
Ë&& 
Àngth
 > 
EEPROM_DATA_LEN_9485
)) {

3349 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Skipping bad header\n");

3350 
˝å
 -
COMP_HDR_LEN
;

3354 
osize
 = 
Àngth
;

3355 
	`ªad
(
ah
, 
˝å
, 
w‹d
, 
COMP_HDR_LEN
 + 
osize
 + 
COMP_CKSUM_LEN
);

3356 
checksum
 = 
	`¨9300_comp_cksum
(&
w‹d
[
COMP_HDR_LEN
], 
Àngth
);

3357 
mchecksum
 = 
	`gë_u«lig√d_À16
(&
w‹d
[
COMP_HDR_LEN
 + 
osize
]);

3358 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "checksum %x %x\n",

3359 
checksum
, 
mchecksum
);

3360 i‡(
checksum
 =
mchecksum
) {

3361 
	`¨9300_com¥ess_decisi⁄
(
ah
, 
ô
, 
code
, 
ª„ªn˚
, 
m±r
,

3362 
w‹d
, 
Àngth
, 
md©a_size
);

3364 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

3367 
˝å
 -(
COMP_HDR_LEN
 + 
osize
 + 
COMP_CKSUM_LEN
);

3370 
	`k‰ì
(
w‹d
);

3371  
˝å
;

3373 
Áû
:

3374 
	`k‰ì
(
w‹d
);

3376 
	}
}

3383 
boﬁ
 
	$©h9k_hw_¨9300_fûl_ì¥om
(
©h_hw
 *
ah
)

3385 
u8
 *
m±r
 = (u8 *Ë&
ah
->
ì¥om
.
¨9300_ìp
;

3387 i‡(
	`¨9300_ì¥om_ª°‹e_öã∫Æ
(
ah
, 
m±r
,

3388 (
¨9300_ì¥om
)) < 0)

3389  
Ál£
;

3391  
åue
;

3392 
	}
}

3394 #i‡
deföed
(
CPTCFG_ATH9K_DEBUGFS
Ë|| deföed(
CPTCFG_ATH9K_HTC_DEBUGFS
)

3395 
u32
 
	$¨9003_dump_modÆ_ì¥om
(*
buf
, 
u32
 
Àn
, u32 
size
,

3396 
¨9300_modÆ_ìp_hódî
 *
modÆ_hdr
)

3398 
	`PR_EEP
("Chaö0 A¡. C⁄åﬁ", 
	`À16_to_˝u
(
modÆ_hdr
->
™tCålChaö
[0]));

3399 
	`PR_EEP
("Chaö1 A¡. C⁄åﬁ", 
	`À16_to_˝u
(
modÆ_hdr
->
™tCålChaö
[1]));

3400 
	`PR_EEP
("Chaö2 A¡. C⁄åﬁ", 
	`À16_to_˝u
(
modÆ_hdr
->
™tCålChaö
[2]));

3401 
	`PR_EEP
("A¡. Comm⁄ C⁄åﬁ", 
	`À32_to_˝u
(
modÆ_hdr
->
™tCålComm⁄
));

3402 
	`PR_EEP
("A¡. Comm⁄ C⁄åﬁ2", 
	`À32_to_˝u
(
modÆ_hdr
->
™tCålComm⁄2
));

3403 
	`PR_EEP
("A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaö
);

3404 
	`PR_EEP
("Swôch Sëée", 
modÆ_hdr
->
swôchSëéög
);

3405 
	`PR_EEP
("Chaö0 x©ãn1DB", 
modÆ_hdr
->
x©ãn1DB
[0]);

3406 
	`PR_EEP
("Chaö1 x©ãn1DB", 
modÆ_hdr
->
x©ãn1DB
[1]);

3407 
	`PR_EEP
("Chaö2 x©ãn1DB", 
modÆ_hdr
->
x©ãn1DB
[2]);

3408 
	`PR_EEP
("Chaö0 x©ãn1M¨gö", 
modÆ_hdr
->
x©ãn1M¨gö
[0]);

3409 
	`PR_EEP
("Chaö1 x©ãn1M¨gö", 
modÆ_hdr
->
x©ãn1M¨gö
[1]);

3410 
	`PR_EEP
("Chaö2 x©ãn1M¨gö", 
modÆ_hdr
->
x©ãn1M¨gö
[2]);

3411 
	`PR_EEP
("Tem∞Sl›e", 
modÆ_hdr
->
ãmpSl›e
);

3412 
	`PR_EEP
("VﬁàSl›e", 
modÆ_hdr
->
vﬁtSl›e
);

3413 
	`PR_EEP
("•u∏Ch™√ls0", 
modÆ_hdr
->
•urCh™s
[0]);

3414 
	`PR_EEP
("•u∏Ch™√ls1", 
modÆ_hdr
->
•urCh™s
[1]);

3415 
	`PR_EEP
("•u∏Ch™√ls2", 
modÆ_hdr
->
•urCh™s
[2]);

3416 
	`PR_EEP
("•u∏Ch™√ls3", 
modÆ_hdr
->
•urCh™s
[3]);

3417 
	`PR_EEP
("•u∏Ch™√ls4", 
modÆ_hdr
->
•urCh™s
[4]);

3418 
	`PR_EEP
("Chaö0 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[0]);

3419 
	`PR_EEP
("Chaö1 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[1]);

3420 
	`PR_EEP
("Chaö2 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[2]);

3421 
	`PR_EEP
("Quick Dr›", 
modÆ_hdr
->
quick_dr›
);

3422 
	`PR_EEP
("txEndToX∑Off", 
modÆ_hdr
->
txEndToX∑Off
);

3423 
	`PR_EEP
("xPA Bü†Levñ", 
modÆ_hdr
->
x∑BüsLvl
);

3424 
	`PR_EEP
("txFømeToD©aSèπ", 
modÆ_hdr
->
txFømeToD©aSèπ
);

3425 
	`PR_EEP
("txFømeToPaOn", 
modÆ_hdr
->
txFømeToPaOn
);

3426 
	`PR_EEP
("txFømeToX∑On", 
modÆ_hdr
->
txFømeToX∑On
);

3427 
	`PR_EEP
("txClù", 
modÆ_hdr
->
txClù
);

3428 
	`PR_EEP
("ADC Desúed size", 
modÆ_hdr
->
adcDesúedSize
);

3430  
Àn
;

3431 
	}
}

3433 
u32
 
	$©h9k_hw_¨9003_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

3434 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

3436 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3437 
¨9300_ba£_ìp_hdr
 *
pBa£
;

3439 i‡(!
dump_ba£_hdr
) {

3440 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

3442 
Àn
 = 
	`¨9003_dump_modÆ_ì¥om
(
buf
,Üí, 
size
,

3443 &
ìp
->
modÆHódî2G
);

3444 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

3446 
Àn
 = 
	`¨9003_dump_modÆ_ì¥om
(
buf
,Üí, 
size
,

3447 &
ìp
->
modÆHódî5G
);

3448 
out
;

3451 
pBa£
 = &
ìp
->
ba£EïHódî
;

3453 
	`PR_EEP
("EEPROM Vîsi⁄", 
ah
->
ì¥om
.
¨9300_ìp
.
ì¥omVîsi⁄
);

3454 
	`PR_EEP
("RegDomaö1", 
	`À16_to_˝u
(
pBa£
->
ªgDmn
[0]));

3455 
	`PR_EEP
("RegDomaö2", 
	`À16_to_˝u
(
pBa£
->
ªgDmn
[1]));

3456 
	`PR_EEP
("TX Mask", (
pBa£
->
txrxMask
 >> 4));

3457 
	`PR_EEP
("RX Mask", (
pBa£
->
txrxMask
 & 0x0f));

3458 
	`PR_EEP
("AŒow 5GHz", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3459 
AR5416_OPFLAGS_11A
));

3460 
	`PR_EEP
("AŒow 2GHz", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3461 
AR5416_OPFLAGS_11G
));

3462 
	`PR_EEP
("DißbÀ 2GHz HT20", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3463 
AR5416_OPFLAGS_N_2G_HT20
));

3464 
	`PR_EEP
("DißbÀ 2GHz HT40", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3465 
AR5416_OPFLAGS_N_2G_HT40
));

3466 
	`PR_EEP
("DißbÀ 5Ghz HT20", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3467 
AR5416_OPFLAGS_N_5G_HT20
));

3468 
	`PR_EEP
("DißbÀ 5Ghz HT40", !!(
pBa£
->
›C≠Fœgs
.
›Fœgs
 &

3469 
AR5416_OPFLAGS_N_5G_HT40
));

3470 
	`PR_EEP
("Big Endün", !!(
pBa£
->
›C≠Fœgs
.
ìpMisc
 & 0x01));

3471 
	`PR_EEP
("RF Sûít", 
pBa£
->
rfSûít
);

3472 
	`PR_EEP
("BT o±i⁄", 
pBa£
->
blueToŸhO±i⁄s
);

3473 
	`PR_EEP
("Devi˚ C≠", 
pBa£
->
devi˚C≠
);

3474 
	`PR_EEP
("Devi˚ Ty≥", 
pBa£
->
devi˚Ty≥
);

3475 
	`PR_EEP
("Powî TabÀ Off£t", 
pBa£
->
pwrTabÀOff£t
);

3476 
	`PR_EEP
("Tunög C≠s1", 
pBa£
->
∑øms_f‹_tunög_ˇps
[0]);

3477 
	`PR_EEP
("Tunög C≠s2", 
pBa£
->
∑øms_f‹_tunög_ˇps
[1]);

3478 
	`PR_EEP
("E«bÀ Tx Tem∞Comp", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(0)));

3479 
	`PR_EEP
("E«bÀ Tx VﬁàComp", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(1)));

3480 
	`PR_EEP
("E«bÀ fa° clock", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(2)));

3481 
	`PR_EEP
("E«bÀ doublög", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(3)));

3482 
	`PR_EEP
("I¡î«»ªguœt‹", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(4)));

3483 
	`PR_EEP
("E«bÀ P≠rd", !!(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(5)));

3484 
	`PR_EEP
("Drivî Såígth", !!(
pBa£
->
miscC⁄figuøti⁄
 & 
	`BIT
(0)));

3485 
	`PR_EEP
("Quick Dr›", !!(
pBa£
->
miscC⁄figuøti⁄
 & 
	`BIT
(1)));

3486 
	`PR_EEP
("Chaö mask Redu˚", (
pBa£
->
miscC⁄figuøti⁄
 >> 0x3) & 0x1);

3487 
	`PR_EEP
("WrôêíabÀ Gpio", 
pBa£
->
ì¥omWrôeE«bÀGpio
);

3488 
	`PR_EEP
("WLAN DißbÀ Gpio", 
pBa£
->
wœnDißbÀGpio
);

3489 
	`PR_EEP
("WLAN LED Gpio", 
pBa£
->
wœnLedGpio
);

3490 
	`PR_EEP
("Rx B™d Sñe˘ Gpio", 
pBa£
->
rxB™dSñe˘Gpio
);

3491 
	`PR_EEP
("Tx Gaö", 
pBa£
->
txrxgaö
 >> 4);

3492 
	`PR_EEP
("Rx Gaö", 
pBa£
->
txrxgaö
 & 0xf);

3493 
	`PR_EEP
("SW Reg", 
	`À32_to_˝u
(
pBa£
->
swªg
));

3495 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%20s : %pM\n", "MacAddress",

3496 
ah
->
ì¥om
.
¨9300_ìp
.
macAddr
);

3497 
out
:

3498 i‡(
Àn
 > 
size
)

3499 
Àn
 = 
size
;

3501  
Àn
;

3502 
	}
}

3504 
u32
 
	$©h9k_hw_¨9003_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

3505 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

3508 
	}
}

3512 
	$©h9k_hw_¨9300_gë_ì¥om_vî
(
©h_hw
 *
ah
)

3514  
ah
->
ì¥om
.
¨9300_ìp
.
ì¥omVîsi⁄
;

3515 
	}
}

3518 
	$©h9k_hw_¨9300_gë_ì¥om_ªv
(
©h_hw
 *
ah
)

3521 
	}
}

3523 
¨9300_modÆ_ìp_hódî
 *
	$¨9003_modÆ_hódî
(
©h_hw
 *
ah
,

3524 
boﬁ
 
is2ghz
)

3526 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3528 i‡(
is2ghz
)

3529  &
ìp
->
modÆHódî2G
;

3531  &
ìp
->
modÆHódî5G
;

3532 
	}
}

3534 
	$¨9003_hw_x∑_büs_Àvñ_≠∂y
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

3536 
büs
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
x∑BüsLvl
;

3538 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9330
◊hË|| 
	`AR_SREV_9340
(ah) ||

3539 
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

3540 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_TOP2
, 
AR_CH0_TOP2_XPABIASLVL
, 
büs
);

3541 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9565
(ah))

3542 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_TOP
, 
AR_CH0_TOP_XPABIASLVL
, 
büs
);

3544 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_TOP
, 
AR_CH0_TOP_XPABIASLVL
, 
büs
);

3545 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_THERM
,

3546 
AR_CH0_THERM_XPABIASLVL_MSB
,

3547 
büs
 >> 2);

3548 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_THERM
,

3549 
AR_CH0_THERM_XPASHORT2GND
, 1);

3551 
	}
}

3553 
u16
 
	$¨9003_swôch_com_•dt_gë
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

3555  
	`À16_to_˝u
(
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
swôchcom•dt
);

3556 
	}
}

3558 
u32
 
	$¨9003_hw_™t_˘æ_comm⁄_gë
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

3560  
	`À32_to_˝u
(
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
™tCålComm⁄
);

3561 
	}
}

3563 
u32
 
	$¨9003_hw_™t_˘æ_comm⁄_2_gë
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

3565  
	`À32_to_˝u
(
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
™tCålComm⁄2
);

3566 
	}
}

3568 
u16
 
	$¨9003_hw_™t_˘æ_chaö_gë
(
©h_hw
 *
ah
, 
chaö
,

3569 
boﬁ
 
is2ghz
)

3571 
__À16
 
vÆ
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
™tCålChaö
[
chaö
];

3572  
	`À16_to_˝u
(
vÆ
);

3573 
	}
}

3575 
	$¨9003_hw_™t_˘æ_≠∂y
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

3577 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

3578 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

3579 
chaö
;

3580 
u32
 
ªgvÆ
, 
vÆue
, 
gpio
;

3581 c⁄° 
u32
 
swôch_chaö_ªg
[
AR9300_MAX_CHAINS
] = {

3582 
AR_PHY_SWITCH_CHAIN_0
,

3583 
AR_PHY_SWITCH_CHAIN_1
,

3584 
AR_PHY_SWITCH_CHAIN_2
,

3587 i‡(
	`AR_SREV_9485
(
ah
Ë&& (
	`¨9003_hw_gë_rx_gaö_idx
(ah) == 0)) {

3588 i‡(
ah
->
c⁄fig
.
x a_gpio
)

3589 
gpio
 = 
ah
->
c⁄fig
.
x a_gpio
;

3591 
gpio
 = 
AR9300_EXT_LNA_CTL_GPIO_AR9485
;

3593 
	`©h9k_hw_cfg_ouçut
(
ah
, 
gpio
,

3594 
AR_GPIO_OUTPUT_MUX_AS_PCIE_ATTENTION_LED
);

3597 
vÆue
 = 
	`¨9003_hw_™t_˘æ_comm⁄_gë
(
ah
, 
is2ghz
);

3599 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

3600 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SWITCH_COM
,

3601 
AR_SWITCH_TABLE_COM_AR9462_ALL
, 
vÆue
);

3602 } i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9561
(ah)) {

3603 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SWITCH_COM
,

3604 
AR_SWITCH_TABLE_COM_AR9550_ALL
, 
vÆue
);

3606 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SWITCH_COM
,

3607 
AR_SWITCH_TABLE_COM_ALL
, 
vÆue
);

3623 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

3624 
vÆue
 = 
	`¨9003_swôch_com_•dt_gë
(
ah
, 
is2ghz
);

3625 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GLB_CONTROL
,

3626 
AR_SWITCH_TABLE_COM_SPDT_ALL
, 
vÆue
);

3627 
	`REG_SET_BIT
(
ah
, 
AR_PHY_GLB_CONTROL
, 
AR_BTCOEX_CTRL_SPDT_ENABLE
);

3630 
vÆue
 = 
	`¨9003_hw_™t_˘æ_comm⁄_2_gë
(
ah
, 
is2ghz
);

3631 i‡(
	`AR_SREV_9485
(
ah
Ë&& 
comm⁄
->
bt_™t_divîsôy
) {

3632 
vÆue
 &~
AR_SWITCH_TABLE_COM2_ALL
;

3633 
vÆue
 |
ah
->
c⁄fig
.
™t_˘æ_comm2g_swôch_íabÀ
;

3636 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SWITCH_COM_2
, 
AR_SWITCH_TABLE_COM2_ALL
, 
vÆue
);

3638 i‡((
	`AR_SREV_9462
(
ah
)Ë&& (ah->
rxchaömask
 == 0x2)) {

3639 
vÆue
 = 
	`¨9003_hw_™t_˘æ_chaö_gë
(
ah
, 1, 
is2ghz
);

3640 
	`REG_RMW_FIELD
(
ah
, 
swôch_chaö_ªg
[0],

3641 
AR_SWITCH_TABLE_ALL
, 
vÆue
);

3644 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

3645 i‡((
ah
->
rxchaömask
 & 
	`BIT
(
chaö
)) ||

3646 (
ah
->
txchaömask
 & 
	`BIT
(
chaö
))) {

3647 
vÆue
 = 
	`¨9003_hw_™t_˘æ_chaö_gë
(
ah
, 
chaö
,

3648 
is2ghz
);

3649 
	`REG_RMW_FIELD
(
ah
, 
swôch_chaö_ªg
[
chaö
],

3650 
AR_SWITCH_TABLE_ALL
, 
vÆue
);

3654 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9485
◊hË|| 
	`AR_SREV_9565
(ah)) {

3655 
vÆue
 = 
	`©h9k_hw_¨9300_gë_ì¥om
(
ah
, 
EEP_ANT_DIV_CTL1
);

3660 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

3661 
ªgvÆ
 &(~
AR_ANT_DIV_CTRL_ALL
);

3662 
ªgvÆ
 |(
vÆue
 & 0x3fË<< 
AR_ANT_DIV_CTRL_ALL_S
;

3664 
ªgvÆ
 &(~
AR_PHY_ANT_DIV_LNADIV
);

3665 
ªgvÆ
 |((
vÆue
 >> 6Ë& 0x1Ë<< 
AR_PHY_ANT_DIV_LNADIV_S
;

3667 i‡(
	`AR_SREV_9485
(
ah
Ë&& 
comm⁄
->
bt_™t_divîsôy
)

3668 
ªgvÆ
 |
AR_ANT_DIV_ENABLE
;

3670 i‡(
	`AR_SREV_9565
(
ah
)) {

3671 i‡(
comm⁄
->
bt_™t_divîsôy
) {

3672 
ªgvÆ
 |(1 << 
AR_PHY_ANT_SW_RX_PROT_S
);

3674 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RESTART
,

3675 
AR_PHY_RESTART_ENABLE_DIV_M2FLAG
);

3678 
	`REG_SET_BIT
(
ah
, 
AR_BTCOEX_WL_LNADIV
,

3679 
AR_BTCOEX_WL_LNADIV_FORCE_ON
);

3681 
ªgvÆ
 &~(1 << 
AR_PHY_ANT_DIV_LNADIV_S
);

3682 
ªgvÆ
 &~(1 << 
AR_PHY_ANT_SW_RX_PROT_S
);

3684 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_MC_GAIN_CTRL
,

3685 (1 << 
AR_PHY_ANT_SW_RX_PROT_S
));

3688 
	`REG_CLR_BIT
(
ah
, 
AR_BTCOEX_WL_LNADIV
,

3689 
AR_BTCOEX_WL_LNADIV_FORCE_ON
);

3693 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

3696 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_DETECT
);

3697 
ªgvÆ
 &(~
AR_FAST_DIV_ENABLE
);

3698 
ªgvÆ
 |((
vÆue
 >> 7Ë& 0x1Ë<< 
AR_FAST_DIV_ENABLE_S
;

3700 i‡((
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9565
(ah))

3701 && 
comm⁄
->
bt_™t_divîsôy
)

3702 
ªgvÆ
 |
AR_FAST_DIV_ENABLE
;

3704 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_DETECT
, 
ªgvÆ
);

3706 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
) {

3707 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

3712 
ªgvÆ
 &(~(
AR_PHY_ANT_DIV_MAIN_LNACONF
 |

3713 
AR_PHY_ANT_DIV_ALT_LNACONF
 |

3714 
AR_PHY_ANT_DIV_ALT_GAINTB
 |

3715 
AR_PHY_ANT_DIV_MAIN_GAINTB
));

3717 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA1
 <<

3718 
AR_PHY_ANT_DIV_MAIN_LNACONF_S
);

3719 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA2
 <<

3720 
AR_PHY_ANT_DIV_ALT_LNACONF_S
);

3721 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

3724 
	}
}

3726 
	$¨9003_hw_drive_°ªngth_≠∂y
(
©h_hw
 *
ah
)

3728 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3729 
¨9300_ba£_ìp_hdr
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

3730 
drive_°ªngth
;

3731 
ªg
;

3733 
drive_°ªngth
 = 
pBa£
->
miscC⁄figuøti⁄
 & 
	`BIT
(0);

3734 i‡(!
drive_°ªngth
)

3737 
ªg
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BIAS1
);

3738 
ªg
 &= ~0x00ffffc0;

3739 
ªg
 |= 0x5 << 21;

3740 
ªg
 |= 0x5 << 18;

3741 
ªg
 |= 0x5 << 15;

3742 
ªg
 |= 0x5 << 12;

3743 
ªg
 |= 0x5 << 9;

3744 
ªg
 |= 0x5 << 6;

3745 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BIAS1
, 
ªg
);

3747 
ªg
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BIAS2
);

3748 
ªg
 &= ~0xffffffe0;

3749 
ªg
 |= 0x5 << 29;

3750 
ªg
 |= 0x5 << 26;

3751 
ªg
 |= 0x5 << 23;

3752 
ªg
 |= 0x5 << 20;

3753 
ªg
 |= 0x5 << 17;

3754 
ªg
 |= 0x5 << 14;

3755 
ªg
 |= 0x5 << 11;

3756 
ªg
 |= 0x5 << 8;

3757 
ªg
 |= 0x5 << 5;

3758 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BIAS2
, 
ªg
);

3760 
ªg
 = 
	`REG_READ
(
ah
, 
AR_PHY_65NM_CH0_BIAS4
);

3761 
ªg
 &= ~0xff800000;

3762 
ªg
 |= 0x5 << 29;

3763 
ªg
 |= 0x5 << 26;

3764 
ªg
 |= 0x5 << 23;

3765 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_BIAS4
, 
ªg
);

3766 
	}
}

3768 
u16
 
	$¨9003_hw_©ãn_chaö_gë
(
©h_hw
 *
ah
, 
chaö
,

3769 
©h9k_ch™√l
 *
ch™
)

3771 
f
[3], 
t
[3];

3772 
u16
 
vÆue
;

3773 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3775 i‡(
chaö
 >= 0 && chain < 3) {

3776 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

3777  
ìp
->
modÆHódî2G
.
x©ãn1DB
[
chaö
];

3778 i‡(
ìp
->
ba£_ext2
.
x©ãn1DBLow
[
chaö
] != 0) {

3779 
t
[0] = 
ìp
->
ba£_ext2
.
x©ãn1DBLow
[
chaö
];

3780 
f
[0] = 5180;

3781 
t
[1] = 
ìp
->
modÆHódî5G
.
x©ãn1DB
[
chaö
];

3782 
f
[1] = 5500;

3783 
t
[2] = 
ìp
->
ba£_ext2
.
x©ãn1DBHigh
[
chaö
];

3784 
f
[2] = 5785;

3785 
vÆue
 = 
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
ch™
->
ch™√l
,

3786 
f
, 
t
, 3);

3787  
vÆue
;

3789  
ìp
->
modÆHódî5G
.
x©ãn1DB
[
chaö
];

3793 
	}
}

3796 
u16
 
	$¨9003_hw_©ãn_chaö_gë_m¨gö
(
©h_hw
 *
ah
, 
chaö
,

3797 
©h9k_ch™√l
 *
ch™
)

3799 
f
[3], 
t
[3];

3800 
u16
 
vÆue
;

3801 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3803 i‡(
chaö
 >= 0 && chain < 3) {

3804 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

3805  
ìp
->
modÆHódî2G
.
x©ãn1M¨gö
[
chaö
];

3806 i‡(
ìp
->
ba£_ext2
.
x©ãn1M¨göLow
[
chaö
] != 0) {

3807 
t
[0] = 
ìp
->
ba£_ext2
.
x©ãn1M¨göLow
[
chaö
];

3808 
f
[0] = 5180;

3809 
t
[1] = 
ìp
->
modÆHódî5G
.
x©ãn1M¨gö
[
chaö
];

3810 
f
[1] = 5500;

3811 
t
[2] = 
ìp
->
ba£_ext2
.
x©ãn1M¨göHigh
[
chaö
];

3812 
f
[2] = 5785;

3813 
vÆue
 = 
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
ch™
->
ch™√l
,

3814 
f
, 
t
, 3);

3815  
vÆue
;

3817  
ìp
->
modÆHódî5G
.
x©ãn1M¨gö
[
chaö
];

3821 
	}
}

3823 
	$¨9003_hw_©ãn_≠∂y
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

3825 
i
;

3826 
u16
 
vÆue
;

3827 
ext_©ãn_ªg
[3] = {
AR_PHY_EXT_ATTEN_CTL_0
,

3828 
AR_PHY_EXT_ATTEN_CTL_1
,

3829 
AR_PHY_EXT_ATTEN_CTL_2
,

3832 i‡((
	`AR_SREV_9462
(
ah
)Ë&& (ah->
rxchaömask
 == 0x2)) {

3833 
vÆue
 = 
	`¨9003_hw_©ãn_chaö_gë
(
ah
, 1, 
ch™
);

3834 
	`REG_RMW_FIELD
(
ah
, 
ext_©ãn_ªg
[0],

3835 
AR_PHY_EXT_ATTEN_CTL_XATTEN1_DB
, 
vÆue
);

3837 
vÆue
 = 
	`¨9003_hw_©ãn_chaö_gë_m¨gö
(
ah
, 1, 
ch™
);

3838 
	`REG_RMW_FIELD
(
ah
, 
ext_©ãn_ªg
[0],

3839 
AR_PHY_EXT_ATTEN_CTL_XATTEN1_MARGIN
,

3840 
vÆue
);

3844 
i
 = 0; i < 3; i++) {

3845 i‡(
ah
->
txchaömask
 & 
	`BIT
(
i
)) {

3846 
vÆue
 = 
	`¨9003_hw_©ãn_chaö_gë
(
ah
, 
i
, 
ch™
);

3847 
	`REG_RMW_FIELD
(
ah
, 
ext_©ãn_ªg
[
i
],

3848 
AR_PHY_EXT_ATTEN_CTL_XATTEN1_DB
, 
vÆue
);

3850 i‡(
	`AR_SREV_9485
(
ah
) &&

3851 (
	`¨9003_hw_gë_rx_gaö_idx
(
ah
) == 0) &&

3852 
ah
->
c⁄fig
.
x©ãn_m¨gö_cfg
)

3853 
vÆue
 = 5;

3855 
vÆue
 = 
	`¨9003_hw_©ãn_chaö_gë_m¨gö
(
ah
, 
i
, 
ch™
);

3857 i‡(
ah
->
c⁄fig
.
Æt_mögaöidx
)

3858 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_ATTEN_CTL_0
,

3859 
AR_PHY_EXT_ATTEN_CTL_XATTEN1_MARGIN
,

3860 
vÆue
);

3862 
	`REG_RMW_FIELD
(
ah
, 
ext_©ãn_ªg
[
i
],

3863 
AR_PHY_EXT_ATTEN_CTL_XATTEN1_MARGIN
,

3864 
vÆue
);

3867 
	}
}

3869 
boﬁ
 
	$is_pmu_£t
(
©h_hw
 *
ah
, 
u32
 
pmu_ªg
, 
pmu_£t
)

3871 
timeout
 = 100;

3873 
pmu_£t
 !
	`REG_READ
(
ah
, 
pmu_ªg
)) {

3874 i‡(
timeout
-- == 0)

3875  
Ál£
;

3876 
	`REG_WRITE
(
ah
, 
pmu_ªg
, 
pmu_£t
);

3877 
	`udñay
(10);

3880  
åue
;

3881 
	}
}

3883 
	$¨9003_hw_öã∫Æ_ªguœt‹_≠∂y
(
©h_hw
 *
ah
)

3885 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3886 
¨9300_ba£_ìp_hdr
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

3887 
u32
 
ªg_vÆ
;

3889 i‡(
pBa£
->
„©uªE«bÀ
 & 
	`BIT
(4)) {

3890 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9485
(ah)) {

3891 
ªg_pmu_£t
;

3893 
ªg_pmu_£t
 = 
	`REG_READ
(
ah
, 
AR_PHY_PMU2
Ë& ~
AR_PHY_PMU2_PGM
;

3894 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
);

3895 i‡(!
	`is_pmu_£t
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
))

3898 i‡(
	`AR_SREV_9330
(
ah
)) {

3899 i‡(
ah
->
is_˛k_25mhz
) {

3900 
ªg_pmu_£t
 = (3 << 1) | (8 << 4) |

3905 
ªg_pmu_£t
 = (4 << 1) | (7 << 4) |

3911 
ªg_pmu_£t
 = (5 << 1) | (7 << 4) |

3917 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU1
, 
ªg_pmu_£t
);

3918 i‡(!
	`is_pmu_£t
(
ah
, 
AR_PHY_PMU1
, 
ªg_pmu_£t
))

3921 
ªg_pmu_£t
 = (
	`REG_READ
(
ah
, 
AR_PHY_PMU2
) & ~0xFFC00000)

3923 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
);

3924 i‡(!
	`is_pmu_£t
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
))

3927 
ªg_pmu_£t
 = (
	`REG_READ
(
ah
, 
AR_PHY_PMU2
) & ~0x00200000)

3929 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
);

3930 i‡(!
	`is_pmu_£t
(
ah
, 
AR_PHY_PMU2
, 
ªg_pmu_£t
))

3932 } i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah) ||

3933 
	`AR_SREV_9561
(
ah
)) {

3934 
ªg_vÆ
 = 
	`À32_to_˝u
(
pBa£
->
swªg
);

3935 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU1
, 
ªg_vÆ
);

3937 i‡(
	`AR_SREV_9561
(
ah
))

3938 
	`REG_WRITE
(
ah
, 
AR_PHY_PMU2
, 0x10200000);

3941 
ªg_vÆ
 = 
	`À32_to_˝u
(
pBa£
->
swªg
);

3942 
	`REG_WRITE
(
ah
, 
AR_RTC_REG_CONTROL1
,

3943 
	`REG_READ
(
ah
, 
AR_RTC_REG_CONTROL1
) &

3944 (~
AR_RTC_REG_CONTROL1_SWREG_PROGRAM
));

3945 
	`REG_WRITE
(
ah
, 
AR_RTC_REG_CONTROL0
, 
ªg_vÆ
);

3947 
	`REG_WRITE
(
ah
, 
AR_RTC_REG_CONTROL1
,

3948 
	`REG_READ
(
ah
,

3949 
AR_RTC_REG_CONTROL1
) |

3950 
AR_RTC_REG_CONTROL1_SWREG_PROGRAM
);

3953 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9485
(ah)) {

3954 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PMU2
, 
AR_PHY_PMU2_PGM
, 0);

3955 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PMU2
,

3956 
AR_PHY_PMU2_PGM
))

3957 
	`udñay
(10);

3959 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PMU1
, 
AR_PHY_PMU1_PWD
, 0x1);

3960 !
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PMU1
,

3961 
AR_PHY_PMU1_PWD
))

3962 
	`udñay
(10);

3963 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PMU2
, 
AR_PHY_PMU2_PGM
, 0x1);

3964 !
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PMU2
,

3965 
AR_PHY_PMU2_PGM
))

3966 
	`udñay
(10);

3967 } i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah))

3968 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PMU1
, 
AR_PHY_PMU1_PWD
, 0x1);

3970 
ªg_vÆ
 = 
	`REG_READ
(
ah
, 
AR_RTC_SLEEP_CLK
) |

3971 
AR_RTC_FORCE_SWREG_PRD
;

3972 
	`REG_WRITE
(
ah
, 
AR_RTC_SLEEP_CLK
, 
ªg_vÆ
);

3976 
	}
}

3978 
	$¨9003_hw_≠∂y_tunög_ˇps
(
©h_hw
 *
ah
)

3980 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3981 
u8
 
tunög_ˇps_∑øm
 = 
ìp
->
ba£EïHódî
.
∑øms_f‹_tunög_ˇps
[0];

3983 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9531
(ah))

3986 i‡(
ìp
->
ba£EïHódî
.
„©uªE«bÀ
 & 0x40) {

3987 
tunög_ˇps_∑øm
 &= 0x7f;

3988 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_XTAL
, 
AR_CH0_XTAL_CAPINDAC
,

3989 
tunög_ˇps_∑øm
);

3990 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_XTAL
, 
AR_CH0_XTAL_CAPOUTDAC
,

3991 
tunög_ˇps_∑øm
);

3993 
	}
}

3995 
	$¨9003_hw_quick_dr›_≠∂y
(
©h_hw
 *
ah
, 
u16
 
‰eq
)

3997 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

3998 
¨9300_ba£_ìp_hdr
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

3999 
quick_dr›
;

4000 
s32
 
t
[3], 
f
[3] = {5180, 5500, 5785};

4002 i‡(!(
pBa£
->
miscC⁄figuøti⁄
 & 
	`BIT
(4)))

4005 i‡(
	`AR_SREV_9300
(
ah
Ë|| 
	`AR_SREV_9580
◊hË|| 
	`AR_SREV_9340
(ah)) {

4006 i‡(
‰eq
 < 4000) {

4007 
quick_dr›
 = 
ìp
->
modÆHódî2G
.quick_drop;

4009 
t
[0] = 
ìp
->
ba£_ext1
.
quick_dr›_low
;

4010 
t
[1] = 
ìp
->
modÆHódî5G
.
quick_dr›
;

4011 
t
[2] = 
ìp
->
ba£_ext1
.
quick_dr›_high
;

4012 
quick_dr›
 = 
	`¨9003_hw_powî_öãΩﬁ©e
(
‰eq
, 
f
, 
t
, 3);

4014 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_AGC
, 
AR_PHY_AGC_QUICK_DROP
, 
quick_dr›
);

4016 
	}
}

4018 
	$¨9003_hw_txíd_to_x∑_off_≠∂y
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

4020 
u32
 
vÆue
;

4022 
vÆue
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
txEndToX∑Off
;

4024 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_XPA_TIMING_CTL
,

4025 
AR_PHY_XPA_TIMING_CTL_TX_END_XPAB_OFF
, 
vÆue
);

4026 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_XPA_TIMING_CTL
,

4027 
AR_PHY_XPA_TIMING_CTL_TX_END_XPAA_OFF
, 
vÆue
);

4028 
	}
}

4030 
	$¨9003_hw_x∑_timög_c⁄åﬁ_≠∂y
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

4032 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4033 
u8
 
x∑_˘l
;

4035 i‡(!(
ìp
->
ba£EïHódî
.
„©uªE«bÀ
 & 0x80))

4038 i‡(!
	`AR_SREV_9300
(
ah
) &&

4039 !
	`AR_SREV_9340
(
ah
) &&

4040 !
	`AR_SREV_9580
(
ah
) &&

4041 !
	`AR_SREV_9531
(
ah
) &&

4042 !
	`AR_SREV_9561
(
ah
))

4045 
x∑_˘l
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
txFømeToX∑On
;

4046 i‡(
is2ghz
)

4047 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_XPA_TIMING_CTL
,

4048 
AR_PHY_XPA_TIMING_CTL_FRAME_XPAB_ON
, 
x∑_˘l
);

4050 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_XPA_TIMING_CTL
,

4051 
AR_PHY_XPA_TIMING_CTL_FRAME_XPAA_ON
, 
x∑_˘l
);

4052 
	}
}

4054 
	$¨9003_hw_x a_büs_°ªngth_≠∂y
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

4056 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4057 
u8
 
büs
;

4059 i‡(!(
ìp
->
ba£EïHódî
.
miscC⁄figuøti⁄
 & 0x40))

4062 i‡(!
	`AR_SREV_9300
(
ah
))

4065 
büs
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
x a_büs_°ªngth
;

4066 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_RXTX4
, 
AR_PHY_65NM_RXTX4_XLNA_BIAS
,

4067 
büs
 & 0x3);

4068 
büs
 >>= 2;

4069 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH1_RXTX4
, 
AR_PHY_65NM_RXTX4_XLNA_BIAS
,

4070 
büs
 & 0x3);

4071 
büs
 >>= 2;

4072 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH2_RXTX4
, 
AR_PHY_65NM_RXTX4_XLNA_BIAS
,

4073 
büs
 & 0x3);

4074 
	}
}

4076 
	$¨9003_hw_gë_thîmomëî
(
©h_hw
 *
ah
)

4078 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4079 
¨9300_ba£_ìp_hdr
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

4080 
thîmomëî
 = (
pBa£
->
miscC⁄figuøti⁄
 >> 1) & 0x3;

4082  --
thîmomëî
;

4083 
	}
}

4085 
	$¨9003_hw_thîmomëî_≠∂y
(
©h_hw
 *
ah
)

4087 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

4088 
thîmomëî
 = 
	`¨9003_hw_gë_thîmomëî
(
ah
);

4089 
u8
 
thîm_⁄
 = (
thîmomëî
 < 0) ? 0 : 1;

4091 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_RXTX4
,

4092 
AR_PHY_65NM_CH0_RXTX4_THERM_ON_OVR
, 
thîm_⁄
);

4093 i‡(
pC≠
->
chù_chaömask
 & 
	`BIT
(1))

4094 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH1_RXTX4
,

4095 
AR_PHY_65NM_CH0_RXTX4_THERM_ON_OVR
, 
thîm_⁄
);

4096 i‡(
pC≠
->
chù_chaömask
 & 
	`BIT
(2))

4097 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH2_RXTX4
,

4098 
AR_PHY_65NM_CH0_RXTX4_THERM_ON_OVR
, 
thîm_⁄
);

4100 
thîm_⁄
 = (
thîmomëî
 < 0) ? 0 : (thermometer == 0);

4101 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_RXTX4
,

4102 
AR_PHY_65NM_CH0_RXTX4_THERM_ON
, 
thîm_⁄
);

4103 i‡(
pC≠
->
chù_chaömask
 & 
	`BIT
(1)) {

4104 
thîm_⁄
 = (
thîmomëî
 < 0) ? 0 : (thermometer == 1);

4105 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH1_RXTX4
,

4106 
AR_PHY_65NM_CH0_RXTX4_THERM_ON
, 
thîm_⁄
);

4108 i‡(
pC≠
->
chù_chaömask
 & 
	`BIT
(2)) {

4109 
thîm_⁄
 = (
thîmomëî
 < 0) ? 0 : (thermometer == 2);

4110 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH2_RXTX4
,

4111 
AR_PHY_65NM_CH0_RXTX4_THERM_ON
, 
thîm_⁄
);

4113 
	}
}

4115 
	$¨9003_hw_thîmo_ˇl_≠∂y
(
©h_hw
 *
ah
)

4117 
u32
 
d©a
, 
ko
, 
kg
;

4119 i‡(!
	`AR_SREV_9462_20_OR_LATER
(
ah
))

4122 
	`¨9300_Ÿp_ªad_w‹d
(
ah
, 1, &
d©a
);

4123 
ko
 = 
d©a
 & 0xff;

4124 
kg
 = (
d©a
 >> 8) & 0xff;

4125 i‡(
ko
 || 
kg
) {

4126 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_BB_THERM_ADC_3
,

4127 
AR_PHY_BB_THERM_ADC_3_THERM_ADC_OFFSET
, 
ko
);

4128 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_BB_THERM_ADC_3
,

4129 
AR_PHY_BB_THERM_ADC_3_THERM_ADC_SCALE_GAIN
,

4130 
kg
 + 256);

4132 
	}
}

4134 
	$¨9003_hw_≠∂y_möcˇpwr_thªsh
(
©h_hw
 *
ah
,

4135 
boﬁ
 
is2ghz
)

4137 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4138 c⁄° 
u_öt32_t
 
cˇ_˘æ
[
AR9300_MAX_CHAINS
] = {

4139 
AR_PHY_CCA_CTRL_0
,

4140 
AR_PHY_CCA_CTRL_1
,

4141 
AR_PHY_CCA_CTRL_2
,

4143 
chaö
;

4144 
u32
 
vÆ
;

4146 i‡(
is2ghz
) {

4147 i‡(!(
ìp
->
ba£_ext1
.
misc_íabÀ
 & 
	`BIT
(2)))

4150 i‡(!(
ìp
->
ba£_ext1
.
misc_íabÀ
 & 
	`BIT
(3)))

4154 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

4155 i‡(!(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(
chaö
)))

4158 
vÆ
 = 
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
noi£Flo‹ThªshCh
[
chaö
];

4159 
	`REG_RMW_FIELD
(
ah
, 
cˇ_˘æ
[
chaö
],

4160 
AR_PHY_EXT_CCA0_THRESH62_1
, 
vÆ
);

4163 
	}
}

4165 
	$©h9k_hw_¨9300_£t_bﬂrd_vÆues
(
©h_hw
 *
ah
,

4166 
©h9k_ch™√l
 *
ch™
)

4168 
boﬁ
 
is2ghz
 = 
	`IS_CHAN_2GHZ
(
ch™
);

4169 
	`¨9003_hw_x∑_timög_c⁄åﬁ_≠∂y
(
ah
, 
is2ghz
);

4170 
	`¨9003_hw_x∑_büs_Àvñ_≠∂y
(
ah
, 
is2ghz
);

4171 
	`¨9003_hw_™t_˘æ_≠∂y
(
ah
, 
is2ghz
);

4172 
	`¨9003_hw_drive_°ªngth_≠∂y
(
ah
);

4173 
	`¨9003_hw_x a_büs_°ªngth_≠∂y
(
ah
, 
is2ghz
);

4174 
	`¨9003_hw_©ãn_≠∂y
(
ah
, 
ch™
);

4175 
	`¨9003_hw_quick_dr›_≠∂y
(
ah
, 
ch™
->
ch™√l
);

4176 i‡(!
	`AR_SREV_9330
(
ah
Ë&& !
	`AR_SREV_9340
◊hË&& !
	`AR_SREV_9531
(ah))

4177 
	`¨9003_hw_öã∫Æ_ªguœt‹_≠∂y
(
ah
);

4178 
	`¨9003_hw_≠∂y_tunög_ˇps
(
ah
);

4179 
	`¨9003_hw_≠∂y_möcˇpwr_thªsh
(
ah
, 
ch™
);

4180 
	`¨9003_hw_txíd_to_x∑_off_≠∂y
(
ah
, 
is2ghz
);

4181 
	`¨9003_hw_thîmomëî_≠∂y
(
ah
);

4182 
	`¨9003_hw_thîmo_ˇl_≠∂y
(
ah
);

4183 
	}
}

4185 
	$©h9k_hw_¨9300_£t_addac
(
©h_hw
 *
ah
,

4186 
©h9k_ch™√l
 *
ch™
)

4188 
	}
}

4199 
	$¨9003_hw_powî_öãΩﬁ©e
(
öt32_t
 
x
,

4200 
öt32_t
 *
px
, i¡32_à*
py
, 
u_öt16_t
 
≈
)

4202 
ù
 = 0;

4203 
lx
 = 0, 
ly
 = 0, 
lhave
 = 0;

4204 
hx
 = 0, 
hy
 = 0, 
hhave
 = 0;

4205 
dx
 = 0;

4206 
y
 = 0;

4208 
lhave
 = 0;

4209 
hhave
 = 0;

4212 
ù
 = 0; i∞< 
≈
; ip++) {

4213 
dx
 = 
x
 - 
px
[
ù
];

4216 i‡(
dx
 <= 0) {

4217 i‡(!
hhave
 || 
dx
 > (
x
 - 
hx
)) {

4219 
hx
 = 
px
[
ù
];

4220 
hy
 = 
py
[
ù
];

4221 
hhave
 = 1;

4225 i‡(
dx
 >= 0) {

4226 i‡(!
lhave
 || 
dx
 < (
x
 - 
lx
)) {

4228 
lx
 = 
px
[
ù
];

4229 
ly
 = 
py
[
ù
];

4230 
lhave
 = 1;

4236 i‡(
lhave
) {

4238 i‡(
hhave
) {

4240 i‡(
hx
 =
lx
)

4241 
y
 = 
ly
;

4243 
y
 = 
	`öãΩﬁ©e
(
x
, 
lx
, 
hx
, 
ly
, 
hy
);

4245 
y
 = 
ly
;

4246 } i‡(
hhave
)

4247 
y
 = 
hy
;

4249 
y
 = -(1 << 30);

4250  
y
;

4251 
	}
}

4253 
u8
 
	$¨9003_hw_ì¥om_gë_tgt_pwr
(
©h_hw
 *
ah
,

4254 
u16
 
øãIndex
, u16 
‰eq
, 
boﬁ
 
is2GHz
)

4256 
u16
 
numPõrs
, 
i
;

4257 
s32
 
èrgëPowîAºay
[
AR9300_NUM_5G_20_TARGET_POWERS
];

4258 
s32
 
‰eqAºay
[
AR9300_NUM_5G_20_TARGET_POWERS
];

4259 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4260 
ˇl_tgt_pow_Àgacy
 *
pEïromT¨gëPwr
;

4261 
u8
 *
pFªqBö
;

4263 i‡(
is2GHz
) {

4264 
numPõrs
 = 
AR9300_NUM_2G_20_TARGET_POWERS
;

4265 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî2G
;

4266 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_2G
;

4268 
numPõrs
 = 
AR9300_NUM_5G_20_TARGET_POWERS
;

4269 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî5G
;

4270 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_5G
;

4277 
i
 = 0; i < 
numPõrs
; i++) {

4278 
‰eqAºay
[
i
] = 
	`©h9k_hw_fbö2‰eq
(
pFªqBö
[i], 
is2GHz
);

4279 
èrgëPowîAºay
[
i
] = 
pEïromT¨gëPwr
[i].
tPow2x
[
øãIndex
];

4283  (
u8
Ë
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰eq
,

4284 
‰eqAºay
,

4285 
èrgëPowîAºay
, 
numPõrs
);

4286 
	}
}

4288 
u8
 
	$¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
©h_hw
 *
ah
,

4289 
u16
 
øãIndex
,

4290 
u16
 
‰eq
, 
boﬁ
 
is2GHz
)

4292 
u16
 
numPõrs
, 
i
;

4293 
s32
 
èrgëPowîAºay
[
AR9300_NUM_5G_20_TARGET_POWERS
];

4294 
s32
 
‰eqAºay
[
AR9300_NUM_5G_20_TARGET_POWERS
];

4295 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4296 
ˇl_tgt_pow_ht
 *
pEïromT¨gëPwr
;

4297 
u8
 *
pFªqBö
;

4299 i‡(
is2GHz
) {

4300 
numPõrs
 = 
AR9300_NUM_2G_20_TARGET_POWERS
;

4301 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî2GHT20
;

4302 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_2GHT20
;

4304 
numPõrs
 = 
AR9300_NUM_5G_20_TARGET_POWERS
;

4305 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî5GHT20
;

4306 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_5GHT20
;

4313 
i
 = 0; i < 
numPõrs
; i++) {

4314 
‰eqAºay
[
i
] = 
	`©h9k_hw_fbö2‰eq
(
pFªqBö
[i], 
is2GHz
);

4315 
èrgëPowîAºay
[
i
] = 
pEïromT¨gëPwr
[i].
tPow2x
[
øãIndex
];

4319  (
u8
Ë
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰eq
,

4320 
‰eqAºay
,

4321 
èrgëPowîAºay
, 
numPõrs
);

4322 
	}
}

4324 
u8
 
	$¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
©h_hw
 *
ah
,

4325 
u16
 
øãIndex
,

4326 
u16
 
‰eq
, 
boﬁ
 
is2GHz
)

4328 
u16
 
numPõrs
, 
i
;

4329 
s32
 
èrgëPowîAºay
[
AR9300_NUM_5G_40_TARGET_POWERS
];

4330 
s32
 
‰eqAºay
[
AR9300_NUM_5G_40_TARGET_POWERS
];

4331 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4332 
ˇl_tgt_pow_ht
 *
pEïromT¨gëPwr
;

4333 
u8
 *
pFªqBö
;

4335 i‡(
is2GHz
) {

4336 
numPõrs
 = 
AR9300_NUM_2G_40_TARGET_POWERS
;

4337 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî2GHT40
;

4338 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_2GHT40
;

4340 
numPõrs
 = 
AR9300_NUM_5G_40_TARGET_POWERS
;

4341 
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowî5GHT40
;

4342 
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_5GHT40
;

4349 
i
 = 0; i < 
numPõrs
; i++) {

4350 
‰eqAºay
[
i
] = 
	`©h9k_hw_fbö2‰eq
(
pFªqBö
[i], 
is2GHz
);

4351 
èrgëPowîAºay
[
i
] = 
pEïromT¨gëPwr
[i].
tPow2x
[
øãIndex
];

4355  (
u8
Ë
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰eq
,

4356 
‰eqAºay
,

4357 
èrgëPowîAºay
, 
numPõrs
);

4358 
	}
}

4360 
u8
 
	$¨9003_hw_ì¥om_gë_cck_tgt_pwr
(
©h_hw
 *
ah
,

4361 
u16
 
øãIndex
, u16 
‰eq
)

4363 
u16
 
numPõrs
 = 
AR9300_NUM_2G_CCK_TARGET_POWERS
, 
i
;

4364 
s32
 
èrgëPowîAºay
[
AR9300_NUM_2G_CCK_TARGET_POWERS
];

4365 
s32
 
‰eqAºay
[
AR9300_NUM_2G_CCK_TARGET_POWERS
];

4366 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4367 
ˇl_tgt_pow_Àgacy
 *
pEïromT¨gëPwr
 = 
ìp
->
ˇlT¨gëPowîCck
;

4368 
u8
 *
pFªqBö
 = 
ìp
->
ˇlT¨gë_‰eqbö_Cck
;

4374 
i
 = 0; i < 
numPõrs
; i++) {

4375 
‰eqAºay
[
i
] = 
	`©h9k_hw_fbö2‰eq
(
pFªqBö
[i], 1);

4376 
èrgëPowîAºay
[
i
] = 
pEïromT¨gëPwr
[i].
tPow2x
[
øãIndex
];

4380  (
u8
Ë
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰eq
,

4381 
‰eqAºay
,

4382 
èrgëPowîAºay
, 
numPõrs
);

4383 
	}
}

4385 
	$¨9003_hw_£lfgí_çc_txpowî
(
©h_hw
 *
ah
,

4386 
©h9k_ch™√l
 *
ch™
,

4387 
u8
 *
pwr_¨øy
)

4389 
u32
 
vÆ
;

4392 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

4393 
vÆ
 = 
	`SM
(
pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 
AR_TPC_ACK
) |

4394 
	`SM
(
pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 
AR_TPC_CTS
) |

4395 
	`SM
(0x3f, 
AR_TPC_CHIRP
Ë| SM(0x3f, 
AR_TPC_RPT
);

4397 
vÆ
 = 
	`SM
(
pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 
AR_TPC_ACK
) |

4398 
	`SM
(
pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 
AR_TPC_CTS
) |

4399 
	`SM
(0x3f, 
AR_TPC_CHIRP
Ë| SM(0x3f, 
AR_TPC_RPT
);

4401 
	`REG_WRITE
(
ah
, 
AR_TPC
, 
vÆ
);

4402 
	}
}

4405 
	$¨9003_hw_tx_powî_ªgwrôe
(
©h_hw
 *
ah
, 
u8
 * 
pPwrAºay
)

4407 
	#POW_SM
(
_r
, 
_s
Ë(((_rË& 0x3fË<< (_s))

	)

4409 
	`REG_WRITE
(
ah
, 
AR_PHY_TX_FORCED_GAIN
, 0);

4414 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(0),

4415 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 24) |

4416 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 16) |

4417 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 8) |

4418 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 0));

4421 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(1),

4422 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_54
], 24) |

4423 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_48
], 16) |

4424 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_36
], 8) |

4425 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 0));

4430 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(2),

4431 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 24) |

4432 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 16) |

4434 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 0));

4437 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(3),

4438 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_11S
], 24) |

4439 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_11L
], 16) |

4440 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_5S
], 8) |

4441 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 0)

4447 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(8),

4448 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 24) |

4449 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 16) |

4450 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_6_24
], 8) |

4451 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_LEGACY_1L_5L
], 0)

4457 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(4),

4458 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_5
], 24) |

4459 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_4
], 16) |

4460 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_1_3_9_11_17_19
], 8) |

4461 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_0_8_16
], 0)

4465 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(5),

4466 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_13
], 24) |

4467 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_12
], 16) |

4468 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_7
], 8) |

4469 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_6
], 0)

4473 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(9),

4474 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_21
], 24) |

4475 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_20
], 16) |

4476 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_15
], 8) |

4477 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_14
], 0)

4483 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(10),

4484 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_23
], 24) |

4485 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_22
], 16) |

4486 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_23
], 8) |

4487 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT20_22
], 0)

4495 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(6),

4496 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_5
], 24) |

4497 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_4
], 16) |

4498 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_1_3_9_11_17_19
], 8) |

4499 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_0_8_16
], 0)

4503 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(7),

4504 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_13
], 24) |

4505 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_12
], 16) |

4506 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_7
], 8) |

4507 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_6
], 0)

4511 
	`REG_WRITE
(
ah
, 
	`AR_PHY_POWER_TX_RATE
(11),

4512 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_21
], 24) |

4513 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_20
], 16) |

4514 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_15
], 8) |

4515 
	`POW_SM
(
pPwrAºay
[
ALL_TARGET_HT40_14
], 0)

4519 #unde‡
POW_SM


4520 
	}
}

4522 
	$¨9003_hw_gë_Àgacy_èrgë_powîs
(
©h_hw
 *
ah
, 
u16
 
‰eq
,

4523 
u8
 *
èrgëPowîVÆT2
,

4524 
boﬁ
 
is2GHz
)

4526 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_6_24
] =

4527 
	`¨9003_hw_ì¥om_gë_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_6_24
, 
‰eq
,

4528 
is2GHz
);

4529 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_36
] =

4530 
	`¨9003_hw_ì¥om_gë_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_36
, 
‰eq
,

4531 
is2GHz
);

4532 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_48
] =

4533 
	`¨9003_hw_ì¥om_gë_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_48
, 
‰eq
,

4534 
is2GHz
);

4535 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_54
] =

4536 
	`¨9003_hw_ì¥om_gë_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_54
, 
‰eq
,

4537 
is2GHz
);

4538 
	}
}

4540 
	$¨9003_hw_gë_cck_èrgë_powîs
(
©h_hw
 *
ah
, 
u16
 
‰eq
,

4541 
u8
 *
èrgëPowîVÆT2
)

4543 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_1L_5L
] =

4544 
	`¨9003_hw_ì¥om_gë_cck_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_1L_5L
,

4545 
‰eq
);

4546 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_5S
] =

4547 
	`¨9003_hw_ì¥om_gë_cck_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_5S
, 
‰eq
);

4548 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_11L
] =

4549 
	`¨9003_hw_ì¥om_gë_cck_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_11L
, 
‰eq
);

4550 
èrgëPowîVÆT2
[
ALL_TARGET_LEGACY_11S
] =

4551 
	`¨9003_hw_ì¥om_gë_cck_tgt_pwr
(
ah
, 
LEGACY_TARGET_RATE_11S
, 
‰eq
);

4552 
	}
}

4554 
	$¨9003_hw_gë_ht20_èrgë_powîs
(
©h_hw
 *
ah
, 
u16
 
‰eq
,

4555 
u8
 *
èrgëPowîVÆT2
, 
boﬁ
 
is2GHz
)

4557 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_0_8_16
] =

4558 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_0_8_16
, 
‰eq
,

4559 
is2GHz
);

4560 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_1_3_9_11_17_19
] =

4561 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_1_3_9_11_17_19
,

4562 
‰eq
, 
is2GHz
);

4563 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_4
] =

4564 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_4
, 
‰eq
,

4565 
is2GHz
);

4566 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_5
] =

4567 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_5
, 
‰eq
,

4568 
is2GHz
);

4569 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_6
] =

4570 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_6
, 
‰eq
,

4571 
is2GHz
);

4572 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_7
] =

4573 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_7
, 
‰eq
,

4574 
is2GHz
);

4575 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_12
] =

4576 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_12
, 
‰eq
,

4577 
is2GHz
);

4578 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_13
] =

4579 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_13
, 
‰eq
,

4580 
is2GHz
);

4581 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_14
] =

4582 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_14
, 
‰eq
,

4583 
is2GHz
);

4584 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_15
] =

4585 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_15
, 
‰eq
,

4586 
is2GHz
);

4587 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_20
] =

4588 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_20
, 
‰eq
,

4589 
is2GHz
);

4590 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_21
] =

4591 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_21
, 
‰eq
,

4592 
is2GHz
);

4593 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_22
] =

4594 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_22
, 
‰eq
,

4595 
is2GHz
);

4596 
èrgëPowîVÆT2
[
ALL_TARGET_HT20_23
] =

4597 
	`¨9003_hw_ì¥om_gë_ht20_tgt_pwr
(
ah
, 
HT_TARGET_RATE_23
, 
‰eq
,

4598 
is2GHz
);

4599 
	}
}

4601 
	$¨9003_hw_gë_ht40_èrgë_powîs
(
©h_hw
 *
ah
,

4602 
u16
 
‰eq
,

4603 
u8
 *
èrgëPowîVÆT2
,

4604 
boﬁ
 
is2GHz
)

4607 
u8
 
ht40PowîIncF‹Pdadc
 = 0;

4609 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_0_8_16
] =

4610 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_0_8_16
, 
‰eq
,

4611 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4612 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_1_3_9_11_17_19
] =

4613 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_1_3_9_11_17_19
,

4614 
‰eq
,

4615 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4616 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_4
] =

4617 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_4
, 
‰eq
,

4618 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4619 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_5
] =

4620 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_5
, 
‰eq
,

4621 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4622 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_6
] =

4623 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_6
, 
‰eq
,

4624 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4625 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_7
] =

4626 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_7
, 
‰eq
,

4627 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4628 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_12
] =

4629 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_12
, 
‰eq
,

4630 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4631 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_13
] =

4632 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_13
, 
‰eq
,

4633 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4634 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_14
] =

4635 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_14
, 
‰eq
,

4636 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4637 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_15
] =

4638 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_15
, 
‰eq
,

4639 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4640 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_20
] =

4641 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_20
, 
‰eq
,

4642 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4643 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_21
] =

4644 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_21
, 
‰eq
,

4645 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4646 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_22
] =

4647 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_22
, 
‰eq
,

4648 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4649 
èrgëPowîVÆT2
[
ALL_TARGET_HT40_23
] =

4650 
	`¨9003_hw_ì¥om_gë_ht40_tgt_pwr
(
ah
, 
HT_TARGET_RATE_23
, 
‰eq
,

4651 
is2GHz
Ë+ 
ht40PowîIncF‹Pdadc
;

4652 
	}
}

4654 
	$¨9003_hw_gë_èrgë_powî_ì¥om
(
©h_hw
 *
ah
,

4655 
©h9k_ch™√l
 *
ch™
,

4656 
u8
 *
èrgëPowîVÆT2
)

4658 
boﬁ
 
is2GHz
 = 
	`IS_CHAN_2GHZ
(
ch™
);

4659 
i
 = 0;

4660 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

4661 
u16
 
‰eq
 = 
ch™
->
ch™√l
;

4663 i‡(
is2GHz
)

4664 
	`¨9003_hw_gë_cck_èrgë_powîs
(
ah
, 
‰eq
, 
èrgëPowîVÆT2
);

4666 
	`¨9003_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
‰eq
, 
èrgëPowîVÆT2
, 
is2GHz
);

4667 
	`¨9003_hw_gë_ht20_èrgë_powîs
(
ah
, 
‰eq
, 
èrgëPowîVÆT2
, 
is2GHz
);

4669 i‡(
	`IS_CHAN_HT40
(
ch™
))

4670 
	`¨9003_hw_gë_ht40_èrgë_powîs
(
ah
, 
‰eq
, 
èrgëPowîVÆT2
,

4671 
is2GHz
);

4673 
i
 = 0; i < 
¨9300R©eSize
; i++) {

4674 
	`©h_dbg
(
comm⁄
, 
REGULATORY
, "TPC[%02d] 0x%08x\n",

4675 
i
, 
èrgëPowîVÆT2
[i]);

4677 
	}
}

4679 
	$¨9003_hw_ˇl_põr_gë
(
©h_hw
 *
ah
,

4680 
mode
,

4681 
ùõr
,

4682 
ichaö
,

4683 *
p‰equícy
,

4684 *
pc‹ª˘i⁄
,

4685 *
±em≥øtuª
, *
pvﬁège
)

4687 
u8
 *
pCÆPõr
;

4688 
¨9300_ˇl_d©a_≥r_‰eq_›_lo›
 *
pCÆPõrSåu˘
;

4689 
is2GHz
;

4690 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4691 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

4693 i‡(
ichaö
 >
AR9300_MAX_CHAINS
) {

4694 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

4696 
AR9300_MAX_CHAINS
);

4700 i‡(
mode
) {

4701 i‡(
ùõr
 >
AR9300_NUM_5G_CAL_PIERS
) {

4702 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

4704 
AR9300_NUM_5G_CAL_PIERS
);

4707 
pCÆPõr
 = &(
ìp
->
ˇlFªqPõr5G
[
ùõr
]);

4708 
pCÆPõrSåu˘
 = &(
ìp
->
ˇlPõrD©a5G
[
ichaö
][
ùõr
]);

4709 
is2GHz
 = 0;

4711 i‡(
ùõr
 >
AR9300_NUM_2G_CAL_PIERS
) {

4712 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

4714 
AR9300_NUM_2G_CAL_PIERS
);

4718 
pCÆPõr
 = &(
ìp
->
ˇlFªqPõr2G
[
ùõr
]);

4719 
pCÆPõrSåu˘
 = &(
ìp
->
ˇlPõrD©a2G
[
ichaö
][
ùõr
]);

4720 
is2GHz
 = 1;

4723 *
p‰equícy
 = 
	`©h9k_hw_fbö2‰eq
(*
pCÆPõr
, 
is2GHz
);

4724 *
pc‹ª˘i⁄
 = 
pCÆPõrSåu˘
->
ªfPowî
;

4725 *
±em≥øtuª
 = 
pCÆPõrSåu˘
->
ãmpMós
;

4726 *
pvﬁège
 = 
pCÆPõrSåu˘
->
vﬁtMós
;

4729 
	}
}

4731 
	$¨9003_hw_powî_c⁄åﬁ_ovîride
(
©h_hw
 *
ah
,

4732 
‰equícy
,

4733 *
c‹ª˘i⁄
,

4734 *
vﬁège
, *
ãm≥øtuª
)

4736 
ãmp_¶›e
 = 0, 
ãmp_¶›e1
 = 0, 
ãmp_¶›e2
 = 0;

4737 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

4738 
f
[8], 
t
[8], 
t1
[3], 
t2
[3], 
i
;

4740 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_11_B0
,

4741 (
c‹ª˘i⁄
[0] << 
AR_PHY_TPC_OLPC_GAIN_DELTA_S
),

4742 
AR_PHY_TPC_OLPC_GAIN_DELTA
);

4743 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(1))

4744 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_11_B1
,

4745 (
c‹ª˘i⁄
[1] << 
AR_PHY_TPC_OLPC_GAIN_DELTA_S
),

4746 
AR_PHY_TPC_OLPC_GAIN_DELTA
);

4747 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(2))

4748 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_11_B2
,

4749 (
c‹ª˘i⁄
[2] << 
AR_PHY_TPC_OLPC_GAIN_DELTA_S
),

4750 
AR_PHY_TPC_OLPC_GAIN_DELTA
);

4753 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_6_B0
,

4754 (3 << 
AR_PHY_TPC_6_ERROR_EST_MODE_S
),

4755 
AR_PHY_TPC_6_ERROR_EST_MODE
);

4756 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(1))

4757 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_6_B1
,

4758 (3 << 
AR_PHY_TPC_6_ERROR_EST_MODE_S
),

4759 
AR_PHY_TPC_6_ERROR_EST_MODE
);

4760 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(2))

4761 
	`REG_RMW
(
ah
, 
AR_PHY_TPC_6_B2
,

4762 (3 << 
AR_PHY_TPC_6_ERROR_EST_MODE_S
),

4763 
AR_PHY_TPC_6_ERROR_EST_MODE
);

4769 i‡(
‰equícy
 < 4000) {

4770 
ãmp_¶›e
 = 
ìp
->
modÆHódî2G
.
ãmpSl›e
;

4772 i‡(
	`AR_SREV_9550
(
ah
)) {

4773 
t
[0] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[2];

4774 
t1
[0] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[3];

4775 
t2
[0] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[4];

4776 
f
[0] = 5180;

4778 
t
[1] = 
ìp
->
modÆHódî5G
.
ãmpSl›e
;

4779 
t1
[1] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[0];

4780 
t2
[1] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[1];

4781 
f
[1] = 5500;

4783 
t
[2] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[5];

4784 
t1
[2] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[6];

4785 
t2
[2] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[7];

4786 
f
[2] = 5785;

4788 
ãmp_¶›e
 = 
	`¨9003_hw_powî_öãΩﬁ©e
(
‰equícy
,

4789 
f
, 
t
, 3);

4790 
ãmp_¶›e1
 = 
	`¨9003_hw_powî_öãΩﬁ©e
(
‰equícy
,

4791 
f
, 
t1
, 3);

4792 
ãmp_¶›e2
 = 
	`¨9003_hw_powî_öãΩﬁ©e
(
‰equícy
,

4793 
f
, 
t2
, 3);

4795 
ãmp¶›e
;

4798 i‡((
ìp
->
ba£EïHódî
.
miscC⁄figuøti⁄
 & 0x20) != 0) {

4799 
i
 = 0; i < 8; i++) {

4800 
t
[
i
] = 
ìp
->
ba£_ext1
.
ãmp¶›exãnsi⁄
[i];

4801 
f
[
i
] = 
	`FBIN2FREQ
(
ìp
->
ˇlFªqPõr5G
[i], 0);

4803 
ãmp_¶›e
 = 
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰equícy
,

4804 
f
, 
t
, 8);

4805 } i‡(
ìp
->
ba£_ext2
.
ãmpSl›eLow
 != 0) {

4806 
t
[0] = 
ìp
->
ba£_ext2
.
ãmpSl›eLow
;

4807 
f
[0] = 5180;

4808 
t
[1] = 
ìp
->
modÆHódî5G
.
ãmpSl›e
;

4809 
f
[1] = 5500;

4810 
t
[2] = 
ìp
->
ba£_ext2
.
ãmpSl›eHigh
;

4811 
f
[2] = 5785;

4812 
ãmp_¶›e
 = 
	`¨9003_hw_powî_öãΩﬁ©e
((
s32
Ë
‰equícy
,

4813 
f
, 
t
, 3);

4815 
ãmp_¶›e
 = 
ìp
->
modÆHódî5G
.
ãmpSl›e
;

4819 
ãmp¶›e
:

4820 i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9561
(ah)) {

4821 
u8
 
txmask
 = (
ìp
->
ba£EïHódî
.
txrxMask
 & 0xf0) >> 4;

4827 i‡(
ìp
->
ba£EïHódî
.
„©uªE«bÀ
 & 0x1) {

4828 i‡(
‰equícy
 < 4000) {

4829 i‡(
txmask
 & 
	`BIT
(0))

4830 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19
,

4831 
AR_PHY_TPC_19_ALPHA_THERM
,

4832 
ìp
->
ba£_ext2
.
ãmpSl›eLow
);

4833 i‡(
txmask
 & 
	`BIT
(1))

4834 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B1
,

4835 
AR_PHY_TPC_19_ALPHA_THERM
,

4836 
ãmp_¶›e
);

4837 i‡(
txmask
 & 
	`BIT
(2))

4838 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B2
,

4839 
AR_PHY_TPC_19_ALPHA_THERM
,

4840 
ìp
->
ba£_ext2
.
ãmpSl›eHigh
);

4842 i‡(
txmask
 & 
	`BIT
(0))

4843 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19
,

4844 
AR_PHY_TPC_19_ALPHA_THERM
,

4845 
ãmp_¶›e
);

4846 i‡(
txmask
 & 
	`BIT
(1))

4847 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B1
,

4848 
AR_PHY_TPC_19_ALPHA_THERM
,

4849 
ãmp_¶›e1
);

4850 i‡(
txmask
 & 
	`BIT
(2))

4851 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B2
,

4852 
AR_PHY_TPC_19_ALPHA_THERM
,

4853 
ãmp_¶›e2
);

4860 i‡(
txmask
 & 
	`BIT
(0))

4861 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19
,

4862 
AR_PHY_TPC_19_ALPHA_THERM
, 0);

4863 i‡(
txmask
 & 
	`BIT
(1))

4864 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B1
,

4865 
AR_PHY_TPC_19_ALPHA_THERM
, 0);

4866 i‡(
txmask
 & 
	`BIT
(2))

4867 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B2
,

4868 
AR_PHY_TPC_19_ALPHA_THERM
, 0);

4871 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19
,

4872 
AR_PHY_TPC_19_ALPHA_THERM
, 
ãmp_¶›e
);

4875 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
))

4876 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_19_B1
,

4877 
AR_PHY_TPC_19_B1_ALPHA_THERM
, 
ãmp_¶›e
);

4880 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_18
, 
AR_PHY_TPC_18_THERM_CAL_VALUE
,

4881 
ãm≥øtuª
[0]);

4882 
	}
}

4885 
	$¨9003_hw_ˇlibøti⁄_≠∂y
(
©h_hw
 *
ah
, 
‰equícy
)

4887 
ichaö
, 
ùõr
, 
≈õr
;

4888 
mode
;

4889 
l‰equícy
[
AR9300_MAX_CHAINS
],

4890 
lc‹ª˘i⁄
[
AR9300_MAX_CHAINS
],

4891 
…em≥øtuª
[
AR9300_MAX_CHAINS
], 
lvﬁège
[AR9300_MAX_CHAINS];

4892 
h‰equícy
[
AR9300_MAX_CHAINS
],

4893 
hc‹ª˘i⁄
[
AR9300_MAX_CHAINS
],

4894 
hãm≥øtuª
[
AR9300_MAX_CHAINS
], 
hvﬁège
[AR9300_MAX_CHAINS];

4895 
fdiff
;

4896 
c‹ª˘i⁄
[
AR9300_MAX_CHAINS
],

4897 
vﬁège
[
AR9300_MAX_CHAINS
], 
ãm≥øtuª
[AR9300_MAX_CHAINS];

4898 
p‰equícy
, 
pc‹ª˘i⁄
, 
±em≥øtuª
, 
pvﬁège
;

4899 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

4901 
mode
 = (
‰equícy
 >= 4000);

4902 i‡(
mode
)

4903 
≈õr
 = 
AR9300_NUM_5G_CAL_PIERS
;

4905 
≈õr
 = 
AR9300_NUM_2G_CAL_PIERS
;

4907 
ichaö
 = 0; ichaö < 
AR9300_MAX_CHAINS
; ichain++) {

4908 
l‰equícy
[
ichaö
] = 0;

4909 
h‰equícy
[
ichaö
] = 100000;

4912 
ichaö
 = 0; ichaö < 
AR9300_MAX_CHAINS
; ichain++) {

4913 
ùõr
 = 0; ipõ∏< 
≈õr
; ipier++) {

4914 i‡(!
	`¨9003_hw_ˇl_põr_gë
(
ah
, 
mode
, 
ùõr
, 
ichaö
,

4915 &
p‰equícy
, &
pc‹ª˘i⁄
,

4916 &
±em≥øtuª
, &
pvﬁège
)) {

4917 
fdiff
 = 
‰equícy
 - 
p‰equícy
;

4923 i‡(
fdiff
 <= 0) {

4924 i‡(
h‰equícy
[
ichaö
] <= 0 ||

4925 
h‰equícy
[
ichaö
] >= 100000 ||

4926 
fdiff
 >

4927 (
‰equícy
 - 
h‰equícy
[
ichaö
])) {

4932 
h‰equícy
[
ichaö
] = 
p‰equícy
;

4933 
hc‹ª˘i⁄
[
ichaö
] =

4934 
pc‹ª˘i⁄
;

4935 
hãm≥øtuª
[
ichaö
] =

4936 
±em≥øtuª
;

4937 
hvﬁège
[
ichaö
] = 
pvﬁège
;

4940 i‡(
fdiff
 >= 0) {

4941 i‡(
l‰equícy
[
ichaö
] <= 0

4942 || 
fdiff
 <

4943 (
‰equícy
 - 
l‰equícy
[
ichaö
])) {

4948 
l‰equícy
[
ichaö
] = 
p‰equícy
;

4949 
lc‹ª˘i⁄
[
ichaö
] =

4950 
pc‹ª˘i⁄
;

4951 
…em≥øtuª
[
ichaö
] =

4952 
±em≥øtuª
;

4953 
lvﬁège
[
ichaö
] = 
pvﬁège
;

4961 
ichaö
 = 0; ichaö < 
AR9300_MAX_CHAINS
; ichain++) {

4962 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "ch=%d f=%dÜow=%d %d h=%d %d\n",

4963 
ichaö
, 
‰equícy
, 
l‰equícy
[ichain],

4964 
lc‹ª˘i⁄
[
ichaö
], 
h‰equícy
[ichain],

4965 
hc‹ª˘i⁄
[
ichaö
]);

4967 i‡(
h‰equícy
[
ichaö
] =
l‰equícy
[ichain]) {

4968 
c‹ª˘i⁄
[
ichaö
] = 
lc‹ª˘i⁄
[ichain];

4969 
vﬁège
[
ichaö
] = 
lvﬁège
[ichain];

4970 
ãm≥øtuª
[
ichaö
] = 
…em≥øtuª
[ichain];

4973 i‡(
‰equícy
 - 
l‰equícy
[
ichaö
] < 1000) {

4975 i‡(
h‰equícy
[
ichaö
] - 
‰equícy
 < 1000) {

4977 
c‹ª˘i⁄
[
ichaö
] = 
	`öãΩﬁ©e
(
‰equícy
,

4978 
l‰equícy
[
ichaö
],

4979 
h‰equícy
[
ichaö
],

4980 
lc‹ª˘i⁄
[
ichaö
],

4981 
hc‹ª˘i⁄
[
ichaö
]);

4983 
ãm≥øtuª
[
ichaö
] = 
	`öãΩﬁ©e
(
‰equícy
,

4984 
l‰equícy
[
ichaö
],

4985 
h‰equícy
[
ichaö
],

4986 
…em≥øtuª
[
ichaö
],

4987 
hãm≥øtuª
[
ichaö
]);

4989 
vﬁège
[
ichaö
] = 
	`öãΩﬁ©e
(
‰equícy
,

4990 
l‰equícy
[
ichaö
],

4991 
h‰equícy
[
ichaö
],

4992 
lvﬁège
[
ichaö
],

4993 
hvﬁège
[
ichaö
]);

4997 
c‹ª˘i⁄
[
ichaö
] = 
lc‹ª˘i⁄
[ichain];

4998 
ãm≥øtuª
[
ichaö
] = 
…em≥øtuª
[ichain];

4999 
vﬁège
[
ichaö
] = 
lvﬁège
[ichain];

5003 i‡(
h‰equícy
[
ichaö
] - 
‰equícy
 < 1000) {

5004 
c‹ª˘i⁄
[
ichaö
] = 
hc‹ª˘i⁄
[ichain];

5005 
ãm≥øtuª
[
ichaö
] = 
hãm≥øtuª
[ichain];

5006 
vﬁège
[
ichaö
] = 
hvﬁège
[ichain];

5008 
c‹ª˘i⁄
[
ichaö
] = 0;

5009 
ãm≥øtuª
[
ichaö
] = 0;

5010 
vﬁège
[
ichaö
] = 0;

5014 
	`¨9003_hw_powî_c⁄åﬁ_ovîride
(
ah
, 
‰equícy
, 
c‹ª˘i⁄
, 
vﬁège
,

5015 
ãm≥øtuª
);

5017 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

5019 
‰equícy
, 
c‹ª˘i⁄
[0], correction[1], correction[2]);

5022 
	}
}

5024 
u16
 
	$¨9003_hw_gë_dúe˘_edge_powî
(
¨9300_ì¥om
 *
ìp
,

5025 
idx
,

5026 
edge
,

5027 
boﬁ
 
is2GHz
)

5029 
ˇl_˘l_d©a_2g
 *
˘l_2g
 = 
ìp
->
˘lPowîD©a_2G
;

5030 
ˇl_˘l_d©a_5g
 *
˘l_5g
 = 
ìp
->
˘lPowîD©a_5G
;

5032 i‡(
is2GHz
)

5033  
	`CTL_EDGE_TPOWER
(
˘l_2g
[
idx
].
˘lEdges
[
edge
]);

5035  
	`CTL_EDGE_TPOWER
(
˘l_5g
[
idx
].
˘lEdges
[
edge
]);

5036 
	}
}

5038 
u16
 
	$¨9003_hw_gë_ödúe˘_edge_powî
(
¨9300_ì¥om
 *
ìp
,

5039 
idx
,

5040 
edge
,

5041 
u16
 
‰eq
,

5042 
boﬁ
 
is2GHz
)

5044 
ˇl_˘l_d©a_2g
 *
˘l_2g
 = 
ìp
->
˘lPowîD©a_2G
;

5045 
ˇl_˘l_d©a_5g
 *
˘l_5g
 = 
ìp
->
˘lPowîD©a_5G
;

5047 
u8
 *
˘l_‰eqbö
 = 
is2GHz
 ?

5048 &
ìp
->
˘l_‰eqbö_2G
[
idx
][0] :

5049 &
ìp
->
˘l_‰eqbö_5G
[
idx
][0];

5051 i‡(
is2GHz
) {

5052 i‡(
	`©h9k_hw_fbö2‰eq
(
˘l_‰eqbö
[
edge
 - 1], 1Ë< 
‰eq
 &&

5053 
	`CTL_EDGE_FLAGS
(
˘l_2g
[
idx
].
˘lEdges
[
edge
 - 1]))

5054  
	`CTL_EDGE_TPOWER
(
˘l_2g
[
idx
].
˘lEdges
[
edge
 - 1]);

5056 i‡(
	`©h9k_hw_fbö2‰eq
(
˘l_‰eqbö
[
edge
 - 1], 0Ë< 
‰eq
 &&

5057 
	`CTL_EDGE_FLAGS
(
˘l_5g
[
idx
].
˘lEdges
[
edge
 - 1]))

5058  
	`CTL_EDGE_TPOWER
(
˘l_5g
[
idx
].
˘lEdges
[
edge
 - 1]);

5061  
MAX_RATE_POWER
;

5062 
	}
}

5067 
u16
 
	$¨9003_hw_gë_max_edge_powî
(
¨9300_ì¥om
 *
ìp
,

5068 
u16
 
‰eq
, 
idx
, 
boﬁ
 
is2GHz
)

5070 
u16
 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

5071 
u8
 *
˘l_‰eqbö
 = 
is2GHz
 ?

5072 &
ìp
->
˘l_‰eqbö_2G
[
idx
][0] :

5073 &
ìp
->
˘l_‰eqbö_5G
[
idx
][0];

5074 
u16
 
num_edges
 = 
is2GHz
 ?

5075 
AR9300_NUM_BAND_EDGES_2G
 : 
AR9300_NUM_BAND_EDGES_5G
;

5076 
edge
;

5079 
edge
 = 0;

5080 (
edge
 < 
num_edges
Ë&& (
˘l_‰eqbö
[edge] !
AR5416_BCHAN_UNUSED
);

5081 
edge
++) {

5086 i‡(
‰eq
 =
	`©h9k_hw_fbö2‰eq
(
˘l_‰eqbö
[
edge
], 
is2GHz
)) {

5087 
twi˚MaxEdgePowî
 =

5088 
	`¨9003_hw_gë_dúe˘_edge_powî
(
ìp
, 
idx
,

5089 
edge
, 
is2GHz
);

5091 } i‡((
edge
 > 0) &&

5092 (
‰eq
 < 
	`©h9k_hw_fbö2‰eq
(
˘l_‰eqbö
[
edge
],

5093 
is2GHz
))) {

5094 
twi˚MaxEdgePowî
 =

5095 
	`¨9003_hw_gë_ödúe˘_edge_powî
(
ìp
, 
idx
,

5096 
edge
, 
‰eq
,

5097 
is2GHz
);

5106 i‡(
is2GHz
 && !
twi˚MaxEdgePowî
)

5107 
twi˚MaxEdgePowî
 = 60;

5109  
twi˚MaxEdgePowî
;

5110 
	}
}

5112 
	$¨9003_hw_£t_powî_≥r_øã_èbÀ
(
©h_hw
 *
ah
,

5113 
©h9k_ch™√l
 *
ch™
,

5114 
u8
 *
pPwrAºay
, 
u16
 
cfgCé
,

5115 
u8
 
™ã¬a_ªdu˘i⁄
,

5116 
u16
 
powîLimô
)

5118 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

5119 
¨9300_ì¥om
 *
pEïD©a
 = &
ah
->
ì¥om
.
¨9300_ìp
;

5120 
u16
 
twi˚MaxEdgePowî
;

5121 
i
;

5122 
u16
 
sˇÀdPowî
 = 0, 
möCéPowî
;

5123 c⁄° 
u16
 
˘lModesF‹11a
[] = {

5124 
CTL_11A
, 
CTL_5GHT20
, 
CTL_11A_EXT
, 
CTL_5GHT40


5126 c⁄° 
u16
 
˘lModesF‹11g
[] = {

5127 
CTL_11B
, 
CTL_11G
, 
CTL_2GHT20
, 
CTL_11B_EXT
,

5128 
CTL_11G_EXT
, 
CTL_2GHT40


5130 
u16
 
numCéModes
;

5131 c⁄° 
u16
 *
pCéMode
;

5132 
u16
 
˘lMode
, 
‰eq
;

5133 
ch™_˚¡îs
 
˚¡îs
;

5134 
u8
 *
˘lIndex
;

5135 
u8
 
˘lNum
;

5136 
u16
 
twi˚MöEdgePowî
;

5137 
boﬁ
 
is2ghz
 = 
	`IS_CHAN_2GHZ
(
ch™
);

5139 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

5140 
sˇÀdPowî
 = 
	`©h9k_hw_gë_sˇÀd_powî
(
ah
, 
powîLimô
,

5141 
™ã¬a_ªdu˘i⁄
);

5143 i‡(
is2ghz
) {

5146 
numCéModes
 =

5147 
	`ARRAY_SIZE
(
˘lModesF‹11g
) -

5148 
SUB_NUM_CTL_MODES_AT_2G_40
;

5149 
pCéMode
 = 
˘lModesF‹11g
;

5150 i‡(
	`IS_CHAN_HT40
(
ch™
))

5152 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
);

5156 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11a
) -

5157 
SUB_NUM_CTL_MODES_AT_5G_40
;

5158 
pCéMode
 = 
˘lModesF‹11a
;

5159 i‡(
	`IS_CHAN_HT40
(
ch™
))

5161 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11a
);

5172 
˘lMode
 = 0; céModê< 
numCéModes
; ctlMode++) {

5173 
boﬁ
 
isHt40CéMode
 = (
pCéMode
[
˘lMode
] =
CTL_5GHT40
) ||

5174 (
pCéMode
[
˘lMode
] =
CTL_2GHT40
);

5175 i‡(
isHt40CéMode
)

5176 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

5177 i‡(
pCéMode
[
˘lMode
] & 
EXT_ADDITIVE
)

5178 
‰eq
 = 
˚¡îs
.
ext_˚¡î
;

5180 
‰eq
 = 
˚¡îs
.
˘l_˚¡î
;

5182 
	`©h_dbg
(
comm⁄
, 
REGULATORY
,

5184 
˘lMode
, 
numCéModes
, 
isHt40CéMode
,

5185 (
pCéMode
[
˘lMode
] & 
EXT_ADDITIVE
));

5188 i‡(
is2ghz
) {

5189 
˘lIndex
 = 
pEïD©a
->
˘lIndex_2G
;

5190 
˘lNum
 = 
AR9300_NUM_CTLS_2G
;

5192 
˘lIndex
 = 
pEïD©a
->
˘lIndex_5G
;

5193 
˘lNum
 = 
AR9300_NUM_CTLS_5G
;

5196 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

5197 
i
 = 0; (ò< 
˘lNum
Ë&& 
˘lIndex
[i]; i++) {

5198 
	`©h_dbg
(
comm⁄
, 
REGULATORY
,

5200 
i
, 
cfgCé
, 
pCéMode
[
˘lMode
], 
˘lIndex
[i],

5201 
ch™
->
ch™√l
);

5208 i‡((((
cfgCé
 & ~
CTL_MODE_M
) |

5209 (
pCéMode
[
˘lMode
] & 
CTL_MODE_M
)) ==

5210 
˘lIndex
[
i
]) ||

5211 (((
cfgCé
 & ~
CTL_MODE_M
) |

5212 (
pCéMode
[
˘lMode
] & 
CTL_MODE_M
)) ==

5213 ((
˘lIndex
[
i
] & 
CTL_MODE_M
) |

5214 
SD_NO_CTL
))) {

5215 
twi˚MöEdgePowî
 =

5216 
	`¨9003_hw_gë_max_edge_powî
(
pEïD©a
,

5217 
‰eq
, 
i
,

5218 
is2ghz
);

5220 i‡((
cfgCé
 & ~
CTL_MODE_M
Ë=
SD_NO_CTL
)

5226 
twi˚MaxEdgePowî
 =

5227 
	`mö
(
twi˚MaxEdgePowî
,

5228 
twi˚MöEdgePowî
);

5231 
twi˚MaxEdgePowî
 = 
twi˚MöEdgePowî
;

5237 
möCéPowî
 = (
u8
)
	`mö
(
twi˚MaxEdgePowî
, 
sˇÀdPowî
);

5239 
	`©h_dbg
(
comm⁄
, 
REGULATORY
,

5241 
˘lMode
, 
pCéMode
[˘lMode], 
twi˚MaxEdgePowî
,

5242 
sˇÀdPowî
, 
möCéPowî
);

5245 
pCéMode
[
˘lMode
]) {

5246 
CTL_11B
:

5247 
i
 = 
ALL_TARGET_LEGACY_1L_5L
;

5248 
i
 <
ALL_TARGET_LEGACY_11S
; i++)

5249 
pPwrAºay
[
i
] = (
u8
)
	`mö
((
u16
)pPwrArray[i],

5250 
möCéPowî
);

5252 
CTL_11A
:

5253 
CTL_11G
:

5254 
i
 = 
ALL_TARGET_LEGACY_6_24
;

5255 
i
 <
ALL_TARGET_LEGACY_54
; i++)

5256 
pPwrAºay
[
i
] = (
u8
)
	`mö
((
u16
)pPwrArray[i],

5257 
möCéPowî
);

5259 
CTL_5GHT20
:

5260 
CTL_2GHT20
:

5261 
i
 = 
ALL_TARGET_HT20_0_8_16
;

5262 
i
 <
ALL_TARGET_HT20_23
; i++) {

5263 
pPwrAºay
[
i
] = (
u8
)
	`mö
((
u16
)pPwrArray[i],

5264 
möCéPowî
);

5265 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

5266 
pPwrAºay
[
i
] =

5267 (
u8
)
	`mö
((
u16
)
pPwrAºay
[
i
],

5268 
	`¨9003_mci_gë_max_txpowî
(
ah
,

5269 
pCéMode
[
˘lMode
]));

5272 
CTL_5GHT40
:

5273 
CTL_2GHT40
:

5274 
i
 = 
ALL_TARGET_HT40_0_8_16
;

5275 
i
 <
ALL_TARGET_HT40_23
; i++) {

5276 
pPwrAºay
[
i
] = (
u8
)
	`mö
((
u16
)pPwrArray[i],

5277 
möCéPowî
);

5278 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

5279 
pPwrAºay
[
i
] =

5280 (
u8
)
	`mö
((
u16
)
pPwrAºay
[
i
],

5281 
	`¨9003_mci_gë_max_txpowî
(
ah
,

5282 
pCéMode
[
˘lMode
]));

5289 
	}
}

5291 
ölöe
 
u8
 
	$mcsidx_to_tgçwridx
(
mcs_idx
, 
u8
 
ba£_pwridx
)

5293 
u8
 
mod_idx
 = 
mcs_idx
 % 8;

5295 i‡(
mod_idx
 <= 3)

5296  
mod_idx
 ? (
ba£_pwridx
 + 1) : base_pwridx;

5298  
ba£_pwridx
 + 4 * (
mcs_idx
 / 8Ë+ 
mod_idx
 - 2;

5299 
	}
}

5301 
	$¨9003_∑¥d_£t_txpowî
(
©h_hw
 *
ah
,

5302 
©h9k_ch™√l
 *
ch™
,

5303 
u8
 *
èrgëPowîVÆT2
)

5305 
i
;

5307 i‡(!
	`¨9003_is_∑¥d_íabÀd
(
ah
))

5310 i‡(
	`IS_CHAN_HT40
(
ch™
))

5311 
i
 = 
ALL_TARGET_HT40_7
;

5313 
i
 = 
ALL_TARGET_HT20_7
;

5315 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

5316 i‡(!
	`AR_SREV_9330
(
ah
Ë&& !
	`AR_SREV_9340
(ah) &&

5317 !
	`AR_SREV_9462
(
ah
Ë&& !
	`AR_SREV_9565
(ah)) {

5318 i‡(
	`IS_CHAN_HT40
(
ch™
))

5319 
i
 = 
ALL_TARGET_HT40_0_8_16
;

5321 
i
 = 
ALL_TARGET_HT20_0_8_16
;

5325 
ah
->
∑¥d_èrgë_powî
 = 
èrgëPowîVÆT2
[
i
];

5326 
	}
}

5328 
	$©h9k_hw_¨9300_£t_txpowî
(
©h_hw
 *
ah
,

5329 
©h9k_ch™√l
 *
ch™
, 
u16
 
cfgCé
,

5330 
u8
 
twi˚A¡í«Redu˘i⁄
,

5331 
u8
 
powîLimô
, 
boﬁ
 
ã°
)

5333 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

5334 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

5335 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

5336 
¨9300_modÆ_ìp_hódî
 *
modÆ_hdr
;

5337 
u8
 
èrgëPowîVÆT2
[
¨9300R©eSize
];

5338 
u8
 
èrgë_powî_vÆ_t2_ìp
[
¨9300R©eSize
];

5339 
u8
 
èrgëPowîVÆT2_çc
[
¨9300R©eSize
];

5340 
i
 = 0, 
∑¥d_sˇÀ_Á˘‹
 = 0;

5341 
u8
 
pwr_idx
, 
mö_pwridx
 = 0;

5343 
	`mem£t
(
èrgëPowîVÆT2
, 0 , (targetPowerValT2));

5348 
	`¨9003_hw_gë_èrgë_powî_ì¥om
(
ah
, 
ch™
, 
èrgëPowîVÆT2
);

5350 i‡(
	`¨9003_is_∑¥d_íabÀd
(
ah
)) {

5351 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

5352 
modÆ_hdr
 = &
ìp
->
modÆHódî2G
;

5354 
modÆ_hdr
 = &
ìp
->
modÆHódî5G
;

5356 
ah
->
∑¥d_øãmask
 =

5357 
	`À32_to_˝u
(
modÆ_hdr
->
∑pdR©eMaskHt20
) &

5358 
AR9300_PAPRD_RATE_MASK
;

5360 
ah
->
∑¥d_øãmask_ht40
 =

5361 
	`À32_to_˝u
(
modÆ_hdr
->
∑pdR©eMaskHt40
) &

5362 
AR9300_PAPRD_RATE_MASK
;

5364 
∑¥d_sˇÀ_Á˘‹
 = 
	`¨9003_gë_∑¥d_sˇÀ_Á˘‹
(
ah
, 
ch™
);

5365 
mö_pwridx
 = 
	`IS_CHAN_HT40
(
ch™
Ë? 
ALL_TARGET_HT40_0_8_16
 :

5366 
ALL_TARGET_HT20_0_8_16
;

5368 i‡(!
ah
->
∑¥d_èbÀ_wrôe_d⁄e
) {

5369 
	`mem˝y
(
èrgë_powî_vÆ_t2_ìp
, 
èrgëPowîVÆT2
,

5370 (
èrgëPowîVÆT2
));

5371 
i
 = 0; i < 24; i++) {

5372 
pwr_idx
 = 
	`mcsidx_to_tgçwridx
(
i
, 
mö_pwridx
);

5373 i‡(
ah
->
∑¥d_øãmask
 & (1 << 
i
)) {

5374 i‡(
èrgëPowîVÆT2
[
pwr_idx
] &&

5375 
èrgëPowîVÆT2
[
pwr_idx
] ==

5376 
èrgë_powî_vÆ_t2_ìp
[
pwr_idx
])

5377 
èrgëPowîVÆT2
[
pwr_idx
] -=

5378 
∑¥d_sˇÀ_Á˘‹
;

5382 
	`mem˝y
(
èrgë_powî_vÆ_t2_ìp
, 
èrgëPowîVÆT2
,

5383 (
èrgëPowîVÆT2
));

5386 
	`¨9003_hw_£t_powî_≥r_øã_èbÀ
(
ah
, 
ch™
,

5387 
èrgëPowîVÆT2
, 
cfgCé
,

5388 
twi˚A¡í«Redu˘i⁄
,

5389 
powîLimô
);

5391 
	`mem˝y
(
èrgëPowîVÆT2_çc
, 
èrgëPowîVÆT2
,

5392 (
èrgëPowîVÆT2
));

5394 i‡(
	`¨9003_is_∑¥d_íabÀd
(
ah
)) {

5395 
i
 = 0; i < 
¨9300R©eSize
; i++) {

5396 i‡((
ah
->
∑¥d_øãmask
 & (1 << 
i
)) &&

5397 (
	`abs
(
èrgëPowîVÆT2
[
i
] -

5398 
èrgë_powî_vÆ_t2_ìp
[
i
]) >

5399 
∑¥d_sˇÀ_Á˘‹
)) {

5400 
ah
->
∑¥d_øãmask
 &~(1 << 
i
);

5401 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

5402 "∑¥d dißbÀd f‹ mc†%d\n", 
i
);

5407 
ªguœt‹y
->
max_powî_Àvñ
 = 0;

5408 
i
 = 0; i < 
¨9300R©eSize
; i++) {

5409 i‡(
èrgëPowîVÆT2
[
i
] > 
ªguœt‹y
->
max_powî_Àvñ
)

5410 
ªguœt‹y
->
max_powî_Àvñ
 = 
èrgëPowîVÆT2
[
i
];

5413 
	`©h9k_hw_upd©e_ªguœt‹y_maxpowî
(
ah
);

5415 i‡(
ã°
)

5418 
i
 = 0; i < 
¨9300R©eSize
; i++) {

5419 
	`©h_dbg
(
comm⁄
, 
REGULATORY
, "TPC[%02d] 0x%08x\n",

5420 
i
, 
èrgëPowîVÆT2
[i]);

5424 
	`¨9003_hw_tx_powî_ªgwrôe
(
ah
, 
èrgëPowîVÆT2
);

5425 
	`¨9003_hw_ˇlibøti⁄_≠∂y
(
ah
, 
ch™
->
ch™√l
);

5426 
	`¨9003_∑¥d_£t_txpowî
(
ah
, 
ch™
, 
èrgëPowîVÆT2
);

5428 
	`¨9003_hw_£lfgí_çc_txpowî
(
ah
, 
ch™
, 
èrgëPowîVÆT2
);

5431 i‡(
ah
->
çc_íabÀd
) {

5432 
u32
 
vÆ
;

5434 
	`¨9003_hw_öô_øã_txpowî
(
ah
, 
èrgëPowîVÆT2_çc
, 
ch™
);

5437 
	`REG_WRITE
(
ah
, 
AR_PHY_PWRTX_MAX
,

5438 
AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
);

5440 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_POWER_TX_SUB
);

5441 i‡(
	`AR_SREV_9340
(
ah
))

5442 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_SUB
,

5443 
vÆ
 & 0xFFFFFFC0);

5445 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_SUB
,

5446 
vÆ
 & 0xFFFFF000);

5449 
	`REG_WRITE
(
ah
, 
AR_PHY_PWRTX_MAX
, 0);

5451 
	}
}

5453 
u16
 
	$©h9k_hw_¨9300_gë_•ur_ch™√l
(
©h_hw
 *
ah
,

5454 
u16
 
i
, 
boﬁ
 
is2GHz
)

5456  
AR_NO_SPUR
;

5457 
	}
}

5459 
s32
 
	$¨9003_hw_gë_tx_gaö_idx
(
©h_hw
 *
ah
)

5461 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

5463  (
ìp
->
ba£EïHódî
.
txrxgaö
 >> 4) & 0xf;

5464 
	}
}

5466 
s32
 
	$¨9003_hw_gë_rx_gaö_idx
(
©h_hw
 *
ah
)

5468 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

5470  (
ìp
->
ba£EïHódî
.
txrxgaö
) & 0xf;

5471 
	}
}

5473 
u8
 *
	$¨9003_gë_•ur_ch™_±r
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
)

5475  
	`¨9003_modÆ_hódî
(
ah
, 
is2ghz
)->
•urCh™s
;

5476 
	}
}

5478 
	$¨9003_gë_∑¥d_sˇÀ_Á˘‹
(
©h_hw
 *
ah
,

5479 
©h9k_ch™√l
 *
ch™
)

5481 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

5483 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

5484  
	`MS
(
	`À32_to_˝u
(
ìp
->
modÆHódî2G
.
∑pdR©eMaskHt20
),

5485 
AR9300_PAPRD_SCALE_1
);

5487 i‡(
ch™
->
ch™√l
 >= 5700)

5488  
	`MS
(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt20
),

5489 
AR9300_PAPRD_SCALE_1
);

5490 i‡(
ch™
->
ch™√l
 >= 5400)

5491  
	`MS
(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt40
),

5492 
AR9300_PAPRD_SCALE_2
);

5494  
	`MS
(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt40
),

5495 
AR9300_PAPRD_SCALE_1
);

5497 
	}
}

5499 c⁄° 
ì¥om_›s
 
	gìp_¨9300_›s
 = {

5500 .
check_ì¥om
 = 
©h9k_hw_¨9300_check_ì¥om
,

5501 .
	ggë_ì¥om
 = 
©h9k_hw_¨9300_gë_ì¥om
,

5502 .
	gfûl_ì¥om
 = 
©h9k_hw_¨9300_fûl_ì¥om
,

5503 .
	gdump_ì¥om
 = 
©h9k_hw_¨9003_dump_ì¥om
,

5504 .
	ggë_ì¥om_vî
 = 
©h9k_hw_¨9300_gë_ì¥om_vî
,

5505 .
	ggë_ì¥om_ªv
 = 
©h9k_hw_¨9300_gë_ì¥om_ªv
,

5506 .
	g£t_bﬂrd_vÆues
 = 
©h9k_hw_¨9300_£t_bﬂrd_vÆues
,

5507 .
	g£t_addac
 = 
©h9k_hw_¨9300_£t_addac
,

5508 .
	g£t_txpowî
 = 
©h9k_hw_¨9300_£t_txpowî
,

5509 .
	ggë_•ur_ch™√l
 = 
©h9k_hw_¨9300_gë_•ur_ch™√l


	@ar9003_eeprom.h

17 #i‚de‡
AR9003_EEPROM_H


18 
	#AR9003_EEPROM_H


	)

20 
	~<löux/ty≥s.h
>

22 
	#AR9300_EEP_VER
 0xD000

	)

23 
	#AR9300_EEP_VER_MINOR_MASK
 0xFFF

	)

24 
	#AR9300_EEP_MINOR_VER_1
 0x1

	)

25 
	#AR9300_EEP_MINOR_VER
 
AR9300_EEP_MINOR_VER_1


	)

28 
	#AR9300_EEP_START_LOC
 256

	)

29 
	#AR9300_NUM_5G_CAL_PIERS
 8

	)

30 
	#AR9300_NUM_2G_CAL_PIERS
 3

	)

31 
	#AR9300_NUM_5G_20_TARGET_POWERS
 8

	)

32 
	#AR9300_NUM_5G_40_TARGET_POWERS
 8

	)

33 
	#AR9300_NUM_2G_CCK_TARGET_POWERS
 2

	)

34 
	#AR9300_NUM_2G_20_TARGET_POWERS
 3

	)

35 
	#AR9300_NUM_2G_40_TARGET_POWERS
 3

	)

37 
	#AR9300_NUM_CTLS_5G
 9

	)

38 
	#AR9300_NUM_CTLS_2G
 12

	)

39 
	#AR9300_NUM_BAND_EDGES_5G
 8

	)

40 
	#AR9300_NUM_BAND_EDGES_2G
 4

	)

41 
	#AR9300_EEPMISC_BIG_ENDIAN
 0x01

	)

42 
	#AR9300_EEPMISC_WOW
 0x02

	)

43 
	#AR9300_CUSTOMER_DATA_SIZE
 20

	)

45 
	#AR9300_MAX_CHAINS
 3

	)

46 
	#AR9300_ANT_16S
 25

	)

47 
	#AR9300_FUTURE_MODAL_SZ
 6

	)

49 
	#AR9300_PAPRD_RATE_MASK
 0x01ffffff

	)

50 
	#AR9300_PAPRD_SCALE_1
 0x0e000000

	)

51 
	#AR9300_PAPRD_SCALE_1_S
 25

	)

52 
	#AR9300_PAPRD_SCALE_2
 0x70000000

	)

53 
	#AR9300_PAPRD_SCALE_2_S
 28

	)

55 
	#AR9300_EEP_ANTDIV_CONTROL_DEFAULT_VALUE
 0xc9

	)

64 
	#AR9300_PWR_TABLE_OFFSET
 0

	)

67 
	#AR9300_EEPROM_SIZE
 (16*1024)

	)

69 
	#AR9300_BASE_ADDR_4K
 0xfff

	)

70 
	#AR9300_BASE_ADDR
 0x3ff

	)

71 
	#AR9300_BASE_ADDR_512
 0x1ff

	)

73 
	#AR9300_OTP_BASE
 \

74 ((
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊h)Ë? 0x30000 : 0x14000)

	)

75 
	#AR9300_OTP_STATUS
 \

76 ((
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊h)Ë? 0x30018 : 0x15f18)

	)

77 
	#AR9300_OTP_STATUS_TYPE
 0x7

	)

78 
	#AR9300_OTP_STATUS_VALID
 0x4

	)

79 
	#AR9300_OTP_STATUS_ACCESS_BUSY
 0x2

	)

80 
	#AR9300_OTP_STATUS_SM_BUSY
 0x1

	)

81 
	#AR9300_OTP_READ_DATA
 \

82 ((
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊h)Ë? 0x3001¯: 0x15f1c)

	)

84 
	eèrgëPowîHTR©es
 {

85 
	mHT_TARGET_RATE_0_8_16
,

86 
	mHT_TARGET_RATE_1_3_9_11_17_19
,

87 
	mHT_TARGET_RATE_4
,

88 
	mHT_TARGET_RATE_5
,

89 
	mHT_TARGET_RATE_6
,

90 
	mHT_TARGET_RATE_7
,

91 
	mHT_TARGET_RATE_12
,

92 
	mHT_TARGET_RATE_13
,

93 
	mHT_TARGET_RATE_14
,

94 
	mHT_TARGET_RATE_15
,

95 
	mHT_TARGET_RATE_20
,

96 
	mHT_TARGET_RATE_21
,

97 
	mHT_TARGET_RATE_22
,

98 
	mHT_TARGET_RATE_23


101 
	eèrgëPowîLegacyR©es
 {

102 
	mLEGACY_TARGET_RATE_6_24
,

103 
	mLEGACY_TARGET_RATE_36
,

104 
	mLEGACY_TARGET_RATE_48
,

105 
	mLEGACY_TARGET_RATE_54


108 
	eèrgëPowîCckR©es
 {

109 
	mLEGACY_TARGET_RATE_1L_5L
,

110 
	mLEGACY_TARGET_RATE_5S
,

111 
	mLEGACY_TARGET_RATE_11L
,

112 
	mLEGACY_TARGET_RATE_11S


115 
	e¨9300_R©es
 {

116 
	mALL_TARGET_LEGACY_6_24
,

117 
	mALL_TARGET_LEGACY_36
,

118 
	mALL_TARGET_LEGACY_48
,

119 
	mALL_TARGET_LEGACY_54
,

120 
	mALL_TARGET_LEGACY_1L_5L
,

121 
	mALL_TARGET_LEGACY_5S
,

122 
	mALL_TARGET_LEGACY_11L
,

123 
	mALL_TARGET_LEGACY_11S
,

124 
	mALL_TARGET_HT20_0_8_16
,

125 
	mALL_TARGET_HT20_1_3_9_11_17_19
,

126 
	mALL_TARGET_HT20_4
,

127 
	mALL_TARGET_HT20_5
,

128 
	mALL_TARGET_HT20_6
,

129 
	mALL_TARGET_HT20_7
,

130 
	mALL_TARGET_HT20_12
,

131 
	mALL_TARGET_HT20_13
,

132 
	mALL_TARGET_HT20_14
,

133 
	mALL_TARGET_HT20_15
,

134 
	mALL_TARGET_HT20_20
,

135 
	mALL_TARGET_HT20_21
,

136 
	mALL_TARGET_HT20_22
,

137 
	mALL_TARGET_HT20_23
,

138 
	mALL_TARGET_HT40_0_8_16
,

139 
	mALL_TARGET_HT40_1_3_9_11_17_19
,

140 
	mALL_TARGET_HT40_4
,

141 
	mALL_TARGET_HT40_5
,

142 
	mALL_TARGET_HT40_6
,

143 
	mALL_TARGET_HT40_7
,

144 
	mALL_TARGET_HT40_12
,

145 
	mALL_TARGET_HT40_13
,

146 
	mALL_TARGET_HT40_14
,

147 
	mALL_TARGET_HT40_15
,

148 
	mALL_TARGET_HT40_20
,

149 
	mALL_TARGET_HT40_21
,

150 
	mALL_TARGET_HT40_22
,

151 
	mALL_TARGET_HT40_23
,

152 
	m¨9300R©eSize
,

156 
	sìpFœgs
 {

157 
u8
 
	m›Fœgs
;

158 
u8
 
	mìpMisc
;

159 } 
	g__∑cked
;

161 
	eCom¥essAlg‹ôhm
 {

162 
	m_Com¥essN⁄e
 = 0,

163 
	m_Com¥essLzma
,

164 
	m_Com¥essPaús
,

165 
	m_Com¥essBlock
,

166 
	m_Com¥ess4
,

167 
	m_Com¥ess5
,

168 
	m_Com¥ess6
,

169 
	m_Com¥ess7
,

172 
	s¨9300_ba£_ìp_hdr
 {

173 
__À16
 
	mªgDmn
[2];

175 
u8
 
	mtxrxMask
;

176 
ìpFœgs
 
	m›C≠Fœgs
;

177 
u8
 
	mrfSûít
;

178 
u8
 
	mblueToŸhO±i⁄s
;

179 
u8
 
	mdevi˚C≠
;

181 
u8
 
	mdevi˚Ty≥
;

185 
öt8_t
 
	mpwrTabÀOff£t
;

186 
u8
 
	m∑øms_f‹_tunög_ˇps
[2];

194 
u8
 
	m„©uªE«bÀ
;

196 
u8
 
	mmiscC⁄figuøti⁄
;

197 
u8
 
	mì¥omWrôeE«bÀGpio
;

198 
u8
 
	mwœnDißbÀGpio
;

199 
u8
 
	mwœnLedGpio
;

200 
u8
 
	mrxB™dSñe˘Gpio
;

201 
u8
 
	mtxrxgaö
;

203 
__À32
 
	mswªg
;

204 } 
	g__∑cked
;

206 
	s¨9300_modÆ_ìp_hódî
 {

208 
__À32
 
	m™tCålComm⁄
;

210 
__À32
 
	m™tCålComm⁄2
;

212 
__À16
 
	m™tCålChaö
[
AR9300_MAX_CHAINS
];

214 
u8
 
	mx©ãn1DB
[
AR9300_MAX_CHAINS
];

216 
u8
 
	mx©ãn1M¨gö
[
AR9300_MAX_CHAINS
];

217 
öt8_t
 
	mãmpSl›e
;

218 
öt8_t
 
	mvﬁtSl›e
;

220 
u8
 
	m•urCh™s
[
AR_EEPROM_MODAL_SPURS
];

222 
öt8_t
 
	mnoi£Flo‹ThªshCh
[
AR9300_MAX_CHAINS
];

223 
u8
 
	mª£rved
[11];

224 
öt8_t
 
	mquick_dr›
;

225 
u8
 
	mx∑BüsLvl
;

226 
u8
 
	mtxFømeToD©aSèπ
;

227 
u8
 
	mtxFømeToPaOn
;

228 
u8
 
	mtxClù
;

229 
öt8_t
 
	m™ã¬aGaö
;

230 
u8
 
	mswôchSëéög
;

231 
öt8_t
 
	madcDesúedSize
;

232 
u8
 
	mtxEndToX∑Off
;

233 
u8
 
	mtxEndToRxOn
;

234 
u8
 
	mtxFømeToX∑On
;

235 
u8
 
	mthªsh62
;

236 
__À32
 
	m∑pdR©eMaskHt20
;

237 
__À32
 
	m∑pdR©eMaskHt40
;

238 
__À16
 
	mswôchcom•dt
;

239 
u8
 
	mx a_büs_°ªngth
;

240 
u8
 
	mfutuªModÆ
[7];

241 } 
	g__∑cked
;

243 
	s¨9300_ˇl_d©a_≥r_‰eq_›_lo›
 {

244 
öt8_t
 
	mªfPowî
;

246 
u8
 
	mvﬁtMós
;

248 
u8
 
	mãmpMós
;

250 
öt8_t
 
	mrxNoi£Êo‹CÆ
;

252 
öt8_t
 
	mrxNoi£Êo‹Powî
;

254 
u8
 
	mrxTempMós
;

255 } 
	g__∑cked
;

257 
	sˇl_tgt_pow_Àgacy
 {

258 
u8
 
	mtPow2x
[4];

259 } 
	g__∑cked
;

261 
	sˇl_tgt_pow_ht
 {

262 
u8
 
	mtPow2x
[14];

263 } 
	g__∑cked
;

265 
	sˇl_˘l_d©a_2g
 {

266 
u8
 
	m˘lEdges
[
AR9300_NUM_BAND_EDGES_2G
];

267 } 
	g__∑cked
;

269 
	sˇl_˘l_d©a_5g
 {

270 
u8
 
	m˘lEdges
[
AR9300_NUM_BAND_EDGES_5G
];

271 } 
	g__∑cked
;

273 
	#MAX_BASE_EXTENSION_FUTURE
 2

	)

275 
	s¨9300_Ba£Exãnsi⁄_1
 {

276 
u8
 
	m™t_div_c⁄åﬁ
;

277 
u8
 
	mfutuª
[
MAX_BASE_EXTENSION_FUTURE
];

285 
u8
 
	mmisc_íabÀ
;

286 
öt8_t
 
	mãmp¶›exãnsi⁄
[8];

287 
öt8_t
 
	mquick_dr›_low
;

288 
öt8_t
 
	mquick_dr›_high
;

289 } 
	g__∑cked
;

291 
	s¨9300_Ba£Exãnsi⁄_2
 {

292 
öt8_t
 
	mãmpSl›eLow
;

293 
öt8_t
 
	mãmpSl›eHigh
;

294 
u8
 
	mx©ãn1DBLow
[
AR9300_MAX_CHAINS
];

295 
u8
 
	mx©ãn1M¨göLow
[
AR9300_MAX_CHAINS
];

296 
u8
 
	mx©ãn1DBHigh
[
AR9300_MAX_CHAINS
];

297 
u8
 
	mx©ãn1M¨göHigh
[
AR9300_MAX_CHAINS
];

298 } 
	g__∑cked
;

300 
	s¨9300_ì¥om
 {

301 
u8
 
	mì¥omVîsi⁄
;

302 
u8
 
	mãm∂©eVîsi⁄
;

303 
u8
 
	mmacAddr
[6];

304 
u8
 
	mcu°D©a
[
AR9300_CUSTOMER_DATA_SIZE
];

306 
¨9300_ba£_ìp_hdr
 
	mba£EïHódî
;

308 
¨9300_modÆ_ìp_hódî
 
	mmodÆHódî2G
;

309 
¨9300_Ba£Exãnsi⁄_1
 
	mba£_ext1
;

310 
u8
 
	mˇlFªqPõr2G
[
AR9300_NUM_2G_CAL_PIERS
];

311 
¨9300_ˇl_d©a_≥r_‰eq_›_lo›


312 
	mˇlPõrD©a2G
[
AR9300_MAX_CHAINS
][
AR9300_NUM_2G_CAL_PIERS
];

313 
u8
 
	mˇlT¨gë_‰eqbö_Cck
[
AR9300_NUM_2G_CCK_TARGET_POWERS
];

314 
u8
 
	mˇlT¨gë_‰eqbö_2G
[
AR9300_NUM_2G_20_TARGET_POWERS
];

315 
u8
 
	mˇlT¨gë_‰eqbö_2GHT20
[
AR9300_NUM_2G_20_TARGET_POWERS
];

316 
u8
 
	mˇlT¨gë_‰eqbö_2GHT40
[
AR9300_NUM_2G_40_TARGET_POWERS
];

317 
ˇl_tgt_pow_Àgacy


318 
	mˇlT¨gëPowîCck
[
AR9300_NUM_2G_CCK_TARGET_POWERS
];

319 
ˇl_tgt_pow_Àgacy


320 
	mˇlT¨gëPowî2G
[
AR9300_NUM_2G_20_TARGET_POWERS
];

321 
ˇl_tgt_pow_ht


322 
	mˇlT¨gëPowî2GHT20
[
AR9300_NUM_2G_20_TARGET_POWERS
];

323 
ˇl_tgt_pow_ht


324 
	mˇlT¨gëPowî2GHT40
[
AR9300_NUM_2G_40_TARGET_POWERS
];

325 
u8
 
	m˘lIndex_2G
[
AR9300_NUM_CTLS_2G
];

326 
u8
 
	m˘l_‰eqbö_2G
[
AR9300_NUM_CTLS_2G
][
AR9300_NUM_BAND_EDGES_2G
];

327 
ˇl_˘l_d©a_2g
 
	m˘lPowîD©a_2G
[
AR9300_NUM_CTLS_2G
];

328 
¨9300_modÆ_ìp_hódî
 
	mmodÆHódî5G
;

329 
¨9300_Ba£Exãnsi⁄_2
 
	mba£_ext2
;

330 
u8
 
	mˇlFªqPõr5G
[
AR9300_NUM_5G_CAL_PIERS
];

331 
¨9300_ˇl_d©a_≥r_‰eq_›_lo›


332 
	mˇlPõrD©a5G
[
AR9300_MAX_CHAINS
][
AR9300_NUM_5G_CAL_PIERS
];

333 
u8
 
	mˇlT¨gë_‰eqbö_5G
[
AR9300_NUM_5G_20_TARGET_POWERS
];

334 
u8
 
	mˇlT¨gë_‰eqbö_5GHT20
[
AR9300_NUM_5G_20_TARGET_POWERS
];

335 
u8
 
	mˇlT¨gë_‰eqbö_5GHT40
[
AR9300_NUM_5G_40_TARGET_POWERS
];

336 
ˇl_tgt_pow_Àgacy


337 
	mˇlT¨gëPowî5G
[
AR9300_NUM_5G_20_TARGET_POWERS
];

338 
ˇl_tgt_pow_ht


339 
	mˇlT¨gëPowî5GHT20
[
AR9300_NUM_5G_20_TARGET_POWERS
];

340 
ˇl_tgt_pow_ht


341 
	mˇlT¨gëPowî5GHT40
[
AR9300_NUM_5G_40_TARGET_POWERS
];

342 
u8
 
	m˘lIndex_5G
[
AR9300_NUM_CTLS_5G
];

343 
u8
 
	m˘l_‰eqbö_5G
[
AR9300_NUM_CTLS_5G
][
AR9300_NUM_BAND_EDGES_5G
];

344 
ˇl_˘l_d©a_5g
 
	m˘lPowîD©a_5G
[
AR9300_NUM_CTLS_5G
];

345 } 
	g__∑cked
;

347 
s32
 
¨9003_hw_gë_tx_gaö_idx
(
©h_hw
 *
ah
);

348 
s32
 
¨9003_hw_gë_rx_gaö_idx
(
©h_hw
 *
ah
);

349 
u32
 
¨9003_hw_™t_˘æ_comm⁄_gë
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
);

350 
u32
 
¨9003_hw_™t_˘æ_comm⁄_2_gë
(
©h_hw
 *
ah
, 
boﬁ
 
is2ghz
);

352 
u8
 *
¨9003_gë_•ur_ch™_±r
(
©h_hw
 *
ah
, 
boﬁ
 
is_2ghz
);

354 
¨9003_gë_∑¥d_sˇÀ_Á˘‹
(
©h_hw
 *
ah
,

355 
©h9k_ch™√l
 *
ch™
);

357 
¨9003_hw_öã∫Æ_ªguœt‹_≠∂y
(
©h_hw
 *
ah
);

	@ar9003_hw.c

17 
	~"hw.h
"

18 
	~"¨9003_mac.h
"

19 
	~"¨9003_2p2_öôvÆs.h
"

20 
	~"¨9003_bufÁlo_öôvÆs.h
"

21 
	~"¨9485_öôvÆs.h
"

22 
	~"¨9340_öôvÆs.h
"

23 
	~"¨9330_1p1_öôvÆs.h
"

24 
	~"¨9330_1p2_öôvÆs.h
"

25 
	~"¨955x_1p0_öôvÆs.h
"

26 
	~"¨9580_1p0_öôvÆs.h
"

27 
	~"¨9462_2p0_öôvÆs.h
"

28 
	~"¨9462_2p1_öôvÆs.h
"

29 
	~"¨9565_1p0_öôvÆs.h
"

30 
	~"¨9565_1p1_öôvÆs.h
"

31 
	~"¨953x_öôvÆs.h
"

32 
	~"¨956x_öôvÆs.h
"

41 
	$¨9003_hw_öô_mode_ªgs
(
©h_hw
 *
ah
)

43 i‡(
	`AR_SREV_9330_11
(
ah
)) {

45 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

46 
¨9331_1p1_mac_c‹e
);

47 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

48 
¨9331_1p1_mac_po°ambÀ
);

51 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

52 
¨9331_1p1_ba£b™d_c‹e
);

53 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

54 
¨9331_1p1_ba£b™d_po°ambÀ
);

57 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

58 
¨9331_1p1_ødio_c‹e
);

61 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

62 
¨9331_1p1_soc_¥ómbÀ
);

63 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

64 
¨9331_1p1_soc_po°ambÀ
);

67 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

68 
¨9331_comm⁄_rx_gaö_1p1
);

69 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

70 
¨9331_modes_lowe°_ob_db_tx_gaö_1p1
);

73 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

74 
¨9331_1p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

77 i‡(
ah
->
is_˛k_25mhz
)

78 
	`INIT_INI_ARRAY
(&
ah
->
öiAddôi⁄Æ
,

79 
¨9331_1p1_xèl_25M
);

81 
	`INIT_INI_ARRAY
(&
ah
->
öiAddôi⁄Æ
,

82 
¨9331_1p1_xèl_40M
);

83 } i‡(
	`AR_SREV_9330_12
(
ah
)) {

85 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

86 
¨9331_1p2_mac_c‹e
);

87 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

88 
¨9331_1p2_mac_po°ambÀ
);

91 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

92 
¨9331_1p2_ba£b™d_c‹e
);

93 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

94 
¨9331_1p2_ba£b™d_po°ambÀ
);

97 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

98 
¨9331_1p2_ødio_c‹e
);

101 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

102 
¨9331_1p2_soc_¥ómbÀ
);

103 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

104 
¨9331_1p2_soc_po°ambÀ
);

107 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

108 
¨9331_comm⁄_rx_gaö_1p2
);

109 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

110 
¨9331_modes_lowe°_ob_db_tx_gaö_1p2
);

113 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

114 
¨9331_1p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

117 i‡(
ah
->
is_˛k_25mhz
)

118 
	`INIT_INI_ARRAY
(&
ah
->
öiAddôi⁄Æ
,

119 
¨9331_1p2_xèl_25M
);

121 
	`INIT_INI_ARRAY
(&
ah
->
öiAddôi⁄Æ
,

122 
¨9331_1p2_xèl_40M
);

123 } i‡(
	`AR_SREV_9340
(
ah
)) {

125 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

126 
¨9340_1p0_mac_c‹e
);

127 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

128 
¨9340_1p0_mac_po°ambÀ
);

131 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

132 
¨9340_1p0_ba£b™d_c‹e
);

133 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

134 
¨9340_1p0_ba£b™d_po°ambÀ
);

137 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

138 
¨9340_1p0_ødio_c‹e
);

139 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

140 
¨9340_1p0_ødio_po°ambÀ
);

143 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

144 
¨9340_1p0_soc_¥ómbÀ
);

145 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

146 
¨9340_1p0_soc_po°ambÀ
);

149 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

150 
¨9340Comm⁄_wo_x a_rx_gaö_èbÀ_1p0
);

151 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

152 
¨9340Modes_high_ob_db_tx_gaö_èbÀ_1p0
);

154 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

155 
¨9340Modes_Á°_˛ock_1p0
);

156 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

157 
¨9340_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

158 
	`INIT_INI_ARRAY
(&
ah
->
öi_dfs
,

159 
¨9340_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
);

161 i‡(!
ah
->
is_˛k_25mhz
)

162 
	`INIT_INI_ARRAY
(&
ah
->
öiAddôi⁄Æ
,

163 
¨9340_1p0_ødio_c‹e_40M
);

164 } i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
)) {

166 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

167 
¨9485_1_1_mac_c‹e
);

168 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

169 
¨9485_1_1_mac_po°ambÀ
);

172 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_PRE
], 
¨9485_1_1
);

173 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

174 
¨9485_1_1_ba£b™d_c‹e
);

175 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

176 
¨9485_1_1_ba£b™d_po°ambÀ
);

179 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

180 
¨9485_1_1_ødio_c‹e
);

181 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

182 
¨9485_1_1_ødio_po°ambÀ
);

185 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

186 
¨9485_1_1_soc_¥ómbÀ
);

189 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

190 
¨9485Comm⁄_wo_x a_rx_gaö_1_1
);

191 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

192 
¨9485_modes_lowe°_ob_db_tx_gaö_1_1
);

195 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

196 
¨9485_1_1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

198 i‡(
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) {

199 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

200 
¨9485_1_1_∂l_⁄_cdr_⁄_˛kªq_dißbÀ_L1
);

201 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

202 
¨9485_1_1_∂l_⁄_cdr_⁄_˛kªq_dißbÀ_L1
);

204 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

205 
¨9485_1_1_pcõ_phy_˛kªq_dißbÀ_L1
);

206 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

207 
¨9485_1_1_pcõ_phy_˛kªq_dißbÀ_L1
);

209 } i‡(
	`AR_SREV_9462_21
(
ah
)) {

210 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

211 
¨9462_2p1_mac_c‹e
);

212 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

213 
¨9462_2p1_mac_po°ambÀ
);

214 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

215 
¨9462_2p1_ba£b™d_c‹e
);

216 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

217 
¨9462_2p1_ba£b™d_po°ambÀ
);

218 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

219 
¨9462_2p1_ødio_c‹e
);

220 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

221 
¨9462_2p1_ødio_po°ambÀ
);

222 
	`INIT_INI_ARRAY
(&
ah
->
öi_ødio_po°_sys2™t
,

223 
¨9462_2p1_ødio_po°ambÀ_sys2™t
);

224 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

225 
¨9462_2p1_soc_¥ómbÀ
);

226 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

227 
¨9462_2p1_soc_po°ambÀ
);

228 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

229 
¨9462_2p1_comm⁄_rx_gaö
);

230 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

231 
¨9462_2p1_modes_Á°_˛ock
);

232 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

233 
¨9462_2p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

236 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

237 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D3
)) {

238 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

239 
¨9462_2p1_pcõphy_˛kªq_dißbÀ_L1
);

243 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

244 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D0
)) {

245 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

246 
¨9462_2p1_pcõphy_˛kªq_dißbÀ_L1
);

248 } i‡(
	`AR_SREV_9462_20
(
ah
)) {

250 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
], 
¨9462_2p0_mac_c‹e
);

251 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

252 
¨9462_2p0_mac_po°ambÀ
);

254 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

255 
¨9462_2p0_ba£b™d_c‹e
);

256 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

257 
¨9462_2p0_ba£b™d_po°ambÀ
);

259 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

260 
¨9462_2p0_ødio_c‹e
);

261 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

262 
¨9462_2p0_ødio_po°ambÀ
);

263 
	`INIT_INI_ARRAY
(&
ah
->
öi_ødio_po°_sys2™t
,

264 
¨9462_2p0_ødio_po°ambÀ_sys2™t
);

266 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

267 
¨9462_2p0_soc_¥ómbÀ
);

268 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

269 
¨9462_2p0_soc_po°ambÀ
);

271 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

272 
¨9462_2p0_comm⁄_rx_gaö
);

275 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

276 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D3
)) {

277 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

278 
¨9462_2p0_pcõphy_˛kªq_dißbÀ_L1
);

282 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

283 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D0
)) {

284 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

285 
¨9462_2p0_pcõphy_˛kªq_dißbÀ_L1
);

289 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

290 
¨9462_2p0_modes_Á°_˛ock
);

292 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

293 
¨9462_2p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

294 } i‡(
	`AR_SREV_9550
(
ah
)) {

296 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

297 
¨955x_1p0_mac_c‹e
);

298 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

299 
¨955x_1p0_mac_po°ambÀ
);

302 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

303 
¨955x_1p0_ba£b™d_c‹e
);

304 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

305 
¨955x_1p0_ba£b™d_po°ambÀ
);

308 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

309 
¨955x_1p0_ødio_c‹e
);

310 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

311 
¨955x_1p0_ødio_po°ambÀ
);

314 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

315 
¨955x_1p0_soc_¥ómbÀ
);

316 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

317 
¨955x_1p0_soc_po°ambÀ
);

320 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

321 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

322 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

323 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

324 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

325 
¨955x_1p0_modes_x∑_tx_gaö_èbÀ
);

328 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

329 
¨955x_1p0_modes_Á°_˛ock
);

330 } i‡(
	`AR_SREV_9531
(
ah
)) {

331 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

332 
qˇ953x_1p0_mac_c‹e
);

333 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

334 
qˇ953x_1p0_mac_po°ambÀ
);

335 i‡(
	`AR_SREV_9531_20
(
ah
)) {

336 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

337 
qˇ953x_2p0_ba£b™d_c‹e
);

338 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

339 
qˇ953x_2p0_ba£b™d_po°ambÀ
);

341 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

342 
qˇ953x_1p0_ba£b™d_c‹e
);

343 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

344 
qˇ953x_1p0_ba£b™d_po°ambÀ
);

346 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

347 
qˇ953x_1p0_ødio_c‹e
);

348 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

349 
qˇ953x_1p0_ødio_po°ambÀ
);

350 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

351 
qˇ953x_1p0_soc_¥ómbÀ
);

352 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

353 
qˇ953x_1p0_soc_po°ambÀ
);

355 i‡(
	`AR_SREV_9531_20
(
ah
)) {

356 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

357 
qˇ953x_2p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

358 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

359 
qˇ953x_2p0_comm⁄_wo_x a_rx_gaö_bounds
);

361 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

362 
qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

363 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

364 
qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

367 i‡(
	`AR_SREV_9531_20
(
ah
))

368 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

369 
qˇ953x_2p0_modes_no_x∑_tx_gaö_èbÀ
);

370 i‡(
	`AR_SREV_9531_11
(
ah
))

371 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

372 
qˇ953x_1p1_modes_no_x∑_tx_gaö_èbÀ
);

374 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

375 
qˇ953x_1p0_modes_no_x∑_tx_gaö_èbÀ
);

377 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

378 
qˇ953x_1p0_modes_Á°_˛ock
);

379 } i‡(
	`AR_SREV_9561
(
ah
)) {

380 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

381 
qˇ956x_1p0_mac_c‹e
);

382 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

383 
qˇ956x_1p0_mac_po°ambÀ
);

385 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

386 
qˇ956x_1p0_ba£b™d_c‹e
);

387 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

388 
qˇ956x_1p0_ba£b™d_po°ambÀ
);

390 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

391 
qˇ956x_1p0_ødio_c‹e
);

392 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

393 
qˇ956x_1p0_ødio_po°ambÀ
);

395 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

396 
qˇ956x_1p0_soc_¥ómbÀ
);

397 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

398 
qˇ956x_1p0_soc_po°ambÀ
);

400 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

401 
qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

402 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

403 
qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

404 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

405 
qˇ956x_1p0_modes_no_x∑_tx_gaö_èbÀ
);

407 
	`INIT_INI_ARRAY
(&
ah
->
öi_dfs
,

408 
qˇ956x_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
);

409 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

410 
qˇ956x_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

411 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

412 
qˇ956x_1p0_modes_Á°_˛ock
);

413 } i‡(
	`AR_SREV_9580
(
ah
)) {

415 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

416 
¨9580_1p0_mac_c‹e
);

417 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

418 
¨9580_1p0_mac_po°ambÀ
);

421 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

422 
¨9580_1p0_ba£b™d_c‹e
);

423 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

424 
¨9580_1p0_ba£b™d_po°ambÀ
);

427 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

428 
¨9580_1p0_ødio_c‹e
);

429 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

430 
¨9580_1p0_ødio_po°ambÀ
);

433 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

434 
¨9580_1p0_soc_¥ómbÀ
);

435 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

436 
¨9580_1p0_soc_po°ambÀ
);

439 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

440 
¨9580_1p0_rx_gaö_èbÀ
);

441 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

442 
¨9580_1p0_low_ob_db_tx_gaö_èbÀ
);

444 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

445 
¨9580_1p0_modes_Á°_˛ock
);

446 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

447 
¨9580_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

448 
	`INIT_INI_ARRAY
(&
ah
->
öi_dfs
,

449 
¨9580_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
);

450 } i‡(
	`AR_SREV_9565_11_OR_LATER
(
ah
)) {

451 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

452 
¨9565_1p1_mac_c‹e
);

453 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

454 
¨9565_1p1_mac_po°ambÀ
);

456 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

457 
¨9565_1p1_ba£b™d_c‹e
);

458 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

459 
¨9565_1p1_ba£b™d_po°ambÀ
);

461 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

462 
¨9565_1p1_ødio_c‹e
);

463 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

464 
¨9565_1p1_ødio_po°ambÀ
);

466 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

467 
¨9565_1p1_soc_¥ómbÀ
);

468 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

469 
¨9565_1p1_soc_po°ambÀ
);

471 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

472 
¨9565_1p1_Comm⁄_rx_gaö_èbÀ
);

473 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

474 
¨9565_1p1_Modes_lowe°_ob_db_tx_gaö_èbÀ
);

477 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

478 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D3
)) {

479 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

480 
¨9565_1p1_pcõphy_˛kªq_dißbÀ_L1
);

484 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

485 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D0
)) {

486 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

487 
¨9565_1p1_pcõphy_˛kªq_dißbÀ_L1
);

490 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

491 
¨9565_1p1_modes_Á°_˛ock
);

492 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

493 
¨9565_1p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

494 } i‡(
	`AR_SREV_9565
(
ah
)) {

495 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

496 
¨9565_1p0_mac_c‹e
);

497 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

498 
¨9565_1p0_mac_po°ambÀ
);

500 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

501 
¨9565_1p0_ba£b™d_c‹e
);

502 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

503 
¨9565_1p0_ba£b™d_po°ambÀ
);

505 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

506 
¨9565_1p0_ødio_c‹e
);

507 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

508 
¨9565_1p0_ødio_po°ambÀ
);

510 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

511 
¨9565_1p0_soc_¥ómbÀ
);

512 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

513 
¨9565_1p0_soc_po°ambÀ
);

515 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

516 
¨9565_1p0_Comm⁄_rx_gaö_èbÀ
);

517 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

518 
¨9565_1p0_Modes_lowe°_ob_db_tx_gaö_èbÀ
);

521 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

522 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D3
)) {

523 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

524 
¨9565_1p0_pcõphy_˛kªq_dißbÀ_L1
);

528 i‡((
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_CONTROL
) &&

529 (
ah
->
c⁄fig
.
∂l_pwrßve
 & 
AR_PCIE_PLL_PWRSAVE_ON_D0
)) {

530 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

531 
¨9565_1p0_pcõphy_˛kªq_dißbÀ_L1
);

534 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

535 
¨9565_1p0_modes_Á°_˛ock
);

536 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

537 
¨9565_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

540 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_CORE
],

541 
¨9300_2p2_mac_c‹e
);

542 
	`INIT_INI_ARRAY
(&
ah
->
öiMac
[
ATH_INI_POST
],

543 
¨9300_2p2_mac_po°ambÀ
);

546 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_CORE
],

547 
¨9300_2p2_ba£b™d_c‹e
);

548 
	`INIT_INI_ARRAY
(&
ah
->
öiBB
[
ATH_INI_POST
],

549 
¨9300_2p2_ba£b™d_po°ambÀ
);

552 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_CORE
],

553 
¨9300_2p2_ødio_c‹e
);

554 
	`INIT_INI_ARRAY
(&
ah
->
öiRadio
[
ATH_INI_POST
],

555 
¨9300_2p2_ødio_po°ambÀ
);

558 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_PRE
],

559 
¨9300_2p2_soc_¥ómbÀ
);

560 
	`INIT_INI_ARRAY
(&
ah
->
öiSOC
[
ATH_INI_POST
],

561 
¨9300_2p2_soc_po°ambÀ
);

564 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

565 
¨9300Comm⁄_rx_gaö_èbÀ_2p2
);

566 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

567 
¨9300Modes_lowe°_ob_db_tx_gaö_èbÀ_2p2
);

573 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdes
,

574 
¨9300PcõPhy_∂l_⁄_˛kªq_dißbÀ_L1_2p2
);

578 
	`INIT_INI_ARRAY
(&
ah
->
öiPcõSîdesLowPowî
,

579 
¨9300PcõPhy_∂l_⁄_˛kªq_dißbÀ_L1_2p2
);

582 
	`INIT_INI_ARRAY
(&
ah
->
öiModesFa°Clock
,

583 
¨9300Modes_Á°_˛ock_2p2
);

584 
	`INIT_INI_ARRAY
(&
ah
->
öiCckfúJ≠™2484
,

585 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
);

586 
	`INIT_INI_ARRAY
(&
ah
->
öi_dfs
,

587 
¨9300_2p2_ba£b™d_po°ambÀ_dfs_ch™√l
);

589 
	}
}

591 
	$¨9003_tx_gaö_èbÀ_mode0
(
©h_hw
 *
ah
)

593 i‡(
	`AR_SREV_9330_12
(
ah
))

594 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

595 
¨9331_modes_lowe°_ob_db_tx_gaö_1p2
);

596 i‡(
	`AR_SREV_9330_11
(
ah
))

597 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

598 
¨9331_modes_lowe°_ob_db_tx_gaö_1p1
);

599 i‡(
	`AR_SREV_9340
(
ah
))

600 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

601 
¨9340Modes_lowe°_ob_db_tx_gaö_èbÀ_1p0
);

602 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

603 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

604 
¨9485_modes_lowe°_ob_db_tx_gaö_1_1
);

605 i‡(
	`AR_SREV_9550
(
ah
))

606 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

607 
¨955x_1p0_modes_x∑_tx_gaö_èbÀ
);

608 i‡(
	`AR_SREV_9531_10
(
ah
))

609 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

610 
qˇ953x_1p0_modes_x∑_tx_gaö_èbÀ
);

611 i‡(
	`AR_SREV_9531_11
(
ah
))

612 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

613 
qˇ953x_1p1_modes_x∑_tx_gaö_èbÀ
);

614 i‡(
	`AR_SREV_9531_20
(
ah
))

615 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

616 
qˇ953x_2p0_modes_x∑_tx_gaö_èbÀ
);

617 i‡(
	`AR_SREV_9561
(
ah
))

618 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

619 
qˇ956x_1p0_modes_x∑_tx_gaö_èbÀ
);

620 i‡(
	`AR_SREV_9580
(
ah
))

621 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

622 
¨9580_1p0_lowe°_ob_db_tx_gaö_èbÀ
);

623 i‡(
	`AR_SREV_9462_21
(
ah
))

624 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

625 
¨9462_2p1_modes_low_ob_db_tx_gaö
);

626 i‡(
	`AR_SREV_9462_20
(
ah
))

627 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

628 
¨9462_2p0_modes_low_ob_db_tx_gaö
);

629 i‡(
	`AR_SREV_9565_11
(
ah
))

630 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

631 
¨9565_1p1_modes_low_ob_db_tx_gaö_èbÀ
);

632 i‡(
	`AR_SREV_9565
(
ah
))

633 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

634 
¨9565_1p0_modes_low_ob_db_tx_gaö_èbÀ
);

636 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

637 
¨9300Modes_lowe°_ob_db_tx_gaö_èbÀ_2p2
);

638 
	}
}

640 
	$¨9003_tx_gaö_èbÀ_mode1
(
©h_hw
 *
ah
)

642 i‡(
	`AR_SREV_9330_12
(
ah
))

643 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

644 
¨9331_modes_high_ob_db_tx_gaö_1p2
);

645 i‡(
	`AR_SREV_9330_11
(
ah
))

646 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

647 
¨9331_modes_high_ob_db_tx_gaö_1p1
);

648 i‡(
	`AR_SREV_9340
(
ah
))

649 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

650 
¨9340Modes_high_ob_db_tx_gaö_èbÀ_1p0
);

651 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

652 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

653 
¨9485Modes_high_ob_db_tx_gaö_1_1
);

654 i‡(
	`AR_SREV_9580
(
ah
))

655 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

656 
¨9580_1p0_high_ob_db_tx_gaö_èbÀ
);

657 i‡(
	`AR_SREV_9550
(
ah
))

658 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

659 
¨955x_1p0_modes_no_x∑_tx_gaö_èbÀ
);

660 i‡(
	`AR_SREV_9531
(
ah
)) {

661 i‡(
	`AR_SREV_9531_20
(
ah
))

662 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

663 
qˇ953x_2p0_modes_no_x∑_tx_gaö_èbÀ
);

664 i‡(
	`AR_SREV_9531_11
(
ah
))

665 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

666 
qˇ953x_1p1_modes_no_x∑_tx_gaö_èbÀ
);

668 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

669 
qˇ953x_1p0_modes_no_x∑_tx_gaö_èbÀ
);

670 } i‡(
	`AR_SREV_9561
(
ah
))

671 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

672 
qˇ956x_1p0_modes_no_x∑_tx_gaö_èbÀ
);

673 i‡(
	`AR_SREV_9462_21
(
ah
))

674 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

675 
¨9462_2p1_modes_high_ob_db_tx_gaö
);

676 i‡(
	`AR_SREV_9462_20
(
ah
))

677 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

678 
¨9462_2p0_modes_high_ob_db_tx_gaö
);

679 i‡(
	`AR_SREV_9565_11
(
ah
))

680 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

681 
¨9565_1p1_modes_high_ob_db_tx_gaö_èbÀ
);

682 i‡(
	`AR_SREV_9565
(
ah
))

683 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

684 
¨9565_1p0_modes_high_ob_db_tx_gaö_èbÀ
);

686 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

687 
¨9300Modes_high_ob_db_tx_gaö_èbÀ_2p2
);

688 
	}
}

690 
	$¨9003_tx_gaö_èbÀ_mode2
(
©h_hw
 *
ah
)

692 i‡(
	`AR_SREV_9330_12
(
ah
))

693 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

694 
¨9331_modes_low_ob_db_tx_gaö_1p2
);

695 i‡(
	`AR_SREV_9330_11
(
ah
))

696 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

697 
¨9331_modes_low_ob_db_tx_gaö_1p1
);

698 i‡(
	`AR_SREV_9340
(
ah
))

699 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

700 
¨9340Modes_low_ob_db_tx_gaö_èbÀ_1p0
);

701 i‡(
	`AR_SREV_9531_11
(
ah
))

702 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

703 
qˇ953x_1p1_modes_no_x∑_low_powî_tx_gaö_èbÀ
);

704 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

705 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

706 
¨9485Modes_low_ob_db_tx_gaö_1_1
);

707 i‡(
	`AR_SREV_9580
(
ah
))

708 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

709 
¨9580_1p0_low_ob_db_tx_gaö_èbÀ
);

710 i‡(
	`AR_SREV_9561
(
ah
))

711 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

712 
qˇ956x_1p0_modes_no_x∑_low_ob_db_tx_gaö_èbÀ
);

713 i‡(
	`AR_SREV_9565_11
(
ah
))

714 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

715 
¨9565_1p1_modes_low_ob_db_tx_gaö_èbÀ
);

716 i‡(
	`AR_SREV_9565
(
ah
))

717 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

718 
¨9565_1p0_modes_low_ob_db_tx_gaö_èbÀ
);

720 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

721 
¨9300Modes_low_ob_db_tx_gaö_èbÀ_2p2
);

722 
	}
}

724 
	$¨9003_tx_gaö_èbÀ_mode3
(
©h_hw
 *
ah
)

726 i‡(
	`AR_SREV_9330_12
(
ah
))

727 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

728 
¨9331_modes_high_powî_tx_gaö_1p2
);

729 i‡(
	`AR_SREV_9330_11
(
ah
))

730 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

731 
¨9331_modes_high_powî_tx_gaö_1p1
);

732 i‡(
	`AR_SREV_9340
(
ah
))

733 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

734 
¨9340Modes_high_powî_tx_gaö_èbÀ_1p0
);

735 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

736 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

737 
¨9485Modes_high_powî_tx_gaö_1_1
);

738 i‡(
	`AR_SREV_9580
(
ah
))

739 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

740 
¨9580_1p0_high_powî_tx_gaö_èbÀ
);

741 i‡(
	`AR_SREV_9565_11
(
ah
))

742 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

743 
¨9565_1p1_modes_high_powî_tx_gaö_èbÀ
);

744 i‡(
	`AR_SREV_9565
(
ah
))

745 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

746 
¨9565_1p0_modes_high_powî_tx_gaö_èbÀ
);

748 i‡(
ah
->
c⁄fig
.
tx_gaö_bufÁlo
)

749 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

750 
¨9300Modes_high_powî_tx_gaö_èbÀ_bufÁlo
);

752 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

753 
¨9300Modes_high_powî_tx_gaö_èbÀ_2p2
);

755 
	}
}

757 
	$¨9003_tx_gaö_èbÀ_mode4
(
©h_hw
 *
ah
)

759 i‡(
	`AR_SREV_9340
(
ah
))

760 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

761 
¨9340Modes_mixed_ob_db_tx_gaö_èbÀ_1p0
);

762 i‡(
	`AR_SREV_9580
(
ah
))

763 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

764 
¨9580_1p0_mixed_ob_db_tx_gaö_èbÀ
);

765 i‡(
	`AR_SREV_9462_21
(
ah
))

766 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

767 
¨9462_2p1_modes_mix_ob_db_tx_gaö
);

768 i‡(
	`AR_SREV_9462_20
(
ah
))

769 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

770 
¨9462_2p0_modes_mix_ob_db_tx_gaö
);

772 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

773 
¨9300Modes_mixed_ob_db_tx_gaö_èbÀ_2p2
);

774 
	}
}

776 
	$¨9003_tx_gaö_èbÀ_mode5
(
©h_hw
 *
ah
)

778 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

779 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

780 
¨9485Modes_gªí_ob_db_tx_gaö_1_1
);

781 i‡(
	`AR_SREV_9580
(
ah
))

782 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

783 
¨9580_1p0_ty≥5_tx_gaö_èbÀ
);

784 i‡(
	`AR_SREV_9561
(
ah
))

785 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

786 
qˇ956x_1p0_modes_no_x∑_gªí_tx_gaö_èbÀ
);

787 i‡(
	`AR_SREV_9300_22
(
ah
))

788 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

789 
¨9300Modes_ty≥5_tx_gaö_èbÀ_2p2
);

790 
	}
}

792 
	$¨9003_tx_gaö_èbÀ_mode6
(
©h_hw
 *
ah
)

794 i‡(
	`AR_SREV_9340
(
ah
))

795 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

796 
¨9340Modes_low_ob_db_™d_•ur_tx_gaö_èbÀ_1p0
);

797 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

798 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

799 
¨9485Modes_gªí_•ur_ob_db_tx_gaö_1_1
);

800 i‡(
	`AR_SREV_9580
(
ah
))

801 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

802 
¨9580_1p0_ty≥6_tx_gaö_èbÀ
);

803 
	}
}

805 
	$¨9003_tx_gaö_èbÀ_mode7
(
©h_hw
 *
ah
)

807 i‡(
	`AR_SREV_9340
(
ah
))

808 
	`INIT_INI_ARRAY
(&
ah
->
öiModesTxGaö
,

809 
¨9340_cus227_tx_gaö_èbÀ_1p0
);

810 
	}
}

812 (*
	t©h_txgaö_èb
)(
	t©h_hw
 *
	tah
);

814 
	$¨9003_tx_gaö_èbÀ_≠∂y
(
©h_hw
 *
ah
)

816 c⁄° 
©h_txgaö_èb
 
modes
[] = {

817 
¨9003_tx_gaö_èbÀ_mode0
,

818 
¨9003_tx_gaö_èbÀ_mode1
,

819 
¨9003_tx_gaö_èbÀ_mode2
,

820 
¨9003_tx_gaö_èbÀ_mode3
,

821 
¨9003_tx_gaö_èbÀ_mode4
,

822 
¨9003_tx_gaö_èbÀ_mode5
,

823 
¨9003_tx_gaö_èbÀ_mode6
,

824 
¨9003_tx_gaö_èbÀ_mode7
,

826 
idx
 = 
	`¨9003_hw_gë_tx_gaö_idx
(
ah
);

828 i‡(
idx
 >
	`ARRAY_SIZE
(
modes
))

829 
idx
 = 0;

831 
modes
[
idx
](
ah
);

832 
	}
}

834 
	$¨9003_rx_gaö_èbÀ_mode0
(
©h_hw
 *
ah
)

836 i‡(
	`AR_SREV_9330_12
(
ah
))

837 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

838 
¨9331_comm⁄_rx_gaö_1p2
);

839 i‡(
	`AR_SREV_9330_11
(
ah
))

840 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

841 
¨9331_comm⁄_rx_gaö_1p1
);

842 i‡(
	`AR_SREV_9340
(
ah
))

843 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

844 
¨9340Comm⁄_rx_gaö_èbÀ_1p0
);

845 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

846 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

847 
¨9485_comm⁄_rx_gaö_1_1
);

848 i‡(
	`AR_SREV_9550
(
ah
)) {

849 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

850 
¨955x_1p0_comm⁄_rx_gaö_èbÀ
);

851 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

852 
¨955x_1p0_comm⁄_rx_gaö_bounds
);

853 } i‡(
	`AR_SREV_9531
(
ah
)) {

854 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

855 
qˇ953x_1p0_comm⁄_rx_gaö_èbÀ
);

856 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

857 
qˇ953x_1p0_comm⁄_rx_gaö_bounds
);

858 } i‡(
	`AR_SREV_9561
(
ah
)) {

859 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

860 
qˇ956x_1p0_comm⁄_rx_gaö_èbÀ
);

861 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

862 
qˇ956x_1p0_comm⁄_rx_gaö_bounds
);

863 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

864 
qˇ956x_1p0_x a_⁄ly
);

865 } i‡(
	`AR_SREV_9580
(
ah
))

866 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

867 
¨9580_1p0_rx_gaö_èbÀ
);

868 i‡(
	`AR_SREV_9462_21
(
ah
))

869 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

870 
¨9462_2p1_comm⁄_rx_gaö
);

871 i‡(
	`AR_SREV_9462_20
(
ah
))

872 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

873 
¨9462_2p0_comm⁄_rx_gaö
);

874 i‡(
	`AR_SREV_9565_11
(
ah
))

875 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

876 
¨9565_1p1_Comm⁄_rx_gaö_èbÀ
);

877 i‡(
	`AR_SREV_9565
(
ah
))

878 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

879 
¨9565_1p0_Comm⁄_rx_gaö_èbÀ
);

881 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

882 
¨9300Comm⁄_rx_gaö_èbÀ_2p2
);

883 
	}
}

885 
	$¨9003_rx_gaö_èbÀ_mode1
(
©h_hw
 *
ah
)

887 i‡(
	`AR_SREV_9330_12
(
ah
))

888 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

889 
¨9331_comm⁄_wo_x a_rx_gaö_1p2
);

890 i‡(
	`AR_SREV_9330_11
(
ah
))

891 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

892 
¨9331_comm⁄_wo_x a_rx_gaö_1p1
);

893 i‡(
	`AR_SREV_9340
(
ah
))

894 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

895 
¨9340Comm⁄_wo_x a_rx_gaö_èbÀ_1p0
);

896 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
))

897 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

898 
¨9485Comm⁄_wo_x a_rx_gaö_1_1
);

899 i‡(
	`AR_SREV_9462_21
(
ah
))

900 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

901 
¨9462_2p1_comm⁄_wo_x a_rx_gaö
);

902 i‡(
	`AR_SREV_9462_20
(
ah
))

903 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

904 
¨9462_2p0_comm⁄_wo_x a_rx_gaö
);

905 i‡(
	`AR_SREV_9550
(
ah
)) {

906 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

907 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

908 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

909 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

910 } i‡(
	`AR_SREV_9531_10
(
ah
Ë|| 
	`AR_SREV_9531_11
(ah)) {

911 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

912 
qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

913 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

914 
qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

915 } i‡(
	`AR_SREV_9531_20
(
ah
)) {

916 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

917 
qˇ953x_2p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

918 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

919 
qˇ953x_2p0_comm⁄_wo_x a_rx_gaö_bounds
);

920 } i‡(
	`AR_SREV_9561
(
ah
)) {

921 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

922 
qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

923 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
,

924 
qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_bounds
);

925 } i‡(
	`AR_SREV_9580
(
ah
))

926 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

927 
¨9580_1p0_wo_x a_rx_gaö_èbÀ
);

928 i‡(
	`AR_SREV_9565_11
(
ah
))

929 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

930 
¨9565_1p1_comm⁄_wo_x a_rx_gaö_èbÀ
);

931 i‡(
	`AR_SREV_9565
(
ah
))

932 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

933 
¨9565_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
);

935 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

936 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2
);

937 
	}
}

939 
	$¨9003_rx_gaö_èbÀ_mode2
(
©h_hw
 *
ah
)

941 i‡(
	`AR_SREV_9462_21
(
ah
)) {

942 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

943 
¨9462_2p1_comm⁄_mixed_rx_gaö
);

944 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_c‹e
,

945 
¨9462_2p1_ba£b™d_c‹e_mix_rxgaö
);

946 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_po°ambÀ
,

947 
¨9462_2p1_ba£b™d_po°ambÀ_mix_rxgaö
);

948 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

949 
¨9462_2p1_ba£b™d_po°ambÀ_5g_x a
);

950 } i‡(
	`AR_SREV_9462_20
(
ah
)) {

951 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

952 
¨9462_2p0_comm⁄_mixed_rx_gaö
);

953 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_c‹e
,

954 
¨9462_2p0_ba£b™d_c‹e_mix_rxgaö
);

955 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_po°ambÀ
,

956 
¨9462_2p0_ba£b™d_po°ambÀ_mix_rxgaö
);

957 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

958 
¨9462_2p0_ba£b™d_po°ambÀ_5g_x a
);

960 
	}
}

962 
	$¨9003_rx_gaö_èbÀ_mode3
(
©h_hw
 *
ah
)

964 i‡(
	`AR_SREV_9462_21
(
ah
)) {

965 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

966 
¨9462_2p1_comm⁄_5g_x a_⁄ly_rxgaö
);

967 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

968 
¨9462_2p1_ba£b™d_po°ambÀ_5g_x a
);

969 } i‡(
	`AR_SREV_9462_20
(
ah
)) {

970 
	`INIT_INI_ARRAY
(&
ah
->
öiModesRxGaö
,

971 
¨9462_2p0_comm⁄_5g_x a_⁄ly_rxgaö
);

972 
	`INIT_INI_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

973 
¨9462_2p0_ba£b™d_po°ambÀ_5g_x a
);

975 
	}
}

977 
	$¨9003_rx_gaö_èbÀ_≠∂y
(
©h_hw
 *
ah
)

979 
	`¨9003_hw_gë_rx_gaö_idx
(
ah
)) {

982 
	`¨9003_rx_gaö_èbÀ_mode0
(
ah
);

985 
	`¨9003_rx_gaö_èbÀ_mode1
(
ah
);

988 
	`¨9003_rx_gaö_èbÀ_mode2
(
ah
);

991 
	`¨9003_rx_gaö_èbÀ_mode3
(
ah
);

994 
	}
}

997 
	$¨9003_hw_öô_mode_gaö_ªgs
(
©h_hw
 *
ah
)

999 
	`¨9003_tx_gaö_èbÀ_≠∂y
(
ah
);

1000 
	`¨9003_rx_gaö_èbÀ_≠∂y
(
ah
);

1001 
	}
}

1012 
	$¨9003_hw_c⁄figpcùowîßve
(
©h_hw
 *
ah
,

1013 
boﬁ
 
powî_off
)

1015 
i
;

1016 
¨5416IniAºay
 *
¨øy
;

1023 i‡(
	`AR_SREV_9462
(
ah
)) {

1024 
u32
 
vÆ
 = 
ah
->
c⁄fig
.
a•m_l1_fix
;

1025 i‡((
vÆ
 & 0xff000000) == 0x17000000) {

1026 
vÆ
 &= 0x00ffffff;

1027 
vÆ
 |= 0x27000000;

1028 
	`REG_WRITE
(
ah
, 0x570c, 
vÆ
);

1033 i‡(!
powî_off
 ) {

1035 
	`REG_SET_BIT
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PCIE_PM_CTRL_ENA
);

1036 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

1043 
¨øy
 = 
powî_off
 ? &
ah
->
öiPcõSîdes
 :

1044 &
ah
->
öiPcõSîdesLowPowî
;

1046 
i
 = 0; i < 
¨øy
->
ü_rows
; i++) {

1047 
	`REG_WRITE
(
ah
,

1048 
	`INI_RA
(
¨øy
, 
i
, 0),

1049 
	`INI_RA
(
¨øy
, 
i
, 1));

1051 
	}
}

1053 
	$¨9003_hw_öô_h™g_checks
(
©h_hw
 *
ah
)

1058 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_BB_WATCHDOG
;

1059 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_MAC_HANG
;

1064 i‡(
	`AR_SREV_9300_22
(
ah
))

1065 
ah
->
c⁄fig
.
hw_h™g_checks
 |
HW_PHYRESTART_CLC_WAR
;

1067 i‡(
	`AR_SREV_9330
(
ah
))

1068 
ah
->
bb_w©chdog_timeout_ms
 = 85;

1070 
ah
->
bb_w©chdog_timeout_ms
 = 25;

1071 
	}
}

1096 
	#NUM_STATUS_READS
 50

	)

1098 
boﬁ
 
	$©h9k_hw_vîify_h™g
(
©h_hw
 *
ah
, 
queue
)

1100 
u32
 
dma_dbg_chaö
, 
dma_dbg_com∂ëe
;

1101 
u8
 
dcu_chaö_°©e
, 
dcu_com∂ëe_°©e
;

1102 
i
;

1104 
i
 = 0; i < 
NUM_STATUS_READS
; i++) {

1105 i‡(
queue
 < 6)

1106 
dma_dbg_chaö
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_4
);

1108 
dma_dbg_chaö
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_5
);

1110 
dma_dbg_com∂ëe
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_6
);

1112 
dcu_chaö_°©e
 = (
dma_dbg_chaö
 >> (5 * 
queue
)) & 0x1f;

1113 
dcu_com∂ëe_°©e
 = 
dma_dbg_com∂ëe
 & 0x3;

1115 i‡((
dcu_chaö_°©e
 !0x6Ë|| (
dcu_com∂ëe_°©e
 != 0x1))

1116  
Ál£
;

1119 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
,

1120 "MAC H™g sig«tuª found f‹ queue: %d\n", 
queue
);

1122  
åue
;

1123 
	}
}

1125 
boﬁ
 
	$¨9003_hw_dëe˘_mac_h™g
(
©h_hw
 *
ah
)

1127 
u32
 
dma_dbg_4
, 
dma_dbg_5
, 
dma_dbg_6
, 
chk_dbg
;

1128 
u8
 
dcu_chaö_°©e
, 
dcu_com∂ëe_°©e
;

1129 
boﬁ
 
dcu_waô_‰d⁄e
 = 
Ál£
;

1130 
chk_dcu
 = 0;

1131 
i
 = 0;

1133 
dma_dbg_4
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_4
);

1134 
dma_dbg_5
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_5
);

1135 
dma_dbg_6
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_6
);

1137 
dcu_com∂ëe_°©e
 = 
dma_dbg_6
 & 0x3;

1138 i‡(
dcu_com∂ëe_°©e
 != 0x1)

1139 
exô
;

1141 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++) {

1142 i‡(
i
 < 6)

1143 
chk_dbg
 = 
dma_dbg_4
;

1145 
chk_dbg
 = 
dma_dbg_5
;

1147 
dcu_chaö_°©e
 = (
chk_dbg
 >> (5 * 
i
)) & 0x1f;

1148 i‡(
dcu_chaö_°©e
 == 0x6) {

1149 
dcu_waô_‰d⁄e
 = 
åue
;

1150 
chk_dcu
 |
	`BIT
(
i
);

1154 i‡((
dcu_com∂ëe_°©e
 =0x1Ë&& 
dcu_waô_‰d⁄e
) {

1155 
	`f‹_óch_£t_bô
(
i
, &
chk_dcu
, 
ATH9K_NUM_TX_QUEUES
) {

1156 i‡(
	`©h9k_hw_vîify_h™g
(
ah
, 
i
))

1157  
åue
;

1160 
exô
:

1161  
Ál£
;

1162 
	}
}

1165 
	$¨9003_hw_©èch_›s
(
©h_hw
 *
ah
)

1167 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

1168 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

1170 
	`¨9003_hw_öô_mode_ªgs
(
ah
);

1172 i‡(
	`AR_SREV_9003_PCOEM
(
ah
)) {

1173 
	`WARN_ON
(!
ah
->
öiPcõSîdes
.
ü_¨øy
);

1174 
	`WARN_ON
(!
ah
->
öiPcõSîdesLowPowî
.
ü_¨øy
);

1177 
¥iv_›s
->
öô_mode_gaö_ªgs
 = 
¨9003_hw_öô_mode_gaö_ªgs
;

1178 
¥iv_›s
->
öô_h™g_checks
 = 
¨9003_hw_öô_h™g_checks
;

1179 
¥iv_›s
->
dëe˘_mac_h™g
 = 
¨9003_hw_dëe˘_mac_h™g
;

1181 
›s
->
c⁄fig_pci_powîßve
 = 
¨9003_hw_c⁄figpcùowîßve
;

1183 
	`¨9003_hw_©èch_phy_›s
(
ah
);

1184 
	`¨9003_hw_©èch_ˇlib_›s
(
ah
);

1185 
	`¨9003_hw_©èch_mac_›s
(
ah
);

1186 
	`¨9003_hw_©èch_aic_›s
(
ah
);

1187 
	}
}

	@ar9003_mac.c

16 
	~<löux/exp‹t.h
>

17 
	~"hw.h
"

18 
	~"¨9003_mac.h
"

19 
	~"¨9003_mci.h
"

21 
	$¨9003_hw_rx_íabÀ
(
©h_hw
 *
hw
)

23 
	`REG_WRITE
(
hw
, 
AR_CR
, 0);

24 
	}
}

27 
	$¨9003_£t_txdesc
(
©h_hw
 *
ah
, *
ds
, 
©h_tx_öfo
 *
i
)

29 
¨9003_txc
 *
ads
 = 
ds
;

30 
checksum
 = 0;

31 
u32
 
vÆ
, 
˘l12
, 
˘l17
;

32 
u8
 
desc_Àn
;

34 
desc_Àn
 = ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) ? 0x18 : 0x17);

36 
vÆ
 = (
ATHEROS_VENDOR_ID
 << 
AR_DescId_S
) |

37 (1 << 
AR_TxRxDesc_S
) |

38 (1 << 
AR_CålSèt_S
) |

39 (
i
->
qcu
 << 
AR_TxQcuNum_S
Ë| 
desc_Àn
;

41 
checksum
 +
vÆ
;

42 
	`ACCESS_ONCE
(
ads
->
öfo
Ë
vÆ
;

44 
checksum
 +
i
->
lök
;

45 
	`ACCESS_ONCE
(
ads
->
lök
Ë
i
->link;

47 
checksum
 +
i
->
buf_addr
[0];

48 
	`ACCESS_ONCE
(
ads
->
d©a0
Ë
i
->
buf_addr
[0];

49 
checksum
 +
i
->
buf_addr
[1];

50 
	`ACCESS_ONCE
(
ads
->
d©a1
Ë
i
->
buf_addr
[1];

51 
checksum
 +
i
->
buf_addr
[2];

52 
	`ACCESS_ONCE
(
ads
->
d©a2
Ë
i
->
buf_addr
[2];

53 
checksum
 +
i
->
buf_addr
[3];

54 
	`ACCESS_ONCE
(
ads
->
d©a3
Ë
i
->
buf_addr
[3];

56 
checksum
 +(
vÆ
 = (
i
->
buf_Àn
[0] << 
AR_BufLí_S
Ë& 
AR_BufLí
);

57 
	`ACCESS_ONCE
(
ads
->
˘l3
Ë
vÆ
;

58 
checksum
 +(
vÆ
 = (
i
->
buf_Àn
[1] << 
AR_BufLí_S
Ë& 
AR_BufLí
);

59 
	`ACCESS_ONCE
(
ads
->
˘l5
Ë
vÆ
;

60 
checksum
 +(
vÆ
 = (
i
->
buf_Àn
[2] << 
AR_BufLí_S
Ë& 
AR_BufLí
);

61 
	`ACCESS_ONCE
(
ads
->
˘l7
Ë
vÆ
;

62 
checksum
 +(
vÆ
 = (
i
->
buf_Àn
[3] << 
AR_BufLí_S
Ë& 
AR_BufLí
);

63 
	`ACCESS_ONCE
(
ads
->
˘l9
Ë
vÆ
;

65 
checksum
 = (
u16
) (((checksum & 0xffff) + (checksum >> 16)) & 0xffff);

66 
	`ACCESS_ONCE
(
ads
->
˘l10
Ë
checksum
;

68 i‡(
i
->
is_fú°
 || i->
is_œ°
) {

69 
	`ACCESS_ONCE
(
ads
->
˘l13
Ë
	`£t11nTrõs
(
i
->
øãs
, 0)

70 | 
	`£t11nTrõs
(
i
->
øãs
, 1)

71 | 
	`£t11nTrõs
(
i
->
øãs
, 2)

72 | 
	`£t11nTrõs
(
i
->
øãs
, 3)

73 | (
i
->
dur_upd©e
 ? 
AR_DurUpd©eE«
 : 0)

74 | 
	`SM
(0, 
AR_Bur°Dur
);

76 
	`ACCESS_ONCE
(
ads
->
˘l14
Ë
	`£t11nR©e
(
i
->
øãs
, 0)

77 | 
	`£t11nR©e
(
i
->
øãs
, 1)

78 | 
	`£t11nR©e
(
i
->
øãs
, 2)

79 | 
	`£t11nR©e
(
i
->
øãs
, 3);

81 
	`ACCESS_ONCE
(
ads
->
˘l13
) = 0;

82 
	`ACCESS_ONCE
(
ads
->
˘l14
) = 0;

85 
ads
->
˘l20
 = 0;

86 
ads
->
˘l21
 = 0;

87 
ads
->
˘l22
 = 0;

88 
ads
->
˘l23
 = 0;

90 
˘l17
 = 
	`SM
(
i
->
keyty≥
, 
AR_En¸Ty≥
);

91 i‡(!
i
->
is_fú°
) {

92 
	`ACCESS_ONCE
(
ads
->
˘l11
) = 0;

93 
	`ACCESS_ONCE
(
ads
->
˘l12
Ë
i
->
is_œ°
 ? 0 : 
AR_TxM‹e
;

94 
	`ACCESS_ONCE
(
ads
->
˘l15
) = 0;

95 
	`ACCESS_ONCE
(
ads
->
˘l16
) = 0;

96 
	`ACCESS_ONCE
(
ads
->
˘l17
) = ctl17;

97 
	`ACCESS_ONCE
(
ads
->
˘l18
) = 0;

98 
	`ACCESS_ONCE
(
ads
->
˘l19
) = 0;

102 
	`ACCESS_ONCE
(
ads
->
˘l11
Ë(
i
->
pkt_Àn
 & 
AR_FømeLí
)

103 | (
i
->
Êags
 & 
ATH9K_TXDESC_VMF
 ? 
AR_VútM‹eFøg
 : 0)

104 | 
	`SM
(
i
->
txpowî
[0], 
AR_XmôPowî0
)

105 | (
i
->
Êags
 & 
ATH9K_TXDESC_VEOL
 ? 
AR_VEOL
 : 0)

106 | (
i
->
keyix
 !
ATH9K_TXKEYIX_INVALID
 ? 
AR_De°IdxVÆid
 : 0)

107 | (
i
->
Êags
 & 
ATH9K_TXDESC_LOWRXCHAIN
 ? 
AR_LowRxChaö
 : 0)

108 | (
i
->
Êags
 & 
ATH9K_TXDESC_CLRDMASK
 ? 
AR_CÃDe°Mask
 : 0)

109 | (
i
->
Êags
 & 
ATH9K_TXDESC_RTSENA
 ? 
AR_RTSE«bÀ
 :

110 (
i
->
Êags
 & 
ATH9K_TXDESC_CTSENA
 ? 
AR_CTSE«bÀ
 : 0));

112 
˘l12
 = (
i
->
keyix
 !
ATH9K_TXKEYIX_INVALID
 ?

113 
	`SM
(
i
->
keyix
, 
AR_De°Idx
) : 0)

114 | 
	`SM
(
i
->
ty≥
, 
AR_FømeTy≥
)

115 | (
i
->
Êags
 & 
ATH9K_TXDESC_NOACK
 ? 
AR_NoAck
 : 0)

116 | (
i
->
Êags
 & 
ATH9K_TXDESC_EXT_ONLY
 ? 
AR_ExtO∆y
 : 0)

117 | (
i
->
Êags
 & 
ATH9K_TXDESC_EXT_AND_CTL
 ? 
AR_ExtAndCé
 : 0);

119 
˘l17
 |(
i
->
Êags
 & 
ATH9K_TXDESC_LDPC
 ? 
AR_LDPC
 : 0);

120 
i
->
aggr
) {

121 
AGGR_BUF_FIRST
:

122 
˘l17
 |
	`SM
(
i
->
aggr_Àn
, 
AR_AggrLí
);

124 
AGGR_BUF_MIDDLE
:

125 
˘l12
 |
AR_IsAggr
 | 
AR_M‹eAggr
;

126 
˘l17
 |
	`SM
(
i
->
ndñim
, 
AR_PadDñim
);

128 
AGGR_BUF_LAST
:

129 
˘l12
 |
AR_IsAggr
;

131 
AGGR_BUF_NONE
:

135 
vÆ
 = (
i
->
Êags
 & 
ATH9K_TXDESC_PAPRD
Ë>> 
ATH9K_TXDESC_PAPRD_S
;

136 
˘l12
 |
	`SM
(
vÆ
, 
AR_PAPRDChaöMask
);

138 
	`ACCESS_ONCE
(
ads
->
˘l12
) = ctl12;

139 
	`ACCESS_ONCE
(
ads
->
˘l17
) = ctl17;

141 
	`ACCESS_ONCE
(
ads
->
˘l15
Ë
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 0)

142 | 
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 1);

144 
	`ACCESS_ONCE
(
ads
->
˘l16
Ë
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 2)

145 | 
	`£t11nPktDurRTSCTS
(
i
->
øãs
, 3);

147 
	`ACCESS_ONCE
(
ads
->
˘l18
Ë
	`£t11nR©eFœgs
(
i
->
øãs
, 0)

148 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 1)

149 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 2)

150 | 
	`£t11nR©eFœgs
(
i
->
øãs
, 3)

151 | 
	`SM
(
i
->
πs˘s_øã
, 
AR_RTSCTSR©e
);

153 
	`ACCESS_ONCE
(
ads
->
˘l19
Ë
AR_NŸ_Soundög
;

155 
	`ACCESS_ONCE
(
ads
->
˘l20
Ë
	`SM
(
i
->
txpowî
[1], 
AR_XmôPowî1
);

156 
	`ACCESS_ONCE
(
ads
->
˘l21
Ë
	`SM
(
i
->
txpowî
[2], 
AR_XmôPowî2
);

157 
	`ACCESS_ONCE
(
ads
->
˘l22
Ë
	`SM
(
i
->
txpowî
[3], 
AR_XmôPowî3
);

158 
	}
}

160 
u16
 
	$¨9003_ˇlc_±r_chksum
(
¨9003_txc
 *
ads
)

162 
checksum
;

164 
checksum
 = 
ads
->
öfo
 +áds->
lök


165 + 
ads
->
d©a0
 +áds->
˘l3


166 + 
ads
->
d©a1
 +áds->
˘l5


167 + 
ads
->
d©a2
 +áds->
˘l7


168 + 
ads
->
d©a3
 +áds->
˘l9
;

170  ((
checksum
 & 0xffffË+ (checksum >> 16)Ë& 
AR_TxPåChkSum
;

171 
	}
}

173 
	$¨9003_hw_£t_desc_lök
(*
ds
, 
u32
 
ds_lök
)

175 
¨9003_txc
 *
ads
 = 
ds
;

177 
ads
->
lök
 = 
ds_lök
;

178 
ads
->
˘l10
 &~
AR_TxPåChkSum
;

179 
ads
->
˘l10
 |
	`¨9003_ˇlc_±r_chksum
(ads);

180 
	}
}

182 
boﬁ
 
	$¨9003_hw_gë_i§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
,

183 
u32
 *
sync_ˇu£_p
)

185 
u32
 
i§
 = 0;

186 
u32
 
mask2
 = 0;

187 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

188 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

189 
u32
 
sync_ˇu£
 = 0, 
async_ˇu£
, 
async_mask
 = 
AR_INTR_MAC_IRQ
;

190 
boﬁ
 
Áèl_öt
;

192 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

193 
async_mask
 |
AR_INTR_ASYNC_MASK_MCI
;

195 
async_ˇu£
 = 
	`REG_READ
(
ah
, 
AR_INTR_ASYNC_CAUSE
);

197 i‡(
async_ˇu£
 & 
async_mask
) {

198 i‡((
	`REG_READ
(
ah
, 
AR_RTC_STATUS
Ë& 
AR_RTC_STATUS_M
)

199 =
AR_RTC_STATUS_ON
)

200 
i§
 = 
	`REG_READ
(
ah
, 
AR_ISR
);

204 
sync_ˇu£
 = 
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE
Ë& 
AR_INTR_SYNC_DEFAULT
;

206 *
masked
 = 0;

208 i‡(!
i§
 && !
sync_ˇu£
 && !
async_ˇu£
)

209  
Ál£
;

211 i‡(
i§
) {

212 i‡(
i§
 & 
AR_ISR_BCNMISC
) {

213 
u32
 
i§2
;

214 
i§2
 = 
	`REG_READ
(
ah
, 
AR_ISR_S2
);

216 
mask2
 |((
i§2
 & 
AR_ISR_S2_TIM
) >>

217 
MAP_ISR_S2_TIM
);

218 
mask2
 |((
i§2
 & 
AR_ISR_S2_DTIM
) >>

219 
MAP_ISR_S2_DTIM
);

220 
mask2
 |((
i§2
 & 
AR_ISR_S2_DTIMSYNC
) >>

221 
MAP_ISR_S2_DTIMSYNC
);

222 
mask2
 |((
i§2
 & 
AR_ISR_S2_CABEND
) >>

223 
MAP_ISR_S2_CABEND
);

224 
mask2
 |((
i§2
 & 
AR_ISR_S2_GTT
) <<

225 
MAP_ISR_S2_GTT
);

226 
mask2
 |((
i§2
 & 
AR_ISR_S2_CST
) <<

227 
MAP_ISR_S2_CST
);

228 
mask2
 |((
i§2
 & 
AR_ISR_S2_TSFOOR
) >>

229 
MAP_ISR_S2_TSFOOR
);

230 
mask2
 |((
i§2
 & 
AR_ISR_S2_BB_WATCHDOG
) >>

231 
MAP_ISR_S2_BB_WATCHDOG
);

233 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

234 
	`REG_WRITE
(
ah
, 
AR_ISR_S2
, 
i§2
);

235 
i§
 &~
AR_ISR_BCNMISC
;

239 i‡((
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
))

240 
i§
 = 
	`REG_READ
(
ah
, 
AR_ISR_RAC
);

242 i‡(
i§
 == 0xffffffff) {

243 *
masked
 = 0;

244  
Ál£
;

247 *
masked
 = 
i§
 & 
ATH9K_INT_COMMON
;

249 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
)

250 i‡(
i§
 & (
AR_ISR_RXMINTR
 | 
AR_ISR_RXINTM
))

251 *
masked
 |
ATH9K_INT_RXLP
;

253 i‡(
ah
->
c⁄fig
.
tx_öå_môig©i⁄
)

254 i‡(
i§
 & (
AR_ISR_TXMINTR
 | 
AR_ISR_TXINTM
))

255 *
masked
 |
ATH9K_INT_TX
;

257 i‡(
i§
 & (
AR_ISR_LP_RXOK
 | 
AR_ISR_RXERR
))

258 *
masked
 |
ATH9K_INT_RXLP
;

260 i‡(
i§
 & 
AR_ISR_HP_RXOK
)

261 *
masked
 |
ATH9K_INT_RXHP
;

263 i‡(
i§
 & (
AR_ISR_TXOK
 | 
AR_ISR_TXERR
 | 
AR_ISR_TXEOL
)) {

264 *
masked
 |
ATH9K_INT_TX
;

266 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

267 
u32
 
s0
, 
s1
;

268 
s0
 = 
	`REG_READ
(
ah
, 
AR_ISR_S0
);

269 
	`REG_WRITE
(
ah
, 
AR_ISR_S0
, 
s0
);

270 
s1
 = 
	`REG_READ
(
ah
, 
AR_ISR_S1
);

271 
	`REG_WRITE
(
ah
, 
AR_ISR_S1
, 
s1
);

273 
i§
 &~(
AR_ISR_TXOK
 | 
AR_ISR_TXERR
 |

274 
AR_ISR_TXEOL
);

278 i‡(
i§
 & 
AR_ISR_GENTMR
) {

279 
u32
 
s5
;

281 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)

282 
s5
 = 
	`REG_READ
(
ah
, 
AR_ISR_S5_S
);

284 
s5
 = 
	`REG_READ
(
ah
, 
AR_ISR_S5
);

286 
ah
->
öå_gí_timî_åiggî
 =

287 
	`MS
(
s5
, 
AR_ISR_S5_GENTIMER_TRIG
);

289 
ah
->
öå_gí_timî_thªsh
 =

290 
	`MS
(
s5
, 
AR_ISR_S5_GENTIMER_THRESH
);

292 i‡(
ah
->
öå_gí_timî_åiggî
)

293 *
masked
 |
ATH9K_INT_GENTIMER
;

295 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

296 
	`REG_WRITE
(
ah
, 
AR_ISR_S5
, 
s5
);

297 
i§
 &~
AR_ISR_GENTMR
;

302 *
masked
 |
mask2
;

304 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_RAC_SUPPORTED
)) {

305 
	`REG_WRITE
(
ah
, 
AR_ISR
, 
i§
);

307 (Ë
	`REG_READ
(
ah
, 
AR_ISR
);

310 i‡(*
masked
 & 
ATH9K_INT_BB_WATCHDOG
)

311 
	`¨9003_hw_bb_w©chdog_ªad
(
ah
);

314 i‡(
async_ˇu£
 & 
AR_INTR_ASYNC_MASK_MCI
)

315 
	`¨9003_mci_gë_i§
(
ah
, 
masked
);

317 i‡(
sync_ˇu£
) {

318 i‡(
sync_ˇu£_p
)

319 *
sync_ˇu£_p
 = 
sync_ˇu£
;

320 
Áèl_öt
 =

321 (
sync_ˇu£
 &

322 (
AR_INTR_SYNC_HOST1_FATAL
 | 
AR_INTR_SYNC_HOST1_PERR
))

323 ? 
åue
 : 
Ál£
;

325 i‡(
Áèl_öt
) {

326 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_FATAL
) {

327 
	`©h_dbg
(
comm⁄
, 
ANY
,

330 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_PERR
) {

331 
	`©h_dbg
(
comm⁄
, 
ANY
,

334 *
masked
 |
ATH9K_INT_FATAL
;

337 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_TIMEOUT
) {

338 
	`REG_WRITE
(
ah
, 
AR_RC
, 
AR_RC_HOSTIF
);

339 
	`REG_WRITE
(
ah
, 
AR_RC
, 0);

340 *
masked
 |
ATH9K_INT_FATAL
;

343 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_LOCAL_TIMEOUT
)

344 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
,

347 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_CAUSE_CLR
, 
sync_ˇu£
);

348 (Ë
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE_CLR
);

351  
åue
;

352 
	}
}

354 
	$¨9003_hw_¥oc_txdesc
(
©h_hw
 *
ah
, *
ds
,

355 
©h_tx_°©us
 *
ts
)

357 
¨9003_txs
 *
ads
;

358 
u32
 
°©us
;

360 
ads
 = &
ah
->
ts_rög
[ah->
ts_èû
];

362 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
°©us8
);

363 i‡((
°©us
 & 
AR_TxD⁄e
) == 0)

364  -
EINPROGRESS
;

366 
ah
->
ts_èû
 = (ah->ts_èû + 1Ë%áh->
ts_size
;

368 i‡((
	`MS
(
ads
->
ds_öfo
, 
AR_DescId
Ë!
ATHEROS_VENDOR_ID
) ||

369 (
	`MS
(
ads
->
ds_öfo
, 
AR_TxRxDesc
) != 1)) {

370 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
XMIT
,

371 "Tx Des¸ùt‹Éº‹ %x\n", 
ads
->
ds_öfo
);

372 
	`mem£t
(
ads
, 0, (*ads));

373  -
EIO
;

376 
ts
->
ts_øãödex
 = 
	`MS
(
°©us
, 
AR_FöÆTxIdx
);

377 
ts
->
ts_£qnum
 = 
	`MS
(
°©us
, 
AR_SeqNum
);

378 
ts
->
tid
 = 
	`MS
(
°©us
, 
AR_TxTid
);

380 
ts
->
qid
 = 
	`MS
(
ads
->
ds_öfo
, 
AR_TxQcuNum
);

381 
ts
->
desc_id
 = 
	`MS
(
ads
->
°©us1
, 
AR_TxDescId
);

382 
ts
->
ts_t°amp
 = 
ads
->
°©us4
;

383 
ts
->
ts_°©us
 = 0;

384 
ts
->
ts_Êags
 = 0;

386 i‡(
°©us
 & 
AR_TxOpEx˚eded
)

387 
ts
->
ts_°©us
 |
ATH9K_TXERR_XTXOP
;

388 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
°©us2
);

389 
ts
->
ts_rssi_˘l0
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡00
);

390 
ts
->
ts_rssi_˘l1
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡01
);

391 
ts
->
ts_rssi_˘l2
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡02
);

392 i‡(
°©us
 & 
AR_TxBaSètus
) {

393 
ts
->
ts_Êags
 |
ATH9K_TX_BA
;

394 
ts
->
ba_low
 = 
ads
->
°©us5
;

395 
ts
->
ba_high
 = 
ads
->
°©us6
;

398 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
°©us3
);

399 i‡(
°©us
 & 
AR_Ex˚ssiveRërõs
)

400 
ts
->
ts_°©us
 |
ATH9K_TXERR_XRETRY
;

401 i‡(
°©us
 & 
AR_Fûãªd
)

402 
ts
->
ts_°©us
 |
ATH9K_TXERR_FILT
;

403 i‡(
°©us
 & 
AR_FIFOUndîrun
) {

404 
ts
->
ts_°©us
 |
ATH9K_TXERR_FIFO
;

405 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

407 i‡(
°©us
 & 
AR_TxTimîExpúed
)

408 
ts
->
ts_°©us
 |
ATH9K_TXERR_TIMER_EXPIRED
;

409 i‡(
°©us
 & 
AR_DescCfgEº
)

410 
ts
->
ts_Êags
 |
ATH9K_TX_DESC_CFG_ERR
;

411 i‡(
°©us
 & 
AR_TxD©aUndîrun
) {

412 
ts
->
ts_Êags
 |
ATH9K_TX_DATA_UNDERRUN
;

413 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

415 i‡(
°©us
 & 
AR_TxDñimUndîrun
) {

416 
ts
->
ts_Êags
 |
ATH9K_TX_DELIM_UNDERRUN
;

417 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

419 
ts
->
ts_sh‹åëry
 = 
	`MS
(
°©us
, 
AR_RTSFaûC¡
);

420 
ts
->
ts_l⁄gªåy
 = 
	`MS
(
°©us
, 
AR_D©aFaûC¡
);

421 
ts
->
ts_vútcﬁ
 = 
	`MS
(
°©us
, 
AR_VútRëryC¡
);

423 
°©us
 = 
	`ACCESS_ONCE
(
ads
->
°©us7
);

424 
ts
->
ts_rssi
 = 
	`MS
(
°©us
, 
AR_TxRSSIComböed
);

425 
ts
->
ts_rssi_ext0
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡10
);

426 
ts
->
ts_rssi_ext1
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡11
);

427 
ts
->
ts_rssi_ext2
 = 
	`MS
(
°©us
, 
AR_TxRSSIA¡12
);

429 
	`mem£t
(
ads
, 0, (*ads));

432 
	}
}

434 
	$¨9003_hw_gë_duøti⁄
(
©h_hw
 *
ah
, c⁄° *
ds
, 
ödex
)

436 c⁄° 
¨9003_txc
 *
adc
 = 
ds
;

438 
ödex
) {

440  
	`MS
(
	`ACCESS_ONCE
(
adc
->
˘l15
), 
AR_PackëDur0
);

442  
	`MS
(
	`ACCESS_ONCE
(
adc
->
˘l15
), 
AR_PackëDur1
);

444  
	`MS
(
	`ACCESS_ONCE
(
adc
->
˘l16
), 
AR_PackëDur2
);

446  
	`MS
(
	`ACCESS_ONCE
(
adc
->
˘l16
), 
AR_PackëDur3
);

450 
	}
}

452 
	$¨9003_hw_©èch_mac_›s
(
©h_hw
 *
hw
)

454 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
hw
);

456 
›s
->
rx_íabÀ
 = 
¨9003_hw_rx_íabÀ
;

457 
›s
->
£t_desc_lök
 = 
¨9003_hw_£t_desc_lök
;

458 
›s
->
gë_i§
 = 
¨9003_hw_gë_i§
;

459 
›s
->
£t_txdesc
 = 
¨9003_£t_txdesc
;

460 
›s
->
¥oc_txdesc
 = 
¨9003_hw_¥oc_txdesc
;

461 
›s
->
gë_duøti⁄
 = 
¨9003_hw_gë_duøti⁄
;

462 
	}
}

464 
	$©h9k_hw_£t_rx_bufsize
(
©h_hw
 *
ah
, 
u16
 
buf_size
)

466 
	`REG_WRITE
(
ah
, 
AR_DATABUF_SIZE
, 
buf_size
 & 
AR_DATABUF_SIZE_MASK
);

467 
	}
}

468 
EXPORT_SYMBOL
(
©h9k_hw_£t_rx_bufsize
);

470 
	$©h9k_hw_addrxbuf_edma
(
©h_hw
 *
ah
, 
u32
 
rxdp
,

471 
©h9k_rx_qty≥
 
qty≥
)

473 i‡(
qty≥
 =
ATH9K_RX_QUEUE_HP
)

474 
	`REG_WRITE
(
ah
, 
AR_HP_RXDP
, 
rxdp
);

476 
	`REG_WRITE
(
ah
, 
AR_LP_RXDP
, 
rxdp
);

477 
	}
}

478 
EXPORT_SYMBOL
(
©h9k_hw_addrxbuf_edma
);

480 
	$©h9k_hw_¥o˚ss_rxdesc_edma
(
©h_hw
 *
ah
, 
©h_rx_°©us
 *
rxs
,

481 *
buf_addr
)

483 
¨9003_rxs
 *
rx•
 = (¨9003_rx†*Ë
buf_addr
;

484 
phyîr
;

486 i‡((
rx•
->
°©us11
 & 
AR_RxD⁄e
) == 0)

487  -
EINPROGRESS
;

489 i‡(
	`MS
(
rx•
->
ds_öfo
, 
AR_DescId
) != 0x168c)

490  -
EINVAL
;

492 i‡((
rx•
->
ds_öfo
 & (
AR_TxRxDesc
 | 
AR_CålSèt
)) != 0)

493  -
EINPROGRESS
;

495 
rxs
->
rs_°©us
 = 0;

496 
rxs
->
rs_Êags
 = 0;

497 
rxs
->
Êag
 = 0;

499 
rxs
->
rs_d©Æí
 = 
rx•
->
°©us2
 & 
AR_D©aLí
;

500 
rxs
->
rs_t°amp
 = 
rx•
->
°©us3
;

503 
rxs
->
rs_rssi
 = 
	`MS
(
rx•
->
°©us5
, 
AR_RxRSSIComböed
);

504 
rxs
->
rs_rssi_˘l
[0] = 
	`MS
(
rx•
->
°©us1
, 
AR_RxRSSIA¡00
);

505 
rxs
->
rs_rssi_˘l
[1] = 
	`MS
(
rx•
->
°©us1
, 
AR_RxRSSIA¡01
);

506 
rxs
->
rs_rssi_˘l
[2] = 
	`MS
(
rx•
->
°©us1
, 
AR_RxRSSIA¡02
);

507 
rxs
->
rs_rssi_ext
[0] = 
	`MS
(
rx•
->
°©us5
, 
AR_RxRSSIA¡10
);

508 
rxs
->
rs_rssi_ext
[1] = 
	`MS
(
rx•
->
°©us5
, 
AR_RxRSSIA¡11
);

509 
rxs
->
rs_rssi_ext
[2] = 
	`MS
(
rx•
->
°©us5
, 
AR_RxRSSIA¡12
);

511 i‡(
rx•
->
°©us11
 & 
AR_RxKeyIdxVÆid
)

512 
rxs
->
rs_keyix
 = 
	`MS
(
rx•
->
°©us11
, 
AR_KeyIdx
);

514 
rxs
->
rs_keyix
 = 
ATH9K_RXKEYIX_INVALID
;

516 
rxs
->
rs_øã
 = 
	`MS
(
rx•
->
°©us1
, 
AR_RxR©e
);

517 
rxs
->
rs_m‹e
 = (
rx•
->
°©us2
 & 
AR_RxM‹e
) ? 1 : 0;

519 
rxs
->
rs_fú°aggr
 = (
rx•
->
°©us11
 & 
AR_RxFú°Aggr
) ? 1 : 0;

520 
rxs
->
rs_ißggr
 = (
rx•
->
°©us11
 & 
AR_RxAggr
) ? 1 : 0;

521 
rxs
->
rs_m‹óggr
 = (
rx•
->
°©us11
 & 
AR_RxM‹eAggr
) ? 1 : 0;

522 
rxs
->
rs_™ã¬a
 = (
	`MS
(
rx•
->
°©us4
, 
AR_RxA¡í«
) & 0x7);

523 
rxs
->
Êag
 |(
rx•
->
°©us4
 & 
AR_GI
Ë? 
RX_FLAG_SHORT_GI
 : 0;

524 
rxs
->
Êag
 |(
rx•
->
°©us4
 & 
AR_2040
Ë? 
RX_FLAG_40MHZ
 : 0;

526 
rxs
->
evm0
 = 
rx•
->
°©us6
;

527 
rxs
->
evm1
 = 
rx•
->
°©us7
;

528 
rxs
->
evm2
 = 
rx•
->
°©us8
;

529 
rxs
->
evm3
 = 
rx•
->
°©us9
;

530 
rxs
->
evm4
 = (
rx•
->
°©us10
 & 0xffff);

532 i‡(
rx•
->
°©us11
 & 
AR_PªDñimCRCEº
)

533 
rxs
->
rs_Êags
 |
ATH9K_RX_DELIM_CRC_PRE
;

535 i‡(
rx•
->
°©us11
 & 
AR_Po°DñimCRCEº
)

536 
rxs
->
rs_Êags
 |
ATH9K_RX_DELIM_CRC_POST
;

538 i‡(
rx•
->
°©us11
 & 
AR_De¸y±BusyEº
)

539 
rxs
->
rs_Êags
 |
ATH9K_RX_DECRYPT_BUSY
;

541 i‡((
rx•
->
°©us11
 & 
AR_RxFømeOK
) == 0) {

550 i‡(
rx•
->
°©us11
 & 
AR_CRCEº
)

551 
rxs
->
rs_°©us
 |
ATH9K_RXERR_CRC
;

552 i‡(
rx•
->
°©us11
 & 
AR_De¸y±CRCEº
)

553 
rxs
->
rs_°©us
 |
ATH9K_RXERR_DECRYPT
;

554 i‡(
rx•
->
°©us11
 & 
AR_Mich´lEº
)

555 
rxs
->
rs_°©us
 |
ATH9K_RXERR_MIC
;

556 i‡(
rx•
->
°©us11
 & 
AR_PHYEº
) {

557 
phyîr
 = 
	`MS
(
rx•
->
°©us11
, 
AR_PHYEºCode
);

571 i‡((
phyîr
 =
ATH9K_PHYERR_OFDM_RESTART
) &&

572 (
rx•
->
°©us11
 & 
AR_Po°DñimCRCEº
)) {

573 
rxs
->
rs_phyîr
 = 0;

575 
rxs
->
rs_°©us
 |
ATH9K_RXERR_PHY
;

576 
rxs
->
rs_phyîr
 = 
phyîr
;

581 i‡(
rx•
->
°©us11
 & 
AR_KeyMiss
)

582 
rxs
->
rs_°©us
 |
ATH9K_RXERR_KEYMISS
;

585 
	}
}

586 
EXPORT_SYMBOL
(
©h9k_hw_¥o˚ss_rxdesc_edma
);

588 
	$©h9k_hw_ª£t_tx°©us_rög
(
©h_hw
 *
ah
)

590 
ah
->
ts_èû
 = 0;

592 
	`mem£t
((*Ë
ah
->
ts_rög
, 0,

593 
ah
->
ts_size
 * (
¨9003_txs
));

595 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
XMIT
,

597 
ah
->
ts_∑ddr_°¨t
,áh->
ts_∑ddr_íd
,

598 
ah
->
ts_rög
,áh->
ts_size
);

600 
	`REG_WRITE
(
ah
, 
AR_Q_STATUS_RING_START
,áh->
ts_∑ddr_°¨t
);

601 
	`REG_WRITE
(
ah
, 
AR_Q_STATUS_RING_END
,áh->
ts_∑ddr_íd
);

602 
	}
}

604 
	$©h9k_hw_£tup_°©u§ög
(
©h_hw
 *
ah
, *
ts_°¨t
,

605 
u32
 
ts_∑ddr_°¨t
,

606 
u16
 
size
)

609 
ah
->
ts_∑ddr_°¨t
 =Ås_paddr_start;

610 
ah
->
ts_∑ddr_íd
 = 
ts_∑ddr_°¨t
 + (
size
 * (
¨9003_txs
));

611 
ah
->
ts_size
 = 
size
;

612 
ah
->
ts_rög
 = (
¨9003_txs
 *Ë
ts_°¨t
;

614 
	`©h9k_hw_ª£t_tx°©us_rög
(
ah
);

615 
	}
}

616 
EXPORT_SYMBOL
(
©h9k_hw_£tup_°©u§ög
);

	@ar9003_mac.h

17 #i‚de‡
AR9003_MAC_H


18 
	#AR9003_MAC_H


	)

20 
	#AR_DescId
 0xffff0000

	)

21 
	#AR_DescId_S
 16

	)

22 
	#AR_CålSèt
 0x00004000

	)

23 
	#AR_CålSèt_S
 14

	)

24 
	#AR_TxRxDesc
 0x00008000

	)

25 
	#AR_TxRxDesc_S
 15

	)

26 
	#AR_TxQcuNum
 0x00000f00

	)

27 
	#AR_TxQcuNum_S
 8

	)

29 
	#AR_BufLí
 0x0fff0000

	)

30 
	#AR_BufLí_S
 16

	)

32 
	#AR_TxDescId
 0xffff0000

	)

33 
	#AR_TxDescId_S
 16

	)

34 
	#AR_TxPåChkSum
 0x0000ffff

	)

36 
	#AR_LowRxChaö
 0x00004000

	)

38 
	#AR_NŸ_Soundög
 0x20000000

	)

41 
	#AR_PAPRDChaöMask
 0x00000e00

	)

42 
	#AR_PAPRDChaöMask_S
 9

	)

44 
	#MAP_ISR_S2_CST
 6

	)

45 
	#MAP_ISR_S2_GTT
 6

	)

46 
	#MAP_ISR_S2_TIM
 3

	)

47 
	#MAP_ISR_S2_CABEND
 0

	)

48 
	#MAP_ISR_S2_DTIMSYNC
 7

	)

49 
	#MAP_ISR_S2_DTIM
 7

	)

50 
	#MAP_ISR_S2_TSFOOR
 4

	)

51 
	#MAP_ISR_S2_BB_WATCHDOG
 6

	)

53 
	#AR9003TXC_CONST
(
_ds
Ë((c⁄° 
¨9003_txc
 *Ë_ds)

	)

55 
	s¨9003_rxs
 {

56 
u32
 
	mds_öfo
;

57 
u32
 
	m°©us1
;

58 
u32
 
	m°©us2
;

59 
u32
 
	m°©us3
;

60 
u32
 
	m°©us4
;

61 
u32
 
	m°©us5
;

62 
u32
 
	m°©us6
;

63 
u32
 
	m°©us7
;

64 
u32
 
	m°©us8
;

65 
u32
 
	m°©us9
;

66 
u32
 
	m°©us10
;

67 
u32
 
	m°©us11
;

68 } 
__∑cked
 
__Æig√d
(4);

71 
	s¨9003_txc
 {

72 
u32
 
	möfo
;

73 
u32
 
	mlök
;

74 
u32
 
	md©a0
;

75 
u32
 
	m˘l3
;

76 
u32
 
	md©a1
;

77 
u32
 
	m˘l5
;

78 
u32
 
	md©a2
;

79 
u32
 
	m˘l7
;

80 
u32
 
	md©a3
;

81 
u32
 
	m˘l9
;

82 
u32
 
	m˘l10
;

83 
u32
 
	m˘l11
;

84 
u32
 
	m˘l12
;

85 
u32
 
	m˘l13
;

86 
u32
 
	m˘l14
;

87 
u32
 
	m˘l15
;

88 
u32
 
	m˘l16
;

89 
u32
 
	m˘l17
;

90 
u32
 
	m˘l18
;

91 
u32
 
	m˘l19
;

92 
u32
 
	m˘l20
;

93 
u32
 
	m˘l21
;

94 
u32
 
	m˘l22
;

95 
u32
 
	m˘l23
;

96 
u32
 
	m∑d
[8];

97 } 
__∑cked
 
__Æig√d
(4);

99 
	s¨9003_txs
 {

100 
u32
 
	mds_öfo
;

101 
u32
 
	m°©us1
;

102 
u32
 
	m°©us2
;

103 
u32
 
	m°©us3
;

104 
u32
 
	m°©us4
;

105 
u32
 
	m°©us5
;

106 
u32
 
	m°©us6
;

107 
u32
 
	m°©us7
;

108 
u32
 
	m°©us8
;

109 } 
__∑cked
 
__Æig√d
(4);

111 
¨9003_hw_©èch_mac_›s
(
©h_hw
 *
hw
);

112 
©h9k_hw_£t_rx_bufsize
(
©h_hw
 *
ah
, 
u16
 
buf_size
);

113 
©h9k_hw_addrxbuf_edma
(
©h_hw
 *
ah
, 
u32
 
rxdp
,

114 
©h9k_rx_qty≥
 
qty≥
);

116 
©h9k_hw_¥o˚ss_rxdesc_edma
(
©h_hw
 *
ah
,

117 
©h_rx_°©us
 *
rxs
,

118 *
buf_addr
);

119 
©h9k_hw_ª£t_tx°©us_rög
(
©h_hw
 *
ah
);

120 
©h9k_hw_£tup_°©u§ög
(
©h_hw
 *
ah
, *
ts_°¨t
,

121 
u32
 
ts_∑ddr_°¨t
,

122 
u16
 
size
);

	@ar9003_mci.c

17 
	~<löux/exp‹t.h
>

18 
	~"hw.h
"

19 
	~"hw-›s.h
"

20 
	~"¨9003_phy.h
"

21 
	~"¨9003_mci.h
"

22 
	~"¨9003_aic.h
"

24 
	$¨9003_mci_ª£t_ªq_wakeup
(
©h_hw
 *
ah
)

26 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_COMMAND2
,

27 
AR_MCI_COMMAND2_RESET_REQ_WAKEUP
, 1);

28 
	`udñay
(1);

29 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_COMMAND2
,

30 
AR_MCI_COMMAND2_RESET_REQ_WAKEUP
, 0);

31 
	}
}

33 
	$¨9003_mci_waô_f‹_öãºu±
(
©h_hw
 *
ah
, 
u32
 
addªss
,

34 
u32
 
bô_posôi⁄
, 
time_out
)

36 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

38 
time_out
) {

39 i‡(!(
	`REG_READ
(
ah
, 
addªss
Ë& 
bô_posôi⁄
)) {

40 
	`udñay
(10);

41 
time_out
 -= 10;

43 i‡(
time_out
 < 0)

48 
	`REG_WRITE
(
ah
, 
addªss
, 
bô_posôi⁄
);

50 i‡(
addªss
 !
AR_MCI_INTERRUPT_RX_MSG_RAW
)

53 i‡(
bô_posôi⁄
 & 
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
)

54 
	`¨9003_mci_ª£t_ªq_wakeup
(
ah
);

56 i‡(
bô_posôi⁄
 & (
AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
 |

57 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
))

58 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
,

59 
AR_MCI_INTERRUPT_REMOTE_SLEEP_UPDATE
);

61 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
, 
AR_MCI_INTERRUPT_RX_MSG
);

65 i‡(
time_out
 <= 0) {

66 
	`©h_dbg
(
comm⁄
, 
MCI
,

68 
addªss
, 
bô_posôi⁄
);

69 
	`©h_dbg
(
comm⁄
, 
MCI
,

71 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RAW
),

72 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
));

73 
time_out
 = 0;

76  
time_out
;

77 
	}
}

79 
	$¨9003_mci_ªmŸe_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

81 
u32
 
∑ylﬂd
[4] = { 0xffffffff, 0xffffffff, 0xffffffff, 0xffffff00};

83 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_REMOTE_RESET
, 0, 
∑ylﬂd
, 16,

84 
waô_d⁄e
, 
Ál£
);

85 
	`udñay
(5);

86 
	}
}

88 
	$¨9003_mci_£nd_ a_å™s„r
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

90 
u32
 
∑ylﬂd
 = 0x00000000;

92 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_LNA_TRANS
, 0, &
∑ylﬂd
, 1,

93 
waô_d⁄e
, 
Ál£
);

94 
	}
}

96 
	$¨9003_mci_£nd_ªq_wake
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

98 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_REQ_WAKE
, 
MCI_FLAG_DISABLE_TIMESTAMP
,

99 
NULL
, 0, 
waô_d⁄e
, 
Ál£
);

100 
	`udñay
(5);

101 
	}
}

103 
	$¨9003_mci_£nd_sys_wakög
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

105 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_SYS_WAKING
, 
MCI_FLAG_DISABLE_TIMESTAMP
,

106 
NULL
, 0, 
waô_d⁄e
, 
Ál£
);

107 
	}
}

109 
	$¨9003_mci_£nd_ a_èke
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

111 
u32
 
∑ylﬂd
 = 0x70000000;

113 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_LNA_TAKE
, 0, &
∑ylﬂd
, 1,

114 
waô_d⁄e
, 
Ál£
);

115 
	}
}

117 
	$¨9003_mci_£nd_sys_¶ìpög
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

119 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_SYS_SLEEPING
,

120 
MCI_FLAG_DISABLE_TIMESTAMP
,

121 
NULL
, 0, 
waô_d⁄e
, 
Ál£
);

122 
	}
}

124 
	$¨9003_mci_£nd_c€x_vîsi⁄_quîy
(
©h_hw
 *
ah
,

125 
boﬁ
 
waô_d⁄e
)

127 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

128 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

130 i‡(
mci
->
bt_vîsi⁄_known
 ||

131 (
mci
->
bt_°©e
 =
MCI_BT_SLEEP
))

134 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 
MCI_GPM_COEX_AGENT
,

135 
MCI_GPM_COEX_VERSION_QUERY
);

136 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16, 
waô_d⁄e
, 
åue
);

137 
	}
}

139 
	$¨9003_mci_£nd_c€x_vîsi⁄_ª•⁄£
(
©h_hw
 *
ah
,

140 
boﬁ
 
waô_d⁄e
)

142 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

143 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

145 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 
MCI_GPM_COEX_AGENT
,

146 
MCI_GPM_COEX_VERSION_RESPONSE
);

147 *(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_MAJOR_VERSION
) =

148 
mci
->
wœn_vî_maj‹
;

149 *(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_MINOR_VERSION
) =

150 
mci
->
wœn_vî_mö‹
;

151 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16, 
waô_d⁄e
, 
åue
);

152 
	}
}

154 
	$¨9003_mci_£nd_c€x_wœn_ch™√ls
(
©h_hw
 *
ah
,

155 
boﬁ
 
waô_d⁄e
)

157 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

158 
u32
 *
∑ylﬂd
 = &
mci
->
wœn_ch™√ls
[0];

160 i‡(!
mci
->
wœn_ch™√ls_upd©e
 ||

161 (
mci
->
bt_°©e
 =
MCI_BT_SLEEP
))

164 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 
MCI_GPM_COEX_AGENT
,

165 
MCI_GPM_COEX_WLAN_CHANNELS
);

166 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16, 
waô_d⁄e
, 
åue
);

167 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 0xff, 0xff);

168 
	}
}

170 
	$¨9003_mci_£nd_c€x_bt_°©us_quîy
(
©h_hw
 *
ah
,

171 
boﬁ
 
waô_d⁄e
, 
u8
 
quîy_ty≥
)

173 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

174 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

175 
boﬁ
 
quîy_btöfo
;

177 i‡(
mci
->
bt_°©e
 =
MCI_BT_SLEEP
)

180 
quîy_btöfo
 = !!(
quîy_ty≥
 & (
MCI_GPM_COEX_QUERY_BT_ALL_INFO
 |

181 
MCI_GPM_COEX_QUERY_BT_TOPOLOGY
));

182 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 
MCI_GPM_COEX_AGENT
,

183 
MCI_GPM_COEX_STATUS_QUERY
);

185 *(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_BT_BITMAP
Ë
quîy_ty≥
;

191 i‡(!
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16,

192 
waô_d⁄e
, 
åue
)) {

193 i‡(
quîy_btöfo
)

194 
mci
->
√ed_Êush_btöfo
 = 
åue
;

197 i‡(
quîy_btöfo
)

198 
mci
->
quîy_bt
 = 
Ál£
;

199 
	}
}

201 
	$¨9003_mci_£nd_c€x_hÆt_bt_gpm
(
©h_hw
 *
ah
, 
boﬁ
 
hÆt
,

202 
boﬁ
 
waô_d⁄e
)

204 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

205 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

207 
	`MCI_GPM_SET_TYPE_OPCODE
(
∑ylﬂd
, 
MCI_GPM_COEX_AGENT
,

208 
MCI_GPM_COEX_HALT_BT_GPM
);

210 i‡(
hÆt
) {

211 
mci
->
quîy_bt
 = 
åue
;

213 
mci
->
unhÆt_bt_gpm
 = 
åue
;

214 
mci
->
√ed_Êush_btöfo
 = 
åue
;

215 *(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_HALT_STATE
) =

216 
MCI_GPM_COEX_BT_GPM_HALT
;

218 *(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_HALT_STATE
) =

219 
MCI_GPM_COEX_BT_GPM_UNHALT
;

221 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16, 
waô_d⁄e
, 
åue
);

222 
	}
}

224 
	$¨9003_mci_¥ï_öãrÁ˚
(
©h_hw
 *
ah
)

226 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

227 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

228 
u32
 
ßved_mci_öt_í
;

229 
u32
 
mci_timeout
 = 150;

231 
mci
->
bt_°©e
 = 
MCI_BT_SLEEP
;

232 
ßved_mci_öt_í
 = 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_EN
);

234 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 0);

235 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

236 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
));

237 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
,

238 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RAW
));

240 
	`¨9003_mci_ªmŸe_ª£t
(
ah
, 
åue
);

241 
	`¨9003_mci_£nd_ªq_wake
(
ah
, 
åue
);

243 i‡(!
	`¨9003_mci_waô_f‹_öãºu±
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

244 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
, 500))

245 
˛ór_ªdu¡
;

247 
mci
->
bt_°©e
 = 
MCI_BT_AWAKE
;

265 
	`¨9003_mci_£nd_sys_wakög
(
ah
, 
åue
);

266 
	`udñay
(10);

272 
	`REG_WRITE
(
ah
, 
AR_MCI_BT_PRI0
, 0xFFFFFFFF);

273 
	`REG_WRITE
(
ah
, 
AR_MCI_BT_PRI1
, 0xFFFFFFFF);

274 
	`REG_WRITE
(
ah
, 
AR_MCI_BT_PRI2
, 0xFFFFFFFF);

275 
	`REG_WRITE
(
ah
, 
AR_MCI_BT_PRI3
, 0xFFFFFFFF);

276 
	`REG_WRITE
(
ah
, 
AR_MCI_BT_PRI
, 0X000000FF);

284 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

285 
AR_MCI_INTERRUPT_RX_MSG_CONT_RST
);

286 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
, 
AR_MCI_INTERRUPT_BT_PRI
);

288 i‡(
mci
->
is_2g
 && 
	`MCI_ANT_ARCH_PA_LNA_SHARED
(mci)) {

289 
	`¨9003_mci_£nd_ a_å™s„r
(
ah
, 
åue
);

290 
	`udñay
(5);

293 i‡(
mci
->
is_2g
 && !mci->
upd©e_2g5g
 && 
	`MCI_ANT_ARCH_PA_LNA_SHARED
(mci)) {

294 i‡(
	`¨9003_mci_waô_f‹_öãºu±
(
ah
,

295 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

296 
AR_MCI_INTERRUPT_RX_MSG_LNA_INFO
,

297 
mci_timeout
))

298 
	`©h_dbg
(
comm⁄
, 
MCI
,

301 
	`©h_dbg
(
comm⁄
, 
MCI
,

305 
˛ór_ªdu¡
:

307 i‡((
mci
->
bt_°©e
 =
MCI_BT_AWAKE
) &&

308 (
	`REG_READ_FIELD
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

309 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
)) &&

310 (
	`REG_READ_FIELD
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

311 
AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
) == 0)) {

312 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

313 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
);

314 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
,

315 
AR_MCI_INTERRUPT_REMOTE_SLEEP_UPDATE
);

318 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 
ßved_mci_öt_í
);

319 
	}
}

321 
	$¨9003_mci_£t_fuŒ_¶ìp
(
©h_hw
 *
ah
)

323 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

325 i‡(
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_ENABLE
) &&

326 (
mci
->
bt_°©e
 !
MCI_BT_SLEEP
) &&

327 !
mci
->
hÆãd_bt_gpm
) {

328 
	`¨9003_mci_£nd_c€x_hÆt_bt_gpm
(
ah
, 
åue
,Årue);

331 
mci
->
ªady
 = 
Ál£
;

332 
	}
}

334 
	$¨9003_mci_dißbÀ_öãºu±
(
©h_hw
 *
ah
)

336 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 0);

337 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_EN
, 0);

338 
	}
}

340 
	$¨9003_mci_íabÀ_öãºu±
(
©h_hw
 *
ah
)

342 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 
AR_MCI_INTERRUPT_DEFAULT
);

343 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_EN
,

344 
AR_MCI_INTERRUPT_RX_MSG_DEFAULT
);

345 
	}
}

347 
boﬁ
 
	$¨9003_mci_check_öt
(
©h_hw
 *
ah
, 
u32
 
öts
)

349 
u32
 
öå
;

351 
öå
 = 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
);

352  ((
öå
 & 
öts
) == ints);

353 
	}
}

355 
	$¨9003_mci_gë_öãºu±
(
©h_hw
 *
ah
, 
u32
 *
øw_öå
,

356 
u32
 *
rx_msg_öå
)

358 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

360 *
øw_öå
 = 
mci
->raw_intr;

361 *
rx_msg_öå
 = 
mci
->rx_msg_intr;

364 
mci
->
øw_öå
 = 0;

365 
mci
->
rx_msg_öå
 = 0;

366 
	}
}

367 
EXPORT_SYMBOL
(
¨9003_mci_gë_öãºu±
);

369 
	$¨9003_mci_gë_i§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
)

371 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

372 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

373 
u32
 
øw_öå
, 
rx_msg_öå
;

375 
rx_msg_öå
 = 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
);

376 
øw_öå
 = 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_RAW
);

378 i‡((
øw_öå
 =0xdódbìfË|| (
rx_msg_öå
 == 0xdeadbeef)) {

379 
	`©h_dbg
(
comm⁄
, 
MCI
,

382 
mci
->
rx_msg_öå
 |=Ñx_msg_intr;

383 
mci
->
øw_öå
 |=Ñaw_intr;

384 *
masked
 |
ATH9K_INT_MCI
;

386 i‡(
rx_msg_öå
 & 
AR_MCI_INTERRUPT_RX_MSG_CONT_INFO
)

387 
mci
->
c⁄t_°©us
 = 
	`REG_READ
(
ah
, 
AR_MCI_CONT_STATUS
);

389 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
, 
rx_msg_öå
);

390 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
, 
øw_öå
);

392 
	}
}

394 
	$¨9003_mci_2g5g_ch™ged
(
©h_hw
 *
ah
, 
boﬁ
 
is_2g
)

396 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

398 i‡(!
mci
->
upd©e_2g5g
 &&

399 (
mci
->
is_2g
 != is_2g))

400 
mci
->
upd©e_2g5g
 = 
åue
;

402 
mci
->
is_2g
 = is_2g;

403 
	}
}

405 
boﬁ
 
	$¨9003_mci_is_gpm_vÆid
(
©h_hw
 *
ah
, 
u32
 
msg_ödex
)

407 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

408 
u32
 *
∑ylﬂd
;

409 
u32
 
ªcv_ty≥
, 
off£t
;

411 i‡(
msg_ödex
 =
MCI_GPM_INVALID
)

412  
Ál£
;

414 
off£t
 = 
msg_ödex
 << 4;

416 
∑ylﬂd
 = (
u32
 *)(
mci
->
gpm_buf
 + 
off£t
);

417 
ªcv_ty≥
 = 
	`MCI_GPM_TYPE
(
∑ylﬂd
);

419 i‡(
ªcv_ty≥
 =
MCI_GPM_RSVD_PATTERN
)

420  
Ál£
;

422  
åue
;

423 
	}
}

425 
	$¨9003_mci_ob£rv©i⁄_£t_up
(
©h_hw
 *
ah
)

427 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

429 i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_MCI_OBS_MCI
) {

430 
	`©h9k_hw_cfg_ouçut
(
ah
, 3, 
AR_GPIO_OUTPUT_MUX_AS_MCI_WLAN_DATA
);

431 
	`©h9k_hw_cfg_ouçut
(
ah
, 2, 
AR_GPIO_OUTPUT_MUX_AS_MCI_WLAN_CLK
);

432 
	`©h9k_hw_cfg_ouçut
(
ah
, 1, 
AR_GPIO_OUTPUT_MUX_AS_MCI_BT_DATA
);

433 
	`©h9k_hw_cfg_ouçut
(
ah
, 0, 
AR_GPIO_OUTPUT_MUX_AS_MCI_BT_CLK
);

434 } i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_MCI_OBS_TXRX
) {

435 
	`©h9k_hw_cfg_ouçut
(
ah
, 3, 
AR_GPIO_OUTPUT_MUX_AS_WL_IN_TX
);

436 
	`©h9k_hw_cfg_ouçut
(
ah
, 2, 
AR_GPIO_OUTPUT_MUX_AS_WL_IN_RX
);

437 
	`©h9k_hw_cfg_ouçut
(
ah
, 1, 
AR_GPIO_OUTPUT_MUX_AS_BT_IN_TX
);

438 
	`©h9k_hw_cfg_ouçut
(
ah
, 0, 
AR_GPIO_OUTPUT_MUX_AS_BT_IN_RX
);

439 
	`©h9k_hw_cfg_ouçut
(
ah
, 5, 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

440 } i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_MCI_OBS_BT
) {

441 
	`©h9k_hw_cfg_ouçut
(
ah
, 3, 
AR_GPIO_OUTPUT_MUX_AS_BT_IN_TX
);

442 
	`©h9k_hw_cfg_ouçut
(
ah
, 2, 
AR_GPIO_OUTPUT_MUX_AS_BT_IN_RX
);

443 
	`©h9k_hw_cfg_ouçut
(
ah
, 1, 
AR_GPIO_OUTPUT_MUX_AS_MCI_BT_DATA
);

444 
	`©h9k_hw_cfg_ouçut
(
ah
, 0, 
AR_GPIO_OUTPUT_MUX_AS_MCI_BT_CLK
);

448 
	`REG_SET_BIT
(
ah
, 
AR_GPIO_INPUT_EN_VAL
, 
AR_GPIO_JTAG_DISABLE
);

450 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GLB_CONTROL
, 
AR_GLB_DS_JTAG_DISABLE
, 1);

451 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GLB_CONTROL
, 
AR_GLB_WLAN_UART_INTF_EN
, 0);

452 
	`REG_SET_BIT
(
ah
, 
AR_GLB_GPIO_CONTROL
, 
ATH_MCI_CONFIG_MCI_OBS_GPIO
);

454 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
, 
AR_BTCOEX_CTRL2_GPIO_OBS_SEL
, 0);

455 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
, 
AR_BTCOEX_CTRL2_MAC_BB_OBS_SEL
, 1);

456 
	`REG_WRITE
(
ah
, 
AR_OBS
, 0x4b);

457 
	`REG_RMW_FIELD
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_OBS_PT_SEL1
, 0x03);

458 
	`REG_RMW_FIELD
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_OBS_PT_SEL2
, 0x01);

459 
	`REG_RMW_FIELD
(
ah
, 
AR_MACMISC
, 
AR_MACMISC_MISC_OBS_BUS_LSB
, 0x02);

460 
	`REG_RMW_FIELD
(
ah
, 
AR_MACMISC
, 
AR_MACMISC_MISC_OBS_BUS_MSB
, 0x03);

461 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST_CTL_STATUS
,

462 
AR_PHY_TEST_CTL_DEBUGPORT_SEL
, 0x07);

463 
	}
}

465 
boﬁ
 
	$¨9003_mci_£nd_c€x_bt_Êags
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
,

466 
u8
 
›code
, 
u32
 
bt_Êags
)

468 
u32
 
∂d
[4] = {0, 0, 0, 0};

470 
	`MCI_GPM_SET_TYPE_OPCODE
(
∂d
, 
MCI_GPM_COEX_AGENT
,

471 
MCI_GPM_COEX_BT_UPDATE_FLAGS
);

473 *(((
u8
 *)
∂d
Ë+ 
MCI_GPM_COEX_B_BT_FLAGS_OP
Ë
›code
;

474 *(((
u8
 *)
∂d
Ë+ 
MCI_GPM_COEX_W_BT_FLAGS
 + 0Ë
bt_Êags
 & 0xFF;

475 *(((
u8
 *)
∂d
Ë+ 
MCI_GPM_COEX_W_BT_FLAGS
 + 1Ë(
bt_Êags
 >> 8) & 0xFF;

476 *(((
u8
 *)
∂d
Ë+ 
MCI_GPM_COEX_W_BT_FLAGS
 + 2Ë(
bt_Êags
 >> 16) & 0xFF;

477 *(((
u8
 *)
∂d
Ë+ 
MCI_GPM_COEX_W_BT_FLAGS
 + 3Ë(
bt_Êags
 >> 24) & 0xFF;

479  
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∂d
, 16,

480 
waô_d⁄e
, 
åue
);

481 
	}
}

483 
	$¨9003_mci_sync_bt_°©e
(
©h_hw
 *
ah
)

485 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

486 
u32
 
cur_bt_°©e
;

488 
cur_bt_°©e
 = 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_REMOTE_SLEEP
);

490 i‡(
mci
->
bt_°©e
 !
cur_bt_°©e
)

491 
mci
->
bt_°©e
 = 
cur_bt_°©e
;

493 i‡(
mci
->
bt_°©e
 !
MCI_BT_SLEEP
) {

495 
	`¨9003_mci_£nd_c€x_vîsi⁄_quîy
(
ah
, 
åue
);

496 
	`¨9003_mci_£nd_c€x_wœn_ch™√ls
(
ah
, 
åue
);

498 i‡(
mci
->
unhÆt_bt_gpm
 =
åue
)

499 
	`¨9003_mci_£nd_c€x_hÆt_bt_gpm
(
ah
, 
Ál£
, 
åue
);

501 
	}
}

503 
	$¨9003_mci_check_bt
(
©h_hw
 *
ah
)

505 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

507 i‡(!
mci_hw
->
ªady
)

514 
	`¨9003_mci_sync_bt_°©e
(
ah
);

515 
	`¨9003_mci_2g5g_swôch
(
ah
, 
åue
);

517 i‡((
mci_hw
->
bt_°©e
 =
MCI_BT_AWAKE
) &&

518 (
mci_hw
->
quîy_bt
 =
åue
)) {

519 
mci_hw
->
√ed_Êush_btöfo
 = 
åue
;

521 
	}
}

523 
	$¨9003_mci_¥o˚ss_gpm_exåa
(
©h_hw
 *
ah
, 
u8
 
gpm_ty≥
,

524 
u8
 
gpm_›code
, 
u32
 *
p_gpm
)

526 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

527 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

528 
u8
 *
p_d©a
 = (u8 *Ë
p_gpm
;

530 i‡(
gpm_ty≥
 !
MCI_GPM_COEX_AGENT
)

533 
gpm_›code
) {

534 
MCI_GPM_COEX_VERSION_QUERY
:

535 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Recv GPM COEX Version Query\n");

536 
	`¨9003_mci_£nd_c€x_vîsi⁄_ª•⁄£
(
ah
, 
åue
);

538 
MCI_GPM_COEX_VERSION_RESPONSE
:

539 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Recv GPM COEX Version Response\n");

540 
mci
->
bt_vî_maj‹
 =

541 *(
p_d©a
 + 
MCI_GPM_COEX_B_MAJOR_VERSION
);

542 
mci
->
bt_vî_mö‹
 =

543 *(
p_d©a
 + 
MCI_GPM_COEX_B_MINOR_VERSION
);

544 
mci
->
bt_vîsi⁄_known
 = 
åue
;

545 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI BT Coex version: %d.%d\n",

546 
mci
->
bt_vî_maj‹
, mci->
bt_vî_mö‹
);

548 
MCI_GPM_COEX_STATUS_QUERY
:

549 
	`©h_dbg
(
comm⁄
, 
MCI
,

551 *(
p_d©a
 + 
MCI_GPM_COEX_B_WLAN_BITMAP
));

552 
mci
->
wœn_ch™√ls_upd©e
 = 
åue
;

553 
	`¨9003_mci_£nd_c€x_wœn_ch™√ls
(
ah
, 
åue
);

555 
MCI_GPM_COEX_BT_PROFILE_INFO
:

556 
mci
->
quîy_bt
 = 
åue
;

557 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Recv GPM COEX BT_Profile_Info\n");

559 
MCI_GPM_COEX_BT_STATUS_UPDATE
:

560 
mci
->
quîy_bt
 = 
åue
;

561 
	`©h_dbg
(
comm⁄
, 
MCI
,

563 *(
p_gpm
 + 3));

568 
	}
}

570 
u32
 
	$¨9003_mci_waô_f‹_gpm
(
©h_hw
 *
ah
, 
u8
 
gpm_ty≥
,

571 
u8
 
gpm_›code
, 
time_out
)

573 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

574 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

575 
u32
 *
p_gpm
 = 
NULL
, 
mism©ch
 = 0, 
m‹e_d©a
;

576 
u32
 
off£t
;

577 
u8
 
ªcv_ty≥
 = 0, 
ªcv_›code
 = 0;

578 
boﬁ
 
b_is_bt_ˇl_d⁄e
 = (
gpm_ty≥
 =
MCI_GPM_BT_CAL_DONE
);

580 
m‹e_d©a
 = 
time_out
 ? 
MCI_GPM_NOMORE
 : 
MCI_GPM_MORE
;

582 
time_out
 > 0) {

583 i‡(
p_gpm
) {

584 
	`MCI_GPM_RECYCLE
(
p_gpm
);

585 
p_gpm
 = 
NULL
;

588 i‡(
m‹e_d©a
 !
MCI_GPM_MORE
)

589 
time_out
 = 
	`¨9003_mci_waô_f‹_öãºu±
(
ah
,

590 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

591 
AR_MCI_INTERRUPT_RX_MSG_GPM
,

592 
time_out
);

594 i‡(!
time_out
)

597 
off£t
 = 
	`¨9003_mci_gë_√xt_gpm_off£t
(
ah
, &
m‹e_d©a
);

599 i‡(
off£t
 =
MCI_GPM_INVALID
)

602 
p_gpm
 = (
u32
 *Ë(
mci
->
gpm_buf
 + 
off£t
);

603 
ªcv_ty≥
 = 
	`MCI_GPM_TYPE
(
p_gpm
);

604 
ªcv_›code
 = 
	`MCI_GPM_OPCODE
(
p_gpm
);

606 i‡(
	`MCI_GPM_IS_CAL_TYPE
(
ªcv_ty≥
)) {

607 i‡(
ªcv_ty≥
 =
gpm_ty≥
) {

608 i‡((
gpm_ty≥
 =
MCI_GPM_BT_CAL_DONE
) &&

609 !
b_is_bt_ˇl_d⁄e
) {

610 
gpm_ty≥
 = 
MCI_GPM_BT_CAL_GRANT
;

615 } i‡((
ªcv_ty≥
 =
gpm_ty≥
) &&

616 (
ªcv_›code
 =
gpm_›code
))

632 i‡((
gpm_ty≥
 =
MCI_GPM_BT_CAL_GRANT
) &&

633 (
ªcv_ty≥
 =
MCI_GPM_BT_CAL_REQ
)) {

635 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

637 
gpm_ty≥
 = 
MCI_GPM_BT_CAL_DONE
;

638 
	`MCI_GPM_SET_CAL_TYPE
(
∑ylﬂd
,

639 
MCI_GPM_WLAN_CAL_GRANT
);

640 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
, 16,

641 
Ál£
, false);

644 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI GPM subtypeÇot match 0x%x\n",

645 *(
p_gpm
 + 1));

646 
mism©ch
++;

647 
	`¨9003_mci_¥o˚ss_gpm_exåa
(
ah
, 
ªcv_ty≥
,

648 
ªcv_›code
, 
p_gpm
);

652 i‡(
p_gpm
) {

653 
	`MCI_GPM_RECYCLE
(
p_gpm
);

654 
p_gpm
 = 
NULL
;

657 i‡(
time_out
 <= 0)

658 
time_out
 = 0;

660 
m‹e_d©a
 =
MCI_GPM_MORE
) {

661 
off£t
 = 
	`¨9003_mci_gë_√xt_gpm_off£t
(
ah
, &
m‹e_d©a
);

662 i‡(
off£t
 =
MCI_GPM_INVALID
)

665 
p_gpm
 = (
u32
 *Ë(
mci
->
gpm_buf
 + 
off£t
);

666 
ªcv_ty≥
 = 
	`MCI_GPM_TYPE
(
p_gpm
);

667 
ªcv_›code
 = 
	`MCI_GPM_OPCODE
(
p_gpm
);

669 i‡(!
	`MCI_GPM_IS_CAL_TYPE
(
ªcv_ty≥
))

670 
	`¨9003_mci_¥o˚ss_gpm_exåa
(
ah
, 
ªcv_ty≥
,

671 
ªcv_›code
, 
p_gpm
);

673 
	`MCI_GPM_RECYCLE
(
p_gpm
);

676  
time_out
;

677 
	}
}

679 
boﬁ
 
	$¨9003_mci_°¨t_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

681 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

682 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

683 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

685 
	`¨9003_mci_2g5g_ch™ged
(
ah
, 
	`IS_CHAN_2GHZ
(
ch™
));

687 i‡(
mci_hw
->
bt_°©e
 !
MCI_BT_CAL_START
)

688  
Ál£
;

690 
mci_hw
->
bt_°©e
 = 
MCI_BT_CAL
;

697 
	`¨9003_mci_dißbÀ_öãºu±
(
ah
);

699 
	`MCI_GPM_SET_CAL_TYPE
(
∑ylﬂd
, 
MCI_GPM_WLAN_CAL_GRANT
);

700 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∑ylﬂd
,

701 16, 
åue
, 
Ál£
);

705 i‡(
	`¨9003_mci_waô_f‹_gpm
(
ah
, 
MCI_GPM_BT_CAL_DONE
,

707 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI BT_CAL_DONEÑeceived\n");

709 
	`©h_dbg
(
comm⁄
, 
MCI
,

712 
mci_hw
->
bt_°©e
 = 
MCI_BT_AWAKE
;

714 
	`¨9003_mci_íabÀ_öãºu±
(
ah
);

716  
åue
;

717 
	}
}

719 
	$¨9003_mci_íd_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

720 
©h9k_hw_ˇl_d©a
 *
ˇld©a
)

722 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

724 i‡(!
mci_hw
->
ªady
)

727 i‡(!
	`IS_CHAN_2GHZ
(
ch™
Ë|| (
mci_hw
->
bt_°©e
 !
MCI_BT_SLEEP
))

728 
exô
;

730 i‡(!
	`¨9003_mci_check_öt
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_REMOTE_RESET
) &&

731 !
	`¨9003_mci_check_öt
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
))

732 
exô
;

740 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

741 (
AR_MCI_INTERRUPT_RX_MSG_REMOTE_RESET
 |

742 
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
));

744 
	`¨9003_mci_ªmŸe_ª£t
(
ah
, 
åue
);

745 
	`¨9003_mci_£nd_sys_wakög
(
ah
, 
åue
);

746 
	`udñay
(1);

748 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

749 
	`¨9003_mci_£nd_ a_å™s„r
(
ah
, 
åue
);

751 
mci_hw
->
bt_°©e
 = 
MCI_BT_AWAKE
;

753 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TIMING4
,

754 1 << 
AR_PHY_TIMING_CONTROL4_DO_GAIN_DC_IQ_CAL_SHIFT
);

756 i‡(
ˇld©a
) {

757 
	`˛ór_bô
(
TXIQCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

758 
	`˛ór_bô
(
TXCLCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

759 
	`˛ór_bô
(
RTT_DONE
, &
ˇld©a
->
ˇl_Êags
);

762 i‡(!
	`©h9k_hw_öô_ˇl
(
ah
, 
ch™
))

763  -
EIO
;

765 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TIMING4
,

766 1 << 
AR_PHY_TIMING_CONTROL4_DO_GAIN_DC_IQ_CAL_SHIFT
);

768 
exô
:

769 
	`¨9003_mci_íabÀ_öãºu±
(
ah
);

771 
	}
}

773 
	$¨9003_mci_muã_bt
(
©h_hw
 *
ah
)

775 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

778 
	`REG_WRITE
(
ah
, 
AR_MCI_MSG_ATTRIBUTES_TABLE
, 0xffff0000);

779 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_WL_WEIGHTS0
, 0xffffffff);

780 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_WL_WEIGHTS1
, 0xffffffff);

781 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_WL_WEIGHTS2
, 0xffffffff);

782 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_WL_WEIGHTS3
, 0xffffffff);

783 
	`REG_SET_BIT
(
ah
, 
AR_MCI_TX_CTRL
, 
AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
);

786 
	`udñay
(10);

793 i‡(
	`MCI_ANT_ARCH_PA_LNA_SHARED
(
mci
)) {

794 
	`¨9003_mci_£nd_ a_èke
(
ah
, 
åue
);

795 
	`udñay
(5);

798 
	`¨9003_mci_£nd_sys_¶ìpög
(
ah
, 
åue
);

799 
	}
}

801 
	$¨9003_mci_o¶a_£tup
(
©h_hw
 *
ah
, 
boﬁ
 
íabÀ
)

803 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

804 
u32
 
thªsh
;

806 i‡(!
íabÀ
) {

807 
	`REG_CLR_BIT
(
ah
, 
AR_BTCOEX_CTRL
,

808 
AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
);

811 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_SCHD_TABLE_2
, 
AR_MCI_SCHD_TABLE_2_HW_BASED
, 1);

812 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_SCHD_TABLE_2
,

813 
AR_MCI_SCHD_TABLE_2_MEM_BASED
, 1);

815 i‡(
	`AR_SREV_9565
(
ah
))

816 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_MISC
, 
AR_MCI_MISC_HW_FIX_EN
, 1);

818 i‡(!(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_AGGR_THRESH
)) {

819 
thªsh
 = 
	`MS
(
mci
->
c⁄fig
, 
ATH_MCI_CONFIG_AGGR_THRESH
);

820 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL
,

821 
AR_BTCOEX_CTRL_AGGR_THRESH
, 
thªsh
);

822 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL
,

823 
AR_BTCOEX_CTRL_TIME_TO_NEXT_BT_THRESH_EN
, 1);

825 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL
,

826 
AR_BTCOEX_CTRL_TIME_TO_NEXT_BT_THRESH_EN
, 0);

828 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL
,

829 
AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
, 1);

830 
	}
}

832 
	$¨9003_mci_°©_£tup
(
©h_hw
 *
ah
)

834 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

836 i‡(!
	`AR_SREV_9565
(
ah
))

839 i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_MCI_STAT_DBG
) {

840 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_DBG_CNT_CTRL
,

841 
AR_MCI_DBG_CNT_CTRL_ENABLE
, 1);

842 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_DBG_CNT_CTRL
,

843 
AR_MCI_DBG_CNT_CTRL_BT_LINKID
,

844 
MCI_STAT_ALL_BT_LINKID
);

846 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_DBG_CNT_CTRL
,

847 
AR_MCI_DBG_CNT_CTRL_ENABLE
, 0);

849 
	}
}

851 
	$¨9003_mci_£t_btc€x_˘æ_9565_1ANT
(
©h_hw
 *
ah
)

853 
u32
 
ªgvÆ
;

855 
ªgvÆ
 = 
	`SM
(1, 
AR_BTCOEX_CTRL_AR9462_MODE
) |

856 
	`SM
(1, 
AR_BTCOEX_CTRL_WBTIMER_EN
) |

857 
	`SM
(1, 
AR_BTCOEX_CTRL_PA_SHARED
) |

858 
	`SM
(1, 
AR_BTCOEX_CTRL_LNA_SHARED
) |

859 
	`SM
(1, 
AR_BTCOEX_CTRL_NUM_ANTENNAS
) |

860 
	`SM
(1, 
AR_BTCOEX_CTRL_RX_CHAIN_MASK
) |

861 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_ACK
) |

862 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_BCN
) |

863 
	`SM
(0, 
AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
);

865 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
,

866 
AR_BTCOEX_CTRL2_TX_CHAIN_MASK
, 0x1);

867 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL
, 
ªgvÆ
);

868 
	}
}

870 
	$¨9003_mci_£t_btc€x_˘æ_9565_2ANT
(
©h_hw
 *
ah
)

872 
u32
 
ªgvÆ
;

874 
ªgvÆ
 = 
	`SM
(1, 
AR_BTCOEX_CTRL_AR9462_MODE
) |

875 
	`SM
(1, 
AR_BTCOEX_CTRL_WBTIMER_EN
) |

876 
	`SM
(0, 
AR_BTCOEX_CTRL_PA_SHARED
) |

877 
	`SM
(0, 
AR_BTCOEX_CTRL_LNA_SHARED
) |

878 
	`SM
(2, 
AR_BTCOEX_CTRL_NUM_ANTENNAS
) |

879 
	`SM
(1, 
AR_BTCOEX_CTRL_RX_CHAIN_MASK
) |

880 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_ACK
) |

881 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_BCN
) |

882 
	`SM
(0, 
AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
);

884 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
,

885 
AR_BTCOEX_CTRL2_TX_CHAIN_MASK
, 0x0);

886 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL
, 
ªgvÆ
);

887 
	}
}

889 
	$¨9003_mci_£t_btc€x_˘æ_9462
(
©h_hw
 *
ah
)

891 
u32
 
ªgvÆ
;

893 
ªgvÆ
 = 
	`SM
(1, 
AR_BTCOEX_CTRL_AR9462_MODE
) |

894 
	`SM
(1, 
AR_BTCOEX_CTRL_WBTIMER_EN
) |

895 
	`SM
(1, 
AR_BTCOEX_CTRL_PA_SHARED
) |

896 
	`SM
(1, 
AR_BTCOEX_CTRL_LNA_SHARED
) |

897 
	`SM
(2, 
AR_BTCOEX_CTRL_NUM_ANTENNAS
) |

898 
	`SM
(3, 
AR_BTCOEX_CTRL_RX_CHAIN_MASK
) |

899 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_ACK
) |

900 
	`SM
(0, 
AR_BTCOEX_CTRL_1_CHAIN_BCN
) |

901 
	`SM
(0, 
AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
);

903 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL
, 
ªgvÆ
);

904 
	}
}

906 
	$¨9003_mci_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
í_öt
, boﬁ 
is_2g
,

907 
boﬁ
 
is_fuŒ_¶ìp
)

909 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

910 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

911 
u32
 
ªgvÆ
, 
i
;

913 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Reset (full_sleep = %d, is_2g = %d)\n",

914 
is_fuŒ_¶ìp
, 
is_2g
);

916 i‡(
	`REG_READ
(
ah
, 
AR_BTCOEX_CTRL
) == 0xdeadbeef) {

917 
	`©h_îr
(
comm⁄
, "BTCOEX controlÑegister is dead\n");

918  -
EINVAL
;

922 
	`REG_WRITE
(
ah
, 
AR_MCI_GPM_0
, 
mci
->
gpm_addr
);

923 
	`REG_WRITE
(
ah
, 
AR_MCI_GPM_1
, 
mci
->
gpm_Àn
);

924 
	`REG_WRITE
(
ah
, 
AR_MCI_SCHD_TABLE_0
, 
mci
->
sched_addr
);

930 i‡(
	`AR_SREV_9565
(
ah
)) {

931 
u8
 
™t
 = 
	`MS
(
mci
->
c⁄fig
, 
ATH_MCI_CONFIG_ANT_ARCH
);

933 i‡(
™t
 =
ATH_MCI_ANT_ARCH_1_ANT_PA_LNA_SHARED
)

934 
	`¨9003_mci_£t_btc€x_˘æ_9565_1ANT
(
ah
);

936 
	`¨9003_mci_£t_btc€x_˘æ_9565_2ANT
(
ah
);

938 
	`¨9003_mci_£t_btc€x_˘æ_9462
(
ah
);

941 i‡(
is_2g
 && !(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_OSLA
))

942 
	`¨9003_mci_o¶a_£tup
(
ah
, 
åue
);

944 
	`¨9003_mci_o¶a_£tup
(
ah
, 
Ál£
);

946 
	`REG_SET_BIT
(
ah
, 
AR_PHY_GLB_CONTROL
,

947 
AR_BTCOEX_CTRL_SPDT_ENABLE
);

948 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL3
,

949 
AR_BTCOEX_CTRL3_CONT_INFO_TIMEOUT
, 20);

951 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
, 
AR_BTCOEX_CTRL2_RX_DEWEIGHT
, 0);

952 
	`REG_RMW_FIELD
(
ah
, 
AR_PCU_MISC
, 
AR_PCU_BT_ANT_PREVENT_RX
, 0);

955 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_WL_LNA
, 
AR_BTCOEX_WL_LNA_TIMEOUT
, 0x3D090);

958 i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_CONCUR_TX
) {

959 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
,

960 
AR_BTCOEX_CTRL2_DESC_BASED_TXPWR_ENABLE
, 0);

961 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL2
,

962 
AR_BTCOEX_CTRL2_TXPWR_THRESH
, 0x7f);

963 
	`REG_RMW_FIELD
(
ah
, 
AR_BTCOEX_CTRL
,

964 
AR_BTCOEX_CTRL_REDUCE_TXPWR
, 0);

965 
i
 = 0; i < 8; i++)

966 
	`REG_WRITE
(
ah
, 
	`AR_BTCOEX_MAX_TXPWR
(
i
), 0x7f7f7f7f);

969 
ªgvÆ
 = 
	`MS
(
mci
->
c⁄fig
, 
ATH_MCI_CONFIG_CLK_DIV
);

970 
	`REG_RMW_FIELD
(
ah
, 
AR_MCI_TX_CTRL
, 
AR_MCI_TX_CTRL_CLK_DIV
, 
ªgvÆ
);

971 
	`REG_SET_BIT
(
ah
, 
AR_BTCOEX_CTRL
, 
AR_BTCOEX_CTRL_MCI_MODE_EN
);

974 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_MCI_COMMAND2
);

975 
ªgvÆ
 |
	`SM
(1, 
AR_MCI_COMMAND2_RESET_TX
);

976 
	`REG_WRITE
(
ah
, 
AR_MCI_COMMAND2
, 
ªgvÆ
);

978 
	`udñay
(1);

980 
ªgvÆ
 &~
	`SM
(1, 
AR_MCI_COMMAND2_RESET_TX
);

981 
	`REG_WRITE
(
ah
, 
AR_MCI_COMMAND2
, 
ªgvÆ
);

983 i‡(
is_fuŒ_¶ìp
) {

984 
	`¨9003_mci_muã_bt
(
ah
);

985 
	`udñay
(100);

989 
	`¨9003_mci_check_gpm_off£t
(
ah
);

991 
ªgvÆ
 |
	`SM
(1, 
AR_MCI_COMMAND2_RESET_RX
);

992 
	`REG_WRITE
(
ah
, 
AR_MCI_COMMAND2
, 
ªgvÆ
);

993 
	`udñay
(1);

994 
ªgvÆ
 &~
	`SM
(1, 
AR_MCI_COMMAND2_RESET_RX
);

995 
	`REG_WRITE
(
ah
, 
AR_MCI_COMMAND2
, 
ªgvÆ
);

998 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_INIT_GPM_OFFSET
);

1000 
	`REG_WRITE
(
ah
, 
AR_MCI_MSG_ATTRIBUTES_TABLE
,

1001 (
	`SM
(0xe801, 
AR_MCI_MSG_ATTRIBUTES_TABLE_INVALID_HDR
) |

1002 
	`SM
(0x0000, 
AR_MCI_MSG_ATTRIBUTES_TABLE_CHECKSUM
)));

1004 i‡(
	`MCI_ANT_ARCH_PA_LNA_SHARED
(
mci
))

1005 
	`REG_CLR_BIT
(
ah
, 
AR_MCI_TX_CTRL
,

1006 
AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
);

1008 
	`REG_SET_BIT
(
ah
, 
AR_MCI_TX_CTRL
,

1009 
AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
);

1011 
	`¨9003_mci_ob£rv©i⁄_£t_up
(
ah
);

1013 
mci
->
ªady
 = 
åue
;

1014 
	`¨9003_mci_¥ï_öãrÁ˚
(
ah
);

1015 
	`¨9003_mci_°©_£tup
(
ah
);

1017 i‡(
í_öt
)

1018 
	`¨9003_mci_íabÀ_öãºu±
(
ah
);

1020 i‡(
	`©h9k_hw_is_aic_íabÀd
(
ah
))

1021 
	`¨9003_aic_°¨t_n‹mÆ
(
ah
);

1024 
	}
}

1026 
	$¨9003_mci_°›_bt
(
©h_hw
 *
ah
, 
boﬁ
 
ßve_fuŒ¶ìp
)

1028 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

1030 
	`¨9003_mci_dißbÀ_öãºu±
(
ah
);

1032 i‡(
mci_hw
->
ªady
 && !
ßve_fuŒ¶ìp
) {

1033 
	`¨9003_mci_muã_bt
(
ah
);

1034 
	`udñay
(20);

1035 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL
, 0);

1038 
mci_hw
->
bt_°©e
 = 
MCI_BT_SLEEP
;

1039 
mci_hw
->
ªady
 = 
Ál£
;

1040 
	}
}

1042 
	$¨9003_mci_£nd_2g5g_°©us
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

1044 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1045 
u32
 
√w_Êags
, 
to_£t
, 
to_˛ór
;

1047 i‡(!
mci
->
upd©e_2g5g
 || (mci->
bt_°©e
 =
MCI_BT_SLEEP
))

1050 i‡(
mci
->
is_2g
) {

1051 
√w_Êags
 = 
MCI_2G_FLAGS
;

1052 
to_˛ór
 = 
MCI_2G_FLAGS_CLEAR_MASK
;

1053 
to_£t
 = 
MCI_2G_FLAGS_SET_MASK
;

1055 
√w_Êags
 = 
MCI_5G_FLAGS
;

1056 
to_˛ór
 = 
MCI_5G_FLAGS_CLEAR_MASK
;

1057 
to_£t
 = 
MCI_5G_FLAGS_SET_MASK
;

1060 i‡(
to_˛ór
)

1061 
	`¨9003_mci_£nd_c€x_bt_Êags
(
ah
, 
waô_d⁄e
,

1062 
MCI_GPM_COEX_BT_FLAGS_CLEAR
,

1063 
to_˛ór
);

1064 i‡(
to_£t
)

1065 
	`¨9003_mci_£nd_c€x_bt_Êags
(
ah
, 
waô_d⁄e
,

1066 
MCI_GPM_COEX_BT_FLAGS_SET
,

1067 
to_£t
);

1068 
	}
}

1070 
	$¨9003_mci_queue_un£¡_gpm
(
©h_hw
 *
ah
, 
u8
 
hódî
,

1071 
u32
 *
∑ylﬂd
, 
boﬁ
 
queue
)

1073 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1074 
u8
 
ty≥
, 
›code
;

1077 i‡(
hódî
 !
MCI_GPM
)

1080 
ty≥
 = 
	`MCI_GPM_TYPE
(
∑ylﬂd
);

1081 
›code
 = 
	`MCI_GPM_OPCODE
(
∑ylﬂd
);

1083 i‡(
ty≥
 !
MCI_GPM_COEX_AGENT
)

1086 
›code
) {

1087 
MCI_GPM_COEX_BT_UPDATE_FLAGS
:

1088 i‡(*(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_BT_FLAGS_OP
) ==

1089 
MCI_GPM_COEX_BT_FLAGS_READ
)

1092 
mci
->
upd©e_2g5g
 = 
queue
;

1095 
MCI_GPM_COEX_WLAN_CHANNELS
:

1096 
mci
->
wœn_ch™√ls_upd©e
 = 
queue
;

1098 
MCI_GPM_COEX_HALT_BT_GPM
:

1099 i‡(*(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_HALT_STATE
) ==

1100 
MCI_GPM_COEX_BT_GPM_UNHALT
) {

1101 
mci
->
unhÆt_bt_gpm
 = 
queue
;

1103 i‡(!
queue
)

1104 
mci
->
hÆãd_bt_gpm
 = 
Ál£
;

1107 i‡(*(((
u8
 *)
∑ylﬂd
Ë+ 
MCI_GPM_COEX_B_HALT_STATE
) ==

1108 
MCI_GPM_COEX_BT_GPM_HALT
) {

1110 
mci
->
hÆãd_bt_gpm
 = !
queue
;

1117 
	}
}

1119 
	$¨9003_mci_2g5g_swôch
(
©h_hw
 *
ah
, 
boﬁ
 
f‹˚
)

1121 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1123 i‡(!
mci
->
upd©e_2g5g
 && !
f‹˚
)

1126 i‡(
mci
->
is_2g
) {

1127 
	`¨9003_mci_£nd_2g5g_°©us
(
ah
, 
åue
);

1128 
	`¨9003_mci_£nd_ a_å™s„r
(
ah
, 
åue
);

1129 
	`udñay
(5);

1131 
	`REG_CLR_BIT
(
ah
, 
AR_MCI_TX_CTRL
,

1132 
AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
);

1133 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_GLB_CONTROL
,

1134 
AR_BTCOEX_CTRL_BT_OWN_SPDT_CTRL
);

1136 i‡(!(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_OSLA
))

1137 
	`¨9003_mci_o¶a_£tup
(
ah
, 
åue
);

1139 i‡(
	`AR_SREV_9462
(
ah
))

1140 
	`REG_WRITE
(
ah
, 
AR_SELFGEN_MASK
, 0x02);

1142 
	`¨9003_mci_£nd_ a_èke
(
ah
, 
åue
);

1143 
	`udñay
(5);

1145 
	`REG_SET_BIT
(
ah
, 
AR_MCI_TX_CTRL
,

1146 
AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
);

1147 
	`REG_SET_BIT
(
ah
, 
AR_PHY_GLB_CONTROL
,

1148 
AR_BTCOEX_CTRL_BT_OWN_SPDT_CTRL
);

1150 
	`¨9003_mci_o¶a_£tup
(
ah
, 
Ál£
);

1151 
	`¨9003_mci_£nd_2g5g_°©us
(
ah
, 
åue
);

1153 
	}
}

1155 
boﬁ
 
	$¨9003_mci_£nd_mesßge
(
©h_hw
 *
ah
, 
u8
 
hódî
, 
u32
 
Êag
,

1156 
u32
 *
∑ylﬂd
, 
u8
 
Àn
, 
boﬁ
 
waô_d⁄e
,

1157 
boﬁ
 
check_bt
)

1159 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1160 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1161 
boﬁ
 
msg_£¡
 = 
Ál£
;

1162 
u32
 
ªgvÆ
;

1163 
u32
 
ßved_mci_öt_í
;

1164 
i
;

1166 
ßved_mci_öt_í
 = 
	`REG_READ
(
ah
, 
AR_MCI_INTERRUPT_EN
);

1167 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_BTCOEX_CTRL
);

1169 i‡((
ªgvÆ
 =0xdódbìfË|| !‘egvÆ & 
AR_BTCOEX_CTRL_MCI_MODE_EN
)) {

1170 
	`©h_dbg
(
comm⁄
, 
MCI
,

1172 
hódî
, (
ah
->
powî_mode
 =
ATH9K_PM_FULL_SLEEP
) ? 1 : 0);

1173 
	`¨9003_mci_queue_un£¡_gpm
(
ah
, 
hódî
, 
∑ylﬂd
, 
åue
);

1174  
Ál£
;

1175 } i‡(
check_bt
 && (
mci
->
bt_°©e
 =
MCI_BT_SLEEP
)) {

1176 
	`©h_dbg
(
comm⁄
, 
MCI
,

1178 
hódî
);

1179 
	`¨9003_mci_queue_un£¡_gpm
(
ah
, 
hódî
, 
∑ylﬂd
, 
åue
);

1180  
Ál£
;

1183 i‡(
waô_d⁄e
)

1184 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 0);

1188 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RAW
,

1189 (
AR_MCI_INTERRUPT_SW_MSG_DONE
 |

1190 
AR_MCI_INTERRUPT_MSG_FAIL_MASK
));

1192 i‡(
∑ylﬂd
) {

1193 
i
 = 0; (ò* 4Ë< 
Àn
; i++)

1194 
	`REG_WRITE
(
ah
, (
AR_MCI_TX_PAYLOAD0
 + 
i
 * 4),

1195 *(
∑ylﬂd
 + 
i
));

1198 
	`REG_WRITE
(
ah
, 
AR_MCI_COMMAND0
,

1199 (
	`SM
((
Êag
 & 
MCI_FLAG_DISABLE_TIMESTAMP
),

1200 
AR_MCI_COMMAND0_DISABLE_TIMESTAMP
) |

1201 
	`SM
(
Àn
, 
AR_MCI_COMMAND0_LEN
) |

1202 
	`SM
(
hódî
, 
AR_MCI_COMMAND0_HEADER
)));

1204 i‡(
waô_d⁄e
 &&

1205 !(
	`¨9003_mci_waô_f‹_öãºu±
(
ah
, 
AR_MCI_INTERRUPT_RAW
,

1206 
AR_MCI_INTERRUPT_SW_MSG_DONE
, 500)))

1207 
	`¨9003_mci_queue_un£¡_gpm
(
ah
, 
hódî
, 
∑ylﬂd
, 
åue
);

1209 
	`¨9003_mci_queue_un£¡_gpm
(
ah
, 
hódî
, 
∑ylﬂd
, 
Ál£
);

1210 
msg_£¡
 = 
åue
;

1213 i‡(
waô_d⁄e
)

1214 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_EN
, 
ßved_mci_öt_í
);

1216  
msg_£¡
;

1217 
	}
}

1218 
EXPORT_SYMBOL
(
¨9003_mci_£nd_mesßge
);

1220 
	$¨9003_mci_öô_ˇl_ªq
(
©h_hw
 *
ah
, 
boﬁ
 *
is_ªußbÀ
)

1222 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1223 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

1224 
u32
 
∂d
[4] = {0, 0, 0, 0};

1226 i‡((
mci_hw
->
bt_°©e
 !
MCI_BT_AWAKE
) ||

1227 (
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_MCI_CAL
))

1230 
	`MCI_GPM_SET_CAL_TYPE
(
∂d
, 
MCI_GPM_WLAN_CAL_REQ
);

1231 
∂d
[
MCI_GPM_WLAN_CAL_W_SEQUENCE
] = 
mci_hw
->
wœn_ˇl_£q
++;

1233 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∂d
, 16, 
åue
, 
Ál£
);

1235 i‡(
	`¨9003_mci_waô_f‹_gpm
(
ah
, 
MCI_GPM_BT_CAL_GRANT
, 0, 50000)) {

1236 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI BT_CAL_GRANTÑeceived\n");

1238 *
is_ªußbÀ
 = 
Ál£
;

1239 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI BT_CAL_GRANTÇotÑeceived\n");

1241 
	}
}

1243 
	$¨9003_mci_öô_ˇl_d⁄e
(
©h_hw
 *
ah
)

1245 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

1246 
u32
 
∂d
[4] = {0, 0, 0, 0};

1248 i‡((
mci_hw
->
bt_°©e
 !
MCI_BT_AWAKE
) ||

1249 (
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_MCI_CAL
))

1252 
	`MCI_GPM_SET_CAL_TYPE
(
∂d
, 
MCI_GPM_WLAN_CAL_DONE
);

1253 
∂d
[
MCI_GPM_WLAN_CAL_W_SEQUENCE
] = 
mci_hw
->
wœn_ˇl_d⁄e
++;

1254 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_GPM
, 0, 
∂d
, 16, 
åue
, 
Ál£
);

1255 
	}
}

1257 
	$¨9003_mci_£tup
(
©h_hw
 *
ah
, 
u32
 
gpm_addr
, *
gpm_buf
,

1258 
u16
 
Àn
, 
u32
 
sched_addr
)

1260 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1262 
mci
->
gpm_addr
 = gpm_addr;

1263 
mci
->
gpm_buf
 = gpm_buf;

1264 
mci
->
gpm_Àn
 = 
Àn
;

1265 
mci
->
sched_addr
 = sched_addr;

1267  
	`¨9003_mci_ª£t
(
ah
, 
åue
,Årue,Årue);

1268 
	}
}

1269 
EXPORT_SYMBOL
(
¨9003_mci_£tup
);

1271 
	$¨9003_mci_˛ónup
(
©h_hw
 *
ah
)

1274 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL
, 0x00);

1275 
	`¨9003_mci_dißbÀ_öãºu±
(
ah
);

1276 
	}
}

1277 
EXPORT_SYMBOL
(
¨9003_mci_˛ónup
);

1279 
u32
 
	$¨9003_mci_°©e
(
©h_hw
 *
ah
, 
u32
 
°©e_ty≥
)

1281 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1282 
u32
 
vÆue
 = 0, 
tsf
;

1283 
u8
 
quîy_ty≥
;

1285 
°©e_ty≥
) {

1286 
MCI_STATE_ENABLE
:

1287 i‡(
mci
->
ªady
) {

1288 
vÆue
 = 
	`REG_READ
(
ah
, 
AR_BTCOEX_CTRL
);

1290 i‡((
vÆue
 == 0xdeadbeef) || (value == 0xffffffff))

1291 
vÆue
 = 0;

1293 
vÆue
 &
AR_BTCOEX_CTRL_MCI_MODE_EN
;

1295 
MCI_STATE_INIT_GPM_OFFSET
:

1296 
vÆue
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_GPM_1
), 
AR_MCI_GPM_WRITE_PTR
);

1298 i‡(
vÆue
 < 
mci
->
gpm_Àn
)

1299 
mci
->
gpm_idx
 = 
vÆue
;

1301 
mci
->
gpm_idx
 = 0;

1303 
MCI_STATE_LAST_SCHD_MSG_OFFSET
:

1304 
vÆue
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_RX_STATUS
),

1305 
AR_MCI_RX_LAST_SCHD_MSG_INDEX
);

1307 
vÆue
 <<= 4;

1309 
MCI_STATE_REMOTE_SLEEP
:

1310 
vÆue
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_RX_STATUS
),

1311 
AR_MCI_RX_REMOTE_SLEEP
) ?

1312 
MCI_BT_SLEEP
 : 
MCI_BT_AWAKE
;

1314 
MCI_STATE_SET_BT_AWAKE
:

1315 
mci
->
bt_°©e
 = 
MCI_BT_AWAKE
;

1316 
	`¨9003_mci_£nd_c€x_vîsi⁄_quîy
(
ah
, 
åue
);

1317 
	`¨9003_mci_£nd_c€x_wœn_ch™√ls
(
ah
, 
åue
);

1319 i‡(
mci
->
unhÆt_bt_gpm
)

1320 
	`¨9003_mci_£nd_c€x_hÆt_bt_gpm
(
ah
, 
Ál£
, 
åue
);

1322 
	`¨9003_mci_2g5g_swôch
(
ah
, 
Ál£
);

1324 
MCI_STATE_RESET_REQ_WAKE
:

1325 
	`¨9003_mci_ª£t_ªq_wakeup
(
ah
);

1326 
mci
->
upd©e_2g5g
 = 
åue
;

1328 i‡(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_MCI_OBS_MASK
) {

1330 i‡((
	`REG_READ
(
ah
, 
AR_GLB_GPIO_CONTROL
) &

1331 
ATH_MCI_CONFIG_MCI_OBS_GPIO
) !=

1332 
ATH_MCI_CONFIG_MCI_OBS_GPIO
) {

1333 
	`¨9003_mci_ob£rv©i⁄_£t_up
(
ah
);

1337 
MCI_STATE_SEND_WLAN_COEX_VERSION
:

1338 
	`¨9003_mci_£nd_c€x_vîsi⁄_ª•⁄£
(
ah
, 
åue
);

1340 
MCI_STATE_SEND_VERSION_QUERY
:

1341 
	`¨9003_mci_£nd_c€x_vîsi⁄_quîy
(
ah
, 
åue
);

1343 
MCI_STATE_SEND_STATUS_QUERY
:

1344 
quîy_ty≥
 = 
MCI_GPM_COEX_QUERY_BT_TOPOLOGY
;

1345 
	`¨9003_mci_£nd_c€x_bt_°©us_quîy
(
ah
, 
åue
, 
quîy_ty≥
);

1347 
MCI_STATE_RECOVER_RX
:

1348 
tsf
 = 
	`©h9k_hw_gëtsf32
(
ah
);

1349 i‡((
tsf
 - 
mci
->
œ°_ªcovîy
Ë<
MCI_RECOVERY_DUR_TSF
) {

1350 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
MCI
,

1354 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
MCI
, "(MCI) RECOVER RX\n");

1355 
mci
->
œ°_ªcovîy
 = 
tsf
;

1356 
	`¨9003_mci_¥ï_öãrÁ˚
(
ah
);

1357 
mci
->
quîy_bt
 = 
åue
;

1358 
mci
->
√ed_Êush_btöfo
 = 
åue
;

1359 
	`¨9003_mci_£nd_c€x_wœn_ch™√ls
(
ah
, 
åue
);

1360 
	`¨9003_mci_2g5g_swôch
(
ah
, 
Ál£
);

1362 
MCI_STATE_NEED_FTP_STOMP
:

1363 
vÆue
 = !(
mci
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_FTP_STOMP
);

1365 
MCI_STATE_NEED_FLUSH_BT_INFO
:

1366 
vÆue
 = (!
mci
->
unhÆt_bt_gpm
 && mci->
√ed_Êush_btöfo
) ? 1 : 0;

1367 
mci
->
√ed_Êush_btöfo
 = 
Ál£
;

1369 
MCI_STATE_AIC_CAL
:

1370 i‡(
	`©h9k_hw_is_aic_íabÀd
(
ah
))

1371 
vÆue
 = 
	`¨9003_aic_ˇlibøti⁄
(
ah
);

1373 
MCI_STATE_AIC_START
:

1374 i‡(
	`©h9k_hw_is_aic_íabÀd
(
ah
))

1375 
	`¨9003_aic_°¨t_n‹mÆ
(
ah
);

1377 
MCI_STATE_AIC_CAL_RESET
:

1378 i‡(
	`©h9k_hw_is_aic_íabÀd
(
ah
))

1379 
vÆue
 = 
	`¨9003_aic_ˇl_ª£t
(
ah
);

1381 
MCI_STATE_AIC_CAL_SINGLE
:

1382 i‡(
	`©h9k_hw_is_aic_íabÀd
(
ah
))

1383 
vÆue
 = 
	`¨9003_aic_ˇlibøti⁄_sögÀ
(
ah
);

1389  
vÆue
;

1390 
	}
}

1391 
EXPORT_SYMBOL
(
¨9003_mci_°©e
);

1393 
	$¨9003_mci_bt_gaö_˘æ
(
©h_hw
 *
ah
)

1395 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1396 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1398 
	`©h_dbg
(
comm⁄
, 
MCI
, "Give LNAánd SPDT controlÅo BT\n");

1400 
	`¨9003_mci_£nd_ a_èke
(
ah
, 
åue
);

1401 
	`udñay
(50);

1403 
	`REG_SET_BIT
(
ah
, 
AR_PHY_GLB_CONTROL
, 
AR_BTCOEX_CTRL_BT_OWN_SPDT_CTRL
);

1404 
mci
->
is_2g
 = 
Ál£
;

1405 
mci
->
upd©e_2g5g
 = 
åue
;

1406 
	`¨9003_mci_£nd_2g5g_°©us
(
ah
, 
åue
);

1409 
mci
->
upd©e_2g5g
 = 
åue
;

1410 
	}
}

1412 
	$¨9003_mci_£t_powî_awake
(
©h_hw
 *
ah
)

1414 
u32
 
btc€x_˘æ2
, 
düg_sw
;

1415 
i
;

1416 
u8
 
 a_˘æ
, 
bt_¶ìp
;

1418 
i
 = 0; i < 
AH_WAIT_TIMEOUT
; i++) {

1419 
btc€x_˘æ2
 = 
	`REG_READ
(
ah
, 
AR_BTCOEX_CTRL2
);

1420 i‡(
btc€x_˘æ2
 != 0xdeadbeef)

1422 
	`udñay
(
AH_TIME_QUANTUM
);

1424 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL2
, (
btc€x_˘æ2
 | 
	`BIT
(23)));

1426 
i
 = 0; i < 
AH_WAIT_TIMEOUT
; i++) {

1427 
düg_sw
 = 
	`REG_READ
(
ah
, 
AR_DIAG_SW
);

1428 i‡(
düg_sw
 != 0xdeadbeef)

1430 
	`udñay
(
AH_TIME_QUANTUM
);

1432 
	`REG_WRITE
(
ah
, 
AR_DIAG_SW
, (
düg_sw
 | 
	`BIT
(27) | BIT(19) | BIT(18)));

1433 
 a_˘æ
 = 
	`REG_READ
(
ah
, 
AR_OBS_BUS_CTRL
) & 0x3;

1434 
bt_¶ìp
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_RX_STATUS
), 
AR_MCI_RX_REMOTE_SLEEP
);

1436 
	`REG_WRITE
(
ah
, 
AR_BTCOEX_CTRL2
, 
btc€x_˘æ2
);

1437 
	`REG_WRITE
(
ah
, 
AR_DIAG_SW
, 
düg_sw
);

1439 i‡(
bt_¶ìp
 && (
 a_˘æ
 == 2)) {

1440 
	`REG_SET_BIT
(
ah
, 
AR_BTCOEX_RC
, 0x1);

1441 
	`REG_CLR_BIT
(
ah
, 
AR_BTCOEX_RC
, 0x1);

1442 
	`udñay
(50);

1444 
	}
}

1446 
	$¨9003_mci_check_gpm_off£t
(
©h_hw
 *
ah
)

1448 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1449 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1450 
u32
 
off£t
;

1455 
off£t
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_GPM_1
), 
AR_MCI_GPM_WRITE_PTR
);

1456 i‡(
mci
->
gpm_idx
 =
off£t
)

1458 
	`©h_dbg
(
comm⁄
, 
MCI
, "GPM cached writeÖointer mismatch %d %d\n",

1459 
mci
->
gpm_idx
, 
off£t
);

1460 
mci
->
quîy_bt
 = 
åue
;

1461 
mci
->
√ed_Êush_btöfo
 = 
åue
;

1462 
mci
->
gpm_idx
 = 0;

1463 
	}
}

1465 
u32
 
	$¨9003_mci_gë_√xt_gpm_off£t
(
©h_hw
 *
ah
, 
u32
 *
m‹e
)

1467 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1468 
u32
 
off£t
, 
m‹e_gpm
 = 0, 
gpm_±r
;

1479 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_RAW
,

1480 
AR_MCI_INTERRUPT_RX_MSG_GPM
);

1482 
gpm_±r
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_MCI_GPM_1
), 
AR_MCI_GPM_WRITE_PTR
);

1483 
off£t
 = 
gpm_±r
;

1485 i‡(!
off£t
)

1486 
off£t
 = 
mci
->
gpm_Àn
 - 1;

1487 i‡(
off£t
 >
mci
->
gpm_Àn
) {

1488 i‡(
off£t
 != 0xFFFF)

1489 
off£t
 = 0;

1491 
off£t
--;

1494 i‡((
off£t
 =0xFFFFË|| (
gpm_±r
 =
mci
->
gpm_idx
)) {

1495 
off£t
 = 
MCI_GPM_INVALID
;

1496 
m‹e_gpm
 = 
MCI_GPM_NOMORE
;

1497 
out
;

1500 
u32
 
ãmp_ödex
;

1504 i‡(
off£t
 !
mci
->
gpm_idx
)

1505 
m‹e_gpm
 = 
MCI_GPM_MORE
;

1507 
m‹e_gpm
 = 
MCI_GPM_NOMORE
;

1509 
ãmp_ödex
 = 
mci
->
gpm_idx
;

1511 i‡(
ãmp_ödex
 >
mci
->
gpm_Àn
)

1512 
ãmp_ödex
 = 0;

1514 
mci
->
gpm_idx
++;

1516 i‡(
mci
->
gpm_idx
 >mci->
gpm_Àn
)

1517 
mci
->
gpm_idx
 = 0;

1519 i‡(
	`¨9003_mci_is_gpm_vÆid
(
ah
, 
ãmp_ödex
)) {

1520 
off£t
 = 
ãmp_ödex
;

1524 i‡(
m‹e_gpm
 =
MCI_GPM_NOMORE
) {

1525 
off£t
 = 
MCI_GPM_INVALID
;

1530 i‡(
off£t
 !
MCI_GPM_INVALID
)

1531 
off£t
 <<= 4;

1532 
out
:

1533 i‡(
m‹e
)

1534 *
m‹e
 = 
m‹e_gpm
;

1536  
off£t
;

1537 
	}
}

1538 
EXPORT_SYMBOL
(
¨9003_mci_gë_√xt_gpm_off£t
);

1540 
	$¨9003_mci_£t_bt_vîsi⁄
(
©h_hw
 *
ah
, 
u8
 
maj‹
, u8 
mö‹
)

1542 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1544 
mci
->
bt_vî_maj‹
 = 
maj‹
;

1545 
mci
->
bt_vî_mö‹
 = 
mö‹
;

1546 
mci
->
bt_vîsi⁄_known
 = 
åue
;

1547 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
MCI
, "MCI BT version set: %d.%d\n",

1548 
mci
->
bt_vî_maj‹
, mci->
bt_vî_mö‹
);

1549 
	}
}

1550 
EXPORT_SYMBOL
(
¨9003_mci_£t_bt_vîsi⁄
);

1552 
	$¨9003_mci_£nd_wœn_ch™√ls
(
©h_hw
 *
ah
)

1554 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

1556 
mci
->
wœn_ch™√ls_upd©e
 = 
åue
;

1557 
	`¨9003_mci_£nd_c€x_wœn_ch™√ls
(
ah
, 
åue
);

1558 
	}
}

1559 
EXPORT_SYMBOL
(
¨9003_mci_£nd_wœn_ch™√ls
);

1561 
u16
 
	$¨9003_mci_gë_max_txpowî
(
©h_hw
 *
ah
, 
u8
 
˘lmode
)

1563 i‡(!
ah
->
btc€x_hw
.
mci
.
c⁄cur_tx
)

1564 
out
;

1566 i‡(
˘lmode
 =
CTL_2GHT20
)

1567  
ATH_BTCOEX_HT20_MAX_TXPOWER
;

1568 i‡(
˘lmode
 =
CTL_2GHT40
)

1569  
ATH_BTCOEX_HT40_MAX_TXPOWER
;

1571 
out
:

1573 
	}
}

	@ar9003_mci.h

17 #i‚de‡
AR9003_MCI_H


18 
	#AR9003_MCI_H


	)

20 
	#MCI_FLAG_DISABLE_TIMESTAMP
 0x00000001

	)

21 
	#MCI_RECOVERY_DUR_TSF
 (100 * 1000Ë

	)

24 
	#MCI_GPM_COEX_MAJOR_VERSION_DEFAULT
 3

	)

25 
	#MCI_GPM_COEX_MINOR_VERSION_DEFAULT
 0

	)

28 
	#MCI_GPM_COEX_MAJOR_VERSION_WLAN
 3

	)

29 
	#MCI_GPM_COEX_MINOR_VERSION_WLAN
 0

	)

31 
	emci_gpm_c€x_quîy_ty≥
 {

32 
	mMCI_GPM_COEX_QUERY_BT_ALL_INFO
 = 
BIT
(0),

33 
	mMCI_GPM_COEX_QUERY_BT_TOPOLOGY
 = 
BIT
(1),

34 
	mMCI_GPM_COEX_QUERY_BT_DEBUG
 = 
BIT
(2),

37 
	emci_gpm_c€x_hÆt_bt_gpm
 {

38 
	mMCI_GPM_COEX_BT_GPM_UNHALT
,

39 
	mMCI_GPM_COEX_BT_GPM_HALT


42 
	emci_gpm_c€x_bt_upd©e_Êags_›
 {

43 
	mMCI_GPM_COEX_BT_FLAGS_READ
,

44 
	mMCI_GPM_COEX_BT_FLAGS_SET
,

45 
	mMCI_GPM_COEX_BT_FLAGS_CLEAR


48 
	#MCI_NUM_BT_CHANNELS
 79

	)

50 
	#MCI_BT_MCI_FLAGS_UPDATE_CORR
 0x00000002

	)

51 
	#MCI_BT_MCI_FLAGS_UPDATE_HDR
 0x00000004

	)

52 
	#MCI_BT_MCI_FLAGS_UPDATE_PLD
 0x00000008

	)

53 
	#MCI_BT_MCI_FLAGS_LNA_CTRL
 0x00000010

	)

54 
	#MCI_BT_MCI_FLAGS_DEBUG
 0x00000020

	)

55 
	#MCI_BT_MCI_FLAGS_SCHED_MSG
 0x00000040

	)

56 
	#MCI_BT_MCI_FLAGS_CONT_MSG
 0x00000080

	)

57 
	#MCI_BT_MCI_FLAGS_COEX_GPM
 0x00000100

	)

58 
	#MCI_BT_MCI_FLAGS_CPU_INT_MSG
 0x00000200

	)

59 
	#MCI_BT_MCI_FLAGS_MCI_MODE
 0x00000400

	)

60 
	#MCI_BT_MCI_FLAGS_AR9462_MODE
 0x00001000

	)

61 
	#MCI_BT_MCI_FLAGS_OTHER
 0x00010000

	)

63 
	#MCI_DEFAULT_BT_MCI_FLAGS
 0x00011dde

	)

65 
	#MCI_TOGGLE_BT_MCI_FLAGS
 (
MCI_BT_MCI_FLAGS_UPDATE_CORR
 | \

66 
MCI_BT_MCI_FLAGS_UPDATE_HDR
 | \

67 
MCI_BT_MCI_FLAGS_UPDATE_PLD
 | \

68 
MCI_BT_MCI_FLAGS_MCI_MODE
)

	)

70 
	#MCI_2G_FLAGS_CLEAR_MASK
 0x00000000

	)

71 
	#MCI_2G_FLAGS_SET_MASK
 
MCI_TOGGLE_BT_MCI_FLAGS


	)

72 
	#MCI_2G_FLAGS
 
MCI_DEFAULT_BT_MCI_FLAGS


	)

74 
	#MCI_5G_FLAGS_CLEAR_MASK
 
MCI_TOGGLE_BT_MCI_FLAGS


	)

75 
	#MCI_5G_FLAGS_SET_MASK
 0x00000000

	)

76 
	#MCI_5G_FLAGS
 (
MCI_DEFAULT_BT_MCI_FLAGS
 & \

77 ~
MCI_TOGGLE_BT_MCI_FLAGS
)

	)

82 
	#ATH_MCI_CONFIG_CONCUR_TX
 0x00000003

	)

83 
	#ATH_MCI_CONFIG_MCI_OBS_MCI
 0x00000004

	)

84 
	#ATH_MCI_CONFIG_MCI_OBS_TXRX
 0x00000008

	)

85 
	#ATH_MCI_CONFIG_MCI_OBS_BT
 0x00000010

	)

86 
	#ATH_MCI_CONFIG_DISABLE_MCI_CAL
 0x00000020

	)

87 
	#ATH_MCI_CONFIG_DISABLE_OSLA
 0x00000040

	)

88 
	#ATH_MCI_CONFIG_DISABLE_FTP_STOMP
 0x00000080

	)

89 
	#ATH_MCI_CONFIG_AGGR_THRESH
 0x00000700

	)

90 
	#ATH_MCI_CONFIG_AGGR_THRESH_S
 8

	)

91 
	#ATH_MCI_CONFIG_DISABLE_AGGR_THRESH
 0x00000800

	)

92 
	#ATH_MCI_CONFIG_CLK_DIV
 0x00003000

	)

93 
	#ATH_MCI_CONFIG_CLK_DIV_S
 12

	)

94 
	#ATH_MCI_CONFIG_DISABLE_TUNING
 0x00004000

	)

95 
	#ATH_MCI_CONFIG_DISABLE_AIC
 0x00008000

	)

96 
	#ATH_MCI_CONFIG_AIC_CAL_NUM_CHAN
 0x007f0000

	)

97 
	#ATH_MCI_CONFIG_AIC_CAL_NUM_CHAN_S
 16

	)

98 
	#ATH_MCI_CONFIG_NO_QUIET_ACK
 0x00800000

	)

99 
	#ATH_MCI_CONFIG_NO_QUIET_ACK_S
 23

	)

100 
	#ATH_MCI_CONFIG_ANT_ARCH
 0x07000000

	)

101 
	#ATH_MCI_CONFIG_ANT_ARCH_S
 24

	)

102 
	#ATH_MCI_CONFIG_FORCE_QUIET_ACK
 0x08000000

	)

103 
	#ATH_MCI_CONFIG_FORCE_QUIET_ACK_S
 27

	)

104 
	#ATH_MCI_CONFIG_FORCE_2CHAIN_ACK
 0x10000000

	)

105 
	#ATH_MCI_CONFIG_MCI_STAT_DBG
 0x20000000

	)

106 
	#ATH_MCI_CONFIG_MCI_WEIGHT_DBG
 0x40000000

	)

107 
	#ATH_MCI_CONFIG_DISABLE_MCI
 0x80000000

	)

109 
	#ATH_MCI_CONFIG_MCI_OBS_MASK
 (
ATH_MCI_CONFIG_MCI_OBS_MCI
 | \

110 
ATH_MCI_CONFIG_MCI_OBS_TXRX
 | \

111 
ATH_MCI_CONFIG_MCI_OBS_BT
)

	)

113 
	#ATH_MCI_CONFIG_MCI_OBS_GPIO
 0x0000002F

	)

115 
	#ATH_MCI_ANT_ARCH_1_ANT_PA_LNA_NON_SHARED
 0x00

	)

116 
	#ATH_MCI_ANT_ARCH_1_ANT_PA_LNA_SHARED
 0x01

	)

117 
	#ATH_MCI_ANT_ARCH_2_ANT_PA_LNA_NON_SHARED
 0x02

	)

118 
	#ATH_MCI_ANT_ARCH_2_ANT_PA_LNA_SHARED
 0x03

	)

119 
	#ATH_MCI_ANT_ARCH_3_ANT
 0x04

	)

121 
	#MCI_ANT_ARCH_PA_LNA_SHARED
(
mci
) \

122 ((
	`MS
(
mci
->
c⁄fig
, 
ATH_MCI_CONFIG_ANT_ARCH
Ë=
ATH_MCI_ANT_ARCH_1_ANT_PA_LNA_SHARED
) || \

123 (
	`MS
(
mci
->
c⁄fig
, 
ATH_MCI_CONFIG_ANT_ARCH
Ë=
ATH_MCI_ANT_ARCH_2_ANT_PA_LNA_SHARED
))

	)

125 
	emci_mesßge_hódî
 {

126 
	mMCI_LNA_CTRL
 = 0x10,

127 
	mMCI_CONT_NACK
 = 0x20,

128 
	mMCI_CONT_INFO
 = 0x30,

129 
	mMCI_CONT_RST
 = 0x40,

130 
	mMCI_SCHD_INFO
 = 0x50,

131 
	mMCI_CPU_INT
 = 0x60,

132 
	mMCI_SYS_WAKING
 = 0x70,

133 
	mMCI_GPM
 = 0x80,

134 
	mMCI_LNA_INFO
 = 0x90,

135 
	mMCI_LNA_STATE
 = 0x94,

136 
	mMCI_LNA_TAKE
 = 0x98,

137 
	mMCI_LNA_TRANS
 = 0x9c,

138 
	mMCI_SYS_SLEEPING
 = 0xa0,

139 
	mMCI_REQ_WAKE
 = 0xc0,

140 
	mMCI_DEBUG_16
 = 0xfe,

141 
	mMCI_REMOTE_RESET
 = 0xff

144 
	e©h_mci_gpm_c€x_¥ofûe_ty≥
 {

145 
	mMCI_GPM_COEX_PROFILE_UNKNOWN
,

146 
	mMCI_GPM_COEX_PROFILE_RFCOMM
,

147 
	mMCI_GPM_COEX_PROFILE_A2DP
,

148 
	mMCI_GPM_COEX_PROFILE_HID
,

149 
	mMCI_GPM_COEX_PROFILE_BNEP
,

150 
	mMCI_GPM_COEX_PROFILE_VOICE
,

151 
	mMCI_GPM_COEX_PROFILE_A2DPVO
,

152 
	mMCI_GPM_COEX_PROFILE_MAX


157 
	mMCI_GPM_COEX_W_GPM_PAYLOAD
 = 1,

158 
	mMCI_GPM_COEX_B_GPM_TYPE
 = 4,

159 
	mMCI_GPM_COEX_B_GPM_OPCODE
 = 5,

161 
	mMCI_GPM_WLAN_CAL_W_SEQUENCE
 = 2,

165 
	mMCI_GPM_COEX_B_MAJOR_VERSION
 = 6,

166 
	mMCI_GPM_COEX_B_MINOR_VERSION
 = 7,

168 
	mMCI_GPM_COEX_B_BT_BITMAP
 = 6,

169 
	mMCI_GPM_COEX_B_WLAN_BITMAP
 = 7,

171 
	mMCI_GPM_COEX_B_HALT_STATE
 = 6,

173 
	mMCI_GPM_COEX_B_CHANNEL_MAP
 = 6,

175 
	mMCI_GPM_COEX_B_PROFILE_TYPE
 = 6,

176 
	mMCI_GPM_COEX_B_PROFILE_LINKID
 = 7,

177 
	mMCI_GPM_COEX_B_PROFILE_STATE
 = 8,

178 
	mMCI_GPM_COEX_B_PROFILE_ROLE
 = 9,

179 
	mMCI_GPM_COEX_B_PROFILE_RATE
 = 10,

180 
	mMCI_GPM_COEX_B_PROFILE_VOTYPE
 = 11,

181 
	mMCI_GPM_COEX_H_PROFILE_T
 = 12,

182 
	mMCI_GPM_COEX_B_PROFILE_W
 = 14,

183 
	mMCI_GPM_COEX_B_PROFILE_A
 = 15,

185 
	mMCI_GPM_COEX_B_STATUS_TYPE
 = 6,

186 
	mMCI_GPM_COEX_B_STATUS_LINKID
 = 7,

187 
	mMCI_GPM_COEX_B_STATUS_STATE
 = 8,

189 
	mMCI_GPM_COEX_W_BT_FLAGS
 = 6,

190 
	mMCI_GPM_COEX_B_BT_FLAGS_OP
 = 10

193 
	emci_gpm_subty≥
 {

194 
	mMCI_GPM_BT_CAL_REQ
 = 0,

195 
	mMCI_GPM_BT_CAL_GRANT
 = 1,

196 
	mMCI_GPM_BT_CAL_DONE
 = 2,

197 
	mMCI_GPM_WLAN_CAL_REQ
 = 3,

198 
	mMCI_GPM_WLAN_CAL_GRANT
 = 4,

199 
	mMCI_GPM_WLAN_CAL_DONE
 = 5,

200 
	mMCI_GPM_COEX_AGENT
 = 0x0c,

201 
	mMCI_GPM_RSVD_PATTERN
 = 0xfe,

202 
	mMCI_GPM_RSVD_PATTERN32
 = 0xfefefefe,

203 
	mMCI_GPM_BT_DEBUG
 = 0xff

206 
	emci_bt_°©e
 {

207 
	mMCI_BT_SLEEP
,

208 
	mMCI_BT_AWAKE
,

209 
	mMCI_BT_CAL_START
,

210 
	mMCI_BT_CAL


213 
	emci_ps_°©e
 {

214 
	mMCI_PS_DISABLE
,

215 
	mMCI_PS_ENABLE
,

216 
	mMCI_PS_ENABLE_OFF
,

217 
	mMCI_PS_ENABLE_ON


221 
	emci_°©e_ty≥
 {

222 
	mMCI_STATE_ENABLE
,

223 
	mMCI_STATE_INIT_GPM_OFFSET
,

224 
	mMCI_STATE_CHECK_GPM_OFFSET
,

225 
	mMCI_STATE_NEXT_GPM_OFFSET
,

226 
	mMCI_STATE_LAST_GPM_OFFSET
,

227 
	mMCI_STATE_BT
,

228 
	mMCI_STATE_SET_BT_SLEEP
,

229 
	mMCI_STATE_SET_BT_AWAKE
,

230 
	mMCI_STATE_SET_BT_CAL_START
,

231 
	mMCI_STATE_SET_BT_CAL
,

232 
	mMCI_STATE_LAST_SCHD_MSG_OFFSET
,

233 
	mMCI_STATE_REMOTE_SLEEP
,

234 
	mMCI_STATE_CONT_STATUS
,

235 
	mMCI_STATE_RESET_REQ_WAKE
,

236 
	mMCI_STATE_SEND_WLAN_COEX_VERSION
,

237 
	mMCI_STATE_SET_BT_COEX_VERSION
,

238 
	mMCI_STATE_SEND_WLAN_CHANNELS
,

239 
	mMCI_STATE_SEND_VERSION_QUERY
,

240 
	mMCI_STATE_SEND_STATUS_QUERY
,

241 
	mMCI_STATE_NEED_FLUSH_BT_INFO
,

242 
	mMCI_STATE_SET_CONCUR_TX_PRI
,

243 
	mMCI_STATE_RECOVER_RX
,

244 
	mMCI_STATE_NEED_FTP_STOMP
,

245 
	mMCI_STATE_NEED_TUNING
,

246 
	mMCI_STATE_NEED_STAT_DEBUG
,

247 
	mMCI_STATE_SHARED_CHAIN_CONCUR_TX
,

248 
	mMCI_STATE_AIC_CAL
,

249 
	mMCI_STATE_AIC_START
,

250 
	mMCI_STATE_AIC_CAL_RESET
,

251 
	mMCI_STATE_AIC_CAL_SINGLE
,

252 
	mMCI_STATE_IS_AR9462
,

253 
	mMCI_STATE_IS_AR9565_1ANT
,

254 
	mMCI_STATE_IS_AR9565_2ANT
,

255 
	mMCI_STATE_WLAN_WEAK_SIGNAL
,

256 
	mMCI_STATE_SET_WLAN_PS_STATE
,

257 
	mMCI_STATE_GET_WLAN_PS_STATE
,

258 
	mMCI_STATE_DEBUG
,

259 
	mMCI_STATE_STAT_DEBUG
,

260 
	mMCI_STATE_ALLOW_FCS
,

261 
	mMCI_STATE_SET_2G_CONTENTION
,

262 
	mMCI_STATE_MAX


265 
	emci_gpm_c€x_›code
 {

266 
	mMCI_GPM_COEX_VERSION_QUERY
,

267 
	mMCI_GPM_COEX_VERSION_RESPONSE
,

268 
	mMCI_GPM_COEX_STATUS_QUERY
,

269 
	mMCI_GPM_COEX_HALT_BT_GPM
,

270 
	mMCI_GPM_COEX_WLAN_CHANNELS
,

271 
	mMCI_GPM_COEX_BT_PROFILE_INFO
,

272 
	mMCI_GPM_COEX_BT_STATUS_UPDATE
,

273 
	mMCI_GPM_COEX_BT_UPDATE_FLAGS
,

274 
	mMCI_GPM_COEX_NOOP
,

277 
	#MCI_GPM_NOMORE
 0

	)

278 
	#MCI_GPM_MORE
 1

	)

279 
	#MCI_GPM_INVALID
 0xffffffff

	)

281 
	#MCI_GPM_RECYCLE
(
_p_gpm
) do { \

282 *(((
u32
 *)
_p_gpm
Ë+ 
MCI_GPM_COEX_W_GPM_PAYLOAD
) = \

283 
MCI_GPM_RSVD_PATTERN32
; \

284 } 0)

	)

286 
	#MCI_GPM_TYPE
(
_p_gpm
) \

287 (*(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_GPM_TYPE
Ë& 0xff)

	)

289 
	#MCI_GPM_OPCODE
(
_p_gpm
) \

290 (*(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_GPM_OPCODE
Ë& 0xff)

	)

292 
	#MCI_GPM_SET_CAL_TYPE
(
_p_gpm
, 
_ˇl_ty≥
) do { \

293 *(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_GPM_TYPE
Ë(
_ˇl_ty≥
) & 0xff;\

294 } 0)

	)

296 
	#MCI_GPM_SET_TYPE_OPCODE
(
_p_gpm
, 
_ty≥
, 
_›code
) do { \

297 *(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_GPM_TYPE
Ë(
_ty≥
) & 0xff; \

298 *(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_GPM_OPCODE
Ë(
_›code
) & 0xff;\

299 } 0)

	)

301 
	#MCI_GPM_IS_CAL_TYPE
(
_ty≥
Ë((_ty≥Ë<
MCI_GPM_WLAN_CAL_DONE
)

	)

306 
boﬁ
 
¨9003_mci_£nd_mesßge
(
©h_hw
 *
ah
, 
u8
 
hódî
, 
u32
 
Êag
,

307 
u32
 *
∑ylﬂd
, 
u8
 
Àn
, 
boﬁ
 
waô_d⁄e
,

308 
boﬁ
 
check_bt
);

309 
u32
 
¨9003_mci_°©e
(
©h_hw
 *
ah
, u32 
°©e_ty≥
);

310 
¨9003_mci_£tup
(
©h_hw
 *
ah
, 
u32
 
gpm_addr
, *
gpm_buf
,

311 
u16
 
Àn
, 
u32
 
sched_addr
);

312 
¨9003_mci_˛ónup
(
©h_hw
 *
ah
);

313 
¨9003_mci_gë_öãºu±
(
©h_hw
 *
ah
, 
u32
 *
øw_öå
,

314 
u32
 *
rx_msg_öå
);

315 
u32
 
¨9003_mci_gë_√xt_gpm_off£t
(
©h_hw
 *
ah
, u32 *
m‹e
);

316 
¨9003_mci_£t_bt_vîsi⁄
(
©h_hw
 *
ah
, 
u8
 
maj‹
, u8 
mö‹
);

317 
¨9003_mci_£nd_wœn_ch™√ls
(
©h_hw
 *
ah
);

322 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


324 
¨9003_mci_°›_bt
(
©h_hw
 *
ah
, 
boﬁ
 
ßve_fuŒ¶ìp
);

325 
¨9003_mci_öô_ˇl_ªq
(
©h_hw
 *
ah
, 
boﬁ
 *
is_ªußbÀ
);

326 
¨9003_mci_öô_ˇl_d⁄e
(
©h_hw
 *
ah
);

327 
¨9003_mci_£t_fuŒ_¶ìp
(
©h_hw
 *
ah
);

328 
¨9003_mci_2g5g_swôch
(
©h_hw
 *
ah
, 
boﬁ
 
f‹˚
);

329 
¨9003_mci_check_bt
(
©h_hw
 *
ah
);

330 
boﬁ
 
¨9003_mci_°¨t_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

331 
¨9003_mci_íd_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

332 
©h9k_hw_ˇl_d©a
 *
ˇld©a
);

333 
¨9003_mci_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
í_öt
, boﬁ 
is_2g
,

334 
boﬁ
 
is_fuŒ_¶ìp
);

335 
¨9003_mci_gë_i§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
);

336 
¨9003_mci_bt_gaö_˘æ
(
©h_hw
 *
ah
);

337 
¨9003_mci_£t_powî_awake
(
©h_hw
 *
ah
);

338 
¨9003_mci_check_gpm_off£t
(
©h_hw
 *
ah
);

339 
u16
 
¨9003_mci_gë_max_txpowî
(
©h_hw
 *
ah
, 
u8
 
˘lmode
);

343 
ölöe
 
	$¨9003_mci_°›_bt
(
©h_hw
 *
ah
, 
boﬁ
 
ßve_fuŒ¶ìp
)

345 
	}
}

346 
ölöe
 
	$¨9003_mci_öô_ˇl_ªq
(
©h_hw
 *
ah
, 
boﬁ
 *
is_ªußbÀ
)

348 
	}
}

349 
ölöe
 
	$¨9003_mci_öô_ˇl_d⁄e
(
©h_hw
 *
ah
)

351 
	}
}

352 
ölöe
 
	$¨9003_mci_£t_fuŒ_¶ìp
(
©h_hw
 *
ah
)

354 
	}
}

355 
ölöe
 
	$¨9003_mci_2g5g_swôch
(
©h_hw
 *
ah
, 
boﬁ
 
waô_d⁄e
)

357 
	}
}

358 
ölöe
 
	$¨9003_mci_check_bt
(
©h_hw
 *
ah
)

360 
	}
}

361 
ölöe
 
boﬁ
 
	$¨9003_mci_°¨t_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

363  
Ál£
;

364 
	}
}

365 
ölöe
 
	$¨9003_mci_íd_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

366 
©h9k_hw_ˇl_d©a
 *
ˇld©a
)

369 
	}
}

370 
ölöe
 
	$¨9003_mci_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
í_öt
, boﬁ 
is_2g
,

371 
boﬁ
 
is_fuŒ_¶ìp
)

373 
	}
}

374 
ölöe
 
	$¨9003_mci_gë_i§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
)

376 
	}
}

377 
ölöe
 
	$¨9003_mci_bt_gaö_˘æ
(
©h_hw
 *
ah
)

379 
	}
}

380 
ölöe
 
	$¨9003_mci_£t_powî_awake
(
©h_hw
 *
ah
)

382 
	}
}

383 
ölöe
 
	$¨9003_mci_check_gpm_off£t
(
©h_hw
 *
ah
)

385 
	}
}

386 
ölöe
 
u16
 
	$¨9003_mci_gë_max_txpowî
(
©h_hw
 *
ah
, 
u8
 
˘lmode
)

389 
	}
}

	@ar9003_paprd.c

17 
	~<löux/exp‹t.h
>

18 
	~"hw.h
"

19 
	~"¨9003_phy.h
"

21 
	$¨9003_∑¥d_íabÀ
(
©h_hw
 *
ah
, 
boﬁ
 
vÆ
)

23 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

24 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

39 i‡(
	`IS_CHAN_5GHZ
(
ch™
)) {

40 i‡(
ch™
->
ch™√l
 >
UPPER_5G_SUB_BAND_START
) {

41 i‡(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt20
)

42 & 
	`BIT
(30))

43 
vÆ
 = 
Ál£
;

44 } i‡(
ch™
->
ch™√l
 >
MID_5G_SUB_BAND_START
) {

45 i‡(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt20
)

46 & 
	`BIT
(29))

47 
vÆ
 = 
Ál£
;

49 i‡(
	`À32_to_˝u
(
ìp
->
modÆHódî5G
.
∑pdR©eMaskHt20
)

50 & 
	`BIT
(28))

51 
vÆ
 = 
Ál£
;

55 i‡(
vÆ
) {

56 
ah
->
∑¥d_èbÀ_wrôe_d⁄e
 = 
åue
;

57 
	`©h9k_hw_≠∂y_txpowî
(
ah
, 
ch™
, 
Ál£
);

60 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL0_B0
,

61 
AR_PHY_PAPRD_CTRL0_PAPRD_ENABLE
, !!
vÆ
);

62 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(1))

63 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL0_B1
,

64 
AR_PHY_PAPRD_CTRL0_PAPRD_ENABLE
, !!
vÆ
);

65 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(2))

66 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL0_B2
,

67 
AR_PHY_PAPRD_CTRL0_PAPRD_ENABLE
, !!
vÆ
);

68 
	}
}

69 
EXPORT_SYMBOL
(
¨9003_∑¥d_íabÀ
);

71 
	$¨9003_gë_åaöög_powî_2g
(
©h_hw
 *
ah
)

73 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

74 
powî
, 
sˇÀ
, 
dñè
;

76 
sˇÀ
 = 
	`¨9003_gë_∑¥d_sˇÀ_Á˘‹
(
ah
, 
ch™
);

78 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah) ||

79 
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

80 
powî
 = 
ah
->
∑¥d_èrgë_powî
 + 2;

81 } i‡(
	`AR_SREV_9485
(
ah
)) {

82 
powî
 = 25;

84 
powî
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_POWERTX_RATE5
,

85 
AR_PHY_POWERTX_RATE5_POWERTXHT20_0
);

87 
dñè
 = 
	`abs
((Ë
ah
->
∑¥d_èrgë_powî
 - (Ë
powî
);

88 i‡(
dñè
 > 
sˇÀ
)

91 i‡(
dñè
 < 4)

92 
powî
 -4 - 
dñè
;

95  
powî
;

96 
	}
}

98 
	$¨9003_gë_åaöög_powî_5g
(
©h_hw
 *
ah
)

100 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

101 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

102 
powî
, 
sˇÀ
, 
dñè
;

104 
sˇÀ
 = 
	`¨9003_gë_∑¥d_sˇÀ_Á˘‹
(
ah
, 
ch™
);

106 i‡(
	`IS_CHAN_HT40
(
ch™
))

107 
powî
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_POWERTX_RATE8
,

108 
AR_PHY_POWERTX_RATE8_POWERTXHT40_5
);

110 
powî
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_POWERTX_RATE6
,

111 
AR_PHY_POWERTX_RATE6_POWERTXHT20_5
);

113 
powî
 +
sˇÀ
;

114 
dñè
 = 
	`abs
((Ë
ah
->
∑¥d_èrgë_powî
 - (Ë
powî
);

115 i‡(
dñè
 > 
sˇÀ
)

118 
	`gë_°ªams
(
ah
->
txchaömask
)) {

120 
dñè
 = 6;

123 
dñè
 = 4;

126 
dñè
 = 2;

129 
dñè
 = 0;

130 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "InvalidÅx-chainmask: %u\n",

131 
ah
->
txchaömask
);

134 
powî
 +
dñè
;

135  
powî
;

136 
	}
}

138 
	$¨9003_∑¥d_£tup_sögÀ_èbÀ
(
©h_hw
 *
ah
)

140 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

141 c⁄° 
u32
 
˘æ0
[3] = {

142 
AR_PHY_PAPRD_CTRL0_B0
,

143 
AR_PHY_PAPRD_CTRL0_B1
,

144 
AR_PHY_PAPRD_CTRL0_B2


146 c⁄° 
u32
 
˘æ1
[3] = {

147 
AR_PHY_PAPRD_CTRL1_B0
,

148 
AR_PHY_PAPRD_CTRL1_B1
,

149 
AR_PHY_PAPRD_CTRL1_B2


151 
åaöög_powî
;

152 
i
, 
vÆ
;

153 
u32
 
am2pm_mask
 = 
ah
->
∑¥d_øãmask
;

155 i‡(
	`IS_CHAN_2GHZ
(
ah
->
curch™
))

156 
åaöög_powî
 = 
	`¨9003_gë_åaöög_powî_2g
(
ah
);

158 
åaöög_powî
 = 
	`¨9003_gë_åaöög_powî_5g
(
ah
);

160 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "TrainingÖower: %d, TargetÖower: %d\n",

161 
åaöög_powî
, 
ah
->
∑¥d_èrgë_powî
);

163 i‡(
åaöög_powî
 < 0) {

164 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

166  -
ERANGE
;

168 
ah
->
∑¥d_åaöög_powî
 = 
åaöög_powî
;

170 i‡(
	`AR_SREV_9330
(
ah
))

171 
am2pm_mask
 = 0;

173 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_AM2AM
, 
AR_PHY_PAPRD_AM2AM_MASK
,

174 
ah
->
∑¥d_øãmask
);

175 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_AM2PM
, 
AR_PHY_PAPRD_AM2PM_MASK
,

176 
am2pm_mask
);

177 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_HT40
, 
AR_PHY_PAPRD_HT40_MASK
,

178 
ah
->
∑¥d_øãmask_ht40
);

180 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "PAPRD HT20 mask: 0x%x, HT40 mask: 0x%x\n",

181 
ah
->
∑¥d_øãmask
,áh->
∑¥d_øãmask_ht40
);

183 
i
 = 0; i < 
ah
->
ˇps
.
max_txchaös
; i++) {

184 
	`REG_RMW_FIELD
(
ah
, 
˘æ0
[
i
],

185 
AR_PHY_PAPRD_CTRL0_USE_SINGLE_TABLE_MASK
, 1);

186 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

187 
AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2PM_ENABLE
, 1);

188 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

189 
AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2AM_ENABLE
, 1);

190 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

191 
AR_PHY_PAPRD_CTRL1_ADAPTIVE_SCALING_ENA
, 0);

192 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

193 
AR_PHY_PAPRD_CTRL1_PA_GAIN_SCALE_FACT_MASK
, 181);

194 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

195 
AR_PHY_PAPRD_CTRL1_PAPRD_MAG_SCALE_FACT
, 361);

196 
	`REG_RMW_FIELD
(
ah
, 
˘æ1
[
i
],

197 
AR_PHY_PAPRD_CTRL1_ADAPTIVE_SCALING_ENA
, 0);

198 
	`REG_RMW_FIELD
(
ah
, 
˘æ0
[
i
],

199 
AR_PHY_PAPRD_CTRL0_PAPRD_MAG_THRSH
, 3);

202 
	`¨9003_∑¥d_íabÀ
(
ah
, 
Ál£
);

204 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

205 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_SKIP
, 0x30);

206 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

207 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_ENABLE
, 1);

208 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

209 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_TX_GAIN_FORCE
, 1);

210 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

211 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_RX_BB_GAIN_FORCE
, 0);

212 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

213 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_IQCORR_ENABLE
, 0);

214 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

215 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_AGC2_SETTLING
, 28);

216 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL1
,

217 
AR_PHY_PAPRD_TRAINER_CNTL1_CF_CF_PAPRD_TRAIN_ENABLE
, 1);

219 i‡(
	`AR_SREV_9485
(
ah
)) {

220 
vÆ
 = 148;

222 i‡(
	`IS_CHAN_2GHZ
(
ah
->
curch™
)) {

223 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah))

224 
vÆ
 = 145;

226 
vÆ
 = 147;

228 
vÆ
 = 137;

232 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL2
,

233 
AR_PHY_PAPRD_TRAINER_CNTL2_CF_PAPRD_INIT_RX_BB_GAIN
, 
vÆ
);

234 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

235 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_FINE_CORR_LEN
, 4);

236 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

237 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_COARSE_CORR_LEN
, 4);

238 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

239 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_NUM_CORR_STAGES
, 7);

240 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

241 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_MIN_LOOPBACK_DEL
, 1);

243 i‡(
	`AR_SREV_9485
(
ah
) ||

244 
	`AR_SREV_9462
(
ah
) ||

245 
	`AR_SREV_9565
(
ah
) ||

246 
	`AR_SREV_9550
(
ah
) ||

247 
	`AR_SREV_9330
(
ah
) ||

248 
	`AR_SREV_9340
(
ah
))

249 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

250 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP
, -3);

252 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

253 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP
, -6);

255 
vÆ
 = -10;

257 i‡(
	`IS_CHAN_2GHZ
(
ah
->
curch™
Ë&& !
	`AR_SREV_9462
◊hË&& !
	`AR_SREV_9565
(ah))

258 
vÆ
 = -15;

260 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

261 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_ADC_DESIRED_SIZE
,

262 
vÆ
);

263 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

264 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_BBTXMIX_DISABLE
, 1);

265 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL4
,

266 
AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_SAFETY_DELTA
, 0);

267 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL4
,

268 
AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_MIN_CORR
, 400);

269 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL4
,

270 
AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_NUM_TRAIN_SAMPLES
,

272 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_0_B0
,

273 
AR_PHY_PAPRD_PRE_POST_SCALING
, 261376);

274 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_1_B0
,

275 
AR_PHY_PAPRD_PRE_POST_SCALING
, 248079);

276 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_2_B0
,

277 
AR_PHY_PAPRD_PRE_POST_SCALING
, 233759);

278 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_3_B0
,

279 
AR_PHY_PAPRD_PRE_POST_SCALING
, 220464);

280 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_4_B0
,

281 
AR_PHY_PAPRD_PRE_POST_SCALING
, 208194);

282 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_5_B0
,

283 
AR_PHY_PAPRD_PRE_POST_SCALING
, 196949);

284 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_6_B0
,

285 
AR_PHY_PAPRD_PRE_POST_SCALING
, 185706);

286 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_PRE_POST_SCALE_7_B0
,

287 
AR_PHY_PAPRD_PRE_POST_SCALING
, 175487);

289 
	}
}

291 
	$¨9003_∑¥d_gë_gaö_èbÀ
(
©h_hw
 *
ah
)

293 
u32
 *
íåy
 = 
ah
->
∑¥d_gaö_èbÀ_íåõs
;

294 
u8
 *
ödex
 = 
ah
->
∑¥d_gaö_èbÀ_ödex
;

295 
u32
 
ªg
 = 
AR_PHY_TXGAIN_TABLE
;

296 
i
;

298 
i
 = 0; i < 
PAPRD_GAIN_TABLE_ENTRIES
; i++) {

299 
íåy
[
i
] = 
	`REG_READ
(
ah
, 
ªg
);

300 
ödex
[
i
] = (
íåy
[i] >> 24) & 0xff;

301 
ªg
 += 4;

303 
	}
}

305 
	$¨9003_gë_desúed_gaö
(
©h_hw
 *
ah
, 
chaö
,

306 
èrgë_powî
)

308 
ﬁpc_gaö_dñè
 = 0, 
˛_gaö_mod
;

309 
Æpha_thîm
, 
Æpha_vﬁt
;

310 
thîm_ˇl_vÆue
, 
vﬁt_ˇl_vÆue
;

311 
thîm_vÆue
, 
vﬁt_vÆue
;

312 
thîmÆ_gaö_c‹r
, 
vﬁège_gaö_c‹r
;

313 
desúed_sˇÀ
, 
desúed_gaö
 = 0;

314 
u32
 
ªg_ﬁpc
 = 0, 
ªg_˛_gaö
 = 0;

316 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_PAPRD_TRAINER_STAT1
,

317 
AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE
);

318 
desúed_sˇÀ
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TPC_12
,

319 
AR_PHY_TPC_12_DESIRED_SCALE_HT40_5
);

320 
Æpha_thîm
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TPC_19
,

321 
AR_PHY_TPC_19_ALPHA_THERM
);

322 
Æpha_vﬁt
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TPC_19
,

323 
AR_PHY_TPC_19_ALPHA_VOLT
);

324 
thîm_ˇl_vÆue
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TPC_18
,

325 
AR_PHY_TPC_18_THERM_CAL_VALUE
);

326 
vﬁt_ˇl_vÆue
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TPC_18
,

327 
AR_PHY_TPC_18_VOLT_CAL_VALUE
);

328 
thîm_vÆue
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_BB_THERM_ADC_4
,

329 
AR_PHY_BB_THERM_ADC_4_LATEST_THERM_VALUE
);

330 
vﬁt_vÆue
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_BB_THERM_ADC_4
,

331 
AR_PHY_BB_THERM_ADC_4_LATEST_VOLT_VALUE
);

333 
chaö
) {

335 
ªg_ﬁpc
 = 
AR_PHY_TPC_11_B0
;

336 
ªg_˛_gaö
 = 
AR_PHY_CL_TAB_0
;

339 
ªg_ﬁpc
 = 
AR_PHY_TPC_11_B1
;

340 
ªg_˛_gaö
 = 
AR_PHY_CL_TAB_1
;

343 
ªg_ﬁpc
 = 
AR_PHY_TPC_11_B2
;

344 
ªg_˛_gaö
 = 
AR_PHY_CL_TAB_2
;

347 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

348 "InvÆid chaömask: %d\n", 
chaö
);

352 
ﬁpc_gaö_dñè
 = 
	`REG_READ_FIELD
(
ah
, 
ªg_ﬁpc
,

353 
AR_PHY_TPC_11_OLPC_GAIN_DELTA
);

354 
˛_gaö_mod
 = 
	`REG_READ_FIELD
(
ah
, 
ªg_˛_gaö
,

355 
AR_PHY_CL_TAB_CL_GAIN_MOD
);

357 i‡(
ﬁpc_gaö_dñè
 >= 128)

358 
ﬁpc_gaö_dñè
 = olpc_gain_delta - 256;

360 
thîmÆ_gaö_c‹r
 = (
Æpha_thîm
 * (
thîm_vÆue
 - 
thîm_ˇl_vÆue
) +

362 
vﬁège_gaö_c‹r
 = (
Æpha_vﬁt
 * (
vﬁt_vÆue
 - 
vﬁt_ˇl_vÆue
) +

364 
desúed_gaö
 = 
èrgë_powî
 - 
ﬁpc_gaö_dñè
 - 
thîmÆ_gaö_c‹r
 -

365 
vﬁège_gaö_c‹r
 + 
desúed_sˇÀ
 + 
˛_gaö_mod
;

367  
desúed_gaö
;

368 
	}
}

370 
	$¨9003_tx_f‹˚_gaö
(
©h_hw
 *
ah
, 
gaö_ödex
)

372 
£À˘ed_gaö_íåy
, 
txbb1dbgaö
, 
txbb6dbgaö
, 
txmxrgaö
;

373 
∑drvgnA
, 
∑drvgnB
, 
∑drvgnC
, 
∑drvgnD
;

374 
u32
 *
gaö_èbÀ_íåõs
 = 
ah
->
∑¥d_gaö_èbÀ_íåõs
;

376 
£À˘ed_gaö_íåy
 = 
gaö_èbÀ_íåõs
[
gaö_ödex
];

377 
txbb1dbgaö
 = 
£À˘ed_gaö_íåy
 & 0x7;

378 
txbb6dbgaö
 = (
£À˘ed_gaö_íåy
 >> 3) & 0x3;

379 
txmxrgaö
 = (
£À˘ed_gaö_íåy
 >> 5) & 0xf;

380 
∑drvgnA
 = (
£À˘ed_gaö_íåy
 >> 9) & 0xf;

381 
∑drvgnB
 = (
£À˘ed_gaö_íåy
 >> 13) & 0xf;

382 
∑drvgnC
 = (
£À˘ed_gaö_íåy
 >> 17) & 0xf;

383 
∑drvgnD
 = (
£À˘ed_gaö_íåy
 >> 21) & 0x3;

385 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

386 
AR_PHY_TX_FORCED_GAIN_FORCED_TXBB1DBGAIN
, 
txbb1dbgaö
);

387 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

388 
AR_PHY_TX_FORCED_GAIN_FORCED_TXBB6DBGAIN
, 
txbb6dbgaö
);

389 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

390 
AR_PHY_TX_FORCED_GAIN_FORCED_TXMXRGAIN
, 
txmxrgaö
);

391 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

392 
AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNA
, 
∑drvgnA
);

393 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

394 
AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNB
, 
∑drvgnB
);

395 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

396 
AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNC
, 
∑drvgnC
);

397 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

398 
AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGND
, 
∑drvgnD
);

399 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

400 
AR_PHY_TX_FORCED_GAIN_FORCED_ENABLE_PAL
, 0);

401 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_FORCED_GAIN
,

402 
AR_PHY_TX_FORCED_GAIN_FORCE_TX_GAIN
, 0);

403 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_1
, 
AR_PHY_TPC_1_FORCED_DAC_GAIN
, 0);

404 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPC_1
, 
AR_PHY_TPC_1_FORCE_DAC_GAIN
, 0);

405 
	}
}

407 
ölöe
 
	$föd_ex≤
(
num
)

409  
	`Ês
(
num
) - 1;

410 
	}
}

412 
ölöe
 
	$föd_¥›î_sˇÀ
(
ex≤
, 
N
)

414  (
ex≤
 > 
N
) ?Éxpn - 10 : 0;

415 
	}
}

417 
	#NUM_BIN
 23

	)

419 
boﬁ
 
	$¸óã_∑_curve
(
u32
 *
d©a_L
, u32 *
d©a_U
, u32 *
∑_èbÀ
, 
u16
 *
gaö
)

421 
thªsh_accum_˙t
;

422 
x_e°
[
NUM_BIN
 + 1], 
Y
[NUM_BIN + 1], 
thëa
[NUM_BIN + 1];

423 
PA_ö
[
NUM_BIN
 + 1];

424 
B1_tmp
[
NUM_BIN
 + 1], 
B2_tmp
[NUM_BIN + 1];

425 
B1_abs_max
, 
B2_abs_max
;

426 
max_ödex
, 
sˇÀ_Á˘‹
;

427 
y_e°
[
NUM_BIN
 + 1];

428 
x_e°_fxp1_n⁄lö
, 
x_tûde
[
NUM_BIN
 + 1];

429 
x_tûde_abs
;

430 
G_fxp
, 
Y_öãr˚±
, 
‹dî_x_by_y
, 
M
, 
I
, 
L
, 
sum_y_sqr
, 
sum_y_quad
;

431 
Q_x
, 
Q_B1
, 
Q_B2
, 
bëa_øw
, 
Æpha_øw
, 
sˇÀ_B
;

432 
Q_sˇÀ_B
, 
Q_bëa
, 
Q_Æpha
, 
Æpha
, 
bëa
, 
‹dî_1
, 
‹dî_2
;

433 
‹dî1_5x
, 
‹dî2_3x
, 
‹dî1_5x_ªm
, 
‹dî2_3x_ªm
;

434 
y5
, 
y3
, 
tmp
;

435 
thëa_low_bö
 = 0;

436 
i
;

439 
thªsh_accum_˙t
 = 16;

440 
sˇÀ_Á˘‹
 = 5;

441 
max_ödex
 = 0;

442 
	`mem£t
(
thëa
, 0, (theta));

443 
	`mem£t
(
x_e°
, 0, (x_est));

444 
	`mem£t
(
Y
, 0, (Y));

445 
	`mem£t
(
y_e°
, 0, (y_est));

446 
	`mem£t
(
x_tûde
, 0, (x_tilde));

448 
i
 = 0; i < 
NUM_BIN
; i++) {

449 
s32
 
accum_˙t
, 
accum_tx
, 
accum_rx
, 
accum_™g
;

452 
accum_˙t
 = 
d©a_L
[
i
] & 0xffff;

454 i‡(
accum_˙t
 <
thªsh_accum_˙t
)

457 
max_ödex
++;

460 
accum_tx
 = ((
d©a_L
[
i
] >> 16) & 0xffff) |

461 ((
d©a_U
[
i
] & 0x7ff) << 16);

464 
accum_rx
 = ((
d©a_U
[
i
] >> 11) & 0x1f) |

465 ((
d©a_L
[
i
 + 23] & 0xffff) << 5);

468 
accum_™g
 = ((
d©a_L
[
i
 + 23] >> 16) & 0xffff) |

469 ((
d©a_U
[
i
 + 23] & 0x7ff) << 16);

471 
accum_tx
 <<
sˇÀ_Á˘‹
;

472 
accum_rx
 <<
sˇÀ_Á˘‹
;

473 
x_e°
[
max_ödex
] =

474 (((
accum_tx
 + 
accum_˙t
) /áccum_cnt) + 32) >>

475 
sˇÀ_Á˘‹
;

477 
Y
[
max_ödex
] =

478 ((((
accum_rx
 + 
accum_˙t
) /áccum_cnt) + 32) >>

479 
sˇÀ_Á˘‹
) +

480 (1 << 
sˇÀ_Á˘‹
Ë* 
i
 + 16;

482 i‡(
accum_™g
 >= (1 << 26))

483 
accum_™g
 -= 1 << 27;

485 
thëa
[
max_ödex
] =

486 ((
accum_™g
 * (1 << 
sˇÀ_Á˘‹
)Ë+ 
accum_˙t
) /

487 
accum_˙t
;

494 
i
 = 1; i < 6; i++)

495 
thëa_low_bö
 +
thëa
[
i
];

497 
thëa_low_bö
 =Åheta_low_bin / 5;

498 
i
 = 1; i < 6; i++)

499 
thëa
[
i
] = 
thëa_low_bö
;

502 
thëa
[0] = 
thëa_low_bö
;

503 
i
 = 0; i <
max_ödex
; i++)

504 
thëa
[
i
] -
thëa_low_bö
;

506 
x_e°
[0] = 0;

507 
Y
[0] = 0;

508 
sˇÀ_Á˘‹
 = 8;

511 i‡(
x_e°
[6] == x_est[3])

512  
Ál£
;

514 
G_fxp
 =

515 (((
Y
[6] - Y[3]Ë* 1 << 
sˇÀ_Á˘‹
) +

516 (
x_e°
[6] - x_est[3])) / (x_est[6] - x_est[3]);

519 i‡(
G_fxp
 == 0)

520  
Ál£
;

522 
Y_öãr˚±
 =

523 (
G_fxp
 * (
x_e°
[0] - x_est[3]) +

524 (1 << 
sˇÀ_Á˘‹
)Ë/ (1 << sˇÀ_Á˘‹Ë+ 
Y
[3];

526 
i
 = 0; i <
max_ödex
; i++)

527 
y_e°
[
i
] = 
Y
[i] - 
Y_öãr˚±
;

529 
i
 = 0; i <= 3; i++) {

530 
y_e°
[
i
] = i * 32;

531 
x_e°
[
i
] = ((
y_e°
[i] * 1 << 
sˇÀ_Á˘‹
Ë+ 
G_fxp
) / G_fxp;

534 i‡(
y_e°
[
max_ödex
] == 0)

535  
Ál£
;

537 
x_e°_fxp1_n⁄lö
 =

538 
x_e°
[
max_ödex
] - ((1 << 
sˇÀ_Á˘‹
Ë* 
y_e°
[max_index] +

539 
G_fxp
) / G_fxp;

541 
‹dî_x_by_y
 =

542 (
x_e°_fxp1_n⁄lö
 + 
y_e°
[
max_ödex
]) / y_est[max_index];

544 i‡(
‹dî_x_by_y
 == 0)

545 
M
 = 10;

546 i‡(
‹dî_x_by_y
 == 1)

547 
M
 = 9;

549 
M
 = 8;

551 
I
 = (
max_ödex
 > 15) ? 7 : max_index >> 1;

552 
L
 = 
max_ödex
 - 
I
;

553 
sˇÀ_Á˘‹
 = 8;

554 
sum_y_sqr
 = 0;

555 
sum_y_quad
 = 0;

556 
x_tûde_abs
 = 0;

558 
i
 = 0; i <
L
; i++) {

559 
y_sqr
;

560 
y_quad
;

561 
tmp_abs
;

564 i‡(
y_e°
[
i
 + 
I
] == 0)

565  
Ál£
;

567 
x_e°_fxp1_n⁄lö
 =

568 
x_e°
[
i
 + 
I
] - ((1 << 
sˇÀ_Á˘‹
Ë* 
y_e°
[i + I] +

569 
G_fxp
) / G_fxp;

571 
x_tûde
[
i
] =

572 (
x_e°_fxp1_n⁄lö
 * (1 << 
M
Ë+ 
y_e°
[
i
 + 
I
]) / y_est[i +

573 
I
];

574 
x_tûde
[
i
] =

575 (
x_tûde
[
i
] * (1 << 
M
Ë+ 
y_e°
[ò+ 
I
]) / y_est[i + I];

576 
x_tûde
[
i
] =

577 (
x_tûde
[
i
] * (1 << 
M
Ë+ 
y_e°
[ò+ 
I
]) / y_est[i + I];

578 
y_sqr
 =

579 (
y_e°
[
i
 + 
I
] * y_est[i + I] +

580 (
sˇÀ_Á˘‹
 * scale_factor)) / (scale_factor *

581 
sˇÀ_Á˘‹
);

582 
tmp_abs
 = 
	`abs
(
x_tûde
[
i
]);

583 i‡(
tmp_abs
 > 
x_tûde_abs
)

584 
x_tûde_abs
 = 
tmp_abs
;

586 
y_quad
 = 
y_sqr
 * y_sqr;

587 
sum_y_sqr
 = sum_y_sq∏+ 
y_sqr
;

588 
sum_y_quad
 = sum_y_quad + 
y_quad
;

589 
B1_tmp
[
i
] = 
y_sqr
 * (
L
 + 1);

590 
B2_tmp
[
i
] = 
y_sqr
;

593 
B1_abs_max
 = 0;

594 
B2_abs_max
 = 0;

595 
i
 = 0; i <
L
; i++) {

596 
abs_vÆ
;

598 
B1_tmp
[
i
] -
sum_y_sqr
;

599 
B2_tmp
[
i
] = 
sum_y_quad
 - 
sum_y_sqr
 * B2_tmp[i];

601 
abs_vÆ
 = 
	`abs
(
B1_tmp
[
i
]);

602 i‡(
abs_vÆ
 > 
B1_abs_max
)

603 
B1_abs_max
 = 
abs_vÆ
;

605 
abs_vÆ
 = 
	`abs
(
B2_tmp
[
i
]);

606 i‡(
abs_vÆ
 > 
B2_abs_max
)

607 
B2_abs_max
 = 
abs_vÆ
;

610 
Q_x
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
x_tûde_abs
), 10);

611 
Q_B1
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
B1_abs_max
), 10);

612 
Q_B2
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
B2_abs_max
), 10);

614 
bëa_øw
 = 0;

615 
Æpha_øw
 = 0;

616 
i
 = 0; i <
L
; i++) {

617 
x_tûde
[
i
] = x_tûde[i] / (1 << 
Q_x
);

618 
B1_tmp
[
i
] = B1_tmp[i] / (1 << 
Q_B1
);

619 
B2_tmp
[
i
] = B2_tmp[i] / (1 << 
Q_B2
);

620 
bëa_øw
 = bëa_øw + 
B1_tmp
[
i
] * 
x_tûde
[i];

621 
Æpha_øw
 =áÕha_øw + 
B2_tmp
[
i
] * 
x_tûde
[i];

624 
sˇÀ_B
 =

625 ((
sum_y_quad
 / 
sˇÀ_Á˘‹
Ë* (
L
 + 1) -

626 (
sum_y_sqr
 / 
sˇÀ_Á˘‹
) * sum_y_sqr) * scale_factor;

628 
Q_sˇÀ_B
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
	`abs
(
sˇÀ_B
)), 10);

629 
sˇÀ_B
 = sˇÀ_B / (1 << 
Q_sˇÀ_B
);

630 i‡(
sˇÀ_B
 == 0)

631  
Ál£
;

632 
Q_bëa
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
	`abs
(
bëa_øw
)), 10);

633 
Q_Æpha
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
	`abs
(
Æpha_øw
)), 10);

634 
bëa_øw
 = bëa_øw / (1 << 
Q_bëa
);

635 
Æpha_øw
 =áÕha_øw / (1 << 
Q_Æpha
);

636 
Æpha
 = (
Æpha_øw
 << 10Ë/ 
sˇÀ_B
;

637 
bëa
 = (
bëa_øw
 << 10Ë/ 
sˇÀ_B
;

638 
‹dî_1
 = 3 * 
M
 - 
Q_x
 - 
Q_B1
 - 
Q_bëa
 + 10 + 
Q_sˇÀ_B
;

639 
‹dî_2
 = 3 * 
M
 - 
Q_x
 - 
Q_B2
 - 
Q_Æpha
 + 10 + 
Q_sˇÀ_B
;

640 
‹dî1_5x
 = 
‹dî_1
 / 5;

641 
‹dî2_3x
 = 
‹dî_2
 / 3;

642 
‹dî1_5x_ªm
 = 
‹dî_1
 - 5 * 
‹dî1_5x
;

643 
‹dî2_3x_ªm
 = 
‹dî_2
 - 3 * 
‹dî2_3x
;

645 
i
 = 0; i < 
PAPRD_TABLE_SZ
; i++) {

646 
tmp
 = 
i
 * 32;

647 
y5
 = ((
bëa
 * 
tmp
Ë>> 6Ë>> 
‹dî1_5x
;

648 
y5
 = (y5 * 
tmp
Ë>> 
‹dî1_5x
;

649 
y5
 = (y5 * 
tmp
Ë>> 
‹dî1_5x
;

650 
y5
 = (y5 * 
tmp
Ë>> 
‹dî1_5x
;

651 
y5
 = (y5 * 
tmp
Ë>> 
‹dî1_5x
;

652 
y5
 = y5 >> 
‹dî1_5x_ªm
;

653 
y3
 = (
Æpha
 * 
tmp
Ë>> 
‹dî2_3x
;

654 
y3
 = (y3 * 
tmp
Ë>> 
‹dî2_3x
;

655 
y3
 = (y3 * 
tmp
Ë>> 
‹dî2_3x
;

656 
y3
 = y3 >> 
‹dî2_3x_ªm
;

657 
PA_ö
[
i
] = 
y5
 + 
y3
 + (256 * 
tmp
Ë/ 
G_fxp
;

659 i‡(
i
 >= 2) {

660 
tmp
 = 
PA_ö
[
i
] - PA_in[i - 1];

661 i‡(
tmp
 < 0)

662 
PA_ö
[
i
] =

663 
PA_ö
[
i
 - 1] + (PA_in[i - 1] -

664 
PA_ö
[
i
 - 2]);

667 
PA_ö
[
i
] = (PA_in[i] < 1400) ? PA_in[i] : 1400;

670 
bëa_øw
 = 0;

671 
Æpha_øw
 = 0;

673 
i
 = 0; i <
L
; i++) {

674 
thëa_tûde
 =

675 ((
thëa
[
i
 + 
I
] << 
M
Ë+ 
y_e°
[i + I]) / y_est[i + I];

676 
thëa_tûde
 =

677 ((
thëa_tûde
 << 
M
Ë+ 
y_e°
[
i
 + 
I
]) / y_est[i + I];

678 
thëa_tûde
 =

679 ((
thëa_tûde
 << 
M
Ë+ 
y_e°
[
i
 + 
I
]) / y_est[i + I];

680 
bëa_øw
 = bëa_øw + 
B1_tmp
[
i
] * 
thëa_tûde
;

681 
Æpha_øw
 =áÕha_øw + 
B2_tmp
[
i
] * 
thëa_tûde
;

684 
Q_bëa
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
	`abs
(
bëa_øw
)), 10);

685 
Q_Æpha
 = 
	`föd_¥›î_sˇÀ
(
	`föd_ex≤
(
	`abs
(
Æpha_øw
)), 10);

686 
bëa_øw
 = bëa_øw / (1 << 
Q_bëa
);

687 
Æpha_øw
 =áÕha_øw / (1 << 
Q_Æpha
);

689 
Æpha
 = (
Æpha_øw
 << 10Ë/ 
sˇÀ_B
;

690 
bëa
 = (
bëa_øw
 << 10Ë/ 
sˇÀ_B
;

691 
‹dî_1
 = 3 * 
M
 - 
Q_x
 - 
Q_B1
 - 
Q_bëa
 + 10 + 
Q_sˇÀ_B
 + 5;

692 
‹dî_2
 = 3 * 
M
 - 
Q_x
 - 
Q_B2
 - 
Q_Æpha
 + 10 + 
Q_sˇÀ_B
 + 5;

693 
‹dî1_5x
 = 
‹dî_1
 / 5;

694 
‹dî2_3x
 = 
‹dî_2
 / 3;

695 
‹dî1_5x_ªm
 = 
‹dî_1
 - 5 * 
‹dî1_5x
;

696 
‹dî2_3x_ªm
 = 
‹dî_2
 - 3 * 
‹dî2_3x
;

698 
i
 = 0; i < 
PAPRD_TABLE_SZ
; i++) {

699 
PA_™gÀ
;

702 i‡(
i
 == 4)

705 
tmp
 = 
i
 * 32;

706 i‡(
bëa
 > 0)

707 
y5
 = (((
bëa
 * 
tmp
 - 64) >> 6) -

708 (1 << 
‹dî1_5x
)) / (1 << order1_5x);

710 
y5
 = ((((
bëa
 * 
tmp
 - 64) >> 6) +

711 (1 << 
‹dî1_5x
)) / (1 << order1_5x));

713 
y5
 = (y5 * 
tmp
Ë/ (1 << 
‹dî1_5x
);

714 
y5
 = (y5 * 
tmp
Ë/ (1 << 
‹dî1_5x
);

715 
y5
 = (y5 * 
tmp
Ë/ (1 << 
‹dî1_5x
);

716 
y5
 = (y5 * 
tmp
Ë/ (1 << 
‹dî1_5x
);

717 
y5
 = y5 / (1 << 
‹dî1_5x_ªm
);

719 i‡(
bëa
 > 0)

720 
y3
 = (
Æpha
 * 
tmp
 -

721 (1 << 
‹dî2_3x
)) / (1 << order2_3x);

723 
y3
 = (
Æpha
 * 
tmp
 +

724 (1 << 
‹dî2_3x
)) / (1 << order2_3x);

725 
y3
 = (y3 * 
tmp
Ë/ (1 << 
‹dî2_3x
);

726 
y3
 = (y3 * 
tmp
Ë/ (1 << 
‹dî2_3x
);

727 
y3
 = y3 / (1 << 
‹dî2_3x_ªm
);

729 i‡(
i
 < 4) {

730 
PA_™gÀ
 = 0;

732 
PA_™gÀ
 = 
y5
 + 
y3
;

733 i‡(
PA_™gÀ
 < -150)

734 
PA_™gÀ
 = -150;

735 i‡(
PA_™gÀ
 > 150)

736 
PA_™gÀ
 = 150;

739 
∑_èbÀ
[
i
] = ((
PA_ö
[i] & 0x7ffË<< 11Ë+ (
PA_™gÀ
 & 0x7ff);

740 i‡(
i
 == 5) {

741 
PA_™gÀ
 = (PA_angle + 2) >> 1;

742 
∑_èbÀ
[
i
 - 1] = ((
PA_ö
[i - 1] & 0x7ff) << 11) +

743 (
PA_™gÀ
 & 0x7ff);

747 *
gaö
 = 
G_fxp
;

748  
åue
;

749 
	}
}

751 
	$¨9003_∑¥d_p›uœã_sögÀ_èbÀ
(
©h_hw
 *
ah
,

752 
©h9k_hw_ˇl_d©a
 *
ˇld©a
,

753 
chaö
)

755 
u32
 *
∑¥d_èbÀ_vÆ
 = 
ˇld©a
->
∑_èbÀ
[
chaö
];

756 
u32
 
smÆl_sig«l_gaö
 = 
ˇld©a
->smÆl_sig«l_gaö[
chaö
];

757 
u32
 
åaöög_powî
 = 
ah
->
∑¥d_åaöög_powî
;

758 
u32
 
ªg
 = 0;

759 
i
;

761 i‡(
chaö
 == 0)

762 
ªg
 = 
AR_PHY_PAPRD_MEM_TAB_B0
;

763 i‡(
chaö
 == 1)

764 
ªg
 = 
AR_PHY_PAPRD_MEM_TAB_B1
;

765 i‡(
chaö
 == 2)

766 
ªg
 = 
AR_PHY_PAPRD_MEM_TAB_B2
;

768 
i
 = 0; i < 
PAPRD_TABLE_SZ
; i++) {

769 
	`REG_WRITE
(
ah
, 
ªg
, 
∑¥d_èbÀ_vÆ
[
i
]);

770 
ªg
 =Ñeg + 4;

773 i‡(
chaö
 == 0)

774 
ªg
 = 
AR_PHY_PA_GAIN123_B0
;

775 i‡(
chaö
 == 1)

776 
ªg
 = 
AR_PHY_PA_GAIN123_B1
;

778 
ªg
 = 
AR_PHY_PA_GAIN123_B2
;

780 
	`REG_RMW_FIELD
(
ah
, 
ªg
, 
AR_PHY_PA_GAIN123_PA_GAIN1
, 
smÆl_sig«l_gaö
);

782 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL1_B0
,

783 
AR_PHY_PAPRD_CTRL1_PAPRD_POWER_AT_AM2AM_CAL
,

784 
åaöög_powî
);

786 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(1))

787 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL1_B1
,

788 
AR_PHY_PAPRD_CTRL1_PAPRD_POWER_AT_AM2AM_CAL
,

789 
åaöög_powî
);

791 i‡(
ah
->
ˇps
.
tx_chaömask
 & 
	`BIT
(2))

793 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_CTRL1_B2
,

794 
AR_PHY_PAPRD_CTRL1_PAPRD_POWER_AT_AM2AM_CAL
,

795 
åaöög_powî
);

796 
	}
}

797 
EXPORT_SYMBOL
(
¨9003_∑¥d_p›uœã_sögÀ_èbÀ
);

799 
	$¨9003_∑¥d_£tup_gaö_èbÀ
(
©h_hw
 *
ah
, 
chaö
)

801 
i
, 
desúed_gaö
, 
gaö_ödex
;

802 
åaö_powî
 = 
ah
->
∑¥d_åaöög_powî
;

804 
desúed_gaö
 = 
	`¨9003_gë_desúed_gaö
(
ah
, 
chaö
, 
åaö_powî
);

806 
gaö_ödex
 = 0;

807 
i
 = 0; i < 
PAPRD_GAIN_TABLE_ENTRIES
; i++) {

808 i‡(
ah
->
∑¥d_gaö_èbÀ_ödex
[
i
] >
desúed_gaö
)

810 
gaö_ödex
++;

813 
	`¨9003_tx_f‹˚_gaö
(
ah
, 
gaö_ödex
);

815 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_PAPRD_TRAINER_STAT1
,

816 
AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE
);

817 
	}
}

818 
EXPORT_SYMBOL
(
¨9003_∑¥d_£tup_gaö_èbÀ
);

820 
boﬁ
 
	$¨9003_∑¥d_ªåaö_∑_ö
(
©h_hw
 *
ah
,

821 
©h9k_hw_ˇl_d©a
 *
ˇld©a
,

822 
chaö
)

824 
u32
 *
∑_ö
 = 
ˇld©a
->
∑_èbÀ
[
chaö
];

825 
ˇpdiv_off£t
, 
quick_dr›_off£t
;

826 
ˇpdiv2g
, 
quick_dr›
;

827 
cou¡
 = 0;

828 
i
;

830 i‡(!
	`AR_SREV_9485
(
ah
Ë&& !
	`AR_SREV_9330
(ah))

831  
Ál£
;

833 
ˇpdiv2g
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_65NM_CH0_TXRF3
,

834 
AR_PHY_65NM_CH0_TXRF3_CAPDIV2G
);

836 
quick_dr›
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

837 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP
);

839 i‡(
quick_dr›
)

840 
quick_dr›
 -= 0x40;

842 
i
 = 0; i < 
NUM_BIN
 + 1; i++) {

843 i‡(
∑_ö
[
i
] == 1400)

844 
cou¡
++;

847 i‡(
	`AR_SREV_9485
(
ah
)) {

848 i‡(
∑_ö
[23] < 800) {

849 
ˇpdiv_off£t
 = ()((1000 - 
∑_ö
[23] + 75) / 150);

850 
ˇpdiv2g
 +
ˇpdiv_off£t
;

851 i‡(
ˇpdiv2g
 > 7) {

852 
ˇpdiv2g
 = 7;

853 i‡(
∑_ö
[23] < 600) {

854 
quick_dr›
++;

855 i‡(
quick_dr›
 > 0)

856 
quick_dr›
 = 0;

859 } i‡(
∑_ö
[23] == 1400) {

860 
quick_dr›_off£t
 = 
	`mö_t
(, 
cou¡
 / 3, 2);

861 
quick_dr›
 +
quick_dr›_off£t
;

862 
ˇpdiv2g
 +
quick_dr›_off£t
 / 2;

864 i‡(
ˇpdiv2g
 > 7)

865 
ˇpdiv2g
 = 7;

867 i‡(
quick_dr›
 > 0) {

868 
quick_dr›
 = 0;

869 
ˇpdiv2g
 -
quick_dr›_off£t
;

870 i‡(
ˇpdiv2g
 < 0)

871 
ˇpdiv2g
 = 0;

874  
Ál£
;

876 } i‡(
	`AR_SREV_9330
(
ah
)) {

877 i‡(
∑_ö
[23] < 1000) {

878 
ˇpdiv_off£t
 = (1000 - 
∑_ö
[23]) / 100;

879 
ˇpdiv2g
 +
ˇpdiv_off£t
;

880 i‡(
ˇpdiv_off£t
 > 3) {

881 
ˇpdiv_off£t
 = 1;

882 
quick_dr›
--;

885 
ˇpdiv2g
 +
ˇpdiv_off£t
;

886 i‡(
ˇpdiv2g
 > 6)

887 
ˇpdiv2g
 = 6;

888 i‡(
quick_dr›
 < -4)

889 
quick_dr›
 = -4;

890 } i‡(
∑_ö
[23] == 1400) {

891 i‡(
cou¡
 > 3) {

892 
quick_dr›
++;

893 
ˇpdiv2g
 -
cou¡
 / 4;

894 i‡(
quick_dr›
 > -2)

895 
quick_dr›
 = -2;

897 
ˇpdiv2g
--;

900 i‡(
ˇpdiv2g
 < 0)

901 
ˇpdiv2g
 = 0;

903  
Ál£
;

907 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_TXRF3
,

908 
AR_PHY_65NM_CH0_TXRF3_CAPDIV2G
, 
ˇpdiv2g
);

909 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_CNTL3
,

910 
AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP
,

911 
quick_dr›
);

913  
åue
;

914 
	}
}

916 
	$¨9003_∑¥d_¸óã_curve
(
©h_hw
 *
ah
,

917 
©h9k_hw_ˇl_d©a
 *
ˇld©a
, 
chaö
)

919 
u16
 *
smÆl_sig«l_gaö
 = &
ˇld©a
->smÆl_sig«l_gaö[
chaö
];

920 
u32
 *
∑_èbÀ
 = 
ˇld©a
->∑_èbÀ[
chaö
];

921 
u32
 *
d©a_L
, *
d©a_U
;

922 
i
, 
°©us
 = 0;

923 
u32
 *
buf
;

924 
u32
 
ªg
;

926 
	`mem£t
(
ˇld©a
->
∑_èbÀ
[
chaö
], 0, (caldata->pa_table[chain]));

928 
buf
 = 
	`kmÆloc
(2 * 48 * (
u32
), 
GFP_KERNEL
);

929 i‡(!
buf
)

930  -
ENOMEM
;

932 
d©a_L
 = &
buf
[0];

933 
d©a_U
 = &
buf
[48];

935 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CHAN_INFO_MEMORY
,

936 
AR_PHY_CHAN_INFO_MEMORY_CHANINFOMEM_S2_READ
);

938 
ªg
 = 
AR_PHY_CHAN_INFO_TAB_0
;

939 
i
 = 0; i < 48; i++)

940 
d©a_L
[
i
] = 
	`REG_READ
(
ah
, 
ªg
 + (i << 2));

942 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CHAN_INFO_MEMORY
,

943 
AR_PHY_CHAN_INFO_MEMORY_CHANINFOMEM_S2_READ
);

945 
i
 = 0; i < 48; i++)

946 
d©a_U
[
i
] = 
	`REG_READ
(
ah
, 
ªg
 + (i << 2));

948 i‡(!
	`¸óã_∑_curve
(
d©a_L
, 
d©a_U
, 
∑_èbÀ
, 
smÆl_sig«l_gaö
))

949 
°©us
 = -2;

951 i‡(
	`¨9003_∑¥d_ªåaö_∑_ö
(
ah
, 
ˇld©a
, 
chaö
))

952 
°©us
 = -
EINPROGRESS
;

954 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_PAPRD_TRAINER_STAT1
,

955 
AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE
);

957 
	`k‰ì
(
buf
);

959  
°©us
;

960 
	}
}

961 
EXPORT_SYMBOL
(
¨9003_∑¥d_¸óã_curve
);

963 
	$¨9003_∑¥d_öô_èbÀ
(
©h_hw
 *
ah
)

965 
ªt
;

967 
ªt
 = 
	`¨9003_∑¥d_£tup_sögÀ_èbÀ
(
ah
);

968 i‡(
ªt
 < 0)

969  
ªt
;

971 
	`¨9003_∑¥d_gë_gaö_èbÀ
(
ah
);

973 
	}
}

974 
EXPORT_SYMBOL
(
¨9003_∑¥d_öô_èbÀ
);

976 
boﬁ
 
	$¨9003_∑¥d_is_d⁄e
(
©h_hw
 *
ah
)

978 
∑¥d_d⁄e
, 
agc2_pwr
;

980 
∑¥d_d⁄e
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_STAT1
,

981 
AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE
);

983 i‡(
	`AR_SREV_9485
(
ah
))

984 
exô
;

986 i‡(
∑¥d_d⁄e
 == 0x1) {

987 
agc2_pwr
 = 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_PAPRD_TRAINER_STAT1
,

988 
AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_AGC2_PWR
);

990 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

992 
agc2_pwr
, 
∑¥d_d⁄e
);

998 i‡(
agc2_pwr
 <
PAPRD_IDEAL_AGC2_PWR_RANGE
)

999 
∑¥d_d⁄e
 = 0;

1001 
exô
:

1002  !!
∑¥d_d⁄e
;

1003 
	}
}

1004 
EXPORT_SYMBOL
(
¨9003_∑¥d_is_d⁄e
);

1006 
boﬁ
 
	$¨9003_is_∑¥d_íabÀd
(
©h_hw
 *
ah
)

1008 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_PAPRD
Ë&&áh->
c⁄fig
.
íabÀ_∑¥d
)

1009  
åue
;

1011  
Ál£
;

1012 
	}
}

1013 
EXPORT_SYMBOL
(
¨9003_is_∑¥d_íabÀd
);

	@ar9003_phy.c

17 
	~<löux/exp‹t.h
>

18 
	~"hw.h
"

19 
	~"¨9003_phy.h
"

21 
	#AR9300_OFDM_RATES
 8

	)

22 
	#AR9300_HT_SS_RATES
 8

	)

23 
	#AR9300_HT_DS_RATES
 8

	)

24 
	#AR9300_HT_TS_RATES
 8

	)

26 
	#AR9300_11NA_OFDM_SHIFT
 0

	)

27 
	#AR9300_11NA_HT_SS_SHIFT
 8

	)

28 
	#AR9300_11NA_HT_DS_SHIFT
 16

	)

29 
	#AR9300_11NA_HT_TS_SHIFT
 24

	)

31 
	#AR9300_11NG_OFDM_SHIFT
 4

	)

32 
	#AR9300_11NG_HT_SS_SHIFT
 12

	)

33 
	#AR9300_11NG_HT_DS_SHIFT
 20

	)

34 
	#AR9300_11NG_HT_TS_SHIFT
 28

	)

36 c⁄° 
	gfú°ï_èbÀ
[] =

40 c⁄° 
	gcy˝wrThr1_èbÀ
[] =

44 c⁄° 
u8
 
	gofdm2pwr
[] = {

45 
ALL_TARGET_LEGACY_6_24
,

46 
ALL_TARGET_LEGACY_6_24
,

47 
ALL_TARGET_LEGACY_6_24
,

48 
ALL_TARGET_LEGACY_6_24
,

49 
ALL_TARGET_LEGACY_6_24
,

50 
ALL_TARGET_LEGACY_36
,

51 
ALL_TARGET_LEGACY_48
,

52 
ALL_TARGET_LEGACY_54


55 c⁄° 
u8
 
	gmcs2pwr_ht20
[] = {

56 
ALL_TARGET_HT20_0_8_16
,

57 
ALL_TARGET_HT20_1_3_9_11_17_19
,

58 
ALL_TARGET_HT20_1_3_9_11_17_19
,

59 
ALL_TARGET_HT20_1_3_9_11_17_19
,

60 
ALL_TARGET_HT20_4
,

61 
ALL_TARGET_HT20_5
,

62 
ALL_TARGET_HT20_6
,

63 
ALL_TARGET_HT20_7
,

64 
ALL_TARGET_HT20_0_8_16
,

65 
ALL_TARGET_HT20_1_3_9_11_17_19
,

66 
ALL_TARGET_HT20_1_3_9_11_17_19
,

67 
ALL_TARGET_HT20_1_3_9_11_17_19
,

68 
ALL_TARGET_HT20_12
,

69 
ALL_TARGET_HT20_13
,

70 
ALL_TARGET_HT20_14
,

71 
ALL_TARGET_HT20_15
,

72 
ALL_TARGET_HT20_0_8_16
,

73 
ALL_TARGET_HT20_1_3_9_11_17_19
,

74 
ALL_TARGET_HT20_1_3_9_11_17_19
,

75 
ALL_TARGET_HT20_1_3_9_11_17_19
,

76 
ALL_TARGET_HT20_20
,

77 
ALL_TARGET_HT20_21
,

78 
ALL_TARGET_HT20_22
,

79 
ALL_TARGET_HT20_23


82 c⁄° 
u8
 
	gmcs2pwr_ht40
[] = {

83 
ALL_TARGET_HT40_0_8_16
,

84 
ALL_TARGET_HT40_1_3_9_11_17_19
,

85 
ALL_TARGET_HT40_1_3_9_11_17_19
,

86 
ALL_TARGET_HT40_1_3_9_11_17_19
,

87 
ALL_TARGET_HT40_4
,

88 
ALL_TARGET_HT40_5
,

89 
ALL_TARGET_HT40_6
,

90 
ALL_TARGET_HT40_7
,

91 
ALL_TARGET_HT40_0_8_16
,

92 
ALL_TARGET_HT40_1_3_9_11_17_19
,

93 
ALL_TARGET_HT40_1_3_9_11_17_19
,

94 
ALL_TARGET_HT40_1_3_9_11_17_19
,

95 
ALL_TARGET_HT40_12
,

96 
ALL_TARGET_HT40_13
,

97 
ALL_TARGET_HT40_14
,

98 
ALL_TARGET_HT40_15
,

99 
ALL_TARGET_HT40_0_8_16
,

100 
ALL_TARGET_HT40_1_3_9_11_17_19
,

101 
ALL_TARGET_HT40_1_3_9_11_17_19
,

102 
ALL_TARGET_HT40_1_3_9_11_17_19
,

103 
ALL_TARGET_HT40_20
,

104 
ALL_TARGET_HT40_21
,

105 
ALL_TARGET_HT40_22
,

106 
ALL_TARGET_HT40_23
,

134 
	$¨9003_hw_£t_ch™√l
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

136 
u16
 
bMode
, 
‰acMode
 = 0, 
aModeRefSñ
 = 0;

137 
u32
 
‰eq
, 
ch™_‰ac
, 
div
, 
ch™√lSñ
 = 0, 
ªg32
 = 0;

138 
ch™_˚¡îs
 
˚¡îs
;

139 
lﬂdSy¡hCh™√l
;

141 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

142 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

144 i‡(
‰eq
 < 4800) {

145 i‡(
	`AR_SREV_9330
(
ah
)) {

146 i‡(
ah
->
is_˛k_25mhz
)

147 
div
 = 75;

149 
div
 = 120;

151 
ch™√lSñ
 = (
‰eq
 * 4Ë/ 
div
;

152 
ch™_‰ac
 = (((
‰eq
 * 4Ë% 
div
) * 0x20000) / div;

153 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™_‰ac
;

154 } i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

161 
ch™√lSñ
 = (
‰eq
 * 4) / 120;

162 
ch™_‰ac
 = (((
‰eq
 * 4) % 120) * 0x20000) / 120;

163 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™_‰ac
;

164 } i‡(
	`AR_SREV_9340
(
ah
)) {

165 i‡(
ah
->
is_˛k_25mhz
) {

166 
ch™√lSñ
 = (
‰eq
 * 2) / 75;

167 
ch™_‰ac
 = (((
‰eq
 * 2) % 75) * 0x20000) / 75;

168 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™_‰ac
;

170 
ch™√lSñ
 = 
	`CHANSEL_2G
(
‰eq
) >> 1;

172 } i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
(ah) ||

173 
	`AR_SREV_9561
(
ah
)) {

174 i‡(
ah
->
is_˛k_25mhz
)

175 
div
 = 75;

177 
div
 = 120;

179 
ch™√lSñ
 = (
‰eq
 * 4Ë/ 
div
;

180 
ch™_‰ac
 = (((
‰eq
 * 4Ë% 
div
) * 0x20000) / div;

181 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™_‰ac
;

183 
ch™√lSñ
 = 
	`CHANSEL_2G
(
‰eq
);

186 
bMode
 = 1;

188 i‡((
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
(ah) ||

189 
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah)) &&

190 
ah
->
is_˛k_25mhz
) {

191 
ch™√lSñ
 = 
‰eq
 / 75;

192 
ch™_‰ac
 = ((
‰eq
 % 75) * 0x20000) / 75;

193 
ch™√lSñ
 = (ch™√lSñ << 17Ë| 
ch™_‰ac
;

195 
ch™√lSñ
 = 
	`CHANSEL_5G
(
‰eq
);

197 
ch™√lSñ
 >>= 1;

200 
bMode
 = 0;

204 
‰acMode
 = 1;

205 
aModeRefSñ
 = 0;

206 
lﬂdSy¡hCh™√l
 = 0;

208 
ªg32
 = (
bMode
 << 29);

209 
	`REG_WRITE
(
ah
, 
AR_PHY_SYNTH_CONTROL
, 
ªg32
);

212 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_SYNTH4
,

213 
AR_PHY_SYNTH4_LONG_SHIFT_SELECT
, 1);

216 
ªg32
 = (
ch™√lSñ
 << 2Ë| (
‰acMode
 << 30) |

217 (
aModeRefSñ
 << 28Ë| (
lﬂdSy¡hCh™√l
 << 31);

218 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_SYNTH7
, 
ªg32
);

221 
lﬂdSy¡hCh™√l
 = 1;

222 
ªg32
 = (
ch™√lSñ
 << 2Ë| (
‰acMode
 << 30) |

223 (
aModeRefSñ
 << 28Ë| (
lﬂdSy¡hCh™√l
 << 31);

224 
	`REG_WRITE
(
ah
, 
AR_PHY_65NM_CH0_SYNTH7
, 
ªg32
);

226 
ah
->
curch™
 = 
ch™
;

229 
	}
}

241 
	$¨9003_hw_•ur_môig©e_mrc_cck
(
©h_hw
 *
ah
,

242 
©h9k_ch™√l
 *
ch™
)

244 c⁄° 
u32
 
•ur_‰eq
[4] = { 2420, 2440, 2464, 2480 };

245 
cur_bb_•ur
, 
√g©ive
 = 0, 
cck_•ur_‰eq
;

246 
i
;

247 
ønge
, 
max_•ur_˙ts
, 
sy¡h_‰eq
;

248 
u8
 *
•ur_fbö_±r
 = 
	`¨9003_gë_•ur_ch™_±r
(
ah
, 
	`IS_CHAN_2GHZ
(
ch™
));

255 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9340
◊hË|| 
	`AR_SREV_9330
(ah) ||

256 
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9561
(ah)) {

257 i‡(
•ur_fbö_±r
[0] == 0)

259 
max_•ur_˙ts
 = 5;

260 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

261 
ønge
 = 19;

262 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_GEN_CTRL
,

263 
AR_PHY_GC_DYN2040_PRI_CH
) == 0)

264 
sy¡h_‰eq
 = 
ch™
->
ch™√l
 + 10;

266 
sy¡h_‰eq
 = 
ch™
->
ch™√l
 - 10;

268 
ønge
 = 10;

269 
sy¡h_‰eq
 = 
ch™
->
ch™√l
;

272 
ønge
 = 
	`AR_SREV_9462
(
ah
) ? 5 : 10;

273 
max_•ur_˙ts
 = 4;

274 
sy¡h_‰eq
 = 
ch™
->
ch™√l
;

277 
i
 = 0; i < 
max_•ur_˙ts
; i++) {

278 i‡(
	`AR_SREV_9462
(
ah
Ë&& (
i
 == 0 || i == 3))

281 
√g©ive
 = 0;

282 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9340
◊hË|| 
	`AR_SREV_9330
(ah) ||

283 
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

284 
cur_bb_•ur
 = 
	`©h9k_hw_fbö2‰eq
(
•ur_fbö_±r
[
i
],

285 
	`IS_CHAN_2GHZ
(
ch™
));

287 
cur_bb_•ur
 = 
•ur_‰eq
[
i
];

289 
cur_bb_•ur
 -
sy¡h_‰eq
;

290 i‡(
cur_bb_•ur
 < 0) {

291 
√g©ive
 = 1;

292 
cur_bb_•ur
 = -cur_bb_spur;

294 i‡(
cur_bb_•ur
 < 
ønge
) {

295 
cck_•ur_‰eq
 = ()((
cur_bb_•ur
 << 19) / 11);

297 i‡(
√g©ive
 == 1)

298 
cck_•ur_‰eq
 = -cck_spur_freq;

300 
cck_•ur_‰eq
 = cck_spur_freq & 0xfffff;

302 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_AGC_CONTROL
,

303 
AR_PHY_AGC_CONTROL_YCOK_MAX
, 0x7);

304 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

305 
AR_PHY_CCK_SPUR_MIT_SPUR_RSSI_THR
, 0x7f);

306 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

307 
AR_PHY_CCK_SPUR_MIT_SPUR_FILTER_TYPE
,

309 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

310 
AR_PHY_CCK_SPUR_MIT_USE_CCK_SPUR_MIT
,

312 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

313 
AR_PHY_CCK_SPUR_MIT_CCK_SPUR_FREQ
,

314 
cck_•ur_‰eq
);

320 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_AGC_CONTROL
,

321 
AR_PHY_AGC_CONTROL_YCOK_MAX
, 0x5);

322 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

323 
AR_PHY_CCK_SPUR_MIT_USE_CCK_SPUR_MIT
, 0x0);

324 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_SPUR_MIT
,

325 
AR_PHY_CCK_SPUR_MIT_CCK_SPUR_FREQ
, 0x0);

326 
	}
}

329 
	$¨9003_hw_•ur_ofdm_˛ór
(
©h_hw
 *
ah
)

331 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

332 
AR_PHY_TIMING4_ENABLE_SPUR_FILTER
, 0);

333 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

334 
AR_PHY_TIMING11_SPUR_FREQ_SD
, 0);

335 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

336 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
, 0);

337 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SFCORR_EXT
,

338 
AR_PHY_SFCORR_EXT_SPUR_SUBCHANNEL_SD
, 0);

339 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

340 
AR_PHY_TIMING11_USE_SPUR_FILTER_IN_AGC
, 0);

341 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

342 
AR_PHY_TIMING11_USE_SPUR_FILTER_IN_SELFCOR
, 0);

343 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

344 
AR_PHY_TIMING4_ENABLE_SPUR_RSSI
, 0);

345 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

346 
AR_PHY_SPUR_REG_EN_VIT_SPUR_RSSI
, 0);

347 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

348 
AR_PHY_SPUR_REG_ENABLE_NF_RSSI_SPUR_MIT
, 0);

350 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

351 
AR_PHY_SPUR_REG_ENABLE_MASK_PPM
, 0);

352 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

353 
AR_PHY_TIMING4_ENABLE_PILOT_MASK
, 0);

354 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

355 
AR_PHY_TIMING4_ENABLE_CHAN_MASK
, 0);

356 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

357 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_A
, 0);

358 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_A
,

359 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_IDX_A
, 0);

360 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

361 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_A
, 0);

362 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

363 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_A
, 0);

364 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

365 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_A
, 0);

366 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_A
,

367 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_A
, 0);

368 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

369 
AR_PHY_SPUR_REG_MASK_RATE_CNTL
, 0);

370 
	}
}

372 
	$¨9003_hw_•ur_ofdm
(
©h_hw
 *
ah
,

373 
‰eq_off£t
,

374 
•ur_‰eq_sd
,

375 
•ur_dñè_pha£
,

376 
•ur_subch™√l_sd
,

377 
ønge
,

378 
sy¡h_‰eq
)

380 
mask_ödex
 = 0;

383 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

384 
AR_PHY_TIMING4_ENABLE_SPUR_FILTER
, 0x1);

385 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

386 
AR_PHY_TIMING11_SPUR_FREQ_SD
, 
•ur_‰eq_sd
);

387 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

388 
AR_PHY_TIMING11_SPUR_DELTA_PHASE
, 
•ur_dñè_pha£
);

389 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SFCORR_EXT
,

390 
AR_PHY_SFCORR_EXT_SPUR_SUBCHANNEL_SD
, 
•ur_subch™√l_sd
);

391 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

392 
AR_PHY_TIMING11_USE_SPUR_FILTER_IN_AGC
, 0x1);

394 i‡(!(
	`AR_SREV_9565
(
ah
Ë&& 
ønge
 =10 && 
sy¡h_‰eq
 == 2437))

395 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING11
,

396 
AR_PHY_TIMING11_USE_SPUR_FILTER_IN_SELFCOR
, 0x1);

398 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

399 
AR_PHY_TIMING4_ENABLE_SPUR_RSSI
, 0x1);

400 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

401 
AR_PHY_SPUR_REG_SPUR_RSSI_THRESH
, 34);

402 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

403 
AR_PHY_SPUR_REG_EN_VIT_SPUR_RSSI
, 1);

405 i‡(!
	`AR_SREV_9340
(
ah
) &&

406 
	`REG_READ_FIELD
(
ah
, 
AR_PHY_MODE
,

407 
AR_PHY_MODE_DYNAMIC
) == 0x1)

408 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

409 
AR_PHY_SPUR_REG_ENABLE_NF_RSSI_SPUR_MIT
, 1);

411 
mask_ödex
 = (
‰eq_off£t
 << 4) / 5;

412 i‡(
mask_ödex
 < 0)

413 
mask_ödex
 = mask_index - 1;

415 
mask_ödex
 = mask_index & 0x7f;

417 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

418 
AR_PHY_SPUR_REG_ENABLE_MASK_PPM
, 0x1);

419 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

420 
AR_PHY_TIMING4_ENABLE_PILOT_MASK
, 0x1);

421 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING4
,

422 
AR_PHY_TIMING4_ENABLE_CHAN_MASK
, 0x1);

423 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

424 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_A
, 
mask_ödex
);

425 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_A
,

426 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_IDX_A
, 
mask_ödex
);

427 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

428 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_A
, 
mask_ödex
);

429 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

430 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_A
, 0xc);

431 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

432 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_A
, 0xc);

433 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_A
,

434 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_A
, 0xa0);

435 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_REG
,

436 
AR_PHY_SPUR_REG_MASK_RATE_CNTL
, 0xff);

437 
	}
}

439 
	$¨9003_hw_•ur_ofdm_9565
(
©h_hw
 *
ah
,

440 
‰eq_off£t
)

442 
mask_ödex
 = 0;

444 
mask_ödex
 = (
‰eq_off£t
 << 4) / 5;

445 i‡(
mask_ödex
 < 0)

446 
mask_ödex
 = mask_index - 1;

448 
mask_ödex
 = mask_index & 0x7f;

450 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

451 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_B
,

452 
mask_ödex
);

455 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_B
,

456 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_IDX_A
,

457 
mask_ödex
);

459 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

460 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_B
,

461 
mask_ödex
);

462 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_PILOT_SPUR_MASK
,

463 
AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_B
, 0xe);

464 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CHAN_SPUR_MASK
,

465 
AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_B
, 0xe);

468 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPUR_MASK_B
,

469 
AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_A
, 0xa0);

470 
	}
}

472 
	$¨9003_hw_•ur_ofdm_w‹k
(
©h_hw
 *
ah
,

473 
©h9k_ch™√l
 *
ch™
,

474 
‰eq_off£t
,

475 
ønge
,

476 
sy¡h_‰eq
)

478 
•ur_‰eq_sd
 = 0;

479 
•ur_subch™√l_sd
 = 0;

480 
•ur_dñè_pha£
 = 0;

482 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

483 i‡(
‰eq_off£t
 < 0) {

484 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_GEN_CTRL
,

485 
AR_PHY_GC_DYN2040_PRI_CH
) == 0x0)

486 
•ur_subch™√l_sd
 = 1;

488 
•ur_subch™√l_sd
 = 0;

490 
•ur_‰eq_sd
 = ((
‰eq_off£t
 + 10) << 9) / 11;

493 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_GEN_CTRL
,

494 
AR_PHY_GC_DYN2040_PRI_CH
) == 0x0)

495 
•ur_subch™√l_sd
 = 0;

497 
•ur_subch™√l_sd
 = 1;

499 
•ur_‰eq_sd
 = ((
‰eq_off£t
 - 10) << 9) / 11;

503 
•ur_dñè_pha£
 = (
‰eq_off£t
 << 17) / 5;

506 
•ur_subch™√l_sd
 = 0;

507 
•ur_‰eq_sd
 = (
‰eq_off£t
 << 9) /11;

508 
•ur_dñè_pha£
 = (
‰eq_off£t
 << 18) / 5;

511 
•ur_‰eq_sd
 = spur_freq_sd & 0x3ff;

512 
•ur_dñè_pha£
 = spur_delta_phase & 0xfffff;

514 
	`¨9003_hw_•ur_ofdm
(
ah
,

515 
‰eq_off£t
,

516 
•ur_‰eq_sd
,

517 
•ur_dñè_pha£
,

518 
•ur_subch™√l_sd
,

519 
ønge
, 
sy¡h_‰eq
);

520 
	}
}

523 
	$¨9003_hw_•ur_môig©e_ofdm
(
©h_hw
 *
ah
,

524 
©h9k_ch™√l
 *
ch™
)

526 
sy¡h_‰eq
;

527 
ønge
 = 10;

528 
‰eq_off£t
 = 0;

529 
mode
;

530 
u8
* 
•urCh™sPå
;

531 
i
;

532 
¨9300_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
¨9300_ìp
;

534 i‡(
	`IS_CHAN_5GHZ
(
ch™
)) {

535 
•urCh™sPå
 = &(
ìp
->
modÆHódî5G
.
•urCh™s
[0]);

536 
mode
 = 0;

539 
•urCh™sPå
 = &(
ìp
->
modÆHódî2G
.
•urCh™s
[0]);

540 
mode
 = 1;

543 i‡(
•urCh™sPå
[0] == 0)

546 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

547 
ønge
 = 19;

548 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_GEN_CTRL
,

549 
AR_PHY_GC_DYN2040_PRI_CH
) == 0x0)

550 
sy¡h_‰eq
 = 
ch™
->
ch™√l
 - 10;

552 
sy¡h_‰eq
 = 
ch™
->
ch™√l
 + 10;

554 
ønge
 = 10;

555 
sy¡h_‰eq
 = 
ch™
->
ch™√l
;

558 
	`¨9003_hw_•ur_ofdm_˛ór
(
ah
);

560 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
 && 
•urCh™sPå
[i]; i++) {

561 
‰eq_off£t
 = 
	`©h9k_hw_fbö2‰eq
(
•urCh™sPå
[
i
], 
mode
);

562 
‰eq_off£t
 -
sy¡h_‰eq
;

563 i‡(
	`abs
(
‰eq_off£t
Ë< 
ønge
) {

564 
	`¨9003_hw_•ur_ofdm_w‹k
(
ah
, 
ch™
, 
‰eq_off£t
,

565 
ønge
, 
sy¡h_‰eq
);

567 i‡(
	`AR_SREV_9565
(
ah
Ë&& (
i
 < 4)) {

568 
‰eq_off£t
 = 
	`©h9k_hw_fbö2‰eq
(
•urCh™sPå
[
i
 + 1],

569 
mode
);

570 
‰eq_off£t
 -
sy¡h_‰eq
;

571 i‡(
	`abs
(
‰eq_off£t
Ë< 
ønge
)

572 
	`¨9003_hw_•ur_ofdm_9565
(
ah
, 
‰eq_off£t
);

578 
	}
}

580 
	$¨9003_hw_•ur_môig©e
(
©h_hw
 *
ah
,

581 
©h9k_ch™√l
 *
ch™
)

583 i‡(!
	`AR_SREV_9565
(
ah
))

584 
	`¨9003_hw_•ur_môig©e_mrc_cck
(
ah
, 
ch™
);

585 
	`¨9003_hw_•ur_môig©e_ofdm
(
ah
, 
ch™
);

586 
	}
}

588 
u32
 
	$¨9003_hw_compuã_∂l_c⁄åﬁ_soc
(
©h_hw
 *
ah
,

589 
©h9k_ch™√l
 *
ch™
)

591 
u32
 
∂l
;

593 
∂l
 = 
	`SM
(0x5, 
AR_RTC_9300_SOC_PLL_REFDIV
);

595 i‡(
ch™
 && 
	`IS_CHAN_HALF_RATE
(chan))

596 
∂l
 |
	`SM
(0x1, 
AR_RTC_9300_SOC_PLL_CLKSEL
);

597 i‡(
ch™
 && 
	`IS_CHAN_QUARTER_RATE
(chan))

598 
∂l
 |
	`SM
(0x2, 
AR_RTC_9300_SOC_PLL_CLKSEL
);

600 
∂l
 |
	`SM
(0x2c, 
AR_RTC_9300_SOC_PLL_DIV_INT
);

602  
∂l
;

603 
	}
}

605 
u32
 
	$¨9003_hw_compuã_∂l_c⁄åﬁ
(
©h_hw
 *
ah
,

606 
©h9k_ch™√l
 *
ch™
)

608 
u32
 
∂l
;

610 
∂l
 = 
	`SM
(0x5, 
AR_RTC_9300_PLL_REFDIV
);

612 i‡(
ch™
 && 
	`IS_CHAN_HALF_RATE
(chan))

613 
∂l
 |
	`SM
(0x1, 
AR_RTC_9300_PLL_CLKSEL
);

614 i‡(
ch™
 && 
	`IS_CHAN_QUARTER_RATE
(chan))

615 
∂l
 |
	`SM
(0x2, 
AR_RTC_9300_PLL_CLKSEL
);

617 
∂l
 |
	`SM
(0x2c, 
AR_RTC_9300_PLL_DIV
);

619  
∂l
;

620 
	}
}

622 
	$¨9003_hw_£t_ch™√l_ªgs
(
©h_hw
 *
ah
,

623 
©h9k_ch™√l
 *
ch™
)

625 
u32
 
phymode
;

626 
u32
 
íabÀDacFifo
 = 0;

628 
íabÀDacFifo
 =

629 (
	`REG_READ
(
ah
, 
AR_PHY_GEN_CTRL
Ë& 
AR_PHY_GC_ENABLE_DAC_FIFO
);

632 
phymode
 = 
AR_PHY_GC_HT_EN
 | 
AR_PHY_GC_SHORT_GI_40
 | 
íabÀDacFifo
;

634 i‡(!
	`AR_SREV_9561
(
ah
))

635 
phymode
 |
AR_PHY_GC_SINGLE_HT_LTF1
;

638 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

639 
phymode
 |
AR_PHY_GC_DYN2040_EN
;

641 i‡(
	`IS_CHAN_HT40PLUS
(
ch™
))

642 
phymode
 |
AR_PHY_GC_DYN2040_PRI_CH
;

647 
phymode
 |
	`REG_READ
(
ah
, 
AR_PHY_GEN_CTRL
);

649 
phymode
 &~
AR_PHY_GC_GF_DETECT_EN
;

651 
	`REG_WRITE
(
ah
, 
AR_PHY_GEN_CTRL
, 
phymode
);

654 
	`©h9k_hw_£t11nmac2040
(
ah
, 
ch™
);

657 
	`REG_WRITE
(
ah
, 
AR_GTXTO
, 25 << 
AR_GTXTO_TIMEOUT_LIMIT_S
);

659 
	`REG_WRITE
(
ah
, 
AR_CST
, 0xF << 
AR_CST_TIMEOUT_LIMIT_S
);

660 
	}
}

662 
	$¨9003_hw_öô_bb
(
©h_hw
 *
ah
,

663 
©h9k_ch™√l
 *
ch™
)

665 
u32
 
sy¡hDñay
;

672 
sy¡hDñay
 = 
	`REG_READ
(
ah
, 
AR_PHY_RX_DELAY
Ë& 
AR_PHY_RX_DELAY_DELAY
;

675 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_EN
);

676 
	`©h9k_hw_sy¡h_dñay
(
ah
, 
ch™
, 
sy¡hDñay
);

677 
	}
}

679 
	$¨9003_hw_£t_chaö_masks
(
©h_hw
 *
ah
, 
u8
 
rx
, u8 
tx
)

681 i‡(
ah
->
ˇps
.
tx_chaömask
 =5 ||áh->ˇps.
rx_chaömask
 == 5)

682 
	`REG_SET_BIT
(
ah
, 
AR_PHY_ANALOG_SWAP
,

683 
AR_PHY_SWAP_ALT_CHAIN
);

685 
	`REG_WRITE
(
ah
, 
AR_PHY_RX_CHAINMASK
, 
rx
);

686 
	`REG_WRITE
(
ah
, 
AR_PHY_CAL_CHAINMASK
, 
rx
);

688 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_APM
Ë&& (
tx
 == 0x7))

689 
tx
 = 3;

691 
	`REG_WRITE
(
ah
, 
AR_SELFGEN_MASK
, 
tx
);

692 
	}
}

697 
	$¨9003_hw_ovîride_öi
(
©h_hw
 *
ah
)

699 
u32
 
vÆ
;

706 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, (
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
));

715 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PCU_MISC_MODE2
Ë& (~
AR_ADHOC_MCAST_KEYID_ENABLE
);

716 
vÆ
 |
AR_AGG_WEP_ENABLE_FIX
 |

717 
AR_AGG_WEP_ENABLE
 |

718 
AR_PCU_MISC_MODE2_CFP_IGNORE
;

719 
	`REG_WRITE
(
ah
, 
AR_PCU_MISC_MODE2
, 
vÆ
);

721 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

722 
	`REG_WRITE
(
ah
, 
AR_GLB_SWREG_DISCONT_MODE
,

723 
AR_GLB_SWREG_DISCONT_EN_BT_WLAN
);

725 i‡(
	`REG_READ_FIELD
(
ah
, 
AR_PHY_TX_IQCAL_CONTROL_0
,

726 
AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
))

727 
ah
->
íabÀd_ˇls
 |
TX_IQ_CAL
;

729 
ah
->
íabÀd_ˇls
 &~
TX_IQ_CAL
;

733 i‡(
	`REG_READ
(
ah
, 
AR_PHY_CL_CAL_CTL
Ë& 
AR_PHY_CL_CAL_ENABLE
)

734 
ah
->
íabÀd_ˇls
 |
TX_CL_CAL
;

736 
ah
->
íabÀd_ˇls
 &~
TX_CL_CAL
;

738 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9550
(ah) ||

739 
	`AR_SREV_9561
(
ah
)) {

740 i‡(
ah
->
is_˛k_25mhz
) {

741 
	`REG_WRITE
(
ah
, 
AR_RTC_DERIVED_CLK
, 0x17c << 1);

742 
	`REG_WRITE
(
ah
, 
AR_SLP32_MODE
, 0x0010f3d7);

743 
	`REG_WRITE
(
ah
, 
AR_SLP32_INC
, 0x0001e7ae);

745 
	`REG_WRITE
(
ah
, 
AR_RTC_DERIVED_CLK
, 0x261 << 1);

746 
	`REG_WRITE
(
ah
, 
AR_SLP32_MODE
, 0x0010f400);

747 
	`REG_WRITE
(
ah
, 
AR_SLP32_INC
, 0x0001e800);

749 
	`udñay
(100);

751 
	}
}

753 
	$¨9003_hw_¥og_öi
(
©h_hw
 *
ah
,

754 
¨5416IniAºay
 *
öiAº
,

755 
cﬁumn
)

757 
i
, 
ªgWrôes
 = 0;

760 i‡(!
öiAº
->
ü_¨øy
)

768 i‡(
cﬁumn
 >
öiAº
->
ü_cﬁumns
)

769 
cﬁumn
 = 1;

771 
i
 = 0; i < 
öiAº
->
ü_rows
; i++) {

772 
u32
 
ªg
 = 
	`INI_RA
(
öiAº
, 
i
, 0);

773 
u32
 
vÆ
 = 
	`INI_RA
(
öiAº
, 
i
, 
cﬁumn
);

775 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
);

777 
	`DO_DELAY
(
ªgWrôes
);

779 
	}
}

781 
	$¨9550_hw_gë_modes_txgaö_ödex
(
©h_hw
 *
ah
,

782 
©h9k_ch™√l
 *
ch™
)

784 
ªt
;

786 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

787 i‡(
	`IS_CHAN_HT40
(
ch™
))

793 i‡(
ch™
->
ch™√l
 <= 5350)

794 
ªt
 = 1;

795 i‡((
ch™
->
ch™√l
 > 5350) && (chan->channel <= 5600))

796 
ªt
 = 3;

798 
ªt
 = 5;

800 i‡(
	`IS_CHAN_HT40
(
ch™
))

801 
ªt
++;

803  
ªt
;

804 
	}
}

806 
	$¨9561_hw_gë_modes_txgaö_ödex
(
©h_hw
 *
ah
,

807 
©h9k_ch™√l
 *
ch™
)

809 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

810 i‡(
	`IS_CHAN_HT40
(
ch™
))

817 
	}
}

819 
	$¨9003_doubÀr_fix
(
©h_hw
 *
ah
)

821 i‡(
	`AR_SREV_9300
(
ah
Ë|| 
	`AR_SREV_9580
◊hË|| 
	`AR_SREV_9550
(ah)) {

822 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH0_RXTX2
,

823 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

824 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
, 0);

825 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH1_RXTX2
,

826 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

827 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
, 0);

828 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH2_RXTX2
,

829 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

830 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
, 0);

832 
	`udñay
(200);

834 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_65NM_CH0_RXTX2
,

835 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
);

836 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_65NM_CH1_RXTX2
,

837 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
);

838 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_65NM_CH2_RXTX2
,

839 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
);

841 
	`udñay
(1);

843 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_RXTX2
,

844 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
, 1);

845 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH1_RXTX2
,

846 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
, 1);

847 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH2_RXTX2
,

848 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
, 1);

850 
	`udñay
(200);

852 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_65NM_CH0_SYNTH12
,

853 
AR_PHY_65NM_CH0_SYNTH12_VREFMUL3
, 0xf);

855 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH0_RXTX2
, 0,

856 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

857 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
);

858 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH1_RXTX2
, 0,

859 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

860 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
);

861 
	`REG_RMW
(
ah
, 
AR_PHY_65NM_CH2_RXTX2
, 0,

862 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 |

863 1 << 
AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
);

865 
	}
}

867 
	$¨9003_hw_¥o˚ss_öi
(
©h_hw
 *
ah
,

868 
©h9k_ch™√l
 *
ch™
)

870 
ªgWrôes
 = 0, 
i
;

871 
u32
 
modesIndex
;

873 i‡(
	`IS_CHAN_5GHZ
(
ch™
))

874 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 2 : 1;

876 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 3 : 4;

881 
i
 = 0; i < 
ATH_INI_NUM_SPLIT
; i++) {

882 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiSOC
[
i
], 
modesIndex
);

883 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiMac
[
i
], 
modesIndex
);

884 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiBB
[
i
], 
modesIndex
);

885 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiRadio
[
i
], 
modesIndex
);

886 i‡(
i
 =
ATH_INI_POST
 && 
	`AR_SREV_9462_20_OR_LATER
(
ah
))

887 
	`¨9003_hw_¥og_öi
(
ah
,

888 &
ah
->
öi_ødio_po°_sys2™t
,

889 
modesIndex
);

892 
	`¨9003_doubÀr_fix
(
ah
);

897 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesRxGaö
, 1, 
ªgWrôes
);

899 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
)) {

903 i‡(
	`¨9003_hw_gë_rx_gaö_idx
(
ah
) == 2) {

904 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_c‹e
,

905 1, 
ªgWrôes
);

906 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_po°ambÀ
,

907 
modesIndex
, 
ªgWrôes
);

913 i‡((
	`¨9003_hw_gë_rx_gaö_idx
(
ah
) == 2) ||

914 (
	`¨9003_hw_gë_rx_gaö_idx
(
ah
) == 3)) {

915 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

916 
modesIndex
, 
ªgWrôes
);

920 i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

921 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rx_gaö_bounds
, 
modesIndex
,

922 
ªgWrôes
);

924 i‡(
	`AR_SREV_9561
(
ah
Ë&& (
	`¨9003_hw_gë_rx_gaö_idx
(ah) == 0))

925 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_x a
,

926 
modesIndex
, 
ªgWrôes
);

930 i‡(
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9561
(ah)) {

931 
modes_txgaö_ödex
 = 1;

933 i‡(
	`AR_SREV_9550
(
ah
))

934 
modes_txgaö_ödex
 = 
	`¨9550_hw_gë_modes_txgaö_ödex
(
ah
, 
ch™
);

936 i‡(
	`AR_SREV_9561
(
ah
))

937 
modes_txgaö_ödex
 =

938 
	`¨9561_hw_gë_modes_txgaö_ödex
(
ah
, 
ch™
);

940 i‡(
modes_txgaö_ödex
 < 0)

941  -
EINVAL
;

943 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesTxGaö
, 
modes_txgaö_ödex
,

944 
ªgWrôes
);

946 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesTxGaö
, 
modesIndex
, 
ªgWrôes
);

953 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

954 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesFa°Clock
,

955 
modesIndex
, 
ªgWrôes
);

960 
	`REG_WRITE_ARRAY
(&
ah
->
öiAddôi⁄Æ
, 1, 
ªgWrôes
);

965 i‡(
ch™
->
ch™√l
 == 2484)

966 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiCckfúJ≠™2484
, 1);

968 
ah
->
modes_ödex
 = 
modesIndex
;

969 
	`¨9003_hw_ovîride_öi
(
ah
);

970 
	`¨9003_hw_£t_ch™√l_ªgs
(
ah
, 
ch™
);

971 
	`¨9003_hw_£t_chaö_masks
(
ah
,áh->
rxchaömask
,áh->
txchaömask
);

972 
	`©h9k_hw_≠∂y_txpowî
(
ah
, 
ch™
, 
Ál£
);

975 
	}
}

977 
	$¨9003_hw_£t_rfmode
(
©h_hw
 *
ah
,

978 
©h9k_ch™√l
 *
ch™
)

980 
u32
 
rfMode
 = 0;

982 i‡(
ch™
 =
NULL
)

985 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

986 
rfMode
 |
AR_PHY_MODE_DYNAMIC
;

988 
rfMode
 |
AR_PHY_MODE_OFDM
;

990 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

991 
rfMode
 |(
AR_PHY_MODE_DYNAMIC
 | 
AR_PHY_MODE_DYN_CCK_DISABLE
);

993 i‡(
rfMode
 & (
AR_PHY_MODE_QUARTER
 | 
AR_PHY_MODE_HALF
))

994 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FRAME_CTL
,

995 
AR_PHY_FRAME_CTL_CF_OVERLAP_WINDOW
, 3);

997 
	`REG_WRITE
(
ah
, 
AR_PHY_MODE
, 
rfMode
);

998 
	}
}

1000 
	$¨9003_hw_m¨k_phy_öa˘ive
(
©h_hw
 *
ah
)

1002 
	`REG_WRITE
(
ah
, 
AR_PHY_ACTIVE
, 
AR_PHY_ACTIVE_DIS
);

1003 
	}
}

1005 
	$¨9003_hw_£t_dñè_¶›e
(
©h_hw
 *
ah
,

1006 
©h9k_ch™√l
 *
ch™
)

1008 
u32
 
c€f_sˇÀd
, 
ds_c€f_exp
, 
ds_c€f_m™
;

1009 
u32
 
˛ockMhzSˇÀd
 = 0x64000000;

1010 
ch™_˚¡îs
 
˚¡îs
;

1016 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
))

1017 
˛ockMhzSˇÀd
 = clockMhzScaled >> 1;

1018 i‡(
	`IS_CHAN_QUARTER_RATE
(
ch™
))

1019 
˛ockMhzSˇÀd
 = clockMhzScaled >> 2;

1025 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

1026 
c€f_sˇÀd
 = 
˛ockMhzSˇÀd
 / 
˚¡îs
.
sy¡h_˚¡î
;

1028 
	`©h9k_hw_gë_dñè_¶›e_vÆs
(
ah
, 
c€f_sˇÀd
, &
ds_c€f_m™
,

1029 &
ds_c€f_exp
);

1031 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING3
,

1032 
AR_PHY_TIMING3_DSC_MAN
, 
ds_c€f_m™
);

1033 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING3
,

1034 
AR_PHY_TIMING3_DSC_EXP
, 
ds_c€f_exp
);

1040 
c€f_sˇÀd
 = (9 * coef_scaled) / 10;

1042 
	`©h9k_hw_gë_dñè_¶›e_vÆs
(
ah
, 
c€f_sˇÀd
, &
ds_c€f_m™
,

1043 &
ds_c€f_exp
);

1046 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SGI_DELTA
,

1047 
AR_PHY_SGI_DSC_MAN
, 
ds_c€f_m™
);

1048 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SGI_DELTA
,

1049 
AR_PHY_SGI_DSC_EXP
, 
ds_c€f_exp
);

1050 
	}
}

1052 
boﬁ
 
	$¨9003_hw_rfbus_ªq
(
©h_hw
 *
ah
)

1054 
	`REG_WRITE
(
ah
, 
AR_PHY_RFBUS_REQ
, 
AR_PHY_RFBUS_REQ_EN
);

1055  
	`©h9k_hw_waô
(
ah
, 
AR_PHY_RFBUS_GRANT
, 
AR_PHY_RFBUS_GRANT_EN
,

1056 
AR_PHY_RFBUS_GRANT_EN
, 
AH_WAIT_TIMEOUT
);

1057 
	}
}

1063 
	$¨9003_hw_rfbus_d⁄e
(
©h_hw
 *
ah
)

1065 
u32
 
sy¡hDñay
 = 
	`REG_READ
(
ah
, 
AR_PHY_RX_DELAY
Ë& 
AR_PHY_RX_DELAY_DELAY
;

1067 
	`©h9k_hw_sy¡h_dñay
(
ah
,áh->
curch™
, 
sy¡hDñay
);

1069 
	`REG_WRITE
(
ah
, 
AR_PHY_RFBUS_REQ
, 0);

1070 
	}
}

1072 
boﬁ
 
	$¨9003_hw_™i_c⁄åﬁ
(
©h_hw
 *
ah
,

1073 
©h9k_™i_cmd
 
cmd
, 
∑øm
)

1075 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1076 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

1077 
¨5416AniSèã
 *
™iSèã
 = &
ah
->
™i
;

1078 
s32
 
vÆue
, 
vÆue2
;

1080 
cmd
 & 
ah
->
™i_fun˘i⁄
) {

1081 
ATH9K_ANI_OFDM_WEAK_SIGNAL_DETECTION
:{

1089 
u32
 
⁄
 = 
∑øm
 ? 1 : 0;

1091 i‡(
⁄
)

1092 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SFCORR_LOW
,

1093 
AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
);

1095 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SFCORR_LOW
,

1096 
AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
);

1098 i‡(
⁄
 !
™iSèã
->
ofdmWókSigDëe˘
) {

1099 
	`©h_dbg
(
comm⁄
, 
ANI
,

1101 
ch™
->
ch™√l
,

1102 
™iSèã
->
ofdmWókSigDëe˘
 ?

1104 
⁄
 ? "on" : "off");

1105 i‡(
⁄
)

1106 
ah
->
°©s
.
a°_™i_ofdm⁄
++;

1108 
ah
->
°©s
.
a°_™i_ofdmoff
++;

1109 
™iSèã
->
ofdmWókSigDëe˘
 = 
⁄
;

1113 
ATH9K_ANI_FIRSTEP_LEVEL
:{

1114 
u32
 
Àvñ
 = 
∑øm
;

1116 i‡(
Àvñ
 >
	`ARRAY_SIZE
(
fú°ï_èbÀ
)) {

1117 
	`©h_dbg
(
comm⁄
, 
ANI
,

1119 
Àvñ
, 
	`ARRAY_SIZE
(
fú°ï_èbÀ
));

1120  
Ál£
;

1127 
vÆue
 = 
fú°ï_èbÀ
[
Àvñ
] -

1128 
fú°ï_èbÀ
[
ATH9K_ANI_FIRSTEP_LVL
] +

1129 
™iSèã
->
öiDef
.
fú°ï
;

1130 i‡(
vÆue
 < 
ATH9K_SIG_FIRSTEP_SETTING_MIN
)

1131 
vÆue
 = 
ATH9K_SIG_FIRSTEP_SETTING_MIN
;

1132 i‡(
vÆue
 > 
ATH9K_SIG_FIRSTEP_SETTING_MAX
)

1133 
vÆue
 = 
ATH9K_SIG_FIRSTEP_SETTING_MAX
;

1134 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FIND_SIG
,

1135 
AR_PHY_FIND_SIG_FIRSTEP
,

1136 
vÆue
);

1142 
vÆue2
 = 
fú°ï_èbÀ
[
Àvñ
] -

1143 
fú°ï_èbÀ
[
ATH9K_ANI_FIRSTEP_LVL
] +

1144 
™iSèã
->
öiDef
.
fú°ïLow
;

1145 i‡(
vÆue2
 < 
ATH9K_SIG_FIRSTEP_SETTING_MIN
)

1146 
vÆue2
 = 
ATH9K_SIG_FIRSTEP_SETTING_MIN
;

1147 i‡(
vÆue2
 > 
ATH9K_SIG_FIRSTEP_SETTING_MAX
)

1148 
vÆue2
 = 
ATH9K_SIG_FIRSTEP_SETTING_MAX
;

1150 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FIND_SIG_LOW
,

1151 
AR_PHY_FIND_SIG_LOW_FIRSTEP_LOW
, 
vÆue2
);

1153 i‡(
Àvñ
 !
™iSèã
->
fú°ïLevñ
) {

1154 
	`©h_dbg
(
comm⁄
, 
ANI
,

1156 
ch™
->
ch™√l
,

1157 
™iSèã
->
fú°ïLevñ
,

1158 
Àvñ
,

1159 
ATH9K_ANI_FIRSTEP_LVL
,

1160 
vÆue
,

1161 
™iSèã
->
öiDef
.
fú°ï
);

1162 
	`©h_dbg
(
comm⁄
, 
ANI
,

1164 
ch™
->
ch™√l
,

1165 
™iSèã
->
fú°ïLevñ
,

1166 
Àvñ
,

1167 
ATH9K_ANI_FIRSTEP_LVL
,

1168 
vÆue2
,

1169 
™iSèã
->
öiDef
.
fú°ïLow
);

1170 i‡(
Àvñ
 > 
™iSèã
->
fú°ïLevñ
)

1171 
ah
->
°©s
.
a°_™i_°ïup
++;

1172 i‡(
Àvñ
 < 
™iSèã
->
fú°ïLevñ
)

1173 
ah
->
°©s
.
a°_™i_°ïdown
++;

1174 
™iSèã
->
fú°ïLevñ
 = 
Àvñ
;

1178 
ATH9K_ANI_SPUR_IMMUNITY_LEVEL
:{

1179 
u32
 
Àvñ
 = 
∑øm
;

1181 i‡(
Àvñ
 >
	`ARRAY_SIZE
(
cy˝wrThr1_èbÀ
)) {

1182 
	`©h_dbg
(
comm⁄
, 
ANI
,

1184 
Àvñ
, 
	`ARRAY_SIZE
(
cy˝wrThr1_èbÀ
));

1185  
Ál£
;

1191 
vÆue
 = 
cy˝wrThr1_èbÀ
[
Àvñ
] -

1192 
cy˝wrThr1_èbÀ
[
ATH9K_ANI_SPUR_IMMUNE_LVL
] +

1193 
™iSèã
->
öiDef
.
cy˝wrThr1
;

1194 i‡(
vÆue
 < 
ATH9K_SIG_SPUR_IMM_SETTING_MIN
)

1195 
vÆue
 = 
ATH9K_SIG_SPUR_IMM_SETTING_MIN
;

1196 i‡(
vÆue
 > 
ATH9K_SIG_SPUR_IMM_SETTING_MAX
)

1197 
vÆue
 = 
ATH9K_SIG_SPUR_IMM_SETTING_MAX
;

1198 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TIMING5
,

1199 
AR_PHY_TIMING5_CYCPWR_THR1
,

1200 
vÆue
);

1207 
vÆue2
 = 
cy˝wrThr1_èbÀ
[
Àvñ
] -

1208 
cy˝wrThr1_èbÀ
[
ATH9K_ANI_SPUR_IMMUNE_LVL
] +

1209 
™iSèã
->
öiDef
.
cy˝wrThr1Ext
;

1210 i‡(
vÆue2
 < 
ATH9K_SIG_SPUR_IMM_SETTING_MIN
)

1211 
vÆue2
 = 
ATH9K_SIG_SPUR_IMM_SETTING_MIN
;

1212 i‡(
vÆue2
 > 
ATH9K_SIG_SPUR_IMM_SETTING_MAX
)

1213 
vÆue2
 = 
ATH9K_SIG_SPUR_IMM_SETTING_MAX
;

1214 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA
,

1215 
AR_PHY_EXT_CYCPWR_THR1
, 
vÆue2
);

1217 i‡(
Àvñ
 !
™iSèã
->
•urImmunôyLevñ
) {

1218 
	`©h_dbg
(
comm⁄
, 
ANI
,

1220 
ch™
->
ch™√l
,

1221 
™iSèã
->
•urImmunôyLevñ
,

1222 
Àvñ
,

1223 
ATH9K_ANI_SPUR_IMMUNE_LVL
,

1224 
vÆue
,

1225 
™iSèã
->
öiDef
.
cy˝wrThr1
);

1226 
	`©h_dbg
(
comm⁄
, 
ANI
,

1228 
ch™
->
ch™√l
,

1229 
™iSèã
->
•urImmunôyLevñ
,

1230 
Àvñ
,

1231 
ATH9K_ANI_SPUR_IMMUNE_LVL
,

1232 
vÆue2
,

1233 
™iSèã
->
öiDef
.
cy˝wrThr1Ext
);

1234 i‡(
Àvñ
 > 
™iSèã
->
•urImmunôyLevñ
)

1235 
ah
->
°©s
.
a°_™i_•urup
++;

1236 i‡(
Àvñ
 < 
™iSèã
->
•urImmunôyLevñ
)

1237 
ah
->
°©s
.
a°_™i_•urdown
++;

1238 
™iSèã
->
•urImmunôyLevñ
 = 
Àvñ
;

1242 
ATH9K_ANI_MRC_CCK
:{

1247 
boﬁ
 
is_⁄
 = 
∑øm
 ? 1 : 0;

1249 i‡(
ah
->
ˇps
.
rx_chaömask
 == 1)

1252 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_MRC_CCK_CTRL
,

1253 
AR_PHY_MRC_CCK_ENABLE
, 
is_⁄
);

1254 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_MRC_CCK_CTRL
,

1255 
AR_PHY_MRC_CCK_MUX_REG
, 
is_⁄
);

1256 i‡(
is_⁄
 !
™iSèã
->
mrcCCK
) {

1257 
	`©h_dbg
(
comm⁄
, 
ANI
, "** ch %d: MRC CCK: %s=>%s\n",

1258 
ch™
->
ch™√l
,

1259 
™iSèã
->
mrcCCK
 ? "on" : "off",

1260 
is_⁄
 ? "on" : "off");

1261 i‡(
is_⁄
)

1262 
ah
->
°©s
.
a°_™i_ccklow
++;

1264 
ah
->
°©s
.
a°_™i_cckhigh
++;

1265 
™iSèã
->
mrcCCK
 = 
is_⁄
;

1270 
	`©h_dbg
(
comm⁄
, 
ANI
, "övÆid cmd %u\n", 
cmd
);

1271  
Ál£
;

1274 
	`©h_dbg
(
comm⁄
, 
ANI
,

1276 
™iSèã
->
•urImmunôyLevñ
,

1277 
™iSèã
->
ofdmWókSigDëe˘
 ? "on" : "off",

1278 
™iSèã
->
fú°ïLevñ
,

1279 
™iSèã
->
mrcCCK
 ? "on" : "off",

1280 
™iSèã
->
li°íTime
,

1281 
™iSèã
->
ofdmPhyEºCou¡
,

1282 
™iSèã
->
cckPhyEºCou¡
);

1283  
åue
;

1284 
	}
}

1286 
	$¨9003_hw_do_gënf
(
©h_hw
 *
ah
,

1287 
öt16_t
 
nÁºay
[
NUM_NF_READINGS
])

1289 
	#AR_PHY_CH_MINCCA_PWR
 0x1FF00000

	)

1290 
	#AR_PHY_CH_MINCCA_PWR_S
 20

	)

1291 
	#AR_PHY_CH_EXT_MINCCA_PWR
 0x01FF0000

	)

1292 
	#AR_PHY_CH_EXT_MINCCA_PWR_S
 16

	)

1294 
öt16_t
 
nf
;

1295 
i
;

1297 
i
 = 0; i < 
AR9300_MAX_CHAINS
; i++) {

1298 i‡(
ah
->
rxchaömask
 & 
	`BIT
(
i
)) {

1299 
nf
 = 
	`MS
(
	`REG_READ
(
ah
,áh->
nf_ªgs
[
i
]),

1300 
AR_PHY_CH_MINCCA_PWR
);

1301 
nÁºay
[
i
] = 
	`sign_exãnd32
(
nf
, 8);

1303 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
)) {

1304 
u8
 
ext_idx
 = 
AR9300_MAX_CHAINS
 + 
i
;

1306 
nf
 = 
	`MS
(
	`REG_READ
(
ah
,áh->
nf_ªgs
[
ext_idx
]),

1307 
AR_PHY_CH_EXT_MINCCA_PWR
);

1308 
nÁºay
[
ext_idx
] = 
	`sign_exãnd32
(
nf
, 8);

1312 
	}
}

1314 
	$¨9003_hw_£t_nf_limôs
(
©h_hw
 *
ah
)

1316 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9300_2GHZ
;

1317 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9300_2GHZ
;

1318 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9300_2GHZ
;

1319 
ah
->
nf_5g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9300_5GHZ
;

1320 
ah
->
nf_5g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9300_5GHZ
;

1321 
ah
->
nf_5g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9300_5GHZ
;

1323 i‡(
	`AR_SREV_9330
(
ah
))

1324 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9330_2GHZ
;

1326 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

1327 
ah
->
nf_2g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9462_2GHZ
;

1328 
ah
->
nf_2g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9462_2GHZ
;

1329 
ah
->
nf_5g
.
mö
 = 
AR_PHY_CCA_MIN_GOOD_VAL_9462_5GHZ
;

1330 
ah
->
nf_5g
.
nomöÆ
 = 
AR_PHY_CCA_NOM_VAL_9462_5GHZ
;

1332 
	}
}

1339 
	$¨9003_hw_™i_ˇche_öi_ªgs
(
©h_hw
 *
ah
)

1341 
¨5416AniSèã
 *
™iSèã
;

1342 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1343 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

1344 
©h9k_™i_deÁu…
 *
öiDef
;

1345 
u32
 
vÆ
;

1347 
™iSèã
 = &
ah
->
™i
;

1348 
öiDef
 = &
™iSèã
->iniDef;

1350 
	`©h_dbg
(
comm⁄
, 
ANI
, "ver %d.%d opmode %u chan %d Mhz\n",

1351 
ah
->
hw_vîsi⁄
.
macVîsi⁄
,

1352 
ah
->
hw_vîsi⁄
.
macRev
,

1353 
ah
->
›mode
,

1354 
ch™
->
ch™√l
);

1356 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR
);

1357 
öiDef
->
m1Thªsh
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M1_THRESH
);

1358 
öiDef
->
m2Thªsh
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M2_THRESH
);

1359 
öiDef
->
m2Cou¡Thr
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_M2COUNT_THR
);

1361 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR_LOW
);

1362 
öiDef
->
m1ThªshLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M1_THRESH_LOW
);

1363 
öiDef
->
m2ThªshLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M2_THRESH_LOW
);

1364 
öiDef
->
m2Cou¡ThrLow
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW
);

1366 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_SFCORR_EXT
);

1367 
öiDef
->
m1ThªshExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M1_THRESH
);

1368 
öiDef
->
m2ThªshExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M2_THRESH
);

1369 
öiDef
->
m1ThªshLowExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M1_THRESH_LOW
);

1370 
öiDef
->
m2ThªshLowExt
 = 
	`MS
(
vÆ
, 
AR_PHY_SFCORR_EXT_M2_THRESH_LOW
);

1371 
öiDef
->
fú°ï
 = 
	`REG_READ_FIELD
(
ah
,

1372 
AR_PHY_FIND_SIG
,

1373 
AR_PHY_FIND_SIG_FIRSTEP
);

1374 
öiDef
->
fú°ïLow
 = 
	`REG_READ_FIELD
(
ah
,

1375 
AR_PHY_FIND_SIG_LOW
,

1376 
AR_PHY_FIND_SIG_LOW_FIRSTEP_LOW
);

1377 
öiDef
->
cy˝wrThr1
 = 
	`REG_READ_FIELD
(
ah
,

1378 
AR_PHY_TIMING5
,

1379 
AR_PHY_TIMING5_CYCPWR_THR1
);

1380 
öiDef
->
cy˝wrThr1Ext
 = 
	`REG_READ_FIELD
(
ah
,

1381 
AR_PHY_EXT_CCA
,

1382 
AR_PHY_EXT_CYCPWR_THR1
);

1385 
™iSèã
->
•urImmunôyLevñ
 = 
ATH9K_ANI_SPUR_IMMUNE_LVL
;

1386 
™iSèã
->
fú°ïLevñ
 = 
ATH9K_ANI_FIRSTEP_LVL
;

1387 
™iSèã
->
ofdmWókSigDëe˘
 = 
åue
;

1388 
™iSèã
->
mrcCCK
 = 
åue
;

1389 
	}
}

1391 
	$¨9003_hw_£t_ød¨_∑øms
(
©h_hw
 *
ah
,

1392 
©h_hw_ød¨_c⁄f
 *
c⁄f
)

1394 
ªgWrôes
 = 0;

1395 
u32
 
ød¨_0
 = 0, 
ød¨_1
;

1397 i‡(!
c⁄f
) {

1398 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_RADAR_0
, 
AR_PHY_RADAR_0_ENA
);

1402 
ød¨_0
 |
AR_PHY_RADAR_0_ENA
 | 
AR_PHY_RADAR_0_FFT_ENA
;

1403 
ød¨_0
 |
	`SM
(
c⁄f
->
fú_powî
, 
AR_PHY_RADAR_0_FIRPWR
);

1404 
ød¨_0
 |
	`SM
(
c⁄f
->
ød¨_rssi
, 
AR_PHY_RADAR_0_RRSSI
);

1405 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_height
, 
AR_PHY_RADAR_0_HEIGHT
);

1406 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_rssi
, 
AR_PHY_RADAR_0_PRSSI
);

1407 
ød¨_0
 |
	`SM
(
c⁄f
->
pul£_öb™d
, 
AR_PHY_RADAR_0_INBAND
);

1409 
ød¨_1
 = 
	`REG_READ
(
ah
, 
AR_PHY_RADAR_1
);

1410 
ød¨_1
 &~(
AR_PHY_RADAR_1_MAXLEN
 | 
AR_PHY_RADAR_1_RELSTEP_THRESH
 |

1411 
AR_PHY_RADAR_1_RELPWR_THRESH
);

1412 
ød¨_1
 |
AR_PHY_RADAR_1_MAX_RRSSI
;

1413 
ød¨_1
 |
AR_PHY_RADAR_1_BLOCK_CHECK
;

1414 
ød¨_1
 |
	`SM
(
c⁄f
->
pul£_maxÀn
, 
AR_PHY_RADAR_1_MAXLEN
);

1415 
ød¨_1
 |
	`SM
(
c⁄f
->
pul£_öb™d_°ï
, 
AR_PHY_RADAR_1_RELSTEP_THRESH
);

1416 
ød¨_1
 |
	`SM
(
c⁄f
->
ød¨_öb™d
, 
AR_PHY_RADAR_1_RELPWR_THRESH
);

1418 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_0
, 
ød¨_0
);

1419 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_1
, 
ød¨_1
);

1420 i‡(
c⁄f
->
ext_ch™√l
)

1421 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RADAR_EXT
, 
AR_PHY_RADAR_EXT_ENA
);

1423 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_RADAR_EXT
, 
AR_PHY_RADAR_EXT_ENA
);

1425 i‡(
	`AR_SREV_9300
(
ah
Ë|| 
	`AR_SREV_9340
◊hË|| 
	`AR_SREV_9580
(ah)) {

1426 
	`REG_WRITE_ARRAY
(&
ah
->
öi_dfs
,

1427 
	`IS_CHAN_HT40
(
ah
->
curch™
Ë? 2 : 1, 
ªgWrôes
);

1429 
	}
}

1431 
	$¨9003_hw_£t_ød¨_c⁄f
(
©h_hw
 *
ah
)

1433 
©h_hw_ød¨_c⁄f
 *
c⁄f
 = &
ah
->
ød¨_c⁄f
;

1435 
c⁄f
->
fú_powî
 = -28;

1436 
c⁄f
->
ød¨_rssi
 = 0;

1437 
c⁄f
->
pul£_height
 = 10;

1438 
c⁄f
->
pul£_rssi
 = 15;

1439 
c⁄f
->
pul£_öb™d
 = 8;

1440 
c⁄f
->
pul£_maxÀn
 = 255;

1441 
c⁄f
->
pul£_öb™d_°ï
 = 12;

1442 
c⁄f
->
ød¨_öb™d
 = 8;

1443 
	}
}

1445 
	$¨9003_hw_™tdiv_comb_c⁄f_gë
(
©h_hw
 *
ah
,

1446 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

1448 
u32
 
ªgvÆ
;

1450 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1451 
™tc⁄f
->
maö_ a_c⁄f
 = (
ªgvÆ
 & 
AR_PHY_ANT_DIV_MAIN_LNACONF
) >>

1452 
AR_PHY_ANT_DIV_MAIN_LNACONF_S
;

1453 
™tc⁄f
->
Æt_ a_c⁄f
 = (
ªgvÆ
 & 
AR_PHY_ANT_DIV_ALT_LNACONF
) >>

1454 
AR_PHY_ANT_DIV_ALT_LNACONF_S
;

1455 
™tc⁄f
->
Á°_div_büs
 = (
ªgvÆ
 & 
AR_PHY_ANT_FAST_DIV_BIAS
) >>

1456 
AR_PHY_ANT_FAST_DIV_BIAS_S
;

1458 i‡(
	`AR_SREV_9330_11
(
ah
)) {

1459 
™tc⁄f
->
 a1_ a2_swôch_dñè
 = -1;

1460 
™tc⁄f
->
 a1_ a2_dñè
 = -9;

1461 
™tc⁄f
->
div_group
 = 1;

1462 } i‡(
	`AR_SREV_9485
(
ah
)) {

1463 
™tc⁄f
->
 a1_ a2_swôch_dñè
 = -1;

1464 
™tc⁄f
->
 a1_ a2_dñè
 = -9;

1465 
™tc⁄f
->
div_group
 = 2;

1466 } i‡(
	`AR_SREV_9565
(
ah
)) {

1467 
™tc⁄f
->
 a1_ a2_swôch_dñè
 = 3;

1468 
™tc⁄f
->
 a1_ a2_dñè
 = -9;

1469 
™tc⁄f
->
div_group
 = 3;

1471 
™tc⁄f
->
 a1_ a2_swôch_dñè
 = -1;

1472 
™tc⁄f
->
 a1_ a2_dñè
 = -3;

1473 
™tc⁄f
->
div_group
 = 0;

1475 
	}
}

1477 
	$¨9003_hw_™tdiv_comb_c⁄f_£t
(
©h_hw
 *
ah
,

1478 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

1480 
u32
 
ªgvÆ
;

1482 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1483 
ªgvÆ
 &~(
AR_PHY_ANT_DIV_MAIN_LNACONF
 |

1484 
AR_PHY_ANT_DIV_ALT_LNACONF
 |

1485 
AR_PHY_ANT_FAST_DIV_BIAS
 |

1486 
AR_PHY_ANT_DIV_MAIN_GAINTB
 |

1487 
AR_PHY_ANT_DIV_ALT_GAINTB
);

1488 
ªgvÆ
 |((
™tc⁄f
->
maö_ a_c⁄f
 << 
AR_PHY_ANT_DIV_MAIN_LNACONF_S
)

1489 & 
AR_PHY_ANT_DIV_MAIN_LNACONF
);

1490 
ªgvÆ
 |((
™tc⁄f
->
Æt_ a_c⁄f
 << 
AR_PHY_ANT_DIV_ALT_LNACONF_S
)

1491 & 
AR_PHY_ANT_DIV_ALT_LNACONF
);

1492 
ªgvÆ
 |((
™tc⁄f
->
Á°_div_büs
 << 
AR_PHY_ANT_FAST_DIV_BIAS_S
)

1493 & 
AR_PHY_ANT_FAST_DIV_BIAS
);

1494 
ªgvÆ
 |((
™tc⁄f
->
maö_gaötb
 << 
AR_PHY_ANT_DIV_MAIN_GAINTB_S
)

1495 & 
AR_PHY_ANT_DIV_MAIN_GAINTB
);

1496 
ªgvÆ
 |((
™tc⁄f
->
Æt_gaötb
 << 
AR_PHY_ANT_DIV_ALT_GAINTB_S
)

1497 & 
AR_PHY_ANT_DIV_ALT_GAINTB
);

1499 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

1500 
	}
}

1502 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


1504 
	$¨9003_hw_£t_bt_™t_divîsôy
(
©h_hw
 *
ah
, 
boﬁ
 
íabÀ
)

1506 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

1507 
u8
 
™t_div_˘l1
;

1508 
u32
 
ªgvÆ
;

1510 i‡(!
	`AR_SREV_9485
(
ah
Ë&& !
	`AR_SREV_9565
(ah))

1513 i‡(
	`AR_SREV_9485
(
ah
)) {

1514 
ªgvÆ
 = 
	`¨9003_hw_™t_˘æ_comm⁄_2_gë
(
ah
,

1515 
	`IS_CHAN_2GHZ
(
ah
->
curch™
));

1516 i‡(
íabÀ
) {

1517 
ªgvÆ
 &~
AR_SWITCH_TABLE_COM2_ALL
;

1518 
ªgvÆ
 |
ah
->
c⁄fig
.
™t_˘æ_comm2g_swôch_íabÀ
;

1520 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SWITCH_COM_2
,

1521 
AR_SWITCH_TABLE_COM2_ALL
, 
ªgvÆ
);

1524 
™t_div_˘l1
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_ANT_DIV_CTL1
);

1530 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1531 
ªgvÆ
 &(~
AR_ANT_DIV_CTRL_ALL
);

1532 
ªgvÆ
 |(
™t_div_˘l1
 & 0x3fË<< 
AR_ANT_DIV_CTRL_ALL_S
;

1533 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

1535 i‡(
	`AR_SREV_9485_11_OR_LATER
(
ah
)) {

1539 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1540 
ªgvÆ
 &~
AR_PHY_ANT_DIV_LNADIV
;

1541 
ªgvÆ
 |((
™t_div_˘l1
 >> 6Ë& 0x1Ë<< 
AR_PHY_ANT_DIV_LNADIV_S
;

1542 i‡(
íabÀ
)

1543 
ªgvÆ
 |
AR_ANT_DIV_ENABLE
;

1545 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

1550 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_DETECT
);

1551 
ªgvÆ
 &~
AR_FAST_DIV_ENABLE
;

1552 
ªgvÆ
 |((
™t_div_˘l1
 >> 7Ë& 0x1Ë<< 
AR_FAST_DIV_ENABLE_S
;

1553 i‡(
íabÀ
)

1554 
ªgvÆ
 |
AR_FAST_DIV_ENABLE
;

1556 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_DETECT
, 
ªgvÆ
);

1558 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
) {

1559 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1560 
ªgvÆ
 &(~(
AR_PHY_ANT_DIV_MAIN_LNACONF
 |

1561 
AR_PHY_ANT_DIV_ALT_LNACONF
 |

1562 
AR_PHY_ANT_DIV_ALT_GAINTB
 |

1563 
AR_PHY_ANT_DIV_MAIN_GAINTB
));

1568 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA1
 <<

1569 
AR_PHY_ANT_DIV_MAIN_LNACONF_S
);

1570 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA2
 <<

1571 
AR_PHY_ANT_DIV_ALT_LNACONF_S
);

1572 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

1574 } i‡(
	`AR_SREV_9565
(
ah
)) {

1575 i‡(
íabÀ
) {

1576 
	`REG_SET_BIT
(
ah
, 
AR_PHY_MC_GAIN_CTRL
,

1577 
AR_ANT_DIV_ENABLE
);

1578 
	`REG_SET_BIT
(
ah
, 
AR_PHY_MC_GAIN_CTRL
,

1579 (1 << 
AR_PHY_ANT_SW_RX_PROT_S
));

1580 
	`REG_SET_BIT
(
ah
, 
AR_PHY_CCK_DETECT
,

1581 
AR_FAST_DIV_ENABLE
);

1582 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RESTART
,

1583 
AR_PHY_RESTART_ENABLE_DIV_M2FLAG
);

1584 
	`REG_SET_BIT
(
ah
, 
AR_BTCOEX_WL_LNADIV
,

1585 
AR_BTCOEX_WL_LNADIV_FORCE_ON
);

1587 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_MC_GAIN_CTRL
,

1588 
AR_ANT_DIV_ENABLE
);

1589 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_MC_GAIN_CTRL
,

1590 (1 << 
AR_PHY_ANT_SW_RX_PROT_S
));

1591 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_CCK_DETECT
,

1592 
AR_FAST_DIV_ENABLE
);

1593 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_RESTART
,

1594 
AR_PHY_RESTART_ENABLE_DIV_M2FLAG
);

1595 
	`REG_CLR_BIT
(
ah
, 
AR_BTCOEX_WL_LNADIV
,

1596 
AR_BTCOEX_WL_LNADIV_FORCE_ON
);

1598 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MC_GAIN_CTRL
);

1599 
ªgvÆ
 &~(
AR_PHY_ANT_DIV_MAIN_LNACONF
 |

1600 
AR_PHY_ANT_DIV_ALT_LNACONF
 |

1601 
AR_PHY_ANT_DIV_MAIN_GAINTB
 |

1602 
AR_PHY_ANT_DIV_ALT_GAINTB
);

1603 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA1
 <<

1604 
AR_PHY_ANT_DIV_MAIN_LNACONF_S
);

1605 
ªgvÆ
 |(
ATH_ANT_DIV_COMB_LNA2
 <<

1606 
AR_PHY_ANT_DIV_ALT_LNACONF_S
);

1607 
	`REG_WRITE
(
ah
, 
AR_PHY_MC_GAIN_CTRL
, 
ªgvÆ
);

1610 
	}
}

1614 
	$¨9003_hw_Á°_ch™_ch™ge
(
©h_hw
 *
ah
,

1615 
©h9k_ch™√l
 *
ch™
,

1616 
u8
 *
öi_ªlﬂded
)

1618 
ªgWrôes
 = 0;

1619 
u32
 
modesIndex
, 
txgaö_ödex
;

1621 i‡(
	`IS_CHAN_5GHZ
(
ch™
))

1622 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 2 : 1;

1624 
modesIndex
 = 
	`IS_CHAN_HT40
(
ch™
) ? 3 : 4;

1626 
txgaö_ödex
 = 
	`AR_SREV_9531
(
ah
Ë? 1 : 
modesIndex
;

1628 i‡(
modesIndex
 =
ah
->
modes_ödex
) {

1629 *
öi_ªlﬂded
 = 
Ál£
;

1630 
£t_rfmode
;

1633 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiSOC
[
ATH_INI_POST
], 
modesIndex
);

1634 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiMac
[
ATH_INI_POST
], 
modesIndex
);

1635 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiBB
[
ATH_INI_POST
], 
modesIndex
);

1636 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiRadio
[
ATH_INI_POST
], 
modesIndex
);

1638 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
))

1639 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öi_ødio_po°_sys2™t
,

1640 
modesIndex
);

1642 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesTxGaö
, 
txgaö_ödex
, 
ªgWrôes
);

1644 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
)) {

1648 i‡(
	`¨9003_hw_gë_rx_gaö_idx
(
ah
) == 2) {

1649 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_c‹e
,

1650 1, 
ªgWrôes
);

1651 
	`REG_WRITE_ARRAY
(&
ah
->
öi_modes_rxgaö_bb_po°ambÀ
,

1652 
modesIndex
, 
ªgWrôes
);

1660 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

1661 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesFa°Clock
, 
modesIndex
, 
ªgWrôes
);

1663 i‡(
	`AR_SREV_9565
(
ah
))

1664 
	`REG_WRITE_ARRAY
(&
ah
->
öiModesFa°Clock
, 1, 
ªgWrôes
);

1669 i‡(
ch™
->
ch™√l
 == 2484)

1670 
	`¨9003_hw_¥og_öi
(
ah
, &ah->
öiCckfúJ≠™2484
, 1);

1672 
ah
->
modes_ödex
 = 
modesIndex
;

1673 *
öi_ªlﬂded
 = 
åue
;

1675 
£t_rfmode
:

1676 
	`¨9003_hw_£t_rfmode
(
ah
, 
ch™
);

1678 
	}
}

1680 
	$¨9003_hw_•e˘øl_sˇn_c⁄fig
(
©h_hw
 *
ah
,

1681 
©h_•ec_sˇn
 *
∑øm
)

1683 
u8
 
cou¡
;

1685 i‡(!
∑øm
->
íabÀd
) {

1686 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1687 
AR_PHY_SPECTRAL_SCAN_ENABLE
);

1691 
	`REG_SET_BIT
(
ah
, 
AR_PHY_RADAR_0
, 
AR_PHY_RADAR_0_FFT_ENA
);

1692 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
, 
AR_PHY_SPECTRAL_SCAN_ENABLE
);

1698 
cou¡
 = 
∑øm
->count;

1699 i‡(
∑øm
->
ídÀss
)

1700 
cou¡
 = 0;

1701 i‡(
∑øm
->
cou¡
 == 0)

1702 
cou¡
 = 1;

1704 i‡(
∑øm
->
sh‹t_ª≥©
)

1705 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1706 
AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
);

1708 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1709 
AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
);

1711 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1712 
AR_PHY_SPECTRAL_SCAN_COUNT
, 
cou¡
);

1713 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1714 
AR_PHY_SPECTRAL_SCAN_PERIOD
, 
∑øm
->
≥riod
);

1715 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1716 
AR_PHY_SPECTRAL_SCAN_FFT_PERIOD
, 
∑øm
->
f·_≥riod
);

1719 
	}
}

1721 
	$¨9003_hw_•e˘øl_sˇn_åiggî
(
©h_hw
 *
ah
)

1724 
	`REG_SET_BIT
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1725 
AR_PHY_SPECTRAL_SCAN_ACTIVE
);

1726 
	}
}

1728 
	$¨9003_hw_•e˘øl_sˇn_waô
(
©h_hw
 *
ah
)

1730 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1733 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_SPECTRAL_SCAN
,

1734 
AR_PHY_SPECTRAL_SCAN_ACTIVE
,

1735 0, 
AH_WAIT_TIMEOUT
)) {

1736 
	`©h_îr
(
comm⁄
, "spectral scan wait failed\n");

1739 
	}
}

1741 
	$¨9003_hw_tx99_°¨t
(
©h_hw
 *
ah
, 
u32
 
qnum
)

1743 
	`REG_SET_BIT
(
ah
, 
AR_PHY_TEST
, 
PHY_AGC_CLR
);

1744 
	`REG_SET_BIT
(
ah
, 0x9864, 0x7f000);

1745 
	`REG_SET_BIT
(
ah
, 0x9924, 0x7f00fe);

1746 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

1747 
	`REG_WRITE
(
ah
, 
AR_CR
, 
AR_CR_RXD
);

1748 
	`REG_WRITE
(
ah
, 
	`AR_DLCL_IFS
(
qnum
), 0);

1749 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_SIFS
, 20);

1750 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_EIFS
, 20);

1751 
	`REG_WRITE
(
ah
, 
AR_TIME_OUT
, 0x00000400);

1752 
	`REG_WRITE
(
ah
, 
	`AR_DRETRY_LIMIT
(
qnum
), 0xffffffff);

1753 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
qnum
), 
AR_Q_MISC_DCU_EARLY_TERM_REQ
);

1754 
	}
}

1756 
	$¨9003_hw_tx99_°›
(
©h_hw
 *
ah
)

1758 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TEST
, 
PHY_AGC_CLR
);

1759 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

1760 
	}
}

1762 
	$¨9003_hw_tx99_£t_txpowî
(
©h_hw
 *
ah
, 
u8
 
txpowî
)

1764 
s16
 
p_pwr_¨øy
[
¨9300R©eSize
] = { 0 };

1765 
i
;

1767 i‡(
txpowî
 <
MAX_RATE_POWER
) {

1768 
i
 = 0; i < 
¨9300R©eSize
; i++)

1769 
p_pwr_¨øy
[
i
] = 
txpowî
;

1771 
i
 = 0; i < 
¨9300R©eSize
; i++)

1772 
p_pwr_¨øy
[
i
] = 
MAX_RATE_POWER
;

1775 
	`REG_WRITE
(
ah
, 0xa458, 0);

1777 
	`REG_WRITE
(
ah
, 0xa3c0,

1778 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 24) |

1779 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 16) |

1780 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 8) |

1781 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 0));

1782 
	`REG_WRITE
(
ah
, 0xa3c4,

1783 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_54
], 24) |

1784 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_48
], 16) |

1785 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_36
], 8) |

1786 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_6_24
], 0));

1787 
	`REG_WRITE
(
ah
, 0xa3c8,

1788 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 24) |

1789 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 16) |

1790 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 0));

1791 
	`REG_WRITE
(
ah
, 0xa3cc,

1792 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_11S
], 24) |

1793 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_11L
], 16) |

1794 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_5S
], 8) |

1795 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_LEGACY_1L_5L
], 0));

1796 
	`REG_WRITE
(
ah
, 0xa3d0,

1797 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_5
], 24) |

1798 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_4
], 16) |

1799 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_1_3_9_11_17_19
], 8)|

1800 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_0_8_16
], 0));

1801 
	`REG_WRITE
(
ah
, 0xa3d4,

1802 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_13
], 24) |

1803 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_12
], 16) |

1804 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_7
], 8) |

1805 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_6
], 0));

1806 
	`REG_WRITE
(
ah
, 0xa3e4,

1807 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_21
], 24) |

1808 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_20
], 16) |

1809 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_15
], 8) |

1810 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_14
], 0));

1811 
	`REG_WRITE
(
ah
, 0xa3e8,

1812 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_23
], 24) |

1813 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_22
], 16) |

1814 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_23
], 8) |

1815 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT20_22
], 0));

1816 
	`REG_WRITE
(
ah
, 0xa3d8,

1817 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_5
], 24) |

1818 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_4
], 16) |

1819 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_1_3_9_11_17_19
], 8) |

1820 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_0_8_16
], 0));

1821 
	`REG_WRITE
(
ah
, 0xa3dc,

1822 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_13
], 24) |

1823 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_12
], 16) |

1824 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_7
], 8) |

1825 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_6
], 0));

1826 
	`REG_WRITE
(
ah
, 0xa3ec,

1827 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_21
], 24) |

1828 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_20
], 16) |

1829 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_15
], 8) |

1830 
	`ATH9K_POW_SM
(
p_pwr_¨øy
[
ALL_TARGET_HT40_14
], 0));

1831 
	}
}

1833 
	$¨9003_hw_öô_txpowî_cck
(
©h_hw
 *
ah
, 
u8
 *
øã_¨øy
)

1835 
ah
->
tx_powî
[0] = 
øã_¨øy
[
ALL_TARGET_LEGACY_1L_5L
];

1836 
ah
->
tx_powî
[1] = 
øã_¨øy
[
ALL_TARGET_LEGACY_1L_5L
];

1837 
ah
->
tx_powî
[2] = 
	`mö
(
øã_¨øy
[
ALL_TARGET_LEGACY_1L_5L
],

1838 
øã_¨øy
[
ALL_TARGET_LEGACY_5S
]);

1839 
ah
->
tx_powî
[3] = 
	`mö
(
øã_¨øy
[
ALL_TARGET_LEGACY_11L
],

1840 
øã_¨øy
[
ALL_TARGET_LEGACY_11S
]);

1841 
	}
}

1843 
	$¨9003_hw_öô_txpowî_ofdm
(
©h_hw
 *
ah
, 
u8
 *
øã_¨øy
,

1844 
off£t
)

1846 
i
, 
j
;

1848 
i
 = 
off£t
; i < off£à+ 
AR9300_OFDM_RATES
; i++) {

1850 
j
 = 
ofdm2pwr
[
i
 - 
off£t
];

1851 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
j
];

1853 
	}
}

1855 
	$¨9003_hw_öô_txpowî_ht
(
©h_hw
 *
ah
, 
u8
 *
øã_¨øy
,

1856 
ss_off£t
, 
ds_off£t
,

1857 
ts_off£t
, 
boﬁ
 
is_40
)

1859 
i
, 
j
, 
mcs_idx
 = 0;

1860 c⁄° 
u8
 *
mcs2pwr
 = (
is_40
Ë? 
mcs2pwr_ht40
 : 
mcs2pwr_ht20
;

1862 
i
 = 
ss_off£t
; i < ss_off£à+ 
AR9300_HT_SS_RATES
; i++) {

1863 
j
 = 
mcs2pwr
[
mcs_idx
];

1864 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
j
];

1865 
mcs_idx
++;

1868 
i
 = 
ds_off£t
; i < ds_off£à+ 
AR9300_HT_DS_RATES
; i++) {

1869 
j
 = 
mcs2pwr
[
mcs_idx
];

1870 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
j
];

1871 
mcs_idx
++;

1874 
i
 = 
ts_off£t
; i <Ås_off£à+ 
AR9300_HT_TS_RATES
; i++) {

1875 
j
 = 
mcs2pwr
[
mcs_idx
];

1876 
ah
->
tx_powî
[
i
] = 
øã_¨øy
[
j
];

1877 
mcs_idx
++;

1879 
	}
}

1881 
	$¨9003_hw_öô_txpowî_°bc
(
©h_hw
 *
ah
, 
ss_off£t
,

1882 
ds_off£t
, 
ts_off£t
)

1884 
	`mem˝y
(&
ah
->
tx_powî_°bc
[
ss_off£t
], &ah->
tx_powî
[ss_offset],

1885 
AR9300_HT_SS_RATES
);

1886 
	`mem˝y
(&
ah
->
tx_powî_°bc
[
ds_off£t
], &ah->
tx_powî
[ds_offset],

1887 
AR9300_HT_DS_RATES
);

1888 
	`mem˝y
(&
ah
->
tx_powî_°bc
[
ts_off£t
], &ah->
tx_powî
[ts_offset],

1889 
AR9300_HT_TS_RATES
);

1890 
	}
}

1892 
	$¨9003_hw_öô_øã_txpowî
(
©h_hw
 *
ah
, 
u8
 *
øã_¨øy
,

1893 
©h9k_ch™√l
 *
ch™
)

1895 i‡(
	`IS_CHAN_5GHZ
(
ch™
)) {

1896 
	`¨9003_hw_öô_txpowî_ofdm
(
ah
, 
øã_¨øy
,

1897 
AR9300_11NA_OFDM_SHIFT
);

1898 i‡(
	`IS_CHAN_HT20
(
ch™
Ë|| 
	`IS_CHAN_HT40
(chan)) {

1899 
	`¨9003_hw_öô_txpowî_ht
(
ah
, 
øã_¨øy
,

1900 
AR9300_11NA_HT_SS_SHIFT
,

1901 
AR9300_11NA_HT_DS_SHIFT
,

1902 
AR9300_11NA_HT_TS_SHIFT
,

1903 
	`IS_CHAN_HT40
(
ch™
));

1904 
	`¨9003_hw_öô_txpowî_°bc
(
ah
,

1905 
AR9300_11NA_HT_SS_SHIFT
,

1906 
AR9300_11NA_HT_DS_SHIFT
,

1907 
AR9300_11NA_HT_TS_SHIFT
);

1910 
	`¨9003_hw_öô_txpowî_cck
(
ah
, 
øã_¨øy
);

1911 
	`¨9003_hw_öô_txpowî_ofdm
(
ah
, 
øã_¨øy
,

1912 
AR9300_11NG_OFDM_SHIFT
);

1913 i‡(
	`IS_CHAN_HT20
(
ch™
Ë|| 
	`IS_CHAN_HT40
(chan)) {

1914 
	`¨9003_hw_öô_txpowî_ht
(
ah
, 
øã_¨øy
,

1915 
AR9300_11NG_HT_SS_SHIFT
,

1916 
AR9300_11NG_HT_DS_SHIFT
,

1917 
AR9300_11NG_HT_TS_SHIFT
,

1918 
	`IS_CHAN_HT40
(
ch™
));

1919 
	`¨9003_hw_öô_txpowî_°bc
(
ah
,

1920 
AR9300_11NG_HT_SS_SHIFT
,

1921 
AR9300_11NG_HT_DS_SHIFT
,

1922 
AR9300_11NG_HT_TS_SHIFT
);

1925 
	}
}

1927 
	$¨9003_hw_gë_adc_íå›y
(
©h_hw
 *
ah
, 
u8
 *
buf
, 
size_t
 
Àn
)

1929 
i
, 
j
;

1931 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_BBB_OBS_SEL
, 1);

1932 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_RX_OBS_SEL_BIT5
);

1933 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST_CTL_STATUS
, 
AR_PHY_TEST_CTL_RX_OBS_SEL
, 0);

1935 
	`mem£t
(
buf
, 0, 
Àn
);

1936 
i
 = 0; i < 
Àn
; i++) {

1937 
j
 = 0; j < 4; j++) {

1938 
u32
 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_TST_ADC
);

1940 
buf
[
i
] <<= 2;

1941 
buf
[
i
] |(
ªgvÆ
 & 1Ë| (‘egvÆ & 
	`BIT
(10)) >> 9);

1942 
	`udñay
(1);

1945 
	}
}

1947 
	$¨9003_hw_©èch_phy_›s
(
©h_hw
 *
ah
)

1949 
©h_hw_¥iv©e_›s
 *
¥iv_›s
 = 
	`©h9k_hw_¥iv©e_›s
(
ah
);

1950 
©h_hw_›s
 *
›s
 = 
	`©h9k_hw_›s
(
ah
);

1951 c⁄° 
u32
 
¨9300_cˇ_ªgs
[6] = {

1952 
AR_PHY_CCA_0
,

1953 
AR_PHY_CCA_1
,

1954 
AR_PHY_CCA_2
,

1955 
AR_PHY_EXT_CCA
,

1956 
AR_PHY_EXT_CCA_1
,

1957 
AR_PHY_EXT_CCA_2
,

1960 
¥iv_›s
->
rf_£t_‰eq
 = 
¨9003_hw_£t_ch™√l
;

1961 
¥iv_›s
->
•ur_môig©e_‰eq
 = 
¨9003_hw_•ur_môig©e
;

1963 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9531
(ah) ||

1964 
	`AR_SREV_9561
(
ah
))

1965 
¥iv_›s
->
compuã_∂l_c⁄åﬁ
 = 
¨9003_hw_compuã_∂l_c⁄åﬁ_soc
;

1967 
¥iv_›s
->
compuã_∂l_c⁄åﬁ
 = 
¨9003_hw_compuã_∂l_c⁄åﬁ
;

1969 
¥iv_›s
->
£t_ch™√l_ªgs
 = 
¨9003_hw_£t_ch™√l_ªgs
;

1970 
¥iv_›s
->
öô_bb
 = 
¨9003_hw_öô_bb
;

1971 
¥iv_›s
->
¥o˚ss_öi
 = 
¨9003_hw_¥o˚ss_öi
;

1972 
¥iv_›s
->
£t_rfmode
 = 
¨9003_hw_£t_rfmode
;

1973 
¥iv_›s
->
m¨k_phy_öa˘ive
 = 
¨9003_hw_m¨k_phy_öa˘ive
;

1974 
¥iv_›s
->
£t_dñè_¶›e
 = 
¨9003_hw_£t_dñè_¶›e
;

1975 
¥iv_›s
->
rfbus_ªq
 = 
¨9003_hw_rfbus_ªq
;

1976 
¥iv_›s
->
rfbus_d⁄e
 = 
¨9003_hw_rfbus_d⁄e
;

1977 
¥iv_›s
->
™i_c⁄åﬁ
 = 
¨9003_hw_™i_c⁄åﬁ
;

1978 
¥iv_›s
->
do_gënf
 = 
¨9003_hw_do_gënf
;

1979 
¥iv_›s
->
™i_ˇche_öi_ªgs
 = 
¨9003_hw_™i_ˇche_öi_ªgs
;

1980 
¥iv_›s
->
£t_ød¨_∑øms
 = 
¨9003_hw_£t_ød¨_∑øms
;

1981 
¥iv_›s
->
Á°_ch™_ch™ge
 = 
¨9003_hw_Á°_ch™_ch™ge
;

1983 
›s
->
gë_adc_íå›y
 = 
¨9003_hw_gë_adc_íå›y
;

1984 
›s
->
™tdiv_comb_c⁄f_gë
 = 
¨9003_hw_™tdiv_comb_c⁄f_gë
;

1985 
›s
->
™tdiv_comb_c⁄f_£t
 = 
¨9003_hw_™tdiv_comb_c⁄f_£t
;

1986 
›s
->
•e˘øl_sˇn_c⁄fig
 = 
¨9003_hw_•e˘øl_sˇn_c⁄fig
;

1987 
›s
->
•e˘øl_sˇn_åiggî
 = 
¨9003_hw_•e˘øl_sˇn_åiggî
;

1988 
›s
->
•e˘øl_sˇn_waô
 = 
¨9003_hw_•e˘øl_sˇn_waô
;

1990 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


1991 
›s
->
£t_bt_™t_divîsôy
 = 
¨9003_hw_£t_bt_™t_divîsôy
;

1993 
›s
->
tx99_°¨t
 = 
¨9003_hw_tx99_°¨t
;

1994 
›s
->
tx99_°›
 = 
¨9003_hw_tx99_°›
;

1995 
›s
->
tx99_£t_txpowî
 = 
¨9003_hw_tx99_£t_txpowî
;

1997 
	`¨9003_hw_£t_nf_limôs
(
ah
);

1998 
	`¨9003_hw_£t_ød¨_c⁄f
(
ah
);

1999 
	`mem˝y
(
ah
->
nf_ªgs
, 
¨9300_cˇ_ªgs
, (ah->nf_regs));

2000 
	}
}

2028 
boﬁ
 
	$¨9003_hw_bb_w©chdog_check
(
©h_hw
 *
ah
)

2030 
u32
 
vÆ
;

2032 
ah
->
bb_w©chdog_œ°_°©us
) {

2034 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_RADAR_0
);

2035 
vÆ
 &(~
AR_PHY_RADAR_0_FIRPWR
);

2036 
vÆ
 |
	`SM
(0x7f, 
AR_PHY_RADAR_0_FIRPWR
);

2037 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_0
, 
vÆ
);

2038 
	`udñay
(1);

2039 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_RADAR_0
);

2040 
vÆ
 &~
AR_PHY_RADAR_0_FIRPWR
;

2041 
vÆ
 |
	`SM
(
AR9300_DFS_FIRPWR
, 
AR_PHY_RADAR_0_FIRPWR
);

2042 
	`REG_WRITE
(
ah
, 
AR_PHY_RADAR_0
, 
vÆ
);

2044  
Ál£
;

2046  
Ál£
;

2049  
åue
;

2051 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9531
◊hË|| 
	`AR_SREV_9561
(ah))

2052  
Ál£
;

2054  
åue
;

2060  
åue
;

2062 
	}
}

2063 
EXPORT_SYMBOL
(
¨9003_hw_bb_w©chdog_check
);

2065 
	$¨9003_hw_bb_w©chdog_c⁄fig
(
©h_hw
 *
ah
)

2067 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2068 
u32
 
idÀ_tmo_ms
 = 
ah
->
bb_w©chdog_timeout_ms
;

2069 
u32
 
vÆ
, 
idÀ_cou¡
;

2071 i‡(!
idÀ_tmo_ms
) {

2073 
	`REG_WRITE
(
ah
, 
AR_PHY_WATCHDOG_CTL_2
,

2074 
	`REG_READ
(
ah
, 
AR_PHY_WATCHDOG_CTL_2
) &

2075 ~(
AR_PHY_WATCHDOG_RST_ENABLE
 |

2076 
AR_PHY_WATCHDOG_IRQ_ENABLE
));

2079 
	`REG_WRITE
(
ah
, 
AR_PHY_WATCHDOG_CTL_1
,

2080 
	`REG_READ
(
ah
, 
AR_PHY_WATCHDOG_CTL_1
) &

2081 ~(
AR_PHY_WATCHDOG_NON_IDLE_ENABLE
 |

2082 
AR_PHY_WATCHDOG_IDLE_ENABLE
));

2084 
	`©h_dbg
(
comm⁄
, 
RESET
, "Disabled BB Watchdog\n");

2089 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_WATCHDOG_CTL_2
Ë& 
AR_PHY_WATCHDOG_CNTL2_MASK
;

2090 
	`REG_WRITE
(
ah
, 
AR_PHY_WATCHDOG_CTL_2
,

2091 (
vÆ
 | 
AR_PHY_WATCHDOG_IRQ_ENABLE
) &

2092 ~
AR_PHY_WATCHDOG_RST_ENABLE
);

2095 i‡(
idÀ_tmo_ms
 > 10000)

2096 
idÀ_tmo_ms
 = 10000;

2107 
idÀ_cou¡
 = (100 * 
idÀ_tmo_ms
) / 74;

2108 i‡(
ah
->
curch™
 && 
	`IS_CHAN_HT40
(ah->curchan))

2109 
idÀ_cou¡
 = (100 * 
idÀ_tmo_ms
) / 37;

2115 
	`REG_WRITE
(
ah
, 
AR_PHY_WATCHDOG_CTL_1
,

2116 
AR_PHY_WATCHDOG_NON_IDLE_ENABLE
 |

2117 
AR_PHY_WATCHDOG_IDLE_MASK
 |

2118 (
AR_PHY_WATCHDOG_NON_IDLE_MASK
 & (
idÀ_cou¡
 << 2)));

2120 
	`©h_dbg
(
comm⁄
, 
RESET
, "Enabled BB WatchdogÅimeout (%u ms)\n",

2121 
idÀ_tmo_ms
);

2122 
	}
}

2124 
	$¨9003_hw_bb_w©chdog_ªad
(
©h_hw
 *
ah
)

2130 
ah
->
bb_w©chdog_œ°_°©us
 = 
	`REG_READ
◊h, 
AR_PHY_WATCHDOG_STATUS
);

2136 
	`REG_WRITE
(
ah
, 
AR_PHY_WATCHDOG_STATUS
,

2137 
ah
->
bb_w©chdog_œ°_°©us
 & ~
AR_PHY_WATCHDOG_STATUS_CLR
);

2138 
	}
}

2140 
	$¨9003_hw_bb_w©chdog_dbg_öfo
(
©h_hw
 *
ah
)

2142 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2143 
u32
 
°©us
;

2145 i‡(
	`likñy
(!(
comm⁄
->
debug_mask
 & 
ATH_DBG_RESET
)))

2148 
°©us
 = 
ah
->
bb_w©chdog_œ°_°©us
;

2149 
	`©h_dbg
(
comm⁄
, 
RESET
,

2150 "\n===BB upd©e: BB sètus=0x%08x ====\n", 
°©us
);

2151 
	`©h_dbg
(
comm⁄
, 
RESET
,

2153 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_INFO
),

2154 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_DET_HANG
),

2155 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_RADAR_SM
),

2156 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_RX_OFDM_SM
),

2157 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_RX_CCK_SM
),

2158 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_TX_OFDM_SM
),

2159 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_TX_CCK_SM
),

2160 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_AGC_SM
),

2161 
	`MS
(
°©us
, 
AR_PHY_WATCHDOG_SRCH_SM
));

2163 
	`©h_dbg
(
comm⁄
, 
RESET
, "** BB WD cntl: cntl1=0x%08x cntl2=0x%08x **\n",

2164 
	`REG_READ
(
ah
, 
AR_PHY_WATCHDOG_CTL_1
),

2165 
	`REG_READ
(
ah
, 
AR_PHY_WATCHDOG_CTL_2
));

2166 
	`©h_dbg
(
comm⁄
, 
RESET
, "** BB mode: BB_gen_controls=0x%08x **\n",

2167 
	`REG_READ
(
ah
, 
AR_PHY_GEN_CTRL
));

2169 
	#PCT
(
_fõld
Ë(
comm⁄
->
cc_survey
._fõld * 100 / comm⁄->cc_survey.
cy˛es
)

	)

2170 i‡(
comm⁄
->
cc_survey
.
cy˛es
)

2171 
	`©h_dbg
(
comm⁄
, 
RESET
,

2173 
	`PCT
(
rx_busy
), PCT(
rx_‰ame
), PCT(
tx_‰ame
));

2175 
	`©h_dbg
(
comm⁄
, 
RESET
, "==== BB update: done ====\n\n");

2176 
	}
}

2177 
EXPORT_SYMBOL
(
¨9003_hw_bb_w©chdog_dbg_öfo
);

2179 
	$¨9003_hw_dißbÀ_phy_ª°¨t
(
©h_hw
 *
ah
)

2181 
u8
 
ªsu…
;

2182 
u32
 
vÆ
;

2189 
ªsu…
 = 
	`MS
(
ah
->
bb_w©chdog_œ°_°©us
, 
AR_PHY_WATCHDOG_RX_OFDM_SM
);

2191 i‡((
ªsu…
 =0xbË|| 
ah
->
bb_h™g_rx_ofdm
) {

2192 
ah
->
bb_h™g_rx_ofdm
 = 
åue
;

2193 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_RESTART
);

2194 
vÆ
 &~
AR_PHY_RESTART_ENA
;

2195 
	`REG_WRITE
(
ah
, 
AR_PHY_RESTART
, 
vÆ
);

2197 
	}
}

2198 
EXPORT_SYMBOL
(
¨9003_hw_dißbÀ_phy_ª°¨t
);

	@ar9003_phy.h

17 #i‚de‡
AR9003_PHY_H


18 
	#AR9003_PHY_H


	)

23 
	#AR_CHAN_BASE
 0x9800

	)

25 
	#AR_PHY_TIMING1
 (
AR_CHAN_BASE
 + 0x0)

	)

26 
	#AR_PHY_TIMING2
 (
AR_CHAN_BASE
 + 0x4)

	)

27 
	#AR_PHY_TIMING3
 (
AR_CHAN_BASE
 + 0x8)

	)

28 
	#AR_PHY_TIMING4
 (
AR_CHAN_BASE
 + 0xc)

	)

29 
	#AR_PHY_TIMING5
 (
AR_CHAN_BASE
 + 0x10)

	)

30 
	#AR_PHY_TIMING6
 (
AR_CHAN_BASE
 + 0x14)

	)

31 
	#AR_PHY_TIMING11
 (
AR_CHAN_BASE
 + 0x18)

	)

32 
	#AR_PHY_SPUR_REG
 (
AR_CHAN_BASE
 + 0x1c)

	)

33 
	#AR_PHY_RX_IQCAL_CORR_B0
 (
AR_CHAN_BASE
 + 0xdc)

	)

34 
	#AR_PHY_TX_IQCAL_CONTROL_3
 (
AR_CHAN_BASE
 + 0xb0)

	)

35 
	#AR_PHY_TIMING_CONTROL4_DO_GAIN_DC_IQ_CAL_SHIFT
 16

	)

37 
	#AR_PHY_TIMING11_SPUR_FREQ_SD
 0x3FF00000

	)

38 
	#AR_PHY_TIMING11_SPUR_FREQ_SD_S
 20

	)

40 
	#AR_PHY_TIMING11_SPUR_DELTA_PHASE
 0x000FFFFF

	)

41 
	#AR_PHY_TIMING11_SPUR_DELTA_PHASE_S
 0

	)

43 
	#AR_PHY_TIMING11_USE_SPUR_FILTER_IN_AGC
 0x40000000

	)

44 
	#AR_PHY_TIMING11_USE_SPUR_FILTER_IN_AGC_S
 30

	)

46 
	#AR_PHY_TIMING11_USE_SPUR_FILTER_IN_SELFCOR
 0x80000000

	)

47 
	#AR_PHY_TIMING11_USE_SPUR_FILTER_IN_SELFCOR_S
 31

	)

49 
	#AR_PHY_SPUR_REG_ENABLE_NF_RSSI_SPUR_MIT
 0x4000000

	)

50 
	#AR_PHY_SPUR_REG_ENABLE_NF_RSSI_SPUR_MIT_S
 26

	)

52 
	#AR_PHY_SPUR_REG_ENABLE_MASK_PPM
 0x20000

	)

53 
	#AR_PHY_SPUR_REG_ENABLE_MASK_PPM_S
 17

	)

54 
	#AR_PHY_SPUR_REG_SPUR_RSSI_THRESH
 0x000000FF

	)

55 
	#AR_PHY_SPUR_REG_SPUR_RSSI_THRESH_S
 0

	)

56 
	#AR_PHY_SPUR_REG_EN_VIT_SPUR_RSSI
 0x00000100

	)

57 
	#AR_PHY_SPUR_REG_EN_VIT_SPUR_RSSI_S
 8

	)

58 
	#AR_PHY_SPUR_REG_MASK_RATE_CNTL
 0x03FC0000

	)

59 
	#AR_PHY_SPUR_REG_MASK_RATE_CNTL_S
 18

	)

61 
	#AR_PHY_RX_IQCAL_CORR_B0_LOOPBACK_IQCORR_EN
 0x20000000

	)

62 
	#AR_PHY_RX_IQCAL_CORR_B0_LOOPBACK_IQCORR_EN_S
 29

	)

64 
	#AR_PHY_TX_IQCAL_CONTROL_3_IQCORR_EN
 0x80000000

	)

65 
	#AR_PHY_TX_IQCAL_CONTROL_3_IQCORR_EN_S
 31

	)

67 
	#AR_PHY_FIND_SIG_LOW
 (
AR_CHAN_BASE
 + 0x20)

	)

69 
	#AR_PHY_SFCORR
 (
AR_CHAN_BASE
 + 0x24)

	)

70 
	#AR_PHY_SFCORR_LOW
 (
AR_CHAN_BASE
 + 0x28)

	)

71 
	#AR_PHY_SFCORR_EXT
 (
AR_CHAN_BASE
 + 0x2c)

	)

73 
	#AR_PHY_EXT_CCA
 (
AR_CHAN_BASE
 + 0x30)

	)

74 
	#AR_PHY_RADAR_0
 (
AR_CHAN_BASE
 + 0x34)

	)

75 
	#AR_PHY_RADAR_1
 (
AR_CHAN_BASE
 + 0x38)

	)

76 
	#AR_PHY_RADAR_EXT
 (
AR_CHAN_BASE
 + 0x3c)

	)

77 
	#AR_PHY_MULTICHAIN_CTRL
 (
AR_CHAN_BASE
 + 0x80)

	)

78 
	#AR_PHY_PERCHAIN_CSD
 (
AR_CHAN_BASE
 + 0x84)

	)

80 
	#AR_PHY_TX_PHASE_RAMP_0
 (
AR_CHAN_BASE
 + 0xd0)

	)

81 
	#AR_PHY_ADC_GAIN_DC_CORR_0
 (
AR_CHAN_BASE
 + 0xd4)

	)

82 
	#AR_PHY_IQ_ADC_MEAS_0_B0
 (
AR_CHAN_BASE
 + 0xc0)

	)

83 
	#AR_PHY_IQ_ADC_MEAS_1_B0
 (
AR_CHAN_BASE
 + 0xc4)

	)

84 
	#AR_PHY_IQ_ADC_MEAS_2_B0
 (
AR_CHAN_BASE
 + 0xc8)

	)

85 
	#AR_PHY_IQ_ADC_MEAS_3_B0
 (
AR_CHAN_BASE
 + 0xcc)

	)

88 
	#AR_PHY_TX_PHASE_RAMP_0_9300_10
 (
AR_CHAN_BASE
 + 0xd0 - 0x10)

	)

89 
	#AR_PHY_ADC_GAIN_DC_CORR_0_9300_10
 (
AR_CHAN_BASE
 + 0xd4 - 0x10)

	)

90 
	#AR_PHY_IQ_ADC_MEAS_0_B0_9300_10
 (
AR_CHAN_BASE
 + 0xc0 + 0x8)

	)

91 
	#AR_PHY_IQ_ADC_MEAS_1_B0_9300_10
 (
AR_CHAN_BASE
 + 0xc4 + 0x8)

	)

92 
	#AR_PHY_IQ_ADC_MEAS_2_B0_9300_10
 (
AR_CHAN_BASE
 + 0xc8 + 0x8)

	)

93 
	#AR_PHY_IQ_ADC_MEAS_3_B0_9300_10
 (
AR_CHAN_BASE
 + 0xc¯+ 0x8)

	)

95 
	#AR_PHY_TX_CRC
 (
AR_CHAN_BASE
 + 0xa0)

	)

96 
	#AR_PHY_TST_DAC_CONST
 (
AR_CHAN_BASE
 + 0xa4)

	)

97 
	#AR_PHY_SPUR_REPORT_0
 (
AR_CHAN_BASE
 + 0xa8)

	)

98 
	#AR_PHY_CHAN_INFO_TAB_0
 (
AR_CHAN_BASE
 + 0x300)

	)

103 
	#AR_PHY_TIMING2_USE_FORCE_PPM
 0x00001000

	)

104 
	#AR_PHY_TIMING2_FORCE_PPM_VAL
 0x00000fff

	)

105 
	#AR_PHY_TIMING3_DSC_MAN
 0xFFFE0000

	)

106 
	#AR_PHY_TIMING3_DSC_MAN_S
 17

	)

107 
	#AR_PHY_TIMING3_DSC_EXP
 0x0001E000

	)

108 
	#AR_PHY_TIMING3_DSC_EXP_S
 13

	)

109 
	#AR_PHY_TIMING4_IQCAL_LOG_COUNT_MAX
 0xF000

	)

110 
	#AR_PHY_TIMING4_IQCAL_LOG_COUNT_MAX_S
 12

	)

111 
	#AR_PHY_TIMING4_DO_CAL
 0x10000

	)

113 
	#AR_PHY_TIMING4_ENABLE_PILOT_MASK
 0x10000000

	)

114 
	#AR_PHY_TIMING4_ENABLE_PILOT_MASK_S
 28

	)

115 
	#AR_PHY_TIMING4_ENABLE_CHAN_MASK
 0x20000000

	)

116 
	#AR_PHY_TIMING4_ENABLE_CHAN_MASK_S
 29

	)

118 
	#AR_PHY_TIMING4_ENABLE_SPUR_FILTER
 0x40000000

	)

119 
	#AR_PHY_TIMING4_ENABLE_SPUR_FILTER_S
 30

	)

120 
	#AR_PHY_TIMING4_ENABLE_SPUR_RSSI
 0x80000000

	)

121 
	#AR_PHY_TIMING4_ENABLE_SPUR_RSSI_S
 31

	)

123 
	#AR_PHY_NEW_ADC_GAIN_CORR_ENABLE
 0x40000000

	)

124 
	#AR_PHY_NEW_ADC_DC_OFFSET_CORR_ENABLE
 0x80000000

	)

125 
	#AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
 0x00000001

	)

126 
	#AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW
 0x00003F00

	)

127 
	#AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW_S
 8

	)

128 
	#AR_PHY_SFCORR_LOW_M1_THRESH_LOW
 0x001FC000

	)

129 
	#AR_PHY_SFCORR_LOW_M1_THRESH_LOW_S
 14

	)

130 
	#AR_PHY_SFCORR_LOW_M2_THRESH_LOW
 0x0FE00000

	)

131 
	#AR_PHY_SFCORR_LOW_M2_THRESH_LOW_S
 21

	)

132 
	#AR_PHY_SFCORR_M2COUNT_THR
 0x0000001F

	)

133 
	#AR_PHY_SFCORR_M2COUNT_THR_S
 0

	)

134 
	#AR_PHY_SFCORR_M1_THRESH
 0x00FE0000

	)

135 
	#AR_PHY_SFCORR_M1_THRESH_S
 17

	)

136 
	#AR_PHY_SFCORR_M2_THRESH
 0x7F000000

	)

137 
	#AR_PHY_SFCORR_M2_THRESH_S
 24

	)

138 
	#AR_PHY_SFCORR_EXT_M1_THRESH
 0x0000007F

	)

139 
	#AR_PHY_SFCORR_EXT_M1_THRESH_S
 0

	)

140 
	#AR_PHY_SFCORR_EXT_M2_THRESH
 0x00003F80

	)

141 
	#AR_PHY_SFCORR_EXT_M2_THRESH_S
 7

	)

142 
	#AR_PHY_SFCORR_EXT_M1_THRESH_LOW
 0x001FC000

	)

143 
	#AR_PHY_SFCORR_EXT_M1_THRESH_LOW_S
 14

	)

144 
	#AR_PHY_SFCORR_EXT_M2_THRESH_LOW
 0x0FE00000

	)

145 
	#AR_PHY_SFCORR_EXT_M2_THRESH_LOW_S
 21

	)

146 
	#AR_PHY_SFCORR_EXT_SPUR_SUBCHANNEL_SD
 0x10000000

	)

147 
	#AR_PHY_SFCORR_EXT_SPUR_SUBCHANNEL_SD_S
 28

	)

148 
	#AR_PHY_SFCORR_SPUR_SUBCHNL_SD_S
 28

	)

149 
	#AR_PHY_EXT_CCA_THRESH62
 0x007F0000

	)

150 
	#AR_PHY_EXT_CCA_THRESH62_S
 16

	)

151 
	#AR_PHY_EXTCHN_PWRTHR1_ANT_DIV_ALT_ANT_MINGAINIDX
 0x0000FF00

	)

152 
	#AR_PHY_EXTCHN_PWRTHR1_ANT_DIV_ALT_ANT_MINGAINIDX_S
 8

	)

153 
	#AR_PHY_EXT_MINCCA_PWR
 0x01FF0000

	)

154 
	#AR_PHY_EXT_MINCCA_PWR_S
 16

	)

155 
	#AR_PHY_EXT_CYCPWR_THR1
 0x0000FE00L

	)

156 
	#AR_PHY_EXT_CYCPWR_THR1_S
 9

	)

157 
	#AR_PHY_TIMING5_CYCPWR_THR1
 0x000000FE

	)

158 
	#AR_PHY_TIMING5_CYCPWR_THR1_S
 1

	)

159 
	#AR_PHY_TIMING5_CYCPWR_THR1_ENABLE
 0x00000001

	)

160 
	#AR_PHY_TIMING5_CYCPWR_THR1_ENABLE_S
 0

	)

161 
	#AR_PHY_TIMING5_CYCPWR_THR1A
 0x007F0000

	)

162 
	#AR_PHY_TIMING5_CYCPWR_THR1A_S
 16

	)

163 
	#AR_PHY_TIMING5_RSSI_THR1A
 (0x7F << 16)

	)

164 
	#AR_PHY_TIMING5_RSSI_THR1A_S
 16

	)

165 
	#AR_PHY_TIMING5_RSSI_THR1A_ENA
 (0x1 << 15)

	)

166 
	#AR_PHY_RADAR_0_ENA
 0x00000001

	)

167 
	#AR_PHY_RADAR_0_FFT_ENA
 0x80000000

	)

168 
	#AR_PHY_RADAR_0_INBAND
 0x0000003e

	)

169 
	#AR_PHY_RADAR_0_INBAND_S
 1

	)

170 
	#AR_PHY_RADAR_0_PRSSI
 0x00000FC0

	)

171 
	#AR_PHY_RADAR_0_PRSSI_S
 6

	)

172 
	#AR_PHY_RADAR_0_HEIGHT
 0x0003F000

	)

173 
	#AR_PHY_RADAR_0_HEIGHT_S
 12

	)

174 
	#AR_PHY_RADAR_0_RRSSI
 0x00FC0000

	)

175 
	#AR_PHY_RADAR_0_RRSSI_S
 18

	)

176 
	#AR_PHY_RADAR_0_FIRPWR
 0x7F000000

	)

177 
	#AR_PHY_RADAR_0_FIRPWR_S
 24

	)

178 
	#AR_PHY_RADAR_1_RELPWR_ENA
 0x00800000

	)

179 
	#AR_PHY_RADAR_1_USE_FIR128
 0x00400000

	)

180 
	#AR_PHY_RADAR_1_RELPWR_THRESH
 0x003F0000

	)

181 
	#AR_PHY_RADAR_1_RELPWR_THRESH_S
 16

	)

182 
	#AR_PHY_RADAR_1_BLOCK_CHECK
 0x00008000

	)

183 
	#AR_PHY_RADAR_1_MAX_RRSSI
 0x00004000

	)

184 
	#AR_PHY_RADAR_1_RELSTEP_CHECK
 0x00002000

	)

185 
	#AR_PHY_RADAR_1_RELSTEP_THRESH
 0x00001F00

	)

186 
	#AR_PHY_RADAR_1_RELSTEP_THRESH_S
 8

	)

187 
	#AR_PHY_RADAR_1_MAXLEN
 0x000000FF

	)

188 
	#AR_PHY_RADAR_1_MAXLEN_S
 0

	)

189 
	#AR_PHY_RADAR_EXT_ENA
 0x00004000

	)

190 
	#AR_PHY_RADAR_DC_PWR_THRESH
 0x007f8000

	)

191 
	#AR_PHY_RADAR_DC_PWR_THRESH_S
 15

	)

192 
	#AR_PHY_RADAR_LB_DC_CAP
 0x7f800000

	)

193 
	#AR_PHY_RADAR_LB_DC_CAP_S
 23

	)

194 
	#AR_PHY_FIND_SIG_LOW_FIRSTEP_LOW
 (0x3‡<< 6)

	)

195 
	#AR_PHY_FIND_SIG_LOW_FIRSTEP_LOW_S
 6

	)

196 
	#AR_PHY_FIND_SIG_LOW_FIRPWR
 (0x7‡<< 12)

	)

197 
	#AR_PHY_FIND_SIG_LOW_FIRPWR_S
 12

	)

198 
	#AR_PHY_FIND_SIG_LOW_FIRPWR_SIGN_BIT
 19

	)

199 
	#AR_PHY_FIND_SIG_LOW_RELSTEP
 0x1f

	)

200 
	#AR_PHY_FIND_SIG_LOW_RELSTEP_S
 0

	)

201 
	#AR_PHY_FIND_SIG_LOW_RELSTEP_SIGN_BIT
 5

	)

202 
	#AR_PHY_CHAN_INFO_TAB_S2_READ
 0x00000008

	)

203 
	#AR_PHY_CHAN_INFO_TAB_S2_READ_S
 3

	)

204 
	#AR_PHY_RX_IQCAL_CORR_IQCORR_Q_Q_COFF
 0x0000007F

	)

205 
	#AR_PHY_RX_IQCAL_CORR_IQCORR_Q_Q_COFF_S
 0

	)

206 
	#AR_PHY_RX_IQCAL_CORR_IQCORR_Q_I_COFF
 0x00003F80

	)

207 
	#AR_PHY_RX_IQCAL_CORR_IQCORR_Q_I_COFF_S
 7

	)

208 
	#AR_PHY_RX_IQCAL_CORR_IQCORR_ENABLE
 0x00004000

	)

209 
	#AR_PHY_RX_IQCAL_CORR_LOOPBACK_IQCORR_Q_Q_COFF
 0x003f8000

	)

210 
	#AR_PHY_RX_IQCAL_CORR_LOOPBACK_IQCORR_Q_Q_COFF_S
 15

	)

211 
	#AR_PHY_RX_IQCAL_CORR_LOOPBACK_IQCORR_Q_I_COFF
 0x1fc00000

	)

212 
	#AR_PHY_RX_IQCAL_CORR_LOOPBACK_IQCORR_Q_I_COFF_S
 22

	)

217 
	#AR_MRC_BASE
 0x9c00

	)

219 
	#AR_PHY_TIMING_3A
 (
AR_MRC_BASE
 + 0x0)

	)

220 
	#AR_PHY_LDPC_CNTL1
 (
AR_MRC_BASE
 + 0x4)

	)

221 
	#AR_PHY_LDPC_CNTL2
 (
AR_MRC_BASE
 + 0x8)

	)

222 
	#AR_PHY_PILOT_SPUR_MASK
 (
AR_MRC_BASE
 + 0xc)

	)

223 
	#AR_PHY_CHAN_SPUR_MASK
 (
AR_MRC_BASE
 + 0x10)

	)

224 
	#AR_PHY_SGI_DELTA
 (
AR_MRC_BASE
 + 0x14)

	)

225 
	#AR_PHY_ML_CNTL_1
 (
AR_MRC_BASE
 + 0x18)

	)

226 
	#AR_PHY_ML_CNTL_2
 (
AR_MRC_BASE
 + 0x1c)

	)

227 
	#AR_PHY_TST_ADC
 (
AR_MRC_BASE
 + 0x20)

	)

229 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_A
 0x00000FE0

	)

230 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_A_S
 5

	)

231 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_A
 0x1F

	)

232 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_A_S
 0

	)

233 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_B
 0x00FE0000

	)

234 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_IDX_B_S
 17

	)

235 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_B
 0x0001F000

	)

236 
	#AR_PHY_PILOT_SPUR_MASK_CF_PILOT_MASK_B_S
 12

	)

238 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_A
 0x00000FE0

	)

239 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_A_S
 5

	)

240 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_A
 0x1F

	)

241 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_A_S
 0

	)

242 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_B
 0x00FE0000

	)

243 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_IDX_B_S
 17

	)

244 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_B
 0x0001F000

	)

245 
	#AR_PHY_CHAN_SPUR_MASK_CF_CHAN_MASK_B_S
 12

	)

251 
	#AR_PHY_SGI_DSC_MAN
 0x0007FFF0

	)

252 
	#AR_PHY_SGI_DSC_MAN_S
 4

	)

253 
	#AR_PHY_SGI_DSC_EXP
 0x0000000F

	)

254 
	#AR_PHY_SGI_DSC_EXP_S
 0

	)

258 
	#AR_BBB_BASE
 0x9d00

	)

263 
	#AR_AGC_BASE
 0x9e00

	)

265 
	#AR_PHY_SETTLING
 (
AR_AGC_BASE
 + 0x0)

	)

266 
	#AR_PHY_FORCEMAX_GAINS_0
 (
AR_AGC_BASE
 + 0x4)

	)

267 
	#AR_PHY_GAINS_MINOFF0
 (
AR_AGC_BASE
 + 0x8)

	)

268 
	#AR_PHY_DESIRED_SZ
 (
AR_AGC_BASE
 + 0xc)

	)

269 
	#AR_PHY_FIND_SIG
 (
AR_AGC_BASE
 + 0x10)

	)

270 
	#AR_PHY_AGC
 (
AR_AGC_BASE
 + 0x14)

	)

271 
	#AR_PHY_EXT_ATTEN_CTL_0
 (
AR_AGC_BASE
 + 0x18)

	)

272 
	#AR_PHY_CCA_0
 (
AR_AGC_BASE
 + 0x1c)

	)

273 
	#AR_PHY_CCA_CTRL_0
 (
AR_AGC_BASE
 + 0x20)

	)

274 
	#AR_PHY_RESTART
 (
AR_AGC_BASE
 + 0x24)

	)

279 
	#AR_PHY_MC_GAIN_CTRL
 (
AR_AGC_BASE
 + 0x28)

	)

280 
	#AR_ANT_DIV_CTRL_ALL
 0x7e000000

	)

281 
	#AR_ANT_DIV_CTRL_ALL_S
 25

	)

282 
	#AR_ANT_DIV_ENABLE
 0x1000000

	)

283 
	#AR_ANT_DIV_ENABLE_S
 24

	)

286 
	#AR_PHY_ANT_FAST_DIV_BIAS
 0x00007e00

	)

287 
	#AR_PHY_ANT_FAST_DIV_BIAS_S
 9

	)

288 
	#AR_PHY_ANT_SW_RX_PROT
 0x00800000

	)

289 
	#AR_PHY_ANT_SW_RX_PROT_S
 23

	)

290 
	#AR_PHY_ANT_DIV_LNADIV
 0x01000000

	)

291 
	#AR_PHY_ANT_DIV_LNADIV_S
 24

	)

292 
	#AR_PHY_ANT_DIV_ALT_LNACONF
 0x06000000

	)

293 
	#AR_PHY_ANT_DIV_ALT_LNACONF_S
 25

	)

294 
	#AR_PHY_ANT_DIV_MAIN_LNACONF
 0x18000000

	)

295 
	#AR_PHY_ANT_DIV_MAIN_LNACONF_S
 27

	)

296 
	#AR_PHY_ANT_DIV_ALT_GAINTB
 0x20000000

	)

297 
	#AR_PHY_ANT_DIV_ALT_GAINTB_S
 29

	)

298 
	#AR_PHY_ANT_DIV_MAIN_GAINTB
 0x40000000

	)

299 
	#AR_PHY_ANT_DIV_MAIN_GAINTB_S
 30

	)

301 
	#AR_PHY_EXTCHN_PWRTHR1
 (
AR_AGC_BASE
 + 0x2c)

	)

302 
	#AR_PHY_EXT_CHN_WIN
 (
AR_AGC_BASE
 + 0x30)

	)

303 
	#AR_PHY_20_40_DET_THR
 (
AR_AGC_BASE
 + 0x34)

	)

304 
	#AR_PHY_RIFS_SRCH
 (
AR_AGC_BASE
 + 0x38)

	)

305 
	#AR_PHY_PEAK_DET_CTRL_1
 (
AR_AGC_BASE
 + 0x3c)

	)

306 
	#AR_PHY_PEAK_DET_CTRL_2
 (
AR_AGC_BASE
 + 0x40)

	)

307 
	#AR_PHY_RX_GAIN_BOUNDS_1
 (
AR_AGC_BASE
 + 0x44)

	)

308 
	#AR_PHY_RX_GAIN_BOUNDS_2
 (
AR_AGC_BASE
 + 0x48)

	)

309 
	#AR_PHY_RSSI_0
 (
AR_AGC_BASE
 + 0x180)

	)

310 
	#AR_PHY_SPUR_CCK_REP0
 (
AR_AGC_BASE
 + 0x184)

	)

312 
	#AR_PHY_CCK_DETECT
 (
AR_AGC_BASE
 + 0x1c0)

	)

313 
	#AR_FAST_DIV_ENABLE
 0x2000

	)

314 
	#AR_FAST_DIV_ENABLE_S
 13

	)

316 
	#AR_PHY_DAG_CTRLCCK
 (
AR_AGC_BASE
 + 0x1c4)

	)

317 
	#AR_PHY_IQCORR_CTRL_CCK
 (
AR_AGC_BASE
 + 0x1c8)

	)

319 
	#AR_PHY_CCK_SPUR_MIT
 (
AR_AGC_BASE
 + 0x1cc)

	)

320 
	#AR_PHY_CCK_SPUR_MIT_SPUR_RSSI_THR
 0x000001„

	)

321 
	#AR_PHY_CCK_SPUR_MIT_SPUR_RSSI_THR_S
 1

	)

322 
	#AR_PHY_CCK_SPUR_MIT_SPUR_FILTER_TYPE
 0x60000000

	)

323 
	#AR_PHY_CCK_SPUR_MIT_SPUR_FILTER_TYPE_S
 29

	)

324 
	#AR_PHY_CCK_SPUR_MIT_USE_CCK_SPUR_MIT
 0x00000001

	)

325 
	#AR_PHY_CCK_SPUR_MIT_USE_CCK_SPUR_MIT_S
 0

	)

326 
	#AR_PHY_CCK_SPUR_MIT_CCK_SPUR_FREQ
 0x1fff„00

	)

327 
	#AR_PHY_CCK_SPUR_MIT_CCK_SPUR_FREQ_S
 9

	)

329 
	#AR_PHY_MRC_CCK_CTRL
 (
AR_AGC_BASE
 + 0x1d0)

	)

330 
	#AR_PHY_MRC_CCK_ENABLE
 0x00000001

	)

331 
	#AR_PHY_MRC_CCK_ENABLE_S
 0

	)

332 
	#AR_PHY_MRC_CCK_MUX_REG
 0x00000002

	)

333 
	#AR_PHY_MRC_CCK_MUX_REG_S
 1

	)

335 
	#AR_PHY_RX_OCGAIN
 (
AR_AGC_BASE
 + 0x200)

	)

337 
	#AR_PHY_CCA_NOM_VAL_9300_2GHZ
 -110

	)

338 
	#AR_PHY_CCA_NOM_VAL_9300_5GHZ
 -115

	)

339 
	#AR_PHY_CCA_MIN_GOOD_VAL_9300_2GHZ
 -125

	)

340 
	#AR_PHY_CCA_MIN_GOOD_VAL_9300_5GHZ
 -125

	)

341 
	#AR_PHY_CCA_MAX_GOOD_VAL_9300_2GHZ
 -60

	)

342 
	#AR_PHY_CCA_MAX_GOOD_VAL_9300_5GHZ
 -60

	)

343 
	#AR_PHY_CCA_MAX_GOOD_VAL_9300_FCC_2GHZ
 -95

	)

344 
	#AR_PHY_CCA_MAX_GOOD_VAL_9300_FCC_5GHZ
 -100

	)

346 
	#AR_PHY_CCA_NOM_VAL_9462_2GHZ
 -127

	)

347 
	#AR_PHY_CCA_MIN_GOOD_VAL_9462_2GHZ
 -127

	)

348 
	#AR_PHY_CCA_MAX_GOOD_VAL_9462_2GHZ
 -60

	)

349 
	#AR_PHY_CCA_NOM_VAL_9462_5GHZ
 -127

	)

350 
	#AR_PHY_CCA_MIN_GOOD_VAL_9462_5GHZ
 -127

	)

351 
	#AR_PHY_CCA_MAX_GOOD_VAL_9462_5GHZ
 -60

	)

353 
	#AR_PHY_CCA_NOM_VAL_9330_2GHZ
 -118

	)

355 
	#AR9300_EXT_LNA_CTL_GPIO_AR9485
 9

	)

360 
	#AR_PHY_EXT_ATTEN_CTL_RXTX_MARGIN
 0x00FC0000

	)

361 
	#AR_PHY_EXT_ATTEN_CTL_RXTX_MARGIN_S
 18

	)

362 
	#AR_PHY_EXT_ATTEN_CTL_BSW_MARGIN
 0x00003C00

	)

363 
	#AR_PHY_EXT_ATTEN_CTL_BSW_MARGIN_S
 10

	)

364 
	#AR_PHY_EXT_ATTEN_CTL_BSW_ATTEN
 0x0000001F

	)

365 
	#AR_PHY_EXT_ATTEN_CTL_BSW_ATTEN_S
 0

	)

366 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN2_MARGIN
 0x003E0000

	)

367 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN2_MARGIN_S
 17

	)

368 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN1_MARGIN
 0x0001F000

	)

369 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN1_MARGIN_S
 12

	)

370 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN2_DB
 0x00000FC0

	)

371 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN2_DB_S
 6

	)

372 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN1_DB
 0x0000003F

	)

373 
	#AR_PHY_EXT_ATTEN_CTL_XATTEN1_DB_S
 0

	)

374 
	#AR_PHY_RXGAIN_TXRX_ATTEN
 0x0003F000

	)

375 
	#AR_PHY_RXGAIN_TXRX_ATTEN_S
 12

	)

376 
	#AR_PHY_RXGAIN_TXRX_RF_MAX
 0x007C0000

	)

377 
	#AR_PHY_RXGAIN_TXRX_RF_MAX_S
 18

	)

378 
	#AR9280_PHY_RXGAIN_TXRX_ATTEN
 0x00003F80

	)

379 
	#AR9280_PHY_RXGAIN_TXRX_ATTEN_S
 7

	)

380 
	#AR9280_PHY_RXGAIN_TXRX_MARGIN
 0x001FC000

	)

381 
	#AR9280_PHY_RXGAIN_TXRX_MARGIN_S
 14

	)

382 
	#AR_PHY_SETTLING_SWITCH
 0x00003F80

	)

383 
	#AR_PHY_SETTLING_SWITCH_S
 7

	)

384 
	#AR_PHY_DESIRED_SZ_ADC
 0x000000FF

	)

385 
	#AR_PHY_DESIRED_SZ_ADC_S
 0

	)

386 
	#AR_PHY_DESIRED_SZ_PGA
 0x0000FF00

	)

387 
	#AR_PHY_DESIRED_SZ_PGA_S
 8

	)

388 
	#AR_PHY_DESIRED_SZ_TOT_DES
 0x0FF00000

	)

389 
	#AR_PHY_DESIRED_SZ_TOT_DES_S
 20

	)

390 
	#AR_PHY_MINCCA_PWR
 0x1FF00000

	)

391 
	#AR_PHY_MINCCA_PWR_S
 20

	)

392 
	#AR_PHY_CCA_THRESH62
 0x0007F000

	)

393 
	#AR_PHY_CCA_THRESH62_S
 12

	)

394 
	#AR9280_PHY_MINCCA_PWR
 0x1FF00000

	)

395 
	#AR9280_PHY_MINCCA_PWR_S
 20

	)

396 
	#AR9280_PHY_CCA_THRESH62
 0x000FF000

	)

397 
	#AR9280_PHY_CCA_THRESH62_S
 12

	)

398 
	#AR_PHY_EXT_CCA0_THRESH62
 0x000000FF

	)

399 
	#AR_PHY_EXT_CCA0_THRESH62_S
 0

	)

400 
	#AR_PHY_EXT_CCA0_THRESH62_1
 0x000001FF

	)

401 
	#AR_PHY_EXT_CCA0_THRESH62_1_S
 0

	)

402 
	#AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK
 0x0000003F

	)

403 
	#AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK_S
 0

	)

404 
	#AR_PHY_CCK_DETECT_ANT_SWITCH_TIME
 0x00001FC0

	)

405 
	#AR_PHY_CCK_DETECT_ANT_SWITCH_TIME_S
 6

	)

406 
	#AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
 0x2000

	)

408 
	#AR_PHY_DAG_CTRLCCK_EN_RSSI_THR
 0x00000200

	)

409 
	#AR_PHY_DAG_CTRLCCK_EN_RSSI_THR_S
 9

	)

410 
	#AR_PHY_DAG_CTRLCCK_RSSI_THR
 0x0001FC00

	)

411 
	#AR_PHY_DAG_CTRLCCK_RSSI_THR_S
 10

	)

413 
	#AR_PHY_RIFS_INIT_DELAY
 0x3ff0000

	)

414 
	#AR_PHY_AGC_QUICK_DROP
 0x03c00000

	)

415 
	#AR_PHY_AGC_QUICK_DROP_S
 22

	)

416 
	#AR_PHY_AGC_COARSE_LOW
 0x00007F80

	)

417 
	#AR_PHY_AGC_COARSE_LOW_S
 7

	)

418 
	#AR_PHY_AGC_COARSE_HIGH
 0x003F8000

	)

419 
	#AR_PHY_AGC_COARSE_HIGH_S
 15

	)

420 
	#AR_PHY_AGC_COARSE_PWR_CONST
 0x0000007F

	)

421 
	#AR_PHY_AGC_COARSE_PWR_CONST_S
 0

	)

422 
	#AR_PHY_FIND_SIG_FIRSTEP
 0x0003F000

	)

423 
	#AR_PHY_FIND_SIG_FIRSTEP_S
 12

	)

424 
	#AR_PHY_FIND_SIG_FIRPWR
 0x03FC0000

	)

425 
	#AR_PHY_FIND_SIG_FIRPWR_S
 18

	)

426 
	#AR_PHY_FIND_SIG_FIRPWR_SIGN_BIT
 25

	)

427 
	#AR_PHY_FIND_SIG_RELPWR
 (0x1‡<< 6)

	)

428 
	#AR_PHY_FIND_SIG_RELPWR_S
 6

	)

429 
	#AR_PHY_FIND_SIG_RELPWR_SIGN_BIT
 11

	)

430 
	#AR_PHY_FIND_SIG_RELSTEP
 0x1f

	)

431 
	#AR_PHY_FIND_SIG_RELSTEP_S
 0

	)

432 
	#AR_PHY_FIND_SIG_RELSTEP_SIGN_BIT
 5

	)

433 
	#AR_PHY_RESTART_ENABLE_DIV_M2FLAG
 0x00200000

	)

434 
	#AR_PHY_RESTART_ENABLE_DIV_M2FLAG_S
 21

	)

435 
	#AR_PHY_RESTART_DIV_GC
 0x001C0000

	)

436 
	#AR_PHY_RESTART_DIV_GC_S
 18

	)

437 
	#AR_PHY_RESTART_ENA
 0x01

	)

438 
	#AR_PHY_DC_RESTART_DIS
 0x40000000

	)

440 
	#AR_PHY_TPC_OLPC_GAIN_DELTA_PAL_ON
 0xFF000000

	)

441 
	#AR_PHY_TPC_OLPC_GAIN_DELTA_PAL_ON_S
 24

	)

442 
	#AR_PHY_TPC_OLPC_GAIN_DELTA
 0x00FF0000

	)

443 
	#AR_PHY_TPC_OLPC_GAIN_DELTA_S
 16

	)

445 
	#AR_PHY_TPC_6_ERROR_EST_MODE
 0x03000000

	)

446 
	#AR_PHY_TPC_6_ERROR_EST_MODE_S
 24

	)

451 
	#AR_SM_BASE
 0xa200

	)

453 
	#AR_PHY_D2_CHIP_ID
 (
AR_SM_BASE
 + 0x0)

	)

454 
	#AR_PHY_GEN_CTRL
 (
AR_SM_BASE
 + 0x4)

	)

455 
	#AR_PHY_MODE
 (
AR_SM_BASE
 + 0x8)

	)

456 
	#AR_PHY_ACTIVE
 (
AR_SM_BASE
 + 0xc)

	)

457 
	#AR_PHY_SPUR_MASK_A
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x18 : 0x20))

	)

458 
	#AR_PHY_SPUR_MASK_B
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x1¯: 0x24))

	)

459 
	#AR_PHY_SPECTRAL_SCAN
 (
AR_SM_BASE
 + 0x28)

	)

460 
	#AR_PHY_RADAR_BW_FILTER
 (
AR_SM_BASE
 + 0x2c)

	)

461 
	#AR_PHY_SEARCH_START_DELAY
 (
AR_SM_BASE
 + 0x30)

	)

462 
	#AR_PHY_MAX_RX_LEN
 (
AR_SM_BASE
 + 0x34)

	)

463 
	#AR_PHY_FRAME_CTL
 (
AR_SM_BASE
 + 0x38)

	)

464 
	#AR_PHY_RFBUS_REQ
 (
AR_SM_BASE
 + 0x3c)

	)

465 
	#AR_PHY_RFBUS_GRANT
 (
AR_SM_BASE
 + 0x40)

	)

466 
	#AR_PHY_RIFS
 (
AR_SM_BASE
 + 0x44)

	)

467 
	#AR_PHY_RX_CLR_DELAY
 (
AR_SM_BASE
 + 0x50)

	)

468 
	#AR_PHY_RX_DELAY
 (
AR_SM_BASE
 + 0x54)

	)

470 
	#AR_PHY_XPA_TIMING_CTL
 (
AR_SM_BASE
 + 0x64)

	)

471 
	#AR_PHY_MISC_PA_CTL
 (
AR_SM_BASE
 + 0x80)

	)

472 
	#AR_PHY_SWITCH_CHAIN_0
 (
AR_SM_BASE
 + 0x84)

	)

473 
	#AR_PHY_SWITCH_COM
 (
AR_SM_BASE
 + 0x88)

	)

474 
	#AR_PHY_SWITCH_COM_2
 (
AR_SM_BASE
 + 0x8c)

	)

475 
	#AR_PHY_RX_CHAINMASK
 (
AR_SM_BASE
 + 0xa0)

	)

476 
	#AR_PHY_CAL_CHAINMASK
 (
AR_SM_BASE
 + 0xc0)

	)

477 
	#AR_PHY_CALMODE
 (
AR_SM_BASE
 + 0xc8)

	)

478 
	#AR_PHY_FCAL_1
 (
AR_SM_BASE
 + 0xcc)

	)

479 
	#AR_PHY_FCAL_2_0
 (
AR_SM_BASE
 + 0xd0)

	)

480 
	#AR_PHY_DFT_TONE_CTL_0
 (
AR_SM_BASE
 + 0xd4)

	)

481 
	#AR_PHY_CL_CAL_CTL
 (
AR_SM_BASE
 + 0xd8)

	)

482 
	#AR_PHY_CL_TAB_0
 (
AR_SM_BASE
 + 0x100)

	)

483 
	#AR_PHY_SYNTH_CONTROL
 (
AR_SM_BASE
 + 0x140)

	)

484 
	#AR_PHY_ADDAC_CLK_SEL
 (
AR_SM_BASE
 + 0x144)

	)

485 
	#AR_PHY_PLL_CTL
 (
AR_SM_BASE
 + 0x148)

	)

486 
	#AR_PHY_ANALOG_SWAP
 (
AR_SM_BASE
 + 0x14c)

	)

487 
	#AR_PHY_ADDAC_PARA_CTL
 (
AR_SM_BASE
 + 0x150)

	)

488 
	#AR_PHY_XPA_CFG
 (
AR_SM_BASE
 + 0x158)

	)

490 
	#AR_PHY_FRAME_CTL_CF_OVERLAP_WINDOW
 3

	)

491 
	#AR_PHY_FRAME_CTL_CF_OVERLAP_WINDOW_S
 0

	)

493 
	#AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_IDX_A
 0x0001FC00

	)

494 
	#AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_IDX_A_S
 10

	)

495 
	#AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_A
 0x3FF

	)

496 
	#AR_PHY_SPUR_MASK_A_CF_PUNC_MASK_A_S
 0

	)

498 
	#AR_PHY_TEST
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x15¯: 0x160))

	)

500 
	#AR_PHY_TEST_BBB_OBS_SEL
 0x780000

	)

501 
	#AR_PHY_TEST_BBB_OBS_SEL_S
 19

	)

503 
	#AR_PHY_TEST_RX_OBS_SEL_BIT5_S
 23

	)

504 
	#AR_PHY_TEST_RX_OBS_SEL_BIT5
 (1 << 
AR_PHY_TEST_RX_OBS_SEL_BIT5_S
)

	)

506 
	#AR_PHY_TEST_CHAIN_SEL
 0xC0000000

	)

507 
	#AR_PHY_TEST_CHAIN_SEL_S
 30

	)

509 
	#AR_PHY_TEST_CTL_STATUS
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x160 : 0x164))

	)

510 
	#AR_PHY_TEST_CTL_TSTDAC_EN
 0x1

	)

511 
	#AR_PHY_TEST_CTL_TSTDAC_EN_S
 0

	)

512 
	#AR_PHY_TEST_CTL_TX_OBS_SEL
 0x1C

	)

513 
	#AR_PHY_TEST_CTL_TX_OBS_SEL_S
 2

	)

514 
	#AR_PHY_TEST_CTL_TX_OBS_MUX_SEL
 0x60

	)

515 
	#AR_PHY_TEST_CTL_TX_OBS_MUX_SEL_S
 5

	)

516 
	#AR_PHY_TEST_CTL_TSTADC_EN
 0x100

	)

517 
	#AR_PHY_TEST_CTL_TSTADC_EN_S
 8

	)

518 
	#AR_PHY_TEST_CTL_RX_OBS_SEL
 0x3C00

	)

519 
	#AR_PHY_TEST_CTL_RX_OBS_SEL_S
 10

	)

520 
	#AR_PHY_TEST_CTL_DEBUGPORT_SEL
 0xe0000000

	)

521 
	#AR_PHY_TEST_CTL_DEBUGPORT_SEL_S
 29

	)

524 
	#AR_PHY_TSTDAC
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x164 : 0x168))

	)

526 
	#AR_PHY_CHAN_STATUS
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x168 : 0x16c))

	)

528 
	#AR_PHY_CHAN_INFO_MEMORY
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x16¯: 0x170))

	)

529 
	#AR_PHY_CHAN_INFO_MEMORY_CHANINFOMEM_S2_READ
 0x00000008

	)

530 
	#AR_PHY_CHAN_INFO_MEMORY_CHANINFOMEM_S2_READ_S
 3

	)

532 
	#AR_PHY_CHNINFO_NOISEPWR
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x170 : 0x174))

	)

533 
	#AR_PHY_CHNINFO_GAINDIFF
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x174 : 0x178))

	)

534 
	#AR_PHY_CHNINFO_FINETIM
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x178 : 0x17c))

	)

535 
	#AR_PHY_CHAN_INFO_GAIN_0
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x17¯: 0x180))

	)

536 
	#AR_PHY_SCRAMBLER_SEED
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x184 : 0x190))

	)

537 
	#AR_PHY_CCK_TX_CTRL
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x188 : 0x194))

	)

539 
	#AR_PHY_HEAVYCLIP_CTL
 (
AR_SM_BASE
 + (
	`AR_SREV_9561
(
ah
Ë? 0x198 : 0x1a4))

	)

540 
	#AR_PHY_HEAVYCLIP_20
 (
AR_SM_BASE
 + 0x1a8)

	)

541 
	#AR_PHY_HEAVYCLIP_40
 (
AR_SM_BASE
 + 0x1ac)

	)

542 
	#AR_PHY_HEAVYCLIP_1
 (
AR_SM_BASE
 + 0x19c)

	)

543 
	#AR_PHY_HEAVYCLIP_2
 (
AR_SM_BASE
 + 0x1a0)

	)

544 
	#AR_PHY_HEAVYCLIP_3
 (
AR_SM_BASE
 + 0x1a4)

	)

545 
	#AR_PHY_HEAVYCLIP_4
 (
AR_SM_BASE
 + 0x1a8)

	)

546 
	#AR_PHY_HEAVYCLIP_5
 (
AR_SM_BASE
 + 0x1ac)

	)

547 
	#AR_PHY_ILLEGAL_TXRATE
 (
AR_SM_BASE
 + 0x1b0)

	)

549 
	#AR_PHY_POWER_TX_RATE
(
_d
Ë(
AR_SM_BASE
 + 0x1c0 + ((_dË<< 2))

	)

551 
	#AR_PHY_PWRTX_MAX
 (
AR_SM_BASE
 + 0x1f0)

	)

552 
	#AR_PHY_POWER_TX_SUB
 (
AR_SM_BASE
 + 0x1f4)

	)

554 
	#AR_PHY_TPC_1
 (
AR_SM_BASE
 + 0x1f8)

	)

555 
	#AR_PHY_TPC_1_FORCED_DAC_GAIN
 0x0000003e

	)

556 
	#AR_PHY_TPC_1_FORCED_DAC_GAIN_S
 1

	)

557 
	#AR_PHY_TPC_1_FORCE_DAC_GAIN
 0x00000001

	)

558 
	#AR_PHY_TPC_1_FORCE_DAC_GAIN_S
 0

	)

560 
	#AR_PHY_TPC_4_B0
 (
AR_SM_BASE
 + 0x204)

	)

561 
	#AR_PHY_TPC_5_B0
 (
AR_SM_BASE
 + 0x208)

	)

562 
	#AR_PHY_TPC_6_B0
 (
AR_SM_BASE
 + 0x20c)

	)

564 
	#AR_PHY_TPC_11_B0
 (
AR_SM_BASE
 + 0x220)

	)

565 
	#AR_PHY_TPC_11_B1
 (
AR_SM1_BASE
 + 0x220)

	)

566 
	#AR_PHY_TPC_11_B2
 (
AR_SM2_BASE
 + 0x220)

	)

567 
	#AR_PHY_TPC_11_OLPC_GAIN_DELTA
 0x00ff0000

	)

568 
	#AR_PHY_TPC_11_OLPC_GAIN_DELTA_S
 16

	)

570 
	#AR_PHY_TPC_12
 (
AR_SM_BASE
 + 0x224)

	)

571 
	#AR_PHY_TPC_12_DESIRED_SCALE_HT40_5
 0x3e000000

	)

572 
	#AR_PHY_TPC_12_DESIRED_SCALE_HT40_5_S
 25

	)

574 
	#AR_PHY_TPC_18
 (
AR_SM_BASE
 + 0x23c)

	)

575 
	#AR_PHY_TPC_18_THERM_CAL_VALUE
 0x000000ff

	)

576 
	#AR_PHY_TPC_18_THERM_CAL_VALUE_S
 0

	)

577 
	#AR_PHY_TPC_18_VOLT_CAL_VALUE
 0x0000ff00

	)

578 
	#AR_PHY_TPC_18_VOLT_CAL_VALUE_S
 8

	)

580 
	#AR_PHY_TPC_19
 (
AR_SM_BASE
 + 0x240)

	)

581 
	#AR_PHY_TPC_19_ALPHA_VOLT
 0x001f0000

	)

582 
	#AR_PHY_TPC_19_ALPHA_VOLT_S
 16

	)

583 
	#AR_PHY_TPC_19_ALPHA_THERM
 0xff

	)

584 
	#AR_PHY_TPC_19_ALPHA_THERM_S
 0

	)

586 
	#AR_PHY_TX_FORCED_GAIN
 (
AR_SM_BASE
 + 0x258)

	)

587 
	#AR_PHY_TX_FORCED_GAIN_FORCE_TX_GAIN
 0x00000001

	)

588 
	#AR_PHY_TX_FORCED_GAIN_FORCE_TX_GAIN_S
 0

	)

589 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXBB1DBGAIN
 0x0000000e

	)

590 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXBB1DBGAIN_S
 1

	)

591 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXBB6DBGAIN
 0x00000030

	)

592 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXBB6DBGAIN_S
 4

	)

593 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXMXRGAIN
 0x000003c0

	)

594 
	#AR_PHY_TX_FORCED_GAIN_FORCED_TXMXRGAIN_S
 6

	)

595 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNA
 0x00003c00

	)

596 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNA_S
 10

	)

597 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNB
 0x0003c000

	)

598 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNB_S
 14

	)

599 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNC
 0x003c0000

	)

600 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGNC_S
 18

	)

601 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGND
 0x00c00000

	)

602 
	#AR_PHY_TX_FORCED_GAIN_FORCED_PADRVGND_S
 22

	)

603 
	#AR_PHY_TX_FORCED_GAIN_FORCED_ENABLE_PAL
 0x01000000

	)

604 
	#AR_PHY_TX_FORCED_GAIN_FORCED_ENABLE_PAL_S
 24

	)

607 
	#AR_PHY_PDADC_TAB_0
 (
AR_SM_BASE
 + 0x280)

	)

609 
	#AR_PHY_TXGAIN_TABLE
 (
AR_SM_BASE
 + 0x300)

	)

611 
	#AR_PHY_TX_IQCAL_CONTROL_0
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
) ? \

612 0x3c4 : 0x444))

	)

613 
	#AR_PHY_TX_IQCAL_CONTROL_1
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
) ? \

614 0x3c8 : 0x448))

	)

615 
	#AR_PHY_TX_IQCAL_START
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
) ? \

616 0x3c4 : 0x440))

	)

617 
	#AR_PHY_TX_IQCAL_STATUS_B0
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
) ? \

618 0x3f0 : 0x48c))

	)

619 
	#AR_PHY_TX_IQCAL_CORR_COEFF_B0
(
_i
Ë(
AR_SM_BASE
 + \

620 (
	`AR_SREV_9485
(
ah
) ? \

621 0x3d0 : 0x450Ë+ ((
_i
Ë<< 2))

	)

622 
	#AR_PHY_RTT_CTRL
 (
AR_SM_BASE
 + 0x380)

	)

624 
	#AR_PHY_WATCHDOG_STATUS
 (
AR_SM_BASE
 + 0x5c0)

	)

625 
	#AR_PHY_WATCHDOG_CTL_1
 (
AR_SM_BASE
 + 0x5c4)

	)

626 
	#AR_PHY_WATCHDOG_CTL_2
 (
AR_SM_BASE
 + 0x5c8)

	)

627 
	#AR_PHY_WATCHDOG_CTL
 (
AR_SM_BASE
 + 0x5cc)

	)

628 
	#AR_PHY_ONLY_WARMRESET
 (
AR_SM_BASE
 + 0x5d0)

	)

629 
	#AR_PHY_ONLY_CTL
 (
AR_SM_BASE
 + 0x5d4)

	)

630 
	#AR_PHY_ECO_CTRL
 (
AR_SM_BASE
 + 0x5dc)

	)

632 
	#AR_PHY_BB_THERM_ADC_1
 (
AR_SM_BASE
 + 0x248)

	)

633 
	#AR_PHY_BB_THERM_ADC_1_INIT_THERM
 0x000000ff

	)

634 
	#AR_PHY_BB_THERM_ADC_1_INIT_THERM_S
 0

	)

636 
	#AR_PHY_BB_THERM_ADC_3
 (
AR_SM_BASE
 + 0x250)

	)

637 
	#AR_PHY_BB_THERM_ADC_3_THERM_ADC_SCALE_GAIN
 0x0001ff00

	)

638 
	#AR_PHY_BB_THERM_ADC_3_THERM_ADC_SCALE_GAIN_S
 8

	)

639 
	#AR_PHY_BB_THERM_ADC_3_THERM_ADC_OFFSET
 0x000000ff

	)

640 
	#AR_PHY_BB_THERM_ADC_3_THERM_ADC_OFFSET_S
 0

	)

642 
	#AR_PHY_BB_THERM_ADC_4
 (
AR_SM_BASE
 + 0x254)

	)

643 
	#AR_PHY_BB_THERM_ADC_4_LATEST_THERM_VALUE
 0x000000ff

	)

644 
	#AR_PHY_BB_THERM_ADC_4_LATEST_THERM_VALUE_S
 0

	)

645 
	#AR_PHY_BB_THERM_ADC_4_LATEST_VOLT_VALUE
 0x0000ff00

	)

646 
	#AR_PHY_BB_THERM_ADC_4_LATEST_VOLT_VALUE_S
 8

	)

648 
	#AR_PHY_65NM_CH0_TXRF3
 0x16048

	)

649 
	#AR_PHY_65NM_CH0_TXRF3_CAPDIV2G
 0x0000001e

	)

650 
	#AR_PHY_65NM_CH0_TXRF3_CAPDIV2G_S
 1

	)

652 
	#AR_PHY_65NM_CH0_SYNTH4
 0x1608c

	)

653 
	#AR_PHY_SYNTH4_LONG_SHIFT_SELECT
 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊h)Ë? 0x00000001 : 0x00000002)

	)

654 
	#AR_PHY_SYNTH4_LONG_SHIFT_SELECT_S
 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊h)Ë? 0 : 1)

	)

655 
	#AR_PHY_65NM_CH0_SYNTH7
 0x16098

	)

656 
	#AR_PHY_65NM_CH0_SYNTH12
 0x160ac

	)

657 
	#AR_PHY_65NM_CH0_BIAS1
 0x160c0

	)

658 
	#AR_PHY_65NM_CH0_BIAS2
 0x160c4

	)

659 
	#AR_PHY_65NM_CH0_BIAS4
 0x160cc

	)

660 
	#AR_PHY_65NM_CH0_RXTX2
 0x16104

	)

661 
	#AR_PHY_65NM_CH1_RXTX2
 0x16504

	)

662 
	#AR_PHY_65NM_CH2_RXTX2
 0x16904

	)

663 
	#AR_PHY_65NM_CH0_RXTX4
 0x1610c

	)

664 
	#AR_PHY_65NM_CH1_RXTX4
 0x1650c

	)

665 
	#AR_PHY_65NM_CH2_RXTX4
 0x1690c

	)

667 
	#AR_PHY_65NM_CH0_BB1
 0x16140

	)

668 
	#AR_PHY_65NM_CH0_BB2
 0x16144

	)

669 
	#AR_PHY_65NM_CH0_BB3
 0x16148

	)

670 
	#AR_PHY_65NM_CH1_BB1
 0x16540

	)

671 
	#AR_PHY_65NM_CH1_BB2
 0x16544

	)

672 
	#AR_PHY_65NM_CH1_BB3
 0x16548

	)

673 
	#AR_PHY_65NM_CH2_BB1
 0x16940

	)

674 
	#AR_PHY_65NM_CH2_BB2
 0x16944

	)

675 
	#AR_PHY_65NM_CH2_BB3
 0x16948

	)

677 
	#AR_PHY_65NM_CH0_SYNTH12_VREFMUL3
 0x00780000

	)

678 
	#AR_PHY_65NM_CH0_SYNTH12_VREFMUL3_S
 19

	)

679 
	#AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK
 0x00000004

	)

680 
	#AR_PHY_65NM_CH0_RXTX2_SYNTHON_MASK_S
 2

	)

681 
	#AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK
 0x00000008

	)

682 
	#AR_PHY_65NM_CH0_RXTX2_SYNTHOVR_MASK_S
 3

	)

684 
	#AR_CH0_TOP
 (
	`AR_SREV_9300
(
ah
) ? 0x16288 : \

685 (((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊h)Ë? 0x1628¯: 0x16280)))

	)

686 
	#AR_CH0_TOP_XPABIASLVL
 (
	`AR_SREV_9550
(
ah
Ë? 0x3c0 : 0x300)

	)

687 
	#AR_CH0_TOP_XPABIASLVL_S
 (
	`AR_SREV_9550
(
ah
Ë? 6 : 8)

	)

689 
	#AR_CH0_THERM
 (
	`AR_SREV_9300
(
ah
) ? 0x16290 : \

690 ((
	`AR_SREV_9485
(
ah
Ë? 0x1628¯: 0x16294)))

	)

691 
	#AR_CH0_THERM_XPABIASLVL_MSB
 0x3

	)

692 
	#AR_CH0_THERM_XPABIASLVL_MSB_S
 0

	)

693 
	#AR_CH0_THERM_XPASHORT2GND
 0x4

	)

694 
	#AR_CH0_THERM_XPASHORT2GND_S
 2

	)

696 
	#AR_SWITCH_TABLE_COM_ALL
 (0xffff)

	)

697 
	#AR_SWITCH_TABLE_COM_ALL_S
 (0)

	)

698 
	#AR_SWITCH_TABLE_COM_AR9462_ALL
 (0xffffff)

	)

699 
	#AR_SWITCH_TABLE_COM_AR9462_ALL_S
 (0)

	)

700 
	#AR_SWITCH_TABLE_COM_AR9550_ALL
 (0xffffff)

	)

701 
	#AR_SWITCH_TABLE_COM_AR9550_ALL_S
 (0)

	)

702 
	#AR_SWITCH_TABLE_COM_SPDT
 (0x00f00000)

	)

703 
	#AR_SWITCH_TABLE_COM_SPDT_ALL
 (0x0000fff0)

	)

704 
	#AR_SWITCH_TABLE_COM_SPDT_ALL_S
 (4)

	)

706 
	#AR_SWITCH_TABLE_COM2_ALL
 (0xffffff)

	)

707 
	#AR_SWITCH_TABLE_COM2_ALL_S
 (0)

	)

709 
	#AR_SWITCH_TABLE_ALL
 (0xfff)

	)

710 
	#AR_SWITCH_TABLE_ALL_S
 (0)

	)

712 
	#AR_PHY_65NM_CH0_THERM
 (
	`AR_SREV_9300
(
ah
) ? 0x16290 :\

713 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊h)Ë? 0x16294 : 0x1628c))

	)

715 
	#AR_PHY_65NM_CH0_THERM_LOCAL
 0x80000000

	)

716 
	#AR_PHY_65NM_CH0_THERM_LOCAL_S
 31

	)

717 
	#AR_PHY_65NM_CH0_THERM_START
 0x20000000

	)

718 
	#AR_PHY_65NM_CH0_THERM_START_S
 29

	)

719 
	#AR_PHY_65NM_CH0_THERM_SAR_ADC_OUT
 0x0000ff00

	)

720 
	#AR_PHY_65NM_CH0_THERM_SAR_ADC_OUT_S
 8

	)

722 
	#AR_CH0_TOP2
 (
	`AR_SREV_9300
(
ah
) ? 0x1628c : \

723 (
	`AR_SREV_9462
(
ah
Ë? 0x16290 : 0x16284))

	)

724 
	#AR_CH0_TOP2_XPABIASLVL
 (
	`AR_SREV_9561
(
ah
Ë? 0x1e00 : 0xf000)

	)

725 
	#AR_CH0_TOP2_XPABIASLVL_S
 12

	)

727 
	#AR_CH0_XTAL
 (
	`AR_SREV_9300
(
ah
) ? 0x16294 : \

728 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) ? 0x16298 : \

729 (
	`AR_SREV_9561
(
ah
Ë? 0x162c0 : 0x16290)))

	)

730 
	#AR_CH0_XTAL_CAPINDAC
 0x7f000000

	)

731 
	#AR_CH0_XTAL_CAPINDAC_S
 24

	)

732 
	#AR_CH0_XTAL_CAPOUTDAC
 0x00„0000

	)

733 
	#AR_CH0_XTAL_CAPOUTDAC_S
 17

	)

735 
	#AR_PHY_PMU1
 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) ? 0x16340 : \

736 (
	`AR_SREV_9561
(
ah
Ë? 0x16cc0 : 0x16c40))

	)

737 
	#AR_PHY_PMU1_PWD
 0x1

	)

738 
	#AR_PHY_PMU1_PWD_S
 0

	)

740 
	#AR_PHY_PMU2
 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) ? 0x16344 : \

741 (
	`AR_SREV_9561
(
ah
Ë? 0x16cc4 : 0x16c44))

	)

742 
	#AR_PHY_PMU2_PGM
 0x00200000

	)

743 
	#AR_PHY_PMU2_PGM_S
 21

	)

745 
	#AR_PHY_RX1DB_BIQUAD_LONG_SHIFT
 0x00380000

	)

746 
	#AR_PHY_RX1DB_BIQUAD_LONG_SHIFT_S
 19

	)

747 
	#AR_PHY_RX6DB_BIQUAD_LONG_SHIFT
 0x00c00000

	)

748 
	#AR_PHY_RX6DB_BIQUAD_LONG_SHIFT_S
 22

	)

749 
	#AR_PHY_LNAGAIN_LONG_SHIFT
 0xe0000000

	)

750 
	#AR_PHY_LNAGAIN_LONG_SHIFT_S
 29

	)

751 
	#AR_PHY_MXRGAIN_LONG_SHIFT
 0x03000000

	)

752 
	#AR_PHY_MXRGAIN_LONG_SHIFT_S
 24

	)

753 
	#AR_PHY_VGAGAIN_LONG_SHIFT
 0x1c000000

	)

754 
	#AR_PHY_VGAGAIN_LONG_SHIFT_S
 26

	)

755 
	#AR_PHY_SCFIR_GAIN_LONG_SHIFT
 0x00000001

	)

756 
	#AR_PHY_SCFIR_GAIN_LONG_SHIFT_S
 0

	)

757 
	#AR_PHY_MANRXGAIN_LONG_SHIFT
 0x00000002

	)

758 
	#AR_PHY_MANRXGAIN_LONG_SHIFT_S
 1

	)

763 
	#AR_PHY_CL_CAL_ENABLE
 0x00000002

	)

764 
	#AR_PHY_PARALLEL_CAL_ENABLE
 0x00000001

	)

765 
	#AR_PHY_TPCRG1_PD_CAL_ENABLE
 0x00400000

	)

766 
	#AR_PHY_TPCRG1_PD_CAL_ENABLE_S
 22

	)

768 
	#AR_PHY_ADDAC_PARACTL_OFF_PWDADC
 0x00008000

	)

770 
	#AR_PHY_FCAL20_CAP_STATUS_0
 0x01f00000

	)

771 
	#AR_PHY_FCAL20_CAP_STATUS_0_S
 20

	)

773 
	#AR_PHY_RFBUS_REQ_EN
 0x00000001

	)

774 
	#AR_PHY_RFBUS_GRANT_EN
 0x00000001

	)

775 
	#AR_PHY_GC_TURBO_MODE
 0x00000001

	)

776 
	#AR_PHY_GC_TURBO_SHORT
 0x00000002

	)

777 
	#AR_PHY_GC_DYN2040_EN
 0x00000004

	)

778 
	#AR_PHY_GC_DYN2040_PRI_ONLY
 0x00000008

	)

779 
	#AR_PHY_GC_DYN2040_PRI_CH
 0x00000010

	)

780 
	#AR_PHY_GC_DYN2040_PRI_CH_S
 4

	)

781 
	#AR_PHY_GC_DYN2040_EXT_CH
 0x00000020

	)

782 
	#AR_PHY_GC_HT_EN
 0x00000040

	)

783 
	#AR_PHY_GC_SHORT_GI_40
 0x00000080

	)

784 
	#AR_PHY_GC_WALSH
 0x00000100

	)

785 
	#AR_PHY_GC_SINGLE_HT_LTF1
 0x00000200

	)

786 
	#AR_PHY_GC_GF_DETECT_EN
 0x00000400

	)

787 
	#AR_PHY_GC_ENABLE_DAC_FIFO
 0x00000800

	)

788 
	#AR_PHY_RX_DELAY_DELAY
 0x00003FFF

	)

790 
	#AR_PHY_CALMODE_IQ
 0x00000000

	)

791 
	#AR_PHY_CALMODE_ADC_GAIN
 0x00000001

	)

792 
	#AR_PHY_CALMODE_ADC_DC_PER
 0x00000002

	)

793 
	#AR_PHY_CALMODE_ADC_DC_INIT
 0x00000003

	)

794 
	#AR_PHY_SWAP_ALT_CHAIN
 0x00000040

	)

795 
	#AR_PHY_MODE_OFDM
 0x00000000

	)

796 
	#AR_PHY_MODE_CCK
 0x00000001

	)

797 
	#AR_PHY_MODE_DYNAMIC
 0x00000004

	)

798 
	#AR_PHY_MODE_DYNAMIC_S
 2

	)

799 
	#AR_PHY_MODE_HALF
 0x00000020

	)

800 
	#AR_PHY_MODE_QUARTER
 0x00000040

	)

801 
	#AR_PHY_MAC_CLK_MODE
 0x00000080

	)

802 
	#AR_PHY_MODE_DYN_CCK_DISABLE
 0x00000100

	)

803 
	#AR_PHY_MODE_SVD_HALF
 0x00000200

	)

804 
	#AR_PHY_ACTIVE_EN
 0x00000001

	)

805 
	#AR_PHY_ACTIVE_DIS
 0x00000000

	)

806 
	#AR_PHY_FORCE_XPA_CFG
 0x000000001

	)

807 
	#AR_PHY_FORCE_XPA_CFG_S
 0

	)

808 
	#AR_PHY_XPA_TIMING_CTL_TX_END_XPAB_OFF
 0xFF000000

	)

809 
	#AR_PHY_XPA_TIMING_CTL_TX_END_XPAB_OFF_S
 24

	)

810 
	#AR_PHY_XPA_TIMING_CTL_TX_END_XPAA_OFF
 0x00FF0000

	)

811 
	#AR_PHY_XPA_TIMING_CTL_TX_END_XPAA_OFF_S
 16

	)

812 
	#AR_PHY_XPA_TIMING_CTL_FRAME_XPAB_ON
 0x0000FF00

	)

813 
	#AR_PHY_XPA_TIMING_CTL_FRAME_XPAB_ON_S
 8

	)

814 
	#AR_PHY_XPA_TIMING_CTL_FRAME_XPAA_ON
 0x000000FF

	)

815 
	#AR_PHY_XPA_TIMING_CTL_FRAME_XPAA_ON_S
 0

	)

816 
	#AR_PHY_TX_END_TO_A2_RX_ON
 0x00FF0000

	)

817 
	#AR_PHY_TX_END_TO_A2_RX_ON_S
 16

	)

818 
	#AR_PHY_TX_END_DATA_START
 0x000000FF

	)

819 
	#AR_PHY_TX_END_DATA_START_S
 0

	)

820 
	#AR_PHY_TX_END_PA_ON
 0x0000FF00

	)

821 
	#AR_PHY_TX_END_PA_ON_S
 8

	)

822 
	#AR_PHY_TPCRG5_PD_GAIN_OVERLAP
 0x0000000F

	)

823 
	#AR_PHY_TPCRG5_PD_GAIN_OVERLAP_S
 0

	)

824 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1
 0x000003F0

	)

825 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1_S
 4

	)

826 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2
 0x0000FC00

	)

827 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2_S
 10

	)

828 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3
 0x003F0000

	)

829 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3_S
 16

	)

830 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4
 0x0FC00000

	)

831 
	#AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4_S
 22

	)

832 
	#AR_PHY_TPCRG1_NUM_PD_GAIN
 0x0000c000

	)

833 
	#AR_PHY_TPCRG1_NUM_PD_GAIN_S
 14

	)

834 
	#AR_PHY_TPCRG1_PD_GAIN_1
 0x00030000

	)

835 
	#AR_PHY_TPCRG1_PD_GAIN_1_S
 16

	)

836 
	#AR_PHY_TPCRG1_PD_GAIN_2
 0x000C0000

	)

837 
	#AR_PHY_TPCRG1_PD_GAIN_2_S
 18

	)

838 
	#AR_PHY_TPCRG1_PD_GAIN_3
 0x00300000

	)

839 
	#AR_PHY_TPCRG1_PD_GAIN_3_S
 20

	)

840 
	#AR_PHY_TPCGR1_FORCED_DAC_GAIN
 0x0000003e

	)

841 
	#AR_PHY_TPCGR1_FORCED_DAC_GAIN_S
 1

	)

842 
	#AR_PHY_TPCGR1_FORCE_DAC_GAIN
 0x00000001

	)

843 
	#AR_PHY_TXGAIN_FORCE
 0x00000001

	)

844 
	#AR_PHY_TXGAIN_FORCE_S
 0

	)

845 
	#AR_PHY_TXGAIN_FORCED_PADVGNRA
 0x00003c00

	)

846 
	#AR_PHY_TXGAIN_FORCED_PADVGNRA_S
 10

	)

847 
	#AR_PHY_TXGAIN_FORCED_PADVGNRB
 0x0003c000

	)

848 
	#AR_PHY_TXGAIN_FORCED_PADVGNRB_S
 14

	)

849 
	#AR_PHY_TXGAIN_FORCED_PADVGNRD
 0x00c00000

	)

850 
	#AR_PHY_TXGAIN_FORCED_PADVGNRD_S
 22

	)

851 
	#AR_PHY_TXGAIN_FORCED_TXMXRGAIN
 0x000003c0

	)

852 
	#AR_PHY_TXGAIN_FORCED_TXMXRGAIN_S
 6

	)

853 
	#AR_PHY_TXGAIN_FORCED_TXBB1DBGAIN
 0x0000000e

	)

854 
	#AR_PHY_TXGAIN_FORCED_TXBB1DBGAIN_S
 1

	)

856 
	#AR_PHY_POWER_TX_RATE1
 0x9934

	)

857 
	#AR_PHY_POWER_TX_RATE2
 0x9938

	)

858 
	#AR_PHY_POWER_TX_RATE_MAX
 0x993c

	)

859 
	#AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
 0x00000040

	)

860 
	#PHY_AGC_CLR
 0x10000000

	)

861 
	#RFSILENT_BB
 0x00002000

	)

862 
	#AR_PHY_CHAN_INFO_GAIN_DIFF_PPM_MASK
 0xFFF

	)

863 
	#AR_PHY_CHAN_INFO_GAIN_DIFF_PPM_SIGNED_BIT
 0x800

	)

864 
	#AR_PHY_CHAN_INFO_GAIN_DIFF_UPPER_LIMIT
 320

	)

865 
	#AR_PHY_CHAN_INFO_MEMORY_CAPTURE_MASK
 0x0001

	)

866 
	#AR_PHY_RX_DELAY_DELAY
 0x00003FFF

	)

867 
	#AR_PHY_CCK_TX_CTRL_JAPAN
 0x00000010

	)

869 
	#AR_PHY_SPECTRAL_SCAN_ENABLE
 0x00000001

	)

870 
	#AR_PHY_SPECTRAL_SCAN_ENABLE_S
 0

	)

871 
	#AR_PHY_SPECTRAL_SCAN_ACTIVE
 0x00000002

	)

872 
	#AR_PHY_SPECTRAL_SCAN_ACTIVE_S
 1

	)

873 
	#AR_PHY_SPECTRAL_SCAN_FFT_PERIOD
 0x000000F0

	)

874 
	#AR_PHY_SPECTRAL_SCAN_FFT_PERIOD_S
 4

	)

875 
	#AR_PHY_SPECTRAL_SCAN_PERIOD
 0x0000FF00

	)

876 
	#AR_PHY_SPECTRAL_SCAN_PERIOD_S
 8

	)

877 
	#AR_PHY_SPECTRAL_SCAN_COUNT
 0x0FFF0000

	)

878 
	#AR_PHY_SPECTRAL_SCAN_COUNT_S
 16

	)

879 
	#AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT
 0x10000000

	)

880 
	#AR_PHY_SPECTRAL_SCAN_SHORT_REPEAT_S
 28

	)

881 
	#AR_PHY_SPECTRAL_SCAN_PRIORITY
 0x20000000

	)

882 
	#AR_PHY_SPECTRAL_SCAN_PRIORITY_S
 29

	)

883 
	#AR_PHY_SPECTRAL_SCAN_USE_ERR5
 0x40000000

	)

884 
	#AR_PHY_SPECTRAL_SCAN_USE_ERR5_S
 30

	)

885 
	#AR_PHY_SPECTRAL_SCAN_COMPRESSED_RPT
 0x80000000

	)

886 
	#AR_PHY_SPECTRAL_SCAN_COMPRESSED_RPT_S
 31

	)

888 
	#AR_PHY_CHANNEL_STATUS_RX_CLEAR
 0x00000004

	)

889 
	#AR_PHY_RTT_CTRL_ENA_RADIO_RETENTION
 0x00000001

	)

890 
	#AR_PHY_RTT_CTRL_ENA_RADIO_RETENTION_S
 0

	)

891 
	#AR_PHY_RTT_CTRL_RESTORE_MASK
 0x0000007E

	)

892 
	#AR_PHY_RTT_CTRL_RESTORE_MASK_S
 1

	)

893 
	#AR_PHY_RTT_CTRL_FORCE_RADIO_RESTORE
 0x00000080

	)

894 
	#AR_PHY_RTT_CTRL_FORCE_RADIO_RESTORE_S
 7

	)

895 
	#AR_PHY_RTT_SW_RTT_TABLE_ACCESS
 0x00000001

	)

896 
	#AR_PHY_RTT_SW_RTT_TABLE_ACCESS_S
 0

	)

897 
	#AR_PHY_RTT_SW_RTT_TABLE_WRITE
 0x00000002

	)

898 
	#AR_PHY_RTT_SW_RTT_TABLE_WRITE_S
 1

	)

899 
	#AR_PHY_RTT_SW_RTT_TABLE_ADDR
 0x0000001C

	)

900 
	#AR_PHY_RTT_SW_RTT_TABLE_ADDR_S
 2

	)

901 
	#AR_PHY_RTT_SW_RTT_TABLE_DATA
 0xFFFFFFF0

	)

902 
	#AR_PHY_RTT_SW_RTT_TABLE_DATA_S
 4

	)

903 
	#AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL
 0x80000000

	)

904 
	#AR_PHY_TX_IQCAL_CONTROL_0_ENABLE_TXIQ_CAL_S
 31

	)

905 
	#AR_PHY_TX_IQCAL_CONTROL_1_IQCORR_I_Q_COFF_DELPT
 0x01fc0000

	)

906 
	#AR_PHY_TX_IQCAL_CONTROL_1_IQCORR_I_Q_COFF_DELPT_S
 18

	)

907 
	#AR_PHY_TX_IQCAL_START_DO_CAL
 0x00000001

	)

908 
	#AR_PHY_TX_IQCAL_START_DO_CAL_S
 0

	)

910 
	#AR_PHY_TX_IQCAL_STATUS_FAILED
 0x00000001

	)

911 
	#AR_PHY_CALIBRATED_GAINS_0
 0x3e

	)

912 
	#AR_PHY_CALIBRATED_GAINS_0_S
 1

	)

914 
	#AR_PHY_TX_IQCAL_CORR_COEFF_00_COEFF_TABLE
 0x00003fff

	)

915 
	#AR_PHY_TX_IQCAL_CORR_COEFF_00_COEFF_TABLE_S
 0

	)

916 
	#AR_PHY_TX_IQCAL_CORR_COEFF_01_COEFF_TABLE
 0x0fffc000

	)

917 
	#AR_PHY_TX_IQCAL_CORR_COEFF_01_COEFF_TABLE_S
 14

	)

919 
	#AR_PHY_65NM_CH0_RXTX4_THERM_ON
 0x10000000

	)

920 
	#AR_PHY_65NM_CH0_RXTX4_THERM_ON_S
 28

	)

921 
	#AR_PHY_65NM_CH0_RXTX4_THERM_ON_OVR
 0x20000000

	)

922 
	#AR_PHY_65NM_CH0_RXTX4_THERM_ON_OVR_S
 29

	)

924 
	#AR_PHY_65NM_RXTX4_XLNA_BIAS
 0xC0000000

	)

925 
	#AR_PHY_65NM_RXTX4_XLNA_BIAS_S
 30

	)

930 
	#AR_CHAN1_BASE
 0xa800

	)

932 
	#AR_PHY_EXT_CCA_1
 (
AR_CHAN1_BASE
 + 0x30)

	)

933 
	#AR_PHY_TX_PHASE_RAMP_1
 (
AR_CHAN1_BASE
 + 0xd0)

	)

934 
	#AR_PHY_ADC_GAIN_DC_CORR_1
 (
AR_CHAN1_BASE
 + 0xd4)

	)

936 
	#AR_PHY_SPUR_REPORT_1
 (
AR_CHAN1_BASE
 + 0xa8)

	)

937 
	#AR_PHY_CHAN_INFO_TAB_1
 (
AR_CHAN1_BASE
 + 0x300)

	)

938 
	#AR_PHY_RX_IQCAL_CORR_B1
 (
AR_CHAN1_BASE
 + 0xdc)

	)

943 
	#AR_PHY_CH1_EXT_MINCCA_PWR
 0x01FF0000

	)

944 
	#AR_PHY_CH1_EXT_MINCCA_PWR_S
 16

	)

949 
	#AR_AGC1_BASE
 0x´00

	)

951 
	#AR_PHY_FORCEMAX_GAINS_1
 (
AR_AGC1_BASE
 + 0x4)

	)

952 
	#AR_PHY_EXT_ATTEN_CTL_1
 (
AR_AGC1_BASE
 + 0x18)

	)

953 
	#AR_PHY_CCA_1
 (
AR_AGC1_BASE
 + 0x1c)

	)

954 
	#AR_PHY_CCA_CTRL_1
 (
AR_AGC1_BASE
 + 0x20)

	)

955 
	#AR_PHY_RSSI_1
 (
AR_AGC1_BASE
 + 0x180)

	)

956 
	#AR_PHY_SPUR_CCK_REP_1
 (
AR_AGC1_BASE
 + 0x184)

	)

957 
	#AR_PHY_RX_OCGAIN_2
 (
AR_AGC1_BASE
 + 0x200)

	)

962 
	#AR_PHY_CH1_MINCCA_PWR
 0x1FF00000

	)

963 
	#AR_PHY_CH1_MINCCA_PWR_S
 20

	)

968 
	#AR_SM1_BASE
 0xb200

	)

970 
	#AR_PHY_SWITCH_CHAIN_1
 (
AR_SM1_BASE
 + 0x84)

	)

971 
	#AR_PHY_FCAL_2_1
 (
AR_SM1_BASE
 + 0xd0)

	)

972 
	#AR_PHY_DFT_TONE_CTL_1
 (
AR_SM1_BASE
 + 0xd4)

	)

973 
	#AR_PHY_CL_TAB_1
 (
AR_SM1_BASE
 + 0x100)

	)

974 
	#AR_PHY_CHAN_INFO_GAIN_1
 (
AR_SM1_BASE
 + 0x180)

	)

975 
	#AR_PHY_TPC_4_B1
 (
AR_SM1_BASE
 + 0x204)

	)

976 
	#AR_PHY_TPC_5_B1
 (
AR_SM1_BASE
 + 0x208)

	)

977 
	#AR_PHY_TPC_6_B1
 (
AR_SM1_BASE
 + 0x20c)

	)

978 
	#AR_PHY_TPC_11_B1
 (
AR_SM1_BASE
 + 0x220)

	)

979 
	#AR_PHY_PDADC_TAB_1
 (
AR_SM1_BASE
 + (
	`AR_SREV_9462_20_OR_LATER
(
ah
) ? \

980 0x280 : 0x240))

	)

981 
	#AR_PHY_TPC_19_B1
 (
AR_SM1_BASE
 + 0x240)

	)

982 
	#AR_PHY_TPC_19_B1_ALPHA_THERM
 0xff

	)

983 
	#AR_PHY_TPC_19_B1_ALPHA_THERM_S
 0

	)

984 
	#AR_PHY_TX_IQCAL_STATUS_B1
 (
AR_SM1_BASE
 + 0x48c)

	)

985 
	#AR_PHY_TX_IQCAL_CORR_COEFF_B1
(
_i
Ë(
AR_SM1_BASE
 + 0x450 + ((_iË<< 2))

	)

987 
	#AR_PHY_RTT_TABLE_SW_INTF_B
(
i
) (0x384 + ((i) ? \

988 
AR_SM1_BASE
 : 
AR_SM_BASE
))

	)

989 
	#AR_PHY_RTT_TABLE_SW_INTF_1_B
(
i
) (0x388 + ((i) ? \

990 
AR_SM1_BASE
 : 
AR_SM_BASE
))

	)

994 
	#AR_CHAN2_BASE
 0xb800

	)

996 
	#AR_PHY_EXT_CCA_2
 (
AR_CHAN2_BASE
 + 0x30)

	)

997 
	#AR_PHY_TX_PHASE_RAMP_2
 (
AR_CHAN2_BASE
 + 0xd0)

	)

998 
	#AR_PHY_ADC_GAIN_DC_CORR_2
 (
AR_CHAN2_BASE
 + 0xd4)

	)

1000 
	#AR_PHY_SPUR_REPORT_2
 (
AR_CHAN2_BASE
 + 0xa8)

	)

1001 
	#AR_PHY_CHAN_INFO_TAB_2
 (
AR_CHAN2_BASE
 + 0x300)

	)

1002 
	#AR_PHY_RX_IQCAL_CORR_B2
 (
AR_CHAN2_BASE
 + 0xdc)

	)

1007 
	#AR_PHY_CH2_EXT_MINCCA_PWR
 0x01FF0000

	)

1008 
	#AR_PHY_CH2_EXT_MINCCA_PWR_S
 16

	)

1012 
	#AR_AGC2_BASE
 0xbe00

	)

1014 
	#AR_PHY_FORCEMAX_GAINS_2
 (
AR_AGC2_BASE
 + 0x4)

	)

1015 
	#AR_PHY_EXT_ATTEN_CTL_2
 (
AR_AGC2_BASE
 + 0x18)

	)

1016 
	#AR_PHY_CCA_2
 (
AR_AGC2_BASE
 + 0x1c)

	)

1017 
	#AR_PHY_CCA_CTRL_2
 (
AR_AGC2_BASE
 + 0x20)

	)

1018 
	#AR_PHY_RSSI_2
 (
AR_AGC2_BASE
 + 0x180)

	)

1023 
	#AR_PHY_CH2_MINCCA_PWR
 0x1FF00000

	)

1024 
	#AR_PHY_CH2_MINCCA_PWR_S
 20

	)

1029 
	#AR_SM2_BASE
 0xc200

	)

1031 
	#AR_PHY_SWITCH_CHAIN_2
 (
AR_SM2_BASE
 + 0x84)

	)

1032 
	#AR_PHY_FCAL_2_2
 (
AR_SM2_BASE
 + 0xd0)

	)

1033 
	#AR_PHY_DFT_TONE_CTL_2
 (
AR_SM2_BASE
 + 0xd4)

	)

1034 
	#AR_PHY_CL_TAB_2
 (
AR_SM2_BASE
 + 0x100)

	)

1035 
	#AR_PHY_CHAN_INFO_GAIN_2
 (
AR_SM2_BASE
 + 0x180)

	)

1036 
	#AR_PHY_TPC_4_B2
 (
AR_SM2_BASE
 + 0x204)

	)

1037 
	#AR_PHY_TPC_5_B2
 (
AR_SM2_BASE
 + 0x208)

	)

1038 
	#AR_PHY_TPC_6_B2
 (
AR_SM2_BASE
 + 0x20c)

	)

1039 
	#AR_PHY_TPC_11_B2
 (
AR_SM2_BASE
 + 0x220)

	)

1040 
	#AR_PHY_TPC_19_B2
 (
AR_SM2_BASE
 + 0x240)

	)

1041 
	#AR_PHY_TX_IQCAL_STATUS_B2
 (
AR_SM2_BASE
 + 0x48c)

	)

1042 
	#AR_PHY_TX_IQCAL_CORR_COEFF_B2
(
_i
Ë(
AR_SM2_BASE
 + 0x450 + ((_iË<< 2))

	)

1044 
	#AR_PHY_TX_IQCAL_STATUS_B2_FAILED
 0x00000001

	)

1049 
	#AR_AGC3_BASE
 0x˚00

	)

1051 
	#AR_PHY_RSSI_3
 (
AR_AGC3_BASE
 + 0x180)

	)

1054 
	#AR_GLB_BASE
 0x20000

	)

1055 
	#AR_GLB_GPIO_CONTROL
 (
AR_GLB_BASE
)

	)

1056 
	#AR_PHY_GLB_CONTROL
 (
AR_GLB_BASE
 + 0x44)

	)

1057 
	#AR_GLB_SCRATCH
(
_ah
Ë(
AR_GLB_BASE
 + \

1058 (
	`AR_SREV_9462_20_OR_LATER
(
_ah
Ë? 0x4¯: 0x50))

	)

1059 
	#AR_GLB_STATUS
 (
AR_GLB_BASE
 + 0x48)

	)

1064 
	#AR_PHY_CHAIN_OFFSET
 (
AR_CHAN1_BASE
 - 
AR_CHAN_BASE
)

	)

1066 
	#AR_PHY_NEW_ADC_DC_GAIN_CORR
(
_i
Ë(
AR_PHY_ADC_GAIN_DC_CORR_0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1067 
	#AR_PHY_NEW_ADC_DC_GAIN_CORR_9300_10
(
_i
Ë(
AR_PHY_ADC_GAIN_DC_CORR_0_9300_10
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1068 
	#AR_PHY_SWITCH_CHAIN
(
_i
Ë(
AR_PHY_SWITCH_CHAIN_0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1069 
	#AR_PHY_EXT_ATTEN_CTL
(
_i
Ë(
AR_PHY_EXT_ATTEN_CTL_0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1071 
	#AR_PHY_RXGAIN
(
_i
Ë(
AR_PHY_FORCEMAX_GAINS_0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1072 
	#AR_PHY_TPCRG5
(
_i
Ë(
AR_PHY_TPC_5_B0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1073 
	#AR_PHY_PDADC_TAB
(
_i
Ë(
AR_PHY_PDADC_TAB_0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1075 
	#AR_PHY_CAL_MEAS_0
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_0_B0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1076 
	#AR_PHY_CAL_MEAS_1
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_1_B0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1077 
	#AR_PHY_CAL_MEAS_2
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_2_B0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1078 
	#AR_PHY_CAL_MEAS_3
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_3_B0
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1079 
	#AR_PHY_CAL_MEAS_0_9300_10
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_0_B0_9300_10
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1080 
	#AR_PHY_CAL_MEAS_1_9300_10
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_1_B0_9300_10
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1081 
	#AR_PHY_CAL_MEAS_2_9300_10
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_2_B0_9300_10
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1082 
	#AR_PHY_CAL_MEAS_3_9300_10
(
_i
Ë(
AR_PHY_IQ_ADC_MEAS_3_B0_9300_10
 + (
AR_PHY_CHAIN_OFFSET
 * (_i)))

	)

1084 
	#AR_PHY_WATCHDOG_NON_IDLE_ENABLE
 0x00000001

	)

1085 
	#AR_PHY_WATCHDOG_IDLE_ENABLE
 0x00000002

	)

1086 
	#AR_PHY_WATCHDOG_IDLE_MASK
 0xFFFF0000

	)

1087 
	#AR_PHY_WATCHDOG_NON_IDLE_MASK
 0x0000FFFC

	)

1089 
	#AR_PHY_WATCHDOG_RST_ENABLE
 0x00000002

	)

1090 
	#AR_PHY_WATCHDOG_IRQ_ENABLE
 0x00000004

	)

1091 
	#AR_PHY_WATCHDOG_CNTL2_MASK
 0xFFFFFFF9

	)

1093 
	#AR_PHY_WATCHDOG_INFO
 0x00000007

	)

1094 
	#AR_PHY_WATCHDOG_INFO_S
 0

	)

1095 
	#AR_PHY_WATCHDOG_DET_HANG
 0x00000008

	)

1096 
	#AR_PHY_WATCHDOG_DET_HANG_S
 3

	)

1097 
	#AR_PHY_WATCHDOG_RADAR_SM
 0x000000F0

	)

1098 
	#AR_PHY_WATCHDOG_RADAR_SM_S
 4

	)

1099 
	#AR_PHY_WATCHDOG_RX_OFDM_SM
 0x00000F00

	)

1100 
	#AR_PHY_WATCHDOG_RX_OFDM_SM_S
 8

	)

1101 
	#AR_PHY_WATCHDOG_RX_CCK_SM
 0x0000F000

	)

1102 
	#AR_PHY_WATCHDOG_RX_CCK_SM_S
 12

	)

1103 
	#AR_PHY_WATCHDOG_TX_OFDM_SM
 0x000F0000

	)

1104 
	#AR_PHY_WATCHDOG_TX_OFDM_SM_S
 16

	)

1105 
	#AR_PHY_WATCHDOG_TX_CCK_SM
 0x00F00000

	)

1106 
	#AR_PHY_WATCHDOG_TX_CCK_SM_S
 20

	)

1107 
	#AR_PHY_WATCHDOG_AGC_SM
 0x0F000000

	)

1108 
	#AR_PHY_WATCHDOG_AGC_SM_S
 24

	)

1109 
	#AR_PHY_WATCHDOG_SRCH_SM
 0xF0000000

	)

1110 
	#AR_PHY_WATCHDOG_SRCH_SM_S
 28

	)

1112 
	#AR_PHY_WATCHDOG_STATUS_CLR
 0x00000008

	)

1117 
	#AR_PHY_XPA_TIMING_CTL
 (
AR_SM_BASE
 + 0x64)

	)

1119 
	#AR_PHY_PAPRD_AM2AM
 (
AR_CHAN_BASE
 + 0xe4)

	)

1120 
	#AR_PHY_PAPRD_AM2AM_MASK
 0x01ffffff

	)

1121 
	#AR_PHY_PAPRD_AM2AM_MASK_S
 0

	)

1123 
	#AR_PHY_PAPRD_AM2PM
 (
AR_CHAN_BASE
 + 0xe8)

	)

1124 
	#AR_PHY_PAPRD_AM2PM_MASK
 0x01ffffff

	)

1125 
	#AR_PHY_PAPRD_AM2PM_MASK_S
 0

	)

1127 
	#AR_PHY_PAPRD_HT40
 (
AR_CHAN_BASE
 + 0xec)

	)

1128 
	#AR_PHY_PAPRD_HT40_MASK
 0x01ffffff

	)

1129 
	#AR_PHY_PAPRD_HT40_MASK_S
 0

	)

1131 
	#AR_PHY_PAPRD_CTRL0_B0
 (
AR_CHAN_BASE
 + 0xf0)

	)

1132 
	#AR_PHY_PAPRD_CTRL0_B1
 (
AR_CHAN1_BASE
 + 0xf0)

	)

1133 
	#AR_PHY_PAPRD_CTRL0_B2
 (
AR_CHAN2_BASE
 + 0xf0)

	)

1134 
	#AR_PHY_PAPRD_CTRL0_PAPRD_ENABLE
 0x00000001

	)

1135 
	#AR_PHY_PAPRD_CTRL0_PAPRD_ENABLE_S
 0

	)

1136 
	#AR_PHY_PAPRD_CTRL0_USE_SINGLE_TABLE_MASK
 0x00000002

	)

1137 
	#AR_PHY_PAPRD_CTRL0_USE_SINGLE_TABLE_MASK_S
 1

	)

1138 
	#AR_PHY_PAPRD_CTRL0_PAPRD_MAG_THRSH
 0xf8000000

	)

1139 
	#AR_PHY_PAPRD_CTRL0_PAPRD_MAG_THRSH_S
 27

	)

1141 
	#AR_PHY_PAPRD_CTRL1_B0
 (
AR_CHAN_BASE
 + 0xf4)

	)

1142 
	#AR_PHY_PAPRD_CTRL1_B1
 (
AR_CHAN1_BASE
 + 0xf4)

	)

1143 
	#AR_PHY_PAPRD_CTRL1_B2
 (
AR_CHAN2_BASE
 + 0xf4)

	)

1144 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_SCALING_ENA
 0x00000001

	)

1145 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_SCALING_ENA_S
 0

	)

1146 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2AM_ENABLE
 0x00000002

	)

1147 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2AM_ENABLE_S
 1

	)

1148 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2PM_ENABLE
 0x00000004

	)

1149 
	#AR_PHY_PAPRD_CTRL1_ADAPTIVE_AM2PM_ENABLE_S
 2

	)

1150 
	#AR_PHY_PAPRD_CTRL1_PAPRD_POWER_AT_AM2AM_CAL
 0x000001f8

	)

1151 
	#AR_PHY_PAPRD_CTRL1_PAPRD_POWER_AT_AM2AM_CAL_S
 3

	)

1152 
	#AR_PHY_PAPRD_CTRL1_PA_GAIN_SCALE_FACT_MASK
 0x0001„00

	)

1153 
	#AR_PHY_PAPRD_CTRL1_PA_GAIN_SCALE_FACT_MASK_S
 9

	)

1154 
	#AR_PHY_PAPRD_CTRL1_PAPRD_MAG_SCALE_FACT
 0x0f„0000

	)

1155 
	#AR_PHY_PAPRD_CTRL1_PAPRD_MAG_SCALE_FACT_S
 17

	)

1157 
	#AR_PHY_PAPRD_TRAINER_CNTL1
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x580 : 0x490))

	)

1159 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_CF_PAPRD_TRAIN_ENABLE
 0x00000001

	)

1160 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_CF_PAPRD_TRAIN_ENABLE_S
 0

	)

1161 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_AGC2_SETTLING
 0x0000007e

	)

1162 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_AGC2_SETTLING_S
 1

	)

1163 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_IQCORR_ENABLE
 0x00000100

	)

1164 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_IQCORR_ENABLE_S
 8

	)

1165 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_RX_BB_GAIN_FORCE
 0x00000200

	)

1166 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_RX_BB_GAIN_FORCE_S
 9

	)

1167 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_TX_GAIN_FORCE
 0x00000400

	)

1168 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_TX_GAIN_FORCE_S
 10

	)

1169 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_ENABLE
 0x00000800

	)

1170 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_ENABLE_S
 11

	)

1171 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_SKIP
 0x0003f000

	)

1172 
	#AR_PHY_PAPRD_TRAINER_CNTL1_CF_PAPRD_LB_SKIP_S
 12

	)

1174 
	#AR_PHY_PAPRD_TRAINER_CNTL2
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x584 : 0x494))

	)

1176 
	#AR_PHY_PAPRD_TRAINER_CNTL2_CF_PAPRD_INIT_RX_BB_GAIN
 0xFFFFFFFF

	)

1177 
	#AR_PHY_PAPRD_TRAINER_CNTL2_CF_PAPRD_INIT_RX_BB_GAIN_S
 0

	)

1179 
	#AR_PHY_PAPRD_TRAINER_CNTL3
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x588 : 0x498))

	)

1181 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_ADC_DESIRED_SIZE
 0x0000003f

	)

1182 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_ADC_DESIRED_SIZE_S
 0

	)

1183 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP
 0x00000fc0

	)

1184 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_QUICK_DROP_S
 6

	)

1185 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_MIN_LOOPBACK_DEL
 0x0001f000

	)

1186 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_MIN_LOOPBACK_DEL_S
 12

	)

1187 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_NUM_CORR_STAGES
 0x000e0000

	)

1188 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_NUM_CORR_STAGES_S
 17

	)

1189 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_COARSE_CORR_LEN
 0x00f00000

	)

1190 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_COARSE_CORR_LEN_S
 20

	)

1191 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_FINE_CORR_LEN
 0x0f000000

	)

1192 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_FINE_CORR_LEN_S
 24

	)

1193 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_BBTXMIX_DISABLE
 0x20000000

	)

1194 
	#AR_PHY_PAPRD_TRAINER_CNTL3_CF_PAPRD_BBTXMIX_DISABLE_S
 29

	)

1196 
	#AR_PHY_PAPRD_TRAINER_CNTL4
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x58¯: 0x49c))

	)

1198 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_NUM_TRAIN_SAMPLES
 0x03ff0000

	)

1199 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_NUM_TRAIN_SAMPLES_S
 16

	)

1200 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_SAFETY_DELTA
 0x0000f000

	)

1201 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_SAFETY_DELTA_S
 12

	)

1202 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_MIN_CORR
 0x00000fff

	)

1203 
	#AR_PHY_PAPRD_TRAINER_CNTL4_CF_PAPRD_MIN_CORR_S
 0

	)

1205 
	#AR_PHY_PAPRD_PRE_POST_SCALE_0_B0
 (
AR_CHAN_BASE
 + 0x100)

	)

1206 
	#AR_PHY_PAPRD_PRE_POST_SCALE_1_B0
 (
AR_CHAN_BASE
 + 0x104)

	)

1207 
	#AR_PHY_PAPRD_PRE_POST_SCALE_2_B0
 (
AR_CHAN_BASE
 + 0x108)

	)

1208 
	#AR_PHY_PAPRD_PRE_POST_SCALE_3_B0
 (
AR_CHAN_BASE
 + 0x10c)

	)

1209 
	#AR_PHY_PAPRD_PRE_POST_SCALE_4_B0
 (
AR_CHAN_BASE
 + 0x110)

	)

1210 
	#AR_PHY_PAPRD_PRE_POST_SCALE_5_B0
 (
AR_CHAN_BASE
 + 0x114)

	)

1211 
	#AR_PHY_PAPRD_PRE_POST_SCALE_6_B0
 (
AR_CHAN_BASE
 + 0x118)

	)

1212 
	#AR_PHY_PAPRD_PRE_POST_SCALE_7_B0
 (
AR_CHAN_BASE
 + 0x11c)

	)

1213 
	#AR_PHY_PAPRD_PRE_POST_SCALING
 0x3FFFF

	)

1214 
	#AR_PHY_PAPRD_PRE_POST_SCALING_S
 0

	)

1216 
	#AR_PHY_PAPRD_TRAINER_STAT1
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x590 : 0x4a0))

	)

1218 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE
 0x00000001

	)

1219 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_DONE_S
 0

	)

1220 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_INCOMPLETE
 0x00000002

	)

1221 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_INCOMPLETE_S
 1

	)

1222 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_CORR_ERR
 0x00000004

	)

1223 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_CORR_ERR_S
 2

	)

1224 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_ACTIVE
 0x00000008

	)

1225 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_TRAIN_ACTIVE_S
 3

	)

1226 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_RX_GAIN_IDX
 0x000001f0

	)

1227 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_RX_GAIN_IDX_S
 4

	)

1228 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_AGC2_PWR
 0x0001„00

	)

1229 
	#AR_PHY_PAPRD_TRAINER_STAT1_PAPRD_AGC2_PWR_S
 9

	)

1231 
	#AR_PHY_PAPRD_TRAINER_STAT2
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x594 : 0x4a4))

	)

1233 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_FINE_VAL
 0x0000ffff

	)

1234 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_FINE_VAL_S
 0

	)

1235 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_COARSE_IDX
 0x001f0000

	)

1236 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_COARSE_IDX_S
 16

	)

1237 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_FINE_IDX
 0x00600000

	)

1238 
	#AR_PHY_PAPRD_TRAINER_STAT2_PAPRD_FINE_IDX_S
 21

	)

1240 
	#AR_PHY_PAPRD_TRAINER_STAT3
 (
AR_SM_BASE
 + (
	`AR_SREV_9485
(
ah
Ë? 0x598 : 0x4a8))

	)

1242 
	#AR_PHY_PAPRD_TRAINER_STAT3_PAPRD_TRAIN_SAMPLES_CNT
 0x000fffff

	)

1243 
	#AR_PHY_PAPRD_TRAINER_STAT3_PAPRD_TRAIN_SAMPLES_CNT_S
 0

	)

1245 
	#AR_PHY_PAPRD_MEM_TAB_B0
 (
AR_CHAN_BASE
 + 0x120)

	)

1246 
	#AR_PHY_PAPRD_MEM_TAB_B1
 (
AR_CHAN1_BASE
 + 0x120)

	)

1247 
	#AR_PHY_PAPRD_MEM_TAB_B2
 (
AR_CHAN2_BASE
 + 0x120)

	)

1249 
	#AR_PHY_PA_GAIN123_B0
 (
AR_CHAN_BASE
 + 0xf8)

	)

1250 
	#AR_PHY_PA_GAIN123_B1
 (
AR_CHAN1_BASE
 + 0xf8)

	)

1251 
	#AR_PHY_PA_GAIN123_B2
 (
AR_CHAN2_BASE
 + 0xf8)

	)

1252 
	#AR_PHY_PA_GAIN123_PA_GAIN1
 0x3FF

	)

1253 
	#AR_PHY_PA_GAIN123_PA_GAIN1_S
 0

	)

1255 
	#AR_PHY_POWERTX_RATE5
 (
AR_SM_BASE
 + 0x1d0)

	)

1256 
	#AR_PHY_POWERTX_RATE5_POWERTXHT20_0
 0x3F

	)

1257 
	#AR_PHY_POWERTX_RATE5_POWERTXHT20_0_S
 0

	)

1259 
	#AR_PHY_POWERTX_RATE6
 (
AR_SM_BASE
 + 0x1d4)

	)

1260 
	#AR_PHY_POWERTX_RATE6_POWERTXHT20_5
 0x3F00

	)

1261 
	#AR_PHY_POWERTX_RATE6_POWERTXHT20_5_S
 8

	)

1263 
	#AR_PHY_POWERTX_RATE8
 (
AR_SM_BASE
 + 0x1dc)

	)

1264 
	#AR_PHY_POWERTX_RATE8_POWERTXHT40_5
 0x3F00

	)

1265 
	#AR_PHY_POWERTX_RATE8_POWERTXHT40_5_S
 8

	)

1267 
	#AR_PHY_CL_TAB_CL_GAIN_MOD
 0x1f

	)

1268 
	#AR_PHY_CL_TAB_CL_GAIN_MOD_S
 0

	)

1270 
	#AR_BTCOEX_WL_LNADIV
 0x1a64

	)

1271 
	#AR_BTCOEX_WL_LNADIV_PREDICTED_PERIOD
 0x00003FFF

	)

1272 
	#AR_BTCOEX_WL_LNADIV_PREDICTED_PERIOD_S
 0

	)

1273 
	#AR_BTCOEX_WL_LNADIV_DPDT_IGNORE_PRIORITY
 0x00004000

	)

1274 
	#AR_BTCOEX_WL_LNADIV_DPDT_IGNORE_PRIORITY_S
 14

	)

1275 
	#AR_BTCOEX_WL_LNADIV_FORCE_ON
 0x00008000

	)

1276 
	#AR_BTCOEX_WL_LNADIV_FORCE_ON_S
 15

	)

1277 
	#AR_BTCOEX_WL_LNADIV_MODE_OPTION
 0x00030000

	)

1278 
	#AR_BTCOEX_WL_LNADIV_MODE_OPTION_S
 16

	)

1279 
	#AR_BTCOEX_WL_LNADIV_MODE
 0x007c0000

	)

1280 
	#AR_BTCOEX_WL_LNADIV_MODE_S
 18

	)

1281 
	#AR_BTCOEX_WL_LNADIV_ALLOWED_TX_ANTDIV_WL_TX_REQ
 0x00800000

	)

1282 
	#AR_BTCOEX_WL_LNADIV_ALLOWED_TX_ANTDIV_WL_TX_REQ_S
 23

	)

1283 
	#AR_BTCOEX_WL_LNADIV_DISABLE_TX_ANTDIV_ENABLE
 0x01000000

	)

1284 
	#AR_BTCOEX_WL_LNADIV_DISABLE_TX_ANTDIV_ENABLE_S
 24

	)

1285 
	#AR_BTCOEX_WL_LNADIV_CONTINUOUS_BT_ACTIVE_PROTECT
 0x02000000

	)

1286 
	#AR_BTCOEX_WL_LNADIV_CONTINUOUS_BT_ACTIVE_PROTECT_S
 25

	)

1287 
	#AR_BTCOEX_WL_LNADIV_BT_INACTIVE_THRESHOLD
 0xFC000000

	)

1288 
	#AR_BTCOEX_WL_LNADIV_BT_INACTIVE_THRESHOLD_S
 26

	)

1291 
	#AR_PHY_65NM_BASE
 0x16000

	)

1292 
	#AR_PHY_65NM_RXRF_GAINSTAGES
(
i
Ë(
AR_PHY_65NM_BASE
 + \

1293 (
i
 * 0x400Ë+ 0x8)

	)

1294 
	#AR_PHY_65NM_RXRF_GAINSTAGES_RX_OVERRIDE
 0x80000000

	)

1295 
	#AR_PHY_65NM_RXRF_GAINSTAGES_RX_OVERRIDE_S
 31

	)

1296 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNAON_CALDC
 0x00000002

	)

1297 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNAON_CALDC_S
 1

	)

1298 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNA2G_GAIN_OVR
 0x70000000

	)

1299 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNA2G_GAIN_OVR_S
 28

	)

1300 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNA5G_GAIN_OVR
 0x03800000

	)

1301 
	#AR_PHY_65NM_RXRF_GAINSTAGES_LNA5G_GAIN_OVR_S
 23

	)

1303 
	#AR_PHY_65NM_RXTX2
(
i
Ë(
AR_PHY_65NM_BASE
 + \

1304 (
i
 * 0x400Ë+ 0x104)

	)

1305 
	#AR_PHY_65NM_RXTX2_RXON_OVR
 0x00001000

	)

1306 
	#AR_PHY_65NM_RXTX2_RXON_OVR_S
 12

	)

1307 
	#AR_PHY_65NM_RXTX2_RXON
 0x00000800

	)

1308 
	#AR_PHY_65NM_RXTX2_RXON_S
 11

	)

1310 
	#AR_PHY_65NM_RXRF_AGC
(
i
Ë(
AR_PHY_65NM_BASE
 + \

1311 (
i
 * 0x400Ë+ 0xc)

	)

1312 
	#AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE
 0x80000000

	)

1313 
	#AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE_S
 31

	)

1314 
	#AR_PHY_65NM_RXRF_AGC_AGC_ON_OVR
 0x40000000

	)

1315 
	#AR_PHY_65NM_RXRF_AGC_AGC_ON_OVR_S
 30

	)

1316 
	#AR_PHY_65NM_RXRF_AGC_AGC_CAL_OVR
 0x20000000

	)

1317 
	#AR_PHY_65NM_RXRF_AGC_AGC_CAL_OVR_S
 29

	)

1318 
	#AR_PHY_65NM_RXRF_AGC_AGC2G_DBDAC_OVR
 0x1E000000

	)

1319 
	#AR_PHY_65NM_RXRF_AGC_AGC2G_DBDAC_OVR_S
 25

	)

1320 
	#AR_PHY_65NM_RXRF_AGC_AGC5G_DBDAC_OVR
 0x00078000

	)

1321 
	#AR_PHY_65NM_RXRF_AGC_AGC5G_DBDAC_OVR_S
 15

	)

1322 
	#AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
 0x01F80000

	)

1323 
	#AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR_S
 19

	)

1324 
	#AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
 0x00007e00

	)

1325 
	#AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR_S
 9

	)

1326 
	#AR_PHY_65NM_RXRF_AGC_AGC_OUT
 0x00000004

	)

1327 
	#AR_PHY_65NM_RXRF_AGC_AGC_OUT_S
 2

	)

1329 
	#AR9300_DFS_FIRPWR
 -28

	)

	@ar9003_rtt.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~"¨9003_phy.h
"

20 
	~"¨9003_πt.h
"

22 
	#RTT_RESTORE_TIMEOUT
 1000

	)

23 
	#RTT_ACCESS_TIMEOUT
 100

	)

24 
	#RTT_BAD_VALUE
 0x0bad0bad

	)

38 
	$¨9003_hw_πt_íabÀ
(
©h_hw
 *
ah
)

40 
	`REG_WRITE
(
ah
, 
AR_PHY_RTT_CTRL
, 1);

41 
	}
}

43 
	$¨9003_hw_πt_dißbÀ
(
©h_hw
 *
ah
)

45 
	`REG_WRITE
(
ah
, 
AR_PHY_RTT_CTRL
, 0);

46 
	}
}

48 
	$¨9003_hw_πt_£t_mask
(
©h_hw
 *
ah
, 
u32
 
πt_mask
)

50 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RTT_CTRL
,

51 
AR_PHY_RTT_CTRL_RESTORE_MASK
, 
πt_mask
);

52 
	}
}

54 
boﬁ
 
	$¨9003_hw_πt_f‹˚_ª°‹e
(
©h_hw
 *
ah
)

56 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_RTT_CTRL
,

57 
AR_PHY_RTT_CTRL_FORCE_RADIO_RESTORE
,

58 0, 
RTT_RESTORE_TIMEOUT
))

59  
Ál£
;

61 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RTT_CTRL
,

62 
AR_PHY_RTT_CTRL_FORCE_RADIO_RESTORE
, 1);

64 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_PHY_RTT_CTRL
,

65 
AR_PHY_RTT_CTRL_FORCE_RADIO_RESTORE
,

66 0, 
RTT_RESTORE_TIMEOUT
))

67  
Ál£
;

69  
åue
;

70 
	}
}

72 
	$¨9003_hw_πt_lﬂd_hi°_íåy
(
©h_hw
 *
ah
, 
u8
 
chaö
,

73 
u32
 
ödex
, u32 
d©a28
)

75 
u32
 
vÆ
;

77 
vÆ
 = 
	`SM
(
d©a28
, 
AR_PHY_RTT_SW_RTT_TABLE_DATA
);

78 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_1_B
(
chaö
), 
vÆ
);

80 
vÆ
 = 
	`SM
(0, 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
) |

81 
	`SM
(1, 
AR_PHY_RTT_SW_RTT_TABLE_WRITE
) |

82 
	`SM
(
ödex
, 
AR_PHY_RTT_SW_RTT_TABLE_ADDR
);

83 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
), 
vÆ
);

84 
	`udñay
(1);

86 
vÆ
 |
	`SM
(1, 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
);

87 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
), 
vÆ
);

88 
	`udñay
(1);

90 i‡(!
	`©h9k_hw_waô
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
),

91 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
, 0,

92 
RTT_ACCESS_TIMEOUT
))

95 
vÆ
 &~
	`SM
(1, 
AR_PHY_RTT_SW_RTT_TABLE_WRITE
);

96 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
), 
vÆ
);

97 
	`udñay
(1);

99 
	`©h9k_hw_waô
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
),

100 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
, 0,

101 
RTT_ACCESS_TIMEOUT
);

102 
	}
}

104 
	$¨9003_hw_πt_lﬂd_hi°
(
©h_hw
 *
ah
)

106 
chaö
, 
i
;

108 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

109 i‡(!(
ah
->
ˇps
.
rx_chaömask
 & (1 << 
chaö
)))

111 
i
 = 0; i < 
MAX_RTT_TABLE_ENTRY
; i++) {

112 
	`¨9003_hw_πt_lﬂd_hi°_íåy
(
ah
, 
chaö
, 
i
,

113 
ah
->
ˇld©a
->
πt_èbÀ
[
chaö
][
i
]);

114 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

116 
i
, 
chaö
, 
ah
->
ˇld©a
->
πt_èbÀ
[chain][i]);

119 
	}
}

121 
	$¨9003_hw_∑tch_πt
(
©h_hw
 *
ah
, 
ödex
, 
chaö
)

123 
agc
, 
ˇldac
;

125 i‡(!
	`ã°_bô
(
SW_PKDET_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
))

128 i‡((
ödex
 !5Ë|| (
chaö
 >= 2))

131 
agc
 = 
	`REG_READ_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(
chaö
),

132 
AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE
);

133 i‡(!
agc
)

136 
ˇldac
 = 
ah
->
ˇld©a
->ˇldac[
chaö
];

137 
ah
->
ˇld©a
->
πt_èbÀ
[
chaö
][
ödex
] &= 0xFFFF05FF;

138 
ˇldac
 = (caldac & 0x20) | ((caldac & 0x1F) << 7);

139 
ah
->
ˇld©a
->
πt_èbÀ
[
chaö
][
ödex
] |(
ˇldac
 << 4);

140 
	}
}

142 
	$¨9003_hw_πt_fûl_hi°_íåy
(
©h_hw
 *
ah
, 
u8
 
chaö
, 
u32
 
ödex
)

144 
u32
 
vÆ
;

146 
vÆ
 = 
	`SM
(0, 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
) |

147 
	`SM
(0, 
AR_PHY_RTT_SW_RTT_TABLE_WRITE
) |

148 
	`SM
(
ödex
, 
AR_PHY_RTT_SW_RTT_TABLE_ADDR
);

150 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
), 
vÆ
);

151 
	`udñay
(1);

153 
vÆ
 |
	`SM
(1, 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
);

154 
	`REG_WRITE
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
), 
vÆ
);

155 
	`udñay
(1);

157 i‡(!
	`©h9k_hw_waô
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_B
(
chaö
),

158 
AR_PHY_RTT_SW_RTT_TABLE_ACCESS
, 0,

159 
RTT_ACCESS_TIMEOUT
))

160  
RTT_BAD_VALUE
;

162 
vÆ
 = 
	`MS
(
	`REG_READ
(
ah
, 
	`AR_PHY_RTT_TABLE_SW_INTF_1_B
(
chaö
)),

163 
AR_PHY_RTT_SW_RTT_TABLE_DATA
);

166  
vÆ
;

167 
	}
}

169 
	$¨9003_hw_πt_fûl_hi°
(
©h_hw
 *
ah
)

171 
chaö
, 
i
;

173 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

174 i‡(!(
ah
->
ˇps
.
rx_chaömask
 & (1 << 
chaö
)))

176 
i
 = 0; i < 
MAX_RTT_TABLE_ENTRY
; i++) {

177 
ah
->
ˇld©a
->
πt_èbÀ
[
chaö
][
i
] =

178 
	`¨9003_hw_πt_fûl_hi°_íåy
(
ah
, 
chaö
, 
i
);

180 
	`¨9003_hw_∑tch_πt
(
ah
, 
i
, 
chaö
);

182 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CALIBRATE
,

184 
i
, 
chaö
, 
ah
->
ˇld©a
->
πt_èbÀ
[chain][i]);

188 
	`£t_bô
(
RTT_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
);

189 
	}
}

191 
	$¨9003_hw_πt_˛ór_hi°
(
©h_hw
 *
ah
)

193 
chaö
, 
i
;

195 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

196 i‡(!(
ah
->
ˇps
.
rx_chaömask
 & (1 << 
chaö
)))

198 
i
 = 0; i < 
MAX_RTT_TABLE_ENTRY
; i++)

199 
	`¨9003_hw_πt_lﬂd_hi°_íåy
(
ah
, 
chaö
, 
i
, 0);

202 i‡(
ah
->
ˇld©a
)

203 
	`˛ór_bô
(
RTT_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
);

204 
	}
}

206 
boﬁ
 
	$¨9003_hw_πt_ª°‹e
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

208 
boﬁ
 
ª°‹e
;

210 i‡(!
ah
->
ˇld©a
)

211  
Ál£
;

213 i‡(
	`ã°_bô
(
SW_PKDET_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
)) {

214 i‡(
	`IS_CHAN_2GHZ
(
ch™
)){

215 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(0),

216 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
,

217 
ah
->
ˇld©a
->
ˇldac
[0]);

218 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(1),

219 
AR_PHY_65NM_RXRF_AGC_AGC2G_CALDAC_OVR
,

220 
ah
->
ˇld©a
->
ˇldac
[1]);

222 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(0),

223 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
,

224 
ah
->
ˇld©a
->
ˇldac
[0]);

225 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(1),

226 
AR_PHY_65NM_RXRF_AGC_AGC5G_CALDAC_OVR
,

227 
ah
->
ˇld©a
->
ˇldac
[1]);

229 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(1),

230 
AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE
, 0x1);

231 
	`REG_RMW_FIELD
(
ah
, 
	`AR_PHY_65NM_RXRF_AGC
(0),

232 
AR_PHY_65NM_RXRF_AGC_AGC_OVERRIDE
, 0x1);

235 i‡(!
	`ã°_bô
(
RTT_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
))

236  
Ál£
;

238 
	`¨9003_hw_πt_íabÀ
(
ah
);

240 i‡(
	`ã°_bô
(
SW_PKDET_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
))

241 
	`¨9003_hw_πt_£t_mask
(
ah
, 0x30);

243 
	`¨9003_hw_πt_£t_mask
(
ah
, 0x10);

245 i‡(!
	`©h9k_hw_rfbus_ªq
(
ah
)) {

246 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
), "CouldÇot stop baseband\n");

247 
ª°‹e
 = 
Ál£
;

248 
Áû
;

251 
	`¨9003_hw_πt_lﬂd_hi°
(
ah
);

252 
ª°‹e
 = 
	`¨9003_hw_πt_f‹˚_ª°‹e
(
ah
);

254 
Áû
:

255 
	`©h9k_hw_rfbus_d⁄e
(
ah
);

256 
	`¨9003_hw_πt_dißbÀ
(
ah
);

257  
ª°‹e
;

258 
	}
}

	@ar9003_rtt.h

17 #i‚de‡
AR9003_RTT_H


18 
	#AR9003_RTT_H


	)

20 #ifde‡
CPTCFG_ATH9K_PCOEM


21 
¨9003_hw_πt_íabÀ
(
©h_hw
 *
ah
);

22 
¨9003_hw_πt_dißbÀ
(
©h_hw
 *
ah
);

23 
¨9003_hw_πt_£t_mask
(
©h_hw
 *
ah
, 
u32
 
πt_mask
);

24 
boﬁ
 
¨9003_hw_πt_f‹˚_ª°‹e
(
©h_hw
 *
ah
);

25 
¨9003_hw_πt_lﬂd_hi°
(
©h_hw
 *
ah
);

26 
¨9003_hw_πt_fûl_hi°
(
©h_hw
 *
ah
);

27 
¨9003_hw_πt_˛ór_hi°
(
©h_hw
 *
ah
);

28 
boﬁ
 
¨9003_hw_πt_ª°‹e
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

30 
ölöe
 
	$¨9003_hw_πt_íabÀ
(
©h_hw
 *
ah
)

32 
	}
}

34 
ölöe
 
	$¨9003_hw_πt_dißbÀ
(
©h_hw
 *
ah
)

36 
	}
}

38 
ölöe
 
	$¨9003_hw_πt_£t_mask
(
©h_hw
 *
ah
, 
u32
 
πt_mask
)

40 
	}
}

42 
ölöe
 
boﬁ
 
	$¨9003_hw_πt_f‹˚_ª°‹e
(
©h_hw
 *
ah
)

44  
Ál£
;

45 
	}
}

47 
ölöe
 
	$¨9003_hw_πt_lﬂd_hi°
(
©h_hw
 *
ah
)

49 
	}
}

51 
ölöe
 
	$¨9003_hw_πt_fûl_hi°
(
©h_hw
 *
ah
)

53 
	}
}

55 
ölöe
 
	$¨9003_hw_πt_˛ór_hi°
(
©h_hw
 *
ah
)

57 
	}
}

59 
ölöe
 
boﬁ
 
	$¨9003_hw_πt_ª°‹e
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

61  
Ál£
;

62 
	}
}

	@ar9003_wow.c

17 
	~<löux/exp‹t.h
>

18 
	~"©h9k.h
"

19 
	~"ªg.h
"

20 
	~"ªg_wow.h
"

21 
	~"hw-›s.h
"

23 
	$©h9k_hw_£t_°a_powîßve
(
©h_hw
 *
ah
)

25 i‡(!
	`©h9k_hw_mci_is_íabÀd
(
ah
))

26 
£t
;

31 i‡(
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_GET_WLAN_PS_STATE
Ë!
MCI_PS_DISABLE
)

33 
£t
:

34 
	`REG_SET_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PWR_SAV
);

35 
	}
}

37 
	$©h9k_hw_£t_powîmode_wow_¶ìp
(
©h_hw
 *
ah
)

39 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

41 
	`©h9k_hw_£t_°a_powîßve
(
ah
);

44 
	`REG_WRITE
(
ah
, 
AR_CR
, 
AR_CR_RXD
);

46 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_CR
, 
AR_CR_RXE
, 0, 
AH_WAIT_TIMEOUT
)) {

47 
	`©h_îr
(
comm⁄
, "FailedÅo stop Rx DMA in 10ms AR_CR=0x%08x AR_DIAG_SW=0x%08x\n",

48 
	`REG_READ
(
ah
, 
AR_CR
), REG_READ◊h, 
AR_DIAG_SW
));

52 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

53 i‡(!
	`REG_READ
(
ah
, 
AR_MAC_PCU_GEN_TIMER_TSF_SEL
))

54 
	`REG_CLR_BIT
(
ah
, 
AR_DIRECT_CONNECT
, 
AR_DC_TSF2_ENABLE
);

55 } i‡(
	`AR_SREV_9485
(
ah
)){

56 i‡(!(
	`REG_READ
(
ah
, 
AR_NDP2_TIMER_MODE
) &

57 
AR_GEN_TIMERS2_MODE_ENABLE_MASK
))

58 
	`REG_CLR_BIT
(
ah
, 
AR_DIRECT_CONNECT
, 
AR_DC_TSF2_ENABLE
);

61 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

62 
	`REG_WRITE
(
ah
, 
AR_RTC_KEEP_AWAKE
, 0x2);

64 
	`REG_WRITE
(
ah
, 
AR_RTC_FORCE_WAKE
, 
AR_RTC_FORCE_WAKE_ON_INT
);

65 
	}
}

67 
	$©h9k_wow_¸óã_kìp_Æive_∑âîn
(
©h_hw
 *
ah
)

69 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

70 
u8
 
°a_mac_addr
[
ETH_ALEN
], 
≠_mac_addr
[ETH_ALEN];

71 
u32
 
˘l
[13] = {0};

72 
u32
 
d©a_w‹d
[
KAL_NUM_DATA_WORDS
];

73 
u8
 
i
;

74 
u32
 
wow_ka_d©a_w‹d0
;

76 
	`mem˝y
(
°a_mac_addr
, 
comm⁄
->
maˇddr
, 
ETH_ALEN
);

77 
	`mem˝y
(
≠_mac_addr
, 
comm⁄
->
curbssid
, 
ETH_ALEN
);

80 
˘l
[0] = (
KAL_FRAME_LEN
 | (
MAX_RATE_POWER
 << 16));

81 
˘l
[1] = 0;

82 
˘l
[4] = 0;

83 
˘l
[7] = (
ah
->
txchaömask
) << 2;

84 
˘l
[2] = 0xf << 16;

86 i‡(
	`IS_CHAN_2GHZ
(
ah
->
curch™
))

87 
˘l
[3] = 0x1b;

89 
˘l
[3] = 0xb;

91 
i
 = 0; i < 
KAL_NUM_DESC_WORDS
; i++)

92 
	`REG_WRITE
(
ah
, (
AR_WOW_KA_DESC_WORD2
 + 
i
 * 4), 
˘l
[i]);

94 
d©a_w‹d
[0] = (
KAL_FRAME_TYPE
 << 2Ë| (
KAL_FRAME_SUB_TYPE
 << 4) |

95 (
KAL_TO_DS
 << 8Ë| (
KAL_DURATION_ID
 << 16);

96 
d©a_w‹d
[1] = (
≠_mac_addr
[3] << 24) | (ap_mac_addr[2] << 16) |

97 (
≠_mac_addr
[1] << 8) | (ap_mac_addr[0]);

98 
d©a_w‹d
[2] = (
°a_mac_addr
[1] << 24) | (sta_mac_addr[0] << 16) |

99 (
≠_mac_addr
[5] << 8) | (ap_mac_addr[4]);

100 
d©a_w‹d
[3] = (
°a_mac_addr
[5] << 24) | (sta_mac_addr[4] << 16) |

101 (
°a_mac_addr
[3] << 8) | (sta_mac_addr[2]);

102 
d©a_w‹d
[4] = (
≠_mac_addr
[3] << 24) | (ap_mac_addr[2] << 16) |

103 (
≠_mac_addr
[1] << 8) | (ap_mac_addr[0]);

104 
d©a_w‹d
[5] = (
≠_mac_addr
[5] << 8) | (ap_mac_addr[4]);

106 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

111 
	`REG_WRITE
(
ah
, (
AR_WOW_KA_DESC_WORD2
 + (12 * 4)), 0);

112 
wow_ka_d©a_w‹d0
 = 
	`AR_WOW_TXBUF
(13);

114 
wow_ka_d©a_w‹d0
 = 
	`AR_WOW_TXBUF
(12);

117 
i
 = 0; i < 
KAL_NUM_DATA_WORDS
; i++)

118 
	`REG_WRITE
(
ah
, (
wow_ka_d©a_w‹d0
 + 
i
*4), 
d©a_w‹d
[i]);

119 
	}
}

121 
	$©h9k_hw_wow_≠∂y_∑âîn
(
©h_hw
 *
ah
, 
u8
 *
u£r_∑âîn
,

122 
u8
 *
u£r_mask
, 
∑âîn_cou¡
,

123 
∑âîn_Àn
)

125 
i
;

126 
u32
 
∑âîn_vÆ
, 
mask_vÆ
;

127 
u32
 
£t
, 
˛r
;

129 i‡(
∑âîn_cou¡
 >
ah
->
wow
.
max_∑âîns
)

130  -
ENOSPC
;

132 i‡(
∑âîn_cou¡
 < 
MAX_NUM_PATTERN_LEGACY
)

133 
	`REG_SET_BIT
(
ah
, 
AR_WOW_PATTERN
, 
	`BIT
(
∑âîn_cou¡
));

135 
	`REG_SET_BIT
(
ah
, 
AR_MAC_PCU_WOW4
, 
	`BIT
(
∑âîn_cou¡
 - 8));

137 
i
 = 0; i < 
MAX_PATTERN_SIZE
; i += 4) {

138 
	`mem˝y
(&
∑âîn_vÆ
, 
u£r_∑âîn
, 4);

139 
	`REG_WRITE
(
ah
, (
	`AR_WOW_TB_PATTERN
(
∑âîn_cou¡
Ë+ 
i
),

140 
∑âîn_vÆ
);

141 
u£r_∑âîn
 += 4;

144 
i
 = 0; i < 
MAX_PATTERN_MASK_SIZE
; i += 4) {

145 
	`mem˝y
(&
mask_vÆ
, 
u£r_mask
, 4);

146 
	`REG_WRITE
(
ah
, (
	`AR_WOW_TB_MASK
(
∑âîn_cou¡
Ë+ 
i
), 
mask_vÆ
);

147 
u£r_mask
 += 4;

150 i‡(
∑âîn_cou¡
 < 
MAX_NUM_PATTERN_LEGACY
)

151 
ah
->
wow
.
wow_evít_mask
 |=

152 
	`BIT
(
∑âîn_cou¡
 + 
AR_WOW_PAT_FOUND_SHIFT
);

154 
ah
->
wow
.
wow_evít_mask2
 |=

155 
	`BIT
((
∑âîn_cou¡
 - 8Ë+ 
AR_WOW_PAT_FOUND_SHIFT
);

157 i‡(
∑âîn_cou¡
 < 4) {

158 
£t
 = (
∑âîn_Àn
 & 
AR_WOW_LENGTH_MAX
) <<

159 
	`AR_WOW_LEN1_SHIFT
(
∑âîn_cou¡
);

160 
˛r
 = 
	`AR_WOW_LENGTH1_MASK
(
∑âîn_cou¡
);

161 
	`REG_RMW
(
ah
, 
AR_WOW_LENGTH1
, 
£t
, 
˛r
);

162 } i‡(
∑âîn_cou¡
 < 8) {

163 
£t
 = (
∑âîn_Àn
 & 
AR_WOW_LENGTH_MAX
) <<

164 
	`AR_WOW_LEN2_SHIFT
(
∑âîn_cou¡
);

165 
˛r
 = 
	`AR_WOW_LENGTH2_MASK
(
∑âîn_cou¡
);

166 
	`REG_RMW
(
ah
, 
AR_WOW_LENGTH2
, 
£t
, 
˛r
);

167 } i‡(
∑âîn_cou¡
 < 12) {

168 
£t
 = (
∑âîn_Àn
 & 
AR_WOW_LENGTH_MAX
) <<

169 
	`AR_WOW_LEN3_SHIFT
(
∑âîn_cou¡
);

170 
˛r
 = 
	`AR_WOW_LENGTH3_MASK
(
∑âîn_cou¡
);

171 
	`REG_RMW
(
ah
, 
AR_WOW_LENGTH3
, 
£t
, 
˛r
);

172 } i‡(
∑âîn_cou¡
 < 
MAX_NUM_PATTERN
) {

173 
£t
 = (
∑âîn_Àn
 & 
AR_WOW_LENGTH_MAX
) <<

174 
	`AR_WOW_LEN4_SHIFT
(
∑âîn_cou¡
);

175 
˛r
 = 
	`AR_WOW_LENGTH4_MASK
(
∑âîn_cou¡
);

176 
	`REG_RMW
(
ah
, 
AR_WOW_LENGTH4
, 
£t
, 
˛r
);

180 
	}
}

181 
EXPORT_SYMBOL
(
©h9k_hw_wow_≠∂y_∑âîn
);

183 
u32
 
	$©h9k_hw_wow_wakeup
(
©h_hw
 *
ah
)

185 
u32
 
wow_°©us
 = 0;

186 
u32
 
vÆ
 = 0, 
rvÆ
;

192 
rvÆ
 = 
	`REG_READ
(
ah
, 
AR_WOW_PATTERN
);

193 
vÆ
 = 
	`AR_WOW_STATUS
(
rvÆ
);

200 
vÆ
 &
ah
->
wow
.
wow_evít_mask
;

202 i‡(
vÆ
) {

203 i‡(
vÆ
 & 
AR_WOW_MAGIC_PAT_FOUND
)

204 
wow_°©us
 |
AH_WOW_MAGIC_PATTERN_EN
;

205 i‡(
	`AR_WOW_PATTERN_FOUND
(
vÆ
))

206 
wow_°©us
 |
AH_WOW_USER_PATTERN_EN
;

207 i‡(
vÆ
 & 
AR_WOW_KEEP_ALIVE_FAIL
)

208 
wow_°©us
 |
AH_WOW_LINK_CHANGE
;

209 i‡(
vÆ
 & 
AR_WOW_BEACON_FAIL
)

210 
wow_°©us
 |
AH_WOW_BEACON_MISS
;

213 
rvÆ
 = 
	`REG_READ
(
ah
, 
AR_MAC_PCU_WOW4
);

214 
vÆ
 = 
	`AR_WOW_STATUS2
(
rvÆ
);

215 
vÆ
 &
ah
->
wow
.
wow_evít_mask2
;

217 i‡(
vÆ
) {

218 i‡(
	`AR_WOW2_PATTERN_FOUND
(
vÆ
))

219 
wow_°©us
 |
AH_WOW_USER_PATTERN_EN
;

229 
	`REG_RMW
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PMCTRL_WOW_PME_CLR
,

230 
AR_PMCTRL_PWR_STATE_D1D3
);

235 
	`REG_WRITE
(
ah
, 
AR_WOW_PATTERN
,

236 
	`AR_WOW_CLEAR_EVENTS
(
	`REG_READ
(
ah
, 
AR_WOW_PATTERN
)));

237 
	`REG_WRITE
(
ah
, 
AR_MAC_PCU_WOW4
,

238 
	`AR_WOW_CLEAR_EVENTS2
(
	`REG_READ
(
ah
, 
AR_MAC_PCU_WOW4
)));

243 
	`REG_WRITE
(
ah
, 
AR_RSSI_THR
, 
INIT_RSSI_THR
);

252 i‡(
ah
->
is_pcõx¥ess
)

253 
	`©h9k_hw_c⁄figpcùowîßve
(
ah
, 
Ál£
);

255 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊hË|| 
	`AR_SREV_9485
(ah)) {

256 
u32
 
dc
 = 
	`REG_READ
(
ah
, 
AR_DIRECT_CONNECT
);

258 i‡(!(
dc
 & 
AR_DC_TSF2_ENABLE
))

259 
	`©h9k_hw_gí_timî_°¨t_tsf2
(
ah
);

262 
ah
->
wow
.
wow_evít_mask
 = 0;

263 
ah
->
wow
.
wow_evít_mask2
 = 0;

265  
wow_°©us
;

266 
	}
}

267 
EXPORT_SYMBOL
(
©h9k_hw_wow_wakeup
);

269 
	$©h9k_hw_wow_£t_¨wr_ªg
(
©h_hw
 *
ah
)

271 
u32
 
wa_ªg
;

273 i‡(!
ah
->
is_pcõx¥ess
)

281 
wa_ªg
 = 
	`REG_READ
(
ah
, 
AR_WA
);

282 
wa_ªg
 &~
AR_WA_UNTIE_RESET_EN
;

283 
wa_ªg
 |
AR_WA_RESET_EN
;

284 
wa_ªg
 |
AR_WA_POR_SHORT
;

286 
	`REG_WRITE
(
ah
, 
AR_WA
, 
wa_ªg
);

287 
	}
}

289 
	$©h9k_hw_wow_íabÀ
(
©h_hw
 *
ah
, 
u32
 
∑âîn_íabÀ
)

291 
u32
 
wow_evít_mask
;

292 
u32
 
kìp_Æive
, 
magic_∑âîn
, 
ho°_pm_˘æ
;

294 
wow_evít_mask
 = 
ah
->
wow
.wow_event_mask;

312 
	`REG_SET_BIT
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PMCTRL_HOST_PME_EN
 |

313 
AR_PMCTRL_PWR_PM_CTRL_ENA
 |

314 
AR_PMCTRL_AUX_PWR_DET
 |

315 
AR_PMCTRL_WOW_PME_CLR
);

316 
	`REG_CLR_BIT
(
ah
, 
AR_PCIE_PM_CTRL
, 
AR_PMCTRL_WOW_PME_CLR
);

326 
	`REG_SET_BIT
(
ah
, 
AR_WOW_PATTERN
,

327 
	`AR_WOW_BACK_OFF_SHIFT
(
AR_WOW_PAT_BACKOFF
));

332 
	`REG_SET_BIT
(
ah
, 
AR_WOW_COUNT
, 
	`AR_WOW_AIFS_CNT
(
AR_WOW_CNT_AIFS_CNT
) |

333 
	`AR_WOW_SLOT_CNT
(
AR_WOW_CNT_SLOT_CNT
) |

334 
	`AR_WOW_KEEP_ALIVE_CNT
(
AR_WOW_CNT_KA_CNT
));

338 i‡(
∑âîn_íabÀ
 & 
AH_WOW_BEACON_MISS
)

339 
	`REG_WRITE
(
ah
, 
AR_WOW_BCN_TIMO
, 
AR_WOW_BEACON_TIMO
);

341 
	`REG_WRITE
(
ah
, 
AR_WOW_BCN_TIMO
, 
AR_WOW_BEACON_TIMO_MAX
);

346 i‡(!
∑âîn_íabÀ
)

347 
	`REG_WRITE
(
ah
, 
AR_WOW_KEEP_ALIVE_TIMO
, 
AR_WOW_KEEP_ALIVE_NEVER
);

349 
	`REG_WRITE
(
ah
, 
AR_WOW_KEEP_ALIVE_TIMO
, 
KAL_TIMEOUT
 * 32);

354 
	`REG_WRITE
(
ah
, 
AR_WOW_KEEP_ALIVE_DELAY
, 
KAL_DELAY
 * 1000);

359 
	`©h9k_wow_¸óã_kìp_Æive_∑âîn
(
ah
);

364 
kìp_Æive
 = 
	`REG_READ
(
ah
, 
AR_WOW_KEEP_ALIVE
);

367 
kìp_Æive
 &~
AR_WOW_KEEP_ALIVE_AUTO_DIS
;

369 i‡(
∑âîn_íabÀ
 & 
AH_WOW_LINK_CHANGE
) {

370 
kìp_Æive
 &~
AR_WOW_KEEP_ALIVE_FAIL_DIS
;

371 
wow_evít_mask
 |
AR_WOW_KEEP_ALIVE_FAIL
;

373 
kìp_Æive
 |
AR_WOW_KEEP_ALIVE_FAIL_DIS
;

376 
	`REG_WRITE
(
ah
, 
AR_WOW_KEEP_ALIVE
, 
kìp_Æive
);

382 
	`REG_RMW_FIELD
(
ah
, 
AR_RSSI_THR
, 
AR_RSSI_THR_BM_THR
,

383 
AR_WOW_BMISSTHRESHOLD
);

385 i‡(
∑âîn_íabÀ
 & 
AH_WOW_BEACON_MISS
) {

386 
wow_evít_mask
 |
AR_WOW_BEACON_FAIL
;

387 
	`REG_SET_BIT
(
ah
, 
AR_WOW_BCN_EN
, 
AR_WOW_BEACON_FAIL_EN
);

389 
	`REG_CLR_BIT
(
ah
, 
AR_WOW_BCN_EN
, 
AR_WOW_BEACON_FAIL_EN
);

395 
magic_∑âîn
 = 
	`REG_READ
(
ah
, 
AR_WOW_PATTERN
);

396 
magic_∑âîn
 |
AR_WOW_MAC_INTR_EN
;

398 i‡(
∑âîn_íabÀ
 & 
AH_WOW_MAGIC_PATTERN_EN
) {

399 
magic_∑âîn
 |
AR_WOW_MAGIC_EN
;

400 
wow_evít_mask
 |
AR_WOW_MAGIC_PAT_FOUND
;

402 
magic_∑âîn
 &~
AR_WOW_MAGIC_EN
;

405 
	`REG_WRITE
(
ah
, 
AR_WOW_PATTERN
, 
magic_∑âîn
);

411 
	`REG_WRITE
(
ah
, 
AR_WOW_PATTERN_MATCH_LT_256B
,

412 
AR_WOW_PATTERN_SUPPORTED
);

417 
ho°_pm_˘æ
 = 
	`REG_READ
(
ah
, 
AR_PCIE_PM_CTRL
);

418 
ho°_pm_˘æ
 |
AR_PMCTRL_PWR_STATE_D1D3
 |

419 
AR_PMCTRL_HOST_PME_EN
 |

420 
AR_PMCTRL_PWR_PM_CTRL_ENA
;

421 
ho°_pm_˘æ
 &~
AR_PCIE_PM_CTRL_ENA
;

423 i‡(
	`AR_SREV_9462
(
ah
)) {

429 
ho°_pm_˘æ
 &~
AR_PMCTRL_PWR_STATE_D1D3
;

430 
ho°_pm_˘æ
 |
AR_PMCTRL_PWR_STATE_D1D3_REAL
;

433 
	`REG_WRITE
(
ah
, 
AR_PCIE_PM_CTRL
, 
ho°_pm_˘æ
);

438 
	`REG_CLR_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PRESERVE_SEQNUM
);

441 
	`REG_SET_BIT
(
ah
, 
AR_PCIE_PHY_REG3
, 
	`BIT
(13));

443 
	`©h9k_hw_wow_£t_¨wr_ªg
(
ah
);

445 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

446 
	`REG_WRITE
(
ah
, 
AR_RTC_KEEP_AWAKE
, 0x2);

449 
	`REG_CLR_BIT
(
ah
, 
AR_PCU_MISC_MODE3
, 
	`BIT
(5));

451 
	`©h9k_hw_£t_powîmode_wow_¶ìp
(
ah
);

452 
ah
->
wow
.
wow_evít_mask
 = wow_event_mask;

453 
	}
}

454 
EXPORT_SYMBOL
(
©h9k_hw_wow_íabÀ
);

	@ar9330_1p1_initvals.h

18 #i‚de‡
INITVALS_9330_1P1_H


19 
	#INITVALS_9330_1P1_H


	)

21 
	#¨9331_1p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

23 
	#¨9331_modes_high_powî_tx_gaö_1p1
 
¨9331_modes_lowe°_ob_db_tx_gaö_1p1


	)

25 c⁄° 
u32
 
	g¨9331_1p1_ba£b™d_po°ambÀ
[][5] = {

70 c⁄° 
u32
 
	g¨9331_modes_lowe°_ob_db_tx_gaö_1p1
[][5] = {

162 c⁄° 
u32
 
	g¨9331_modes_high_ob_db_tx_gaö_1p1
[][5] = {

252 c⁄° 
u32
 
	g¨9331_modes_low_ob_db_tx_gaö_1p1
[][5] = {

344 c⁄° 
u32
 
	g¨9331_1p1_xèl_25M
[][2] = {

352 c⁄° 
u32
 
	g¨9331_1p1_ødio_c‹e
[][2] = {

417 c⁄° 
u32
 
	g¨9331_1p1_soc_po°ambÀ
[][5] = {

422 c⁄° 
u32
 
	g¨9331_comm⁄_wo_x a_rx_gaö_1p1
[][2] = {

554 c⁄° 
u32
 
	g¨9331_1p1_ba£b™d_c‹e
[][2] = {

691 c⁄° 
u32
 
	g¨9331_1p1_mac_po°ambÀ
[][5] = {

703 c⁄° 
u32
 
	g¨9331_1p1_soc_¥ómbÀ
[][2] = {

710 c⁄° 
u32
 
	g¨9331_1p1_xèl_40M
[][2] = {

718 c⁄° 
u32
 
	g¨9331_1p1_mac_c‹e
[][2] = {

880 c⁄° 
u32
 
	g¨9331_comm⁄_rx_gaö_1p1
[][2] = {

1013 c⁄° 
u32
 
	g¨9331_comm⁄_tx_gaö_off£t1_1
[][1] = {

	@ar9330_1p2_initvals.h

18 #i‚de‡
INITVALS_9330_1P2_H


19 
	#INITVALS_9330_1P2_H


	)

21 
	#¨9331_modes_high_powî_tx_gaö_1p2
 
¨9331_modes_high_ob_db_tx_gaö_1p2


	)

23 
	#¨9331_modes_low_ob_db_tx_gaö_1p2
 
¨9331_modes_high_ob_db_tx_gaö_1p2


	)

25 
	#¨9331_modes_lowe°_ob_db_tx_gaö_1p2
 
¨9331_modes_high_ob_db_tx_gaö_1p2


	)

27 
	#¨9331_1p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9331_1p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

29 
	#¨9331_1p2_xèl_25M
 
¨9331_1p1_xèl_25M


	)

31 
	#¨9331_1p2_xèl_40M
 
¨9331_1p1_xèl_40M


	)

33 
	#¨9331_1p2_soc_po°ambÀ
 
¨9331_1p1_soc_po°ambÀ


	)

35 
	#¨9331_1p2_mac_po°ambÀ
 
¨9331_1p1_mac_po°ambÀ


	)

37 
	#¨9331_1p2_soc_¥ómbÀ
 
¨9331_1p1_soc_¥ómbÀ


	)

39 
	#¨9331_1p2_mac_c‹e
 
¨9331_1p1_mac_c‹e


	)

41 
	#¨9331_comm⁄_wo_x a_rx_gaö_1p2
 
¨9331_comm⁄_wo_x a_rx_gaö_1p1


	)

43 c⁄° 
u32
 
	g¨9331_modes_high_ob_db_tx_gaö_1p2
[][5] = {

128 c⁄° 
u32
 
	g¨9331_1p2_ødio_c‹e
[][2] = {

193 c⁄° 
u32
 
	g¨9331_1p2_ba£b™d_c‹e
[][2] = {

330 c⁄° 
u32
 
	g¨9331_1p2_ba£b™d_po°ambÀ
[][5] = {

375 c⁄° 
u32
 
	g¨9331_comm⁄_rx_gaö_1p2
[][2] = {

	@ar9340_initvals.h

18 #i‚de‡
INITVALS_9340_H


19 
	#INITVALS_9340_H


	)

21 
	#¨9340_1p0_mac_po°ambÀ
 
¨9300_2p2_mac_po°ambÀ


	)

23 
	#¨9340_1p0_soc_po°ambÀ
 
¨9300_2p2_soc_po°ambÀ


	)

25 
	#¨9340Modes_Á°_˛ock_1p0
 
¨9300Modes_Á°_˛ock_2p2


	)

27 
	#¨9340Comm⁄_rx_gaö_èbÀ_1p0
 
¨9300Comm⁄_rx_gaö_èbÀ_2p2


	)

29 
	#¨9340Comm⁄_wo_x a_rx_gaö_èbÀ_1p0
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

31 
	#¨9340_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

33 
	#¨9340_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
 
¨9300_2p2_ba£b™d_po°ambÀ_dfs_ch™√l


	)

35 c⁄° 
u32
 
	g¨9340_1p0_ødio_po°ambÀ
[][5] = {

44 c⁄° 
u32
 
	g¨9340Modes_lowe°_ob_db_tx_gaö_èbÀ_1p0
[][5] = {

117 c⁄° 
u32
 
	g¨9340_1p0_ødio_c‹e
[][2] = {

221 c⁄° 
u32
 
	g¨9340_1p0_ødio_c‹e_40M
[][2] = {

230 c⁄° 
u32
 
	g¨9340_1p0_ba£b™d_po°ambÀ
[][5] = {

280 c⁄° 
u32
 
	g¨9340_1p0_ba£b™d_c‹e
[][2] = {

429 c⁄° 
u32
 
	g¨9340Modes_high_powî_tx_gaö_èbÀ_1p0
[][5] = {

526 c⁄° 
u32
 
	g¨9340Modes_high_ob_db_tx_gaö_èbÀ_1p0
[][5] = {

624 c⁄° 
u32
 
	g¨9340Modes_ub124_tx_gaö_èbÀ_1p0
[][5] = {

725 c⁄° 
u32
 
	g¨9340Modes_low_ob_db_tx_gaö_èbÀ_1p0
[][5] = {

824 c⁄° 
u32
 
	g¨9340Modes_mixed_ob_db_tx_gaö_èbÀ_1p0
[][5] = {

923 c⁄° 
u32
 
	g¨9340Modes_low_ob_db_™d_•ur_tx_gaö_èbÀ_1p0
[][5] = {

1023 c⁄° 
u32
 
	g¨9340_1p0_mac_c‹e
[][2] = {

1188 c⁄° 
u32
 
	g¨9340_1p0_soc_¥ómbÀ
[][2] = {

1196 c⁄° 
u32
 
	g¨9340_cus227_tx_gaö_èbÀ_1p0
[][5] = {

	@ar9462_2p0_initvals.h

18 #i‚de‡
INITVALS_9462_2P0_H


19 
	#INITVALS_9462_2P0_H


	)

23 
	#¨9462_2p0_mac_po°ambÀ
 
¨9331_1p1_mac_po°ambÀ


	)

25 
	#¨9462_2p0_comm⁄_wo_x a_rx_gaö
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

27 
	#¨9462_2p0_comm⁄_5g_x a_⁄ly_rxgaö
 
¨9462_2p0_comm⁄_mixed_rx_gaö


	)

29 
	#¨9462_2p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

31 c⁄° 
u32
 
	g¨9462_2p0_modes_Á°_˛ock
[][3] = {

44 c⁄° 
u32
 
	g¨9462_2p0_ba£b™d_po°ambÀ
[][5] = {

103 c⁄° 
u32
 
	g¨9462_2p0_comm⁄_rx_gaö
[][2] = {

363 c⁄° 
u32
 
	g¨9462_2p0_pcõphy_˛kªq_dißbÀ_L1
[][2] = {

370 c⁄° 
u32
 
	g¨9462_2p0_ødio_po°ambÀ_sys2™t
[][5] = {

377 c⁄° 
u32
 
	g¨9462_2p0_modes_low_ob_db_tx_gaö
[][5] = {

446 c⁄° 
u32
 
	g¨9462_2p0_soc_po°ambÀ
[][5] = {

451 c⁄° 
u32
 
	g¨9462_2p0_ba£b™d_c‹e
[][2] = {

601 c⁄° 
u32
 
	g¨9462_2p0_ødio_po°ambÀ
[][5] = {

609 c⁄° 
u32
 
	g¨9462_2p0_modes_mix_ob_db_tx_gaö
[][5] = {

672 c⁄° 
u32
 
	g¨9462_2p0_modes_high_ob_db_tx_gaö
[][5] = {

741 c⁄° 
u32
 
	g¨9462_2p0_ødio_c‹e
[][2] = {

799 c⁄° 
u32
 
	g¨9462_2p0_soc_¥ómbÀ
[][2] = {

807 c⁄° 
u32
 
	g¨9462_2p0_mac_c‹e
[][2] = {

970 c⁄° 
u32
 
	g¨9462_2p0_comm⁄_mixed_rx_gaö
[][2] = {

1230 c⁄° 
u32
 
	g¨9462_2p0_ba£b™d_po°ambÀ_5g_x a
[][5] = {

1235 c⁄° 
u32
 
	g¨9462_2p0_ba£b™d_c‹e_mix_rxgaö
[][2] = {

1240 c⁄° 
u32
 
	g¨9462_2p0_ba£b™d_po°ambÀ_mix_rxgaö
[][5] = {

	@ar9462_2p1_initvals.h

18 #i‚de‡
INITVALS_9462_2P1_H


19 
	#INITVALS_9462_2P1_H


	)

23 
	#¨9462_2p1_mac_po°ambÀ
 
¨9462_2p0_mac_po°ambÀ


	)

25 
	#¨9462_2p1_ba£b™d_c‹e
 
¨9462_2p0_ba£b™d_c‹e


	)

27 
	#¨9462_2p1_ødio_c‹e
 
¨9462_2p0_ødio_c‹e


	)

29 
	#¨9462_2p1_ødio_po°ambÀ
 
¨9462_2p0_ødio_po°ambÀ


	)

31 
	#¨9462_2p1_soc_po°ambÀ
 
¨9462_2p0_soc_po°ambÀ


	)

33 
	#¨9462_2p1_ødio_po°ambÀ_sys2™t
 
¨9462_2p0_ødio_po°ambÀ_sys2™t


	)

35 
	#¨9462_2p1_comm⁄_rx_gaö
 
¨9462_2p0_comm⁄_rx_gaö


	)

37 
	#¨9462_2p1_comm⁄_mixed_rx_gaö
 
¨9462_2p0_comm⁄_mixed_rx_gaö


	)

39 
	#¨9462_2p1_comm⁄_5g_x a_⁄ly_rxgaö
 
¨9462_2p0_comm⁄_5g_x a_⁄ly_rxgaö


	)

41 
	#¨9462_2p1_ba£b™d_c‹e_mix_rxgaö
 
¨9462_2p0_ba£b™d_c‹e_mix_rxgaö


	)

43 
	#¨9462_2p1_ba£b™d_po°ambÀ_mix_rxgaö
 
¨9462_2p0_ba£b™d_po°ambÀ_mix_rxgaö


	)

45 
	#¨9462_2p1_ba£b™d_po°ambÀ_5g_x a
 
¨9462_2p0_ba£b™d_po°ambÀ_5g_x a


	)

47 
	#¨9462_2p1_comm⁄_wo_x a_rx_gaö
 
¨9462_2p0_comm⁄_wo_x a_rx_gaö


	)

49 
	#¨9462_2p1_modes_low_ob_db_tx_gaö
 
¨9462_2p0_modes_low_ob_db_tx_gaö


	)

51 
	#¨9462_2p1_modes_high_ob_db_tx_gaö
 
¨9462_2p0_modes_high_ob_db_tx_gaö


	)

53 
	#¨9462_2p1_modes_mix_ob_db_tx_gaö
 
¨9462_2p0_modes_mix_ob_db_tx_gaö


	)

55 
	#¨9462_2p1_modes_Á°_˛ock
 
¨9462_2p0_modes_Á°_˛ock


	)

57 
	#¨9462_2p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9462_2p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

59 
	#¨9462_2p1_pcõphy_˛kªq_dißbÀ_L1
 
¨9462_2p0_pcõphy_˛kªq_dißbÀ_L1


	)

61 c⁄° 
u32
 
	g¨9462_2p1_mac_c‹e
[][2] = {

224 c⁄° 
u32
 
	g¨9462_2p1_ba£b™d_po°ambÀ
[][5] = {

283 c⁄° 
u32
 
	g¨9462_2p1_soc_¥ómbÀ
[][2] = {

	@ar9485_initvals.h

18 #i‚de‡
INITVALS_9485_H


19 
	#INITVALS_9485_H


	)

23 
	#¨9485_modes_lowe°_ob_db_tx_gaö_1_1
 
¨9485Modes_low_ob_db_tx_gaö_1_1


	)

25 
	#¨9485_1_1_mac_po°ambÀ
 
¨9331_1p1_mac_po°ambÀ


	)

27 
	#¨9485_1_1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

29 c⁄° 
u32
 
	g¨9485Comm⁄_wo_x a_rx_gaö_1_1
[][2] = {

167 c⁄° 
u32
 
	g¨9485Modes_high_powî_tx_gaö_1_1
[][5] = {

261 c⁄° 
u32
 
	g¨9485Modes_gªí_ob_db_tx_gaö_1_1
[][5] = {

355 c⁄° 
u32
 
	g¨9485Modes_high_ob_db_tx_gaö_1_1
[][5] = {

449 c⁄° 
u32
 
	g¨9485Modes_low_ob_db_tx_gaö_1_1
[][5] = {

543 c⁄° 
u32
 
	g¨9485Modes_gªí_•ur_ob_db_tx_gaö_1_1
[][5] = {

637 c⁄° 
u32
 
	g¨9485_1_1
[][2] = {

657 c⁄° 
u32
 
	g¨9485_1_1_ødio_c‹e
[][2] = {

722 c⁄° 
u32
 
	g¨9485_1_1_ba£b™d_c‹e
[][2] = {

859 c⁄° 
u32
 
	g¨9485_comm⁄_rx_gaö_1_1
[][2] = {

997 c⁄° 
u32
 
	g¨9485_1_1_soc_¥ómbÀ
[][2] = {

1009 c⁄° 
u32
 
	g¨9485_Á°_˛ock_1_1_ba£b™d_po°ambÀ
[][3] = {

1016 c⁄° 
u32
 
	g¨9485_1_1_ba£b™d_po°ambÀ
[][5] = {

1055 c⁄° 
u32
 
	g¨9485_1_1_ødio_po°ambÀ
[][2] = {

1064 c⁄° 
u32
 
	g¨9485_1_1_mac_c‹e
[][2] = {

1226 c⁄° 
u32
 
	g¨9485_1_1_pcõ_phy_˛kªq_dißbÀ_L1
[][2] = {

1233 c⁄° 
u32
 
	g¨9485_1_1_∂l_⁄_cdr_⁄_˛kªq_dißbÀ_L1
[][2] = {

	@ar953x_initvals.h

18 #i‚de‡
INITVALS_953X_H


19 
	#INITVALS_953X_H


	)

21 
	#qˇ953x_1p0_mac_po°ambÀ
 
¨9300_2p2_mac_po°ambÀ


	)

23 
	#qˇ953x_1p0_soc_¥ómbÀ
 
¨955x_1p0_soc_¥ómbÀ


	)

25 
	#qˇ953x_1p0_soc_po°ambÀ
 
¨9300_2p2_soc_po°ambÀ


	)

27 
	#qˇ953x_1p0_comm⁄_rx_gaö_èbÀ
 
¨9300Comm⁄_rx_gaö_èbÀ_2p2


	)

29 
	#qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

31 
	#qˇ953x_1p0_modes_Á°_˛ock
 
¨9300Modes_Á°_˛ock_2p2


	)

33 
	#qˇ953x_1p0_comm⁄_wo_x a_rx_gaö_bounds
 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_bounds


	)

35 
	#qˇ953x_1p0_comm⁄_rx_gaö_bounds
 
¨955x_1p0_comm⁄_rx_gaö_bounds


	)

37 c⁄° 
u32
 
	gqˇ953x_1p0_mac_c‹e
[][2] = {

195 c⁄° 
u32
 
	gqˇ953x_1p0_ba£b™d_c‹e
[][2] = {

343 c⁄° 
u32
 
	gqˇ953x_1p0_ba£b™d_po°ambÀ
[][5] = {

394 c⁄° 
u32
 
	gqˇ953x_1p0_ødio_c‹e
[][2] = {

485 c⁄° 
u32
 
	gqˇ953x_1p0_ødio_po°ambÀ
[][5] = {

499 c⁄° 
u32
 
	gqˇ953x_1p0_modes_x∑_tx_gaö_èbÀ
[][2] = {

565 c⁄° 
u32
 
	gqˇ953x_1p0_modes_no_x∑_tx_gaö_èbÀ
[][2] = {

630 c⁄° 
u32
 
	gqˇ953x_1p1_modes_no_x∑_tx_gaö_èbÀ
[][2] = {

695 c⁄° 
u32
 
	gqˇ953x_1p1_modes_x∑_tx_gaö_èbÀ
[][2] = {

760 c⁄° 
u32
 
	gqˇ953x_1p1_modes_no_x∑_low_powî_tx_gaö_èbÀ
[][2] = {

825 c⁄° 
u32
 
	gqˇ953x_2p0_ba£b™d_c‹e
[][2] = {

973 c⁄° 
u32
 
	gqˇ953x_2p0_ba£b™d_po°ambÀ
[][5] = {

1024 c⁄° 
u32
 
	gqˇ953x_2p0_comm⁄_wo_x a_rx_gaö_èbÀ
[][2] = {

1284 c⁄° 
u32
 
	gqˇ953x_2p0_comm⁄_wo_x a_rx_gaö_bounds
[][5] = {

1290 c⁄° 
u32
 
	gqˇ953x_2p0_modes_x∑_tx_gaö_èbÀ
[][2] = {

1355 c⁄° 
u32
 
	gqˇ953x_2p0_modes_no_x∑_tx_gaö_èbÀ
[][2] = {

	@ar955x_1p0_initvals.h

18 #i‚de‡
INITVALS_955X_1P0_H


19 
	#INITVALS_955X_1P0_H


	)

23 
	#¨955x_1p0_soc_po°ambÀ
 
¨9300_2p2_soc_po°ambÀ


	)

25 
	#¨955x_1p0_comm⁄_rx_gaö_èbÀ
 
¨9300Comm⁄_rx_gaö_èbÀ_2p2


	)

27 
	#¨955x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

29 
	#¨955x_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

31 c⁄° 
u32
 
	g¨955x_1p0_ødio_po°ambÀ
[][5] = {

48 c⁄° 
u32
 
	g¨955x_1p0_ba£b™d_po°ambÀ
[][5] = {

105 c⁄° 
u32
 
	g¨955x_1p0_ødio_c‹e
[][2] = {

247 c⁄° 
u32
 
	g¨955x_1p0_modes_x∑_tx_gaö_èbÀ
[][9] = {

319 c⁄° 
u32
 
	g¨955x_1p0_mac_c‹e
[][2] = {

477 c⁄° 
u32
 
	g¨955x_1p0_ba£b™d_c‹e
[][2] = {

635 c⁄° 
u32
 
	g¨955x_1p0_soc_¥ómbÀ
[][2] = {

652 c⁄° 
u32
 
	g¨955x_1p0_comm⁄_wo_x a_rx_gaö_bounds
[][5] = {

658 c⁄° 
u32
 
	g¨955x_1p0_mac_po°ambÀ
[][5] = {

670 c⁄° 
u32
 
	g¨955x_1p0_comm⁄_rx_gaö_bounds
[][5] = {

676 c⁄° 
u32
 
	g¨955x_1p0_modes_no_x∑_tx_gaö_èbÀ
[][9] = {

747 c⁄° 
u32
 
	g¨955x_1p0_modes_Á°_˛ock
[][3] = {

	@ar9565_1p0_initvals.h

18 #i‚de‡
INITVALS_9565_1P0_H


19 
	#INITVALS_9565_1P0_H


	)

23 
	#¨9565_1p0_mac_po°ambÀ
 
¨9331_1p1_mac_po°ambÀ


	)

25 
	#¨9565_1p0_Modes_lowe°_ob_db_tx_gaö_èbÀ
 
¨9565_1p0_modes_low_ob_db_tx_gaö_èbÀ


	)

27 
	#¨9565_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

29 c⁄° 
u32
 
	g¨9565_1p0_mac_c‹e
[][2] = {

191 c⁄° 
u32
 
	g¨9565_1p0_ba£b™d_c‹e
[][2] = {

332 c⁄° 
u32
 
	g¨9565_1p0_ba£b™d_po°ambÀ
[][5] = {

378 c⁄° 
u32
 
	g¨9565_1p0_ødio_c‹e
[][2] = {

422 c⁄° 
u32
 
	g¨9565_1p0_ødio_po°ambÀ
[][5] = {

431 c⁄° 
u32
 
	g¨9565_1p0_soc_¥ómbÀ
[][2] = {

440 c⁄° 
u32
 
	g¨9565_1p0_soc_po°ambÀ
[][5] = {

445 c⁄° 
u32
 
	g¨9565_1p0_Comm⁄_rx_gaö_èbÀ
[][2] = {

708 c⁄° 
u32
 
	g¨9565_1p0_pcõphy_˛kªq_dißbÀ_L1
[][2] = {

715 c⁄° 
u32
 
	g¨9565_1p0_modes_Á°_˛ock
[][3] = {

728 c⁄° 
u32
 
	g¨9565_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
[][2] = {

988 c⁄° 
u32
 
	g¨9565_1p0_modes_low_ob_db_tx_gaö_èbÀ
[][5] = {

1048 c⁄° 
u32
 
	g¨9565_1p0_modes_high_ob_db_tx_gaö_èbÀ
[][5] = {

1108 c⁄° 
u32
 
	g¨9565_1p0_modes_high_powî_tx_gaö_èbÀ
[][5] = {

	@ar9565_1p1_initvals.h

18 #i‚de‡
INITVALS_9565_1P1_H


19 
	#INITVALS_9565_1P1_H


	)

23 
	#¨9565_1p1_mac_c‹e
 
¨9565_1p0_mac_c‹e


	)

25 
	#¨9565_1p1_mac_po°ambÀ
 
¨9565_1p0_mac_po°ambÀ


	)

27 
	#¨9565_1p1_ba£b™d_c‹e
 
¨9565_1p0_ba£b™d_c‹e


	)

29 
	#¨9565_1p1_ba£b™d_po°ambÀ
 
¨9565_1p0_ba£b™d_po°ambÀ


	)

31 
	#¨9565_1p1_ødio_c‹e
 
¨9565_1p0_ødio_c‹e


	)

33 
	#¨9565_1p1_soc_¥ómbÀ
 
¨9565_1p0_soc_¥ómbÀ


	)

35 
	#¨9565_1p1_soc_po°ambÀ
 
¨9565_1p0_soc_po°ambÀ


	)

37 
	#¨9565_1p1_Comm⁄_rx_gaö_èbÀ
 
¨9565_1p0_Comm⁄_rx_gaö_èbÀ


	)

39 
	#¨9565_1p1_Modes_lowe°_ob_db_tx_gaö_èbÀ
 
¨9565_1p0_Modes_lowe°_ob_db_tx_gaö_èbÀ


	)

41 
	#¨9565_1p1_pcõphy_˛kªq_dißbÀ_L1
 
¨9565_1p0_pcõphy_˛kªq_dißbÀ_L1


	)

43 
	#¨9565_1p1_modes_Á°_˛ock
 
¨9565_1p0_modes_Á°_˛ock


	)

45 
	#¨9565_1p1_comm⁄_wo_x a_rx_gaö_èbÀ
 
¨9565_1p0_comm⁄_wo_x a_rx_gaö_èbÀ


	)

47 
	#¨9565_1p1_modes_low_ob_db_tx_gaö_èbÀ
 
¨9565_1p0_modes_low_ob_db_tx_gaö_èbÀ


	)

49 
	#¨9565_1p1_modes_high_ob_db_tx_gaö_èbÀ
 
¨9565_1p0_modes_high_ob_db_tx_gaö_èbÀ


	)

51 
	#¨9565_1p1_modes_high_powî_tx_gaö_èbÀ
 
¨9565_1p0_modes_high_powî_tx_gaö_èbÀ


	)

53 
	#¨9565_1p1_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9565_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

55 c⁄° 
u32
 
	g¨9565_1p1_ødio_po°ambÀ
[][5] = {

	@ar956x_initvals.h

18 #i‚de‡
INITVALS_956X_H


19 
	#INITVALS_956X_H


	)

21 
	#qˇ956x_1p0_mac_c‹e
 
¨955x_1p0_mac_c‹e


	)

23 
	#qˇ956x_1p0_mac_po°ambÀ
 
¨9331_1p1_mac_po°ambÀ


	)

25 
	#qˇ956x_1p0_soc_¥ómbÀ
 
¨955x_1p0_soc_¥ómbÀ


	)

27 
	#qˇ956x_1p0_soc_po°ambÀ
 
¨9300_2p2_soc_po°ambÀ


	)

29 
	#qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_èbÀ
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

31 
	#qˇ956x_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
 
¨9300_2p2_ba£b™d_po°ambÀ_dfs_ch™√l


	)

33 
	#qˇ956x_1p0_comm⁄_wo_x a_rx_gaö_bounds
 
¨955x_1p0_comm⁄_wo_x a_rx_gaö_bounds


	)

35 
	#qˇ956x_1p0_comm⁄_rx_gaö_bounds
 
¨955x_1p0_comm⁄_rx_gaö_bounds


	)

37 
	#qˇ956x_1p0_modes_Á°_˛ock
 
¨9462_2p0_modes_Á°_˛ock


	)

39 c⁄° 
u32
 
	gqˇ956x_1p0_ba£b™d_c‹e
[][2] = {

205 c⁄° 
u32
 
	gqˇ956x_1p0_ba£b™d_po°ambÀ
[][5] = {

262 c⁄° 
u32
 
	gqˇ956x_1p0_ødio_c‹e
[][2] = {

388 c⁄° 
u32
 
	gqˇ956x_1p0_ødio_po°ambÀ
[][5] = {

405 c⁄° 
u32
 
	gqˇ956x_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
[][2] = {

412 c⁄° 
u32
 
	gqˇ956x_1p0_modes_no_x∑_tx_gaö_èbÀ
[][3] = {

494 c⁄° 
u32
 
	gqˇ956x_1p0_modes_x∑_tx_gaö_èbÀ
[][3] = {

570 c⁄° 
u32
 
	gqˇ956x_1p0_modes_no_x∑_low_ob_db_tx_gaö_èbÀ
[][3] = {

660 c⁄° 
u32
 
	gqˇ956x_1p0_modes_no_x∑_gªí_tx_gaö_èbÀ
[][3] = {

768 c⁄° 
u32
 
	gqˇ956x_1p0_comm⁄_rx_gaö_èbÀ
[][2] = {

1028 c⁄° 
u32
 
	gqˇ956x_1p0_x a_⁄ly
[][5] = {

	@ar9580_1p0_initvals.h

18 #i‚de‡
INITVALS_9580_1P0_H


19 
	#INITVALS_9580_1P0_H


	)

23 
	#¨9580_1p0_soc_¥ómbÀ
 
¨9300_2p2_soc_¥ómbÀ


	)

25 
	#¨9580_1p0_soc_po°ambÀ
 
¨9300_2p2_soc_po°ambÀ


	)

27 c⁄° 
u32
 
	g¨9580_1p0_ødio_c‹e
[][2] = {

171 
	#¨9580_1p0_mac_po°ambÀ
 
¨9300_2p2_mac_po°ambÀ


	)

173 
	#¨9580_1p0_wo_x a_rx_gaö_èbÀ
 
¨9300Comm⁄_wo_x a_rx_gaö_èbÀ_2p2


	)

175 
	#¨9580_1p0_ty≥5_tx_gaö_èbÀ
 
¨9300Modes_ty≥5_tx_gaö_èbÀ_2p2


	)

177 
	#¨9580_1p0_high_ob_db_tx_gaö_èbÀ
 
¨9300Modes_high_ob_db_tx_gaö_èbÀ_2p2


	)

179 
	#¨9580_1p0_modes_Á°_˛ock
 
¨9300Modes_Á°_˛ock_2p2


	)

181 
	#¨9580_1p0_ba£b™d_c‹e_txfú_c€ff_j≠™_2484
 
¨9300_2p2_ba£b™d_c‹e_txfú_c€ff_j≠™_2484


	)

183 c⁄° 
u32
 
	g¨9580_1p0_ødio_po°ambÀ
[][5] = {

196 c⁄° 
u32
 
	g¨9580_1p0_ba£b™d_c‹e
[][2] = {

357 c⁄° 
u32
 
	g¨9580_1p0_low_ob_db_tx_gaö_èbÀ
[][5] = {

463 c⁄° 
u32
 
	g¨9580_1p0_high_powî_tx_gaö_èbÀ
[][5] = {

570 c⁄° 
u32
 
	g¨9580_1p0_lowe°_ob_db_tx_gaö_èbÀ
[][5] = {

676 c⁄° 
u32
 
	g¨9580_1p0_mac_c‹e
[][2] = {

833 c⁄° 
u32
 
	g¨9580_1p0_mixed_ob_db_tx_gaö_èbÀ
[][5] = {

939 c⁄° 
u32
 
	g¨9580_1p0_ty≥6_tx_gaö_èbÀ
[][5] = {

1013 c⁄° 
u32
 
	g¨9580_1p0_rx_gaö_èbÀ
[][2] = {

1273 c⁄° 
u32
 
	g¨9580_1p0_ba£b™d_po°ambÀ
[][5] = {

1331 c⁄° 
u32
 
	g¨9580_1p0_pcõ_phy_˛kªq_íabÀ_L1
[][2] = {

1338 c⁄° 
u32
 
	g¨9580_1p0_pcõ_phy_˛kªq_dißbÀ_L1
[][2] = {

1345 c⁄° 
u32
 
	g¨9580_1p0_pcõ_phy_∂l_⁄_˛kªq
[][2] = {

1352 c⁄° 
u32
 
	g¨9580_1p0_ba£b™d_po°ambÀ_dfs_ch™√l
[][3] = {

	@ath9k.h

17 #i‚de‡
ATH9K_H


18 
	#ATH9K_H


	)

20 
	~<löux/ëhîdevi˚.h
>

21 
	~<löux/devi˚.h
>

22 
	~<löux/öãºu±.h
>

23 
	~<löux/Àds.h
>

24 
	~<löux/com∂ëi⁄.h
>

25 
	~<löux/time.h
>

26 
	~<löux/hw_øndom.h
>

28 
	~"comm⁄.h
"

29 
	~"debug.h
"

30 
	~"mci.h
"

31 
	~"dfs.h
"

33 
	g©h_node
;

34 
	g©h_vif
;

36 
õì80211_›s
 
©h9k_›s
;

37 
©h9k_mod∑øm_nohw¸y±
;

38 
©h9k_Àd_blök
;

39 
boﬁ
 
is_©h9k_u∆ﬂded
;

40 
©h9k_u£_ch™˘x
;

46 
	#ATH_TXSTATUS_RING_SIZE
 512

	)

49 
	#ôo64
(
x
) ((x) == 1) ? \

50 ((()(
x
)) & (0xff)) : \

51 ((
x
) == 2) ? \

52 ((()(
x
)) & 0xffff) : \

53 (((
x
) == 4) ? \

54 ((()(
x
)) & 0xffffffff) : \

55 ()(
x
))

	)

57 
	#ATH_TXBUF_RESET
(
_bf
) do { \

58 (
_bf
)->
bf_œ°bf
 = 
NULL
; \

59 (
_bf
)->
bf_√xt
 = 
NULL
; \

60 
	`mem£t
(&((
_bf
)->
bf_°©e
), 0, \

61 (
©h_buf_°©e
)); \

62 } 0)

	)

64 
	#DS2PHYS
(
_dd
, 
_ds
) \

65 ((
_dd
)->
dd_desc_∑ddr
 + ((
ˇddr_t
)(
_ds
Ë- (ˇddr_t)(_dd)->
dd_desc
))

	)

66 
	#ATH_DESC_4KB_BOUND_CHECK
(
_daddr
Ë((((_daddrË& 0xFFFË> 0xF7FË? 1 : 0)

	)

67 
	#ATH_DESC_4KB_BOUND_NUM_SKIPPED
(
_Àn
Ë((_ÀnË/ 4096)

	)

69 
	s©h_descdma
 {

70 *
	mdd_desc
;

71 
dma_addr_t
 
	mdd_desc_∑ddr
;

72 
u32
 
	mdd_desc_Àn
;

75 
©h_descdma_£tup
(
©h_so·c
 *
sc
, 
©h_descdma
 *
dd
,

76 
li°_hód
 *
hód
, c⁄° *
«me
,

77 
nbuf
, 
ndesc
, 
boﬁ
 
is_tx
);

83 
	#ATH_TXQ_SETUP
(
sc
, 
i
Ë((sc)->
tx
.
txq£tup
 & (1<<i))

	)

86 
	#INCR
(
_l
, 
_sz
) do { \

87 (
_l
)++; \

88 (
_l
Ë&((
_sz
) - 1); \

89 } 0)

	)

91 
	#ATH_RXBUF
 256

	)

92 
	#ATH_TXBUF
 512

	)

93 
	#ATH_TXBUF_RESERVE
 5

	)

94 
	#ATH_MAX_QDEPTH
 (
ATH_TXBUF
 / 4 - 
ATH_TXBUF_RESERVE
)

	)

95 
	#ATH_TXMAXTRY
 13

	)

96 
	#ATH_MAX_SW_RETRIES
 30

	)

98 
	#TID_TO_WME_AC
(
_tid
) \

99 ((((
_tid
Ë=0Ë|| ((_tidË=3)Ë? 
IEEE80211_AC_BE
 : \

100 (((
_tid
Ë=1Ë|| ((_tidË=2)Ë? 
IEEE80211_AC_BK
 : \

101 (((
_tid
Ë=4Ë|| ((_tidË=5)Ë? 
IEEE80211_AC_VI
 : \

102 
IEEE80211_AC_VO
)

	)

104 
	#ATH_AGGR_DELIM_SZ
 4

	)

105 
	#ATH_AGGR_MINPLEN
 256

	)

107 
	#ATH_AGGR_ENCRYPTDELIM
 10

	)

109 
	#ATH_AGGR_MIN_QDEPTH
 2

	)

111 
	#ATH_NON_AGGR_MIN_QDEPTH
 8

	)

112 
	#ATH_TX_COMPLETE_POLL_INT
 1000

	)

113 
	#ATH_TXFIFO_DEPTH
 8

	)

114 
	#ATH_TX_ERROR
 0x01

	)

117 
	#ATH_P2P_PS_STOP_TIME
 1000

	)

119 
	#IEEE80211_SEQ_SEQ_SHIFT
 4

	)

120 
	#IEEE80211_SEQ_MAX
 4096

	)

121 
	#IEEE80211_WEP_IVLEN
 3

	)

122 
	#IEEE80211_WEP_KIDLEN
 1

	)

123 
	#IEEE80211_WEP_CRCLEN
 4

	)

124 
	#IEEE80211_MAX_MPDU_LEN
 (3840 + 
FCS_LEN
 + \

125 (
IEEE80211_WEP_IVLEN
 + \

126 
IEEE80211_WEP_KIDLEN
 + \

127 
IEEE80211_WEP_CRCLEN
))

	)

131 
	#ATH_BA_ISSET
(
_bm
, 
_n
Ë(((_nË< (
WME_BA_BMP_SIZE
)) && \

132 ((
_bm
)[(
_n
Ë>> 5] & (1 << ((_nË& 31))))

	)

135 
	#ATH_BA_INDEX
(
_°
, 
_£q
Ë(((_£qË- (_°)Ë& (
IEEE80211_SEQ_MAX
 - 1))

	)

138 
	#ATH_BA_INDEX2SEQ
(
_£q
, 
_off£t
Ë(((_£qË+ (_off£t)Ë& (
IEEE80211_SEQ_MAX
 - 1))

	)

141 
	#ATH_AGGR_GET_NDELIM
(
_Àn
) \

142 (((
_Àn
Ë>
ATH_AGGR_MINPLEN
) ? 0 : \

143 
	`DIV_ROUND_UP
(
ATH_AGGR_MINPLEN
 - (
_Àn
), 
ATH_AGGR_DELIM_SZ
))

	)

145 
	#BAW_WITHIN
(
_°¨t
, 
_bawsz
, 
_£qno
) \

146 ((((
_£qno
Ë- (
_°¨t
)Ë& 4095Ë< (
_bawsz
))

	)

148 
	#ATH_AN_2_TID
(
_™
, 
_tidno
Ë(&(_™)->
tid
[(_tidno)])

	)

150 
	#IS_HT_RATE
(
øã
Ë‘©ê& 0x80)

	)

151 
	#IS_CCK_RATE
(
øã
Ë(‘©ê>0x18Ë&& (øã <0x1e))

	)

152 
	#IS_OFDM_RATE
(
øã
Ë(‘©ê>0x8Ë&& (øã <0xf))

	)

155 
	mWLAN_RC_PHY_OFDM
,

156 
	mWLAN_RC_PHY_CCK
,

159 
	s©h_txq
 {

160 
	mmac80211_qnum
;

161 
u32
 
	maxq_qnum
;

162 *
	maxq_lök
;

163 
li°_hód
 
	maxq_q
;

164 
•ölock_t
 
	maxq_lock
;

165 
u32
 
	maxq_dïth
;

166 
u32
 
	maxq_ampdu_dïth
;

167 
boﬁ
 
	m°›≥d
;

168 
boﬁ
 
	maxq_tx_ö¥ogªss
;

169 
li°_hód
 
	mtxq_fifo
[
ATH_TXFIFO_DEPTH
];

170 
u8
 
	mtxq_hódidx
;

171 
u8
 
	mtxq_èûidx
;

172 
	m≥ndög_‰ames
;

173 
sk_buff_hód
 
	mcom∂ëe_q
;

176 
	s©h_‰ame_öfo
 {

177 
©h_buf
 *
	mbf
;

178 
u16
 
	m‰amñí
;

179 
s8
 
	mtxq
;

180 
u8
 
	mkeyix
;

181 
u8
 
	mπs˘s_øã
;

182 
u8
 
	mªåõs
 : 7;

183 
u8
 
	mbaw_åacked
 : 1;

184 
u8
 
	mtx_powî
;

185 
©h9k_key_ty≥
 
	mkeyty≥
:2;

188 
	s©h_rxbuf
 {

189 
li°_hód
 
	mli°
;

190 
sk_buff
 *
	mbf_mpdu
;

191 *
	mbf_desc
;

192 
dma_addr_t
 
	mbf_daddr
;

193 
dma_addr_t
 
	mbf_buf_addr
;

203 
	ebuf„r_ty≥
 {

204 
	mBUF_AMPDU
 = 
BIT
(0),

205 
	mBUF_AGGR
 = 
BIT
(1),

208 
	#bf_ißmpdu
(
bf
Ë(bf->
bf_°©e
.
bf_ty≥
 & 
BUF_AMPDU
)

	)

209 
	#bf_ißggr
(
bf
Ë(bf->
bf_°©e
.
bf_ty≥
 & 
BUF_AGGR
)

	)

211 
	s©h_buf_°©e
 {

212 
u8
 
	mbf_ty≥
;

213 
u8
 
	mbfs_∑¥d
;

214 
u8
 
	mndñim
;

215 
boﬁ
 
	m°Æe
;

216 
u16
 
	m£qno
;

217 
	mbfs_∑¥d_time°amp
;

220 
	s©h_buf
 {

221 
li°_hód
 
	mli°
;

222 
©h_buf
 *
	mbf_œ°bf
;

224 
©h_buf
 *
	mbf_√xt
;

225 
sk_buff
 *
	mbf_mpdu
;

226 *
	mbf_desc
;

227 
dma_addr_t
 
	mbf_daddr
;

228 
dma_addr_t
 
	mbf_buf_addr
;

229 
õì80211_tx_øã
 
	møãs
[4];

230 
©h_buf_°©e
 
	mbf_°©e
;

233 
	s©h_©x_tid
 {

234 
li°_hód
 
	mli°
;

235 
sk_buff_hód
 
	mbuf_q
;

236 
sk_buff_hód
 
	mªåy_q
;

237 
©h_node
 *
	m™
;

238 
©h_txq
 *
	mtxq
;

239 
	mtx_buf
[
BITS_TO_LONGS
(
ATH_TID_MAX_BUFS
)];

240 
u16
 
	m£q_°¨t
;

241 
u16
 
	m£q_√xt
;

242 
u16
 
	mbaw_size
;

243 
u8
 
	mtidno
;

244 
	mbaw_hód
;

245 
	mbaw_èû
;

247 
s8
 
	mb¨_ödex
;

248 
boﬁ
 
	ma˘ive
;

249 
boﬁ
 
	m˛ór_ps_fûãr
;

252 
	s©h_node
 {

253 
©h_so·c
 *
	msc
;

254 
õì80211_°a
 *
	m°a
;

255 
õì80211_vif
 *
	mvif
;

256 
©h_©x_tid
 
	mtid
[
IEEE80211_NUM_TIDS
];

258 
u16
 
	mmaxampdu
;

259 
u8
 
	mmpdudísôy
;

260 
s8
 
	mps_key
;

262 
boﬁ
 
	m¶ìpög
;

263 
boﬁ
 
	mno_ps_fûãr
;

265 #ifde‡
CPTCFG_ATH9K_STATION_STATISTICS


266 
©h_rx_øã_°©s
 
	mrx_øã_°©s
;

268 
u8
 
	mkey_idx
[4];

270 
u32
 
	mackto
;

271 
li°_hód
 
	mli°
;

274 
	s©h_tx_c⁄åﬁ
 {

275 
©h_txq
 *
	mtxq
;

276 
©h_node
 *
	m™
;

277 
õì80211_°a
 *
	m°a
;

278 
u8
 
	m∑¥d
;

279 
boﬁ
 
	mf‹˚_ch™√l
;

288 
	s©h_tx
 {

289 
u32
 
	mtxq£tup
;

290 
•ölock_t
 
	mtxbuÊock
;

291 
li°_hód
 
	mtxbuf
;

292 
©h_txq
 
	mtxq
[
ATH9K_NUM_TX_QUEUES
];

293 
©h_descdma
 
	mtxdma
;

294 
©h_txq
 *
	mtxq_m≠
[
IEEE80211_NUM_ACS
];

295 
©h_txq
 *
	mu≠sdq
;

296 
u32
 
	mtxq_max_≥ndög
[
IEEE80211_NUM_ACS
];

297 
u16
 
	mmax_aggr_‰amñí
[
IEEE80211_NUM_ACS
][4][32];

300 
	s©h_rx_edma
 {

301 
sk_buff_hód
 
	mrx_fifo
;

302 
u32
 
	mrx_fifo_hwsize
;

305 
	s©h_rx
 {

306 
u8
 
	mdeÁ¡
;

307 
u8
 
	mrxŸhî™t
;

308 
boﬁ
 
	mdisˇrd_√xt
;

309 
u32
 *
	mrxlök
;

310 
u32
 
	mnum_pkts
;

311 
li°_hód
 
	mrxbuf
;

312 
©h_descdma
 
	mrxdma
;

313 
©h_rx_edma
 
	mrx_edma
[
ATH9K_RX_QUEUE_MAX
];

315 
©h_rxbuf
 *
	mbuf_hﬁd
;

316 
sk_buff
 *
	m‰ag
;

318 
u32
 
	mampdu_ªf
;

325 
	s©h_ch™˘x
 {

326 
cfg80211_ch™_def
 
	mch™def
;

327 
li°_hód
 
	mvifs
;

328 
li°_hód
 
	macq
[
IEEE80211_NUM_ACS
];

329 
	mhw_queue_ba£
;

332 
õì80211_vif
 *
	m¥im¨y_°a
;

334 
©h_bóc⁄_c⁄fig
 
	mbóc⁄
;

335 
©h9k_hw_ˇl_d©a
 
	mˇld©a
;

336 
time•ec
 
	mtsf_ts
;

337 
u64
 
	mtsf_vÆ
;

338 
u32
 
	mœ°_bóc⁄
;

340 
	mÊush_timeout
;

341 
u16
 
	mtxpowî
;

342 
u16
 
	mcur_txpowî
;

343 
boﬁ
 
	moffch™√l
;

344 
boﬁ
 
	m°›≥d
;

345 
boﬁ
 
	ma˘ive
;

346 
boﬁ
 
	massig√d
;

347 
boﬁ
 
	mswôch_a·î_bóc⁄
;

349 
	mnvifs
;

350 
	mnvifs_assig√d
;

351 
	mrxfûãr
;

354 
	e©h_ch™˘x_evít
 {

355 
	mATH_CHANCTX_EVENT_BEACON_PREPARE
,

356 
	mATH_CHANCTX_EVENT_BEACON_SENT
,

357 
	mATH_CHANCTX_EVENT_TSF_TIMER
,

358 
	mATH_CHANCTX_EVENT_BEACON_RECEIVED
,

359 
	mATH_CHANCTX_EVENT_AUTHORIZED
,

360 
	mATH_CHANCTX_EVENT_SWITCH
,

361 
	mATH_CHANCTX_EVENT_ASSIGN
,

362 
	mATH_CHANCTX_EVENT_UNASSIGN
,

363 
	mATH_CHANCTX_EVENT_CHANGE
,

364 
	mATH_CHANCTX_EVENT_ENABLE_MULTICHANNEL
,

367 
	e©h_ch™˘x_°©e
 {

368 
	mATH_CHANCTX_STATE_IDLE
,

369 
	mATH_CHANCTX_STATE_WAIT_FOR_BEACON
,

370 
	mATH_CHANCTX_STATE_WAIT_FOR_TIMER
,

371 
	mATH_CHANCTX_STATE_SWITCH
,

372 
	mATH_CHANCTX_STATE_FORCE_ACTIVE
,

375 
	s©h_ch™˘x_sched
 {

376 
boﬁ
 
	mbóc⁄_≥ndög
;

377 
boﬁ
 
	mbóc⁄_adju°
;

378 
boﬁ
 
	moffch™√l_≥ndög
;

379 
boﬁ
 
	mwaô_swôch
;

380 
boﬁ
 
	mf‹˚_nﬂ_upd©e
;

381 
boﬁ
 
	mexãnd_ab£n˚
;

382 
boﬁ
 
	mmgd_¥ï¨e_tx
;

383 
©h_ch™˘x_°©e
 
	m°©e
;

384 
u8
 
	mbóc⁄_miss
;

386 
u32
 
	m√xt_tbâ
;

387 
u32
 
	mswôch_°¨t_time
;

388 
	moffch™√l_duøti⁄
;

389 
	mch™√l_swôch_time
;

392 
timî_li°
 
	mtimî
;

395 
	e©h_offch™√l_°©e
 {

396 
	mATH_OFFCHANNEL_IDLE
,

397 
	mATH_OFFCHANNEL_PROBE_SEND
,

398 
	mATH_OFFCHANNEL_PROBE_WAIT
,

399 
	mATH_OFFCHANNEL_SUSPEND
,

400 
	mATH_OFFCHANNEL_ROC_START
,

401 
	mATH_OFFCHANNEL_ROC_WAIT
,

402 
	mATH_OFFCHANNEL_ROC_DONE
,

405 
	e©h_roc_com∂ëe_ªas⁄
 {

406 
	mATH_ROC_COMPLETE_EXPIRE
,

407 
	mATH_ROC_COMPLETE_ABORT
,

408 
	mATH_ROC_COMPLETE_CANCEL
,

411 
	s©h_offch™√l
 {

412 
©h_ch™˘x
 
	mch™
;

413 
timî_li°
 
	mtimî
;

414 
cfg80211_sˇn_ªque°
 *
	msˇn_ªq
;

415 
õì80211_vif
 *
	msˇn_vif
;

416 
	msˇn_idx
;

417 
©h_offch™√l_°©e
 
	m°©e
;

418 
õì80211_ch™√l
 *
	mroc_ch™
;

419 
õì80211_vif
 *
	mroc_vif
;

420 
	mroc_duøti⁄
;

421 
	mduøti⁄
;

424 
	#ˇ£_πn_°rög
(
vÆ
ËvÆ:  #vÆ

	)

426 
	#©h_f‹_óch_ch™˘x
(
_sc
, 
_˘x
) \

427 
˘x
 = &
sc
->
ch™˘x
[0]; \

428 
˘x
 <&
sc
->
ch™˘x
[
	`ARRAY_SIZE
(sc->chanctx) - 1]; \

429 
˘x
++)

	)

431 
©h_ch™˘x_öô
(
©h_so·c
 *
sc
);

432 
©h_ch™˘x_£t_ch™√l
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
,

433 
cfg80211_ch™_def
 *
ch™def
);

435 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


437 
ölöe
 
©h_ch™˘x
 *

438 
	$©h_ch™˘x_gë
(
õì80211_ch™˘x_c⁄f
 *
˘x
)

440 
©h_ch™˘x
 **
±r
 = (*Ë
˘x
->
drv_¥iv
;

441  *
±r
;

442 
	}
}

444 
boﬁ
 
©h9k_is_ch™˘x_íabÀd
();

445 
©h9k_fûl_ch™˘x_›s
();

446 
©h9k_öô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
);

447 
©h9k_offch™√l_öô
(
©h_so·c
 *
sc
);

448 
©h9k_deöô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
);

449 
©h9k_öô_p2p
(
©h_so·c
 *
sc
);

450 
©h9k_deöô_p2p
(
©h_so·c
 *
sc
);

451 
©h9k_p2p_ªmove_vif
(
©h_so·c
 *
sc
,

452 
õì80211_vif
 *
vif
);

453 
©h9k_p2p_bóc⁄_sync
(
©h_so·c
 *
sc
);

454 
©h9k_p2p_bss_öfo_ch™ged
(
©h_so·c
 *
sc
,

455 
õì80211_vif
 *
vif
);

456 
©h9k_bóc⁄_add_nﬂ
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
,

457 
sk_buff
 *
skb
);

458 
©h9k_p2p_ps_timî
(*
¥iv
);

459 
©h9k_ch™˘x_wake_queues
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
);

460 
©h9k_ch™˘x_°›_queues
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
);

461 
©h_ch™˘x_check_a˘ive
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
);

463 
©h_ch™˘x_bóc⁄_ªcv_ev
(
©h_so·c
 *
sc
,

464 
©h_ch™˘x_evít
 
ev
);

465 
©h_ch™˘x_bóc⁄_£¡_ev
(
©h_so·c
 *
sc
,

466 
©h_ch™˘x_evít
 
ev
);

467 
©h_ch™˘x_evít
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
,

468 
©h_ch™˘x_evít
 
ev
);

469 
©h_ch™˘x_£t_√xt
(
©h_so·c
 *
sc
, 
boﬁ
 
f‹˚
);

470 
©h_offch™√l_√xt
(
©h_so·c
 *
sc
);

471 
©h_sˇn_com∂ëe
(
©h_so·c
 *
sc
, 
boﬁ
 
ab‹t
);

472 
©h_roc_com∂ëe
(
©h_so·c
 *
sc
,

473 
©h_roc_com∂ëe_ªas⁄
 
ªas⁄
);

474 
©h_ch™˘x
* 
©h_is_go_ch™˘x_¥e£¡
(
©h_so·c
 *
sc
);

478 
ölöe
 
boﬁ
 
	$©h9k_is_ch™˘x_íabÀd
()

480  
Ál£
;

481 
	}
}

482 
ölöe
 
	$©h9k_fûl_ch™˘x_›s
()

484 
	}
}

485 
ölöe
 
	$©h9k_öô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
)

487 
	}
}

488 
ölöe
 
	$©h9k_offch™√l_öô
(
©h_so·c
 *
sc
)

490 
	}
}

491 
ölöe
 
	$©h9k_deöô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
)

493 
	}
}

494 
ölöe
 
	$©h_ch™˘x_bóc⁄_ªcv_ev
(
©h_so·c
 *
sc
,

495 
©h_ch™˘x_evít
 
ev
)

497 
	}
}

498 
ölöe
 
	$©h_ch™˘x_bóc⁄_£¡_ev
(
©h_so·c
 *
sc
,

499 
©h_ch™˘x_evít
 
ev
)

501 
	}
}

502 
ölöe
 
	$©h_ch™˘x_evít
(
©h_so·c
 *
sc
,

503 
õì80211_vif
 *
vif
,

504 
©h_ch™˘x_evít
 
ev
)

506 
	}
}

507 
ölöe
 
	$©h9k_öô_p2p
(
©h_so·c
 *
sc
)

510 
	}
}

511 
ölöe
 
	$©h9k_deöô_p2p
(
©h_so·c
 *
sc
)

513 
	}
}

514 
ölöe
 
	$©h9k_p2p_ªmove_vif
(
©h_so·c
 *
sc
,

515 
õì80211_vif
 *
vif
)

517 
	}
}

518 
ölöe
 
	$©h9k_p2p_bóc⁄_sync
(
©h_so·c
 *
sc
)

520 
	}
}

521 
ölöe
 
	$©h9k_p2p_bss_öfo_ch™ged
(
©h_so·c
 *
sc
,

522 
õì80211_vif
 *
vif
)

524 
	}
}

525 
ölöe
 
	$©h9k_bóc⁄_add_nﬂ
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
,

526 
sk_buff
 *
skb
)

528 
	}
}

529 
ölöe
 
	$©h9k_p2p_ps_timî
(
©h_so·c
 *
sc
)

531 
	}
}

532 
ölöe
 
	$©h9k_ch™˘x_wake_queues
(
©h_so·c
 *
sc
,

533 
©h_ch™˘x
 *
˘x
)

535 
	}
}

536 
ölöe
 
	$©h9k_ch™˘x_°›_queues
(
©h_so·c
 *
sc
,

537 
©h_ch™˘x
 *
˘x
)

539 
	}
}

540 
ölöe
 
	$©h_ch™˘x_check_a˘ive
(
©h_so·c
 *
sc
,

541 
©h_ch™˘x
 *
˘x
)

543 
	}
}

547 
©h_°¨åecv
(
©h_so·c
 *
sc
);

548 
boﬁ
 
©h_°›ªcv
(
©h_so·c
 *
sc
);

549 
u32
 
©h_ˇl¸xfûãr
(
©h_so·c
 *
sc
);

550 
©h_rx_öô
(
©h_so·c
 *
sc
, 
nbufs
);

551 
©h_rx_˛ónup
(
©h_so·c
 *
sc
);

552 
©h_rx_èskÀt
(
©h_so·c
 *
sc
, 
Êush
, 
boﬁ
 
hp
);

553 
©h_txq
 *
©h_txq_£tup
(
©h_so·c
 *
sc
, 
qty≥
, 
subty≥
);

554 
©h_txq_lock
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

555 
©h_txq_u∆ock
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

556 
©h_txq_u∆ock_com∂ëe
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

557 
©h_tx_˛ónupq
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

558 
boﬁ
 
©h_døö_Æl_txq
(
©h_so·c
 *
sc
);

559 
©h_døötxq
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

560 
©h_tx_node_öô
(
©h_so·c
 *
sc
, 
©h_node
 *
™
);

561 
©h_tx_node_˛ónup
(
©h_so·c
 *
sc
, 
©h_node
 *
™
);

562 
©h_txq_scheduÀ
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
);

563 
©h_txq_scheduÀ_Æl
(
©h_so·c
 *
sc
);

564 
©h_tx_öô
(
©h_so·c
 *
sc
, 
nbufs
);

565 
©h_txq_upd©e
(
©h_so·c
 *
sc
, 
qnum
,

566 
©h9k_tx_queue_öfo
 *
q
);

567 
©h_upd©e_max_aggr_‰amñí
(
©h_so·c
 *
sc
, 
queue
, 
tx›
);

568 
©h_assign_£q
(
©h_comm⁄
 *
comm⁄
, 
sk_buff
 *
skb
);

569 
©h_tx_°¨t
(
õì80211_hw
 *
hw
, 
sk_buff
 *
skb
,

570 
©h_tx_c⁄åﬁ
 *
tx˘l
);

571 
©h_tx_ˇbq
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

572 
sk_buff
 *
skb
);

573 
©h_tx_èskÀt
(
©h_so·c
 *
sc
);

574 
©h_tx_edma_èskÀt
(
©h_so·c
 *
sc
);

575 
©h_tx_aggr_°¨t
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
,

576 
u16
 
tid
, u16 *
s¢
);

577 
©h_tx_aggr_°›
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
, 
u16
 
tid
);

578 
©h_tx_aggr_ªsume
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
, 
u16
 
tid
);

580 
©h_tx_aggr_wakeup
(
©h_so·c
 *
sc
, 
©h_node
 *
™
);

581 
©h_tx_aggr_¶ìp
(
õì80211_°a
 *
°a
, 
©h_so·c
 *
sc
,

582 
©h_node
 *
™
);

583 
©h9k_ªÀa£_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

584 
õì80211_°a
 *
°a
,

585 
u16
 
tids
, 
n‰ames
,

586 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

587 
boﬁ
 
m‹e_d©a
);

593 
	#P2P_DEFAULT_CTWIN
 10

	)

595 
	s©h_vif
 {

596 
li°_hód
 
	mli°
;

598 
u16
 
	m£q_no
;

601 
u8
 
	mbssid
[
ETH_ALEN
] 
__Æig√d
(2);

602 
u16
 
	maid
;

603 
boﬁ
 
	massoc
;

605 
õì80211_vif
 *
	mvif
;

606 
©h_node
 
	mmˇ°_node
;

607 
	mav_b¶Ÿ
;

608 
__À64
 
	mtsf_adju°
;

609 
©h_buf
 *
	mav_bcbuf
;

610 
©h_ch™˘x
 *
	mch™˘x
;

613 
õì80211_nﬂ_d©a
 
	mnﬂ
;

616 
u8
 
	mnﬂ_ödex
;

617 
u32
 
	moffch™√l_°¨t
;

618 
u32
 
	moffch™√l_duøti⁄
;

621 
u32
 
	mnﬂ_°¨t
;

622 
u32
 
	mnﬂ_duøti⁄
;

623 
boﬁ
 
	m≥riodic_nﬂ
;

624 
boﬁ
 
	m⁄eshŸ_nﬂ
;

627 
	s©h9k_vif_ôî_d©a
 {

628 
u8
 
	mhw_maˇddr
[
ETH_ALEN
];

629 
u8
 
	mmask
[
ETH_ALEN
];

630 
boﬁ
 
	mhas_hw_maˇddr
;

631 
u8
 
	m¶Ÿtime
;

632 
boﬁ
 
	mbóc⁄s
;

634 
	m«ps
;

635 
	mnmeshes
;

636 
	mn°©i⁄s
;

637 
	mnwds
;

638 
	m«dhocs
;

639 
	mnocbs
;

640 
õì80211_vif
 *
	m¥im¨y_°a
;

643 
©h9k_ˇlcuœã_ôî_d©a
(
©h_so·c
 *
sc
,

644 
©h_ch™˘x
 *
˘x
,

645 
©h9k_vif_ôî_d©a
 *
ôî_d©a
);

646 
©h9k_ˇlcuœã_summ¨y_°©e
(
©h_so·c
 *
sc
,

647 
©h_ch™˘x
 *
˘x
);

648 
©h9k_£t_txpowî
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
);

659 
	#BSTUCK_THRESH
 9

	)

660 
	#ATH_BCBUF
 8

	)

661 
	#ATH_DEFAULT_BINTVAL
 100

	)

662 
	#ATH_DEFAULT_BMISS_LIMIT
 10

	)

664 
	#TSF_TO_TU
(
_h
,
_l
) \

665 ((((
u32
)(
_h
)Ë<< 22Ë| (((u32)(
_l
)Ë>> 10))

	)

667 
	s©h_bóc⁄
 {

669 
	mOK
,

670 
	mUPDATE
,

671 
	mCOMMIT


672 } 
	mupd©e¶Ÿ
;

674 
u32
 
	mbóc⁄q
;

675 
u32
 
	mbmiss˙t
;

676 
õì80211_vif
 *
	mb¶Ÿ
[
ATH_BCBUF
];

677 
	m¶Ÿtime
;

678 
	m¶Ÿupd©e
;

679 
©h_descdma
 
	mbdma
;

680 
©h_txq
 *
	mˇbq
;

681 
li°_hód
 
	mbbuf
;

683 
boﬁ
 
	mtx_¥o˚s£d
;

684 
boﬁ
 
	mtx_œ°
;

687 
©h9k_bóc⁄_èskÀt
(
d©a
);

688 
©h9k_bóc⁄_c⁄fig
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
,

689 
u32
 
ch™ged
);

690 
©h9k_bóc⁄_assign_¶Ÿ
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
);

691 
©h9k_bóc⁄_ªmove_¶Ÿ
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
);

692 
©h9k_£t_bóc⁄
(
©h_so·c
 *
sc
);

693 
boﬁ
 
©h9k_cß_is_föished
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
);

694 
©h9k_cß_upd©e
(
©h_so·c
 *
sc
);

700 
	#ATH_STA_SHORT_CALINTERVAL
 1000

	)

701 
	#ATH_AP_SHORT_CALINTERVAL
 100

	)

702 
	#ATH_ANI_POLLINTERVAL_OLD
 100

	)

703 
	#ATH_ANI_POLLINTERVAL_NEW
 1000

	)

704 
	#ATH_LONG_CALINTERVAL_INT
 1000

	)

705 
	#ATH_LONG_CALINTERVAL
 30000

	)

706 
	#ATH_RESTART_CALINTERVAL
 1200000

	)

707 
	#ATH_ANI_MAX_SKIP_COUNT
 10

	)

708 
	#ATH_PAPRD_TIMEOUT
 100

	)

709 
	#ATH_PLL_WORK_INTERVAL
 100

	)

711 
©h_tx_com∂ëe_pﬁl_w‹k
(
w‹k_°ru˘
 *
w‹k
);

712 
©h_ª£t_w‹k
(
w‹k_°ru˘
 *
w‹k
);

713 
boﬁ
 
©h_hw_check
(
©h_so·c
 *
sc
);

714 
©h_hw_∂l_w‹k
(
w‹k_°ru˘
 *
w‹k
);

715 
©h_∑¥d_ˇlibøã
(
w‹k_°ru˘
 *
w‹k
);

716 
©h_™i_ˇlibøã
(
d©a
);

717 
©h_°¨t_™i
(
©h_so·c
 *
sc
);

718 
©h_°›_™i
(
©h_so·c
 *
sc
);

719 
©h_check_™i
(
©h_so·c
 *
sc
);

720 
©h_upd©e_survey_°©s
(
©h_so·c
 *
sc
);

721 
©h_upd©e_survey_nf
(
©h_so·c
 *
sc
, 
ch™√l
);

722 
©h9k_queue_ª£t
(
©h_so·c
 *
sc
, 
©h_ª£t_ty≥
 
ty≥
);

723 
©h_ps_fuŒ_¶ìp
(
d©a
);

724 
__©h9k_Êush
(
õì80211_hw
 *
hw
, 
u32
 
queues
, 
boﬁ
 
dr›
,

725 
boﬁ
 
sw_≥ndög
, boﬁ 
timeout_ovîride
);

731 
	#ATH_DUMP_BTCOEX
(
_s
, 
_vÆ
) \

733 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, \

734 "%20†: %10d\n", 
_s
, (
_vÆ
)); \

735 } 0)

	)

737 
	ebt_›_Êags
 {

738 
	mBT_OP_PRIORITY_DETECTED
,

739 
	mBT_OP_SCAN
,

742 
	s©h_btc€x
 {

743 
•ölock_t
 
	mbtc€x_lock
;

744 
timî_li°
 
	m≥riod_timî
;

745 
timî_li°
 
	mno_°omp_timî
;

746 
u32
 
	mbt_¥i‹ôy_˙t
;

747 
	mbt_¥i‹ôy_time
;

748 
	m›_Êags
;

749 
	mbt_°omp_ty≥
;

750 
u32
 
	mbtc€x_no_°omp
;

751 
u32
 
	mbtc€x_≥riod
;

752 
u32
 
	mbtsˇn_no_°omp
;

753 
u32
 
	mduty_cy˛e
;

754 
u32
 
	mbt_waô_time
;

755 
	mrssi_cou¡
;

756 
©h_mci_¥ofûe
 
	mmci
;

757 
u8
 
	m°omp_audio
;

760 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


761 
©h9k_öô_btc€x
(
©h_so·c
 *
sc
);

762 
©h9k_deöô_btc€x
(
©h_so·c
 *
sc
);

763 
©h9k_°¨t_btc€x
(
©h_so·c
 *
sc
);

764 
©h9k_°›_btc€x
(
©h_so·c
 *
sc
);

765 
©h9k_btc€x_timî_ªsume
(
©h_so·c
 *
sc
);

766 
©h9k_btc€x_timî_∑u£
(
©h_so·c
 *
sc
);

767 
©h9k_btc€x_h™dÀ_öãºu±
(
©h_so·c
 *
sc
, 
u32
 
°©us
);

768 
u16
 
©h9k_btc€x_aggr_limô
(
©h_so·c
 *
sc
, 
u32
 
max_4ms_‰amñí
);

769 
©h9k_btc€x_°›_gí_timî
(
©h_so·c
 *
sc
);

770 
©h9k_dump_btc€x
(
©h_so·c
 *
sc
, 
u8
 *
buf
, 
u32
 
size
);

772 
ölöe
 
	$©h9k_öô_btc€x
(
©h_so·c
 *
sc
)

775 
	}
}

776 
ölöe
 
	$©h9k_deöô_btc€x
(
©h_so·c
 *
sc
)

778 
	}
}

779 
ölöe
 
	$©h9k_°¨t_btc€x
(
©h_so·c
 *
sc
)

781 
	}
}

782 
ölöe
 
	$©h9k_°›_btc€x
(
©h_so·c
 *
sc
)

784 
	}
}

785 
ölöe
 
	$©h9k_btc€x_h™dÀ_öãºu±
(
©h_so·c
 *
sc
,

786 
u32
 
°©us
)

788 
	}
}

789 
ölöe
 
u16
 
	$©h9k_btc€x_aggr_limô
(
©h_so·c
 *
sc
,

790 
u32
 
max_4ms_‰amñí
)

793 
	}
}

794 
ölöe
 
	$©h9k_btc€x_°›_gí_timî
(
©h_so·c
 *
sc
)

796 
	}
}

797 
ölöe
 
	$©h9k_dump_btc€x
(
©h_so·c
 *
sc
, 
u8
 *
buf
, 
u32
 
size
)

800 
	}
}

807 
	#ATH_LED_PIN_DEF
 1

	)

808 
	#ATH_LED_PIN_9287
 8

	)

809 
	#ATH_LED_PIN_9300
 10

	)

810 
	#ATH_LED_PIN_9485
 6

	)

811 
	#ATH_LED_PIN_9462
 4

	)

813 #ifde‡
CPTCFG_MAC80211_LEDS


814 
©h_öô_Àds
(
©h_so·c
 *
sc
);

815 
©h_deöô_Àds
(
©h_so·c
 *
sc
);

816 
©h_fûl_Àd_pö
(
©h_so·c
 *
sc
);

817 
©h_¸óã_gpio_Àd
(
©h_so·c
 *
sc
, 
gpio
, c⁄° *
«me
,

818 c⁄° *
åiggî
, 
boﬁ
 
a˘ive_low
);

821 
ölöe
 
	$©h_öô_Àds
(
©h_so·c
 *
sc
)

823 
	}
}

825 
ölöe
 
	$©h_deöô_Àds
(
©h_so·c
 *
sc
)

827 
	}
}

828 
ölöe
 
	$©h_fûl_Àd_pö
(
©h_so·c
 *
sc
)

830 
	}
}

837 #ifde‡
CPTCFG_ATH9K_WOW


838 
©h9k_öô_wow
(
õì80211_hw
 *
hw
);

839 
©h9k_deöô_wow
(
õì80211_hw
 *
hw
);

840 
©h9k_su•íd
(
õì80211_hw
 *
hw
,

841 
cfg80211_wowœn
 *
wowœn
);

842 
©h9k_ªsume
(
õì80211_hw
 *
hw
);

843 
©h9k_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
);

845 
ölöe
 
	$©h9k_öô_wow
(
õì80211_hw
 *
hw
)

847 
	}
}

848 
ölöe
 
	$©h9k_deöô_wow
(
õì80211_hw
 *
hw
)

850 
	}
}

851 
ölöe
 
	$©h9k_su•íd
(
õì80211_hw
 *
hw
,

852 
cfg80211_wowœn
 *
wowœn
)

855 
	}
}

856 
ölöe
 
	$©h9k_ªsume
(
õì80211_hw
 *
hw
)

859 
	}
}

860 
ölöe
 
	$©h9k_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
)

862 
	}
}

869 
	#ATH_ANT_RX_CURRENT_SHIFT
 4

	)

870 
	#ATH_ANT_RX_MAIN_SHIFT
 2

	)

871 
	#ATH_ANT_RX_MASK
 0x3

	)

873 
	#ATH_ANT_DIV_COMB_SHORT_SCAN_INTR
 50

	)

874 
	#ATH_ANT_DIV_COMB_SHORT_SCAN_PKTCOUNT
 0x100

	)

875 
	#ATH_ANT_DIV_COMB_MAX_PKTCOUNT
 0x200

	)

876 
	#ATH_ANT_DIV_COMB_INIT_COUNT
 95

	)

877 
	#ATH_ANT_DIV_COMB_MAX_COUNT
 100

	)

878 
	#ATH_ANT_DIV_COMB_ALT_ANT_RATIO
 30

	)

879 
	#ATH_ANT_DIV_COMB_ALT_ANT_RATIO2
 20

	)

880 
	#ATH_ANT_DIV_COMB_ALT_ANT_RATIO_LOW_RSSI
 50

	)

881 
	#ATH_ANT_DIV_COMB_ALT_ANT_RATIO2_LOW_RSSI
 50

	)

883 
	#ATH_ANT_DIV_COMB_LNA1_DELTA_HI
 -4

	)

884 
	#ATH_ANT_DIV_COMB_LNA1_DELTA_MID
 -2

	)

885 
	#ATH_ANT_DIV_COMB_LNA1_DELTA_LOW
 2

	)

887 
	s©h_™t_comb
 {

888 
u16
 
	mcou¡
;

889 
u16
 
	mtŸÆ_pkt_cou¡
;

890 
boﬁ
 
	msˇn
;

891 
boﬁ
 
	msˇn_nŸ_°¨t
;

892 
	mmaö_tŸÆ_rssi
;

893 
	mÆt_tŸÆ_rssi
;

894 
	mÆt_ªcv_˙t
;

895 
	mmaö_ªcv_˙t
;

896 
	mrssi_ a1
;

897 
	mrssi_ a2
;

898 
	mrssi_add
;

899 
	mrssi_sub
;

900 
	mrssi_fú°
;

901 
	mrssi_£c⁄d
;

902 
	mrssi_thúd
;

903 
	m™t_øtio
;

904 
	m™t_øtio2
;

905 
boﬁ
 
	mÆt_good
;

906 
	mquick_sˇn_˙t
;

907 
©h9k_™t_div_comb_ a_c⁄f
 
	mmaö_c⁄f
;

908 
©h9k_™t_div_comb_ a_c⁄f
 
	mfú°_quick_sˇn_c⁄f
;

909 
©h9k_™t_div_comb_ a_c⁄f
 
	m£c⁄d_quick_sˇn_c⁄f
;

910 
boﬁ
 
	mfú°_øtio
;

911 
boﬁ
 
	m£c⁄d_øtio
;

912 
	msˇn_°¨t_time
;

917 
	mlow_rssi_thªsh
;

918 
	mÁ°_div_büs
;

921 
©h_™t_comb_sˇn
(
©h_so·c
 *
sc
, 
©h_rx_°©us
 *
rs
);

927 
	#ATH9K_PCI_CUS198
 0x0001

	)

928 
	#ATH9K_PCI_CUS230
 0x0002

	)

929 
	#ATH9K_PCI_CUS217
 0x0004

	)

930 
	#ATH9K_PCI_CUS252
 0x0008

	)

931 
	#ATH9K_PCI_WOW
 0x0010

	)

932 
	#ATH9K_PCI_BT_ANT_DIV
 0x0020

	)

933 
	#ATH9K_PCI_D3_L1_WAR
 0x0040

	)

934 
	#ATH9K_PCI_AR9565_1ANT
 0x0080

	)

935 
	#ATH9K_PCI_AR9565_2ANT
 0x0100

	)

936 
	#ATH9K_PCI_NO_PLL_PWRSAVE
 0x0200

	)

937 
	#ATH9K_PCI_KILLER
 0x0400

	)

938 
	#ATH9K_PCI_LED_ACT_HI
 0x0800

	)

944 
	#DEFAULT_CACHELINE
 32

	)

945 
	#ATH_CABQ_READY_TIME
 80

	)

946 
	#ATH_TXPOWER_MAX
 100

	)

947 
	#MAX_GTT_CNT
 5

	)

950 
	#PS_WAIT_FOR_BEACON
 
	`BIT
(0)

	)

951 
	#PS_WAIT_FOR_CAB
 
	`BIT
(1)

	)

952 
	#PS_WAIT_FOR_PSPOLL_DATA
 
	`BIT
(2)

	)

953 
	#PS_WAIT_FOR_TX_ACK
 
	`BIT
(3)

	)

954 
	#PS_BEACON_SYNC
 
	`BIT
(4)

	)

955 
	#PS_WAIT_FOR_ANI
 
	`BIT
(5)

	)

957 
	#ATH9K_NUM_CHANCTX
 2

	)

959 
	s©h_Àd
 {

960 
li°_hód
 
	mli°
;

961 
©h_so·c
 *
	msc
;

962 c⁄° 
gpio_Àd
 *
	mgpio
;

963 
Àd_˛assdev
 
	mcdev
;

966 
	s©h_so·c
 {

967 
õì80211_hw
 *
	mhw
;

968 
devi˚
 *
	mdev
;

970 
survey_öfo
 *
	mcur_survey
;

971 
survey_öfo
 
	msurvey
[
ATH9K_NUM_CHANNELS
];

973 
èskÀt_°ru˘
 
	möå_tq
;

974 
èskÀt_°ru˘
 
	mbc⁄_èskÀt
;

975 
©h_hw
 *
	msc_ah
;

976 
__iomem
 *
	mmem
;

977 
	múq
;

978 
•ölock_t
 
	msc_£rül_rw
;

979 
•ölock_t
 
	msc_pm_lock
;

980 
•ölock_t
 
	msc_pcu_lock
;

981 
muãx
 
	mmuãx
;

982 
w‹k_°ru˘
 
	m∑¥d_w‹k
;

983 
w‹k_°ru˘
 
	mhw_ª£t_w‹k
;

984 
com∂ëi⁄
 
	m∑¥d_com∂ëe
;

985 
waô_queue_hód_t
 
	mtx_waô
;

987 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


988 
w‹k_°ru˘
 
	mch™˘x_w‹k
;

989 
©h_gí_timî
 *
	mp2p_ps_timî
;

990 
©h_vif
 *
	mp2p_ps_vif
;

991 
©h_ch™˘x_sched
 
	msched
;

992 
©h_offch™√l
 
	moffch™√l
;

993 
©h_ch™˘x
 *
	m√xt_ch™
;

994 
com∂ëi⁄
 
	mgo_bóc⁄
;

995 
time•ec
 
	mœ°_evít_time
;

998 
	mdrivî_d©a
;

1000 
u8
 
	mgâ_˙t
;

1001 
u32
 
	möå°©us
;

1002 
u16
 
	mps_Êags
;

1003 
boﬁ
 
	mps_íabÀd
;

1004 
boﬁ
 
	mps_idÀ
;

1005 
	mnb˙vifs
;

1006 
	mps_u£cou¡
;

1008 
©h_rx
 
	mrx
;

1009 
©h_tx
 
	mtx
;

1010 
©h_bóc⁄
 
	mbóc⁄
;

1012 
cfg80211_ch™_def
 
	mcur_ch™def
;

1013 
©h_ch™˘x
 
	mch™˘x
[
ATH9K_NUM_CHANCTX
];

1014 
©h_ch™˘x
 *
	mcur_ch™
;

1015 
•ölock_t
 
	mch™_lock
;

1017 #ifde‡
CPTCFG_MAC80211_LEDS


1018 c⁄° *
	mÀd_deÁu…_åiggî
;

1019 
li°_hód
 
	mÀds
;

1022 #ifde‡
CPTCFG_ATH9K_DEBUGFS


1023 
©h9k_debug
 
	mdebug
;

1025 
dñayed_w‹k
 
	mtx_com∂ëe_w‹k
;

1026 
dñayed_w‹k
 
	mhw_∂l_w‹k
;

1027 
timî_li°
 
	m¶ìp_timî
;

1029 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


1030 
©h_btc€x
 
	mbtc€x
;

1031 
©h_mci_c€x
 
	mmci_c€x
;

1032 
w‹k_°ru˘
 
	mmci_w‹k
;

1035 
©h_descdma
 
	mtxsdma
;

1037 
©h_™t_comb
 
	m™t_comb
;

1038 
u8
 
	m™t_tx
, 
	m™t_rx
;

1039 
dfs_∑âîn_dëe˘‹
 *
	mdfs_dëe˘‹
;

1040 
u64
 
	mdfs_¥ev_pul£_ts
;

1041 
u32
 
	mwow_íabÀd
;

1043 
©h_•ec_sˇn_¥iv
 
	m•ec_¥iv
;

1045 
õì80211_vif
 *
	mtx99_vif
;

1046 
sk_buff
 *
	mtx99_skb
;

1047 
boﬁ
 
	mtx99_°©e
;

1048 
s16
 
	mtx99_powî
;

1050 #ifde‡
CPTCFG_ATH9K_WOW


1051 
u32
 
	mwow_öå_bef‹e_¶ìp
;

1052 
boﬁ
 
	mf‹˚_wow
;

1055 #ifde‡
CPTCFG_ATH9K_HWRNG


1056 
u32
 
	m∫g_œ°
;

1057 
èsk_°ru˘
 *
	m∫g_èsk
;

1065 #ifde‡
CPTCFG_ATH9K_TX99


1066 
©h9k_tx99_öô_debug
(
©h_so·c
 *
sc
);

1067 
©h9k_tx99_£nd
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
,

1068 
©h_tx_c⁄åﬁ
 *
tx˘l
);

1070 
ölöe
 
	$©h9k_tx99_öô_debug
(
©h_so·c
 *
sc
)

1072 
	}
}

1073 
ölöe
 
	$©h9k_tx99_£nd
(
©h_so·c
 *
sc
,

1074 
sk_buff
 *
skb
,

1075 
©h_tx_c⁄åﬁ
 *
tx˘l
)

1078 
	}
}

1084 #ifde‡
CPTCFG_ATH9K_HWRNG


1085 
©h9k_∫g_°¨t
(
©h_so·c
 *
sc
);

1086 
©h9k_∫g_°›
(
©h_so·c
 *
sc
);

1088 
ölöe
 
	$©h9k_∫g_°¨t
(
©h_so·c
 *
sc
)

1090 
	}
}

1092 
ölöe
 
	$©h9k_∫g_°›
(
©h_so·c
 *
sc
)

1094 
	}
}

1097 
ölöe
 
	$©h_ªad_ˇchesize
(
©h_comm⁄
 *
comm⁄
, *
csz
)

1099 
comm⁄
->
bus_›s
->
	`ªad_ˇchesize
(comm⁄, 
csz
);

1100 
	}
}

1102 
©h9k_èskÀt
(
d©a
);

1103 
©h_ˇbq_upd©e
(
©h_so·c
 *);

1104 
u8
 
©h9k_∑r£_mpdudísôy
(u8 
mpdudísôy
);

1105 
úqªtu∫_t
 
©h_i§
(
úq
, *
dev
);

1106 
©h_ª£t
(
©h_so·c
 *
sc
, 
©h9k_ch™√l
 *
hch™
);

1107 
©h_ˇn˚l_w‹k
(
©h_so·c
 *
sc
);

1108 
©h_ª°¨t_w‹k
(
©h_so·c
 *
sc
);

1109 
©h9k_öô_devi˚
(
u16
 
devid
, 
©h_so·c
 *
sc
,

1110 c⁄° 
©h_bus_›s
 *
bus_›s
);

1111 
©h9k_deöô_devi˚
(
©h_so·c
 *
sc
);

1112 
©h9k_ªlﬂd_chaömask_£âögs
(
©h_so·c
 *
sc
);

1113 
u8
 
©h_txchaömask_ªdu˘i⁄
(
©h_so·c
 *
sc
, u8 
chaömask
, 
u32
 
øã
);

1114 
©h_°¨t_rfkûl_pﬁl
(
©h_so·c
 *
sc
);

1115 
©h9k_rfkûl_pﬁl_°©e
(
õì80211_hw
 *
hw
);

1116 
©h9k_ps_wakeup
(
©h_so·c
 *
sc
);

1117 
©h9k_ps_ª°‹e
(
©h_so·c
 *
sc
);

1119 #ifde‡
CPTCFG_ATH9K_PCI


1120 
©h_pci_öô
();

1121 
©h_pci_exô
();

1123 
ölöe
 
	$©h_pci_öô
(Ë{  0; 
	}
};

1124 
ölöe
 
	$©h_pci_exô
(Ë{
	}
};

1127 #ifde‡
CPTCFG_ATH9K_AHB


1128 
©h_ahb_öô
();

1129 
©h_ahb_exô
();

1131 
ölöe
 
	$©h_ahb_öô
(Ë{  0; 
	}
};

1132 
ölöe
 
	$©h_ahb_exô
(Ë{
	}
};

	@ath9k.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

6 
__visibÀ
 
moduÀ
 
__this_moduÀ


7 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

8 .
«me
 = 
KBUILD_MODNAME
,

9 .
	göô
 = 
öô_moduÀ
,

10 #ifde‡
CONFIG_MODULE_UNLOAD


11 .
	gexô
 = 
˛ónup_moduÀ
,

13 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

16 c⁄° 
	g__moduÀ_dïíds
[]

17 
__u£d


18 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

	@ath9k_common.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

6 
__visibÀ
 
moduÀ
 
__this_moduÀ


7 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

8 .
«me
 = 
KBUILD_MODNAME
,

9 .
	göô
 = 
öô_moduÀ
,

10 #ifde‡
CONFIG_MODULE_UNLOAD


11 .
	gexô
 = 
˛ónup_moduÀ
,

13 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

16 c⁄° 
	g__moduÀ_dïíds
[]

17 
__u£d


18 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

	@ath9k_hw.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

6 
__visibÀ
 
moduÀ
 
__this_moduÀ


7 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

8 .
«me
 = 
KBUILD_MODNAME
,

9 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

12 c⁄° 
	g__moduÀ_dïíds
[]

13 
__u£d


14 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

	@beacon.c

17 
	~<löux/dma-m≠pög.h
>

18 
	~"©h9k.h
"

20 
	#FUDGE
 2

	)

22 
	$©h9k_ª£t_bóc⁄_°©us
(
©h_so·c
 *
sc
)

24 
sc
->
bóc⁄
.
tx_¥o˚s£d
 = 
Ál£
;

25 
sc
->
bóc⁄
.
tx_œ°
 = 
Ál£
;

26 
	}
}

33 
	$©h9k_bóc⁄q_c⁄fig
(
©h_so·c
 *
sc
)

35 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

36 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

37 
©h9k_tx_queue_öfo
 
qi
, 
qi_be
;

38 
©h_txq
 *
txq
;

40 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
, &
qi
);

42 i‡(
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_AP
 ||

43 
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_MESH_POINT
) {

45 
qi
.
tqi_aifs
 = 1;

46 
qi
.
tqi_cwmö
 = 0;

47 
qi
.
tqi_cwmax
 = 0;

50 
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_BE
];

51 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
txq
->
axq_qnum
, &
qi_be
);

52 
qi
.
tqi_aifs
 = 
qi_be
.tqi_aifs;

53 i‡(
ah
->
¶Ÿtime
 =
ATH9K_SLOT_TIME_20
)

54 
qi
.
tqi_cwmö
 = 2*
qi_be
.tqi_cwmin;

56 
qi
.
tqi_cwmö
 = 4*
qi_be
.tqi_cwmin;

57 
qi
.
tqi_cwmax
 = 
qi_be
.tqi_cwmax;

60 i‡(!
	`©h9k_hw_£t_txq_¥›s
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
, &
qi
)) {

61 
	`©h_îr
(
comm⁄
, "UnableÅo update h/w beacon queueÖarameters\n");

63 
	`©h9k_hw_ª£âxqueue
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
);

65 
	}
}

72 
	$©h9k_bóc⁄_£tup
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
,

73 
©h_buf
 *
bf
, 
øãidx
)

75 
sk_buff
 *
skb
 = 
bf
->
bf_mpdu
;

76 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

77 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

78 
©h_tx_öfo
 
öfo
;

79 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

80 
u8
 
chaömask
 = 
ah
->
txchaömask
;

81 
u8
 
i
, 
øã
 = 0;

83 
sb™d
 = &
comm⁄
->
sb™ds
[
sc
->
cur_ch™def
.
ch™
->
b™d
];

84 
øã
 = 
sb™d
->
bôøãs
[
øãidx
].
hw_vÆue
;

85 i‡(
vif
->
bss_c⁄f
.
u£_sh‹t_¥ómbÀ
)

86 
øã
 |
sb™d
->
bôøãs
[
øãidx
].
hw_vÆue_sh‹t
;

88 
	`mem£t
(&
öfo
, 0, (info));

89 
öfo
.
pkt_Àn
 = 
skb
->
Àn
 + 
FCS_LEN
;

90 
öfo
.
ty≥
 = 
ATH9K_PKT_TYPE_BEACON
;

91 
i
 = 0; i < 4; i++)

92 
öfo
.
txpowî
[
i
] = 
MAX_RATE_POWER
;

93 
öfo
.
keyix
 = 
ATH9K_TXKEYIX_INVALID
;

94 
öfo
.
keyty≥
 = 
ATH9K_KEY_TYPE_CLEAR
;

95 
öfo
.
Êags
 = 
ATH9K_TXDESC_NOACK
 | 
ATH9K_TXDESC_CLRDMASK
;

97 
öfo
.
buf_addr
[0] = 
bf
->
bf_buf_addr
;

98 
öfo
.
buf_Àn
[0] = 
	`roundup
(
skb
->
Àn
, 4);

100 
öfo
.
is_fú°
 = 
åue
;

101 
öfo
.
is_œ°
 = 
åue
;

103 
öfo
.
qcu
 = 
sc
->
bóc⁄
.
bóc⁄q
;

105 
öfo
.
øãs
[0].
Trõs
 = 1;

106 
öfo
.
øãs
[0].
R©e
 = 
øã
;

107 
öfo
.
øãs
[0].
ChSñ
 = 
	`©h_txchaömask_ªdu˘i⁄
(
sc
, 
chaömask
, 
øã
);

109 
	`©h9k_hw_£t_txdesc
(
ah
, 
bf
->
bf_desc
, &
öfo
);

110 
	}
}

112 
©h_buf
 *
	$©h9k_bóc⁄_gíî©e
(
õì80211_hw
 *
hw
,

113 
õì80211_vif
 *
vif
)

115 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

116 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

117 
©h_buf
 *
bf
;

118 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

119 
sk_buff
 *
skb
;

120 
©h_txq
 *
ˇbq
 = 
sc
->
bóc⁄
.cabq;

121 
õì80211_tx_öfo
 *
öfo
;

122 
õì80211_mgmt
 *
mgmt_hdr
;

123 
ˇbq_dïth
;

125 i‡(
avp
->
av_bcbuf
 =
NULL
)

126  
NULL
;

128 
bf
 = 
avp
->
av_bcbuf
;

129 
skb
 = 
bf
->
bf_mpdu
;

130 i‡(
skb
) {

131 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

132 
skb
->
Àn
, 
DMA_TO_DEVICE
);

133 
	`dev_k‰ì_skb_™y
(
skb
);

134 
bf
->
bf_buf_addr
 = 0;

135 
bf
->
bf_mpdu
 = 
NULL
;

138 
skb
 = 
	`õì80211_bóc⁄_gë
(
hw
, 
vif
);

139 i‡(
skb
 =
NULL
)

140  
NULL
;

142 
bf
->
bf_mpdu
 = 
skb
;

144 
mgmt_hdr
 = (
õì80211_mgmt
 *)
skb
->
d©a
;

145 
mgmt_hdr
->
u
.
bóc⁄
.
time°amp
 = 
avp
->
tsf_adju°
;

147 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

149 
	`©h_assign_£q
(
comm⁄
, 
skb
);

152 i‡(
	`©h9k_is_ch™˘x_íabÀd
())

153 
	`©h9k_bóc⁄_add_nﬂ
(
sc
, 
avp
, 
skb
);

155 
bf
->
bf_buf_addr
 = 
	`dma_m≠_sögÀ
(
sc
->
dev
, 
skb
->
d©a
,

156 
skb
->
Àn
, 
DMA_TO_DEVICE
);

157 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
sc
->
dev
, 
bf
->
bf_buf_addr
))) {

158 
	`dev_k‰ì_skb_™y
(
skb
);

159 
bf
->
bf_mpdu
 = 
NULL
;

160 
bf
->
bf_buf_addr
 = 0;

161 
	`©h_îr
(
comm⁄
, "dma_mapping_error on beaconing\n");

162  
NULL
;

165 
skb
 = 
	`õì80211_gë_buf„ªd_bc
(
hw
, 
vif
);

175 
	`•ö_lock_bh
(&
ˇbq
->
axq_lock
);

176 
ˇbq_dïth
 = 
ˇbq
->
axq_dïth
;

177 
	`•ö_u∆ock_bh
(&
ˇbq
->
axq_lock
);

179 i‡(
skb
 && 
ˇbq_dïth
) {

180 i‡(
sc
->
cur_ch™
->
nvifs
 > 1) {

181 
	`©h_dbg
(
comm⁄
, 
BEACON
,

183 
	`©h_døötxq
(
sc
, 
ˇbq
);

187 
	`©h9k_bóc⁄_£tup
(
sc
, 
vif
, 
bf
, 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
);

189 i‡(
skb
)

190 
	`©h_tx_ˇbq
(
hw
, 
vif
, 
skb
);

192  
bf
;

193 
	}
}

195 
	$©h9k_bóc⁄_assign_¶Ÿ
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

197 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

198 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

199 
¶Ÿ
;

201 
avp
->
av_bcbuf
 = 
	`li°_fú°_íåy
(&
sc
->
bóc⁄
.
bbuf
, 
©h_buf
, 
li°
);

202 
	`li°_dñ
(&
avp
->
av_bcbuf
->
li°
);

204 
¶Ÿ
 = 0; slŸ < 
ATH_BCBUF
; slot++) {

205 i‡(
sc
->
bóc⁄
.
b¶Ÿ
[
¶Ÿ
] =
NULL
) {

206 
avp
->
av_b¶Ÿ
 = 
¶Ÿ
;

211 
sc
->
bóc⁄
.
b¶Ÿ
[
avp
->
av_b¶Ÿ
] = 
vif
;

212 
sc
->
nb˙vifs
++;

214 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Added interfaceát beacon slot: %d\n",

215 
avp
->
av_b¶Ÿ
);

216 
	}
}

218 
	$©h9k_bóc⁄_ªmove_¶Ÿ
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

220 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

221 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

222 
©h_buf
 *
bf
 = 
avp
->
av_bcbuf
;

223 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

225 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Removing interfaceát beacon slot: %d\n",

226 
avp
->
av_b¶Ÿ
);

228 
	`èskÀt_dißbÀ
(&
sc
->
bc⁄_èskÀt
);

230 
cur_c⁄f
->
íabÀ_bóc⁄
 &~
	`BIT
(
avp
->
av_b¶Ÿ
);

232 i‡(
bf
 && bf->
bf_mpdu
) {

233 
sk_buff
 *
skb
 = 
bf
->
bf_mpdu
;

234 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

235 
skb
->
Àn
, 
DMA_TO_DEVICE
);

236 
	`dev_k‰ì_skb_™y
(
skb
);

237 
bf
->
bf_mpdu
 = 
NULL
;

238 
bf
->
bf_buf_addr
 = 0;

241 
avp
->
av_bcbuf
 = 
NULL
;

242 
sc
->
bóc⁄
.
b¶Ÿ
[
avp
->
av_b¶Ÿ
] = 
NULL
;

243 
sc
->
nb˙vifs
--;

244 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
bóc⁄
.
bbuf
);

246 
	`èskÀt_íabÀ
(&
sc
->
bc⁄_èskÀt
);

247 
	}
}

249 
	$©h9k_bóc⁄_choo£_¶Ÿ
(
©h_so·c
 *
sc
)

251 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

252 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

253 
u16
 
ötvÆ
;

254 
u32
 
ts·u
;

255 
u64
 
tsf
;

256 
¶Ÿ
;

258 i‡(
sc
->
sc_ah
->
›mode
 !
NL80211_IFTYPE_AP
 &&

259 
sc
->
sc_ah
->
›mode
 !
NL80211_IFTYPE_MESH_POINT
) {

260 
	`©h_dbg
(
comm⁄
, 
BEACON
, "slot 0,Åsf: %llu\n",

261 
	`©h9k_hw_gëtsf64
(
sc
->
sc_ah
));

265 
ötvÆ
 = 
cur_c⁄f
->
bóc⁄_öãrvÆ
 ? : 
ATH_DEFAULT_BINTVAL
;

266 
tsf
 = 
	`©h9k_hw_gëtsf64
(
sc
->
sc_ah
);

267 
tsf
 +
	`TU_TO_USEC
(
sc
->
sc_ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
);

268 
ts·u
 = 
	`TSF_TO_TU
((
tsf
 * 
ATH_BCBUF
) >>32,Åsf * ATH_BCBUF);

269 
¶Ÿ
 = (
ts·u
 % (
ötvÆ
 * 
ATH_BCBUF
)) / intval;

271 
	`©h_dbg
(
comm⁄
, 
BEACON
, "slot: %dÅsf: %lluÅsftu: %u\n",

272 
¶Ÿ
, 
tsf
, 
ts·u
 / 
ATH_BCBUF
);

274  
¶Ÿ
;

275 
	}
}

277 
	$©h9k_£t_tsÁdju°
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

279 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

280 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

281 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
avp
->
ch™˘x
->
bóc⁄
;

282 
u32
 
tsÁdju°
;

284 i‡(
avp
->
av_b¶Ÿ
 == 0)

287 
tsÁdju°
 = 
cur_c⁄f
->
bóc⁄_öãrvÆ
 * 
avp
->
av_b¶Ÿ
;

288 
tsÁdju°
 = 
	`TU_TO_USEC
—sÁdju°Ë/ 
ATH_BCBUF
;

289 
avp
->
tsf_adju°
 = 
	`˝u_to_À64
(
tsÁdju°
);

291 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "tsfadjust is: %llu for bslot: %d\n",

292 ()
tsÁdju°
, 
avp
->
av_b¶Ÿ
);

293 
	}
}

295 
boﬁ
 
	$©h9k_cß_is_föished
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

297 i‡(!
vif
 || !vif->
cß_a˘ive
)

298  
Ál£
;

300 i‡(!
	`õì80211_cß_is_com∂ëe
(
vif
))

301  
Ál£
;

303 
	`õì80211_cß_föish
(
vif
);

304  
åue
;

305 
	}
}

307 
	$©h9k_cß_upd©e_vif
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

309 
©h_so·c
 *
sc
 = 
d©a
;

310 
	`©h9k_cß_is_föished
(
sc
, 
vif
);

311 
	}
}

313 
	$©h9k_cß_upd©e
(
©h_so·c
 *
sc
)

315 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
sc
->
hw
,

316 
IEEE80211_IFACE_ITER_NORMAL
,

317 
©h9k_cß_upd©e_vif
, 
sc
);

318 
	}
}

320 
	$©h9k_bóc⁄_èskÀt
(
d©a
)

322 
©h_so·c
 *
sc
 = (©h_so·¯*)
d©a
;

323 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

324 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

325 
©h_buf
 *
bf
 = 
NULL
;

326 
õì80211_vif
 *
vif
;

327 
boﬁ
 
edma
 = !!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
);

328 
¶Ÿ
;

330 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
)) {

331 
	`©h_dbg
(
comm⁄
, 
RESET
,

343 i‡(
	`©h9k_hw_numtx≥ndög
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
) != 0) {

344 
sc
->
bóc⁄
.
bmiss˙t
++;

346 
	`©h9k_hw_check_«v
(
ah
);

354 i‡(!
	`©h_hw_check
(
sc
))

357 i‡(
sc
->
bóc⁄
.
bmiss˙t
 < 
BSTUCK_THRESH
 * sc->
nb˙vifs
) {

358 
	`©h_dbg
(
comm⁄
, 
BSTUCK
,

360 
sc
->
bóc⁄
.
bmiss˙t
);

361 
	`©h9k_hw_°›_dma_queue
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
);

362 i‡(
sc
->
bóc⁄
.
bmiss˙t
 > 3)

363 
	`©h9k_hw_b°uck_nfˇl
(
ah
);

364 } i‡(
sc
->
bóc⁄
.
bmiss˙t
 >
BSTUCK_THRESH
) {

365 
	`©h_dbg
(
comm⁄
, 
BSTUCK
, "beacon is officially stuck\n");

366 
sc
->
bóc⁄
.
bmiss˙t
 = 0;

367 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_BEACON_STUCK
);

373 
¶Ÿ
 = 
	`©h9k_bóc⁄_choo£_¶Ÿ
(
sc
);

374 
vif
 = 
sc
->
bóc⁄
.
b¶Ÿ
[
¶Ÿ
];

377 i‡(!
edma
) {

378 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

379 
	`©h_ch™˘x_bóc⁄_£¡_ev
(
sc
,

380 
ATH_CHANCTX_EVENT_BEACON_SENT
);

383 i‡(
	`©h9k_cß_is_föished
(
sc
, 
vif
))

387 i‡(!
vif
 || !vif->
bss_c⁄f
.
íabÀ_bóc⁄
)

390 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

391 
	`©h_ch™˘x_evít
(
sc
, 
vif
, 
ATH_CHANCTX_EVENT_BEACON_PREPARE
);

394 
bf
 = 
	`©h9k_bóc⁄_gíî©e
(
sc
->
hw
, 
vif
);

396 i‡(
sc
->
bóc⁄
.
bmiss˙t
 != 0) {

397 
	`©h_dbg
(
comm⁄
, 
BSTUCK
, "resume beacon xmitáfter %u misses\n",

398 
sc
->
bóc⁄
.
bmiss˙t
);

399 
sc
->
bóc⁄
.
bmiss˙t
 = 0;

418 i‡(
sc
->
bóc⁄
.
upd©e¶Ÿ
 =
UPDATE
) {

419 
sc
->
bóc⁄
.
upd©e¶Ÿ
 = 
COMMIT
;

420 
sc
->
bóc⁄
.
¶Ÿupd©e
 = 
¶Ÿ
;

421 } i‡(
sc
->
bóc⁄
.
upd©e¶Ÿ
 =
COMMIT
 &&

422 
sc
->
bóc⁄
.
¶Ÿupd©e
 =
¶Ÿ
) {

423 
ah
->
¶Ÿtime
 = 
sc
->
bóc⁄
.slottime;

424 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

425 
sc
->
bóc⁄
.
upd©e¶Ÿ
 = 
OK
;

428 i‡(
bf
) {

429 
	`©h9k_ª£t_bóc⁄_°©us
(
sc
);

431 
	`©h_dbg
(
comm⁄
, 
BEACON
,

432 "Tønsmôtög bóc⁄ f‹ slŸ: %d\n", 
¶Ÿ
);

435 
	`©h9k_hw_puâxbuf
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
, 
bf
->
bf_daddr
);

437 i‡(!
edma
)

438 
	`©h9k_hw_tx°¨t
(
ah
, 
sc
->
bóc⁄
.
bóc⁄q
);

440 
	}
}

445 
	$©h9k_bóc⁄_öô
(
©h_so·c
 *
sc
, 
u32
 
√xâbâ
,

446 
u32
 
ötvÆ
, 
boﬁ
 
ª£t_tsf
)

448 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

450 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

451 i‡(
ª£t_tsf
)

452 
	`©h9k_hw_ª£t_tsf
(
ah
);

453 
	`©h9k_bóc⁄q_c⁄fig
(
sc
);

454 
	`©h9k_hw_bóc⁄öô
(
ah
, 
√xâbâ
, 
ötvÆ
);

455 
sc
->
bóc⁄
.
bmiss˙t
 = 0;

456 
	`©h9k_hw_£t_öãºu±s
(
ah
);

457 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

458 
	}
}

465 
	$©h9k_bóc⁄_c⁄fig_≠
(
©h_so·c
 *
sc
,

466 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

468 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

470 
	`©h9k_cmn_bóc⁄_c⁄fig_≠
(
ah
, 
c⁄f
, 
ATH_BCBUF
);

471 
	`©h9k_bóc⁄_öô
(
sc
, 
c⁄f
->
√xâbâ
, c⁄f->
ötvÆ
, 
Ál£
);

472 
	}
}

474 
	$©h9k_bóc⁄_c⁄fig_°a
(
©h_hw
 *
ah
,

475 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

477 
©h9k_bóc⁄_°©e
 
bs
;

479 i‡(
	`©h9k_cmn_bóc⁄_c⁄fig_°a
(
ah
, 
c⁄f
, &
bs
Ë=-
EPERM
)

482 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

483 
	`©h9k_hw_£t_°a_bóc⁄_timîs
(
ah
, &
bs
);

484 
ah
->
imask
 |
ATH9K_INT_BMISS
;

486 
	`©h9k_hw_£t_öãºu±s
(
ah
);

487 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

488 
	}
}

490 
	$©h9k_bóc⁄_c⁄fig_adhoc
(
©h_so·c
 *
sc
,

491 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

493 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

494 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

496 
	`©h9k_ª£t_bóc⁄_°©us
(
sc
);

498 
	`©h9k_cmn_bóc⁄_c⁄fig_adhoc
(
ah
, 
c⁄f
);

500 
	`©h9k_bóc⁄_öô
(
sc
, 
c⁄f
->
√xâbâ
, c⁄f->
ötvÆ
, c⁄f->
ibss_¸ót‹
);

506 i‡(!
c⁄f
->
ibss_¸ót‹
 && c⁄f->
íabÀ_bóc⁄
)

507 
	`£t_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

508 
	}
}

510 
boﬁ
 
	$©h9k_Ælow_bóc⁄_c⁄fig
(
©h_so·c
 *
sc
,

511 
õì80211_vif
 *
vif
)

513 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

514 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

516 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

523 i‡(
sc
->
cur_ch™
 !
avp
->
ch™˘x
)

524  
åue
;

527 i‡(
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_AP
) {

528 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
) {

529 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

531  
Ál£
;

535 i‡(
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_STATION
) {

536 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) &&

537 
	`ã°_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
) &&

538 
vif
 !
sc
->
cur_ch™
->
¥im¨y_°a
) {

539 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

541  
Ál£
;

545  
åue
;

546 
	}
}

548 
	$©h9k_ˇche_bóc⁄_c⁄fig
(
©h_so·c
 *
sc
,

549 
©h_ch™˘x
 *
˘x
,

550 
õì80211_bss_c⁄f
 *
bss_c⁄f
)

552 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

553 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
˘x
->
bóc⁄
;

555 
	`©h_dbg
(
comm⁄
, 
BEACON
,

556 "Cachög bóc⁄ d©®f‹ BSS: %pM\n", 
bss_c⁄f
->
bssid
);

558 
cur_c⁄f
->
bóc⁄_öãrvÆ
 = 
bss_c⁄f
->
bóc⁄_öt
;

559 
cur_c⁄f
->
dtim_≥riod
 = 
bss_c⁄f
->dtim_period;

560 
cur_c⁄f
->
dtim_cou¡
 = 1;

561 
cur_c⁄f
->
ibss_¸ót‹
 = 
bss_c⁄f
->ibss_creator;

569 i‡(
cur_c⁄f
->
bóc⁄_öãrvÆ
 == 0)

570 
cur_c⁄f
->
bóc⁄_öãrvÆ
 = 100;

572 
cur_c⁄f
->
bmiss_timeout
 =

573 
ATH_DEFAULT_BMISS_LIMIT
 * 
cur_c⁄f
->
bóc⁄_öãrvÆ
;

580 i‡(
cur_c⁄f
->
dtim_≥riod
 == 0)

581 
cur_c⁄f
->
dtim_≥riod
 = 1;

583 
	}
}

585 
	$©h9k_bóc⁄_c⁄fig
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
,

586 
u32
 
ch™ged
)

588 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
vif
->bss_conf;

589 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

590 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

591 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

592 
©h_ch™˘x
 *
˘x
 = 
avp
->
ch™˘x
;

593 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
;

594 
Êags
;

595 
boﬁ
 
skù_bóc⁄
 = 
Ál£
;

597 i‡(!
˘x
)

600 
cur_c⁄f
 = &
avp
->
ch™˘x
->
bóc⁄
;

601 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

602 
	`©h9k_£t_tsÁdju°
(
sc
, 
vif
);

604 i‡(!
	`©h9k_Ælow_bóc⁄_c⁄fig
(
sc
, 
vif
))

607 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

608 
	`©h9k_ˇche_bóc⁄_c⁄fig
(
sc
, 
˘x
, 
bss_c⁄f
);

609 i‡(
˘x
 !
sc
->
cur_ch™
)

612 
	`©h9k_£t_bóc⁄
(
sc
);

613 
	`£t_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

621 i‡(
ch™ged
 & 
BSS_CHANGED_BEACON_ENABLED
) {

622 
boﬁ
 
íabÀd
 = 
cur_c⁄f
->
íabÀ_bóc⁄
;

624 i‡(!
bss_c⁄f
->
íabÀ_bóc⁄
) {

625 
cur_c⁄f
->
íabÀ_bóc⁄
 &~
	`BIT
(
avp
->
av_b¶Ÿ
);

627 
cur_c⁄f
->
íabÀ_bóc⁄
 |
	`BIT
(
avp
->
av_b¶Ÿ
);

628 i‡(!
íabÀd
)

629 
	`©h9k_ˇche_bóc⁄_c⁄fig
(
sc
, 
˘x
, 
bss_c⁄f
);

633 i‡(
˘x
 !
sc
->
cur_ch™
)

640 i‡(
cur_c⁄f
->
bóc⁄_öãrvÆ
) {

646 i‡((
ch™ged
 & 
BSS_CHANGED_IBSS
Ë&& !
bss_c⁄f
->
ibss_¸ót‹
 &&

647 
bss_c⁄f
->
íabÀ_bóc⁄
) {

648 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

649 
sc
->
ps_Êags
 |
PS_BEACON_SYNC
 | 
PS_WAIT_FOR_BEACON
;

650 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

651 
skù_bóc⁄
 = 
åue
;

653 
	`©h9k_£t_bóc⁄
(
sc
);

660 i‡(
cur_c⁄f
->
íabÀ_bóc⁄
 && !
skù_bóc⁄
)

661 
	`£t_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

663 
	`˛ór_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

665 
	}
}

667 
	$©h9k_£t_bóc⁄
(
©h_so·c
 *
sc
)

669 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

670 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

672 
sc
->
sc_ah
->
›mode
) {

673 
NL80211_IFTYPE_AP
:

674 
NL80211_IFTYPE_MESH_POINT
:

675 
	`©h9k_bóc⁄_c⁄fig_≠
(
sc
, 
cur_c⁄f
);

677 
NL80211_IFTYPE_ADHOC
:

678 
	`©h9k_bóc⁄_c⁄fig_adhoc
(
sc
, 
cur_c⁄f
);

680 
NL80211_IFTYPE_STATION
:

681 
	`©h9k_bóc⁄_c⁄fig_°a
(
sc
->
sc_ah
, 
cur_c⁄f
);

684 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Unsupported beaconing mode\n");

687 
	}
}

	@btcoex.c

17 
	~<löux/exp‹t.h
>

18 
	~"hw.h
"

20 
	e©h_bt_mode
 {

21 
	mATH_BT_COEX_MODE_LEGACY
,

22 
	mATH_BT_COEX_MODE_UNSLOTTED
,

23 
	mATH_BT_COEX_MODE_SLOTTED
,

24 
	mATH_BT_COEX_MODE_DISABLED
,

27 
	s©h_btc€x_c⁄fig
 {

28 
u8
 
	mbt_time_exãnd
;

29 
boﬁ
 
	mbt_tx°©e_exãnd
;

30 
boﬁ
 
	mbt_tx‰ame_exãnd
;

31 
©h_bt_mode
 
	mbt_mode
;

32 
boﬁ
 
	mbt_quõt_cﬁlisi⁄
;

33 
boﬁ
 
	mbt_rx˛ór_pﬁ¨ôy
;

34 
u8
 
	mbt_¥i‹ôy_time
;

35 
u8
 
	mbt_fú°_¶Ÿ_time
;

36 
boﬁ
 
	mbt_hﬁd_rx_˛ór
;

39 c⁄° 
u32
 
	g¨9003_wœn_weights
[
ATH_BTCOEX_STOMP_MAX
]

40 [
AR9300_NUM_WLAN_WEIGHTS
] = {

46 c⁄° 
u32
 
	gmci_wœn_weights
[
ATH_BTCOEX_STOMP_MAX
]

47 [
AR9300_NUM_WLAN_WEIGHTS
] = {

55 
	$©h9k_hw_öô_btc€x_hw
(
©h_hw
 *
ah
, 
qnum
)

57 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

58 c⁄° 
©h_btc€x_c⁄fig
 
©h_bt_c⁄fig
 = {

59 .
bt_time_exãnd
 = 0,

60 .
bt_tx°©e_exãnd
 = 
åue
,

61 .
bt_tx‰ame_exãnd
 = 
åue
,

62 .
bt_mode
 = 
ATH_BT_COEX_MODE_SLOTTED
,

63 .
bt_quõt_cﬁlisi⁄
 = 
åue
,

64 .
bt_rx˛ór_pﬁ¨ôy
 = 
åue
,

65 .
bt_¥i‹ôy_time
 = 2,

66 .
bt_fú°_¶Ÿ_time
 = 5,

67 .
bt_hﬁd_rx_˛ór
 = 
åue
,

69 
boﬁ
 
rx˛ór_pﬁ¨ôy
 = 
©h_bt_c⁄fig
.
bt_rx˛ór_pﬁ¨ôy
;

71 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

72 
rx˛ór_pﬁ¨ôy
 = !
©h_bt_c⁄fig
.
bt_rx˛ór_pﬁ¨ôy
;

74 
btc€x_hw
->
bt_c€x_mode
 =

75 (
btc€x_hw
->
bt_c€x_mode
 & 
AR_BT_QCU_THRESH
) |

76 
	`SM
(
©h_bt_c⁄fig
.
bt_time_exãnd
, 
AR_BT_TIME_EXTEND
) |

77 
	`SM
(
©h_bt_c⁄fig
.
bt_tx°©e_exãnd
, 
AR_BT_TXSTATE_EXTEND
) |

78 
	`SM
(
©h_bt_c⁄fig
.
bt_tx‰ame_exãnd
, 
AR_BT_TX_FRAME_EXTEND
) |

79 
	`SM
(
©h_bt_c⁄fig
.
bt_mode
, 
AR_BT_MODE
) |

80 
	`SM
(
©h_bt_c⁄fig
.
bt_quõt_cﬁlisi⁄
, 
AR_BT_QUIET
) |

81 
	`SM
(
rx˛ór_pﬁ¨ôy
, 
AR_BT_RX_CLEAR_POLARITY
) |

82 
	`SM
(
©h_bt_c⁄fig
.
bt_¥i‹ôy_time
, 
AR_BT_PRIORITY_TIME
) |

83 
	`SM
(
©h_bt_c⁄fig
.
bt_fú°_¶Ÿ_time
, 
AR_BT_FIRST_SLOT_TIME
) |

84 
	`SM
(
qnum
, 
AR_BT_QCU_THRESH
);

86 
btc€x_hw
->
bt_c€x_mode2
 =

87 
	`SM
(
©h_bt_c⁄fig
.
bt_hﬁd_rx_˛ór
, 
AR_BT_HOLD_RX_CLEAR
) |

88 
	`SM
(
ATH_BTCOEX_BMISS_THRESH
, 
AR_BT_BCN_MISS_THRESH
) |

89 
AR_BT_DISABLE_BT_ANT
;

90 
	}
}

91 
EXPORT_SYMBOL
(
©h9k_hw_öô_btc€x_hw
);

93 
	$©h9k_hw_btc€x_öô_scheme
(
©h_hw
 *
ah
)

95 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

96 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

101 i‡(!
comm⁄
->
btc€x_íabÀd
) {

102 
btc€x_hw
->
scheme
 = 
ATH_BTCOEX_CFG_NONE
;

106 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
) {

107 
btc€x_hw
->
scheme
 = 
ATH_BTCOEX_CFG_MCI
;

108 } i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

109 
btc€x_hw
->
scheme
 = 
ATH_BTCOEX_CFG_3WIRE
;

110 
btc€x_hw
->
bè˘ive_gpio
 = 
ATH_BTACTIVE_GPIO_9300
;

111 
btc€x_hw
->
wœ«˘ive_gpio
 = 
ATH_WLANACTIVE_GPIO_9300
;

112 
btc€x_hw
->
bçri‹ôy_gpio
 = 
ATH_BTPRIORITY_GPIO_9300
;

113 } i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

114 
btc€x_hw
->
bè˘ive_gpio
 = 
ATH_BTACTIVE_GPIO_9280
;

115 
btc€x_hw
->
wœ«˘ive_gpio
 = 
ATH_WLANACTIVE_GPIO_9280
;

117 i‡(
	`AR_SREV_9285
(
ah
)) {

118 
btc€x_hw
->
scheme
 = 
ATH_BTCOEX_CFG_3WIRE
;

119 
btc€x_hw
->
bçri‹ôy_gpio
 = 
ATH_BTPRIORITY_GPIO_9285
;

121 
btc€x_hw
->
scheme
 = 
ATH_BTCOEX_CFG_2WIRE
;

124 
	}
}

125 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_öô_scheme
);

127 
	$©h9k_hw_btc€x_öô_2wúe
(
©h_hw
 *
ah
)

129 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

132 
	`REG_CLR_BIT
(
ah
, 
AR_GPIO_INPUT_EN_VAL
,

133 (
AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_DEF
 |

134 
AR_GPIO_INPUT_EN_VAL_BT_FREQUENCY_DEF
));

136 
	`REG_SET_BIT
(
ah
, 
AR_GPIO_INPUT_EN_VAL
,

137 
AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_BB
);

140 
	`REG_RMW_FIELD
(
ah
, 
AR_GPIO_INPUT_MUX1
,

141 
AR_GPIO_INPUT_MUX1_BT_ACTIVE
,

142 
btc€x_hw
->
bè˘ive_gpio
);

145 
	`©h9k_hw_cfg_gpio_öput
(
ah
, 
btc€x_hw
->
bè˘ive_gpio
);

146 
	}
}

147 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_öô_2wúe
);

149 
	$©h9k_hw_btc€x_öô_3wúe
(
©h_hw
 *
ah
)

151 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

154 
	`REG_SET_BIT
(
ah
, 
AR_GPIO_INPUT_EN_VAL
,

155 (
AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_BB
 |

156 
AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_BB
));

160 
	`REG_RMW_FIELD
(
ah
, 
AR_GPIO_INPUT_MUX1
,

161 
AR_GPIO_INPUT_MUX1_BT_ACTIVE
,

162 
btc€x_hw
->
bè˘ive_gpio
);

164 
	`REG_RMW_FIELD
(
ah
, 
AR_GPIO_INPUT_MUX1
,

165 
AR_GPIO_INPUT_MUX1_BT_PRIORITY
,

166 
btc€x_hw
->
bçri‹ôy_gpio
);

170 
	`©h9k_hw_cfg_gpio_öput
(
ah
, 
btc€x_hw
->
bè˘ive_gpio
);

171 
	`©h9k_hw_cfg_gpio_öput
(
ah
, 
btc€x_hw
->
bçri‹ôy_gpio
);

172 
	}
}

173 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_öô_3wúe
);

175 
	$©h9k_hw_btc€x_öô_mci
(
©h_hw
 *
ah
)

177 
ah
->
btc€x_hw
.
mci
.
ªady
 = 
Ál£
;

178 
ah
->
btc€x_hw
.
mci
.
bt_°©e
 = 0;

179 
ah
->
btc€x_hw
.
mci
.
bt_vî_maj‹
 = 3;

180 
ah
->
btc€x_hw
.
mci
.
bt_vî_mö‹
 = 0;

181 
ah
->
btc€x_hw
.
mci
.
bt_vîsi⁄_known
 = 
Ál£
;

182 
ah
->
btc€x_hw
.
mci
.
upd©e_2g5g
 = 
åue
;

183 
ah
->
btc€x_hw
.
mci
.
is_2g
 = 
åue
;

184 
ah
->
btc€x_hw
.
mci
.
wœn_ch™√ls_upd©e
 = 
Ál£
;

185 
ah
->
btc€x_hw
.
mci
.
wœn_ch™√ls
[0] = 0x00000000;

186 
ah
->
btc€x_hw
.
mci
.
wœn_ch™√ls
[1] = 0xffffffff;

187 
ah
->
btc€x_hw
.
mci
.
wœn_ch™√ls
[2] = 0xffffffff;

188 
ah
->
btc€x_hw
.
mci
.
wœn_ch™√ls
[3] = 0x7fffffff;

189 
ah
->
btc€x_hw
.
mci
.
quîy_bt
 = 
åue
;

190 
ah
->
btc€x_hw
.
mci
.
unhÆt_bt_gpm
 = 
åue
;

191 
ah
->
btc€x_hw
.
mci
.
hÆãd_bt_gpm
 = 
Ál£
;

192 
ah
->
btc€x_hw
.
mci
.
√ed_Êush_btöfo
 = 
Ál£
;

193 
ah
->
btc€x_hw
.
mci
.
wœn_ˇl_£q
 = 0;

194 
ah
->
btc€x_hw
.
mci
.
wœn_ˇl_d⁄e
 = 0;

195 
ah
->
btc€x_hw
.
mci
.
c⁄fig
 = (
	`AR_SREV_9462
(ah)) ? 0x2201 : 0xa4c1;

196 
	}
}

197 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_öô_mci
);

199 
	$©h9k_hw_btc€x_íabÀ_2wúe
(
©h_hw
 *
ah
)

201 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

204 
	`©h9k_hw_cfg_ouçut
(
ah
, 
btc€x_hw
->
wœ«˘ive_gpio
,

205 
AR_GPIO_OUTPUT_MUX_AS_TX_FRAME
);

206 
	}
}

212 
	$©h9k_hw_btc€x_£t_weight
(
©h_hw
 *
ah
,

213 
u32
 
bt_weight
,

214 
u32
 
wœn_weight
,

215 
©h_°omp_ty≥
 
°omp_ty≥
)

217 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

218 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

219 
u8
 
tx¥io_shi·
[] = { 24, 16, 16, 0 };

220 
boﬁ
 
c⁄cur_tx
 = (
mci_hw
->c⁄cur_tx && 
btc€x_hw
->
tx_¥io
[
°omp_ty≥
]);

221 c⁄° 
u32
 *
weight
 = 
¨9003_wœn_weights
[
°omp_ty≥
];

222 
i
;

224 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

225 
btc€x_hw
->
bt_c€x_weights
 =

226 
	`SM
(
bt_weight
, 
AR_BTCOEX_BT_WGHT
) |

227 
	`SM
(
wœn_weight
, 
AR_BTCOEX_WL_WGHT
);

231 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

232 
©h_°omp_ty≥
 
°y≥
 =

233 ((
°omp_ty≥
 =
ATH_BTCOEX_STOMP_LOW
) &&

234 
btc€x_hw
->
mci
.
°omp_·p
) ?

235 
ATH_BTCOEX_STOMP_LOW_FTP
 : 
°omp_ty≥
;

236 
weight
 = 
mci_wœn_weights
[
°y≥
];

239 
i
 = 0; i < 
AR9300_NUM_WLAN_WEIGHTS
; i++) {

240 
btc€x_hw
->
bt_weight
[
i
] = 
AR9300_BT_WGHT
;

241 
btc€x_hw
->
wœn_weight
[
i
] = 
weight
[i];

242 i‡(
c⁄cur_tx
 && 
i
) {

243 
btc€x_hw
->
wœn_weight
[
i
] &=

244 ~(0xf‡<< 
tx¥io_shi·
[
i
-1]);

245 
btc€x_hw
->
wœn_weight
[
i
] |=

246 (
btc€x_hw
->
tx_¥io
[
°omp_ty≥
] <<

247 
tx¥io_shi·
[
i
-1]);

251 i‡(
c⁄cur_tx
) {

252 
btc€x_hw
->
wœn_weight
[
i
-1] &~(0xf‡<< 
tx¥io_shi·
[i-1]);

253 
btc€x_hw
->
wœn_weight
[
i
-1] |(btc€x_hw->
tx_¥io
[
°omp_ty≥
]

254 << 
tx¥io_shi·
[
i
-1]);

257 
	}
}

258 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_£t_weight
);

261 
	$©h9k_hw_btc€x_íabÀ_3wúe
(
©h_hw
 *
ah
)

263 
©h_btc€x_hw
 *
btc€x
 = &
ah
->
btc€x_hw
;

264 
u32
 
vÆ
;

265 
i
;

271 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE
, 
btc€x
->
bt_c€x_mode
);

272 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE2
, 
btc€x
->
bt_c€x_mode2
);

275 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

276 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WL_WEIGHTS0
, 
btc€x
->
wœn_weight
[0]);

277 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WL_WEIGHTS1
, 
btc€x
->
wœn_weight
[1]);

278 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

279 
	`REG_WRITE
(
ah
, 
	`AR_BT_COEX_BT_WEIGHTS
(
i
),

280 
btc€x
->
bt_weight
[
i
]);

282 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WEIGHT
, 
btc€x
->
bt_c€x_weights
);

286 i‡(
	`AR_SREV_9271
(
ah
)) {

287 
vÆ
 = 
	`REG_READ
(
ah
, 0x50040);

288 
vÆ
 &= 0xFFFFFEFF;

289 
	`REG_WRITE
(
ah
, 0x50040, 
vÆ
);

292 
	`REG_RMW_FIELD
(
ah
, 
AR_QUIET1
, 
AR_QUIET1_QUIET_ACK_CTS_ENABLE
, 1);

293 
	`REG_RMW_FIELD
(
ah
, 
AR_PCU_MISC
, 
AR_PCU_BT_ANT_PREVENT_RX
, 0);

295 
	`©h9k_hw_cfg_ouçut
(
ah
, 
btc€x
->
wœ«˘ive_gpio
,

296 
AR_GPIO_OUTPUT_MUX_AS_RX_CLEAR_EXTERNAL
);

297 
	}
}

299 
	$©h9k_hw_btc€x_íabÀ_mci
(
©h_hw
 *
ah
)

301 
©h_btc€x_hw
 *
btc€x
 = &
ah
->
btc€x_hw
;

302 
i
;

304 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

305 
	`REG_WRITE
(
ah
, 
	`AR_MCI_COEX_WL_WEIGHTS
(
i
),

306 
btc€x
->
wœn_weight
[
i
]);

308 
	`REG_RMW_FIELD
(
ah
, 
AR_QUIET1
, 
AR_QUIET1_QUIET_ACK_CTS_ENABLE
, 1);

309 
btc€x
->
íabÀd
 = 
åue
;

310 
	}
}

312 
	$©h9k_hw_btc€x_dißbÀ_mci
(
©h_hw
 *
ah
)

314 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

315 
i
;

317 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
ATH_BTCOEX_STOMP_NONE
);

319 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

320 
	`REG_WRITE
(
ah
, 
	`AR_MCI_COEX_WL_WEIGHTS
(
i
),

321 
btc€x_hw
->
wœn_weight
[
i
]);

322 
	}
}

324 
	$©h9k_hw_btc€x_íabÀ
(
©h_hw
 *
ah
)

326 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

328 
	`©h9k_hw_gë_btc€x_scheme
(
ah
)) {

329 
ATH_BTCOEX_CFG_NONE
:

331 
ATH_BTCOEX_CFG_2WIRE
:

332 
	`©h9k_hw_btc€x_íabÀ_2wúe
(
ah
);

334 
ATH_BTCOEX_CFG_3WIRE
:

335 
	`©h9k_hw_btc€x_íabÀ_3wúe
(
ah
);

337 
ATH_BTCOEX_CFG_MCI
:

338 
	`©h9k_hw_btc€x_íabÀ_mci
(
ah
);

342 i‡(
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_MCI
) {

343 
	`REG_RMW
(
ah
, 
AR_GPIO_PDPU
,

344 (0x2 << (
btc€x_hw
->
bè˘ive_gpio
 * 2)),

345 (0x3 << (
btc€x_hw
->
bè˘ive_gpio
 * 2)));

348 
ah
->
btc€x_hw
.
íabÀd
 = 
åue
;

349 
	}
}

350 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_íabÀ
);

352 
	$©h9k_hw_btc€x_dißbÀ
(
©h_hw
 *
ah
)

354 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

355 
i
;

357 
btc€x_hw
->
íabÀd
 = 
Ál£
;

359 i‡(
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë=
ATH_BTCOEX_CFG_MCI
) {

360 
	`©h9k_hw_btc€x_dißbÀ_mci
(
ah
);

364 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

365 
	`©h9k_hw_£t_gpio
(
ah
, 
btc€x_hw
->
wœ«˘ive_gpio
, 0);

367 
	`©h9k_hw_cfg_ouçut
(
ah
, 
btc€x_hw
->
wœ«˘ive_gpio
,

368 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

370 i‡(
btc€x_hw
->
scheme
 =
ATH_BTCOEX_CFG_3WIRE
) {

371 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE
, 
AR_BT_QUIET
 | 
AR_BT_MODE
);

372 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_MODE2
, 0);

374 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

375 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WL_WEIGHTS0
, 0);

376 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WL_WEIGHTS1
, 0);

377 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

378 
	`REG_WRITE
(
ah
, 
	`AR_BT_COEX_BT_WEIGHTS
(
i
), 0);

380 
	`REG_WRITE
(
ah
, 
AR_BT_COEX_WEIGHT
, 0);

383 
	}
}

384 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_dißbÀ
);

389 
	$©h9k_hw_btc€x_bt_°omp
(
©h_hw
 *
ah
,

390 
©h_°omp_ty≥
 
°omp_ty≥
)

392 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

393 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 0, 0, 
°omp_ty≥
);

397 
°omp_ty≥
) {

398 
ATH_BTCOEX_STOMP_ALL
:

399 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 
AR_BT_COEX_WGHT
,

400 
AR_STOMP_ALL_WLAN_WGHT
, 0);

402 
ATH_BTCOEX_STOMP_LOW
:

403 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 
AR_BT_COEX_WGHT
,

404 
AR_STOMP_LOW_WLAN_WGHT
, 0);

406 
ATH_BTCOEX_STOMP_NONE
:

407 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 
AR_BT_COEX_WGHT
,

408 
AR_STOMP_NONE_WLAN_WGHT
, 0);

411 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
, "Invalid Stomptype\n");

414 
	}
}

415 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_bt_°omp
);

417 
	$©h9k_hw_btc€x_£t_c⁄cur_tx¥io
(
©h_hw
 *
ah
, 
u8
 *
°omp_tx¥io
)

419 
©h_btc€x_hw
 *
btc€x
 = &
ah
->
btc€x_hw
;

420 
i
;

422 
i
 = 0; i < 
ATH_BTCOEX_STOMP_MAX
; i++)

423 
btc€x
->
tx_¥io
[
i
] = 
°omp_tx¥io
[i];

424 
	}
}

425 
EXPORT_SYMBOL
(
©h9k_hw_btc€x_£t_c⁄cur_tx¥io
);

	@btcoex.h

17 #i‚de‡
BTCOEX_H


18 
	#BTCOEX_H


	)

20 
	~"hw.h
"

22 
	#ATH_WLANACTIVE_GPIO_9280
 5

	)

23 
	#ATH_BTACTIVE_GPIO_9280
 6

	)

24 
	#ATH_BTPRIORITY_GPIO_9285
 7

	)

26 
	#ATH_WLANACTIVE_GPIO_9300
 5

	)

27 
	#ATH_BTACTIVE_GPIO_9300
 4

	)

28 
	#ATH_BTPRIORITY_GPIO_9300
 8

	)

30 
	#ATH_BTCOEX_DEF_BT_PERIOD
 45

	)

31 
	#ATH_BTCOEX_DEF_DUTY_CYCLE
 55

	)

32 
	#ATH_BTCOEX_BTSCAN_DUTY_CYCLE
 90

	)

33 
	#ATH_BTCOEX_BMISS_THRESH
 50

	)

35 
	#ATH_BT_PRIORITY_TIME_THRESHOLD
 1000

	)

36 
	#ATH_BT_CNT_THRESHOLD
 3

	)

37 
	#ATH_BT_CNT_SCAN_THRESHOLD
 15

	)

39 
	#ATH_BTCOEX_RX_WAIT_TIME
 100

	)

40 
	#ATH_BTCOEX_STOMP_FTP_THRESH
 5

	)

42 
	#ATH_BTCOEX_HT20_MAX_TXPOWER
 0x14

	)

43 
	#ATH_BTCOEX_HT40_MAX_TXPOWER
 0x10

	)

45 
	#AR9300_NUM_BT_WEIGHTS
 4

	)

46 
	#AR9300_NUM_WLAN_WEIGHTS
 4

	)

48 
	#ATH_AIC_MAX_BT_CHANNEL
 79

	)

51 
	e©h_°omp_ty≥
 {

52 
	mATH_BTCOEX_STOMP_ALL
,

53 
	mATH_BTCOEX_STOMP_LOW
,

54 
	mATH_BTCOEX_STOMP_NONE
,

55 
	mATH_BTCOEX_STOMP_LOW_FTP
,

56 
	mATH_BTCOEX_STOMP_AUDIO
,

57 
	mATH_BTCOEX_STOMP_MAX


60 
	e©h_btc€x_scheme
 {

61 
	mATH_BTCOEX_CFG_NONE
,

62 
	mATH_BTCOEX_CFG_2WIRE
,

63 
	mATH_BTCOEX_CFG_3WIRE
,

64 
	mATH_BTCOEX_CFG_MCI
,

67 
	s©h9k_hw_mci
 {

68 
u32
 
	møw_öå
;

69 
u32
 
	mrx_msg_öå
;

70 
u32
 
	mc⁄t_°©us
;

71 
u32
 
	mgpm_addr
;

72 
u32
 
	mgpm_Àn
;

73 
u32
 
	mgpm_idx
;

74 
u32
 
	msched_addr
;

75 
u32
 
	mwœn_ch™√ls
[4];

76 
u32
 
	mwœn_ˇl_£q
;

77 
u32
 
	mwœn_ˇl_d⁄e
;

78 
u32
 
	mc⁄fig
;

79 
u8
 *
	mgpm_buf
;

80 
boﬁ
 
	mªady
;

81 
boﬁ
 
	mupd©e_2g5g
;

82 
boﬁ
 
	mis_2g
;

83 
boﬁ
 
	mquîy_bt
;

84 
boﬁ
 
	munhÆt_bt_gpm
;

85 
boﬁ
 
	mhÆãd_bt_gpm
;

86 
boﬁ
 
	m√ed_Êush_btöfo
;

87 
boﬁ
 
	mbt_vîsi⁄_known
;

88 
boﬁ
 
	mwœn_ch™√ls_upd©e
;

89 
u8
 
	mwœn_vî_maj‹
;

90 
u8
 
	mwœn_vî_mö‹
;

91 
u8
 
	mbt_vî_maj‹
;

92 
u8
 
	mbt_vî_mö‹
;

93 
u8
 
	mbt_°©e
;

94 
u8
 
	m°omp_·p
;

95 
boﬁ
 
	mc⁄cur_tx
;

96 
u32
 
	mœ°_ªcovîy
;

99 
	s©h9k_hw_aic
 {

100 
boﬁ
 
	maic_íabÀd
;

101 
u8
 
	maic_ˇl_°©e
;

102 
u8
 
	maic_ˇÀd_ch™
;

103 
u32
 
	maic_§am
[
ATH_AIC_MAX_BT_CHANNEL
];

104 
u32
 
	maic_ˇl_°¨t_time
;

107 
	s©h_btc€x_hw
 {

108 
©h_btc€x_scheme
 
	mscheme
;

109 
©h9k_hw_mci
 
	mmci
;

110 
©h9k_hw_aic
 
	maic
;

111 
boﬁ
 
	míabÀd
;

112 
u8
 
	mwœ«˘ive_gpio
;

113 
u8
 
	mbè˘ive_gpio
;

114 
u8
 
	mbçri‹ôy_gpio
;

115 
u32
 
	mbt_c€x_mode
;

116 
u32
 
	mbt_c€x_weights
;

117 
u32
 
	mbt_c€x_mode2
;

118 
u32
 
	mbt_weight
[
AR9300_NUM_BT_WEIGHTS
];

119 
u32
 
	mwœn_weight
[
AR9300_NUM_WLAN_WEIGHTS
];

120 
u8
 
	mtx_¥io
[
ATH_BTCOEX_STOMP_MAX
];

123 
©h9k_hw_btc€x_öô_scheme
(
©h_hw
 *
ah
);

124 
©h9k_hw_btc€x_öô_2wúe
(
©h_hw
 *
ah
);

125 
©h9k_hw_btc€x_öô_3wúe
(
©h_hw
 *
ah
);

126 
©h9k_hw_btc€x_öô_mci
(
©h_hw
 *
ah
);

127 
©h9k_hw_öô_btc€x_hw
(
©h_hw
 *
ah
, 
qnum
);

128 
©h9k_hw_btc€x_£t_weight
(
©h_hw
 *
ah
,

129 
u32
 
bt_weight
,

130 
u32
 
wœn_weight
,

131 
©h_°omp_ty≥
 
°omp_ty≥
);

132 
©h9k_hw_btc€x_dißbÀ
(
©h_hw
 *
ah
);

133 
©h9k_hw_btc€x_bt_°omp
(
©h_hw
 *
ah
,

134 
©h_°omp_ty≥
 
°omp_ty≥
);

135 
©h9k_hw_btc€x_£t_c⁄cur_tx¥io
(
©h_hw
 *
ah
, 
u8
 *
°omp_tx¥io
);

	@calib.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~<löux/exp‹t.h
>

24 
öt16_t
 
	$©h9k_hw_gë_nf_hi°_mid
(
öt16_t
 *
nfCÆBuf„r
)

26 
öt16_t
 
nfvÆ
;

27 
öt16_t
 
s‹t
[
ATH9K_NF_CAL_HIST_MAX
];

28 
i
, 
j
;

30 
i
 = 0; i < 
ATH9K_NF_CAL_HIST_MAX
; i++)

31 
s‹t
[
i
] = 
nfCÆBuf„r
[i];

33 
i
 = 0; i < 
ATH9K_NF_CAL_HIST_MAX
 - 1; i++) {

34 
j
 = 1; j < 
ATH9K_NF_CAL_HIST_MAX
 - 
i
; j++) {

35 i‡(
s‹t
[
j
] > sort[j - 1]) {

36 
nfvÆ
 = 
s‹t
[
j
];

37 
s‹t
[
j
] = sort[j - 1];

38 
s‹t
[
j
 - 1] = 
nfvÆ
;

42 
nfvÆ
 = 
s‹t
[(
ATH9K_NF_CAL_HIST_MAX
 - 1) >> 1];

44  
nfvÆ
;

45 
	}
}

47 
©h_nf_limôs
 *
	$©h9k_hw_gë_nf_limôs
(
©h_hw
 *
ah
,

48 
©h9k_ch™√l
 *
ch™
)

50 
©h_nf_limôs
 *
limô
;

52 i‡(!
ch™
 || 
	`IS_CHAN_2GHZ
(chan))

53 
limô
 = &
ah
->
nf_2g
;

55 
limô
 = &
ah
->
nf_5g
;

57  
limô
;

58 
	}
}

60 
s16
 
	$©h9k_hw_gë_deÁu…_nf
(
©h_hw
 *
ah
,

61 
©h9k_ch™√l
 *
ch™
)

63  
	`©h9k_hw_gë_nf_limôs
(
ah
, 
ch™
)->
nomöÆ
;

64 
	}
}

66 
s16
 
	$©h9k_hw_gëch™_noi£
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

67 
s16
 
nf
)

69 
s8
 
noi£
 = 
ATH_DEFAULT_NOISE_FLOOR
;

71 i‡(
nf
) {

72 
s8
 
dñè
 = 
nf
 - 
ATH9K_NF_CAL_NOISE_THRESH
 -

73 
	`©h9k_hw_gë_deÁu…_nf
(
ah
, 
ch™
);

74 i‡(
dñè
 > 0)

75 
noi£
 +
dñè
;

77  
noi£
;

78 
	}
}

79 
EXPORT_SYMBOL
(
©h9k_hw_gëch™_noi£
);

81 
	$©h9k_hw_upd©e_nfˇl_hi°_buf„r
(
©h_hw
 *
ah
,

82 
©h9k_hw_ˇl_d©a
 *
ˇl
,

83 
öt16_t
 *
nÁºay
)

85 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

86 
©h_nf_limôs
 *
limô
;

87 
©h9k_nfˇl_hi°
 *
h
;

88 
boﬁ
 
high_nf_mid
 = 
Ál£
;

89 
u8
 
chaömask
 = (
ah
->
rxchaömask
 << 3) |áh->rxchainmask;

90 
i
;

92 
h
 = 
ˇl
->
nfCÆHi°
;

93 
limô
 = 
	`©h9k_hw_gë_nf_limôs
(
ah
,áh->
curch™
);

95 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

96 i‡(!(
chaömask
 & (1 << 
i
)) ||

97 ((
i
 >
AR5416_MAX_CHAINS
Ë&& !
	`IS_CHAN_HT40
(
ah
->
curch™
)))

100 
h
[
i
].
nfCÆBuf„r
[h[i].
cuºIndex
] = 
nÁºay
[i];

102 i‡(++
h
[
i
].
cuºIndex
 >
ATH9K_NF_CAL_HIST_MAX
)

103 
h
[
i
].
cuºIndex
 = 0;

105 i‡(
h
[
i
].
övÆidNFcou¡
 > 0) {

106 
h
[
i
].
övÆidNFcou¡
--;

107 
h
[
i
].
¥ivNF
 = 
nÁºay
[i];

109 
h
[
i
].
¥ivNF
 =

110 
	`©h9k_hw_gë_nf_hi°_mid
(
h
[
i
].
nfCÆBuf„r
);

113 i‡(!
h
[
i
].
¥ivNF
)

116 i‡(
h
[
i
].
¥ivNF
 > 
limô
->
max
) {

117 
high_nf_mid
 = 
åue
;

119 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

121 
i
, 
h
[i].
¥ivNF
, 
limô
->
max
,

122 (
	`ã°_bô
(
NFCAL_INTF
, &
ˇl
->
ˇl_Êags
) ?

133 i‡(!
	`ã°_bô
(
NFCAL_INTF
, &
ˇl
->
ˇl_Êags
))

134 
h
[
i
].
¥ivNF
 = 
limô
->
max
;

143 i‡(!
high_nf_mid
)

144 
	`˛ór_bô
(
NFCAL_INTF
, &
ˇl
->
ˇl_Êags
);

145 
	}
}

147 
boﬁ
 
	$©h9k_hw_gë_nf_thªsh
(
©h_hw
 *
ah
,

148 
õì80211_b™d
 
b™d
,

149 
öt16_t
 *
n·
)

151 
b™d
) {

152 
IEEE80211_BAND_5GHZ
:

153 *
n·
 = (
öt8_t
)
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_NFTHRESH_5
);

155 
IEEE80211_BAND_2GHZ
:

156 *
n·
 = (
öt8_t
)
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_NFTHRESH_2
);

159 
	`BUG_ON
(1);

160  
Ál£
;

163  
åue
;

164 
	}
}

166 
	$©h9k_hw_ª£t_ˇlibøti⁄
(
©h_hw
 *
ah
,

167 
©h9k_ˇl_li°
 *
cuºCÆ
)

169 
i
;

171 
	`©h9k_hw_£tup_ˇlibøti⁄
(
ah
, 
cuºCÆ
);

173 
cuºCÆ
->
ˇlSèã
 = 
CAL_RUNNING
;

175 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

176 
ah
->
mós0
.
sign
[
i
] = 0;

177 
ah
->
mós1
.
sign
[
i
] = 0;

178 
ah
->
mós2
.
sign
[
i
] = 0;

179 
ah
->
mós3
.
sign
[
i
] = 0;

182 
ah
->
ˇl_ßm∂es
 = 0;

183 
	}
}

186 
boﬁ
 
	$©h9k_hw_ª£t_ˇlvÆid
(
©h_hw
 *
ah
)

188 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

189 
©h9k_ˇl_li°
 *
cuºCÆ
 = 
ah
->
ˇl_li°_cuº
;

191 i‡(!
ah
->
ˇld©a
)

192  
åue
;

194 i‡(!
	`AR_SREV_9100
(
ah
Ë&& !
	`AR_SREV_9160_10_OR_LATER
(ah))

195  
åue
;

197 i‡(
cuºCÆ
 =
NULL
)

198  
åue
;

200 i‡(
cuºCÆ
->
ˇlSèã
 !
CAL_DONE
) {

201 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Calibration state incorrect, %d\n",

202 
cuºCÆ
->
ˇlSèã
);

203  
åue
;

206 i‡(!(
ah
->
suµ_ˇls
 & 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
))

207  
åue
;

209 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Resetting Cal %d state for channel %u\n",

210 
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
, 
ah
->
curch™
->
ch™
->
˚¡î_‰eq
);

212 
ah
->
ˇld©a
->
CÆVÆid
 &~
cuºCÆ
->
ˇlD©a
->
ˇlTy≥
;

213 
cuºCÆ
->
ˇlSèã
 = 
CAL_WAITING
;

215  
Ál£
;

216 
	}
}

217 
EXPORT_SYMBOL
(
©h9k_hw_ª£t_ˇlvÆid
);

219 
	$©h9k_hw_°¨t_nfˇl
(
©h_hw
 *
ah
, 
boﬁ
 
upd©e
)

221 i‡(
ah
->
ˇld©a
)

222 
	`£t_bô
(
NFCAL_PENDING
, &
ah
->
ˇld©a
->
ˇl_Êags
);

224 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

225 
AR_PHY_AGC_CONTROL_ENABLE_NF
);

227 i‡(
upd©e
)

228 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

229 
AR_PHY_AGC_CONTROL_NO_UPDATE_NF
);

231 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

232 
AR_PHY_AGC_CONTROL_NO_UPDATE_NF
);

234 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_NF
);

235 
	}
}

237 
	$©h9k_hw_lﬂdnf
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

239 
©h9k_nfˇl_hi°
 *
h
 = 
NULL
;

240 
i
, 
j
;

241 
u8
 
chaömask
 = (
ah
->
rxchaömask
 << 3) |áh->rxchainmask;

242 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

243 
s16
 
deÁu…_nf
 = 
	`©h9k_hw_gë_deÁu…_nf
(
ah
, 
ch™
);

244 
u32
 
bb_agc_˘l
 = 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
);

246 i‡(
ah
->
ˇld©a
)

247 
h
 = 
ah
->
ˇld©a
->
nfCÆHi°
;

249 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

250 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

251 i‡(
chaömask
 & (1 << 
i
)) {

252 
s16
 
nfvÆ
;

254 i‡((
i
 >
AR5416_MAX_CHAINS
Ë&& !
	`IS_CHAN_HT40
(
ch™
))

257 i‡(
h
)

258 
nfvÆ
 = 
h
[
i
].
¥ivNF
;

260 
nfvÆ
 = 
deÁu…_nf
;

262 
	`REG_RMW
(
ah
,áh->
nf_ªgs
[
i
],

263 (((
u32
Ë
nfvÆ
 << 1) & 0x1ff), 0x1ff);

271 i‡(
bb_agc_˘l
 & 
AR_PHY_AGC_CONTROL_NF
) {

272 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_NF
);

273 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

274 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

281 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

282 
AR_PHY_AGC_CONTROL_ENABLE_NF
);

283 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

284 
AR_PHY_AGC_CONTROL_NO_UPDATE_NF
);

285 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_NF
);

286 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

294 
j
 = 0; j < 22200; j++) {

295 i‡((
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
) &

296 
AR_PHY_AGC_CONTROL_NF
) == 0)

298 
	`udñay
(10);

304 i‡(
bb_agc_˘l
 & 
AR_PHY_AGC_CONTROL_NF
) {

305 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

306 i‡(
bb_agc_˘l
 & 
AR_PHY_AGC_CONTROL_ENABLE_NF
)

307 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

308 
AR_PHY_AGC_CONTROL_ENABLE_NF
);

309 i‡(
bb_agc_˘l
 & 
AR_PHY_AGC_CONTROL_NO_UPDATE_NF
)

310 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
,

311 
AR_PHY_AGC_CONTROL_NO_UPDATE_NF
);

312 
	`REG_SET_BIT
(
ah
, 
AR_PHY_AGC_CONTROL
, 
AR_PHY_AGC_CONTROL_NF
);

313 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

325 i‡(
j
 == 22200) {

326 
	`©h_dbg
(
comm⁄
, 
ANY
,

328 
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
));

329  -
ETIMEDOUT
;

337 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

338 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

339 i‡(
chaömask
 & (1 << 
i
)) {

340 i‡((
i
 >
AR5416_MAX_CHAINS
Ë&& !
	`IS_CHAN_HT40
(
ch™
))

343 
	`REG_RMW
(
ah
,áh->
nf_ªgs
[
i
],

344 (((
u32
) (-50) << 1) & 0x1ff), 0x1ff);

347 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

350 
	}
}

353 
	$©h9k_hw_nf_ßnôize
(
©h_hw
 *
ah
, 
s16
 *
nf
)

355 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

356 
©h_nf_limôs
 *
limô
;

357 
i
;

359 i‡(
	`IS_CHAN_2GHZ
(
ah
->
curch™
))

360 
limô
 = &
ah
->
nf_2g
;

362 
limô
 = &
ah
->
nf_5g
;

364 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

365 i‡(!
nf
[
i
])

368 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

370 (
i
 >3 ? "ext" : "˘l"), i % 3, 
nf
[i]);

372 i‡(
nf
[
i
] > 
limô
->
max
) {

373 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

375 
i
, 
nf
[i], 
limô
->
max
);

376 
nf
[
i
] = 
limô
->
max
;

377 } i‡(
nf
[
i
] < 
limô
->
mö
) {

378 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

380 
i
, 
nf
[i], 
limô
->
mö
);

381 
nf
[
i
] = 
limô
->
nomöÆ
;

384 
	}
}

386 
boﬁ
 
	$©h9k_hw_gënf
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

388 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

389 
öt16_t
 
nf
, 
nfThªsh
;

390 
öt16_t
 
nÁºay
[
NUM_NF_READINGS
] = { 0 };

391 
©h9k_nfˇl_hi°
 *
h
;

392 
õì80211_ch™√l
 *
c
 = 
ch™
->chan;

393 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

395 i‡(
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
Ë& 
AR_PHY_AGC_CONTROL_NF
) {

396 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

398  
Ál£
;

401 
	`©h9k_hw_do_gënf
(
ah
, 
nÁºay
);

402 
	`©h9k_hw_nf_ßnôize
(
ah
, 
nÁºay
);

403 
nf
 = 
nÁºay
[0];

404 i‡(
	`©h9k_hw_gë_nf_thªsh
(
ah
, 
c
->
b™d
, &
nfThªsh
)

405 && 
nf
 > 
nfThªsh
) {

406 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

408 
nf
, 
nfThªsh
);

411 i‡(!
ˇld©a
) {

412 
ch™
->
noi£Êo‹
 = 
nf
;

413  
Ál£
;

416 
h
 = 
ˇld©a
->
nfCÆHi°
;

417 
	`˛ór_bô
(
NFCAL_PENDING
, &
ˇld©a
->
ˇl_Êags
);

418 
	`©h9k_hw_upd©e_nfˇl_hi°_buf„r
(
ah
, 
ˇld©a
, 
nÁºay
);

419 
ch™
->
noi£Êo‹
 = 
h
[0].
¥ivNF
;

420 
ah
->
noi£
 = 
	`©h9k_hw_gëch™_noi£
◊h, 
ch™
, ch™->
noi£Êo‹
);

421  
åue
;

422 
	}
}

423 
EXPORT_SYMBOL
(
©h9k_hw_gënf
);

425 
	$©h9k_öô_nfˇl_hi°_buf„r
(
©h_hw
 *
ah
,

426 
©h9k_ch™√l
 *
ch™
)

428 
©h9k_nfˇl_hi°
 *
h
;

429 
s16
 
deÁu…_nf
;

430 
i
, 
j
;

432 
ah
->
ˇld©a
->
ch™√l
 = 
ch™
->channel;

433 
ah
->
ˇld©a
->
ch™√lFœgs
 = 
ch™
->channelFlags;

434 
h
 = 
ah
->
ˇld©a
->
nfCÆHi°
;

435 
deÁu…_nf
 = 
	`©h9k_hw_gë_deÁu…_nf
(
ah
, 
ch™
);

436 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

437 
h
[
i
].
cuºIndex
 = 0;

438 
h
[
i
].
¥ivNF
 = 
deÁu…_nf
;

439 
h
[
i
].
övÆidNFcou¡
 = 
AR_PHY_CCA_FILTERWINDOW_LENGTH
;

440 
j
 = 0; j < 
ATH9K_NF_CAL_HIST_MAX
; j++) {

441 
h
[
i
].
nfCÆBuf„r
[
j
] = 
deÁu…_nf
;

444 
	}
}

447 
	$©h9k_hw_b°uck_nfˇl
(
©h_hw
 *
ah
)

449 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

451 i‡(
	`u∆ikñy
(!
ˇld©a
))

462 i‡(!
	`ã°_bô
(
NFCAL_PENDING
, &
ˇld©a
->
ˇl_Êags
))

463 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
åue
);

464 i‡(!(
	`REG_READ
(
ah
, 
AR_PHY_AGC_CONTROL
Ë& 
AR_PHY_AGC_CONTROL_NF
))

465 
	`©h9k_hw_gënf
(
ah
,áh->
curch™
);

467 
	`£t_bô
(
NFCAL_INTF
, &
ˇld©a
->
ˇl_Êags
);

468 
	}
}

469 
EXPORT_SYMBOL
(
©h9k_hw_b°uck_nfˇl
);

	@calib.h

17 #i‚de‡
CALIB_H


18 
	#CALIB_H


	)

20 
	~"hw.h
"

22 
	#AR_PHY_CCA_FILTERWINDOW_LENGTH
 5

	)

25 
	#ATH9K_NF_CAL_NOISE_THRESH
 6

	)

27 
	#NUM_NF_READINGS
 6

	)

28 
	#ATH9K_NF_CAL_HIST_MAX
 5

	)

30 
	s¨5416IniAºay
 {

31 
u32
 *
	mü_¨øy
;

32 
u32
 
	mü_rows
;

33 
u32
 
	mü_cﬁumns
;

36 
	#STATIC_INI_ARRAY
(
¨øy
) { \

37 .
ü_¨øy
 = (
u32
 *)(
¨øy
), \

38 .
ü_rows
 = 
	`ARRAY_SIZE
(
¨øy
), \

39 .
ü_cﬁumns
 = 
	`ARRAY_SIZE
(
¨øy
[0]), \

40 }

	)

42 
	#INIT_INI_ARRAY
(
öüºay
, 
¨øy
) do { \

43 (
öüºay
)->
ü_¨øy
 = (
u32
 *)(
¨øy
); \

44 (
öüºay
)->
ü_rows
 = 
	`ARRAY_SIZE
(
¨øy
); \

45 (
öüºay
)->
ü_cﬁumns
 = 
	`ARRAY_SIZE
(
¨øy
[0]); \

46 } 0)

	)

48 
	#INI_RA
(
öüºay
, 
row
, 
cﬁumn
) \

49 (((
öüºay
)->
ü_¨øy
)[(
row
Ë* ((öüºay)->
ü_cﬁumns
Ë+ (
cﬁumn
)])

	)

51 
	#INIT_CAL
(
_≥rCÆ
) do { \

52 (
_≥rCÆ
)->
ˇlSèã
 = 
CAL_WAITING
; \

53 (
_≥rCÆ
)->
ˇlNext
 = 
NULL
; \

54 } 0)

	)

56 
	#INSERT_CAL
(
_ahp
, 
_≥rCÆ
) \

58 i‡((
_ahp
)->
ˇl_li°_œ°
 =
NULL
) { \

59 (
_ahp
)->
ˇl_li°
 = \

60 (
_ahp
)->
ˇl_li°_œ°
 = (
_≥rCÆ
); \

61 ((
_ahp
)->
ˇl_li°_œ°
)->
ˇlNext
 = (
_≥rCÆ
); \

63 ((
_ahp
)->
ˇl_li°_œ°
)->
ˇlNext
 = (
_≥rCÆ
); \

64 (
_ahp
)->
ˇl_li°_œ°
 = (
_≥rCÆ
); \

65 (
_≥rCÆ
)->
ˇlNext
 = (
_ahp
)->
ˇl_li°
; \

67 } 0)

	)

69 
	e©h9k_ˇl_°©e
 {

70 
	mCAL_INACTIVE
,

71 
	mCAL_WAITING
,

72 
	mCAL_RUNNING
,

73 
	mCAL_DONE


76 
	#MIN_CAL_SAMPLES
 1

	)

77 
	#MAX_CAL_SAMPLES
 64

	)

78 
	#INIT_LOG_COUNT
 5

	)

79 
	#PER_MIN_LOG_COUNT
 2

	)

80 
	#PER_MAX_LOG_COUNT
 10

	)

82 
	s©h9k_≥rˇl_d©a
 {

83 
u32
 
	mˇlTy≥
;

84 
u32
 
	mˇlNumSam∂es
;

85 
u32
 
	mˇlCou¡Max
;

86 (*
	mˇlCﬁÀ˘
Ë(
	m©h_hw
 *);

87 (*
	mˇlPo°Proc
Ë(
	m©h_hw
 *, 
	mu8
);

90 
	s©h9k_ˇl_li°
 {

91 c⁄° 
©h9k_≥rˇl_d©a
 *
	mˇlD©a
;

92 
©h9k_ˇl_°©e
 
	mˇlSèã
;

93 
©h9k_ˇl_li°
 *
	mˇlNext
;

96 
	s©h9k_nfˇl_hi°
 {

97 
öt16_t
 
	mnfCÆBuf„r
[
ATH9K_NF_CAL_HIST_MAX
];

98 
u8
 
	mcuºIndex
;

99 
öt16_t
 
	m¥ivNF
;

100 
u8
 
	mövÆidNFcou¡
;

103 
	#MAX_PACAL_SKIPCOUNT
 8

	)

104 
	s©h9k_∑ˇl_öfo
{

105 
öt32_t
 
	m¥ev_off£t
;

106 
öt8_t
 
	mmax_skùcou¡
;

107 
öt8_t
 
	mskùcou¡
;

110 
boﬁ
 
©h9k_hw_ª£t_ˇlvÆid
(
©h_hw
 *
ah
);

111 
©h9k_hw_°¨t_nfˇl
(
©h_hw
 *
ah
, 
boﬁ
 
upd©e
);

112 
©h9k_hw_lﬂdnf
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

113 
boﬁ
 
©h9k_hw_gënf
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

114 
©h9k_öô_nfˇl_hi°_buf„r
(
©h_hw
 *
ah
,

115 
©h9k_ch™√l
 *
ch™
);

116 
©h9k_hw_b°uck_nfˇl
(
©h_hw
 *
ah
);

117 
©h9k_hw_ª£t_ˇlibøti⁄
(
©h_hw
 *
ah
,

118 
©h9k_ˇl_li°
 *
cuºCÆ
);

119 
s16
 
©h9k_hw_gëch™_noi£
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

120 
s16
 
nf
);

	@channel.c

17 
	~"©h9k.h
"

23 
	$©h_£t_ch™√l
(
©h_so·c
 *
sc
)

25 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

26 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

27 
õì80211_hw
 *
hw
 = 
sc
->hw;

28 
©h9k_ch™√l
 *
hch™
;

29 
cfg80211_ch™_def
 *
ch™def
 = &
sc
->
cur_ch™
->chandef;

30 
õì80211_ch™√l
 *
ch™
 = 
ch™def
->chan;

31 
pos
 = 
ch™
->
hw_vÆue
;

32 
ﬁd_pos
 = -1;

33 
r
;

35 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
))

36  -
EIO
;

38 i‡(
ah
->
curch™
)

39 
ﬁd_pos
 = 
ah
->
curch™
 - &ah->
ch™√ls
[0];

41 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Set channel: %d MHz width: %d\n",

42 
ch™
->
˚¡î_‰eq
, 
ch™def
->
width
);

45 
	`•ö_lock_bh
(&
comm⁄
->
cc_lock
);

46 
	`©h_upd©e_survey_°©s
(
sc
);

47 
	`•ö_u∆ock_bh
(&
comm⁄
->
cc_lock
);

49 
	`©h9k_cmn_gë_ch™√l
(
hw
, 
ah
, 
ch™def
);

56 i‡(!
sc
->
cur_ch™
->
offch™√l
 && sc->
cur_survey
 !&sc->
survey
[
pos
]) {

57 i‡(
sc
->
cur_survey
)

58 
sc
->
cur_survey
->
fûÀd
 &~
SURVEY_INFO_IN_USE
;

60 
sc
->
cur_survey
 = &sc->
survey
[
pos
];

62 
	`mem£t
(
sc
->
cur_survey
, 0, (
survey_öfo
));

63 
sc
->
cur_survey
->
fûÀd
 |
SURVEY_INFO_IN_USE
;

64 } i‡(!(
sc
->
survey
[
pos
].
fûÀd
 & 
SURVEY_INFO_IN_USE
)) {

65 
	`mem£t
(&
sc
->
survey
[
pos
], 0, (
survey_öfo
));

68 
hch™
 = &
sc
->
sc_ah
->
ch™√ls
[
pos
];

69 
r
 = 
	`©h_ª£t
(
sc
, 
hch™
);

70 i‡(
r
)

71  
r
;

77 i‡(
ﬁd_pos
 >= 0)

78 
	`©h_upd©e_survey_nf
(
sc
, 
ﬁd_pos
);

83 i‡(
hw
->
c⁄f
.
ød¨_íabÀd
) {

84 
u32
 
rxfûãr
;

86 
rxfûãr
 = 
	`©h9k_hw_gërxfûãr
(
ah
);

87 
rxfûãr
 |
ATH9K_RX_FILTER_PHYRADAR
 |

88 
ATH9K_RX_FILTER_PHYERR
;

89 
	`©h9k_hw_£åxfûãr
(
ah
, 
rxfûãr
);

90 
	`©h_dbg
(
comm⁄
, 
DFS
, "DFSÉnabledát freq %d\n",

91 
ch™
->
˚¡î_‰eq
);

94 i‡(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
) &&

95 
sc
->
•ec_¥iv
.
•e˘øl_mode
 =
SPECTRAL_CHANSCAN
)

96 
	`©h9k_cmn_•e˘øl_sˇn_åiggî
(
comm⁄
, &
sc
->
•ec_¥iv
);

100 
	}
}

102 
	$©h_ch™˘x_öô
(
©h_so·c
 *
sc
)

104 
©h_ch™˘x
 *
˘x
;

105 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

106 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

107 
õì80211_ch™√l
 *
ch™
;

108 
i
, 
j
;

110 
sb™d
 = &
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
];

111 i‡(!
sb™d
->
n_ch™√ls
)

112 
sb™d
 = &
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
];

114 
ch™
 = &
sb™d
->
ch™√ls
[0];

115 
i
 = 0; i < 
ATH9K_NUM_CHANCTX
; i++) {

116 
˘x
 = &
sc
->
ch™˘x
[
i
];

117 
	`cfg80211_ch™def_¸óã
(&
˘x
->
ch™def
, 
ch™
, 
NL80211_CHAN_HT20
);

118 
	`INIT_LIST_HEAD
(&
˘x
->
vifs
);

119 
˘x
->
txpowî
 = 
ATH_TXPOWER_MAX
;

120 
˘x
->
Êush_timeout
 = 
HZ
 / 5;

121 
j
 = 0; j < 
	`ARRAY_SIZE
(
˘x
->
acq
); j++)

122 
	`INIT_LIST_HEAD
(&
˘x
->
acq
[
j
]);

124 
	}
}

126 
	$©h_ch™˘x_£t_ch™√l
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
,

127 
cfg80211_ch™_def
 *
ch™def
)

129 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

130 
boﬁ
 
cur_ch™
;

132 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

133 i‡(
ch™def
)

134 
	`mem˝y
(&
˘x
->
ch™def
, chandef, (*chandef));

135 
cur_ch™
 = 
sc
->cur_ch™ =
˘x
;

136 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

138 i‡(!
cur_ch™
) {

139 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

144 
	`©h_£t_ch™√l
(
sc
);

145 
	}
}

147 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


153 
©h_ch™˘x
* 
	$©h_is_go_ch™˘x_¥e£¡
(
©h_so·c
 *
sc
)

155 
©h_ch™˘x
 *
˘x
;

156 
©h_vif
 *
avp
;

157 
õì80211_vif
 *
vif
;

159 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

161 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
) {

162 i‡(!
˘x
->
a˘ive
)

165 
	`li°_f‹_óch_íåy
(
avp
, &
˘x
->
vifs
, 
li°
) {

166 
vif
 = 
avp
->vif;

168 i‡(
	`õì80211_vif_ty≥_p2p
(
vif
Ë=
NL80211_IFTYPE_P2P_GO
) {

169 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

170  
˘x
;

175 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

176  
NULL
;

177 
	}
}

183 c⁄° *
	$offch™√l_°©e_°rög
(
©h_offch™√l_°©e
 
°©e
)

185 
°©e
) {

186 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_IDLE
);

187 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_PROBE_SEND
);

188 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_PROBE_WAIT
);

189 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_SUSPEND
);

190 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_ROC_START
);

191 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_ROC_WAIT
);

192 
	`ˇ£_πn_°rög
(
ATH_OFFCHANNEL_ROC_DONE
);

196 
	}
}

198 c⁄° *
	$ch™˘x_evít_°rög
(
©h_ch™˘x_evít
 
ev
)

200 
ev
) {

201 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_BEACON_PREPARE
);

202 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_BEACON_SENT
);

203 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_TSF_TIMER
);

204 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_BEACON_RECEIVED
);

205 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_AUTHORIZED
);

206 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_SWITCH
);

207 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_ASSIGN
);

208 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_UNASSIGN
);

209 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_CHANGE
);

210 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_EVENT_ENABLE_MULTICHANNEL
);

214 
	}
}

216 c⁄° *
	$ch™˘x_°©e_°rög
(
©h_ch™˘x_°©e
 
°©e
)

218 
°©e
) {

219 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_STATE_IDLE
);

220 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
);

221 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_STATE_WAIT_FOR_TIMER
);

222 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_STATE_SWITCH
);

223 
	`ˇ£_πn_°rög
(
ATH_CHANCTX_STATE_FORCE_ACTIVE
);

227 
	}
}

229 c⁄° 
u32
 
	$ch™˘x_evít_dñè
(
©h_so·c
 *
sc
)

231 
u64
 
ms
;

232 
time•ec
 
ts
, *
ﬁd
;

234 
	`gëøwm⁄Ÿ⁄ic
(&
ts
);

235 
ﬁd
 = &
sc
->
œ°_evít_time
;

236 
ms
 = 
ts
.
tv_£c
 * 1000 +Ås.
tv_n£c
 / 1000000;

237 
ms
 -
ﬁd
->
tv_£c
 * 1000 + old->
tv_n£c
 / 1000000;

238 
sc
->
œ°_evít_time
 = 
ts
;

240  (
u32
)
ms
;

241 
	}
}

243 
	$©h_ch™˘x_check_a˘ive
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
)

245 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

246 
©h_ch™˘x
 *
i˘x
;

247 
©h_vif
 *
avp
;

248 
boﬁ
 
a˘ive
 = 
Ál£
;

249 
u8
 
n_a˘ive
 = 0;

251 i‡(!
˘x
)

254 i‡(
˘x
 =&
sc
->
offch™√l
.
ch™
) {

255 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

257 i‡(
	`likñy
(
sc
->
sched
.
ch™√l_swôch_time
))

258 
˘x
->
Êush_timeout
 =

259 
	`u£cs_to_jiffõs
(
sc
->
sched
.
ch™√l_swôch_time
);

261 
˘x
->
Êush_timeout
 =

262 
	`m£cs_to_jiffõs
(10);

264 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

274 
i˘x
 = 
˘x
;

276 
	`li°_f‹_óch_íåy
(
avp
, &
˘x
->
vifs
, 
li°
) {

277 
õì80211_vif
 *
vif
 = 
avp
->vif;

279 
vif
->
ty≥
) {

280 
NL80211_IFTYPE_P2P_CLIENT
:

281 
NL80211_IFTYPE_STATION
:

282 i‡(
avp
->
assoc
)

283 
a˘ive
 = 
åue
;

286 
a˘ive
 = 
åue
;

290 
˘x
->
a˘ive
 =áctive;

292 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
) {

293 i‡(!
˘x
->
assig√d
 || 
	`li°_em±y
(&˘x->
vifs
))

295 
n_a˘ive
++;

298 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

300 i‡(
n_a˘ive
 <= 1) {

301 
i˘x
->
Êush_timeout
 = 
HZ
 / 5;

302 
	`˛ór_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
);

303 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

307 
i˘x
->
Êush_timeout
 = 
	`u£cs_to_jiffõs
(
sc
->
sched
.
ch™√l_swôch_time
);

309 i‡(
	`ã°_™d_£t_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
)) {

310 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

314 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

316 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

317 
	`©h_ch™˘x_evít
(
sc
, 
NULL
,

318 
ATH_CHANCTX_EVENT_ENABLE_MULTICHANNEL
);

320 
	}
}

322 
©h_ch™˘x
 *

323 
	$©h_ch™˘x_gë_√xt
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
)

325 
idx
 = 
˘x
 - &
sc
->
ch™˘x
[0];

327  &
sc
->
ch™˘x
[!
idx
];

328 
	}
}

330 
	$©h_ch™˘x_adju°_tbâ_dñè
(
©h_so·c
 *
sc
)

332 
©h_ch™˘x
 *
¥ev
, *
cur
;

333 
time•ec
 
ts
;

334 
u32
 
cur_tsf
, 
¥ev_tsf
, 
bóc⁄_öt
;

335 
s32
 
off£t
;

337 
bóc⁄_öt
 = 
	`TU_TO_USEC
(
sc
->
cur_ch™
->
bóc⁄
.
bóc⁄_öãrvÆ
);

339 
cur
 = 
sc
->
cur_ch™
;

340 
¥ev
 = 
	`©h_ch™˘x_gë_√xt
(
sc
, 
cur
);

342 i‡(!
¥ev
->
swôch_a·î_bóc⁄
)

345 
	`gëøwm⁄Ÿ⁄ic
(&
ts
);

346 
cur_tsf
 = (
u32
Ë
cur
->
tsf_vÆ
 +

347 
	`©h9k_hw_gë_tsf_off£t
(&
cur
->
tsf_ts
, &
ts
);

349 
¥ev_tsf
 = 
¥ev
->
œ°_bóc⁄
 - (
u32
Ë¥ev->
tsf_vÆ
 + 
cur_tsf
;

350 
¥ev_tsf
 -
	`©h9k_hw_gë_tsf_off£t
(&
¥ev
->
tsf_ts
, &
ts
);

355 
off£t
 = 
cur_tsf
 - 
¥ev_tsf
;

358 i‡(
off£t
 < 0 || off£à> 3 * 
bóc⁄_öt
)

361 
off£t
 = 
bóc⁄_öt
 / 2 - (offset % beacon_int);

362 
¥ev
->
tsf_vÆ
 +
off£t
;

363 
	}
}

369 
	$©h_ch™˘x_£tup_timî
(
©h_so·c
 *
sc
, 
u32
 
tsf_time
)

371 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

372 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

373 
timeout
;

375 
	`©h9k_hw_gí_timî_°¨t
(
ah
, 
sc
->
p2p_ps_timî
, 
tsf_time
, 1000000);

376 
tsf_time
 -
	`©h9k_hw_gëtsf32
(
ah
);

377 
timeout
 = 
	`m£cs_to_jiffõs
(
tsf_time
 / 1000) + 1;

378 
	`mod_timî
(&
sc
->
sched
.
timî
, 
jiffõs
 + 
timeout
);

380 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

382 
tsf_time
 / 1000, 
	`jiffõs_to_m£cs
(
timeout
));

383 
	}
}

385 
	$©h_ch™˘x_h™dÀ_bmiss
(
©h_so·c
 *
sc
,

386 
©h_ch™˘x
 *
˘x
,

387 
©h_vif
 *
avp
)

395 i‡(
˘x
->
a˘ive
 && 
sc
->
sched
.
exãnd_ab£n˚
) {

396 
avp
->
nﬂ_duøti⁄
 = 0;

397 
sc
->
sched
.
exãnd_ab£n˚
 = 
Ál£
;

404 i‡(
˘x
->
a˘ive
 && 
sc
->
sched
.
bóc⁄_miss
 >= 2) {

405 
avp
->
nﬂ_duøti⁄
 = 0;

406 
sc
->
sched
.
exãnd_ab£n˚
 = 
åue
;

408 
	}
}

410 
	$©h_ch™˘x_offch™√l_nﬂ
(
©h_so·c
 *
sc
,

411 
©h_ch™˘x
 *
˘x
,

412 
©h_vif
 *
avp
,

413 
u32
 
tsf_time
)

415 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

417 
avp
->
nﬂ_ödex
++;

418 
avp
->
offch™√l_°¨t
 = 
tsf_time
;

419 
avp
->
offch™√l_duøti⁄
 = 
sc
->
sched
.offchannel_duration;

421 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

423 
avp
->
offch™√l_duøti⁄
,

424 
avp
->
offch™√l_°¨t
,

425 
avp
->
nﬂ_ödex
);

432 i‡(
˘x
->
a˘ive
 && 
avp
->
nﬂ_duøti⁄
)

433 
avp
->
nﬂ_duøti⁄
 = 0;

434 
	}
}

436 
	$©h_ch™˘x_£t_≥riodic_nﬂ
(
©h_so·c
 *
sc
,

437 
©h_vif
 *
avp
,

438 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
,

439 
u32
 
tsf_time
,

440 
u32
 
bóc⁄_öt
)

442 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

444 
avp
->
nﬂ_ödex
++;

445 
avp
->
nﬂ_°¨t
 = 
tsf_time
;

447 i‡(
sc
->
sched
.
exãnd_ab£n˚
)

448 
avp
->
nﬂ_duøti⁄
 = (3 * 
bóc⁄_öt
 / 2) +

449 
sc
->
sched
.
ch™√l_swôch_time
;

451 
avp
->
nﬂ_duøti⁄
 =

452 
	`TU_TO_USEC
(
cur_c⁄f
->
bóc⁄_öãrvÆ
) / 2 +

453 
sc
->
sched
.
ch™√l_swôch_time
;

455 i‡(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
) ||

456 
sc
->
sched
.
exãnd_ab£n˚
)

457 
avp
->
≥riodic_nﬂ
 = 
Ál£
;

459 
avp
->
≥riodic_nﬂ
 = 
åue
;

461 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

463 
avp
->
nﬂ_duøti⁄
,

464 
avp
->
nﬂ_°¨t
,

465 
avp
->
nﬂ_ödex
,

466 
avp
->
≥riodic_nﬂ
);

467 
	}
}

469 
	$©h_ch™˘x_£t_⁄eshŸ_nﬂ
(
©h_so·c
 *
sc
,

470 
©h_vif
 *
avp
,

471 
u32
 
tsf_time
,

472 
u32
 
duøti⁄
)

474 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

476 
avp
->
nﬂ_ödex
++;

477 
avp
->
nﬂ_°¨t
 = 
tsf_time
;

478 
avp
->
≥riodic_nﬂ
 = 
Ál£
;

479 
avp
->
⁄eshŸ_nﬂ
 = 
åue
;

480 
avp
->
nﬂ_duøti⁄
 = 
duøti⁄
 + 
sc
->
sched
.
ch™√l_swôch_time
;

482 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

484 
avp
->
nﬂ_duøti⁄
,

485 
avp
->
nﬂ_°¨t
,

486 
avp
->
nﬂ_ödex
,

487 
avp
->
≥riodic_nﬂ
);

488 
	}
}

490 
	$©h_ch™˘x_evít
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
,

491 
©h_ch™˘x_evít
 
ev
)

493 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

494 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

495 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
;

496 
©h_vif
 *
avp
 = 
NULL
;

497 
©h_ch™˘x
 *
˘x
;

498 
u32
 
tsf_time
;

499 
u32
 
bóc⁄_öt
;

501 i‡(
vif
)

502 
avp
 = (
©h_vif
 *Ë
vif
->
drv_¥iv
;

504 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

506 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "cur_chan: %d MHz,Évent: %s, state: %s, delta: %u ms\n",

507 
sc
->
cur_ch™
->
ch™def
.
˚¡î_‰eq1
,

508 
	`ch™˘x_evít_°rög
(
ev
),

509 
	`ch™˘x_°©e_°rög
(
sc
->
sched
.
°©e
),

510 
	`ch™˘x_evít_dñè
(
sc
));

512 
ev
) {

513 
ATH_CHANCTX_EVENT_BEACON_PREPARE
:

514 i‡(
avp
->
offch™√l_duøti⁄
)

515 
avp
->
offch™√l_duøti⁄
 = 0;

517 i‡(
avp
->
⁄eshŸ_nﬂ
) {

518 
avp
->
nﬂ_duøti⁄
 = 0;

519 
avp
->
⁄eshŸ_nﬂ
 = 
Ál£
;

521 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

525 i‡(
avp
->
ch™˘x
 !
sc
->
cur_ch™
) {

526 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

531 i‡(
sc
->
sched
.
offch™√l_≥ndög
 && !sc->sched.
waô_swôch
) {

532 
sc
->
sched
.
offch™√l_≥ndög
 = 
Ál£
;

533 
sc
->
√xt_ch™
 = &sc->
offch™√l
.
ch™
;

534 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
;

535 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

539 
˘x
 = 
	`©h_ch™˘x_gë_√xt
(
sc
, sc->
cur_ch™
);

540 i‡(
˘x
->
a˘ive
 && 
sc
->
sched
.
°©e
 =
ATH_CHANCTX_STATE_IDLE
) {

541 
sc
->
√xt_ch™
 = 
˘x
;

542 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
;

543 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

548 i‡(
sc
->
sched
.
°©e
 =
ATH_CHANCTX_STATE_WAIT_FOR_TIMER
) {

549 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
;

550 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

554 i‡(
sc
->
sched
.
mgd_¥ï¨e_tx
)

555 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
;

563 i‡(!
˘x
->
a˘ive
 && 
avp
->
nﬂ_duøti⁄
 &&

564 
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
) {

565 
avp
->
nﬂ_duøti⁄
 = 0;

566 
avp
->
≥riodic_nﬂ
 = 
Ál£
;

568 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

572 i‡(
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
)

575 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "Pª∑rög bóc⁄ f‹ vif: %pM\n", 
vif
->
addr
);

577 
sc
->
sched
.
bóc⁄_≥ndög
 = 
åue
;

578 
sc
->
sched
.
√xt_tbâ
 = 
	`REG_READ
(
ah
, 
AR_NEXT_TBTT_TIMER
);

580 
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

581 
bóc⁄_öt
 = 
	`TU_TO_USEC
(
cur_c⁄f
->
bóc⁄_öãrvÆ
);

584 
tsf_time
 = 
sc
->
sched
.
√xt_tbâ
 + 
bóc⁄_öt
 / 4;

585 
sc
->
sched
.
swôch_°¨t_time
 = 
tsf_time
;

586 
sc
->
cur_ch™
->
œ°_bóc⁄
 = sc->
sched
.
√xt_tbâ
;

593 i‡(
sc
->
√xt_ch™
 =&sc->
offch™√l
.
ch™
) {

594 
	`©h_ch™˘x_offch™√l_nﬂ
(
sc
, 
˘x
, 
avp
, 
tsf_time
);

598 
	`©h_ch™˘x_h™dÀ_bmiss
(
sc
, 
˘x
, 
avp
);

606 i‡(
sc
->
sched
.
mgd_¥ï¨e_tx
) {

607 
	`©h_ch™˘x_£t_⁄eshŸ_nﬂ
(
sc
, 
avp
, 
tsf_time
,

608 
	`jiffõs_to_u£cs
(
HZ
 / 5));

613 i‡(
avp
->
nﬂ_duøti⁄
 && 
tsf_time
 -ávp->
nﬂ_°¨t
 > 
	`BIT
(30))

614 
avp
->
nﬂ_duøti⁄
 = 0;

621 i‡(
˘x
->
a˘ive
 &&

622 (!
avp
->
nﬂ_duøti⁄
 || 
sc
->
sched
.
f‹˚_nﬂ_upd©e
))

623 
	`©h_ch™˘x_£t_≥riodic_nﬂ
(
sc
, 
avp
, 
cur_c⁄f
,

624 
tsf_time
, 
bóc⁄_öt
);

626 i‡(
˘x
->
a˘ive
 && 
sc
->
sched
.
f‹˚_nﬂ_upd©e
)

627 
sc
->
sched
.
f‹˚_nﬂ_upd©e
 = 
Ál£
;

630 
ATH_CHANCTX_EVENT_BEACON_SENT
:

631 i‡(!
sc
->
sched
.
bóc⁄_≥ndög
) {

632 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

637 
sc
->
sched
.
bóc⁄_≥ndög
 = 
Ál£
;

639 i‡(
sc
->
sched
.
mgd_¥ï¨e_tx
) {

640 
sc
->
sched
.
mgd_¥ï¨e_tx
 = 
Ál£
;

641 
	`com∂ëe
(&
sc
->
go_bóc⁄
);

642 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

647 i‡(
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
)

650 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

653 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_TIMER
;

654 
	`©h_ch™˘x_£tup_timî
(
sc
, sc->
sched
.
swôch_°¨t_time
);

656 
ATH_CHANCTX_EVENT_TSF_TIMER
:

657 i‡(
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_WAIT_FOR_TIMER
)

660 i‡(!
sc
->
cur_ch™
->
swôch_a·î_bóc⁄
 &&

661 
sc
->
sched
.
bóc⁄_≥ndög
)

662 
sc
->
sched
.
bóc⁄_miss
++;

664 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

667 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_SWITCH
;

668 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
ch™˘x_w‹k
);

670 
ATH_CHANCTX_EVENT_BEACON_RECEIVED
:

671 i‡(!
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
) ||

672 
sc
->
cur_ch™
 =&sc->
offch™√l
.
ch™
)

675 
sc
->
sched
.
bóc⁄_≥ndög
 = 
Ál£
;

676 
sc
->
sched
.
bóc⁄_miss
 = 0;

678 i‡(
sc
->
sched
.
°©e
 =
ATH_CHANCTX_STATE_FORCE_ACTIVE
 ||

679 !
sc
->
sched
.
bóc⁄_adju°
 ||

680 !
sc
->
cur_ch™
->
tsf_vÆ
)

683 
	`©h_ch™˘x_adju°_tbâ_dñè
(
sc
);

688 
tsf_time
 = 
sc
->
sched
.
swôch_°¨t_time
;

689 
tsf_time
 -(
u32
Ë
sc
->
cur_ch™
->
tsf_vÆ
 +

690 
	`©h9k_hw_gë_tsf_off£t
(&
sc
->
cur_ch™
->
tsf_ts
, 
NULL
);

691 
tsf_time
 +
	`©h9k_hw_gëtsf32
(
ah
);

693 
sc
->
sched
.
bóc⁄_adju°
 = 
Ál£
;

694 
	`©h_ch™˘x_£tup_timî
(
sc
, 
tsf_time
);

696 
ATH_CHANCTX_EVENT_AUTHORIZED
:

697 i‡(
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_FORCE_ACTIVE
 ||

698 
avp
->
ch™˘x
 !
sc
->
cur_ch™
)

701 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

704 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_IDLE
;

706 
ATH_CHANCTX_EVENT_SWITCH
:

707 i‡(!
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
) ||

708 
sc
->
sched
.
°©e
 =
ATH_CHANCTX_STATE_FORCE_ACTIVE
 ||

709 
sc
->
cur_ch™
->
swôch_a·î_bóc⁄
 ||

710 
sc
->
cur_ch™
 =&sc->
offch™√l
.
ch™
)

716 
sc
->
√xt_ch™
 = 
	`©h_ch™˘x_gë_√xt
(sc, sc->
cur_ch™
);

717 
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

719 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

722 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_TIMER
;

723 
sc
->
sched
.
waô_swôch
 = 
Ál£
;

725 
tsf_time
 = 
	`TU_TO_USEC
(
cur_c⁄f
->
bóc⁄_öãrvÆ
) / 2;

727 i‡(
sc
->
sched
.
exãnd_ab£n˚
) {

728 
sc
->
sched
.
bóc⁄_miss
 = 0;

729 
tsf_time
 *= 3;

732 
tsf_time
 -
sc
->
sched
.
ch™√l_swôch_time
;

733 
tsf_time
 +
	`©h9k_hw_gëtsf32
(
sc
->
sc_ah
);

734 
sc
->
sched
.
swôch_°¨t_time
 = 
tsf_time
;

736 
	`©h_ch™˘x_£tup_timî
(
sc
, 
tsf_time
);

737 
sc
->
sched
.
bóc⁄_≥ndög
 = 
åue
;

738 
sc
->
sched
.
bóc⁄_adju°
 = 
åue
;

740 
ATH_CHANCTX_EVENT_ENABLE_MULTICHANNEL
:

741 i‡(
sc
->
cur_ch™
 =&sc->
offch™√l
.
ch™
 ||

742 
sc
->
cur_ch™
->
swôch_a·î_bóc⁄
)

745 
sc
->
√xt_ch™
 = 
	`©h_ch™˘x_gë_√xt
(sc, sc->
cur_ch™
);

746 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
ch™˘x_w‹k
);

748 
ATH_CHANCTX_EVENT_UNASSIGN
:

749 i‡(
sc
->
cur_ch™
->
assig√d
) {

750 i‡(
sc
->
√xt_ch™
 && !sc->√xt_ch™->
assig√d
 &&

751 
sc
->
√xt_ch™
 !&sc->
offch™√l
.
ch™
)

752 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_IDLE
;

756 
˘x
 = 
	`©h_ch™˘x_gë_√xt
(
sc
, sc->
cur_ch™
);

757 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_IDLE
;

758 i‡(!
˘x
->
assig√d
)

761 
sc
->
√xt_ch™
 = 
˘x
;

762 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
ch™˘x_w‹k
);

764 
ATH_CHANCTX_EVENT_ASSIGN
:

766 
ATH_CHANCTX_EVENT_CHANGE
:

770 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

771 
	}
}

773 
	$©h_ch™˘x_bóc⁄_£¡_ev
(
©h_so·c
 *
sc
,

774 
©h_ch™˘x_evít
 
ev
)

776 i‡(
sc
->
sched
.
bóc⁄_≥ndög
)

777 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ev
);

778 
	}
}

780 
	$©h_ch™˘x_bóc⁄_ªcv_ev
(
©h_so·c
 *
sc
,

781 
©h_ch™˘x_evít
 
ev
)

783 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ev
);

784 
	}
}

786 
	$©h_sˇn_ch™√l_duøti⁄
(
©h_so·c
 *
sc
,

787 
õì80211_ch™√l
 *
ch™
)

789 
cfg80211_sˇn_ªque°
 *
ªq
 = 
sc
->
offch™√l
.
sˇn_ªq
;

791 i‡(!
ªq
->
n_ssids
 || (
ch™
->
Êags
 & 
IEEE80211_CHAN_NO_IR
))

792  (
HZ
 / 9);

794  (
HZ
 / 16);

795 
	}
}

797 
	$©h_ch™˘x_swôch
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
,

798 
cfg80211_ch™_def
 *
ch™def
)

800 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

802 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

804 i‡(
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
) &&

805 (
sc
->
cur_ch™
 !
˘x
Ë&& (˘x =&sc->
offch™√l
.
ch™
)) {

806 i‡(
ch™def
)

807 
˘x
->
ch™def
 = *chandef;

809 
sc
->
sched
.
offch™√l_≥ndög
 = 
åue
;

810 
sc
->
sched
.
waô_swôch
 = 
åue
;

811 
sc
->
sched
.
offch™√l_duøti⁄
 =

812 
	`jiffõs_to_u£cs
(
sc
->
offch™√l
.
duøti⁄
) +

813 
sc
->
sched
.
ch™√l_swôch_time
;

815 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

816 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

821 
sc
->
√xt_ch™
 = 
˘x
;

822 i‡(
ch™def
) {

823 
˘x
->
ch™def
 = *chandef;

824 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

825 "Assig√dÇext_ch™Åÿ%d MHz\n", 
ch™def
->
˚¡î_‰eq1
);

828 i‡(
sc
->
√xt_ch™
 =&sc->
offch™√l
.
ch™
) {

829 
sc
->
sched
.
offch™√l_duøti⁄
 =

830 
	`jiffõs_to_u£cs
(
sc
->
offch™√l
.
duøti⁄
) +

831 
sc
->
sched
.
ch™√l_swôch_time
;

833 i‡(
ch™def
) {

834 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

836 
ch™def
->
˚¡î_‰eq1
,

837 
sc
->
sched
.
offch™√l_duøti⁄
);

840 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

841 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
ch™˘x_w‹k
);

842 
	}
}

844 
	$©h_ch™˘x_offch™_swôch
(
©h_so·c
 *
sc
,

845 
õì80211_ch™√l
 *
ch™
)

847 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

848 
cfg80211_ch™_def
 
ch™def
;

850 
	`cfg80211_ch™def_¸óã
(&
ch™def
, 
ch™
, 
NL80211_CHAN_NO_HT
);

851 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

852 "Ch™√»deföôi⁄ cª©ed: %d MHz\n", 
ch™def
.
˚¡î_‰eq1
);

854 
	`©h_ch™˘x_swôch
(
sc
, &sc->
offch™√l
.
ch™
, &
ch™def
);

855 
	}
}

857 
©h_ch™˘x
 *
	$©h_ch™˘x_gë_›î_ch™
(
©h_so·c
 *
sc
,

858 
boﬁ
 
a˘ive
)

860 
©h_ch™˘x
 *
˘x
;

862 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
) {

863 i‡(!
˘x
->
assig√d
 || 
	`li°_em±y
(&˘x->
vifs
))

865 i‡(
a˘ive
 && !
˘x
->active)

868 i‡(
˘x
->
swôch_a·î_bóc⁄
)

869  
˘x
;

872  &
sc
->
ch™˘x
[0];

873 
	}
}

876 
	$©h_sˇn_√xt_ch™√l
(
©h_so·c
 *
sc
)

878 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

879 
cfg80211_sˇn_ªque°
 *
ªq
 = 
sc
->
offch™√l
.
sˇn_ªq
;

880 
õì80211_ch™√l
 *
ch™
;

882 i‡(
sc
->
offch™√l
.
sˇn_idx
 >
ªq
->
n_ch™√ls
) {

883 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

886 
sc
->
offch™√l
.
sˇn_idx
,

887 
ªq
->
n_ch™√ls
);

889 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_IDLE
;

890 
	`©h_ch™˘x_swôch
(
sc
, 
	`©h_ch™˘x_gë_›î_ch™
(sc, 
Ál£
),

891 
NULL
);

895 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

897 
sc
->
offch™√l
.
sˇn_idx
);

899 
ch™
 = 
ªq
->
ch™√ls
[
sc
->
offch™√l
.
sˇn_idx
++];

900 
sc
->
offch™√l
.
duøti⁄
 = 
	`©h_sˇn_ch™√l_duøti⁄
(sc, 
ch™
);

901 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_PROBE_SEND
;

903 
	`©h_ch™˘x_offch™_swôch
(
sc
, 
ch™
);

904 
	}
}

906 
	$©h_offch™√l_√xt
(
©h_so·c
 *
sc
)

908 
õì80211_vif
 *
vif
;

910 i‡(
sc
->
offch™√l
.
sˇn_ªq
) {

911 
vif
 = 
sc
->
offch™√l
.
sˇn_vif
;

912 
sc
->
offch™√l
.
ch™
.
txpowî
 = 
vif
->
bss_c⁄f
.txpower;

913 
	`©h_sˇn_√xt_ch™√l
(
sc
);

914 } i‡(
sc
->
offch™√l
.
roc_vif
) {

915 
vif
 = 
sc
->
offch™√l
.
roc_vif
;

916 
sc
->
offch™√l
.
ch™
.
txpowî
 = 
vif
->
bss_c⁄f
.txpower;

917 
sc
->
offch™√l
.
duøti⁄
 =

918 
	`m£cs_to_jiffõs
(
sc
->
offch™√l
.
roc_duøti⁄
);

919 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_ROC_START
;

920 
	`©h_ch™˘x_offch™_swôch
(
sc
, sc->
offch™√l
.
roc_ch™
);

922 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

923 
sc
->
sched
.
offch™√l_≥ndög
 = 
Ál£
;

924 
sc
->
sched
.
waô_swôch
 = 
Ál£
;

925 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

927 
	`©h_ch™˘x_swôch
(
sc
, 
	`©h_ch™˘x_gë_›î_ch™
(sc, 
Ál£
),

928 
NULL
);

929 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_IDLE
;

930 i‡(
sc
->
ps_idÀ
)

931 
	`©h_ˇn˚l_w‹k
(
sc
);

933 
	}
}

935 
	$©h_roc_com∂ëe
(
©h_so·c
 *
sc
, 
©h_roc_com∂ëe_ªas⁄
 
ªas⁄
)

937 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

939 
sc
->
offch™√l
.
roc_vif
 = 
NULL
;

940 
sc
->
offch™√l
.
roc_ch™
 = 
NULL
;

942 
ªas⁄
) {

943 
ATH_ROC_COMPLETE_ABORT
:

944 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "RoCáborted\n");

945 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
sc
->
hw
);

947 
ATH_ROC_COMPLETE_EXPIRE
:

948 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "RoCÉxpired\n");

949 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
sc
->
hw
);

951 
ATH_ROC_COMPLETE_CANCEL
:

952 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "RoC canceled\n");

956 
	`©h_offch™√l_√xt
(
sc
);

957 
	`©h9k_ps_ª°‹e
(
sc
);

958 
	}
}

960 
	$©h_sˇn_com∂ëe
(
©h_so·c
 *
sc
, 
boﬁ
 
ab‹t
)

962 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

964 i‡(
ab‹t
)

965 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "HW scanáborted\n");

967 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "HW scan complete\n");

969 
sc
->
offch™√l
.
sˇn_ªq
 = 
NULL
;

970 
sc
->
offch™√l
.
sˇn_vif
 = 
NULL
;

971 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_IDLE
;

972 
	`õì80211_sˇn_com∂ëed
(
sc
->
hw
, 
ab‹t
);

973 
	`˛ór_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

974 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

975 i‡(
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
))

976 
sc
->
sched
.
f‹˚_nﬂ_upd©e
 = 
åue
;

977 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

978 
	`©h_offch™√l_√xt
(
sc
);

979 
	`©h9k_ps_ª°‹e
(
sc
);

980 
	}
}

982 
	$©h_sˇn_£nd_¥obe
(
©h_so·c
 *
sc
,

983 
cfg80211_ssid
 *
ssid
)

985 
cfg80211_sˇn_ªque°
 *
ªq
 = 
sc
->
offch™√l
.
sˇn_ªq
;

986 
õì80211_vif
 *
vif
 = 
sc
->
offch™√l
.
sˇn_vif
;

987 
©h_tx_c⁄åﬁ
 
tx˘l
 = {};

988 
sk_buff
 *
skb
;

989 
õì80211_tx_öfo
 *
öfo
;

990 
b™d
 = 
sc
->
offch™√l
.
ch™
.
ch™def
.chan->band;

992 
skb
 = 
	`õì80211_¥obîeq_gë
(
sc
->
hw
, 
vif
->
addr
,

993 
ssid
->ssid, ssid->
ssid_Àn
, 
ªq
->
õ_Àn
);

994 i‡(!
skb
)

997 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

998 i‡(
ªq
->
no_cck
)

999 
öfo
->
Êags
 |
IEEE80211_TX_CTL_NO_CCK_RATE
;

1001 i‡(
ªq
->
õ_Àn
)

1002 
	`mem˝y
(
	`skb_put
(
skb
, 
ªq
->
õ_Àn
),Ñeq->
õ
,Ñeq->ie_len);

1004 
	`skb_£t_queue_m≠pög
(
skb
, 
IEEE80211_AC_VO
);

1006 i‡(!
	`õì80211_tx_¥ï¨e_skb
(
sc
->
hw
, 
vif
, 
skb
, 
b™d
, 
NULL
))

1007 
îr‹
;

1009 
tx˘l
.
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_VO
];

1010 
tx˘l
.
f‹˚_ch™√l
 = 
åue
;

1011 i‡(
	`©h_tx_°¨t
(
sc
->
hw
, 
skb
, &
tx˘l
))

1012 
îr‹
;

1016 
îr‹
:

1017 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

1018 
	}
}

1020 
	$©h_sˇn_ch™√l_°¨t
(
©h_so·c
 *
sc
)

1022 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1023 
cfg80211_sˇn_ªque°
 *
ªq
 = 
sc
->
offch™√l
.
sˇn_ªq
;

1024 
i
;

1026 i‡(!(
sc
->
cur_ch™
->
ch™def
.
ch™
->
Êags
 & 
IEEE80211_CHAN_NO_IR
) &&

1027 
ªq
->
n_ssids
) {

1028 
i
 = 0; i < 
ªq
->
n_ssids
; i++)

1029 
	`©h_sˇn_£nd_¥obe
(
sc
, &
ªq
->
ssids
[
i
]);

1033 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1036 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_PROBE_WAIT
;

1037 
	`mod_timî
(&
sc
->
offch™√l
.
timî
, 
jiffõs
 + sc->offch™√l.
duøti⁄
);

1038 
	}
}

1040 
	$©h_ch™˘x_timî
(
d©a
)

1042 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
d©a
;

1043 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1045 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1048 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ATH_CHANCTX_EVENT_TSF_TIMER
);

1049 
	}
}

1051 
	$©h_offch™√l_timî
(
d©a
)

1053 
©h_so·c
 *
sc
 = (©h_so·¯*)
d©a
;

1054 
©h_ch™˘x
 *
˘x
;

1055 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1057 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "%s: offchannel state: %s\n",

1058 
__func__
, 
	`offch™√l_°©e_°rög
(
sc
->
offch™√l
.
°©e
));

1060 
sc
->
offch™√l
.
°©e
) {

1061 
ATH_OFFCHANNEL_PROBE_WAIT
:

1062 i‡(!
sc
->
offch™√l
.
sˇn_ªq
)

1066 
˘x
 = 
	`©h_ch™˘x_gë_›î_ch™
(
sc
, 
åue
);

1067 i‡(
˘x
->
a˘ive
) {

1068 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1072 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_SUSPEND
;

1073 
	`©h_ch™˘x_swôch
(
sc
, 
˘x
, 
NULL
);

1074 
	`mod_timî
(&
sc
->
offch™√l
.
timî
, 
jiffõs
 + 
HZ
 / 10);

1078 
ATH_OFFCHANNEL_SUSPEND
:

1079 i‡(!
sc
->
offch™√l
.
sˇn_ªq
)

1082 
	`©h_sˇn_√xt_ch™√l
(
sc
);

1084 
ATH_OFFCHANNEL_ROC_START
:

1085 
ATH_OFFCHANNEL_ROC_WAIT
:

1086 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_ROC_DONE
;

1087 
	`©h_roc_com∂ëe
(
sc
, 
ATH_ROC_COMPLETE_EXPIRE
);

1092 
	}
}

1094 
boﬁ


1095 
	$©h_ch™˘x_£nd_vif_ps_‰ame
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
,

1096 
boﬁ
 
powîßve
)

1098 
õì80211_vif
 *
vif
 = 
avp
->vif;

1099 
õì80211_°a
 *
°a
 = 
NULL
;

1100 
õì80211_hdr_3addr
 *
nuŒfunc
;

1101 
©h_tx_c⁄åﬁ
 
tx˘l
;

1102 
sk_buff
 *
skb
;

1103 
b™d
 = 
sc
->
cur_ch™
->
ch™def
.
ch™
->band;

1105 
vif
->
ty≥
) {

1106 
NL80211_IFTYPE_STATION
:

1107 i‡(!
avp
->
assoc
)

1108  
Ál£
;

1110 
skb
 = 
	`õì80211_nuŒfunc_gë
(
sc
->
hw
, 
vif
);

1111 i‡(!
skb
)

1112  
Ál£
;

1114 
nuŒfunc
 = (
õì80211_hdr_3addr
 *Ë
skb
->
d©a
;

1115 i‡(
powîßve
)

1116 
nuŒfunc
->
‰ame_c⁄åﬁ
 |=

1117 
	`˝u_to_À16
(
IEEE80211_FCTL_PM
);

1119 
skb
->
¥i‹ôy
 = 7;

1120 
	`skb_£t_queue_m≠pög
(
skb
, 
IEEE80211_AC_VO
);

1121 i‡(!
	`õì80211_tx_¥ï¨e_skb
(
sc
->
hw
, 
vif
, 
skb
, 
b™d
, &
°a
)) {

1122 
	`dev_k‰ì_skb_™y
(
skb
);

1123  
Ál£
;

1127  
Ál£
;

1130 
	`mem£t
(&
tx˘l
, 0, (txctl));

1131 
tx˘l
.
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_VO
];

1132 
tx˘l
.
°a
 = sta;

1133 
tx˘l
.
f‹˚_ch™√l
 = 
åue
;

1134 i‡(
	`©h_tx_°¨t
(
sc
->
hw
, 
skb
, &
tx˘l
)) {

1135 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

1136  
Ál£
;

1139  
åue
;

1140 
	}
}

1142 
boﬁ


1143 
	$©h_ch™˘x_£nd_ps_‰ame
(
©h_so·c
 *
sc
, 
boﬁ
 
powîßve
)

1145 
©h_vif
 *
avp
;

1146 
boﬁ
 
£¡
 = 
Ál£
;

1148 
	`rcu_ªad_lock
();

1149 
	`li°_f‹_óch_íåy
(
avp
, &
sc
->
cur_ch™
->
vifs
, 
li°
) {

1150 i‡(
	`©h_ch™˘x_£nd_vif_ps_‰ame
(
sc
, 
avp
, 
powîßve
))

1151 
£¡
 = 
åue
;

1153 
	`rcu_ªad_u∆ock
();

1155  
£¡
;

1156 
	}
}

1158 
boﬁ
 
	$©h_ch™˘x_de„r_swôch
(
©h_so·c
 *
sc
)

1160 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1162 i‡(
sc
->
cur_ch™
 =&sc->
offch™√l
.
ch™
)

1163  
Ál£
;

1165 
sc
->
sched
.
°©e
) {

1166 
ATH_CHANCTX_STATE_SWITCH
:

1167  
Ál£
;

1168 
ATH_CHANCTX_STATE_IDLE
:

1169 i‡(!
sc
->
cur_ch™
->
swôch_a·î_bóc⁄
)

1170  
Ál£
;

1172 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1175 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_WAIT_FOR_BEACON
;

1181  
åue
;

1182 
	}
}

1184 
	$©h_offch™√l_ch™√l_ch™ge
(
©h_so·c
 *
sc
)

1186 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1188 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "%s: offchannel state: %s\n",

1189 
__func__
, 
	`offch™√l_°©e_°rög
(
sc
->
offch™√l
.
°©e
));

1191 
sc
->
offch™√l
.
°©e
) {

1192 
ATH_OFFCHANNEL_PROBE_SEND
:

1193 i‡(!
sc
->
offch™√l
.
sˇn_ªq
)

1196 i‡(
sc
->
cur_ch™
->
ch™def
.
ch™
 !=

1197 
sc
->
offch™√l
.
ch™
.
ch™def
.chan)

1200 
	`©h_sˇn_ch™√l_°¨t
(
sc
);

1202 
ATH_OFFCHANNEL_IDLE
:

1203 i‡(!
sc
->
offch™√l
.
sˇn_ªq
)

1206 
	`©h_sˇn_com∂ëe
(
sc
, 
Ál£
);

1208 
ATH_OFFCHANNEL_ROC_START
:

1209 i‡(
sc
->
cur_ch™
 !&sc->
offch™√l
.
ch™
)

1212 
sc
->
offch™√l
.
°©e
 = 
ATH_OFFCHANNEL_ROC_WAIT
;

1213 
	`mod_timî
(&
sc
->
offch™√l
.
timî
,

1214 
jiffõs
 + 
sc
->
offch™√l
.
duøti⁄
);

1215 
	`õì80211_ªady_⁄_ch™√l
(
sc
->
hw
);

1217 
ATH_OFFCHANNEL_ROC_DONE
:

1222 
	}
}

1224 
	$©h_ch™˘x_£t_√xt
(
©h_so·c
 *
sc
, 
boﬁ
 
f‹˚
)

1226 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1227 
©h_ch™˘x
 *
ﬁd_˘x
;

1228 
time•ec
 
ts
;

1229 
boﬁ
 
mósuª_time
 = 
Ál£
;

1230 
boﬁ
 
£nd_ps
 = 
Ál£
;

1231 
boﬁ
 
queues_°›≥d
 = 
Ál£
;

1233 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

1234 i‡(!
sc
->
√xt_ch™
) {

1235 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1239 i‡(!
f‹˚
 && 
	`©h_ch™˘x_de„r_swôch
(
sc
)) {

1240 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1244 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1246 
__func__
,

1247 
sc
->
cur_ch™
->
ch™def
.
˚¡î_‰eq1
,

1248 
sc
->
√xt_ch™
->
ch™def
.
˚¡î_‰eq1
);

1250 i‡(
sc
->
cur_ch™
 !sc->
√xt_ch™
) {

1251 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1253 
sc
->
cur_ch™
->
ch™def
.
˚¡î_‰eq1
);

1254 
sc
->
cur_ch™
->
°›≥d
 = 
åue
;

1255 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1257 i‡(
sc
->
√xt_ch™
 =&sc->
offch™√l
.
ch™
) {

1258 
	`gëøwm⁄Ÿ⁄ic
(&
ts
);

1259 
mósuª_time
 = 
åue
;

1262 
	`©h9k_ch™˘x_°›_queues
(
sc
, sc->
cur_ch™
);

1263 
queues_°›≥d
 = 
åue
;

1265 
	`__©h9k_Êush
(
sc
->
hw
, ~0, 
åue
, 
Ál£
, false);

1267 i‡(
	`©h_ch™˘x_£nd_ps_‰ame
(
sc
, 
åue
))

1268 
	`__©h9k_Êush
(
sc
->
hw
, 
	`BIT
(
IEEE80211_AC_VO
),

1269 
Ál£
, false, false);

1271 
£nd_ps
 = 
åue
;

1272 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

1274 i‡(
sc
->
cur_ch™
 !&sc->
offch™√l
.
ch™
) {

1275 
	`gëøwm⁄Ÿ⁄ic
(&
sc
->
cur_ch™
->
tsf_ts
);

1276 
sc
->
cur_ch™
->
tsf_vÆ
 = 
	`©h9k_hw_gëtsf64
(sc->
sc_ah
);

1279 
ﬁd_˘x
 = 
sc
->
cur_ch™
;

1280 
sc
->
cur_ch™
 = sc->
√xt_ch™
;

1281 
sc
->
cur_ch™
->
°›≥d
 = 
Ál£
;

1282 
sc
->
√xt_ch™
 = 
NULL
;

1284 i‡(!
sc
->
sched
.
offch™√l_≥ndög
)

1285 
sc
->
sched
.
offch™√l_duøti⁄
 = 0;

1287 i‡(
sc
->
sched
.
°©e
 !
ATH_CHANCTX_STATE_FORCE_ACTIVE
)

1288 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_IDLE
;

1290 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1292 i‡(
sc
->
sc_ah
->
chù_fuŒ¶ìp
 ||

1293 
	`memcmp
(&
sc
->
cur_ch™def
, &sc->
cur_ch™
->
ch™def
,

1294 (
sc
->
cur_ch™def
))) {

1295 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

1297 
__func__
, 
sc
->
cur_ch™
->
ch™def
.
˚¡î_‰eq1
);

1298 
	`©h_£t_ch™√l
(
sc
);

1299 i‡(
mósuª_time
)

1300 
sc
->
sched
.
ch™√l_swôch_time
 =

1301 
	`©h9k_hw_gë_tsf_off£t
(&
ts
, 
NULL
);

1306 
out
;

1309 i‡(
queues_°›≥d
)

1310 
	`©h9k_ch™˘x_wake_queues
(
sc
, 
ﬁd_˘x
);

1311 
out
:

1312 i‡(
£nd_ps
)

1313 
	`©h_ch™˘x_£nd_ps_‰ame
(
sc
, 
Ál£
);

1315 
	`©h_offch™√l_ch™√l_ch™ge
(
sc
);

1316 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ATH_CHANCTX_EVENT_SWITCH
);

1317 
	}
}

1319 
	$©h_ch™˘x_w‹k
(
w‹k_°ru˘
 *
w‹k
)

1321 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ath_softc,

1322 
ch™˘x_w‹k
);

1323 
	`muãx_lock
(&
sc
->
muãx
);

1324 
	`©h_ch™˘x_£t_√xt
(
sc
, 
Ál£
);

1325 
	`muãx_u∆ock
(&
sc
->
muãx
);

1326 
	}
}

1328 
	$©h9k_offch™√l_öô
(
©h_so·c
 *
sc
)

1330 
©h_ch™˘x
 *
˘x
;

1331 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1332 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

1333 
õì80211_ch™√l
 *
ch™
;

1334 
i
;

1336 
sb™d
 = &
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
];

1337 i‡(!
sb™d
->
n_ch™√ls
)

1338 
sb™d
 = &
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
];

1340 
ch™
 = &
sb™d
->
ch™√ls
[0];

1342 
˘x
 = &
sc
->
offch™√l
.
ch™
;

1343 
	`INIT_LIST_HEAD
(&
˘x
->
vifs
);

1344 
˘x
->
txpowî
 = 
ATH_TXPOWER_MAX
;

1345 
	`cfg80211_ch™def_¸óã
(&
˘x
->
ch™def
, 
ch™
, 
NL80211_CHAN_HT20
);

1347 
i
 = 0; i < 
	`ARRAY_SIZE
(
˘x
->
acq
); i++)

1348 
	`INIT_LIST_HEAD
(&
˘x
->
acq
[
i
]);

1350 
sc
->
offch™√l
.
ch™
.offch™√»
åue
;

1351 
	}
}

1353 
	$©h9k_öô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
)

1355 
	`INIT_WORK
(&
sc
->
ch™˘x_w‹k
, 
©h_ch™˘x_w‹k
);

1357 
	`£tup_timî
(&
sc
->
offch™√l
.
timî
, 
©h_offch™√l_timî
,

1358 ()
sc
);

1359 
	`£tup_timî
(&
sc
->
sched
.
timî
, 
©h_ch™˘x_timî
,

1360 ()
sc
);

1362 
	`öô_com∂ëi⁄
(&
sc
->
go_bóc⁄
);

1363 
	}
}

1365 
	$©h9k_deöô_ch™√l_c⁄ãxt
(
©h_so·c
 *
sc
)

1367 
	`ˇn˚l_w‹k_sync
(&
sc
->
ch™˘x_w‹k
);

1368 
	}
}

1370 
boﬁ
 
	$©h9k_is_ch™˘x_íabÀd
()

1372  (
©h9k_u£_ch™˘x
 == 1);

1373 
	}
}

1379 
	$©h9k_ch™˘x_°›_queues
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
)

1381 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1382 
i
;

1384 i‡(
˘x
 =&
sc
->
offch™√l
.
ch™
) {

1385 
	`õì80211_°›_queue
(
sc
->
hw
,

1386 
sc
->
hw
->
offch™√l_tx_hw_queue
);

1388 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++)

1389 
	`õì80211_°›_queue
(
sc
->
hw
,

1390 
˘x
->
hw_queue_ba£
 + 
i
);

1393 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_AP
)

1394 
	`õì80211_°›_queue
(
sc
->
hw
, sc->hw->
queues
 - 2);

1395 
	}
}

1398 
	$©h9k_ch™˘x_wake_queues
(
©h_so·c
 *
sc
, 
©h_ch™˘x
 *
˘x
)

1400 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1401 
i
;

1403 i‡(
˘x
 =&
sc
->
offch™√l
.
ch™
) {

1404 
	`õì80211_wake_queue
(
sc
->
hw
,

1405 
sc
->
hw
->
offch™√l_tx_hw_queue
);

1407 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++)

1408 
	`õì80211_wake_queue
(
sc
->
hw
,

1409 
˘x
->
hw_queue_ba£
 + 
i
);

1412 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_AP
)

1413 
	`õì80211_wake_queue
(
sc
->
hw
, sc->hw->
queues
 - 2);

1414 
	}
}

1420 
	$©h9k_upd©e_p2p_ps_timî
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
)

1422 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1423 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1424 
u32
 
tsf
, 
èrgë_tsf
;

1426 i‡(!
avp
 || !avp->
nﬂ
.
has_√xt_tsf
)

1429 
	`©h9k_hw_gí_timî_°›
(
ah
, 
sc
->
p2p_ps_timî
);

1431 
tsf
 = 
	`©h9k_hw_gëtsf32
(
sc
->
sc_ah
);

1433 
èrgë_tsf
 = 
avp
->
nﬂ
.
√xt_tsf
;

1434 i‡(!
avp
->
nﬂ
.
ab£¡
)

1435 
èrgë_tsf
 -
ATH_P2P_PS_STOP_TIME
;

1437 
èrgë_tsf
 +
ATH_P2P_PS_STOP_TIME
;

1439 i‡(
èrgë_tsf
 - 
tsf
 < 
ATH_P2P_PS_STOP_TIME
)

1440 
èrgë_tsf
 = 
tsf
 + 
ATH_P2P_PS_STOP_TIME
;

1442 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "%sábsent %dÅsf 0x%08XÇext_tsf 0x%08X (%dms)\n",

1443 
__func__
, 
avp
->
nﬂ
.
ab£¡
, 
tsf
, 
èrgë_tsf
,

1444 (
èrgë_tsf
 - 
tsf
) / 1000);

1446 
	`©h9k_hw_gí_timî_°¨t
(
ah
, 
sc
->
p2p_ps_timî
, 
èrgë_tsf
, 1000000);

1447 
	}
}

1449 
	$©h9k_upd©e_p2p_ps
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

1451 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1452 
u32
 
tsf
;

1454 i‡(!
sc
->
p2p_ps_timî
)

1457 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || !vif->
p2p
)

1460 
sc
->
p2p_ps_vif
 = 
avp
;

1462 i‡(
sc
->
ps_Êags
 & 
PS_BEACON_SYNC
)

1465 
tsf
 = 
	`©h9k_hw_gëtsf32
(
sc
->
sc_ah
);

1466 
	`õì80211_∑r£_p2p_nﬂ
(&
vif
->
bss_c⁄f
.
p2p_nﬂ_©å
, &
avp
->
nﬂ
, 
tsf
);

1467 
	`©h9k_upd©e_p2p_ps_timî
(
sc
, 
avp
);

1468 
	}
}

1470 
u8
 
	$©h9k_gë_˘wö
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
)

1472 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

1473 
u8
 
swôch_time
, 
˘wö
;

1482 
swôch_time
 = 
cur_c⁄f
->
bóc⁄_öãrvÆ
 / 4;

1484 
˘wö
 = 
avp
->
vif
->
bss_c⁄f
.
p2p_nﬂ_©å
.
›µs_˘wödow
;

1485 i‡(
˘wö
 && (˘wö < 
swôch_time
))

1486  
˘wö
;

1488 i‡(
swôch_time
 < 
P2P_DEFAULT_CTWIN
)

1491  
P2P_DEFAULT_CTWIN
;

1492 
	}
}

1494 
	$©h9k_bóc⁄_add_nﬂ
(
©h_so·c
 *
sc
, 
©h_vif
 *
avp
,

1495 
sk_buff
 *
skb
)

1497 c⁄° 
u8
 
nﬂ_õ_hdr
[] = {

1498 
WLAN_EID_VENDOR_SPECIFIC
,

1507 
õì80211_p2p_nﬂ_©å
 *
nﬂ
;

1508 
nﬂ_Àn
, 
nﬂ_desc
, 
i
 = 0;

1509 
u8
 *
hdr
;

1511 i‡(!
avp
->
offch™√l_duøti⁄
 && !avp->
nﬂ_duøti⁄
)

1514 
nﬂ_desc
 = !!
avp
->
offch™√l_duøti⁄
 + !!avp->
nﬂ_duøti⁄
;

1515 
nﬂ_Àn
 = 2 + (
õì80211_p2p_nﬂ_desc
Ë* 
nﬂ_desc
;

1517 
hdr
 = 
	`skb_put
(
skb
, (
nﬂ_õ_hdr
));

1518 
	`mem˝y
(
hdr
, 
nﬂ_õ_hdr
, (noa_ie_hdr));

1519 
hdr
[1] = (
nﬂ_õ_hdr
Ë+ 
nﬂ_Àn
 - 2;

1520 
hdr
[7] = 
nﬂ_Àn
;

1522 
nﬂ
 = (*Ë
	`skb_put
(
skb
, 
nﬂ_Àn
);

1523 
	`mem£t
(
nﬂ
, 0, 
nﬂ_Àn
);

1525 
nﬂ
->
ödex
 = 
avp
->
nﬂ_ödex
;

1526 
nﬂ
->
›µs_˘wödow
 = 
	`©h9k_gë_˘wö
(
sc
, 
avp
);

1527 i‡(
nﬂ
->
›µs_˘wödow
)

1528 
nﬂ
->
›µs_˘wödow
 |
	`BIT
(7);

1530 i‡(
avp
->
nﬂ_duøti⁄
) {

1531 i‡(
avp
->
≥riodic_nﬂ
) {

1532 
u32
 
öãrvÆ
 = 
	`TU_TO_USEC
(
sc
->
cur_ch™
->
bóc⁄
.
bóc⁄_öãrvÆ
);

1533 
nﬂ
->
desc
[
i
].
cou¡
 = 255;

1534 
nﬂ
->
desc
[
i
].
öãrvÆ
 = 
	`˝u_to_À32
(interval);

1536 
nﬂ
->
desc
[
i
].
cou¡
 = 1;

1539 
nﬂ
->
desc
[
i
].
°¨t_time
 = 
	`˝u_to_À32
(
avp
->
nﬂ_°¨t
);

1540 
nﬂ
->
desc
[
i
].
duøti⁄
 = 
	`˝u_to_À32
(
avp
->
nﬂ_duøti⁄
);

1541 
i
++;

1544 i‡(
avp
->
offch™√l_duøti⁄
) {

1545 
nﬂ
->
desc
[
i
].
cou¡
 = 1;

1546 
nﬂ
->
desc
[
i
].
°¨t_time
 = 
	`˝u_to_À32
(
avp
->
offch™√l_°¨t
);

1547 
nﬂ
->
desc
[
i
].
duøti⁄
 = 
	`˝u_to_À32
(
avp
->
offch™√l_duøti⁄
);

1549 
	}
}

1551 
	$©h9k_p2p_ps_timî
(*
¥iv
)

1553 
©h_so·c
 *
sc
 = 
¥iv
;

1554 
©h_vif
 *
avp
 = 
sc
->
p2p_ps_vif
;

1555 
õì80211_vif
 *
vif
;

1556 
õì80211_°a
 *
°a
;

1557 
©h_node
 *
™
;

1558 
u32
 
tsf
;

1560 
	`dñ_timî_sync
(&
sc
->
sched
.
timî
);

1561 
	`©h9k_hw_gí_timî_°›
(
sc
->
sc_ah
, sc->
p2p_ps_timî
);

1562 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ATH_CHANCTX_EVENT_TSF_TIMER
);

1564 i‡(!
avp
 ||ávp->
ch™˘x
 !
sc
->
cur_ch™
)

1567 
tsf
 = 
	`©h9k_hw_gëtsf32
(
sc
->
sc_ah
);

1568 i‡(!
avp
->
nﬂ
.
ab£¡
)

1569 
tsf
 +
ATH_P2P_PS_STOP_TIME
;

1571 
tsf
 -
ATH_P2P_PS_STOP_TIME
;

1573 i‡(!
avp
->
nﬂ
.
has_√xt_tsf
 ||

1574 
avp
->
nﬂ
.
√xt_tsf
 - 
tsf
 > 
	`BIT
(31))

1575 
	`õì80211_upd©e_p2p_nﬂ
(&
avp
->
nﬂ
, 
tsf
);

1577 
	`©h9k_upd©e_p2p_ps_timî
(
sc
, 
avp
);

1579 
	`rcu_ªad_lock
();

1581 
vif
 = 
avp
->vif;

1582 
°a
 = 
	`õì80211_föd_°a
(
vif
, 
avp
->
bssid
);

1583 i‡(!
°a
)

1584 
out
;

1586 
™
 = (*Ë
°a
->
drv_¥iv
;

1587 i‡(
™
->
¶ìpög
 =!!
avp
->
nﬂ
.
ab£¡
)

1588 
out
;

1590 
™
->
¶ìpög
 = 
avp
->
nﬂ
.
ab£¡
;

1591 i‡(
™
->
¶ìpög
)

1592 
	`©h_tx_aggr_¶ìp
(
°a
, 
sc
, 
™
);

1594 
	`©h_tx_aggr_wakeup
(
sc
, 
™
);

1596 
out
:

1597 
	`rcu_ªad_u∆ock
();

1598 
	}
}

1600 
	$©h9k_p2p_bss_öfo_ch™ged
(
©h_so·c
 *
sc
,

1601 
õì80211_vif
 *
vif
)

1603 
Êags
;

1605 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

1606 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

1607 
	`©h9k_upd©e_p2p_ps
(
sc
, 
vif
);

1608 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

1609 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

1610 
	}
}

1612 
	$©h9k_p2p_bóc⁄_sync
(
©h_so·c
 *
sc
)

1614 i‡(
sc
->
p2p_ps_vif
)

1615 
	`©h9k_upd©e_p2p_ps
(
sc
, sc->
p2p_ps_vif
->
vif
);

1616 
	}
}

1618 
	$©h9k_p2p_ªmove_vif
(
©h_so·c
 *
sc
,

1619 
õì80211_vif
 *
vif
)

1621 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1623 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

1624 i‡(
avp
 =
sc
->
p2p_ps_vif
) {

1625 
sc
->
p2p_ps_vif
 = 
NULL
;

1626 
	`©h9k_upd©e_p2p_ps_timî
(
sc
, 
NULL
);

1628 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

1629 
	}
}

1631 
	$©h9k_öô_p2p
(
©h_so·c
 *
sc
)

1633 
sc
->
p2p_ps_timî
 = 
	`©h_gí_timî_Æloc
(sc->
sc_ah
, 
©h9k_p2p_ps_timî
,

1634 
NULL
, 
sc
, 
AR_FIRST_NDP_TIMER
);

1635 i‡(!
sc
->
p2p_ps_timî
)

1636  -
ENOMEM
;

1639 
	}
}

1641 
	$©h9k_deöô_p2p
(
©h_so·c
 *
sc
)

1643 i‡(
sc
->
p2p_ps_timî
)

1644 
	`©h_gí_timî_‰ì
(
sc
->
sc_ah
, sc->
p2p_ps_timî
);

1645 
	}
}

	@common-beacon.c

17 
	~"comm⁄.h
"

19 
	#FUDGE
 2

	)

21 
u32
 
	$©h9k_gë_√xt_tbâ
(
©h_hw
 *
ah
, 
u64
 
tsf
,

22 
öãrvÆ
)

24 
off£t
, 
divis‹
;

26 
tsf
 +
	`TU_TO_USEC
(
FUDGE
 + 
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
);

27 
divis‹
 = 
	`TU_TO_USEC
(
öãrvÆ
);

28 
	`div_u64_ªm
(
tsf
, 
divis‹
, &
off£t
);

30  (
u32
Ë
tsf
 + 
divis‹
 - 
off£t
;

31 
	}
}

41 
	$©h9k_cmn_bóc⁄_c⁄fig_°a
(
©h_hw
 *
ah
,

42 
©h_bóc⁄_c⁄fig
 *
c⁄f
,

43 
©h9k_bóc⁄_°©e
 *
bs
)

45 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

46 
dtim_ötvÆ
;

47 
u64
 
tsf
;

50 i‡(!
	`ã°_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
)) {

51 
	`©h_dbg
(
comm⁄
, 
BEACON
,

53  -
EPERM
;

56 
	`mem£t
(
bs
, 0, (*bs));

57 
c⁄f
->
ötvÆ
 = c⁄f->
bóc⁄_öãrvÆ
;

63 
dtim_ötvÆ
 = 
c⁄f
->
ötvÆ
 * c⁄f->
dtim_≥riod
;

69 
tsf
 = 
	`©h9k_hw_gëtsf64
(
ah
);

70 
c⁄f
->
√xâbâ
 = 
	`©h9k_gë_√xt_tbâ
(
ah
, 
tsf
, c⁄f->
ötvÆ
);

72 
bs
->
bs_ötvÆ
 = 
	`TU_TO_USEC
(
c⁄f
->
ötvÆ
);

73 
bs
->
bs_dtim≥riod
 = 
c⁄f
->
dtim_≥riod
 * bs->
bs_ötvÆ
;

74 
bs
->
bs_√xâbâ
 = 
c⁄f
->
√xâbâ
;

75 
bs
->
bs_√xtdtim
 = 
c⁄f
->
√xâbâ
;

76 i‡(
c⁄f
->
dtim_≥riod
 > 1)

77 
bs
->
bs_√xtdtim
 = 
	`©h9k_gë_√xt_tbâ
(
ah
, 
tsf
, 
dtim_ötvÆ
);

85 
bs
->
bs_bmis°hªshﬁd
 = 
	`DIV_ROUND_UP
(
c⁄f
->
bmiss_timeout
, c⁄f->
ötvÆ
);

86 i‡(
bs
->
bs_bmis°hªshﬁd
 > 15)

87 
bs
->
bs_bmis°hªshﬁd
 = 15;

88 i‡(
bs
->
bs_bmis°hªshﬁd
 <= 0)

89 
bs
->
bs_bmis°hªshﬁd
 = 1;

100 
bs
->
bs_¶ìpduøti⁄
 = 
	`TU_TO_USEC
(
	`roundup
(
	`IEEE80211_MS_TO_TU
(100),

101 
c⁄f
->
ötvÆ
));

102 i‡(
bs
->
bs_¶ìpduøti⁄
 > bs->
bs_dtim≥riod
)

103 
bs
->
bs_¶ìpduøti⁄
 = bs->
bs_dtim≥riod
;

106 
bs
->
bs_tsfo‹_thªshﬁd
 = 
ATH9K_TSFOOR_THRESHOLD
;

108 
	`©h_dbg
(
comm⁄
, 
BEACON
, "bmiss: %u sleep: %u\n",

109 
bs
->
bs_bmis°hªshﬁd
, bs->
bs_¶ìpduøti⁄
);

111 
	}
}

112 
EXPORT_SYMBOL
(
©h9k_cmn_bóc⁄_c⁄fig_°a
);

114 
	$©h9k_cmn_bóc⁄_c⁄fig_adhoc
(
©h_hw
 *
ah
,

115 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

117 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

119 
c⁄f
->
ötvÆ
 = 
	`TU_TO_USEC
(c⁄f->
bóc⁄_öãrvÆ
);

121 i‡(
c⁄f
->
ibss_¸ót‹
)

122 
c⁄f
->
√xâbâ
 = c⁄f->
ötvÆ
;

124 
c⁄f
->
√xâbâ
 = 
	`©h9k_gë_√xt_tbâ
(
ah
, 
	`©h9k_hw_gëtsf64
(ah),

125 
c⁄f
->
bóc⁄_öãrvÆ
);

127 i‡(
c⁄f
->
íabÀ_bóc⁄
)

128 
ah
->
imask
 |
ATH9K_INT_SWBA
;

130 
ah
->
imask
 &~
ATH9K_INT_SWBA
;

132 
	`©h_dbg
(
comm⁄
, 
BEACON
,

134 (
c⁄f
->
íabÀ_bóc⁄
) ? "Enable" : "Disable",

135 
c⁄f
->
√xâbâ
, c⁄f->
ötvÆ
, c⁄f->
bóc⁄_öãrvÆ
);

136 
	}
}

137 
EXPORT_SYMBOL
(
©h9k_cmn_bóc⁄_c⁄fig_adhoc
);

144 
	$©h9k_cmn_bóc⁄_c⁄fig_≠
(
©h_hw
 *
ah
,

145 
©h_bóc⁄_c⁄fig
 *
c⁄f
,

146 
bc_buf
)

148 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

151 
c⁄f
->
ötvÆ
 = 
	`TU_TO_USEC
(c⁄f->
bóc⁄_öãrvÆ
);

152 
c⁄f
->
ötvÆ
 /
bc_buf
;

153 
c⁄f
->
√xâbâ
 = 
	`©h9k_gë_√xt_tbâ
(
ah
, 
	`©h9k_hw_gëtsf64
(ah),

154 
c⁄f
->
bóc⁄_öãrvÆ
);

156 i‡(
c⁄f
->
íabÀ_bóc⁄
)

157 
ah
->
imask
 |
ATH9K_INT_SWBA
;

159 
ah
->
imask
 &~
ATH9K_INT_SWBA
;

161 
	`©h_dbg
(
comm⁄
, 
BEACON
,

163 (
c⁄f
->
íabÀ_bóc⁄
) ? "Enable" : "Disable",

164 
c⁄f
->
√xâbâ
, c⁄f->
ötvÆ
, c⁄f->
bóc⁄_öãrvÆ
);

165 
	}
}

166 
EXPORT_SYMBOL
(
©h9k_cmn_bóc⁄_c⁄fig_≠
);

	@common-beacon.h

17 
	g©h_bóc⁄_c⁄fig
;

19 
©h9k_cmn_bóc⁄_c⁄fig_°a
(
©h_hw
 *
ah
,

20 
©h_bóc⁄_c⁄fig
 *
c⁄f
,

21 
©h9k_bóc⁄_°©e
 *
bs
);

22 
©h9k_cmn_bóc⁄_c⁄fig_adhoc
(
©h_hw
 *
ah
,

23 
©h_bóc⁄_c⁄fig
 *
c⁄f
);

24 
©h9k_cmn_bóc⁄_c⁄fig_≠
(
©h_hw
 *
ah
,

25 
©h_bóc⁄_c⁄fig
 *
c⁄f
,

26 
bc_buf
);

	@common-debug.c

17 
	~"comm⁄.h
"

19 
ssize_t
 
	$ªad_fûe_modÆ_ì¥om
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

20 
size_t
 
cou¡
, 
loff_t
 *
µos
)

22 
©h_hw
 *
ah
 = 
fûe
->
¥iv©e_d©a
;

23 
u32
 
Àn
 = 0, 
size
 = 6000;

24 *
buf
;

25 
size_t
 
ªtvÆ
;

27 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

28 i‡(
buf
 =
NULL
)

29  -
ENOMEM
;

31 
Àn
 = 
ah
->
ìp_›s
->
	`dump_ì¥om
◊h, 
Ál£
, 
buf
,Üí, 
size
);

33 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

34 
	`k‰ì
(
buf
);

36  
ªtvÆ
;

37 
	}
}

39 c⁄° 
fûe_›î©i⁄s
 
	gf›s_modÆ_ì¥om
 = {

40 .
ªad
 = 
ªad_fûe_modÆ_ì¥om
,

41 .
	g›í
 = 
sim∂e_›í
,

42 .
	gow√r
 = 
THIS_MODULE
,

43 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

47 
	$©h9k_cmn_debug_modÆ_ì¥om
(
díåy
 *
debugfs_phy
,

48 
©h_hw
 *
ah
)

50 
	`debugfs_¸óã_fûe
("modÆ_ì¥om", 
S_IRUSR
, 
debugfs_phy
, 
ah
,

51 &
f›s_modÆ_ì¥om
);

52 
	}
}

53 
EXPORT_SYMBOL
(
©h9k_cmn_debug_modÆ_ì¥om
);

55 
ssize_t
 
	$ªad_fûe_ba£_ì¥om
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

56 
size_t
 
cou¡
, 
loff_t
 *
µos
)

58 
©h_hw
 *
ah
 = 
fûe
->
¥iv©e_d©a
;

59 
u32
 
Àn
 = 0, 
size
 = 1500;

60 
ssize_t
 
ªtvÆ
 = 0;

61 *
buf
;

63 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

64 i‡(!
buf
)

65  -
ENOMEM
;

67 
Àn
 = 
ah
->
ìp_›s
->
	`dump_ì¥om
◊h, 
åue
, 
buf
,Üí, 
size
);

69 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

70 
	`k‰ì
(
buf
);

72  
ªtvÆ
;

73 
	}
}

75 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ba£_ì¥om
 = {

76 .
ªad
 = 
ªad_fûe_ba£_ì¥om
,

77 .
	g›í
 = 
sim∂e_›í
,

78 .
	gow√r
 = 
THIS_MODULE
,

79 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

82 
	$©h9k_cmn_debug_ba£_ì¥om
(
díåy
 *
debugfs_phy
,

83 
©h_hw
 *
ah
)

85 
	`debugfs_¸óã_fûe
("ba£_ì¥om", 
S_IRUSR
, 
debugfs_phy
, 
ah
,

86 &
f›s_ba£_ì¥om
);

87 
	}
}

88 
EXPORT_SYMBOL
(
©h9k_cmn_debug_ba£_ì¥om
);

90 
	$©h9k_cmn_debug_°©_rx
(
©h_rx_°©s
 *
rx°©s
,

91 
©h_rx_°©us
 *
rs
)

93 
	#RX_PHY_ERR_INC
(
c
Ë
rx°©s
->
phy_îr_°©s
[c]++

	)

94 
	#RX_CMN_STAT_INC
(
c
Ë(
rx°©s
->c++)

	)

96 
	`RX_CMN_STAT_INC
(
rx_pkts_Æl
);

97 
rx°©s
->
rx_byãs_Æl
 +
rs
->
rs_d©Æí
;

99 i‡(
rs
->
rs_°©us
 & 
ATH9K_RXERR_CRC
)

100 
	`RX_CMN_STAT_INC
(
¸c_îr
);

101 i‡(
rs
->
rs_°©us
 & 
ATH9K_RXERR_DECRYPT
)

102 
	`RX_CMN_STAT_INC
(
de¸y±_¸c_îr
);

103 i‡(
rs
->
rs_°©us
 & 
ATH9K_RXERR_MIC
)

104 
	`RX_CMN_STAT_INC
(
mic_îr
);

105 i‡(
rs
->
rs_°©us
 & 
ATH9K_RX_DELIM_CRC_PRE
)

106 
	`RX_CMN_STAT_INC
(
¥e_dñim_¸c_îr
);

107 i‡(
rs
->
rs_°©us
 & 
ATH9K_RX_DELIM_CRC_POST
)

108 
	`RX_CMN_STAT_INC
(
po°_dñim_¸c_îr
);

109 i‡(
rs
->
rs_°©us
 & 
ATH9K_RX_DECRYPT_BUSY
)

110 
	`RX_CMN_STAT_INC
(
de¸y±_busy_îr
);

112 i‡(
rs
->
rs_°©us
 & 
ATH9K_RXERR_PHY
) {

113 
	`RX_CMN_STAT_INC
(
phy_îr
);

114 i‡(
rs
->
rs_phyîr
 < 
ATH9K_PHYERR_MAX
)

115 
	`RX_PHY_ERR_INC
(
rs
->
rs_phyîr
);

118 #unde‡
RX_CMN_STAT_INC


119 #unde‡
RX_PHY_ERR_INC


120 
	}
}

121 
EXPORT_SYMBOL
(
©h9k_cmn_debug_°©_rx
);

123 
ssize_t
 
	$ªad_fûe_ªcv
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

124 
size_t
 
cou¡
, 
loff_t
 *
µos
)

126 
	#RXS_ERR
(
s
, 
e
) \

128 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, \

129 "%18†: %10u\n", 
s
, \

130 
rx°©s
->
e
); \

131 } 0)

	)

133 
©h_rx_°©s
 *
rx°©s
 = 
fûe
->
¥iv©e_d©a
;

134 *
buf
;

135 
Àn
 = 0, 
size
 = 1600;

136 
ssize_t
 
ªtvÆ
 = 0;

138 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

139 i‡(
buf
 =
NULL
)

140  -
ENOMEM
;

142 
	`RXS_ERR
("PKTS-ALL", 
rx_pkts_Æl
);

143 
	`RXS_ERR
("BYTES-ALL", 
rx_byãs_Æl
);

144 
	`RXS_ERR
("BEACONS", 
rx_bóc⁄s
);

145 
	`RXS_ERR
("FRAGS", 
rx_‰ags
);

146 
	`RXS_ERR
("SPECTRAL", 
rx_•e˘øl
);

148 
	`RXS_ERR
("CRC ERR", 
¸c_îr
);

149 
	`RXS_ERR
("DECRYPT CRC ERR", 
de¸y±_¸c_îr
);

150 
	`RXS_ERR
("PHY ERR", 
phy_îr
);

151 
	`RXS_ERR
("MIC ERR", 
mic_îr
);

152 
	`RXS_ERR
("PRE-DELIM CRC ERR", 
¥e_dñim_¸c_îr
);

153 
	`RXS_ERR
("POST-DELIM CRC ERR", 
po°_dñim_¸c_îr
);

154 
	`RXS_ERR
("DECRYPT BUSY ERR", 
de¸y±_busy_îr
);

155 
	`RXS_ERR
("LENGTH-ERR", 
rx_Àn_îr
);

156 
	`RXS_ERR
("OOM-ERR", 
rx_oom_îr
);

157 
	`RXS_ERR
("RATE-ERR", 
rx_øã_îr
);

158 
	`RXS_ERR
("TOO-MANY-FRAGS", 
rx_too_m™y_‰ags_îr
);

160 i‡(
Àn
 > 
size
)

161 
Àn
 = 
size
;

163 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

164 
	`k‰ì
(
buf
);

166  
ªtvÆ
;

168 #unde‡
RXS_ERR


169 
	}
}

171 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªcv
 = {

172 .
ªad
 = 
ªad_fûe_ªcv
,

173 .
	g›í
 = 
sim∂e_›í
,

174 .
	gow√r
 = 
THIS_MODULE
,

175 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

178 
	$©h9k_cmn_debug_ªcv
(
díåy
 *
debugfs_phy
,

179 
©h_rx_°©s
 *
rx°©s
)

181 
	`debugfs_¸óã_fûe
("ªcv", 
S_IRUSR
, 
debugfs_phy
, 
rx°©s
,

182 &
f›s_ªcv
);

183 
	}
}

184 
EXPORT_SYMBOL
(
©h9k_cmn_debug_ªcv
);

186 
ssize_t
 
	$ªad_fûe_phy_îr
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

187 
size_t
 
cou¡
, 
loff_t
 *
µos
)

189 
	#PHY_ERR
(
s
, 
p
) \

190 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üí, "%22†: %10u\n", 
s
, \

191 
rx°©s
->
phy_îr_°©s
[
p
]);

	)

193 
©h_rx_°©s
 *
rx°©s
 = 
fûe
->
¥iv©e_d©a
;

194 *
buf
;

195 
Àn
 = 0, 
size
 = 1600;

196 
ssize_t
 
ªtvÆ
 = 0;

198 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

199 i‡(
buf
 =
NULL
)

200  -
ENOMEM
;

202 
	`PHY_ERR
("UNDERRUN ERR", 
ATH9K_PHYERR_UNDERRUN
);

203 
	`PHY_ERR
("TIMING ERR", 
ATH9K_PHYERR_TIMING
);

204 
	`PHY_ERR
("PARITY ERR", 
ATH9K_PHYERR_PARITY
);

205 
	`PHY_ERR
("RATE ERR", 
ATH9K_PHYERR_RATE
);

206 
	`PHY_ERR
("LENGTH ERR", 
ATH9K_PHYERR_LENGTH
);

207 
	`PHY_ERR
("RADAR ERR", 
ATH9K_PHYERR_RADAR
);

208 
	`PHY_ERR
("SERVICE ERR", 
ATH9K_PHYERR_SERVICE
);

209 
	`PHY_ERR
("TOR ERR", 
ATH9K_PHYERR_TOR
);

211 
	`PHY_ERR
("OFDM-TIMING ERR", 
ATH9K_PHYERR_OFDM_TIMING
);

212 
	`PHY_ERR
("OFDM-SIGNAL-PARITY ERR", 
ATH9K_PHYERR_OFDM_SIGNAL_PARITY
);

213 
	`PHY_ERR
("OFDM-RATE ERR", 
ATH9K_PHYERR_OFDM_RATE_ILLEGAL
);

214 
	`PHY_ERR
("OFDM-LENGTH ERR", 
ATH9K_PHYERR_OFDM_LENGTH_ILLEGAL
);

215 
	`PHY_ERR
("OFDM-POWER-DROP ERR", 
ATH9K_PHYERR_OFDM_POWER_DROP
);

216 
	`PHY_ERR
("OFDM-SERVICE ERR", 
ATH9K_PHYERR_OFDM_SERVICE
);

217 
	`PHY_ERR
("OFDM-RESTART ERR", 
ATH9K_PHYERR_OFDM_RESTART
);

219 
	`PHY_ERR
("CCK-BLOCKER ERR", 
ATH9K_PHYERR_CCK_BLOCKER
);

220 
	`PHY_ERR
("CCK-TIMING ERR", 
ATH9K_PHYERR_CCK_TIMING
);

221 
	`PHY_ERR
("CCK-HEADER-CRC ERR", 
ATH9K_PHYERR_CCK_HEADER_CRC
);

222 
	`PHY_ERR
("CCK-RATE ERR", 
ATH9K_PHYERR_CCK_RATE_ILLEGAL
);

223 
	`PHY_ERR
("CCK-LENGTH ERR", 
ATH9K_PHYERR_CCK_LENGTH_ILLEGAL
);

224 
	`PHY_ERR
("CCK-POWER-DROP ERR", 
ATH9K_PHYERR_CCK_POWER_DROP
);

225 
	`PHY_ERR
("CCK-SERVICE ERR", 
ATH9K_PHYERR_CCK_SERVICE
);

226 
	`PHY_ERR
("CCK-RESTART ERR", 
ATH9K_PHYERR_CCK_RESTART
);

228 
	`PHY_ERR
("HT-CRC ERR", 
ATH9K_PHYERR_HT_CRC_ERROR
);

229 
	`PHY_ERR
("HT-LENGTH ERR", 
ATH9K_PHYERR_HT_LENGTH_ILLEGAL
);

230 
	`PHY_ERR
("HT-RATE ERR", 
ATH9K_PHYERR_HT_RATE_ILLEGAL
);

231 
	`PHY_ERR
("HT-ZLF ERR", 
ATH9K_PHYERR_HT_ZLF
);

233 
	`PHY_ERR
("FALSE-RADAR-EXT ERR", 
ATH9K_PHYERR_FALSE_RADAR_EXT
);

234 
	`PHY_ERR
("GREEN-FIELD ERR", 
ATH9K_PHYERR_GREEN_FIELD
);

235 
	`PHY_ERR
("SPECTRAL ERR", 
ATH9K_PHYERR_SPECTRAL
);

237 i‡(
Àn
 > 
size
)

238 
Àn
 = 
size
;

240 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

241 
	`k‰ì
(
buf
);

243  
ªtvÆ
;

245 #unde‡
PHY_ERR


246 
	}
}

248 c⁄° 
fûe_›î©i⁄s
 
	gf›s_phy_îr
 = {

249 .
ªad
 = 
ªad_fûe_phy_îr
,

250 .
	g›í
 = 
sim∂e_›í
,

251 .
	gow√r
 = 
THIS_MODULE
,

252 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

255 
	$©h9k_cmn_debug_phy_îr
(
díåy
 *
debugfs_phy
,

256 
©h_rx_°©s
 *
rx°©s
)

258 
	`debugfs_¸óã_fûe
("phy_îr", 
S_IRUSR
, 
debugfs_phy
, 
rx°©s
,

259 &
f›s_phy_îr
);

260 
	}
}

261 
EXPORT_SYMBOL
(
©h9k_cmn_debug_phy_îr
);

	@common-debug.h

43 
	s©h_rx_°©s
 {

44 
u32
 
	mrx_pkts_Æl
;

45 
u32
 
	mrx_byãs_Æl
;

46 
u32
 
	m¸c_îr
;

47 
u32
 
	mde¸y±_¸c_îr
;

48 
u32
 
	mphy_îr
;

49 
u32
 
	mmic_îr
;

50 
u32
 
	m¥e_dñim_¸c_îr
;

51 
u32
 
	mpo°_dñim_¸c_îr
;

52 
u32
 
	mde¸y±_busy_îr
;

53 
u32
 
	mphy_îr_°©s
[
ATH9K_PHYERR_MAX
];

54 
u32
 
	mrx_Àn_îr
;

55 
u32
 
	mrx_oom_îr
;

56 
u32
 
	mrx_øã_îr
;

57 
u32
 
	mrx_too_m™y_‰ags_îr
;

58 
u32
 
	mrx_bóc⁄s
;

59 
u32
 
	mrx_‰ags
;

60 
u32
 
	mrx_•e˘øl
;

63 
©h9k_cmn_debug_modÆ_ì¥om
(
díåy
 *
debugfs_phy
,

64 
©h_hw
 *
ah
);

65 
©h9k_cmn_debug_ba£_ì¥om
(
díåy
 *
debugfs_phy
,

66 
©h_hw
 *
ah
);

67 
©h9k_cmn_debug_°©_rx
(
©h_rx_°©s
 *
rx°©s
,

68 
©h_rx_°©us
 *
rs
);

69 
©h9k_cmn_debug_ªcv
(
díåy
 *
debugfs_phy
,

70 
©h_rx_°©s
 *
rx°©s
);

71 
©h9k_cmn_debug_phy_îr
(
díåy
 *
debugfs_phy
,

72 
©h_rx_°©s
 *
rx°©s
);

	@common-init.c

19 
	~"comm⁄.h
"

21 
	#CHAN2G
(
_‰eq
, 
_idx
) { \

22 .
b™d
 = 
IEEE80211_BAND_2GHZ
, \

23 .
˚¡î_‰eq
 = (
_‰eq
), \

24 .
hw_vÆue
 = (
_idx
), \

25 .
max_powî
 = 20, \

26 }

	)

28 
	#CHAN5G
(
_‰eq
, 
_idx
) { \

29 .
b™d
 = 
IEEE80211_BAND_5GHZ
, \

30 .
˚¡î_‰eq
 = (
_‰eq
), \

31 .
hw_vÆue
 = (
_idx
), \

32 .
max_powî
 = 20, \

33 }

	)

39 c⁄° 
õì80211_ch™√l
 
	g©h9k_2ghz_ch™èbÀ
[] = {

40 
CHAN2G
(2412, 0),

41 
CHAN2G
(2417, 1),

42 
CHAN2G
(2422, 2),

43 
CHAN2G
(2427, 3),

44 
CHAN2G
(2432, 4),

45 
CHAN2G
(2437, 5),

46 
CHAN2G
(2442, 6),

47 
CHAN2G
(2447, 7),

48 
CHAN2G
(2452, 8),

49 
CHAN2G
(2457, 9),

50 
CHAN2G
(2462, 10),

51 
CHAN2G
(2467, 11),

52 
CHAN2G
(2472, 12),

53 
CHAN2G
(2484, 13),

60 c⁄° 
õì80211_ch™√l
 
	g©h9k_5ghz_ch™èbÀ
[] = {

62 
CHAN5G
(5180, 14),

63 
CHAN5G
(5200, 15),

64 
CHAN5G
(5220, 16),

65 
CHAN5G
(5240, 17),

67 
CHAN5G
(5260, 18),

68 
CHAN5G
(5280, 19),

69 
CHAN5G
(5300, 20),

70 
CHAN5G
(5320, 21),

72 
CHAN5G
(5500, 22),

73 
CHAN5G
(5520, 23),

74 
CHAN5G
(5540, 24),

75 
CHAN5G
(5560, 25),

76 
CHAN5G
(5580, 26),

77 
CHAN5G
(5600, 27),

78 
CHAN5G
(5620, 28),

79 
CHAN5G
(5640, 29),

80 
CHAN5G
(5660, 30),

81 
CHAN5G
(5680, 31),

82 
CHAN5G
(5700, 32),

84 
CHAN5G
(5745, 33),

85 
CHAN5G
(5765, 34),

86 
CHAN5G
(5785, 35),

87 
CHAN5G
(5805, 36),

88 
CHAN5G
(5825, 37),

92 
	#SHPCHECK
(
__hw_øã
, 
__Êags
) \

93 ((
__Êags
 & 
IEEE80211_RATE_SHORT_PREAMBLE
Ë? (
__hw_øã
 | 0x04 ) : 0)

	)

95 
	#RATE
(
_bôøã
, 
_hw_øã
, 
_Êags
) { \

96 .
bôøã
 = (
_bôøã
), \

97 .
Êags
 = (
_Êags
), \

98 .
hw_vÆue
 = (
_hw_øã
), \

99 .
hw_vÆue_sh‹t
 = (
	`SHPCHECK
(
_hw_øã
, 
_Êags
)) \

100 }

	)

102 
õì80211_øã
 
	g©h9k_Àgacy_øãs
[] = {

103 
RATE
(10, 0x1b, 0),

104 
RATE
(20, 0x1a, 
IEEE80211_RATE_SHORT_PREAMBLE
),

105 
RATE
(55, 0x19, 
IEEE80211_RATE_SHORT_PREAMBLE
),

106 
RATE
(110, 0x18, 
IEEE80211_RATE_SHORT_PREAMBLE
),

107 
RATE
(60, 0x0b, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

108 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

109 
RATE
(90, 0x0f, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

110 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

111 
RATE
(120, 0x0a, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

112 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

113 
RATE
(180, 0x0e, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

114 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

115 
RATE
(240, 0x09, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

116 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

117 
RATE
(360, 0x0d, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

118 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

119 
RATE
(480, 0x08, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

120 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

121 
RATE
(540, 0x0c, (
IEEE80211_RATE_SUPPORTS_5MHZ
 |

122 
IEEE80211_RATE_SUPPORTS_10MHZ
)),

125 
	$©h9k_cmn_öô_ch™√ls_øãs
(
©h_comm⁄
 *
comm⁄
)

127 
©h_hw
 *
ah
 = (©h_hw *)
comm⁄
->ah;

128 *
ch™√ls
;

130 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
©h9k_2ghz_ch™èbÀ
) +

131 
	`ARRAY_SIZE
(
©h9k_5ghz_ch™èbÀ
) !=

132 
ATH9K_NUM_CHANNELS
);

134 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_2GHZ
) {

135 
ch™√ls
 = 
	`devm_kzÆloc
(
ah
->
dev
,

136 (
©h9k_2ghz_ch™èbÀ
), 
GFP_KERNEL
);

137 i‡(!
ch™√ls
)

138  -
ENOMEM
;

140 
	`mem˝y
(
ch™√ls
, 
©h9k_2ghz_ch™èbÀ
,

141 (
©h9k_2ghz_ch™èbÀ
));

142 
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
ch™√ls
 = channels;

143 
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
b™d
 = IEEE80211_BAND_2GHZ;

144 
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
n_ch™√ls
 =

145 
	`ARRAY_SIZE
(
©h9k_2ghz_ch™èbÀ
);

146 
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
bôøãs
 = 
©h9k_Àgacy_øãs
;

147 
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
n_bôøãs
 =

148 
	`ARRAY_SIZE
(
©h9k_Àgacy_øãs
);

151 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_5GHZ
) {

152 
ch™√ls
 = 
	`devm_kzÆloc
(
ah
->
dev
,

153 (
©h9k_5ghz_ch™èbÀ
), 
GFP_KERNEL
);

154 i‡(!
ch™√ls
)

155  -
ENOMEM
;

157 
	`mem˝y
(
ch™√ls
, 
©h9k_5ghz_ch™èbÀ
,

158 (
©h9k_5ghz_ch™èbÀ
));

159 
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
ch™√ls
 = channels;

160 
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
b™d
 = IEEE80211_BAND_5GHZ;

161 
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
n_ch™√ls
 =

162 
	`ARRAY_SIZE
(
©h9k_5ghz_ch™èbÀ
);

163 
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
bôøãs
 =

164 
©h9k_Àgacy_øãs
 + 4;

165 
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
n_bôøãs
 =

166 
	`ARRAY_SIZE
(
©h9k_Àgacy_øãs
) - 4;

169 
	}
}

170 
EXPORT_SYMBOL
(
©h9k_cmn_öô_ch™√ls_øãs
);

172 
	$©h9k_cmn_£tup_ht_ˇp
(
©h_hw
 *
ah
,

173 
õì80211_°a_ht_ˇp
 *
ht_öfo
)

175 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

176 
u8
 
tx_°ªams
, 
rx_°ªams
;

177 
i
, 
max_°ªams
;

179 
ht_öfo
->
ht_suµ‹ãd
 = 
åue
;

180 
ht_öfo
->
ˇp
 = 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

181 
IEEE80211_HT_CAP_SM_PS
 |

182 
IEEE80211_HT_CAP_SGI_40
 |

183 
IEEE80211_HT_CAP_DSSSCCK40
;

185 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_LDPC
)

186 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_LDPC_CODING
;

188 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_SGI_20
)

189 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_SGI_20
;

191 
ht_öfo
->
ampdu_Á˘‹
 = 
IEEE80211_HT_MAX_AMPDU_64K
;

192 
ht_öfo
->
ampdu_dísôy
 = 
IEEE80211_HT_MPDU_DENSITY_8
;

194 i‡(
	`AR_SREV_9271
(
ah
Ë|| 
	`AR_SREV_9330
◊hË|| 
	`AR_SREV_9485
◊hË|| 
	`AR_SREV_9565
(ah))

195 
max_°ªams
 = 1;

196 i‡(
	`AR_SREV_9462
(
ah
))

197 
max_°ªams
 = 2;

198 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

199 
max_°ªams
 = 3;

201 
max_°ªams
 = 2;

203 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

204 i‡(
max_°ªams
 >= 2)

205 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_TX_STBC
;

206 
ht_öfo
->
ˇp
 |(1 << 
IEEE80211_HT_CAP_RX_STBC_SHIFT
);

210 
	`mem£t
(&
ht_öfo
->
mcs
, 0, (ht_info->mcs));

211 
tx_°ªams
 = 
	`©h9k_cmn_cou¡_°ªams
(
ah
->
txchaömask
, 
max_°ªams
);

212 
rx_°ªams
 = 
	`©h9k_cmn_cou¡_°ªams
(
ah
->
rxchaömask
, 
max_°ªams
);

214 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "TX streams %d, RX streams: %d\n",

215 
tx_°ªams
, 
rx_°ªams
);

217 i‡(
tx_°ªams
 !
rx_°ªams
) {

218 
ht_öfo
->
mcs
.
tx_∑øms
 |
IEEE80211_HT_MCS_TX_RX_DIFF
;

219 
ht_öfo
->
mcs
.
tx_∑øms
 |((
tx_°ªams
 - 1) <<

220 
IEEE80211_HT_MCS_TX_MAX_STREAMS_SHIFT
);

223 
i
 = 0; i < 
rx_°ªams
; i++)

224 
ht_öfo
->
mcs
.
rx_mask
[
i
] = 0xff;

226 
ht_öfo
->
mcs
.
tx_∑øms
 |
IEEE80211_HT_MCS_TX_DEFINED
;

227 
	}
}

228 
EXPORT_SYMBOL
(
©h9k_cmn_£tup_ht_ˇp
);

230 
	$©h9k_cmn_ªlﬂd_chaömask
(
©h_hw
 *
ah
)

232 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

234 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_HT
))

237 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_2GHZ
)

238 
	`©h9k_cmn_£tup_ht_ˇp
(
ah
,

239 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
].
ht_ˇp
);

240 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_5GHZ
)

241 
	`©h9k_cmn_£tup_ht_ˇp
(
ah
,

242 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
].
ht_ˇp
);

243 
	}
}

244 
EXPORT_SYMBOL
(
©h9k_cmn_ªlﬂd_chaömask
);

	@common-init.h

17 
©h9k_cmn_öô_ch™√ls_øãs
(
©h_comm⁄
 *
comm⁄
);

18 
©h9k_cmn_£tup_ht_ˇp
(
©h_hw
 *
ah
,

19 
õì80211_°a_ht_ˇp
 *
ht_öfo
);

20 
©h9k_cmn_ªlﬂd_chaömask
(
©h_hw
 *
ah
);

	@common-spectral.c

17 
	~<löux/ªœy.h
>

18 
	~<löux/øndom.h
>

19 
	~"©h9k.h
"

21 
s8
 
	$fix_rssi_öv_⁄ly
(
u8
 
rssi_vÆ
)

23 i‡(
rssi_vÆ
 == 128)

24 
rssi_vÆ
 = 0;

25  (
s8
Ë
rssi_vÆ
;

26 
	}
}

28 
	$©h_debug_£nd_f·_ßm∂e
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

29 
f·_ßm∂e_év
 *fft_sample_tlv)

31 
Àngth
;

32 i‡(!
•ec_¥iv
->
rfs_ch™_•ec_sˇn
)

35 
Àngth
 = 
	`__be16_to_˝u
(
f·_ßm∂e_év
->length) +

36 (*
f·_ßm∂e_év
);

37 
	`ªœy_wrôe
(
•ec_¥iv
->
rfs_ch™_•ec_sˇn
, 
f·_ßm∂e_év
, 
Àngth
);

38 
	}
}

40 (
	t©h_cmn_f·_idx_vÆid©‹
Ë(
	tu8
 *
	tßm∂e_íd
, 
	tbyãs_ªad
);

43 
	$©h_cmn_max_idx_vîify_ht20_f·
(
u8
 *
ßm∂e_íd
, 
byãs_ªad
)

45 
©h_ht20_mag_öfo
 *
mag_öfo
;

46 
u8
 *
ßm∂e
;

47 
u16
 
max_magnôude
;

48 
u8
 
max_ödex
;

49 
u8
 
max_exp
;

54 i‡(
byãs_ªad
 < 
SPECTRAL_HT20_SAMPLE_LEN
 - 1)

57 
mag_öfo
 = (
©h_ht20_mag_öfo
 *Ë(
ßm∂e_íd
 -

58 (
©h_ht20_mag_öfo
) + 1);

60 
ßm∂e
 = 
ßm∂e_íd
 - 
SPECTRAL_HT20_SAMPLE_LEN
 + 1;

62 
max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
Æl_bös
,

63 
SPECTRAL_HT20_NUM_BINS
);

64 
max_magnôude
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
Æl_bös
);

66 
max_exp
 = 
mag_öfo
->max_exp & 0xf;

72 i‡(
byãs_ªad
 < 
SPECTRAL_HT20_SAMPLE_LEN
 && 
max_ödex
 < 1)

75 i‡(
ßm∂e
[
max_ödex
] !(
max_magnôude
 >> 
max_exp
))

79 
	}
}

82 
	$©h_cmn_max_idx_vîify_ht20_40_f·
(
u8
 *
ßm∂e_íd
, 
byãs_ªad
)

84 
©h_ht20_40_mag_öfo
 *
mag_öfo
;

85 
u8
 *
ßm∂e
;

86 
u16
 
lowî_mag
, 
uµî_mag
;

87 
u8
 
lowî_max_ödex
, 
uµî_max_ödex
;

88 
u8
 
max_exp
;

89 
dc_pos
 = 
SPECTRAL_HT20_40_NUM_BINS
 / 2;

94 i‡(
byãs_ªad
 < 
SPECTRAL_HT20_40_SAMPLE_LEN
 - 1)

97 
mag_öfo
 = (
©h_ht20_40_mag_öfo
 *Ë(
ßm∂e_íd
 -

98 (
©h_ht20_40_mag_öfo
) + 1);

100 
ßm∂e
 = 
ßm∂e_íd
 - 
SPECTRAL_HT20_40_SAMPLE_LEN
 + 1;

102 
lowî_mag
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
lowî_bös
);

103 
lowî_max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
lowî_bös
,

104 
SPECTRAL_HT20_40_NUM_BINS
);

106 
uµî_mag
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
uµî_bös
);

107 
uµî_max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
uµî_bös
,

108 
SPECTRAL_HT20_40_NUM_BINS
);

110 
max_exp
 = 
mag_öfo
->max_exp & 0xf;

116 i‡(
byãs_ªad
 < 
SPECTRAL_HT20_40_SAMPLE_LEN
 &&

117 ((
uµî_max_ödex
 < 1Ë|| (
lowî_max_ödex
 < 1)))

123 i‡((
uµî_max_ödex
 - 
dc_pos
 > 0) &&

124 (
ßm∂e
[
uµî_max_ödex
] =(
uµî_mag
 >> 
max_exp
)))

125 
uµî_max_ödex
 -
dc_pos
;

127 i‡((
lowî_max_ödex
 - 
dc_pos
 > 0) &&

128 (
ßm∂e
[
lowî_max_ödex
 - 
dc_pos
] =(
lowî_mag
 >> 
max_exp
)))

129 
lowî_max_ödex
 -
dc_pos
;

131 i‡((
ßm∂e
[
uµî_max_ödex
 + 
dc_pos
] !(
uµî_mag
 >> 
max_exp
)) ||

132 (
ßm∂e
[
lowî_max_ödex
] !(
lowî_mag
 >> 
max_exp
)))

136 
	}
}

138 (
	t©h_cmn_f·_ßm∂e_h™dÀr
Ë(
	t©h_rx_°©us
 *
	trs
,

139 
	t©h_•ec_sˇn_¥iv
 *
	t•ec_¥iv
,

140 
	tu8
 *
	tßm∂e_buf
, 
	tu64
 
	ttsf
, 
	tu16
 
	t‰eq
, 
	tch™_ty≥
);

143 
	$©h_cmn_¥o˚ss_ht20_f·
(
©h_rx_°©us
 *
rs
,

144 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

145 
u8
 *
ßm∂e_buf
,

146 
u64
 
tsf
, 
u16
 
‰eq
, 
ch™_ty≥
)

148 
f·_ßm∂e_ht20
 
f·_ßm∂e_20
;

149 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
•ec_¥iv
->
ah
);

150 
©h_hw
 *
ah
 = 
•ec_¥iv
->ah;

151 
©h_ht20_mag_öfo
 *
mag_öfo
;

152 
f·_ßm∂e_év
 *
év
;

153 
i
 = 0;

154 
ªt
 = 0;

155 
dc_pos
 = 
SPECTRAL_HT20_NUM_BINS
 / 2;

156 
u16
 
magnôude
, 
tmp_mag
, 
Àngth
;

157 
u8
 
max_ödex
, 
bôm≠_w
, 
max_exp
;

159 
Àngth
 = (
f·_ßm∂e_20
Ë- (
f·_ßm∂e_év
);

160 
f·_ßm∂e_20
.
év
.
ty≥
 = 
ATH_FFT_SAMPLE_HT20
;

161 
f·_ßm∂e_20
.
év
.
Àngth
 = 
	`__˝u_to_be16
(length);

162 
f·_ßm∂e_20
.
‰eq
 = 
	`__˝u_to_be16
(freq);

163 
f·_ßm∂e_20
.
rssi
 = 
	`fix_rssi_öv_⁄ly
(
rs
->
rs_rssi_˘l
[0]);

164 
f·_ßm∂e_20
.
noi£
 = 
ah
->noise;

166 
mag_öfo
 = (
©h_ht20_mag_öfo
 *Ë(
ßm∂e_buf
 +

167 
SPECTRAL_HT20_NUM_BINS
);

169 
magnôude
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
Æl_bös
);

170 
f·_ßm∂e_20
.
max_magnôude
 = 
	`__˝u_to_be16
(
magnôude
);

172 
max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
Æl_bös
,

173 
SPECTRAL_HT20_NUM_BINS
);

174 
f·_ßm∂e_20
.
max_ödex
 = max_index;

176 
bôm≠_w
 = 
	`•e˘øl_bôm≠_weight
(
mag_öfo
->
Æl_bös
);

177 
f·_ßm∂e_20
.
bôm≠_weight
 = 
bôm≠_w
;

179 
max_exp
 = 
mag_öfo
->max_exp & 0xf;

180 
f·_ßm∂e_20
.
max_exp
 = max_exp;

182 
f·_ßm∂e_20
.
tsf
 = 
	`__˝u_to_be64
(tsf);

184 
	`mem˝y
(
f·_ßm∂e_20
.
d©a
, 
ßm∂e_buf
, 
SPECTRAL_HT20_NUM_BINS
);

186 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "FFT HT20 frame: max mag 0x%X,"

188 
magnôude
 >> 
max_exp
,

189 
max_ödex
);

191 i‡(
f·_ßm∂e_20
.
d©a
[
max_ödex
] !(
magnôude
 >> 
max_exp
)) {

192 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "Magnitude mismatch !\n");

193 
ªt
 = -1;

199 
f·_ßm∂e_20
.
d©a
[
dc_pos
] = (fft_sample_20.data[dc_pos + 1] +

200 
f·_ßm∂e_20
.
d©a
[
dc_pos
 - 1]) / 2;

206 i‡(
max_ödex
 =
dc_pos
) {

207 
tmp_mag
 = 0;

208 
i
 = 0; i < 
dc_pos
; i++) {

209 i‡(
f·_ßm∂e_20
.
d©a
[
i
] > 
tmp_mag
) {

210 
tmp_mag
 = 
f·_ßm∂e_20
.
d©a
[
i
];

211 
f·_ßm∂e_20
.
max_ödex
 = 
i
;

215 
magnôude
 = 
tmp_mag
 << 
max_exp
;

216 
f·_ßm∂e_20
.
max_magnôude
 = 
	`__˝u_to_be16
(
magnôude
);

218 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

220 
tmp_mag
, 
f·_ßm∂e_20
.
max_ödex
);

222 
i
 = 0; i < 
SPECTRAL_HT20_NUM_BINS
; i++) {

223 i‡(
f·_ßm∂e_20
.
d©a
[
i
] =(
magnôude
 >> 
max_exp
))

224 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

226 
f·_ßm∂e_20
.
d©a
[
i
], i);

228 i‡(
f·_ßm∂e_20
.
d©a
[
i
] > (
magnôude
 >> 
max_exp
)) {

229 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

231 
i
, 
f·_ßm∂e_20
.
d©a
[i]);

232 
ªt
 = -1;

236 i‡(
ªt
 < 0)

237  
ªt
;

239 
év
 = (
f·_ßm∂e_év
 *)&
f·_ßm∂e_20
;

241 
	`©h_debug_£nd_f·_ßm∂e
(
•ec_¥iv
, 
év
);

244 
	}
}

247 
	$©h_cmn_¥o˚ss_ht20_40_f·
(
©h_rx_°©us
 *
rs
,

248 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

249 
u8
 *
ßm∂e_buf
,

250 
u64
 
tsf
, 
u16
 
‰eq
, 
ch™_ty≥
)

252 
f·_ßm∂e_ht20_40
 
f·_ßm∂e_40
;

253 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
•ec_¥iv
->
ah
);

254 
©h_hw
 *
ah
 = 
•ec_¥iv
->ah;

255 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

256 
©h_ht20_40_mag_öfo
 *
mag_öfo
;

257 
f·_ßm∂e_év
 *
év
;

258 
dc_pos
 = 
SPECTRAL_HT20_40_NUM_BINS
 / 2;

259 
i
 = 0;

260 
ªt
 = 0;

261 
s16
 
ext_nf
;

262 
u16
 
lowî_mag
, 
uµî_mag
, 
tmp_mag
, 
Àngth
;

263 
s8
 
lowî_rssi
, 
uµî_rssi
;

264 
u8
 
lowî_max_ödex
, 
uµî_max_ödex
;

265 
u8
 
lowî_bôm≠_w
, 
uµî_bôm≠_w
, 
max_exp
;

267 i‡(
ˇld©a
)

268 
ext_nf
 = 
	`©h9k_hw_gëch™_noi£
(
ah
,áh->
curch™
,

269 
ˇld©a
->
nfCÆHi°
[3].
¥ivNF
);

271 
ext_nf
 = 
ATH_DEFAULT_NOISE_FLOOR
;

273 
Àngth
 = (
f·_ßm∂e_40
Ë- (
f·_ßm∂e_év
);

274 
f·_ßm∂e_40
.
év
.
ty≥
 = 
ATH_FFT_SAMPLE_HT20_40
;

275 
f·_ßm∂e_40
.
év
.
Àngth
 = 
	`__˝u_to_be16
(length);

276 
f·_ßm∂e_40
.
‰eq
 = 
	`__˝u_to_be16
(freq);

277 
f·_ßm∂e_40
.
ch™√l_ty≥
 = 
ch™_ty≥
;

279 i‡(
ch™_ty≥
 =
NL80211_CHAN_HT40PLUS
) {

280 
lowî_rssi
 = 
	`fix_rssi_öv_⁄ly
(
rs
->
rs_rssi_˘l
[0]);

281 
uµî_rssi
 = 
	`fix_rssi_öv_⁄ly
(
rs
->
rs_rssi_ext
[0]);

283 
f·_ßm∂e_40
.
lowî_noi£
 = 
ah
->
noi£
;

284 
f·_ßm∂e_40
.
uµî_noi£
 = 
ext_nf
;

286 
lowî_rssi
 = 
	`fix_rssi_öv_⁄ly
(
rs
->
rs_rssi_ext
[0]);

287 
uµî_rssi
 = 
	`fix_rssi_öv_⁄ly
(
rs
->
rs_rssi_˘l
[0]);

289 
f·_ßm∂e_40
.
lowî_noi£
 = 
ext_nf
;

290 
f·_ßm∂e_40
.
uµî_noi£
 = 
ah
->
noi£
;

293 
f·_ßm∂e_40
.
lowî_rssi
 =Üower_rssi;

294 
f·_ßm∂e_40
.
uµî_rssi
 = upper_rssi;

296 
mag_öfo
 = (
©h_ht20_40_mag_öfo
 *Ë(
ßm∂e_buf
 +

297 
SPECTRAL_HT20_40_NUM_BINS
);

299 
lowî_mag
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
lowî_bös
);

300 
f·_ßm∂e_40
.
lowî_max_magnôude
 = 
	`__˝u_to_be16
(
lowî_mag
);

302 
uµî_mag
 = 
	`•e˘øl_max_magnôude
(
mag_öfo
->
uµî_bös
);

303 
f·_ßm∂e_40
.
uµî_max_magnôude
 = 
	`__˝u_to_be16
(
uµî_mag
);

305 
lowî_max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
lowî_bös
,

306 
SPECTRAL_HT20_40_NUM_BINS
);

307 
f·_ßm∂e_40
.
lowî_max_ödex
 =Üower_max_index;

309 
uµî_max_ödex
 = 
	`•e˘øl_max_ödex
(
mag_öfo
->
uµî_bös
,

310 
SPECTRAL_HT20_40_NUM_BINS
);

311 
f·_ßm∂e_40
.
uµî_max_ödex
 = upper_max_index;

313 
lowî_bôm≠_w
 = 
	`•e˘øl_bôm≠_weight
(
mag_öfo
->
lowî_bös
);

314 
f·_ßm∂e_40
.
lowî_bôm≠_weight
 = 
lowî_bôm≠_w
;

316 
uµî_bôm≠_w
 = 
	`•e˘øl_bôm≠_weight
(
mag_öfo
->
uµî_bös
);

317 
f·_ßm∂e_40
.
uµî_bôm≠_weight
 = 
uµî_bôm≠_w
;

319 
max_exp
 = 
mag_öfo
->max_exp & 0xf;

320 
f·_ßm∂e_40
.
max_exp
 = max_exp;

322 
f·_ßm∂e_40
.
tsf
 = 
	`__˝u_to_be64
(tsf);

324 
	`mem˝y
(
f·_ßm∂e_40
.
d©a
, 
ßm∂e_buf
, 
SPECTRAL_HT20_40_NUM_BINS
);

326 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "FFT HT20/40 frame:Üower mag 0x%X,"

329 
lowî_mag
 >> 
max_exp
,

330 
lowî_max_ödex
,

331 
uµî_mag
 >> 
max_exp
,

332 
uµî_max_ödex
);

337 i‡((
uµî_max_ödex
 - 
dc_pos
 > 0) &&

338 (
f·_ßm∂e_40
.
d©a
[
uµî_max_ödex
] =(
uµî_mag
 >> 
max_exp
))) {

339 
uµî_max_ödex
 -
dc_pos
;

340 
f·_ßm∂e_40
.
uµî_max_ödex
 = upper_max_index;

343 i‡((
lowî_max_ödex
 - 
dc_pos
 > 0) &&

344 (
f·_ßm∂e_40
.
d©a
[
lowî_max_ödex
 - 
dc_pos
] ==

345 (
lowî_mag
 >> 
max_exp
))) {

346 
lowî_max_ödex
 -
dc_pos
;

347 
f·_ßm∂e_40
.
lowî_max_ödex
 =Üower_max_index;

353 i‡((
f·_ßm∂e_40
.
d©a
[
uµî_max_ödex
 + 
dc_pos
]

354 !(
uµî_mag
 >> 
max_exp
)) ||

355 (
f·_ßm∂e_40
.
d©a
[
lowî_max_ödex
]

356 !(
lowî_mag
 >> 
max_exp
))) {

357 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "Magnitude mismatch !\n");

358 
ªt
 = -1;

364 
f·_ßm∂e_40
.
d©a
[
dc_pos
] = (fft_sample_40.data[dc_pos + 1] +

365 
f·_ßm∂e_40
.
d©a
[
dc_pos
 - 1]) / 2;

371 i‡(
lowî_max_ödex
 =
dc_pos
) {

372 
tmp_mag
 = 0;

373 
i
 = 0; i < 
dc_pos
; i++) {

374 i‡(
f·_ßm∂e_40
.
d©a
[
i
] > 
tmp_mag
) {

375 
tmp_mag
 = 
f·_ßm∂e_40
.
d©a
[
i
];

376 
f·_ßm∂e_40
.
lowî_max_ödex
 = 
i
;

380 
lowî_mag
 = 
tmp_mag
 << 
max_exp
;

381 
f·_ßm∂e_40
.
lowî_max_magnôude
 = 
	`__˝u_to_be16
(
lowî_mag
);

383 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

385 
tmp_mag
, 
f·_ßm∂e_40
.
lowî_max_ödex
);

387 
i
 = 0; i < 
dc_pos
; i++) {

388 i‡(
f·_ßm∂e_40
.
d©a
[
i
] =(
lowî_mag
 >> 
max_exp
))

389 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

391 
f·_ßm∂e_40
.
d©a
[
i
], i);

393 i‡(
f·_ßm∂e_40
.
d©a
[
i
] > (
lowî_mag
 >> 
max_exp
)) {

394 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

396 
i
, 
f·_ßm∂e_40
.
d©a
[i]);

397 
ªt
 = -1;

401 i‡(
uµî_max_ödex
 =
dc_pos
) {

402 
tmp_mag
 = 0;

403 
i
 = 
dc_pos
; i < 
SPECTRAL_HT20_40_NUM_BINS
; i++) {

404 i‡(
f·_ßm∂e_40
.
d©a
[
i
] > 
tmp_mag
) {

405 
tmp_mag
 = 
f·_ßm∂e_40
.
d©a
[
i
];

406 
f·_ßm∂e_40
.
uµî_max_ödex
 = 
i
;

409 
uµî_mag
 = 
tmp_mag
 << 
max_exp
;

410 
f·_ßm∂e_40
.
uµî_max_magnôude
 = 
	`__˝u_to_be16
(
uµî_mag
);

412 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

414 
tmp_mag
, 
i
);

416 
i
 = 
dc_pos
; i < 
SPECTRAL_HT20_40_NUM_BINS
; i++) {

417 i‡(
f·_ßm∂e_40
.
d©a
[
i
] =(
uµî_mag
 >> 
max_exp
))

418 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

420 
f·_ßm∂e_40
.
d©a
[
i
], i);

422 i‡(
f·_ßm∂e_40
.
d©a
[
i
] > (
uµî_mag
 >> 
max_exp
)) {

423 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

425 
i
, 
f·_ßm∂e_40
.
d©a
[i]);

427 
ªt
 = -1;

431 i‡(
ªt
 < 0)

432  
ªt
;

434 
év
 = (
f·_ßm∂e_év
 *)&
f·_ßm∂e_40
;

436 
	`©h_debug_£nd_f·_ßm∂e
(
•ec_¥iv
, 
év
);

439 
	}
}

441 
ölöe
 

442 
	$©h_cmn_c›y_f·_‰ame
(
u8
 *
ö
, u8 *
out
, 
ßm∂e_Àn
, 
ßm∂e_byãs
)

444 
ßm∂e_byãs
 - 
ßm∂e_Àn
) {

447 
	`mem˝y
(&
out
[1], 
ö
,

448 
ßm∂e_Àn
 - 1);

452 
	`mem˝y
(
out
, 
ö
, 
ßm∂e_Àn
);

458 
	`mem˝y
(&
out
[1], 
ö
, 30);

459 
out
[31] = 
ö
[31];

460 
	`mem˝y
(&
out
[32], &
ö
[33],

461 
ßm∂e_Àn
 - 32);

467 
	`mem˝y
(
out
, 
ö
, 30);

468 
out
[30] = 
ö
[31];

469 
	`mem˝y
(&
out
[31], &
ö
[33],

470 
ßm∂e_Àn
 - 31);

475 
	}
}

478 
	$©h_cmn_is_f·_buf_fuŒ
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
)

480 
i
 = 0;

481 
ªt
 = 0;

482 
rch™
 *
rc
 = 
•ec_¥iv
->
rfs_ch™_•ec_sˇn
;

484 
	`f‹_óch_⁄löe_˝u
(
i
)

485 
ªt
 +
	`ªœy_buf_fuŒ
(
rc
->
buf
[
i
]);

487 
i
 = 
	`num_⁄löe_˝us
();

489 i‡(
ªt
 =
i
)

493 
	}
}

496 
	$©h_cmn_¥o˚ss_f·
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
, 
õì80211_hdr
 *
hdr
,

497 
©h_rx_°©us
 *
rs
, 
u64
 
tsf
)

499 
u8
 
ßm∂e_buf
[
SPECTRAL_SAMPLE_MAX_LEN
] = {0};

500 
©h_hw
 *
ah
 = 
•ec_¥iv
->ah;

501 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
•ec_¥iv
->
ah
);

502 
u8
 
num_bös
, *
vd©a
 = (u8 *)
hdr
;

503 
©h_ød¨_öfo
 *
ød¨_öfo
;

504 
Àn
 = 
rs
->
rs_d©Æí
;

505 
i
;

506 
gŸ_¶í
 = 0;

507 
u8
 *
ßm∂e_°¨t
;

508 
ßm∂e_byãs
 = 0;

509 
ªt
 = 0;

510 
u16
 
f·_Àn
, 
ßm∂e_Àn
, 
‰eq
 = 
ah
->
curch™
->
ch™
->
˚¡î_‰eq
;

511 
∆80211_ch™√l_ty≥
 
ch™_ty≥
;

512 
©h_cmn_f·_idx_vÆid©‹
 *
f·_idx_vÆid©‹
;

513 
©h_cmn_f·_ßm∂e_h™dÀr
 *
f·_h™dÀr
;

519 i‡(
rs
->
rs_phyîr
 !
ATH9K_PHYERR_RADAR
 &&

520 
rs
->
rs_phyîr
 !
ATH9K_PHYERR_FALSE_RADAR_EXT
 &&

521 
rs
->
rs_phyîr
 !
ATH9K_PHYERR_SPECTRAL
)

527 
ød¨_öfo
 = ((
©h_ød¨_öfo
 *)&
vd©a
[
Àn
]) - 1;

528 i‡(!(
ød¨_öfo
->
pul£_bw_öfo
 & 
SPECTRAL_SCAN_BITMASK
))

534 
ªt
 = 
	`©h_cmn_is_f·_buf_fuŒ
(
•ec_¥iv
);

535 i‡(
ªt
 == 1) {

536 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "FFTÑeport ignored,Ço space "

541 
ch™_ty≥
 = 
	`cfg80211_gë_ch™def_ty≥
(&
comm⁄
->
hw
->
c⁄f
.
ch™def
);

542 i‡((
ch™_ty≥
 =
NL80211_CHAN_HT40MINUS
) ||

543 (
ch™_ty≥
 =
NL80211_CHAN_HT40PLUS
)) {

544 
f·_Àn
 = 
SPECTRAL_HT20_40_TOTAL_DATA_LEN
;

545 
ßm∂e_Àn
 = 
SPECTRAL_HT20_40_SAMPLE_LEN
;

546 
num_bös
 = 
SPECTRAL_HT20_40_NUM_BINS
;

547 
f·_idx_vÆid©‹
 = &
©h_cmn_max_idx_vîify_ht20_40_f·
;

548 
f·_h™dÀr
 = &
©h_cmn_¥o˚ss_ht20_40_f·
;

550 
f·_Àn
 = 
SPECTRAL_HT20_TOTAL_DATA_LEN
;

551 
ßm∂e_Àn
 = 
SPECTRAL_HT20_SAMPLE_LEN
;

552 
num_bös
 = 
SPECTRAL_HT20_NUM_BINS
;

553 
f·_idx_vÆid©‹
 = 
©h_cmn_max_idx_vîify_ht20_f·
;

554 
f·_h™dÀr
 = &
©h_cmn_¥o˚ss_ht20_f·
;

557 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "GotÑadar dump bw_info: 0x%X,"

559 
ød¨_öfo
->
pul£_bw_öfo
,

560 
Àn
,

561 
f·_Àn
);

562 
ßm∂e_°¨t
 = 
vd©a
;

563 
i
 = 0; i < 
Àn
 - 2; i++) {

564 
ßm∂e_byãs
++;

572 i‡(
Àn
 <
f·_Àn
 + 2) {

573 
ßm∂e_byãs
 = 
Àn
 - (
©h_ød¨_öfo
);

574 
gŸ_¶í
 = 1;

584 i‡(
vd©a
[
i
] <0x7 && 
ßm∂e_byãs
 >
ßm∂e_Àn
 - 1) {

603 i‡((
ßm∂e_byãs
 > 
ßm∂e_Àn
 + 2) ||

604 ((
ßm∂e_byãs
 > 
ßm∂e_Àn
) &&

605 (
ßm∂e_°¨t
[31] != sample_start[32])))

614 i‡(!
	`f·_idx_vÆid©‹
(&
vd©a
[
i
], i)) {

615 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
,

616 "Found vÆid f· fømê© %i\n", 
i
);

617 
gŸ_¶í
 = 1;

621 i‡((
ßm∂e_°¨t
[31] == sample_start[32]) &&

622 (
ßm∂e_byãs
 >
ßm∂e_Àn
) &&

623 (
ßm∂e_byãs
 < 
ßm∂e_Àn
 + 2) &&

624 (
vd©a
[
i
 + 1] <= 0x7))

628 i‡((
ßm∂e_byãs
 =
ßm∂e_Àn
 - 1) &&

629 (
vd©a
[
i
 + 1] <= 0x7))

632 
gŸ_¶í
 = 1;

635 i‡(
gŸ_¶í
) {

636 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "FFT frameÜen: %i\n",

637 
ßm∂e_byãs
);

642 i‡(
ßm∂e_byãs
 !
ßm∂e_Àn
 && 
Àn
 <
f·_Àn
 + 2) {

643 
	`©h_cmn_c›y_f·_‰ame
(
ßm∂e_°¨t
,

644 
ßm∂e_buf
, 
ßm∂e_Àn
,

645 
ßm∂e_byãs
);

647 
	`f·_h™dÀr
(
rs
, 
•ec_¥iv
, 
ßm∂e_buf
,

648 
tsf
, 
‰eq
, 
ch™_ty≥
);

650 
	`mem£t
(
ßm∂e_buf
, 0, 
SPECTRAL_SAMPLE_MAX_LEN
);

655 
	`add_devi˚_øndom√ss
(
ßm∂e_buf
, 
num_bös
);

659 i‡(
ßm∂e_byãs
 =
ßm∂e_Àn
) {

660 
ªt
 = 
	`f·_h™dÀr
(
rs
, 
•ec_¥iv
, 
ßm∂e_°¨t
,

661 
tsf
, 
‰eq
, 
ch™_ty≥
);

666 
	`add_devi˚_øndom√ss
(
ßm∂e_°¨t
, 
num_bös
);

672 i‡(
Àn
 <
f·_Àn
 + 2)

675 
ßm∂e_°¨t
 = &
vd©a
[
i
 + 1];

682 i‡(
ªt
 == 0) {

683 
i
 +
num_bös
 - 2;

684 
ßm∂e_byãs
 = 
num_bös
 - 2;

686 
gŸ_¶í
 = 0;

690 
i
 -
num_bös
 - 2;

691 i‡(
Àn
 - 
i
 !(
©h_ød¨_öfo
))

692 
	`©h_dbg
(
comm⁄
, 
SPECTRAL_SCAN
, "FFTÑeportÅruncated"

694 
Àn
 - 
i
);

696 
	}
}

697 
EXPORT_SYMBOL
(
©h_cmn_¥o˚ss_f·
);

703 
ssize_t
 
	$ªad_fûe_•ec_sˇn_˘l
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

704 
size_t
 
cou¡
, 
loff_t
 *
µos
)

706 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

707 *
mode
 = "";

708 
Àn
;

710 
•ec_¥iv
->
•e˘øl_mode
) {

711 
SPECTRAL_DISABLED
:

712 
mode
 = "disable";

714 
SPECTRAL_BACKGROUND
:

715 
mode
 = "background";

717 
SPECTRAL_CHANSCAN
:

718 
mode
 = "chanscan";

720 
SPECTRAL_MANUAL
:

721 
mode
 = "manual";

724 
Àn
 = 
	`°æí
(
mode
);

725  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
mode
, 
Àn
);

726 
	}
}

728 
	$©h9k_cmn_•e˘øl_sˇn_åiggî
(
©h_comm⁄
 *
comm⁄
,

729 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
)

731 
©h_hw
 *
ah
 = 
•ec_¥iv
->ah;

732 
u32
 
rxfûãr
;

734 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

737 i‡(!
	`©h9k_hw_›s
(
ah
)->
•e˘øl_sˇn_åiggî
) {

738 
	`©h_îr
(
comm⁄
, "spectrumánalyzerÇot implemented onÅhis hardware\n");

742 
	`©h_ps_›s
(
comm⁄
)->
	`wakeup
(common);

743 
rxfûãr
 = 
	`©h9k_hw_gërxfûãr
(
ah
);

744 
	`©h9k_hw_£åxfûãr
(
ah
, 
rxfûãr
 |

745 
ATH9K_RX_FILTER_PHYRADAR
 |

746 
ATH9K_RX_FILTER_PHYERR
);

753 
	`©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
comm⁄
, 
•ec_¥iv
, s≥c_¥iv->
•e˘øl_mode
);

754 
	`©h9k_hw_›s
(
ah
)->
	`•e˘øl_sˇn_åiggî
(ah);

755 
	`©h_ps_›s
(
comm⁄
)->
	`ª°‹e
(common);

756 
	}
}

757 
EXPORT_SYMBOL
(
©h9k_cmn_•e˘øl_sˇn_åiggî
);

759 
	$©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
©h_comm⁄
 *
comm⁄
,

760 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

761 
•e˘øl_mode
 spectral_mode)

763 
©h_hw
 *
ah
 = 
•ec_¥iv
->ah;

765 i‡(!
	`©h9k_hw_›s
(
ah
)->
•e˘øl_sˇn_åiggî
) {

766 
	`©h_îr
(
comm⁄
, "spectrumánalyzerÇot implemented onÅhis hardware\n");

770 
•e˘øl_mode
) {

771 
SPECTRAL_DISABLED
:

772 
•ec_¥iv
->
•ec_c⁄fig
.
íabÀd
 = 0;

774 
SPECTRAL_BACKGROUND
:

778 
•ec_¥iv
->
•ec_c⁄fig
.
ídÀss
 = 1;

779 
•ec_¥iv
->
•ec_c⁄fig
.
íabÀd
 = 1;

781 
SPECTRAL_CHANSCAN
:

782 
SPECTRAL_MANUAL
:

783 
•ec_¥iv
->
•ec_c⁄fig
.
ídÀss
 = 0;

784 
•ec_¥iv
->
•ec_c⁄fig
.
íabÀd
 = 1;

790 
	`©h_ps_›s
(
comm⁄
)->
	`wakeup
(common);

791 
	`©h9k_hw_›s
(
ah
)->
	`•e˘øl_sˇn_c⁄fig
◊h, &
•ec_¥iv
->
•ec_c⁄fig
);

792 
	`©h_ps_›s
(
comm⁄
)->
	`ª°‹e
(common);

794 
•ec_¥iv
->
•e˘øl_mode
 = spectral_mode;

797 
	}
}

798 
EXPORT_SYMBOL
(
©h9k_cmn_•e˘øl_sˇn_c⁄fig
);

800 
ssize_t
 
	$wrôe_fûe_•ec_sˇn_˘l
(
fûe
 *file,

801 c⁄° 
__u£r
 *
u£r_buf
,

802 
size_t
 
cou¡
, 
loff_t
 *
µos
)

804 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

805 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
•ec_¥iv
->
ah
);

806 
buf
[32];

807 
ssize_t
 
Àn
;

809 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

810  -
EOPNOTSUPP
;

812 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

813 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

814  -
EFAULT
;

816 
buf
[
Àn
] = '\0';

818 i‡(
	`°∫cmp
("åiggî", 
buf
, 7) == 0) {

819 
	`©h9k_cmn_•e˘øl_sˇn_åiggî
(
comm⁄
, 
•ec_¥iv
);

820 } i‡(
	`°∫cmp
("background", 
buf
, 10) == 0) {

821 
	`©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
comm⁄
, 
•ec_¥iv
, 
SPECTRAL_BACKGROUND
);

822 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "spectral scan: background modeÉnabled\n");

823 } i‡(
	`°∫cmp
("ch™sˇn", 
buf
, 8) == 0) {

824 
	`©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
comm⁄
, 
•ec_¥iv
, 
SPECTRAL_CHANSCAN
);

825 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "spectral scan: channel scan modeÉnabled\n");

826 } i‡(
	`°∫cmp
("m™uÆ", 
buf
, 6) == 0) {

827 
	`©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
comm⁄
, 
•ec_¥iv
, 
SPECTRAL_MANUAL
);

828 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "spectral scan: manual modeÉnabled\n");

829 } i‡(
	`°∫cmp
("dißbÀ", 
buf
, 7) == 0) {

830 
	`©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
comm⁄
, 
•ec_¥iv
, 
SPECTRAL_DISABLED
);

831 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "spectral scan: disabled\n");

833  -
EINVAL
;

836  
cou¡
;

837 
	}
}

839 c⁄° 
fûe_›î©i⁄s
 
	gf›s_•ec_sˇn_˘l
 = {

840 .
ªad
 = 
ªad_fûe_•ec_sˇn_˘l
,

841 .
	gwrôe
 = 
wrôe_fûe_•ec_sˇn_˘l
,

842 .
	g›í
 = 
sim∂e_›í
,

843 .
	gow√r
 = 
THIS_MODULE
,

844 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

851 
ssize_t
 
	$ªad_fûe_•e˘øl_sh‹t_ª≥©
(
fûe
 *file,

852 
__u£r
 *
u£r_buf
,

853 
size_t
 
cou¡
, 
loff_t
 *
µos
)

855 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

856 
buf
[32];

857 
Àn
;

859 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
•ec_¥iv
->
•ec_c⁄fig
.
sh‹t_ª≥©
);

860  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

861 
	}
}

863 
ssize_t
 
	$wrôe_fûe_•e˘øl_sh‹t_ª≥©
(
fûe
 *file,

864 c⁄° 
__u£r
 *
u£r_buf
,

865 
size_t
 
cou¡
, 
loff_t
 *
µos
)

867 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

868 
vÆ
;

869 
buf
[32];

870 
ssize_t
 
Àn
;

872 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

873 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

874  -
EFAULT
;

876 
buf
[
Àn
] = '\0';

877 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

878  -
EINVAL
;

880 i‡(
vÆ
 > 1)

881  -
EINVAL
;

883 
•ec_¥iv
->
•ec_c⁄fig
.
sh‹t_ª≥©
 = 
vÆ
;

884  
cou¡
;

885 
	}
}

887 c⁄° 
fûe_›î©i⁄s
 
	gf›s_•e˘øl_sh‹t_ª≥©
 = {

888 .
ªad
 = 
ªad_fûe_•e˘øl_sh‹t_ª≥©
,

889 .
	gwrôe
 = 
wrôe_fûe_•e˘øl_sh‹t_ª≥©
,

890 .
	g›í
 = 
sim∂e_›í
,

891 .
	gow√r
 = 
THIS_MODULE
,

892 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

899 
ssize_t
 
	$ªad_fûe_•e˘øl_cou¡
(
fûe
 *file,

900 
__u£r
 *
u£r_buf
,

901 
size_t
 
cou¡
, 
loff_t
 *
µos
)

903 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

904 
buf
[32];

905 
Àn
;

907 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
•ec_¥iv
->
•ec_c⁄fig
.
cou¡
);

908  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

909 
	}
}

911 
ssize_t
 
	$wrôe_fûe_•e˘øl_cou¡
(
fûe
 *file,

912 c⁄° 
__u£r
 *
u£r_buf
,

913 
size_t
 
cou¡
, 
loff_t
 *
µos
)

915 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

916 
vÆ
;

917 
buf
[32];

918 
ssize_t
 
Àn
;

920 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

921 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

922  -
EFAULT
;

924 
buf
[
Àn
] = '\0';

925 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

926  -
EINVAL
;

928 i‡(
vÆ
 > 255)

929  -
EINVAL
;

931 
•ec_¥iv
->
•ec_c⁄fig
.
cou¡
 = 
vÆ
;

932  
cou¡
;

933 
	}
}

935 c⁄° 
fûe_›î©i⁄s
 
	gf›s_•e˘øl_cou¡
 = {

936 .
ªad
 = 
ªad_fûe_•e˘øl_cou¡
,

937 .
	gwrôe
 = 
wrôe_fûe_•e˘øl_cou¡
,

938 .
	g›í
 = 
sim∂e_›í
,

939 .
	gow√r
 = 
THIS_MODULE
,

940 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

947 
ssize_t
 
	$ªad_fûe_•e˘øl_≥riod
(
fûe
 *file,

948 
__u£r
 *
u£r_buf
,

949 
size_t
 
cou¡
, 
loff_t
 *
µos
)

951 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

952 
buf
[32];

953 
Àn
;

955 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
•ec_¥iv
->
•ec_c⁄fig
.
≥riod
);

956  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

957 
	}
}

959 
ssize_t
 
	$wrôe_fûe_•e˘øl_≥riod
(
fûe
 *file,

960 c⁄° 
__u£r
 *
u£r_buf
,

961 
size_t
 
cou¡
, 
loff_t
 *
µos
)

963 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

964 
vÆ
;

965 
buf
[32];

966 
ssize_t
 
Àn
;

968 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

969 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

970  -
EFAULT
;

972 
buf
[
Àn
] = '\0';

973 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

974  -
EINVAL
;

976 i‡(
vÆ
 > 255)

977  -
EINVAL
;

979 
•ec_¥iv
->
•ec_c⁄fig
.
≥riod
 = 
vÆ
;

980  
cou¡
;

981 
	}
}

983 c⁄° 
fûe_›î©i⁄s
 
	gf›s_•e˘øl_≥riod
 = {

984 .
ªad
 = 
ªad_fûe_•e˘øl_≥riod
,

985 .
	gwrôe
 = 
wrôe_fûe_•e˘øl_≥riod
,

986 .
	g›í
 = 
sim∂e_›í
,

987 .
	gow√r
 = 
THIS_MODULE
,

988 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

995 
ssize_t
 
	$ªad_fûe_•e˘øl_f·_≥riod
(
fûe
 *file,

996 
__u£r
 *
u£r_buf
,

997 
size_t
 
cou¡
, 
loff_t
 *
µos
)

999 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

1000 
buf
[32];

1001 
Àn
;

1003 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
•ec_¥iv
->
•ec_c⁄fig
.
f·_≥riod
);

1004  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1005 
	}
}

1007 
ssize_t
 
	$wrôe_fûe_•e˘øl_f·_≥riod
(
fûe
 *file,

1008 c⁄° 
__u£r
 *
u£r_buf
,

1009 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1011 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
 = 
fûe
->
¥iv©e_d©a
;

1012 
vÆ
;

1013 
buf
[32];

1014 
ssize_t
 
Àn
;

1016 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1017 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1018  -
EFAULT
;

1020 
buf
[
Àn
] = '\0';

1021 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

1022  -
EINVAL
;

1024 i‡(
vÆ
 > 15)

1025  -
EINVAL
;

1027 
•ec_¥iv
->
•ec_c⁄fig
.
f·_≥riod
 = 
vÆ
;

1028  
cou¡
;

1029 
	}
}

1031 c⁄° 
fûe_›î©i⁄s
 
	gf›s_•e˘øl_f·_≥riod
 = {

1032 .
ªad
 = 
ªad_fûe_•e˘øl_f·_≥riod
,

1033 .
	gwrôe
 = 
wrôe_fûe_•e˘øl_f·_≥riod
,

1034 .
	g›í
 = 
sim∂e_›í
,

1035 .
	gow√r
 = 
THIS_MODULE
,

1036 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1043 
díåy
 *
¸óã_buf_fûe_h™dÀr
(c⁄° *
fûíame
,

1044 
díåy
 *
∑ª¡
,

1045 #i‡(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(3,3,0))

1046 
umode_t
 
mode
,

1048 
mode
,

1050 
rch™_buf
 *
buf
,

1051 *
is_globÆ
)

1053 
díåy
 *
	gbuf_fûe
;

1055 
	gbuf_fûe
 = 
debugfs_¸óã_fûe
(
fûíame
, 
mode
, 
∑ª¡
, 
buf
,

1056 &
ªœy_fûe_›î©i⁄s
);

1057 *
	gis_globÆ
 = 1;

1058  
	gbuf_fûe
;

1061 
	$ªmove_buf_fûe_h™dÀr
(
díåy
 *dentry)

1063 
	`debugfs_ªmove
(
díåy
);

1066 
	}
}

1068 
rch™_ˇŒbacks
 
	grfs_•ec_sˇn_cb
 = {

1069 .
¸óã_buf_fûe
 = 
¸óã_buf_fûe_h™dÀr
,

1070 .
	gªmove_buf_fûe
 = 
ªmove_buf_fûe_h™dÀr
,

1077 
	$©h9k_cmn_•e˘øl_deöô_debug
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
)

1079 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_DEBUGFS
)) {

1080 
	`ªœy_˛o£
(
•ec_¥iv
->
rfs_ch™_•ec_sˇn
);

1081 
•ec_¥iv
->
rfs_ch™_•ec_sˇn
 = 
NULL
;

1083 
	}
}

1084 
EXPORT_SYMBOL
(
©h9k_cmn_•e˘øl_deöô_debug
);

1086 
	$©h9k_cmn_•e˘øl_öô_debug
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

1087 
díåy
 *
debugfs_phy
)

1089 
•ec_¥iv
->
rfs_ch™_•ec_sˇn
 = 
	`ªœy_›í
("spectral_scan",

1090 
debugfs_phy
,

1091 1024, 256, &
rfs_•ec_sˇn_cb
,

1092 
NULL
);

1093 
	`debugfs_¸óã_fûe
("spectral_scan_ctl",

1094 
S_IRUSR
 | 
S_IWUSR
,

1095 
debugfs_phy
, 
•ec_¥iv
,

1096 &
f›s_•ec_sˇn_˘l
);

1097 
	`debugfs_¸óã_fûe
("spectral_short_repeat",

1098 
S_IRUSR
 | 
S_IWUSR
,

1099 
debugfs_phy
, 
•ec_¥iv
,

1100 &
f›s_•e˘øl_sh‹t_ª≥©
);

1101 
	`debugfs_¸óã_fûe
("spectral_count",

1102 
S_IRUSR
 | 
S_IWUSR
,

1103 
debugfs_phy
, 
•ec_¥iv
,

1104 &
f›s_•e˘øl_cou¡
);

1105 
	`debugfs_¸óã_fûe
("spectral_period",

1106 
S_IRUSR
 | 
S_IWUSR
,

1107 
debugfs_phy
, 
•ec_¥iv
,

1108 &
f›s_•e˘øl_≥riod
);

1109 
	`debugfs_¸óã_fûe
("spectral_fft_period",

1110 
S_IRUSR
 | 
S_IWUSR
,

1111 
debugfs_phy
, 
•ec_¥iv
,

1112 &
f›s_•e˘øl_f·_≥riod
);

1113 
	}
}

1114 
EXPORT_SYMBOL
(
©h9k_cmn_•e˘øl_öô_debug
);

	@common-spectral.h

17 #i‚de‡
SPECTRAL_H


18 
	#SPECTRAL_H


	)

20 
	~"../•e˘øl_comm⁄.h
"

32 
	e•e˘øl_mode
 {

33 
	mSPECTRAL_DISABLED
 = 0,

34 
	mSPECTRAL_BACKGROUND
,

35 
	mSPECTRAL_MANUAL
,

36 
	mSPECTRAL_CHANSCAN
,

39 
	#SPECTRAL_SCAN_BITMASK
 0x10

	)

41 
	s©h_ød¨_öfo
 {

42 
u8
 
	mpul£_Àngth_¥i
;

43 
u8
 
	mpul£_Àngth_ext
;

44 
u8
 
	mpul£_bw_öfo
;

45 } 
	g__∑cked
;

54 
	s©h_ht20_mag_öfo
 {

55 
u8
 
	mÆl_bös
[3];

56 
u8
 
	mmax_exp
;

57 } 
	g__∑cked
;

62 
	s©h_ht20_f·_∑ckë
 {

63 
u8
 
	md©a
[
SPECTRAL_HT20_NUM_BINS
];

64 
©h_ht20_mag_öfo
 
	mmag_öfo
;

65 
©h_ød¨_öfo
 
	mød¨_öfo
;

66 } 
	g__∑cked
;

68 
	#SPECTRAL_HT20_TOTAL_DATA_LEN
 ((
©h_ht20_f·_∑ckë
))

	)

69 
	#SPECTRAL_HT20_SAMPLE_LEN
 ((
©h_ht20_mag_öfo
) +\

70 
SPECTRAL_HT20_NUM_BINS
)

	)

82 
	s©h_ht20_40_mag_öfo
 {

83 
u8
 
	mlowî_bös
[3];

84 
u8
 
	muµî_bös
[3];

85 
u8
 
	mmax_exp
;

86 } 
	g__∑cked
;

91 
	s©h_ht20_40_f·_∑ckë
 {

92 
u8
 
	md©a
[
SPECTRAL_HT20_40_NUM_BINS
];

93 
©h_ht20_40_mag_öfo
 
	mmag_öfo
;

94 
©h_ød¨_öfo
 
	mød¨_öfo
;

95 } 
	g__∑cked
;

97 
	s©h_•ec_sˇn_¥iv
 {

98 
©h_hw
 *
	mah
;

100 
rch™
 *
	mrfs_ch™_•ec_sˇn
;

101 
•e˘øl_mode
 
	m•e˘øl_mode
;

102 
©h_•ec_sˇn
 
	m•ec_c⁄fig
;

105 
	#SPECTRAL_HT20_40_TOTAL_DATA_LEN
 ((
©h_ht20_40_f·_∑ckë
))

	)

106 
	#SPECTRAL_HT20_40_SAMPLE_LEN
 ((
©h_ht20_40_mag_öfo
) +\

107 
SPECTRAL_HT20_40_NUM_BINS
)

	)

109 
	#SPECTRAL_SAMPLE_MAX_LEN
 
SPECTRAL_HT20_40_SAMPLE_LEN


	)

112 
ölöe
 
u16
 
	$•e˘øl_max_magnôude
(
u8
 *
bös
)

114  (
bös
[0] & 0xc0) >> 6 |

115 (
bös
[1] & 0xff) << 2 |

116 (
bös
[2] & 0x03) << 10;

117 
	}
}

120 
ölöe
 
u8
 
	$•e˘øl_max_ödex
(
u8
 *
bös
, 
num_bös
)

122 
s8
 
m
 = (
bös
[2] & 0xfc) >> 2;

123 
u8
 
zîo_idx
 = 
num_bös
 / 2;

129 i‡(
m
 & 0x20) {

130 
m
 &= ~0x20;

131 
m
 |= 0xe0;

139 
m
 +
zîo_idx
;

142 i‡(
m
 < 0 || m > 
num_bös
 - 1)

143 
m
 = 0;

145  
m
;

146 
	}
}

149 
ölöe
 
u8
 
	$•e˘øl_bôm≠_weight
(
u8
 *
bös
)

151  
bös
[0] & 0x3f;

152 
	}
}

154 
©h9k_cmn_•e˘øl_öô_debug
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
, 
díåy
 *
debugfs_phy
);

155 
©h9k_cmn_•e˘øl_deöô_debug
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
);

157 
©h9k_cmn_•e˘øl_sˇn_åiggî
(
©h_comm⁄
 *
comm⁄
,

158 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
);

159 
©h9k_cmn_•e˘øl_sˇn_c⁄fig
(
©h_comm⁄
 *
comm⁄
,

160 
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
,

161 
•e˘øl_mode
 spectral_mode);

162 
©h_cmn_¥o˚ss_f·
(
©h_•ec_sˇn_¥iv
 *
•ec_¥iv
, 
õì80211_hdr
 *
hdr
,

163 
©h_rx_°©us
 *
rs
, 
u64
 
tsf
);

	@common.c

21 
	~<löux/kî√l.h
>

22 
	~<löux/moduÀ.h
>

24 
	~"comm⁄.h
"

26 
MODULE_AUTHOR
("Atheros Communications");

27 
MODULE_DESCRIPTION
("SharedÜibrary for Atheros wireless 802.11n LAN cards.");

28 
MODULE_LICENSE
("Dual BSD/GPL");

31 
boﬁ
 
	$©h9k_cmn_rx_ac˚±
(
©h_comm⁄
 *
comm⁄
,

32 
õì80211_hdr
 *
hdr
,

33 
õì80211_rx_°©us
 *
rxs
,

34 
©h_rx_°©us
 *
rx_°©s
,

35 
boﬁ
 *
de¸y±_îr‹
,

36 
rxfûãr
)

38 
©h_hw
 *
ah
 = 
comm⁄
->ah;

39 
boﬁ
 
is_mc
, 
is_vÆid_tkù
, 
°rù_mic
, 
mic_îr‹
;

40 
__À16
 
fc
;

42 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

44 
is_mc
 = !!
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
);

45 
is_vÆid_tkù
 = 
rx_°©s
->
rs_keyix
 !
ATH9K_RXKEYIX_INVALID
 &&

46 
	`ã°_bô
(
rx_°©s
->
rs_keyix
, 
comm⁄
->
tkù_keym≠
);

47 
°rù_mic
 = 
is_vÆid_tkù
 && 
	`õì80211_is_d©a
(
fc
) &&

48 
	`õì80211_has_¥Ÿe˘ed
(
fc
) &&

49 !(
rx_°©s
->
rs_°©us
 &

50 (
ATH9K_RXERR_DECRYPT
 | 
ATH9K_RXERR_CRC
 | 
ATH9K_RXERR_MIC
 |

51 
ATH9K_RXERR_KEYMISS
));

58 i‡(
rx_°©s
->
rs_keyix
 =
ATH9K_RXKEYIX_INVALID
 ||

59 !
	`ã°_bô
(
rx_°©s
->
rs_keyix
, 
comm⁄
->
ccmp_keym≠
))

60 
rx_°©s
->
rs_°©us
 &~
ATH9K_RXERR_KEYMISS
;

62 
mic_îr‹
 = 
is_vÆid_tkù
 && !
	`õì80211_is_˘l
(
fc
) &&

63 !
	`õì80211_has_m‹e‰ags
(
fc
) &&

64 !(
	`À16_to_˝u
(
hdr
->
£q_˘æ
Ë& 
IEEE80211_SCTL_FRAG
) &&

65 (
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_MIC
);

73 i‡(
rx_°©s
->
rs_°©us
 != 0) {

74 
u8
 
°©us_mask
;

76 i‡(
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_CRC
) {

77 
rxs
->
Êag
 |
RX_FLAG_FAILED_FCS_CRC
;

78 
mic_îr‹
 = 
Ál£
;

81 i‡((
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_DECRYPT
) ||

82 (!
is_mc
 && (
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_KEYMISS
))) {

83 *
de¸y±_îr‹
 = 
åue
;

84 
mic_îr‹
 = 
Ál£
;

93 
°©us_mask
 = 
ATH9K_RXERR_DECRYPT
 | 
ATH9K_RXERR_MIC
 |

94 
ATH9K_RXERR_KEYMISS
;

96 i‡(
ah
->
is_m⁄ô‹ög
 && (
rxfûãr
 & 
FIF_FCSFAIL
))

97 
°©us_mask
 |
ATH9K_RXERR_CRC
;

99 i‡(
rx_°©s
->
rs_°©us
 & ~
°©us_mask
)

100  
Ál£
;

109 i‡(
°rù_mic
)

110 
rxs
->
Êag
 |
RX_FLAG_MMIC_STRIPPED
;

111 i‡(
is_mc
 && 
mic_îr‹
)

112 
rxs
->
Êag
 |
RX_FLAG_MMIC_ERROR
;

114  
åue
;

115 
	}
}

116 
EXPORT_SYMBOL
(
©h9k_cmn_rx_ac˚±
);

118 
	$©h9k_cmn_rx_skb_po°¥o˚ss
(
©h_comm⁄
 *
comm⁄
,

119 
sk_buff
 *
skb
,

120 
©h_rx_°©us
 *
rx_°©s
,

121 
õì80211_rx_°©us
 *
rxs
,

122 
boﬁ
 
de¸y±_îr‹
)

124 
©h_hw
 *
ah
 = 
comm⁄
->ah;

125 
õì80211_hdr
 *
hdr
;

126 
hdæí
, 
∑dpos
, 
∑dsize
;

127 
u8
 
keyix
;

128 
__À16
 
fc
;

131 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

132 
hdæí
 = 
	`õì80211_gë_hdæí_‰om_skb
(
skb
);

133 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

134 
∑dpos
 = 
	`õì80211_hdæí
(
fc
);

144 
∑dsize
 = 
∑dpos
 & 3;

145 i‡(
∑dsize
 && 
skb
->
Àn
>=
∑dpos
+∑dsize+
FCS_LEN
) {

146 
	`memmove
(
skb
->
d©a
 + 
∑dsize
, skb->d©a, 
∑dpos
);

147 
	`skb_puŒ
(
skb
, 
∑dsize
);

150 
keyix
 = 
rx_°©s
->
rs_keyix
;

152 i‡(!(
keyix
 =
ATH9K_RXKEYIX_INVALID
Ë&& !
de¸y±_îr‹
 &&

153 
	`õì80211_has_¥Ÿe˘ed
(
fc
)) {

154 
rxs
->
Êag
 |
RX_FLAG_DECRYPTED
;

155 } i‡(
	`õì80211_has_¥Ÿe˘ed
(
fc
)

156 && !
de¸y±_îr‹
 && 
skb
->
Àn
 >
hdæí
 + 4) {

157 
keyix
 = 
skb
->
d©a
[
hdæí
 + 3] >> 6;

159 i‡(
	`ã°_bô
(
keyix
, 
comm⁄
->
keym≠
))

160 
rxs
->
Êag
 |
RX_FLAG_DECRYPTED
;

162 i‡(
ah
->
sw_mgmt_¸y±o_rx
 &&

163 (
rxs
->
Êag
 & 
RX_FLAG_DECRYPTED
) &&

164 
	`õì80211_is_mgmt
(
fc
))

166 
rxs
->
Êag
 &~
RX_FLAG_DECRYPTED
;

167 
	}
}

168 
EXPORT_SYMBOL
(
©h9k_cmn_rx_skb_po°¥o˚ss
);

170 
	$©h9k_cmn_¥o˚ss_øã
(
©h_comm⁄
 *
comm⁄
,

171 
õì80211_hw
 *
hw
,

172 
©h_rx_°©us
 *
rx_°©s
,

173 
õì80211_rx_°©us
 *
rxs
)

175 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

176 
õì80211_b™d
 
b™d
;

177 
i
 = 0;

178 
©h_hw
 *
ah
 = 
comm⁄
->ah;

180 
b™d
 = 
ah
->
curch™
->
ch™
->band;

181 
sb™d
 = 
hw
->
wùhy
->
b™ds
[
b™d
];

183 i‡(
	`IS_CHAN_QUARTER_RATE
(
ah
->
curch™
))

184 
rxs
->
Êag
 |
RX_FLAG_5MHZ
;

185 i‡(
	`IS_CHAN_HALF_RATE
(
ah
->
curch™
))

186 
rxs
->
Êag
 |
RX_FLAG_10MHZ
;

188 i‡(
rx_°©s
->
rs_øã
 & 0x80) {

190 
rxs
->
Êag
 |
RX_FLAG_HT
;

191 
rxs
->
Êag
 |
rx_°©s
->flag;

192 
rxs
->
øã_idx
 = 
rx_°©s
->
rs_øã
 & 0x7f;

196 
i
 = 0; i < 
sb™d
->
n_bôøãs
; i++) {

197 i‡(
sb™d
->
bôøãs
[
i
].
hw_vÆue
 =
rx_°©s
->
rs_øã
) {

198 
rxs
->
øã_idx
 = 
i
;

201 i‡(
sb™d
->
bôøãs
[
i
].
hw_vÆue_sh‹t
 =
rx_°©s
->
rs_øã
) {

202 
rxs
->
Êag
 |
RX_FLAG_SHORTPRE
;

203 
rxs
->
øã_idx
 = 
i
;

208  -
EINVAL
;

209 
	}
}

210 
EXPORT_SYMBOL
(
©h9k_cmn_¥o˚ss_øã
);

212 
	$©h9k_cmn_¥o˚ss_rssi
(
©h_comm⁄
 *
comm⁄
,

213 
õì80211_hw
 *
hw
,

214 
©h_rx_°©us
 *
rx_°©s
,

215 
õì80211_rx_°©us
 *
rxs
)

217 
©h_hw
 *
ah
 = 
comm⁄
->ah;

218 
œ°_rssi
;

219 
rssi
 = 
rx_°©s
->
rs_rssi
;

220 
i
, 
j
;

225 i‡(
rx_°©s
->
rs_m‹óggr
) {

226 
rxs
->
Êag
 |
RX_FLAG_NO_SIGNAL_VAL
;

234 i‡(
rx_°©s
->
rs_rssi
 =
ATH9K_RSSI_BAD
) {

235 
rxs
->
Êag
 |
RX_FLAG_NO_SIGNAL_VAL
;

239 
i
 = 0, 
j
 = 0; i < 
	`ARRAY_SIZE
(
rx_°©s
->
rs_rssi_˘l
); i++) {

240 
s8
 
rssi
;

242 i‡(!(
ah
->
rxchaömask
 & 
	`BIT
(
i
)))

245 
rssi
 = 
rx_°©s
->
rs_rssi_˘l
[
i
];

246 i‡(
rssi
 !
ATH9K_RSSI_BAD
) {

247 
rxs
->
chaös
 |
	`BIT
(
j
);

248 
rxs
->
chaö_sig«l
[
j
] = 
ah
->
noi£
 + 
rssi
;

250 
j
++;

256 i‡(
rx_°©s
->
is_mybóc⁄
 &&

257 ((
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) ||

258 (
ah
->
›mode
 =
NL80211_IFTYPE_ADHOC
))) {

259 
	`ATH_RSSI_LPF
(
comm⁄
->
œ°_rssi
, 
rx_°©s
->
rs_rssi
);

260 
œ°_rssi
 = 
comm⁄
->last_rssi;

262 i‡(
	`likñy
(
œ°_rssi
 !
ATH_RSSI_DUMMY_MARKER
))

263 
rssi
 = 
	`ATH_EP_RND
(
œ°_rssi
, 
ATH_RSSI_EP_MULTIPLIER
);

264 i‡(
rssi
 < 0)

265 
rssi
 = 0;

267 
ah
->
°©s
.
avgbrssi
 = 
rssi
;

270 
rxs
->
sig«l
 = 
ah
->
noi£
 + 
rx_°©s
->
rs_rssi
;

271 
	}
}

272 
EXPORT_SYMBOL
(
©h9k_cmn_¥o˚ss_rssi
);

274 
	$©h9k_cmn_gë_hw_¸y±o_keyty≥
(
sk_buff
 *
skb
)

276 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

278 i‡(
tx_öfo
->
c⁄åﬁ
.
hw_key
) {

279 
tx_öfo
->
c⁄åﬁ
.
hw_key
->
cùhî
) {

280 
WLAN_CIPHER_SUITE_WEP40
:

281 
WLAN_CIPHER_SUITE_WEP104
:

282  
ATH9K_KEY_TYPE_WEP
;

283 
WLAN_CIPHER_SUITE_TKIP
:

284  
ATH9K_KEY_TYPE_TKIP
;

285 
WLAN_CIPHER_SUITE_CCMP
:

286  
ATH9K_KEY_TYPE_AES
;

292  
ATH9K_KEY_TYPE_CLEAR
;

293 
	}
}

294 
EXPORT_SYMBOL
(
©h9k_cmn_gë_hw_¸y±o_keyty≥
);

299 
	$©h9k_cmn_upd©e_ich™√l
(
©h_comm⁄
 *
comm⁄
,

300 
©h9k_ch™√l
 *
ich™
,

301 
cfg80211_ch™_def
 *
ch™def
)

303 
õì80211_ch™√l
 *
ch™
 = 
ch™def
->chan;

304 
u16
 
Êags
 = 0;

305 
width
;

307 
ich™
->
ch™√l
 = 
ch™
->
˚¡î_‰eq
;

308 
ich™
->
ch™
 = chan;

310 i‡(
ch™
->
b™d
 =
IEEE80211_BAND_5GHZ
)

311 
Êags
 |
CHANNEL_5GHZ
;

313 
comm⁄
->
ch™_bw
) {

315 
width
 = 
NL80211_CHAN_WIDTH_5
;

318 
width
 = 
NL80211_CHAN_WIDTH_10
;

321 
width
 = 
ch™def
->width;

325 
width
) {

326 
NL80211_CHAN_WIDTH_5
:

327 
Êags
 |
CHANNEL_QUARTER
;

329 
NL80211_CHAN_WIDTH_10
:

330 
Êags
 |
CHANNEL_HALF
;

332 
NL80211_CHAN_WIDTH_20_NOHT
:

334 
NL80211_CHAN_WIDTH_20
:

335 
Êags
 |
CHANNEL_HT
;

337 
NL80211_CHAN_WIDTH_40
:

338 i‡(
ch™def
->
˚¡î_‰eq1
 > ch™def->
ch™
->
˚¡î_‰eq
)

339 
Êags
 |
CHANNEL_HT40PLUS
 | 
CHANNEL_HT
;

341 
Êags
 |
CHANNEL_HT40MINUS
 | 
CHANNEL_HT
;

344 
	`WARN_ON
(1);

347 
ich™
->
ch™√lFœgs
 = 
Êags
;

348 
	}
}

353 
©h9k_ch™√l
 *
	$©h9k_cmn_gë_ch™√l
(
õì80211_hw
 *
hw
,

354 
©h_hw
 *
ah
,

355 
cfg80211_ch™_def
 *
ch™def
)

357 
õì80211_ch™√l
 *
curch™
 = 
ch™def
->
ch™
;

358 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

359 
©h9k_ch™√l
 *
ch™√l
;

361 
ch™√l
 = &
ah
->
ch™√ls
[
curch™
->
hw_vÆue
];

362 
	`©h9k_cmn_upd©e_ich™√l
(
comm⁄
, 
ch™√l
, 
ch™def
);

364  
ch™√l
;

365 
	}
}

366 
EXPORT_SYMBOL
(
©h9k_cmn_gë_ch™√l
);

368 
	$©h9k_cmn_cou¡_°ªams
(
chaömask
, 
max
)

370 
°ªams
 = 0;

373 i‡(++
°ªams
 =
max
)

375 } (
chaömask
 = chainmask & (chainmask - 1)));

377  
°ªams
;

378 
	}
}

379 
EXPORT_SYMBOL
(
©h9k_cmn_cou¡_°ªams
);

381 
	$©h9k_cmn_upd©e_txpow
(
©h_hw
 *
ah
, 
u16
 
cur_txpow
,

382 
u16
 
√w_txpow
, u16 *
txpowî
)

384 
©h_ªguœt‹y
 *
ªg
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

386 i‡(
ªg
->
powî_limô
 !
√w_txpow
)

387 
	`©h9k_hw_£t_txpowîlimô
(
ah
, 
√w_txpow
, 
Ál£
);

390 *
txpowî
 = 
ªg
->
max_powî_Àvñ
;

391 
	}
}

392 
EXPORT_SYMBOL
(
©h9k_cmn_upd©e_txpow
);

394 
	$©h9k_cmn_öô_¸y±o
(
©h_hw
 *
ah
)

396 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

397 
i
 = 0;

400 
comm⁄
->
keymax
 = 
AR_KEYTABLE_SIZE
;

408 i‡(
ah
->
misc_mode
 & 
AR_PCU_MIC_NEW_LOC_ENA
)

409 
comm⁄
->
¸y±_ˇps
 |
ATH_CRYPT_CAP_MIC_COMBINED
;

415 
i
 = 0; i < 
comm⁄
->
keymax
; i++)

416 
	`©h_hw_keyª£t
(
comm⁄
, (
u16
Ë
i
);

417 
	}
}

418 
EXPORT_SYMBOL
(
©h9k_cmn_öô_¸y±o
);

420 
__öô
 
	$©h9k_cmn_öô
()

423 
	}
}

424 
moduÀ_öô
(
©h9k_cmn_öô
);

426 
__exô
 
	$©h9k_cmn_exô
()

429 
	}
}

430 
moduÀ_exô
(
©h9k_cmn_exô
);

	@common.h

17 
	~<√t/mac80211.h
>

19 
	~"../©h.h
"

21 
	~"hw.h
"

22 
	~"hw-›s.h
"

24 
	~"comm⁄-öô.h
"

25 
	~"comm⁄-bóc⁄.h
"

26 
	~"comm⁄-debug.h
"

27 
	~"comm⁄-•e˘øl.h
"

31 
	#WME_BA_BMP_SIZE
 64

	)

32 
	#WME_MAX_BA
 
WME_BA_BMP_SIZE


	)

33 
	#ATH_TID_MAX_BUFS
 (2 * 
WME_MAX_BA
)

	)

35 
	#ATH_RSSI_DUMMY_MARKER
 127

	)

36 
	#ATH_RSSI_LPF_LEN
 10

	)

37 
	#RSSI_LPF_THRESHOLD
 -20

	)

38 
	#ATH_RSSI_EP_MULTIPLIER
 (1<<7)

	)

39 
	#ATH_EP_MUL
(
x
, 
mul
Ë((xË* (mul))

	)

40 
	#ATH_RSSI_IN
(
x
Ë(
	`ATH_EP_MUL
((x), 
ATH_RSSI_EP_MULTIPLIER
))

	)

41 
	#ATH_LPF_RSSI
(
x
, 
y
, 
Àn
) \

42 ((
x
 !
ATH_RSSI_DUMMY_MARKER
Ë? (((xË* ((
Àn
Ë- 1Ë+ (
y
)Ë/ (Àn)Ë: (y))

	)

43 
	#ATH_RSSI_LPF
(
x
, 
y
) do { \

44 i‡((
y
Ë>
RSSI_LPF_THRESHOLD
) \

45 
x
 = 
	`ATH_LPF_RSSI
((x), 
	`ATH_RSSI_IN
((
y
)), 
ATH_RSSI_LPF_LEN
); \

46 } 0)

	)

47 
	#ATH_EP_RND
(
x
, 
mul
) \

48 (((
x
Ë+ ((
mul
)/2)Ë/ (mul))

	)

50 
	#IEEE80211_MS_TO_TU
(
x
Ë(((xË* 1000Ë/ 1024)

	)

52 
	s©h_bóc⁄_c⁄fig
 {

53 
	mbóc⁄_öãrvÆ
;

54 
u16
 
	mdtim_≥riod
;

55 
u16
 
	mbmiss_timeout
;

56 
u8
 
	mdtim_cou¡
;

57 
u8
 
	míabÀ_bóc⁄
;

58 
boﬁ
 
	mibss_¸ót‹
;

59 
u32
 
	m√xâbâ
;

60 
u32
 
	mötvÆ
;

63 
boﬁ
 
©h9k_cmn_rx_ac˚±
(
©h_comm⁄
 *
comm⁄
,

64 
õì80211_hdr
 *
hdr
,

65 
õì80211_rx_°©us
 *
rxs
,

66 
©h_rx_°©us
 *
rx_°©s
,

67 
boﬁ
 *
de¸y±_îr‹
,

68 
rxfûãr
);

69 
©h9k_cmn_rx_skb_po°¥o˚ss
(
©h_comm⁄
 *
comm⁄
,

70 
sk_buff
 *
skb
,

71 
©h_rx_°©us
 *
rx_°©s
,

72 
õì80211_rx_°©us
 *
rxs
,

73 
boﬁ
 
de¸y±_îr‹
);

74 
©h9k_cmn_¥o˚ss_øã
(
©h_comm⁄
 *
comm⁄
,

75 
õì80211_hw
 *
hw
,

76 
©h_rx_°©us
 *
rx_°©s
,

77 
õì80211_rx_°©us
 *
rxs
);

78 
©h9k_cmn_¥o˚ss_rssi
(
©h_comm⁄
 *
comm⁄
,

79 
õì80211_hw
 *
hw
,

80 
©h_rx_°©us
 *
rx_°©s
,

81 
õì80211_rx_°©us
 *
rxs
);

82 
©h9k_cmn_gë_hw_¸y±o_keyty≥
(
sk_buff
 *
skb
);

83 
©h9k_ch™√l
 *
©h9k_cmn_gë_ch™√l
(
õì80211_hw
 *
hw
,

84 
©h_hw
 *
ah
,

85 
cfg80211_ch™_def
 *
ch™def
);

86 
©h9k_cmn_cou¡_°ªams
(
chaömask
, 
max
);

87 
©h9k_cmn_btc€x_bt_°omp
(
©h_comm⁄
 *
comm⁄
,

88 
©h_°omp_ty≥
 
°omp_ty≥
);

89 
©h9k_cmn_upd©e_txpow
(
©h_hw
 *
ah
, 
u16
 
cur_txpow
,

90 
u16
 
√w_txpow
, u16 *
txpowî
);

91 
©h9k_cmn_öô_¸y±o
(
©h_hw
 *
ah
);

	@debug.c

17 
	~<löux/¶ab.h
>

18 
	~<löux/vmÆloc.h
>

19 
	~<löux/exp‹t.h
>

20 
	~<asm/u«lig√d.h
>

22 
	~"©h9k.h
"

24 
	#REG_WRITE_D
(
_ah
, 
_ªg
, 
_vÆ
) \

25 
	`©h9k_hw_comm⁄
(
_ah
)->
›s
->
	`wrôe
((_ah), (
_vÆ
), (
_ªg
))

	)

26 
	#REG_READ_D
(
_ah
, 
_ªg
) \

27 
	`©h9k_hw_comm⁄
(
_ah
)->
›s
->
	`ªad
((_ah), (
_ªg
))

	)

29 
	$©h9k_debug_sync_ˇu£
(
©h_so·c
 *
sc
, 
u32
 
sync_ˇu£
)

31 i‡(
sync_ˇu£
)

32 
sc
->
debug
.
°©s
.
i°©s
.
sync_ˇu£_Æl
++;

33 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RTC_IRQ
)

34 
sc
->
debug
.
°©s
.
i°©s
.
sync_πc_úq
++;

35 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_MAC_IRQ
)

36 
sc
->
debug
.
°©s
.
i°©s
.
sync_mac_úq
++;

37 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_EEPROM_ILLEGAL_ACCESS
)

38 
sc
->
debug
.
°©s
.
i°©s
.
ì¥om_ûÀgÆ_ac˚ss
++;

39 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_APB_TIMEOUT
)

40 
sc
->
debug
.
°©s
.
i°©s
.
≠b_timeout
++;

41 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_PCI_MODE_CONFLICT
)

42 
sc
->
debug
.
°©s
.
i°©s
.
pci_mode_c⁄Êi˘
++;

43 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_FATAL
)

44 
sc
->
debug
.
°©s
.
i°©s
.
ho°1_Áèl
++;

45 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_HOST1_PERR
)

46 
sc
->
debug
.
°©s
.
i°©s
.
ho°1_≥º
++;

47 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_TRCV_FIFO_PERR
)

48 
sc
->
debug
.
°©s
.
i°©s
.
åcv_fifo_≥º
++;

49 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_EP
)

50 
sc
->
debug
.
°©s
.
i°©s
.
ødm_˝l_ï
++;

51 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_DLLP_ABORT
)

52 
sc
->
debug
.
°©s
.
i°©s
.
ødm_˝l_dŒp_ab‹t
++;

53 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_TLP_ABORT
)

54 
sc
->
debug
.
°©s
.
i°©s
.
ødm_˝l_ép_ab‹t
++;

55 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_ECRC_ERR
)

56 
sc
->
debug
.
°©s
.
i°©s
.
ødm_˝l_e¸c_îr
++;

57 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_RADM_CPL_TIMEOUT
)

58 
sc
->
debug
.
°©s
.
i°©s
.
ødm_˝l_timeout
++;

59 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_LOCAL_TIMEOUT
)

60 
sc
->
debug
.
°©s
.
i°©s
.
loˇl_timeout
++;

61 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_PM_ACCESS
)

62 
sc
->
debug
.
°©s
.
i°©s
.
pm_ac˚ss
++;

63 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_MAC_AWAKE
)

64 
sc
->
debug
.
°©s
.
i°©s
.
mac_awake
++;

65 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_MAC_ASLEEP
)

66 
sc
->
debug
.
°©s
.
i°©s
.
mac_a¶ìp
++;

67 i‡(
sync_ˇu£
 & 
AR_INTR_SYNC_MAC_SLEEP_ACCESS
)

68 
sc
->
debug
.
°©s
.
i°©s
.
mac_¶ìp_ac˚ss
++;

69 
	}
}

71 
ssize_t
 
	$©h9k_debugfs_ªad_buf
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

72 
size_t
 
cou¡
, 
loff_t
 *
µos
)

74 
u8
 *
buf
 = 
fûe
->
¥iv©e_d©a
;

75  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
	`°æí
(buf));

76 
	}
}

78 
	$©h9k_debugfs_ªÀa£_buf
(
öode
 *öode, 
fûe
 *file)

80 
	`v‰ì
(
fûe
->
¥iv©e_d©a
);

82 
	}
}

84 #ifde‡
CPTCFG_ATH_DEBUG


86 
ssize_t
 
	$ªad_fûe_debug
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

87 
size_t
 
cou¡
, 
loff_t
 *
µos
)

89 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

90 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

91 
buf
[32];

92 
Àn
;

94 
Àn
 = 
	`•rötf
(
buf
, "0x%08x\n", 
comm⁄
->
debug_mask
);

95  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

96 
	}
}

98 
ssize_t
 
	$wrôe_fûe_debug
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

99 
size_t
 
cou¡
, 
loff_t
 *
µos
)

101 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

102 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

103 
mask
;

104 
buf
[32];

105 
ssize_t
 
Àn
;

107 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

108 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

109  -
EFAULT
;

111 
buf
[
Àn
] = '\0';

112 i‡(
	`k°πoul
(
buf
, 0, &
mask
))

113  -
EINVAL
;

115 
comm⁄
->
debug_mask
 = 
mask
;

116  
cou¡
;

117 
	}
}

119 c⁄° 
fûe_›î©i⁄s
 
	gf›s_debug
 = {

120 .
ªad
 = 
ªad_fûe_debug
,

121 .
	gwrôe
 = 
wrôe_fûe_debug
,

122 .
	g›í
 = 
sim∂e_›í
,

123 .
	gow√r
 = 
THIS_MODULE
,

124 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

129 
	#DMA_BUF_LEN
 1024

	)

132 
ssize_t
 
	$ªad_fûe_™i
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

133 
size_t
 
cou¡
, 
loff_t
 *
µos
)

135 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

136 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

137 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

138 
Àn
 = 0;

139 c⁄° 
size
 = 1024;

140 
ssize_t
 
ªtvÆ
 = 0;

141 *
buf
;

142 
i
;

144 c⁄° *
«me
;

145 
vÆ
;

146 } 
™i_öfo
[] = {

147 { "ANI RESET", 
ah
->
°©s
.
a°_™i_ª£t
 },

148 { "OFDM LEVEL", 
ah
->
™i
.
ofdmNoi£ImmunôyLevñ
 },

149 { "CCK LEVEL", 
ah
->
™i
.
cckNoi£ImmunôyLevñ
 },

150 { "SPUR UP", 
ah
->
°©s
.
a°_™i_•urup
 },

151 { "SPUR DOWN", 
ah
->
°©s
.
a°_™i_•urup
 },

152 { "OFDM WS-DET ON", 
ah
->
°©s
.
a°_™i_ofdm⁄
 },

153 { "OFDM WS-DET OFF", 
ah
->
°©s
.
a°_™i_ofdmoff
 },

154 { "MRC-CCK ON", 
ah
->
°©s
.
a°_™i_ccklow
 },

155 { "MRC-CCK OFF", 
ah
->
°©s
.
a°_™i_cckhigh
 },

156 { "FIR-STEP UP", 
ah
->
°©s
.
a°_™i_°ïup
 },

157 { "FIR-STEP DOWN", 
ah
->
°©s
.
a°_™i_°ïdown
 },

158 { "INV LISTENTIME", 
ah
->
°©s
.
a°_™i_ eg_‹_lzîo
 },

159 { "OFDM ERRORS", 
ah
->
°©s
.
a°_™i_ofdmîrs
 },

160 { "CCK ERRORS", 
ah
->
°©s
.
a°_™i_cckîrs
 },

163 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

164 i‡(
buf
 =
NULL
)

165  -
ENOMEM
;

167 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%15s: %s\n", "ANI",

168 
comm⁄
->
dißbÀ_™i
 ? "DISABLED" : "ENABLED");

170 i‡(
comm⁄
->
dißbÀ_™i
)

171 
exô
;

173 
i
 = 0; i < 
	`ARRAY_SIZE
(
™i_öfo
); i++)

174 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%15s: %u\n",

175 
™i_öfo
[
i
].
«me
,áni_öfo[i].
vÆ
);

177 
exô
:

178 i‡(
Àn
 > 
size
)

179 
Àn
 = 
size
;

181 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

182 
	`k‰ì
(
buf
);

184  
ªtvÆ
;

185 
	}
}

187 
ssize_t
 
	$wrôe_fûe_™i
(
fûe
 *file,

188 c⁄° 
__u£r
 *
u£r_buf
,

189 
size_t
 
cou¡
, 
loff_t
 *
µos
)

191 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

192 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

193 
™i
;

194 
buf
[32];

195 
ssize_t
 
Àn
;

197 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

198 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

199  -
EFAULT
;

201 
buf
[
Àn
] = '\0';

202 i‡(
	`k°πoul
(
buf
, 0, &
™i
))

203  -
EINVAL
;

205 i‡(
™i
 > 1)

206  -
EINVAL
;

208 
comm⁄
->
dißbÀ_™i
 = !
™i
;

210 i‡(
comm⁄
->
dißbÀ_™i
) {

211 
	`˛ór_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
);

212 
	`©h_°›_™i
(
sc
);

214 
	`©h_check_™i
(
sc
);

217  
cou¡
;

218 
	}
}

220 c⁄° 
fûe_›î©i⁄s
 
	gf›s_™i
 = {

221 .
ªad
 = 
ªad_fûe_™i
,

222 .
	gwrôe
 = 
wrôe_fûe_™i
,

223 .
	g›í
 = 
sim∂e_›í
,

224 .
	gow√r
 = 
THIS_MODULE
,

225 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

228 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


230 
ssize_t
 
	$ªad_fûe_bt_™t_divîsôy
(
fûe
 *file,

231 
__u£r
 *
u£r_buf
,

232 
size_t
 
cou¡
, 
loff_t
 *
µos
)

234 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

235 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

236 
buf
[32];

237 
Àn
;

239 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
comm⁄
->
bt_™t_divîsôy
);

240  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

241 
	}
}

243 
ssize_t
 
	$wrôe_fûe_bt_™t_divîsôy
(
fûe
 *file,

244 c⁄° 
__u£r
 *
u£r_buf
,

245 
size_t
 
cou¡
, 
loff_t
 *
µos
)

247 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

248 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

249 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
sc
->
sc_ah
->
ˇps
;

250 
bt_™t_divîsôy
;

251 
buf
[32];

252 
ssize_t
 
Àn
;

254 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

255 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

256  -
EFAULT
;

258 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_BT_ANT_DIV
))

259 
exô
;

261 
buf
[
Àn
] = '\0';

262 i‡(
	`k°πoul
(
buf
, 0, &
bt_™t_divîsôy
))

263  -
EINVAL
;

265 
comm⁄
->
bt_™t_divîsôy
 = !!bt_ant_diversity;

266 
	`©h9k_ps_wakeup
(
sc
);

267 
	`©h9k_hw_£t_bt_™t_divîsôy
(
sc
->
sc_ah
, 
comm⁄
->
bt_™t_divîsôy
);

268 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Enable WLAN/BT RX Antenna diversity: %d\n",

269 
comm⁄
->
bt_™t_divîsôy
);

270 
	`©h9k_ps_ª°‹e
(
sc
);

271 
exô
:

272  
cou¡
;

273 
	}
}

275 c⁄° 
fûe_›î©i⁄s
 
	gf›s_bt_™t_divîsôy
 = {

276 .
ªad
 = 
ªad_fûe_bt_™t_divîsôy
,

277 .
	gwrôe
 = 
wrôe_fûe_bt_™t_divîsôy
,

278 .
	g›í
 = 
sim∂e_›í
,

279 .
	gow√r
 = 
THIS_MODULE
,

280 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

285 
	$©h9k_debug_°©_™t
(
©h_so·c
 *
sc
,

286 
©h_hw_™tcomb_c⁄f
 *
div_™t_c⁄f
,

287 
maö_rssi_avg
, 
Æt_rssi_avg
)

289 
©h_™ã¬a_°©s
 *
as_maö
 = &
sc
->
debug
.
°©s
.
™t_°©s
[
ANT_MAIN
];

290 
©h_™ã¬a_°©s
 *
as_Æt
 = &
sc
->
debug
.
°©s
.
™t_°©s
[
ANT_ALT
];

292 
as_maö
->
 a_©ãm±_˙t
[
div_™t_c⁄f
->
maö_ a_c⁄f
]++;

293 
as_Æt
->
 a_©ãm±_˙t
[
div_™t_c⁄f
->
Æt_ a_c⁄f
]++;

295 
as_maö
->
rssi_avg
 = 
maö_rssi_avg
;

296 
as_Æt
->
rssi_avg
 = 
Æt_rssi_avg
;

297 
	}
}

299 
ssize_t
 
	$ªad_fûe_™ã¬a_divîsôy
(
fûe
 *file,

300 
__u£r
 *
u£r_buf
,

301 
size_t
 
cou¡
, 
loff_t
 *
µos
)

303 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

304 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

305 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

306 
©h_™ã¬a_°©s
 *
as_maö
 = &
sc
->
debug
.
°©s
.
™t_°©s
[
ANT_MAIN
];

307 
©h_™ã¬a_°©s
 *
as_Æt
 = &
sc
->
debug
.
°©s
.
™t_°©s
[
ANT_ALT
];

308 
©h_hw_™tcomb_c⁄f
 
div_™t_c⁄f
;

309 
Àn
 = 0;

310 c⁄° 
size
 = 1024;

311 
ssize_t
 
ªtvÆ
 = 0;

312 *
buf
;

313 c⁄° *
 a_c⁄f_°r
[4] = {

317 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

318 i‡(
buf
 =
NULL
)

319  -
ENOMEM
;

321 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
)) {

322 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%s\n",

324 
exô
;

327 
	`©h9k_ps_wakeup
(
sc
);

328 
	`©h9k_hw_™tdiv_comb_c⁄f_gë
(
ah
, &
div_™t_c⁄f
);

329 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Current MAIN config : %s\n",

330 
 a_c⁄f_°r
[
div_™t_c⁄f
.
maö_ a_c⁄f
]);

331 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Current ALT config : %s\n",

332 
 a_c⁄f_°r
[
div_™t_c⁄f
.
Æt_ a_c⁄f
]);

333 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Average MAIN RSSI : %d\n",

334 
as_maö
->
rssi_avg
);

335 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Average ALT RSSI : %d\n\n",

336 
as_Æt
->
rssi_avg
);

337 
	`©h9k_ps_ª°‹e
(
sc
);

339 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Packet Receive Cnt:\n");

340 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "-------------------\n");

342 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%30s%15s\n",

344 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

346 
as_maö
->
ªcv_˙t
,

347 
as_Æt
->
ªcv_˙t
);

348 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

350 
as_maö
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1
],

351 
as_Æt
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1
]);

352 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

354 
as_maö
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA2
],

355 
as_Æt
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA2
]);

356 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

358 
as_maö
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
],

359 
as_Æt
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
]);

360 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

362 
as_maö
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
],

363 
as_Æt
->
 a_ªcv_˙t
[
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
]);

365 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "\nLNA Config Attempts:\n");

366 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "--------------------\n");

368 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%30s%15s\n",

370 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

372 
as_maö
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1
],

373 
as_Æt
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1
]);

374 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

376 
as_maö
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA2
],

377 
as_Æt
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA2
]);

378 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

380 
as_maö
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
],

381 
as_Æt
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
]);

382 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%-14s:%15d%15d\n",

384 
as_maö
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
],

385 
as_Æt
->
 a_©ãm±_˙t
[
ATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
]);

387 
exô
:

388 i‡(
Àn
 > 
size
)

389 
Àn
 = 
size
;

391 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

392 
	`k‰ì
(
buf
);

394  
ªtvÆ
;

395 
	}
}

397 c⁄° 
fûe_›î©i⁄s
 
	gf›s_™ã¬a_divîsôy
 = {

398 .
ªad
 = 
ªad_fûe_™ã¬a_divîsôy
,

399 .
	g›í
 = 
sim∂e_›í
,

400 .
	gow√r
 = 
THIS_MODULE
,

401 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

404 
	$ªad_fûe_dma
(
£q_fûe
 *
fûe
, *
d©a
)

406 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

407 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

408 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

409 
u32
 
vÆ
[
ATH9K_NUM_DMA_DEBUG_REGS
];

410 
i
, 
qcuOff£t
 = 0, 
dcuOff£t
 = 0;

411 
u32
 *
qcuBa£
 = &
vÆ
[0], *
dcuBa£
 = &val[4];

413 
	`©h9k_ps_wakeup
(
sc
);

415 
	`REG_WRITE_D
(
ah
, 
AR_MACMISC
,

416 ((
AR_MACMISC_DMA_OBS_LINE_8
 << 
AR_MACMISC_DMA_OBS_S
) |

417 (
AR_MACMISC_MISC_OBS_BUS_1
 <<

418 
AR_MACMISC_MISC_OBS_BUS_MSB_S
)));

420 
	`£q_puts
(
fûe
, "Raw DMA Debug values:\n");

422 
i
 = 0; i < 
ATH9K_NUM_DMA_DEBUG_REGS
; i++) {

423 i‡(
i
 % 4 == 0)

424 
	`£q_puts
(
fûe
, "\n");

426 
vÆ
[
i
] = 
	`REG_READ_D
(
ah
, 
AR_DMADBG_0
 + (ò* (
u32
)));

427 
	`£q_¥ötf
(
fûe
, "%d: %08x ", 
i
, 
vÆ
[i]);

430 
	`£q_puts
(
fûe
, "\n\n");

431 
	`£q_puts
(
fûe
, "Num QCU: chain_st fsp_ok fsp_st DCU: chain_st\n");

433 
i
 = 0; i < 
ATH9K_NUM_QUEUES
; i++, 
qcuOff£t
 +4, 
dcuOff£t
 += 5) {

434 i‡(
i
 == 8) {

435 
qcuOff£t
 = 0;

436 
qcuBa£
++;

439 i‡(
i
 == 6) {

440 
dcuOff£t
 = 0;

441 
dcuBa£
++;

444 
	`£q_¥ötf
(
fûe
, "%2d %2x %1x %2x %2x\n",

445 
i
, (*
qcuBa£
 & (0x7 << 
qcuOff£t
)) >> qcuOffset,

446 (*
qcuBa£
 & (0x8 << 
qcuOff£t
)) >> (qcuOffset + 3),

447 (
vÆ
[2] & (0x7 << (
i
 * 3))) >> (i * 3),

448 (*
dcuBa£
 & (0x1‡<< 
dcuOff£t
)) >> dcuOffset);

451 
	`£q_puts
(
fûe
, "\n");

453 
	`£q_¥ötf
(
fûe
, "qcu_stitch state: %2x qcu_fetch state: %2x\n",

454 (
vÆ
[3] & 0x003c0000) >> 18, (val[3] & 0x03c00000) >> 22);

455 
	`£q_¥ötf
(
fûe
, "qcu_complete state: %2x dcu_complete state: %2x\n",

456 (
vÆ
[3] & 0x1c000000) >> 26, (val[6] & 0x3));

457 
	`£q_¥ötf
(
fûe
, "dcu_arb state: %2x dcu_fp state: %2x\n",

458 (
vÆ
[5] & 0x06000000) >> 25, (val[5] & 0x38000000) >> 27);

459 
	`£q_¥ötf
(
fûe
, "chan_idle_dur: %3d chan_idle_dur_valid: %1d\n",

460 (
vÆ
[6] & 0x000003fc) >> 2, (val[6] & 0x00000400) >> 10);

461 
	`£q_¥ötf
(
fûe
, "txfifo_valid_0: %1dÅxfifo_valid_1: %1d\n",

462 (
vÆ
[6] & 0x00000800) >> 11, (val[6] & 0x00001000) >> 12);

463 
	`£q_¥ötf
(
fûe
, "txfifo_dcu_num_0: %2dÅxfifo_dcu_num_1: %2d\n",

464 (
vÆ
[6] & 0x0001e000) >> 13, (val[6] & 0x001e0000) >> 17);

466 
	`£q_¥ötf
(
fûe
, "pcu ob£rve: 0x%x\n", 
	`REG_READ_D
(
ah
, 
AR_OBS_BUS_1
));

467 
	`£q_¥ötf
(
fûe
, "AR_CR: 0x%x\n", 
	`REG_READ_D
(
ah
, 
AR_CR
));

469 
	`©h9k_ps_ª°‹e
(
sc
);

472 
	}
}

474 
	$©h_debug_°©_öãºu±
(
©h_so·c
 *
sc
, 
©h9k_öt
 
°©us
)

476 i‡(
°©us
)

477 
sc
->
debug
.
°©s
.
i°©s
.
tŸÆ
++;

478 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

479 i‡(
°©us
 & 
ATH9K_INT_RXLP
)

480 
sc
->
debug
.
°©s
.
i°©s
.
rxÕ
++;

481 i‡(
°©us
 & 
ATH9K_INT_RXHP
)

482 
sc
->
debug
.
°©s
.
i°©s
.
rxhp
++;

483 i‡(
°©us
 & 
ATH9K_INT_BB_WATCHDOG
)

484 
sc
->
debug
.
°©s
.
i°©s
.
bb_w©chdog
++;

486 i‡(
°©us
 & 
ATH9K_INT_RX
)

487 
sc
->
debug
.
°©s
.
i°©s
.
rxok
++;

489 i‡(
°©us
 & 
ATH9K_INT_RXEOL
)

490 
sc
->
debug
.
°©s
.
i°©s
.
rxeﬁ
++;

491 i‡(
°©us
 & 
ATH9K_INT_RXORN
)

492 
sc
->
debug
.
°©s
.
i°©s
.
rx‹n
++;

493 i‡(
°©us
 & 
ATH9K_INT_TX
)

494 
sc
->
debug
.
°©s
.
i°©s
.
txok
++;

495 i‡(
°©us
 & 
ATH9K_INT_TXURN
)

496 
sc
->
debug
.
°©s
.
i°©s
.
txu∫
++;

497 i‡(
°©us
 & 
ATH9K_INT_RXPHY
)

498 
sc
->
debug
.
°©s
.
i°©s
.
rxphyîr
++;

499 i‡(
°©us
 & 
ATH9K_INT_RXKCM
)

500 
sc
->
debug
.
°©s
.
i°©s
.
rx_keyˇche_miss
++;

501 i‡(
°©us
 & 
ATH9K_INT_SWBA
)

502 
sc
->
debug
.
°©s
.
i°©s
.
swba
++;

503 i‡(
°©us
 & 
ATH9K_INT_BMISS
)

504 
sc
->
debug
.
°©s
.
i°©s
.
bmiss
++;

505 i‡(
°©us
 & 
ATH9K_INT_BNR
)

506 
sc
->
debug
.
°©s
.
i°©s
.
bƒ
++;

507 i‡(
°©us
 & 
ATH9K_INT_CST
)

508 
sc
->
debug
.
°©s
.
i°©s
.
c°
++;

509 i‡(
°©us
 & 
ATH9K_INT_GTT
)

510 
sc
->
debug
.
°©s
.
i°©s
.
gâ
++;

511 i‡(
°©us
 & 
ATH9K_INT_TIM
)

512 
sc
->
debug
.
°©s
.
i°©s
.
tim
++;

513 i‡(
°©us
 & 
ATH9K_INT_CABEND
)

514 
sc
->
debug
.
°©s
.
i°©s
.
ˇbíd
++;

515 i‡(
°©us
 & 
ATH9K_INT_DTIMSYNC
)

516 
sc
->
debug
.
°©s
.
i°©s
.
dtimsync
++;

517 i‡(
°©us
 & 
ATH9K_INT_DTIM
)

518 
sc
->
debug
.
°©s
.
i°©s
.
dtim
++;

519 i‡(
°©us
 & 
ATH9K_INT_TSFOOR
)

520 
sc
->
debug
.
°©s
.
i°©s
.
tsfo‹
++;

521 i‡(
°©us
 & 
ATH9K_INT_MCI
)

522 
sc
->
debug
.
°©s
.
i°©s
.
mci
++;

523 i‡(
°©us
 & 
ATH9K_INT_GENTIMER
)

524 
sc
->
debug
.
°©s
.
i°©s
.
gí_timî
++;

525 
	}
}

527 
	$ªad_fûe_öãºu±
(
£q_fûe
 *
fûe
, *
d©a
)

529 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

530 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

532 
	#PR_IS
(
a
, 
s
) \

534 
	`£q_¥ötf
(
fûe
, "%21s: %10u\n", 
a
, \

535 
sc
->
debug
.
°©s
.
i°©s
.
s
); \

536 } 0)

	)

538 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

539 
	`PR_IS
("RXLP", 
rxÕ
);

540 
	`PR_IS
("RXHP", 
rxhp
);

541 
	`PR_IS
("WATHDOG", 
bb_w©chdog
);

543 
	`PR_IS
("RX", 
rxok
);

545 
	`PR_IS
("RXEOL", 
rxeﬁ
);

546 
	`PR_IS
("RXORN", 
rx‹n
);

547 
	`PR_IS
("TX", 
txok
);

548 
	`PR_IS
("TXURN", 
txu∫
);

549 
	`PR_IS
("MIB", 
mib
);

550 
	`PR_IS
("RXPHY", 
rxphyîr
);

551 
	`PR_IS
("RXKCM", 
rx_keyˇche_miss
);

552 
	`PR_IS
("SWBA", 
swba
);

553 
	`PR_IS
("BMISS", 
bmiss
);

554 
	`PR_IS
("BNR", 
bƒ
);

555 
	`PR_IS
("CST", 
c°
);

556 
	`PR_IS
("GTT", 
gâ
);

557 
	`PR_IS
("TIM", 
tim
);

558 
	`PR_IS
("CABEND", 
ˇbíd
);

559 
	`PR_IS
("DTIMSYNC", 
dtimsync
);

560 
	`PR_IS
("DTIM", 
dtim
);

561 
	`PR_IS
("TSFOOR", 
tsfo‹
);

562 
	`PR_IS
("MCI", 
mci
);

563 
	`PR_IS
("GENTIMER", 
gí_timî
);

564 
	`PR_IS
("TOTAL", 
tŸÆ
);

566 
	`£q_puts
(
fûe
, "SYNC_CAUSE stats:\n");

568 
	`PR_IS
("Sync-AŒ", 
sync_ˇu£_Æl
);

569 
	`PR_IS
("RTC-IRQ", 
sync_πc_úq
);

570 
	`PR_IS
("MAC-IRQ", 
sync_mac_úq
);

571 
	`PR_IS
("EEPROM-IŒegÆ-Ac˚ss", 
ì¥om_ûÀgÆ_ac˚ss
);

572 
	`PR_IS
("APB-Timeout", 
≠b_timeout
);

573 
	`PR_IS
("PCI-Mode-C⁄Êi˘", 
pci_mode_c⁄Êi˘
);

574 
	`PR_IS
("HOST1-F©Æ", 
ho°1_Áèl
);

575 
	`PR_IS
("HOST1-Pîr", 
ho°1_≥º
);

576 
	`PR_IS
("TRCV-FIFO-Pîr", 
åcv_fifo_≥º
);

577 
	`PR_IS
("RADM-CPL-EP", 
ødm_˝l_ï
);

578 
	`PR_IS
("RADM-CPL-DLLP-Ab‹t", 
ødm_˝l_dŒp_ab‹t
);

579 
	`PR_IS
("RADM-CPL-TLP-Ab‹t", 
ødm_˝l_ép_ab‹t
);

580 
	`PR_IS
("RADM-CPL-ECRC-Eº", 
ødm_˝l_e¸c_îr
);

581 
	`PR_IS
("RADM-CPL-Timeout", 
ødm_˝l_timeout
);

582 
	`PR_IS
("Loˇl-Bus-Timeout", 
loˇl_timeout
);

583 
	`PR_IS
("PM-Ac˚ss", 
pm_ac˚ss
);

584 
	`PR_IS
("MAC-Awake", 
mac_awake
);

585 
	`PR_IS
("MAC-A¶ìp", 
mac_a¶ìp
);

586 
	`PR_IS
("MAC-SÀï-Ac˚ss", 
mac_¶ìp_ac˚ss
);

589 
	}
}

591 
	$ªad_fûe_xmô
(
£q_fûe
 *
fûe
, *
d©a
)

593 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

594 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

596 
	`£q_¥ötf
(
fûe
, "%30s %10s%10s%10s\n\n", "BE", "BK", "VI", "VO");

598 
	`PR
("MPDU†Queued: ", 
queued
);

599 
	`PR
("MPDU†Com∂ëed: ", 
com∂ëed
);

600 
	`PR
("MPDU†XRërõd: ", 
xªåõs
);

601 
	`PR
("Aggªg©es: ", 
a_aggr
);

602 
	`PR
("AMPDU†Queued HW:", 
a_queued_hw
);

603 
	`PR
("AMPDU†Queued SW:", 
a_queued_sw
);

604 
	`PR
("AMPDU†Com∂ëed:", 
a_com∂ëed
);

605 
	`PR
("AMPDU†Rërõd: ", 
a_ªåõs
);

606 
	`PR
("AMPDU†XRërõd: ", 
a_xªåõs
);

607 
	`PR
("TXERR Fûãªd: ", 
txîr_fûãªd
);

608 
	`PR
("FIFO Undîrun: ", 
fifo_undîrun
);

609 
	`PR
("TXOP Ex˚eded: ", 
xtx›
);

610 
	`PR
("TXTIMER Expúy: ", 
timî_exp
);

611 
	`PR
("DESC CFG Eº‹: ", 
desc_cfg_îr
);

612 
	`PR
("DATA Undîrun: ", 
d©a_undîrun
);

613 
	`PR
("DELIM Undîrun: ", 
dñim_undîrun
);

614 
	`PR
("TX-Pkts-AŒ: ", 
tx_pkts_Æl
);

615 
	`PR
("TX-Byãs-AŒ: ", 
tx_byãs_Æl
);

616 
	`PR
("HW-put-tx-buf: ", 
puâxbuf
);

617 
	`PR
("HW-tx-°¨t: ", 
tx°¨t
);

618 
	`PR
("HW-tx-¥oc-desc: ", 
tx¥ocdesc
);

619 
	`PR
("TX-Faûed: ", 
txÁûed
);

622 
	}
}

624 
	$¥öt_queue
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

625 
£q_fûe
 *
fûe
)

627 
	`©h_txq_lock
(
sc
, 
txq
);

629 
	`£q_¥ötf
(
fûe
, "%s: %d ", "qnum", 
txq
->
axq_qnum
);

630 
	`£q_¥ötf
(
fûe
, "%s: %2d ", "qdïth", 
txq
->
axq_dïth
);

631 
	`£q_¥ötf
(
fûe
, "%s: %2d ", "ampdu-dïth", 
txq
->
axq_ampdu_dïth
);

632 
	`£q_¥ötf
(
fûe
, "%s: %3d ", "≥ndög", 
txq
->
≥ndög_‰ames
);

633 
	`£q_¥ötf
(
fûe
, "%s: %d\n", "°›≥d", 
txq
->
°›≥d
);

635 
	`©h_txq_u∆ock
(
sc
, 
txq
);

636 
	}
}

638 
	$ªad_fûe_queues
(
£q_fûe
 *
fûe
, *
d©a
)

640 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

641 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

642 
©h_txq
 *
txq
;

643 
i
;

644 c⁄° *
q«me
[4] = {

648 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

649 
txq
 = 
sc
->
tx
.
txq_m≠
[
i
];

650 
	`£q_¥ötf
(
fûe
, "(%s): ", 
q«me
[
i
]);

651 
	`¥öt_queue
(
sc
, 
txq
, 
fûe
);

654 
	`£q_puts
(
fûe
, "(CAB): ");

655 
	`¥öt_queue
(
sc
, sc->
bóc⁄
.
ˇbq
, 
fûe
);

658 
	}
}

660 
	$ªad_fûe_misc
(
£q_fûe
 *
fûe
, *
d©a
)

662 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

663 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

664 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

665 
©h9k_vif_ôî_d©a
 
ôî_d©a
;

666 
©h_ch™˘x
 *
˘x
;

667 
ªg
;

668 
u32
 
rxfûãr
, 
i
;

670 
	`£q_¥ötf
(
fûe
, "BSSID: %pM\n", 
comm⁄
->
curbssid
);

671 
	`£q_¥ötf
(
fûe
, "BSSID-MASK: %pM\n", 
comm⁄
->
bssidmask
);

672 
	`£q_¥ötf
(
fûe
, "OPMODE: %s\n",

673 
	`©h_›mode_to_°rög
(
sc
->
sc_ah
->
›mode
));

675 
	`©h9k_ps_wakeup
(
sc
);

676 
rxfûãr
 = 
	`©h9k_hw_gërxfûãr
(
sc
->
sc_ah
);

677 
	`©h9k_ps_ª°‹e
(
sc
);

679 
	`£q_¥ötf
(
fûe
, "RXFILTER: 0x%x", 
rxfûãr
);

681 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_UCAST
)

682 
	`£q_puts
(
fûe
, " UCAST");

683 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_MCAST
)

684 
	`£q_puts
(
fûe
, " MCAST");

685 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_BCAST
)

686 
	`£q_puts
(
fûe
, " BCAST");

687 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_CONTROL
)

688 
	`£q_puts
(
fûe
, " CONTROL");

689 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_BEACON
)

690 
	`£q_puts
(
fûe
, " BEACON");

691 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_PROM
)

692 
	`£q_puts
(
fûe
, " PROM");

693 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_PROBEREQ
)

694 
	`£q_puts
(
fûe
, " PROBEREQ");

695 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_PHYERR
)

696 
	`£q_puts
(
fûe
, " PHYERR");

697 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_MYBEACON
)

698 
	`£q_puts
(
fûe
, " MYBEACON");

699 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_COMP_BAR
)

700 
	`£q_puts
(
fûe
, " COMP_BAR");

701 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_PSPOLL
)

702 
	`£q_puts
(
fûe
, " PSPOLL");

703 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_PHYRADAR
)

704 
	`£q_puts
(
fûe
, " PHYRADAR");

705 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_MCAST_BCAST_ALL
)

706 
	`£q_puts
(
fûe
, " MCAST_BCAST_ALL");

707 i‡(
rxfûãr
 & 
ATH9K_RX_FILTER_CONTROL_WRAPPER
)

708 
	`£q_puts
(
fûe
, " CONTROL_WRAPPER");

710 
	`£q_puts
(
fûe
, "\n");

712 
ªg
 = 
sc
->
sc_ah
->
imask
;

714 
	`£q_¥ötf
(
fûe
, "INTERRUPT-MASK: 0x%x", 
ªg
);

716 i‡(
ªg
 & 
ATH9K_INT_SWBA
)

717 
	`£q_puts
(
fûe
, " SWBA");

718 i‡(
ªg
 & 
ATH9K_INT_BMISS
)

719 
	`£q_puts
(
fûe
, " BMISS");

720 i‡(
ªg
 & 
ATH9K_INT_CST
)

721 
	`£q_puts
(
fûe
, " CST");

722 i‡(
ªg
 & 
ATH9K_INT_RX
)

723 
	`£q_puts
(
fûe
, " RX");

724 i‡(
ªg
 & 
ATH9K_INT_RXHP
)

725 
	`£q_puts
(
fûe
, " RXHP");

726 i‡(
ªg
 & 
ATH9K_INT_RXLP
)

727 
	`£q_puts
(
fûe
, " RXLP");

728 i‡(
ªg
 & 
ATH9K_INT_BB_WATCHDOG
)

729 
	`£q_puts
(
fûe
, " BB_WATCHDOG");

731 
	`£q_puts
(
fûe
, "\n");

733 
i
 = 0;

734 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
) {

735 i‡(
	`li°_em±y
(&
˘x
->
vifs
))

737 
	`©h9k_ˇlcuœã_ôî_d©a
(
sc
, 
˘x
, &
ôî_d©a
);

739 
	`£q_¥ötf
(
fûe
,

741 
i
++, ()(
˘x
->
assig√d
), 
ôî_d©a
.
«ps
,

742 
ôî_d©a
.
n°©i⁄s
,

743 
ôî_d©a
.
nmeshes
, iãr_d©a.
nwds
);

744 
	`£q_¥ötf
(
fûe
, " ADHOC: %i OCB: %i TOTAL: %hi BEACON-VIF: %hi\n",

745 
ôî_d©a
.
«dhocs
, iãr_d©a.
nocbs
, 
sc
->
cur_ch™
->
nvifs
,

746 
sc
->
nb˙vifs
);

750 
	}
}

752 
	$ªad_fûe_ª£t
(
£q_fûe
 *
fûe
, *
d©a
)

754 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

755 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

756 c⁄° * c⁄° 
ª£t_ˇu£
[
__RESET_TYPE_MAX
] = {

757 [
RESET_TYPE_BB_HANG
] = "Baseband Hang",

758 [
RESET_TYPE_BB_WATCHDOG
] = "Baseband Watchdog",

759 [
RESET_TYPE_FATAL_INT
] = "Fatal HW Error",

760 [
RESET_TYPE_TX_ERROR
] = "TX HWÉrror",

761 [
RESET_TYPE_TX_GTT
] = "TransmitÅimeout",

762 [
RESET_TYPE_TX_HANG
] = "TX Path Hang",

763 [
RESET_TYPE_PLL_HANG
] = "PLL RX Hang",

764 [
RESET_TYPE_MAC_HANG
] = "MAC Hang",

765 [
RESET_TYPE_BEACON_STUCK
] = "Stuck Beacon",

766 [
RESET_TYPE_MCI
] = "MCI Reset",

767 [
RESET_TYPE_CALIBRATION
] = "CalibrationÉrror",

768 [
RESET_TX_DMA_ERROR
] = "Tx DMA stopÉrror",

769 [
RESET_RX_DMA_ERROR
] = "Rx DMA stopÉrror",

771 
i
;

773 
i
 = 0; i < 
	`ARRAY_SIZE
(
ª£t_ˇu£
); i++) {

774 i‡(!
ª£t_ˇu£
[
i
])

777 
	`£q_¥ötf
(
fûe
, "%17s: %2d\n", 
ª£t_ˇu£
[
i
],

778 
sc
->
debug
.
°©s
.
ª£t
[
i
]);

782 
	}
}

784 
	$©h_debug_°©_tx
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

785 
©h_tx_°©us
 *
ts
, 
©h_txq
 *
txq
,

786 
Êags
)

788 
qnum
 = 
txq
->
axq_qnum
;

790 
	`TX_STAT_INC
(
qnum
, 
tx_pkts_Æl
);

791 
sc
->
debug
.
°©s
.
tx°©s
[
qnum
].
tx_byãs_Æl
 +
bf
->
bf_mpdu
->
Àn
;

793 i‡(
	`bf_ißmpdu
(
bf
)) {

794 i‡(
Êags
 & 
ATH_TX_ERROR
)

795 
	`TX_STAT_INC
(
qnum
, 
a_xªåõs
);

797 
	`TX_STAT_INC
(
qnum
, 
a_com∂ëed
);

799 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_XRETRY
)

800 
	`TX_STAT_INC
(
qnum
, 
xªåõs
);

802 
	`TX_STAT_INC
(
qnum
, 
com∂ëed
);

805 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_FILT
)

806 
	`TX_STAT_INC
(
qnum
, 
txîr_fûãªd
);

807 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_FIFO
)

808 
	`TX_STAT_INC
(
qnum
, 
fifo_undîrun
);

809 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_XTXOP
)

810 
	`TX_STAT_INC
(
qnum
, 
xtx›
);

811 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_TIMER_EXPIRED
)

812 
	`TX_STAT_INC
(
qnum
, 
timî_exp
);

813 i‡(
ts
->
ts_Êags
 & 
ATH9K_TX_DESC_CFG_ERR
)

814 
	`TX_STAT_INC
(
qnum
, 
desc_cfg_îr
);

815 i‡(
ts
->
ts_Êags
 & 
ATH9K_TX_DATA_UNDERRUN
)

816 
	`TX_STAT_INC
(
qnum
, 
d©a_undîrun
);

817 i‡(
ts
->
ts_Êags
 & 
ATH9K_TX_DELIM_UNDERRUN
)

818 
	`TX_STAT_INC
(
qnum
, 
dñim_undîrun
);

819 
	}
}

821 
	$©h_debug_°©_rx
(
©h_so·c
 *
sc
, 
©h_rx_°©us
 *
rs
)

823 
	`©h9k_cmn_debug_°©_rx
(&
sc
->
debug
.
°©s
.
rx°©s
, 
rs
);

824 
	}
}

826 
ssize_t
 
	$ªad_fûe_ªgidx
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

827 
size_t
 
cou¡
, 
loff_t
 *
µos
)

829 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

830 
buf
[32];

831 
Àn
;

833 
Àn
 = 
	`•rötf
(
buf
, "0x%08x\n", 
sc
->
debug
.
ªgidx
);

834  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

835 
	}
}

837 
ssize_t
 
	$wrôe_fûe_ªgidx
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

838 
size_t
 
cou¡
, 
loff_t
 *
µos
)

840 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

841 
ªgidx
;

842 
buf
[32];

843 
ssize_t
 
Àn
;

845 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

846 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

847  -
EFAULT
;

849 
buf
[
Àn
] = '\0';

850 i‡(
	`k°πoul
(
buf
, 0, &
ªgidx
))

851  -
EINVAL
;

853 
sc
->
debug
.
ªgidx
 =Ñegidx;

854  
cou¡
;

855 
	}
}

857 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªgidx
 = {

858 .
ªad
 = 
ªad_fûe_ªgidx
,

859 .
	gwrôe
 = 
wrôe_fûe_ªgidx
,

860 .
	g›í
 = 
sim∂e_›í
,

861 .
	gow√r
 = 
THIS_MODULE
,

862 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

865 
ssize_t
 
	$ªad_fûe_ªgvÆ
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

866 
size_t
 
cou¡
, 
loff_t
 *
µos
)

868 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

869 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

870 
buf
[32];

871 
Àn
;

872 
u32
 
ªgvÆ
;

874 
	`©h9k_ps_wakeup
(
sc
);

875 
ªgvÆ
 = 
	`REG_READ_D
(
ah
, 
sc
->
debug
.
ªgidx
);

876 
	`©h9k_ps_ª°‹e
(
sc
);

877 
Àn
 = 
	`•rötf
(
buf
, "0x%08x\n", 
ªgvÆ
);

878  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

879 
	}
}

881 
ssize_t
 
	$wrôe_fûe_ªgvÆ
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

882 
size_t
 
cou¡
, 
loff_t
 *
µos
)

884 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

885 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

886 
ªgvÆ
;

887 
buf
[32];

888 
ssize_t
 
Àn
;

890 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

891 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

892  -
EFAULT
;

894 
buf
[
Àn
] = '\0';

895 i‡(
	`k°πoul
(
buf
, 0, &
ªgvÆ
))

896  -
EINVAL
;

898 
	`©h9k_ps_wakeup
(
sc
);

899 
	`REG_WRITE_D
(
ah
, 
sc
->
debug
.
ªgidx
, 
ªgvÆ
);

900 
	`©h9k_ps_ª°‹e
(
sc
);

901  
cou¡
;

902 
	}
}

904 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªgvÆ
 = {

905 .
ªad
 = 
ªad_fûe_ªgvÆ
,

906 .
	gwrôe
 = 
wrôe_fûe_ªgvÆ
,

907 .
	g›í
 = 
sim∂e_›í
,

908 .
	gow√r
 = 
THIS_MODULE
,

909 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

912 
	#REGDUMP_LINE_SIZE
 20

	)

914 
	$›í_fûe_ªgdump
(
öode
 *öode, 
fûe
 *file)

916 
©h_so·c
 *
sc
 = 
öode
->
i_¥iv©e
;

917 
Àn
 = 0;

918 
u8
 *
buf
;

919 
i
;

920 
num_ªgs
, 
ªgdump_Àn
, 
max_ªg_off£t
;

922 
max_ªg_off£t
 = 
	`AR_SREV_9300_20_OR_LATER
(
sc
->
sc_ah
) ? 0x16bd4 : 0xb500;

923 
num_ªgs
 = 
max_ªg_off£t
 / 4 + 1;

924 
ªgdump_Àn
 = 
num_ªgs
 * 
REGDUMP_LINE_SIZE
 + 1;

925 
buf
 = 
	`vmÆloc
(
ªgdump_Àn
);

926 i‡(!
buf
)

927  -
ENOMEM
;

929 
	`©h9k_ps_wakeup
(
sc
);

930 
i
 = 0; i < 
num_ªgs
; i++)

931 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
ªgdump_Àn
 -Üen,

932 "0x%06x 0x%08x\n", 
i
 << 2, 
	`REG_READ
(
sc
->
sc_ah
, i << 2));

933 
	`©h9k_ps_ª°‹e
(
sc
);

935 
fûe
->
¥iv©e_d©a
 = 
buf
;

938 
	}
}

940 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªgdump
 = {

941 .
›í
 = 
›í_fûe_ªgdump
,

942 .
	gªad
 = 
©h9k_debugfs_ªad_buf
,

943 .
	gªÀa£
 = 
©h9k_debugfs_ªÀa£_buf
,

944 .
	gow√r
 = 
THIS_MODULE
,

945 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

948 
	$ªad_fûe_dump_nfˇl
(
£q_fûe
 *
fûe
, *
d©a
)

950 
õì80211_hw
 *
hw
 = 
	`dev_gë_drvd©a
(
fûe
->
¥iv©e
);

951 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

952 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

953 
©h9k_nfˇl_hi°
 *
h
 = 
sc
->
cur_ch™
->
ˇld©a
.
nfCÆHi°
;

954 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

955 
õì80211_c⁄f
 *
c⁄f
 = &
comm⁄
->
hw
->conf;

956 
u32
 
i
, 
j
;

957 
u8
 
chaömask
 = (
ah
->
rxchaömask
 << 3) |áh->rxchainmask;

958 
u8
 
ƒód
;

960 
	`£q_¥ötf
(
fûe
, "Ch™√»Noi£ Flo‹ : %d\n", 
ah
->
noi£
);

961 
	`£q_puts
(
fûe
, "Chain |ÖrivNF | # Readings | NF Readings\n");

962 
i
 = 0; i < 
NUM_NF_READINGS
; i++) {

963 i‡(!(
chaömask
 & (1 << 
i
)) ||

964 ((
i
 >
AR5416_MAX_CHAINS
Ë&& !
	`c⁄f_is_ht40
(
c⁄f
)))

967 
ƒód
 = 
AR_PHY_CCA_FILTERWINDOW_LENGTH
 - 
h
[
i
].
övÆidNFcou¡
;

968 
	`£q_¥ötf
(
fûe
, " %d\à%d\à%d\t\t", 
i
, 
h
[i].
¥ivNF
, 
ƒód
);

969 
j
 = 0; j < 
ƒód
; j++)

970 
	`£q_¥ötf
(
fûe
, " %d", 
h
[
i
].
nfCÆBuf„r
[
j
]);

971 
	`£q_puts
(
fûe
, "\n");

975 
	}
}

977 
	$›í_fûe_dump_nfˇl
(
öode
 *öode, 
fûe
 *
f
)

979  
	`sögÀ_›í
(
f
, 
ªad_fûe_dump_nfˇl
, 
öode
->
i_¥iv©e
);

980 
	}
}

982 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dump_nfˇl
 = {

983 .
ªad
 = 
£q_ªad
,

984 .
	g›í
 = 
›í_fûe_dump_nfˇl
,

985 .
	gow√r
 = 
THIS_MODULE
,

986 .
	gŒ£ek
 = 
£q_l£ek
,

987 .
	gªÀa£
 = 
sögÀ_ªÀa£
,

990 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


991 
ssize_t
 
	$ªad_fûe_btc€x
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

992 
size_t
 
cou¡
, 
loff_t
 *
µos
)

994 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

995 
u32
 
Àn
 = 0, 
size
 = 1500;

996 *
buf
;

997 
size_t
 
ªtvÆ
;

999 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

1000 i‡(
buf
 =
NULL
)

1001  -
ENOMEM
;

1003 i‡(!
sc
->
sc_ah
->
comm⁄
.
btc€x_íabÀd
) {

1004 
Àn
 = 
	`s˙¥ötf
(
buf
, 
size
, "%s\n",

1006 
exô
;

1009 
Àn
 = 
	`©h9k_dump_btc€x
(
sc
, 
buf
, 
size
);

1010 
exô
:

1011 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1012 
	`k‰ì
(
buf
);

1014  
ªtvÆ
;

1015 
	}
}

1017 c⁄° 
fûe_›î©i⁄s
 
	gf›s_btc€x
 = {

1018 .
ªad
 = 
ªad_fûe_btc€x
,

1019 .
	g›í
 = 
sim∂e_›í
,

1020 .
	gow√r
 = 
THIS_MODULE
,

1021 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1025 #ifde‡
CPTCFG_ATH9K_DYNACK


1026 
ssize_t
 
	$ªad_fûe_ackto
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1027 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1029 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1030 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1031 
buf
[32];

1032 
Àn
;

1034 
Àn
 = 
	`•rötf
(
buf
, "%u %c\n", 
ah
->
dy«ck
.
ackto
,

1035 (
ah
->
dy«ck
.
íabÀd
) ? 'A' : 'S');

1037  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1038 
	}
}

1040 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ackto
 = {

1041 .
ªad
 = 
ªad_fûe_ackto
,

1042 .
	g›í
 = 
sim∂e_›í
,

1043 .
	gow√r
 = 
THIS_MODULE
,

1044 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1048 #ifde‡
CPTCFG_ATH9K_WOW


1050 
ssize_t
 
	$ªad_fûe_wow
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1051 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1053 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1054 
Àn
 = 0, 
size
 = 32;

1055 
ssize_t
 
ªtvÆ
;

1056 *
buf
;

1058 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

1059 i‡(!
buf
)

1060  -
ENOMEM
;

1062 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "WOW: %s\n",

1063 
sc
->
f‹˚_wow
 ? "ENABLED" : "DISABLED");

1065 i‡(
Àn
 > 
size
)

1066 
Àn
 = 
size
;

1068 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1069 
	`k‰ì
(
buf
);

1071  
ªtvÆ
;

1072 
	}
}

1074 
ssize_t
 
	$wrôe_fûe_wow
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

1075 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1077 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1078 
vÆ
;

1079 
buf
[32];

1080 
ssize_t
 
Àn
;

1082 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1083 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1084  -
EFAULT
;

1086 
buf
[
Àn
] = '\0';

1087 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

1088  -
EINVAL
;

1090 i‡(
vÆ
 != 1)

1091  -
EINVAL
;

1093 i‡(!
sc
->
f‹˚_wow
) {

1094 
sc
->
f‹˚_wow
 = 
åue
;

1095 
	`©h9k_öô_wow
(
sc
->
hw
);

1098  
cou¡
;

1099 
	}
}

1101 c⁄° 
fûe_›î©i⁄s
 
	gf›s_wow
 = {

1102 .
ªad
 = 
ªad_fûe_wow
,

1103 .
	gwrôe
 = 
wrôe_fûe_wow
,

1104 .
	g›í
 = 
sim∂e_›í
,

1105 .
	gow√r
 = 
THIS_MODULE
,

1106 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1111 
ssize_t
 
	$ªad_fûe_çc
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1112 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1114 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1115 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1116 
Àn
 = 0, 
size
 = 32;

1117 
ssize_t
 
ªtvÆ
;

1118 *
buf
;

1120 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

1121 i‡(!
buf
)

1122  -
ENOMEM
;

1124 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%s\n",

1125 
ah
->
çc_íabÀd
 ? "ENABLED" : "DISABLED");

1127 i‡(
Àn
 > 
size
)

1128 
Àn
 = 
size
;

1130 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1131 
	`k‰ì
(
buf
);

1133  
ªtvÆ
;

1134 
	}
}

1136 
ssize_t
 
	$wrôe_fûe_çc
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

1137 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1139 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1140 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1141 
vÆ
;

1142 
buf
[32];

1143 
ssize_t
 
Àn
;

1144 
boﬁ
 
çc_íabÀd
;

1146 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1147 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1148  -
EFAULT
;

1150 
buf
[
Àn
] = '\0';

1151 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

1152  -
EINVAL
;

1154 i‡(
vÆ
 < 0 || val > 1)

1155  -
EINVAL
;

1157 
çc_íabÀd
 = !!
vÆ
;

1159 i‡(
çc_íabÀd
 !
ah
->tpc_enabled) {

1160 
ah
->
çc_íabÀd
 =Åpc_enabled;

1162 
	`muãx_lock
(&
sc
->
muãx
);

1163 
	`©h9k_£t_txpowî
(
sc
, 
NULL
);

1164 
	`muãx_u∆ock
(&
sc
->
muãx
);

1167  
cou¡
;

1168 
	}
}

1170 c⁄° 
fûe_›î©i⁄s
 
	gf›s_çc
 = {

1171 .
ªad
 = 
ªad_fûe_çc
,

1172 .
	gwrôe
 = 
wrôe_fûe_çc
,

1173 .
	g›í
 = 
sim∂e_›í
,

1174 .
	gow√r
 = 
THIS_MODULE
,

1175 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1180 
	#AMKSTR
(
nm
Ë#nm "_BE", #nm "_BK", #nm "_VI", #nm "_VO"

	)

1181 c⁄° 
	g©h9k_g°rögs_°©s
[][
ETH_GSTRING_LEN
] = {

1186 
AMKSTR
(
d_tx_pkts
),

1187 
AMKSTR
(
d_tx_byãs
),

1188 
AMKSTR
(
d_tx_mpdus_queued
),

1189 
AMKSTR
(
d_tx_mpdus_com∂ëed
),

1190 
AMKSTR
(
d_tx_mpdu_xªåõs
),

1191 
AMKSTR
(
d_tx_aggªg©es
),

1192 
AMKSTR
(
d_tx_ampdus_queued_hw
),

1193 
AMKSTR
(
d_tx_ampdus_queued_sw
),

1194 
AMKSTR
(
d_tx_ampdus_com∂ëed
),

1195 
AMKSTR
(
d_tx_ampdu_ªåõs
),

1196 
AMKSTR
(
d_tx_ampdu_xªåõs
),

1197 
AMKSTR
(
d_tx_fifo_undîrun
),

1198 
AMKSTR
(
d_tx_›_ex˚eded
),

1199 
AMKSTR
(
d_tx_timî_expúy
),

1200 
AMKSTR
(
d_tx_desc_cfg_îr
),

1201 
AMKSTR
(
d_tx_d©a_undîrun
),

1202 
AMKSTR
(
d_tx_dñim_undîrun
),

1216 
	#ATH9K_SSTATS_LEN
 
	`ARRAY_SIZE
(
©h9k_g°rögs_°©s
)

	)

1218 
	$©h9k_gë_ë_°rögs
(
õì80211_hw
 *
hw
,

1219 
õì80211_vif
 *
vif
,

1220 
u32
 
s£t
, 
u8
 *
d©a
)

1222 i‡(
s£t
 =
ETH_SS_STATS
)

1223 
	`mem˝y
(
d©a
, *
©h9k_g°rögs_°©s
,

1224 (
©h9k_g°rögs_°©s
));

1225 
	}
}

1227 
	$©h9k_gë_ë_s£t_cou¡
(
õì80211_hw
 *
hw
,

1228 
õì80211_vif
 *
vif
, 
s£t
)

1230 i‡(
s£t
 =
ETH_SS_STATS
)

1231  
ATH9K_SSTATS_LEN
;

1233 
	}
}

1235 
	#AWDATA
(
ñem
) \

1237 
d©a
[
i
++] = 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BE
)].
ñem
; \

1238 
d©a
[
i
++] = 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BK
)].
ñem
; \

1239 
d©a
[
i
++] = 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VI
)].
ñem
; \

1240 
d©a
[
i
++] = 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VO
)].
ñem
; \

1241 } 0)

	)

1243 
	#AWDATA_RX
(
ñem
) \

1245 
d©a
[
i
++] = 
sc
->
debug
.
°©s
.
rx°©s
.
ñem
; \

1246 } 0)

	)

1248 
	$©h9k_gë_ë_°©s
(
õì80211_hw
 *
hw
,

1249 
õì80211_vif
 *
vif
,

1250 
ëhtoﬁ_°©s
 *
°©s
, 
u64
 *
d©a
)

1252 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1253 
i
 = 0;

1255 
d©a
[
i
++] = (
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BE
)].
tx_pkts_Æl
 +

1256 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BK
)].
tx_pkts_Æl
 +

1257 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VI
)].
tx_pkts_Æl
 +

1258 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VO
)].
tx_pkts_Æl
);

1259 
d©a
[
i
++] = (
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BE
)].
tx_byãs_Æl
 +

1260 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_BK
)].
tx_byãs_Æl
 +

1261 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VI
)].
tx_byãs_Æl
 +

1262 
sc
->
debug
.
°©s
.
tx°©s
[
	`PR_QNUM
(
IEEE80211_AC_VO
)].
tx_byãs_Æl
);

1263 
	`AWDATA_RX
(
rx_pkts_Æl
);

1264 
	`AWDATA_RX
(
rx_byãs_Æl
);

1266 
	`AWDATA
(
tx_pkts_Æl
);

1267 
	`AWDATA
(
tx_byãs_Æl
);

1268 
	`AWDATA
(
queued
);

1269 
	`AWDATA
(
com∂ëed
);

1270 
	`AWDATA
(
xªåõs
);

1271 
	`AWDATA
(
a_aggr
);

1272 
	`AWDATA
(
a_queued_hw
);

1273 
	`AWDATA
(
a_queued_sw
);

1274 
	`AWDATA
(
a_com∂ëed
);

1275 
	`AWDATA
(
a_ªåõs
);

1276 
	`AWDATA
(
a_xªåõs
);

1277 
	`AWDATA
(
fifo_undîrun
);

1278 
	`AWDATA
(
xtx›
);

1279 
	`AWDATA
(
timî_exp
);

1280 
	`AWDATA
(
desc_cfg_îr
);

1281 
	`AWDATA
(
d©a_undîrun
);

1282 
	`AWDATA
(
dñim_undîrun
);

1284 
	`AWDATA_RX
(
¸c_îr
);

1285 
	`AWDATA_RX
(
de¸y±_¸c_îr
);

1286 
	`AWDATA_RX
(
phy_îr
);

1287 
	`AWDATA_RX
(
mic_îr
);

1288 
	`AWDATA_RX
(
¥e_dñim_¸c_îr
);

1289 
	`AWDATA_RX
(
po°_dñim_¸c_îr
);

1290 
	`AWDATA_RX
(
de¸y±_busy_îr
);

1292 
	`AWDATA_RX
(
phy_îr_°©s
[
ATH9K_PHYERR_RADAR
]);

1293 
	`AWDATA_RX
(
phy_îr_°©s
[
ATH9K_PHYERR_OFDM_TIMING
]);

1294 
	`AWDATA_RX
(
phy_îr_°©s
[
ATH9K_PHYERR_CCK_TIMING
]);

1296 
	`WARN_ON
(
i
 !
ATH9K_SSTATS_LEN
);

1297 
	}
}

1299 
	$©h9k_deöô_debug
(
©h_so·c
 *
sc
)

1301 
	`©h9k_cmn_•e˘øl_deöô_debug
(&
sc
->
•ec_¥iv
);

1302 
	}
}

1304 
ssize_t
 
	$ªad_fûe_ì¥om
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1305 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1307 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1308 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1309 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1310 
byãs
 = 0;

1311 
pos
 = *
µos
;

1312 
size
 = 4096;

1313 
u16
 
vÆ
;

1314 
i
;

1316 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1317 
size
 = 16384;

1319 i‡(*
µos
 < 0)

1320  -
EINVAL
;

1322 i‡(
cou¡
 > 
size
 - *
µos
)

1323 
cou¡
 = 
size
 - *
µos
;

1325 
i
 = *
µos
 / 2; 
cou¡
 > 0; cou¡ -
byãs
, *ppos += bytes, i++) {

1326 *
‰om
 = &
vÆ
;

1328 i‡(!
comm⁄
->
bus_›s
->
	`ì¥om_ªad
(comm⁄, 
i
, &
vÆ
))

1329 
vÆ
 = 0xffff;

1331 i‡(*
µos
 % 2) {

1332 
‰om
++;

1333 
byãs
 = 1;

1334 } i‡(
cou¡
 == 1) {

1335 
byãs
 = 1;

1337 
byãs
 = 2;

1339 
	`c›y_to_u£r
(
u£r_buf
, 
‰om
, 
byãs
);

1340 
u£r_buf
 +
byãs
;

1342  *
µos
 - 
pos
;

1343 
	}
}

1345 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ì¥om
 = {

1346 .
ªad
 = 
ªad_fûe_ì¥om
,

1347 .
	g›í
 = 
sim∂e_›í
,

1348 .
	gow√r
 = 
THIS_MODULE


1352 
ssize_t
 
	$ªad_fûe_ch™_bw
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1353 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1355 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1356 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1357 
buf
[32];

1358 
Àn
;

1360 
Àn
 = 
	`•rötf
(
buf
, "0x%08x\n", 
comm⁄
->
ch™_bw
);

1361  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1362 
	}
}

1364 
ssize_t
 
	$wrôe_fûe_ch™_bw
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

1365 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1367 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1368 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1369 
ch™_bw
;

1370 
buf
[32];

1371 
ssize_t
 
Àn
;

1373 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1374 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1375  -
EFAULT
;

1377 
buf
[
Àn
] = '\0';

1378 i‡(
	`k°πoul
(
buf
, 0, &
ch™_bw
))

1379  -
EINVAL
;

1381 
comm⁄
->
ch™_bw
 = chan_bw;

1382 i‡(!
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
))

1383 
©h9k_›s
.
	`c⁄fig
(
sc
->
hw
, 
IEEE80211_CONF_CHANGE_CHANNEL
);

1385  
cou¡
;

1386 
	}
}

1388 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ch™bw
 = {

1389 .
ªad
 = 
ªad_fûe_ch™_bw
,

1390 .
	gwrôe
 = 
wrôe_fûe_ch™_bw
,

1391 .
	g›í
 = 
sim∂e_›í
,

1392 .
	gow√r
 = 
THIS_MODULE
,

1393 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1396 #ifde‡
CONFIG_MAC80211_LEDS


1398 
ssize_t
 
	$wrôe_fûe_gpio_Àd
(
fûe
 *fûe, c⁄° 
__u£r
 *
ubuf
,

1399 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1401 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1402 
buf
[32], *
°r
, *
«me
, *
c
;

1403 
ssize_t
 
Àn
;

1404 
gpio
;

1405 
boﬁ
 
a˘ive_low
 = 
Ál£
;

1407 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1408 i‡(
	`c›y_‰om_u£r
(
buf
, 
ubuf
, 
Àn
))

1409  -
EFAULT
;

1411 
buf
[
Àn
] = '\0';

1412 
«me
 = 
	`°rchr
(
buf
, ',');

1413 i‡(!
«me
)

1414  -
EINVAL
;

1416 *(
«me
++) = 0;

1417 i‡(!*
«me
)

1418  -
EINVAL
;

1420 
c
 = 
	`°rchr
(
«me
, '\n');

1421 i‡(
c
)

1422 *
c
 = 0;

1424 
°r
 = 
buf
;

1425 i‡(*
°r
 == '!') {

1426 
°r
++;

1427 
a˘ive_low
 = 
åue
;

1430 i‡(
	`k°πouöt
(
°r
, 0, &
gpio
) < 0)

1431  -
EINVAL
;

1433 i‡(
gpio
 >
sc
->
sc_ah
->
ˇps
.
num_gpio_pös
)

1434  -
EINVAL
;

1436 i‡(
	`©h_¸óã_gpio_Àd
(
sc
, 
gpio
, 
«me
, 
NULL
, 
a˘ive_low
) < 0)

1437  -
EINVAL
;

1439  
cou¡
;

1440 
	}
}

1442 c⁄° 
fûe_›î©i⁄s
 
	gf›s_gpio_Àd
 = {

1443 .
wrôe
 = 
wrôe_fûe_gpio_Àd
,

1444 .
	g›í
 = 
sim∂e_›í
,

1445 .
	gow√r
 = 
THIS_MODULE
,

1446 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1452 
ssize_t
 
	$ªad_fûe_düg
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1453 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1455 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1456 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1457 
buf
[32];

1458 
Àn
;

1460 
Àn
 = 
	`•rötf
(
buf
, "0x%08lx\n", 
ah
->
düg
);

1461  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1462 
	}
}

1464 
ssize_t
 
	$wrôe_fûe_düg
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

1465 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1467 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

1468 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1469 
düg
;

1470 
buf
[32];

1471 
ssize_t
 
Àn
;

1473 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1474 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1475  -
EFAULT
;

1477 
buf
[
Àn
] = '\0';

1478 i‡(
	`k°πoul
(
buf
, 0, &
düg
))

1479  -
EINVAL
;

1481 
ah
->
düg
 = diag;

1482 
	`©h9k_hw_upd©e_düg
(
ah
);

1484  
cou¡
;

1485 
	}
}

1487 c⁄° 
fûe_›î©i⁄s
 
	gf›s_düg
 = {

1488 .
ªad
 = 
ªad_fûe_düg
,

1489 .
	gwrôe
 = 
wrôe_fûe_düg
,

1490 .
	g›í
 = 
sim∂e_›í
,

1491 .
	gow√r
 = 
THIS_MODULE
,

1492 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1496 
	$©h9k_öô_debug
(
©h_hw
 *
ah
)

1498 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1499 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

1501 
sc
->
debug
.
debugfs_phy
 = 
	`debugfs_¸óã_dú
("ath9k",

1502 
sc
->
hw
->
wùhy
->
debugfsdú
);

1503 i‡(!
sc
->
debug
.
debugfs_phy
)

1504  -
ENOMEM
;

1506 #ifde‡
CPTCFG_ATH_DEBUG


1507 
	`debugfs_¸óã_fûe
("debug", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1508 
sc
, &
f›s_debug
);

1511 
	`©h9k_dfs_öô_debug
(
sc
);

1512 
	`©h9k_tx99_öô_debug
(
sc
);

1513 
	`©h9k_cmn_•e˘øl_öô_debug
(&
sc
->
•ec_¥iv
, sc->
debug
.
debugfs_phy
);

1515 
	`debugfs_¸óã_fûe
("ì¥om", 
S_IRUSR
, 
sc
->
debug
.
debugfs_phy
, sc,

1516 &
f›s_ì¥om
);

1517 
	`debugfs_¸óã_fûe
("ch™bw", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1518 
sc
, &
f›s_ch™bw
);

1519 #ifde‡
CONFIG_MAC80211_LEDS


1520 
	`debugfs_¸óã_fûe
("gpio_Àd", 
S_IWUSR
,

1521 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_gpio_Àd
);

1523 
	`debugfs_¸óã_fûe
("düg", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1524 
sc
, &
f›s_düg
);

1525 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "dma", sc->
debug
.
debugfs_phy
,

1526 
ªad_fûe_dma
);

1527 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "öãºu±", sc->
debug
.
debugfs_phy
,

1528 
ªad_fûe_öãºu±
);

1529 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "xmô", sc->
debug
.
debugfs_phy
,

1530 
ªad_fûe_xmô
);

1531 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "queues", sc->
debug
.
debugfs_phy
,

1532 
ªad_fûe_queues
);

1533 
	`debugfs_¸óã_u32
("qÀn_bk", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1534 &
sc
->
tx
.
txq_max_≥ndög
[
IEEE80211_AC_BK
]);

1535 
	`debugfs_¸óã_u32
("qÀn_be", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1536 &
sc
->
tx
.
txq_max_≥ndög
[
IEEE80211_AC_BE
]);

1537 
	`debugfs_¸óã_u32
("qÀn_vi", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1538 &
sc
->
tx
.
txq_max_≥ndög
[
IEEE80211_AC_VI
]);

1539 
	`debugfs_¸óã_u32
("qÀn_vo", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1540 &
sc
->
tx
.
txq_max_≥ndög
[
IEEE80211_AC_VO
]);

1541 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "misc", sc->
debug
.
debugfs_phy
,

1542 
ªad_fûe_misc
);

1543 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "ª£t", sc->
debug
.
debugfs_phy
,

1544 
ªad_fûe_ª£t
);

1546 
	`©h9k_cmn_debug_ªcv
(
sc
->
debug
.
debugfs_phy
, &sc->debug.
°©s
.
rx°©s
);

1547 
	`©h9k_cmn_debug_phy_îr
(
sc
->
debug
.
debugfs_phy
, &sc->debug.
°©s
.
rx°©s
);

1549 
	`debugfs_¸óã_u8
("rx_chaömask", 
S_IRUSR
, 
sc
->
debug
.
debugfs_phy
,

1550 &
ah
->
rxchaömask
);

1551 
	`debugfs_¸óã_u8
("tx_chaömask", 
S_IRUSR
, 
sc
->
debug
.
debugfs_phy
,

1552 &
ah
->
txchaömask
);

1553 
	`debugfs_¸óã_fûe
("™i", 
S_IRUSR
 | 
S_IWUSR
,

1554 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_™i
);

1555 
	`debugfs_¸óã_boﬁ
("∑¥d", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1556 &
sc
->
sc_ah
->
c⁄fig
.
íabÀ_∑¥d
);

1557 
	`debugfs_¸óã_fûe
("ªgidx", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1558 
sc
, &
f›s_ªgidx
);

1559 
	`debugfs_¸óã_fûe
("ªgvÆ", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1560 
sc
, &
f›s_ªgvÆ
);

1561 
	`debugfs_¸óã_boﬁ
("ign‹e_extcˇ", 
S_IRUSR
 | 
S_IWUSR
,

1562 
sc
->
debug
.
debugfs_phy
,

1563 &
ah
->
c⁄fig
.
cwm_ign‹e_extcˇ
);

1564 
	`debugfs_¸óã_fûe
("ªgdump", 
S_IRUSR
, 
sc
->
debug
.
debugfs_phy
, sc,

1565 &
f›s_ªgdump
);

1566 
	`debugfs_¸óã_devm_£qfûe
(
sc
->
dev
, "dump_nfcal",

1567 
sc
->
debug
.
debugfs_phy
,

1568 
ªad_fûe_dump_nfˇl
);

1570 
	`©h9k_cmn_debug_ba£_ì¥om
(
sc
->
debug
.
debugfs_phy
, sc->
sc_ah
);

1571 
	`©h9k_cmn_debug_modÆ_ì¥om
(
sc
->
debug
.
debugfs_phy
, sc->
sc_ah
);

1573 
	`debugfs_¸óã_u32
("gpio_mask", 
S_IRUSR
 | 
S_IWUSR
,

1574 
sc
->
debug
.
debugfs_phy
, &sc->
sc_ah
->
gpio_mask
);

1575 
	`debugfs_¸óã_u32
("gpio_vÆ", 
S_IRUSR
 | 
S_IWUSR
,

1576 
sc
->
debug
.
debugfs_phy
, &sc->
sc_ah
->
gpio_vÆ
);

1577 
	`debugfs_¸óã_fûe
("™ã¬a_divîsôy", 
S_IRUSR
,

1578 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_™ã¬a_divîsôy
);

1579 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


1580 
	`debugfs_¸óã_fûe
("bt_™t_divîsôy", 
S_IRUSR
 | 
S_IWUSR
,

1581 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_bt_™t_divîsôy
);

1582 
	`debugfs_¸óã_fûe
("btc€x", 
S_IRUSR
, 
sc
->
debug
.
debugfs_phy
, sc,

1583 &
f›s_btc€x
);

1586 #ifde‡
CPTCFG_ATH9K_WOW


1587 
	`debugfs_¸óã_fûe
("wow", 
S_IRUSR
 | 
S_IWUSR
,

1588 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_wow
);

1591 #ifde‡
CPTCFG_ATH9K_DYNACK


1592 
	`debugfs_¸óã_fûe
("ack_to", 
S_IRUSR
 | 
S_IWUSR
, 
sc
->
debug
.
debugfs_phy
,

1593 
sc
, &
f›s_ackto
);

1595 
	`debugfs_¸óã_fûe
("çc", 
S_IRUSR
 | 
S_IWUSR
,

1596 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_çc
);

1599 
	}
}

	@debug.h

17 #i‚de‡
DEBUG_H


18 
	#DEBUG_H


	)

20 
	~"hw.h
"

21 
	~"dfs_debug.h
"

23 
	g©h_txq
;

24 
	g©h_buf
;

25 
	gf·_ßm∂e_év
;

27 #ifde‡
CPTCFG_ATH9K_DEBUGFS


28 
	#TX_STAT_INC
(
q
, 
c
Ë
sc
->
debug
.
°©s
.
tx°©s
[q].c++

	)

29 
	#RX_STAT_INC
(
c
Ë(
sc
->
debug
.
°©s
.
rx°©s
.c++)

	)

30 
	#RESET_STAT_INC
(
sc
, 
ty≥
Ësc->
debug
.
°©s
.
ª£t
[ty≥]++

	)

31 
	#ANT_STAT_INC
(
i
, 
c
Ë
sc
->
debug
.
°©s
.
™t_°©s
[i].c++

	)

32 
	#ANT_LNA_INC
(
i
, 
c
Ë
sc
->
debug
.
°©s
.
™t_°©s
[i].
 a_ªcv_˙t
[c]++;

	)

34 
	#TX_STAT_INC
(
q
, 
c
Ëdÿ{ } 0)

	)

35 
	#RX_STAT_INC
(
c
)

	)

36 
	#RESET_STAT_INC
(
sc
, 
ty≥
Ëdÿ{ } 0)

	)

37 
	#ANT_STAT_INC
(
i
, 
c
Ëdÿ{ } 0)

	)

38 
	#ANT_LNA_INC
(
i
, 
c
Ëdÿ{ } 0)

	)

41 
	e©h_ª£t_ty≥
 {

42 
	mRESET_TYPE_BB_HANG
,

43 
	mRESET_TYPE_BB_WATCHDOG
,

44 
	mRESET_TYPE_FATAL_INT
,

45 
	mRESET_TYPE_TX_ERROR
,

46 
	mRESET_TYPE_TX_GTT
,

47 
	mRESET_TYPE_TX_HANG
,

48 
	mRESET_TYPE_PLL_HANG
,

49 
	mRESET_TYPE_MAC_HANG
,

50 
	mRESET_TYPE_BEACON_STUCK
,

51 
	mRESET_TYPE_MCI
,

52 
	mRESET_TYPE_CALIBRATION
,

53 
	mRESET_TX_DMA_ERROR
,

54 
	mRESET_RX_DMA_ERROR
,

55 
	m__RESET_TYPE_MAX


58 #ifde‡
CPTCFG_ATH9K_DEBUGFS


90 
	s©h_öãºu±_°©s
 {

91 
u32
 
	mtŸÆ
;

92 
u32
 
	mrxok
;

93 
u32
 
	mrxÕ
;

94 
u32
 
	mrxhp
;

95 
u32
 
	mrxeﬁ
;

96 
u32
 
	mrx‹n
;

97 
u32
 
	mtxok
;

98 
u32
 
	mtxeﬁ
;

99 
u32
 
	mtxu∫
;

100 
u32
 
	mmib
;

101 
u32
 
	mrxphyîr
;

102 
u32
 
	mrx_keyˇche_miss
;

103 
u32
 
	mswba
;

104 
u32
 
	mbmiss
;

105 
u32
 
	mbƒ
;

106 
u32
 
	mc°
;

107 
u32
 
	mgâ
;

108 
u32
 
	mtim
;

109 
u32
 
	mˇbíd
;

110 
u32
 
	mdtimsync
;

111 
u32
 
	mdtim
;

112 
u32
 
	mbb_w©chdog
;

113 
u32
 
	mtsfo‹
;

114 
u32
 
	mmci
;

115 
u32
 
	mgí_timî
;

118 
u32
 
	msync_ˇu£_Æl
;

119 
u32
 
	msync_πc_úq
;

120 
u32
 
	msync_mac_úq
;

121 
u32
 
	mì¥om_ûÀgÆ_ac˚ss
;

122 
u32
 
	m≠b_timeout
;

123 
u32
 
	mpci_mode_c⁄Êi˘
;

124 
u32
 
	mho°1_Áèl
;

125 
u32
 
	mho°1_≥º
;

126 
u32
 
	måcv_fifo_≥º
;

127 
u32
 
	mødm_˝l_ï
;

128 
u32
 
	mødm_˝l_dŒp_ab‹t
;

129 
u32
 
	mødm_˝l_ép_ab‹t
;

130 
u32
 
	mødm_˝l_e¸c_îr
;

131 
u32
 
	mødm_˝l_timeout
;

132 
u32
 
	mloˇl_timeout
;

133 
u32
 
	mpm_ac˚ss
;

134 
u32
 
	mmac_awake
;

135 
u32
 
	mmac_a¶ìp
;

136 
u32
 
	mmac_¶ìp_ac˚ss
;

169 
	s©h_tx_°©s
 {

170 
u32
 
	mtx_pkts_Æl
;

171 
u32
 
	mtx_byãs_Æl
;

172 
u32
 
	mqueued
;

173 
u32
 
	mcom∂ëed
;

174 
u32
 
	mxªåõs
;

175 
u32
 
	ma_aggr
;

176 
u32
 
	ma_queued_hw
;

177 
u32
 
	ma_queued_sw
;

178 
u32
 
	ma_com∂ëed
;

179 
u32
 
	ma_ªåõs
;

180 
u32
 
	ma_xªåõs
;

181 
u32
 
	mtxîr_fûãªd
;

182 
u32
 
	mfifo_undîrun
;

183 
u32
 
	mxtx›
;

184 
u32
 
	mtimî_exp
;

185 
u32
 
	mdesc_cfg_îr
;

186 
u32
 
	md©a_undîrun
;

187 
u32
 
	mdñim_undîrun
;

188 
u32
 
	mpuâxbuf
;

189 
u32
 
	mtx°¨t
;

190 
u32
 
	mtx¥ocdesc
;

191 
u32
 
	mtxÁûed
;

197 
	#PR_QNUM
(
_n
Ë
sc
->
tx
.
txq_m≠
[_n]->
axq_qnum


	)

198 
	#TXSTATS
 
sc
->
debug
.
°©s
.
tx°©s


	)

199 
	#PR
(
°r
, 
ñem
) \

201 
	`£q_¥ötf
(
fûe
, "%s%13u%11u%10u%10u\n", 
°r
, \

202 
TXSTATS
[
	`PR_QNUM
(
IEEE80211_AC_BE
)].
ñem
,\

203 
TXSTATS
[
	`PR_QNUM
(
IEEE80211_AC_BK
)].
ñem
,\

204 
TXSTATS
[
	`PR_QNUM
(
IEEE80211_AC_VI
)].
ñem
,\

205 
TXSTATS
[
	`PR_QNUM
(
IEEE80211_AC_VO
)].
ñem
); \

206 } 0)

	)

208 
	s©h_rx_øã_°©s
 {

210 
u32
 
	mht20_˙t
;

211 
u32
 
	mht40_˙t
;

212 
u32
 
	msgi_˙t
;

213 
u32
 
	mlgi_˙t
;

214 } 
	mht_°©s
[24];

217 
u32
 
	mofdm_˙t
;

218 } 
	mofdm_°©s
[8];

221 
u32
 
	mcck_Õ_˙t
;

222 
u32
 
	mcck_•_˙t
;

223 } 
	mcck_°©s
[4];

226 
	#ANT_MAIN
 0

	)

227 
	#ANT_ALT
 1

	)

229 
	s©h_™ã¬a_°©s
 {

230 
u32
 
	mªcv_˙t
;

231 
u32
 
	mrssi_avg
;

232 
u32
 
	m a_ªcv_˙t
[4];

233 
u32
 
	m a_©ãm±_˙t
[4];

236 
	s©h_°©s
 {

237 
©h_öãºu±_°©s
 
	mi°©s
;

238 
©h_tx_°©s
 
	mtx°©s
[
ATH9K_NUM_TX_QUEUES
];

239 
©h_rx_°©s
 
	mrx°©s
;

240 
©h_dfs_°©s
 
	mdfs_°©s
;

241 
©h_™ã¬a_°©s
 
	m™t_°©s
[2];

242 
u32
 
	mª£t
[
__RESET_TYPE_MAX
];

245 
	s©h9k_debug
 {

246 
díåy
 *
	mdebugfs_phy
;

247 
u32
 
	mªgidx
;

248 
©h_°©s
 
	m°©s
;

251 
©h9k_öô_debug
(
©h_hw
 *
ah
);

252 
©h9k_deöô_debug
(
©h_so·c
 *
sc
);

254 
©h_debug_°©_öãºu±
(
©h_so·c
 *
sc
, 
©h9k_öt
 
°©us
);

255 
©h_debug_°©_tx
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

256 
©h_tx_°©us
 *
ts
, 
©h_txq
 *
txq
,

257 
Êags
);

258 
©h_debug_°©_rx
(
©h_so·c
 *
sc
, 
©h_rx_°©us
 *
rs
);

259 
©h9k_gë_ë_s£t_cou¡
(
õì80211_hw
 *
hw
,

260 
õì80211_vif
 *
vif
, 
s£t
);

261 
©h9k_gë_ë_°©s
(
õì80211_hw
 *
hw
,

262 
õì80211_vif
 *
vif
,

263 
ëhtoﬁ_°©s
 *
°©s
, 
u64
 *
d©a
);

264 
©h9k_gë_ë_°rögs
(
õì80211_hw
 *
hw
,

265 
õì80211_vif
 *
vif
,

266 
u32
 
s£t
, 
u8
 *
d©a
);

267 
©h9k_°a_add_debugfs
(
õì80211_hw
 *
hw
,

268 
õì80211_vif
 *
vif
,

269 
õì80211_°a
 *
°a
,

270 
díåy
 *
dú
);

271 
©h9k_debug_°©_™t
(
©h_so·c
 *
sc
,

272 
©h_hw_™tcomb_c⁄f
 *
div_™t_c⁄f
,

273 
maö_rssi_avg
, 
Æt_rssi_avg
);

274 
©h9k_debug_sync_ˇu£
(
©h_so·c
 *
sc
, 
u32
 
sync_ˇu£
);

278 
ölöe
 
	$©h9k_öô_debug
(
©h_hw
 *
ah
)

281 
	}
}

283 
ölöe
 
	$©h9k_deöô_debug
(
©h_so·c
 *
sc
)

285 
	}
}

286 
ölöe
 
	$©h_debug_°©_öãºu±
(
©h_so·c
 *
sc
,

287 
©h9k_öt
 
°©us
)

289 
	}
}

290 
ölöe
 
	$©h_debug_°©_tx
(
©h_so·c
 *
sc
,

291 
©h_buf
 *
bf
,

292 
©h_tx_°©us
 *
ts
,

293 
©h_txq
 *
txq
,

294 
Êags
)

296 
	}
}

297 
ölöe
 
	$©h_debug_°©_rx
(
©h_so·c
 *
sc
,

298 
©h_rx_°©us
 *
rs
)

300 
	}
}

301 
ölöe
 
	$©h9k_debug_°©_™t
(
©h_so·c
 *
sc
,

302 
©h_hw_™tcomb_c⁄f
 *
div_™t_c⁄f
,

303 
maö_rssi_avg
, 
Æt_rssi_avg
)

306 
	}
}

308 
ölöe
 

309 
	$©h9k_debug_sync_ˇu£
(
©h_so·c
 *
sc
, 
u32
 
sync_ˇu£
)

311 
	}
}

315 #ifde‡
CPTCFG_ATH9K_STATION_STATISTICS


316 
©h_debug_øã_°©s
(
©h_so·c
 *
sc
,

317 
©h_rx_°©us
 *
rs
,

318 
sk_buff
 *
skb
);

320 
ölöe
 
	$©h_debug_øã_°©s
(
©h_so·c
 *
sc
,

321 
©h_rx_°©us
 *
rs
,

322 
sk_buff
 *
skb
)

324 
	}
}

	@debug_sta.c

17 
	~"©h9k.h
"

23 
ssize_t
 
	$ªad_fûe_node_aggr
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

24 
size_t
 
cou¡
, 
loff_t
 *
µos
)

26 
©h_node
 *
™
 = 
fûe
->
¥iv©e_d©a
;

27 
©h_so·c
 *
sc
 = 
™
->sc;

28 
©h_©x_tid
 *
tid
;

29 
©h_txq
 *
txq
;

30 
u32
 
Àn
 = 0, 
size
 = 4096;

31 *
buf
;

32 
size_t
 
ªtvÆ
;

33 
tidno
;

35 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

36 i‡(
buf
 =
NULL
)

37  -
ENOMEM
;

39 i‡(!
™
->
°a
->
ht_ˇp
.
ht_suµ‹ãd
) {

40 
Àn
 = 
	`s˙¥ötf
(
buf
, 
size
, "%s\n",

42 
exô
;

45 
Àn
 = 
	`s˙¥ötf
(
buf
, 
size
, "Max-AMPDU: %d\n",

46 
™
->
maxampdu
);

47 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "MPDU Density: %d\n\n",

48 
™
->
mpdudísôy
);

50 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

55 
tidno
 = 0, 
tid
 = &
™
->tid[tidno];

56 
tidno
 < 
IEEE80211_NUM_TIDS
;Åidno++, 
tid
++) {

57 
txq
 = 
tid
->txq;

58 
	`©h_txq_lock
(
sc
, 
txq
);

59 i‡(
tid
->
a˘ive
) {

60 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

62 
tid
->
tidno
,

63 
tid
->
£q_°¨t
,

64 
tid
->
£q_√xt
,

65 
tid
->
baw_size
,

66 
tid
->
baw_hód
,

67 
tid
->
baw_èû
,

68 
tid
->
b¨_ödex
,

69 !
	`li°_em±y
(&
tid
->
li°
));

71 
	`©h_txq_u∆ock
(
sc
, 
txq
);

73 
exô
:

74 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

75 
	`k‰ì
(
buf
);

77  
ªtvÆ
;

78 
	}
}

80 c⁄° 
fûe_›î©i⁄s
 
	gf›s_node_aggr
 = {

81 .
ªad
 = 
ªad_fûe_node_aggr
,

82 .
	g›í
 = 
sim∂e_›í
,

83 .
	gow√r
 = 
THIS_MODULE
,

84 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

91 
	$©h_debug_øã_°©s
(
©h_so·c
 *
sc
,

92 
©h_rx_°©us
 *
rs
,

93 
sk_buff
 *
skb
)

95 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*Ë
skb
->
d©a
;

96 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

97 
õì80211_rx_°©us
 *
rxs
;

98 
©h_rx_øã_°©s
 *
r°©s
;

99 
õì80211_°a
 *
°a
;

100 
©h_node
 *
™
;

102 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

105 
	`rcu_ªad_lock
();

107 
°a
 = 
	`õì80211_föd_°a_by_iÁddr
(
sc
->
hw
, 
hdr
->
addr2
, 
NULL
);

108 i‡(!
°a
)

109 
exô
;

111 
™
 = (
©h_node
 *Ë
°a
->
drv_¥iv
;

112 
r°©s
 = &
™
->
rx_øã_°©s
;

113 
rxs
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

115 i‡(
	`IS_HT_RATE
(
rs
->
rs_øã
)) {

116 i‡(
rxs
->
øã_idx
 >
	`ARRAY_SIZE
(
r°©s
->
ht_°©s
))

117 
exô
;

119 i‡(
rxs
->
Êag
 & 
RX_FLAG_40MHZ
)

120 
r°©s
->
ht_°©s
[
rxs
->
øã_idx
].
ht40_˙t
++;

122 
r°©s
->
ht_°©s
[
rxs
->
øã_idx
].
ht20_˙t
++;

124 i‡(
rxs
->
Êag
 & 
RX_FLAG_SHORT_GI
)

125 
r°©s
->
ht_°©s
[
rxs
->
øã_idx
].
sgi_˙t
++;

127 
r°©s
->
ht_°©s
[
rxs
->
øã_idx
].
lgi_˙t
++;

129 
exô
;

132 i‡(
	`IS_CCK_RATE
(
rs
->
rs_øã
)) {

133 i‡(
rxs
->
Êag
 & 
RX_FLAG_SHORTPRE
)

134 
r°©s
->
cck_°©s
[
rxs
->
øã_idx
].
cck_•_˙t
++;

136 
r°©s
->
cck_°©s
[
rxs
->
øã_idx
].
cck_Õ_˙t
++;

138 
exô
;

141 i‡(
	`IS_OFDM_RATE
(
rs
->
rs_øã
)) {

142 i‡(
ah
->
curch™
->
ch™
->
b™d
 =
IEEE80211_BAND_2GHZ
)

143 
r°©s
->
ofdm_°©s
[
rxs
->
øã_idx
 - 4].
ofdm_˙t
++;

145 
r°©s
->
ofdm_°©s
[
rxs
->
øã_idx
].
ofdm_˙t
++;

147 
exô
:

148 
	`rcu_ªad_u∆ock
();

149 
	}
}

151 
	#PRINT_CCK_RATE
(
°r
, 
i
, 
•
) \

153 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, \

155 
°r
, \

156 (
•
Ë? 
r°©s
->
cck_°©s
[
i
].
cck_•_˙t
 : \

157 
r°©s
->
cck_°©s
[
i
].
cck_Õ_˙t
); \

158 } 0)

	)

160 
	#PRINT_OFDM_RATE
(
°r
, 
i
) \

162 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, \

164 
°r
, \

165 
r°©s
->
ofdm_°©s
[
i
].
ofdm_˙t
); \

166 } 0)

	)

168 
ssize_t
 
	$ªad_fûe_node_ªcv
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

169 
size_t
 
cou¡
, 
loff_t
 *
µos
)

171 
©h_node
 *
™
 = 
fûe
->
¥iv©e_d©a
;

172 
©h_so·c
 *
sc
 = 
™
->sc;

173 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

174 
©h_rx_øã_°©s
 *
r°©s
;

175 
õì80211_°a
 *
°a
 = 
™
->sta;

176 
õì80211_b™d
 
b™d
;

177 
u32
 
Àn
 = 0, 
size
 = 4096;

178 *
buf
;

179 
size_t
 
ªtvÆ
;

180 
i
;

182 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

183 i‡(
buf
 =
NULL
)

184  -
ENOMEM
;

186 
b™d
 = 
ah
->
curch™
->
ch™
->band;

187 
r°©s
 = &
™
->
rx_øã_°©s
;

189 i‡(!
°a
->
ht_ˇp
.
ht_suµ‹ãd
)

190 
Àgacy
;

192 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

196 
i
 = 0; i < 24; i++) {

197 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

199 "MCS", 
i
,

200 
r°©s
->
ht_°©s
[
i
].
ht20_˙t
,

201 
r°©s
->
ht_°©s
[
i
].
ht40_˙t
,

202 
r°©s
->
ht_°©s
[
i
].
sgi_˙t
,

203 
r°©s
->
ht_°©s
[
i
].
lgi_˙t
);

206 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "\n");

208 
Àgacy
:

209 i‡(
b™d
 =
IEEE80211_BAND_2GHZ
) {

210 
	`PRINT_CCK_RATE
("CCK-1M/LP", 0, 
Ál£
);

211 
	`PRINT_CCK_RATE
("CCK-2M/LP", 1, 
Ál£
);

212 
	`PRINT_CCK_RATE
("CCK-5.5M/LP", 2, 
Ál£
);

213 
	`PRINT_CCK_RATE
("CCK-11M/LP", 3, 
Ál£
);

215 
	`PRINT_CCK_RATE
("CCK-2M/SP", 1, 
åue
);

216 
	`PRINT_CCK_RATE
("CCK-5.5M/SP", 2, 
åue
);

217 
	`PRINT_CCK_RATE
("CCK-11M/SP", 3, 
åue
);

220 
	`PRINT_OFDM_RATE
("OFDM-6M", 0);

221 
	`PRINT_OFDM_RATE
("OFDM-9M", 1);

222 
	`PRINT_OFDM_RATE
("OFDM-12M", 2);

223 
	`PRINT_OFDM_RATE
("OFDM-18M", 3);

224 
	`PRINT_OFDM_RATE
("OFDM-24M", 4);

225 
	`PRINT_OFDM_RATE
("OFDM-36M", 5);

226 
	`PRINT_OFDM_RATE
("OFDM-48M", 6);

227 
	`PRINT_OFDM_RATE
("OFDM-54M", 7);

229 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

230 
	`k‰ì
(
buf
);

232  
ªtvÆ
;

233 
	}
}

235 #unde‡
PRINT_OFDM_RATE


236 #unde‡
PRINT_CCK_RATE


238 c⁄° 
fûe_›î©i⁄s
 
	gf›s_node_ªcv
 = {

239 .
ªad
 = 
ªad_fûe_node_ªcv
,

240 .
	g›í
 = 
sim∂e_›í
,

241 .
	gow√r
 = 
THIS_MODULE
,

242 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

245 
	$©h9k_°a_add_debugfs
(
õì80211_hw
 *
hw
,

246 
õì80211_vif
 *
vif
,

247 
õì80211_°a
 *
°a
,

248 
díåy
 *
dú
)

250 
©h_node
 *
™
 = (©h_nodê*)
°a
->
drv_¥iv
;

252 
	`debugfs_¸óã_fûe
("node_aggr", 
S_IRUGO
, 
dú
, 
™
, &
f›s_node_aggr
);

253 
	`debugfs_¸óã_fûe
("node_ªcv", 
S_IRUGO
, 
dú
, 
™
, &
f›s_node_ªcv
);

254 
	}
}

	@dfs.c

18 
	~"hw.h
"

19 
	~"hw-›s.h
"

20 
	~"©h9k.h
"

21 
	~"dfs.h
"

22 
	~"dfs_debug.h
"

25 
	s©h_ød¨_d©a
 {

26 
u8
 
	mpul£_bw_öfo
;

27 
u8
 
	mrssi
;

28 
u8
 
	mext_rssi
;

29 
u8
 
	mpul£_Àngth_ext
;

30 
u8
 
	mpul£_Àngth_¥i
;

39 c⁄° 
	gBIN_DELTA_MIN
 = 1;

40 c⁄° 
	gBIN_DELTA_MAX
 = 10;

43 
	#NUM_DIFFS
 3

	)

44 c⁄° 
	gFFT_NUM_SAMPLES
 = (
NUM_DIFFS
 + 1);

47 c⁄° 
	gMAX_DIFF
 = 2;

50 c⁄° 
	gMIN_CHIRP_PULSE_WIDTH
 = 20;

51 c⁄° 
	gMAX_CHIRP_PULSE_WIDTH
 = 110;

53 
	s©h9k_dfs_f·_20
 {

54 
u8
 
	mbö
[28];

55 
u8
 
	mlowî_bös
[3];

56 } 
	g__∑cked
;

57 
	s©h9k_dfs_f·_40
 {

58 
u8
 
	mbö
[64];

59 
u8
 
	mlowî_bös
[3];

60 
u8
 
	muµî_bös
[3];

61 } 
	g__∑cked
;

63 
ölöe
 
	$f·_max_ödex
(
u8
 *
bös
)

65  (
bös
[2] & 0xfc) >> 2;

66 
	}
}

67 
ölöe
 
	$f·_max_magnôude
(
u8
 *
bös
)

69  (
bös
[0] & 0xc0) >> 6 | bins[1] << 2 | (bins[2] & 0x03) << 10;

70 
	}
}

71 
ölöe
 
u8
 
	$f·_bôm≠_weight
(
u8
 *
bös
)

73  
bös
[0] & 0x3f;

74 
	}
}

76 
	$©h9k_gë_max_ödex_ht40
(
©h9k_dfs_f·_40
 *
f·
,

77 
boﬁ
 
is_˘l
, boﬁ 
is_ext
)

79 c⁄° 
DFS_UPPER_BIN_OFFSET
 = 64;

81 i‡(
is_˘l
 && 
is_ext
) {

83 
is_˘l
 = 
	`f·_bôm≠_weight
(
f·
->
lowî_bös
) != 0;

84 
is_ext
 = 
	`f·_bôm≠_weight
(
f·
->
uµî_bös
) != 0;

87 i‡(
is_˘l
 && 
is_ext
) {

88 
mag_lowî
 = 
	`f·_max_magnôude
(
f·
->
lowî_bös
);

89 
mag_uµî
 = 
	`f·_max_magnôude
(
f·
->
uµî_bös
);

90 i‡(
mag_uµî
 > 
mag_lowî
)

91 
is_˘l
 = 
Ál£
;

93 
is_ext
 = 
Ál£
;

96 i‡(
is_˘l
)

97  
	`f·_max_ödex
(
f·
->
lowî_bös
);

98  
	`f·_max_ödex
(
f·
->
uµî_bös
Ë+ 
DFS_UPPER_BIN_OFFSET
;

99 
	}
}

100 
boﬁ
 
	$©h9k_check_chúpög
(
©h_so·c
 *
sc
, 
u8
 *
d©a
,

101 
d©Æí
, 
boﬁ
 
is_˘l
, boﬁ 
is_ext
)

103 
i
;

104 
max_bö
[
FFT_NUM_SAMPLES
];

105 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

106 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

107 
¥ev_dñè
;

109 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
)) {

110 
©h9k_dfs_f·_40
 *
f·
 = (©h9k_dfs_f·_40 *Ë
d©a
;

111 
num_f·_∑ckës
 = 
d©Æí
 / (*
f·
);

112 i‡(
num_f·_∑ckës
 == 0)

113  
Ál£
;

115 
	`©h_dbg
(
comm⁄
, 
DFS
, "HT40: datalen=%d,Çum_fft_packets=%d\n",

116 
d©Æí
, 
num_f·_∑ckës
);

117 i‡(
num_f·_∑ckës
 < (
FFT_NUM_SAMPLES
)) {

118 
	`©h_dbg
(
comm⁄
, 
DFS
, "notÉnoughÖackets for chirp\n");

119  
Ál£
;

122 i‡((
d©Æí
 % (*
f·
)) == 2) {

123 
f·
 = (
©h9k_dfs_f·_40
 *Ë(
d©a
 + 2);

124 
	`©h_dbg
(
comm⁄
, 
DFS
, "fixing datalen by 2\n");

126 i‡(
	`IS_CHAN_HT40MINUS
(
ah
->
curch™
)) {

127 
ãmp
 = 
is_˘l
;

128 
is_˘l
 = 
is_ext
;

129 
is_ext
 = 
ãmp
;

131 
i
 = 0; i < 
FFT_NUM_SAMPLES
; i++)

132 
max_bö
[
i
] = 
	`©h9k_gë_max_ödex_ht40
(
f·
 + i, 
is_˘l
,

133 
is_ext
);

135 
©h9k_dfs_f·_20
 *
f·
 = (©h9k_dfs_f·_20 *Ë
d©a
;

136 
num_f·_∑ckës
 = 
d©Æí
 / (*
f·
);

137 i‡(
num_f·_∑ckës
 == 0)

138  
Ál£
;

139 
	`©h_dbg
(
comm⁄
, 
DFS
, "HT20: datalen=%d,Çum_fft_packets=%d\n",

140 
d©Æí
, 
num_f·_∑ckës
);

141 i‡(
num_f·_∑ckës
 < (
FFT_NUM_SAMPLES
)) {

142 
	`©h_dbg
(
comm⁄
, 
DFS
, "notÉnoughÖackets for chirp\n");

143  
Ál£
;

146 
i
 = 0; i < 
FFT_NUM_SAMPLES
; i++)

147 
max_bö
[
i
] = 
	`f·_max_ödex
(
f·
[i].
lowî_bös
) ^ 0x20;

149 
	`©h_dbg
(
comm⁄
, 
DFS
, "bin_max = [%d, %d, %d, %d]\n",

150 
max_bö
[0], max_bin[1], max_bin[2], max_bin[3]);

156 
¥ev_dñè
 = 0;

157 
i
 = 0; i < 
NUM_DIFFS
; i++) {

158 
ddñè
 = -1;

159 
dñè
 = 
max_bö
[
i
 + 1] - max_bin[i];

162 i‡(
	`abs
(
dñè
Ë< 
BIN_DELTA_MIN
 ||ábs(dñèË> 
BIN_DELTA_MAX
) {

163 
	`©h_dbg
(
comm⁄
, 
DFS
, "CHIRP: invalid delta %d "

164 "ö sam∂ê%d\n", 
dñè
, 
i
);

165  
Ál£
;

167 i‡(
i
 == 0)

168 
d⁄e
;

169 
ddñè
 = 
dñè
 - 
¥ev_dñè
;

170 i‡(
	`abs
(
ddñè
Ë> 
MAX_DIFF
) {

171 
	`©h_dbg
(
comm⁄
, 
DFS
, "CHIRP: ddelta %dÅoo high\n",

172 
ddñè
);

173  
Ál£
;

175 
d⁄e
:

176 
	`©h_dbg
(
comm⁄
, 
DFS
, "CHIRP - %d: delta=%d, ddelta=%d\n",

177 
i
, 
dñè
, 
ddñè
);

178 
¥ev_dñè
 = 
dñè
;

180  
åue
;

181 
	}
}

185 
u32
 
	$dur_to_u£cs
(
©h_hw
 *
ah
, 
u32
 
dur
)

187 c⁄° 
u32
 
AR93X_NSECS_PER_DUR
 = 800;

188 c⁄° 
u32
 
AR93X_NSECS_PER_DUR_FAST
 = (8000 / 11);

189 
u32
 
n£cs
;

191 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
,áh->
curch™
))

192 
n£cs
 = 
dur
 * 
AR93X_NSECS_PER_DUR_FAST
;

194 
n£cs
 = 
dur
 * 
AR93X_NSECS_PER_DUR
;

196  (
n£cs
 + 500) / 1000;

197 
	}
}

199 
	#PRI_CH_RADAR_FOUND
 0x01

	)

200 
	#EXT_CH_RADAR_FOUND
 0x02

	)

201 
boﬁ


202 
	$©h9k_po°¥o˚ss_ød¨_evít
(
©h_so·c
 *
sc
,

203 
©h_ød¨_d©a
 *
¨d
,

204 
pul£_evít
 *
≥
)

206 
u8
 
rssi
;

207 
u16
 
dur
;

213 
¨d
->
pul£_bw_öfo
 &= 0x03;

215 
¨d
->
pul£_bw_öfo
) {

216 
PRI_CH_RADAR_FOUND
:

218 
dur
 = 
¨d
->
pul£_Àngth_¥i
;

219 
	`DFS_STAT_INC
(
sc
, 
¥i_phy_îr‹s
);

224 
rssi
 = (
¨d
->
ext_rssi
 >= (ard->rssi + 3)) ? 0 :árd->rssi;

226 
EXT_CH_RADAR_FOUND
:

228 
dur
 = 
¨d
->
pul£_Àngth_ext
;

229 
	`DFS_STAT_INC
(
sc
, 
ext_phy_îr‹s
);

234 
rssi
 = (
¨d
->rssò>◊rd->
ext_rssi
 + 12)) ? 0 :árd->ext_rssi;

236 (
PRI_CH_RADAR_FOUND
 | 
EXT_CH_RADAR_FOUND
):

244 i‡(
¨d
->
pul£_Àngth_ext
 >¨d->
pul£_Àngth_¥i
)

245 
dur
 = 
¨d
->
pul£_Àngth_ext
;

247 
dur
 = 
¨d
->
pul£_Àngth_¥i
;

248 
	`DFS_STAT_INC
(
sc
, 
dc_phy_îr‹s
);

251 
rssi
 = (
¨d
->rssò<árd->
ext_rssi
) ?árd->ext_rssi :árd->rssi;

258 
	`DFS_STAT_INC
(
sc
, 
bwöfo_disˇrds
);

259  
Ál£
;

262 i‡(
rssi
 == 0) {

263 
	`DFS_STAT_INC
(
sc
, 
rssi_disˇrds
);

264  
Ál£
;

268 
≥
->
width
 = 
	`dur_to_u£cs
(
sc
->
sc_ah
, 
dur
);

269 
≥
->
rssi
 =Ñssi;

271 
	`DFS_STAT_INC
(
sc
, 
pul£s_dëe˘ed
);

272  
åue
;

273 
	}
}

276 
	$©h9k_dfs_¥o˚ss_ød¨_pul£
(
©h_so·c
 *
sc
, 
pul£_evít
 *
≥
)

278 
dfs_∑âîn_dëe˘‹
 *
pd
 = 
sc
->
dfs_dëe˘‹
;

279 
	`DFS_STAT_INC
(
sc
, 
pul£s_¥o˚s£d
);

280 i‡(
pd
 =
NULL
)

282 i‡(!
pd
->
	`add_pul£
’d, 
≥
))

284 
	`DFS_STAT_INC
(
sc
, 
ød¨_dëe˘ed
);

285 
	`õì80211_ød¨_dëe˘ed
(
sc
->
hw
);

286 
	}
}

291 
	$©h9k_dfs_¥o˚ss_phyîr
(
©h_so·c
 *
sc
, *
d©a
,

292 
©h_rx_°©us
 *
rs
, 
u64
 
ma˘ime
)

294 
©h_ød¨_d©a
 
¨d
;

295 
u16
 
d©Æí
;

296 *
vd©a_íd
;

297 
pul£_evít
 
≥
;

298 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

299 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

301 
	`DFS_STAT_INC
(
sc
, 
pul£s_tŸÆ
);

302 i‡((
rs
->
rs_phyîr
 !
ATH9K_PHYERR_RADAR
) &&

303 (
rs
->
rs_phyîr
 !
ATH9K_PHYERR_FALSE_RADAR_EXT
)) {

304 
	`©h_dbg
(
comm⁄
, 
DFS
,

306 
rs
->
rs_phyîr
);

307 
	`DFS_STAT_INC
(
sc
, 
pul£s_no_dfs
);

311 
d©Æí
 = 
rs
->
rs_d©Æí
;

312 i‡(
d©Æí
 == 0) {

313 
	`DFS_STAT_INC
(
sc
, 
d©Æí_disˇrds
);

317 
¨d
.
rssi
 = 
rs
->
rs_rssi_˘l
[0];

318 
¨d
.
ext_rssi
 = 
rs
->
rs_rssi_ext
[0];

324 i‡(
¨d
.
rssi
 & 0x80)

325 
¨d
.
rssi
 = 0;

326 i‡(
¨d
.
ext_rssi
 & 0x80)

327 
¨d
.
ext_rssi
 = 0;

329 
vd©a_íd
 = (*)
d©a
 + 
d©Æí
;

330 
¨d
.
pul£_bw_öfo
 = 
vd©a_íd
[-1];

331 
¨d
.
pul£_Àngth_ext
 = 
vd©a_íd
[-2];

332 
¨d
.
pul£_Àngth_¥i
 = 
vd©a_íd
[-3];

333 
≥
.
‰eq
 = 
ah
->
curch™
->
ch™√l
;

334 
≥
.
ts
 = 
ma˘ime
;

335 i‡(!
	`©h9k_po°¥o˚ss_ød¨_evít
(
sc
, &
¨d
, &
≥
))

338 i‡(
≥
.
width
 > 
MIN_CHIRP_PULSE_WIDTH
 &&

339 
≥
.
width
 < 
MAX_CHIRP_PULSE_WIDTH
) {

340 
boﬁ
 
is_˘l
 = !!(
¨d
.
pul£_bw_öfo
 & 
PRI_CH_RADAR_FOUND
);

341 
boﬁ
 
is_ext
 = !!(
¨d
.
pul£_bw_öfo
 & 
EXT_CH_RADAR_FOUND
);

342 
˛í
 = 
d©Æí
 - 3;

343 
≥
.
chúp
 = 
	`©h9k_check_chúpög
(
sc
, 
d©a
, 
˛í
, 
is_˘l
, 
is_ext
);

345 
≥
.
chúp
 = 
Ál£
;

348 
	`©h_dbg
(
comm⁄
, 
DFS
,

351 
¨d
.
pul£_bw_öfo
, 
≥
.
‰eq
,Öe.
ts
,Öe.
width
,Öe.
rssi
,

352 
≥
.
ts
 - 
sc
->
dfs_¥ev_pul£_ts
);

353 
sc
->
dfs_¥ev_pul£_ts
 = 
≥
.
ts
;

354 i‡(
¨d
.
pul£_bw_öfo
 & 
PRI_CH_RADAR_FOUND
)

355 
	`©h9k_dfs_¥o˚ss_ød¨_pul£
(
sc
, &
≥
);

356 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
) &&

357 
¨d
.
pul£_bw_öfo
 & 
EXT_CH_RADAR_FOUND
) {

358 
≥
.
‰eq
 +
	`IS_CHAN_HT40PLUS
(
ah
->
curch™
) ? 20 : -20;

359 
	`©h9k_dfs_¥o˚ss_ød¨_pul£
(
sc
, &
≥
);

361 
	}
}

362 #unde‡
PRI_CH_RADAR_FOUND


363 #unde‡
EXT_CH_RADAR_FOUND


	@dfs.h

18 #i‚de‡
ATH9K_DFS_H


19 
	#ATH9K_DFS_H


	)

20 
	~"../dfs_∑âîn_dëe˘‹.h
"

22 #i‡
deföed
(
CPTCFG_ATH9K_DFS_CERTIFIED
)

37 
©h9k_dfs_¥o˚ss_phyîr
(
©h_so·c
 *
sc
, *
d©a
,

38 
©h_rx_°©us
 *
rs
, 
u64
 
ma˘ime
);

40 
ölöe
 

41 
	$©h9k_dfs_¥o˚ss_phyîr
(
©h_so·c
 *
sc
, *
d©a
,

42 
©h_rx_°©us
 *
rs
, 
u64
 
ma˘ime
Ë{ 
	}
}

	@dfs_debug.c

18 
	~<löux/debugfs.h
>

19 
	~<löux/exp‹t.h
>

21 
	~"©h9k.h
"

22 
	~"dfs_debug.h
"

23 
	~"../dfs_∑âîn_dëe˘‹.h
"

25 
©h_dfs_poﬁ_°©s
 
	gdfs_poﬁ_°©s
 = { 0 };

27 
	#ATH9K_DFS_STAT
(
s
, 
p
) \

28 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üí, "%28†: %10u\n", 
s
, \

29 
sc
->
debug
.
°©s
.
dfs_°©s
.
p
);

	)

30 
	#ATH9K_DFS_POOL_STAT
(
s
, 
p
) \

31 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üí, "%28†: %10u\n", 
s
, \

32 
dfs_poﬁ_°©s
.
p
);

	)

34 
ssize_t
 
	$ªad_fûe_dfs
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

35 
size_t
 
cou¡
, 
loff_t
 *
µos
)

37 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

38 
©h9k_hw_vîsi⁄
 *
hw_vî
 = &
sc
->
sc_ah
->
hw_vîsi⁄
;

39 *
buf
;

40 
Àn
 = 0, 
size
 = 8000;

41 
ssize_t
 
ªtvÆ
 = 0;

43 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

44 i‡(
buf
 =
NULL
)

45  -
ENOMEM
;

47 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "DFS support for "

49 
hw_vî
->
macVîsi⁄
, hw_vî->
macRev
,

50 (
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_DFS
) ?

53 i‡(!
sc
->
dfs_dëe˘‹
) {

54 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

56 
exô
;

59 
dfs_poﬁ_°©s
 = 
sc
->
dfs_dëe˘‹
->
	`gë_°©s
(sc->dfs_detector);

61 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Pulse detector statistics:\n");

62 
	`ATH9K_DFS_STAT
("pul£Évít†ªp‹ãd ", 
pul£s_tŸÆ
);

63 
	`ATH9K_DFS_STAT
("övÆidÖul£Évít† ", 
pul£s_no_dfs
);

64 
	`ATH9K_DFS_STAT
("DFSÖul£†dëe˘ed ", 
pul£s_dëe˘ed
);

65 
	`ATH9K_DFS_STAT
("D©Æí disˇrd† ", 
d©Æí_disˇrds
);

66 
	`ATH9K_DFS_STAT
("RSSI disˇrd† ", 
rssi_disˇrds
);

67 
	`ATH9K_DFS_STAT
("BW infÿdisˇrd† ", 
bwöfo_disˇrds
);

68 
	`ATH9K_DFS_STAT
("Prim¨y ch™√»pul£† ", 
¥i_phy_îr‹s
);

69 
	`ATH9K_DFS_STAT
("Sec⁄d¨y ch™√»pul£s", 
ext_phy_îr‹s
);

70 
	`ATH9K_DFS_STAT
("DuÆ ch™√»pul£† ", 
dc_phy_îr‹s
);

71 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Radar detector statistics "

73 
sc
->
dfs_dëe˘‹
->
ªgi⁄
);

74 
	`ATH9K_DFS_STAT
("Pul£Évít†¥o˚s£d ", 
pul£s_¥o˚s£d
);

75 
	`ATH9K_DFS_STAT
("Rad¨†dëe˘ed ", 
ød¨_dëe˘ed
);

76 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Global Pool statistics:\n");

77 
	`ATH9K_DFS_POOL_STAT
("PoﬁÑe„ªn˚† ", 
poﬁ_ª„ªn˚
);

78 
	`ATH9K_DFS_POOL_STAT
("Pul£†Æloˇãd ", 
pul£_Æloˇãd
);

79 
	`ATH9K_DFS_POOL_STAT
("Pul£†Ælo¯îr‹ ", 
pul£_Æloc_îr‹
);

80 
	`ATH9K_DFS_POOL_STAT
("Pul£†ö u£ ", 
pul£_u£d
);

81 
	`ATH9K_DFS_POOL_STAT
("Seqs.áŒoˇãd ", 
p£q_Æloˇãd
);

82 
	`ATH9K_DFS_POOL_STAT
("Seqs.áŒo¯îr‹ ", 
p£q_Æloc_îr‹
);

83 
	`ATH9K_DFS_POOL_STAT
("Seqs. i¿u£ ", 
p£q_u£d
);

85 
exô
:

86 i‡(
Àn
 > 
size
)

87 
Àn
 = 
size
;

89 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

90 
	`k‰ì
(
buf
);

92  
ªtvÆ
;

93 
	}
}

96 
	#DFS_STATS_RESET_MAGIC
 0x80000000

	)

97 
ssize_t
 
	$wrôe_fûe_dfs
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

98 
size_t
 
cou¡
, 
loff_t
 *
µos
)

100 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

101 
vÆ
;

102 
buf
[32];

103 
ssize_t
 
Àn
;

105 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

106 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

107  -
EFAULT
;

109 
buf
[
Àn
] = '\0';

110 i‡(
	`k°πoul
(
buf
, 0, &
vÆ
))

111  -
EINVAL
;

113 i‡(
vÆ
 =
DFS_STATS_RESET_MAGIC
)

114 
	`mem£t
(&
sc
->
debug
.
°©s
.
dfs_°©s
, 0,

115 (
sc
->
debug
.
°©s
.
dfs_°©s
));

116  
cou¡
;

117 
	}
}

119 
ssize_t
 
	$wrôe_fûe_simuœã_ød¨
(
fûe
 *file,

120 c⁄° 
__u£r
 *
u£r_buf
,

121 
size_t
 
cou¡
, 
loff_t
 *
µos
)

123 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

125 
	`õì80211_ød¨_dëe˘ed
(
sc
->
hw
);

127  
cou¡
;

128 
	}
}

130 c⁄° 
fûe_›î©i⁄s
 
	gf›s_simuœã_ød¨
 = {

131 .
wrôe
 = 
wrôe_fûe_simuœã_ød¨
,

132 .
	g›í
 = 
sim∂e_›í
,

133 .
	gow√r
 = 
THIS_MODULE
,

134 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

137 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dfs_°©s
 = {

138 .
ªad
 = 
ªad_fûe_dfs
,

139 .
	gwrôe
 = 
wrôe_fûe_dfs
,

140 .
	g›í
 = 
sim∂e_›í
,

141 .
	gow√r
 = 
THIS_MODULE
,

142 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

145 
	$©h9k_dfs_öô_debug
(
©h_so·c
 *
sc
)

147 
	`debugfs_¸óã_fûe
("dfs_°©s", 
S_IRUSR
,

148 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_dfs_°©s
);

149 
	`debugfs_¸óã_fûe
("dfs_simuœã_ød¨", 
S_IWUSR
,

150 
sc
->
debug
.
debugfs_phy
, sc, &
f›s_simuœã_ød¨
);

151 
	}
}

	@dfs_debug.h

19 #i‚de‡
ATH9K_DFS_DEBUG_H


20 
	#ATH9K_DFS_DEBUG_H


	)

22 
	~"hw.h
"

24 
	g©h_so·c
;

40 
	s©h_dfs_°©s
 {

42 
u32
 
	mpul£s_tŸÆ
;

43 
u32
 
	mpul£s_no_dfs
;

44 
u32
 
	mpul£s_dëe˘ed
;

45 
u32
 
	md©Æí_disˇrds
;

46 
u32
 
	mrssi_disˇrds
;

47 
u32
 
	mbwöfo_disˇrds
;

48 
u32
 
	m¥i_phy_îr‹s
;

49 
u32
 
	mext_phy_îr‹s
;

50 
u32
 
	mdc_phy_îr‹s
;

52 
u32
 
	mpul£s_¥o˚s£d
;

53 
u32
 
	mød¨_dëe˘ed
;

56 #i‡
deföed
(
CPTCFG_ATH9K_DFS_DEBUGFS
)

58 
	#DFS_STAT_INC
(
sc
, 
c
Ë(sc->
debug
.
°©s
.
dfs_°©s
.c++)

	)

59 
©h9k_dfs_öô_debug
(
©h_so·c
 *
sc
);

61 
©h_dfs_poﬁ_°©s
 
globÆ_dfs_poﬁ_°©s
;

65 
	#DFS_STAT_INC
(
sc
, 
c
Ëdÿ{ } 0)

	)

66 
ölöe
 
	$©h9k_dfs_öô_debug
(
©h_so·c
 *
sc
Ë{ 
	}
}

	@dynack.c

17 
	~"©h9k.h
"

18 
	~"hw.h
"

19 
	~"dy«ck.h
"

21 
	#COMPUTE_TO
 (5 * 
HZ
)

	)

22 
	#LATEACK_DELAY
 (10 * 
HZ
)

	)

23 
	#LATEACK_TO
 256

	)

24 
	#MAX_DELAY
 300

	)

25 
	#EWMA_LEVEL
 96

	)

26 
	#EWMA_DIV
 128

	)

32 
ölöe
 
u32
 
	$©h_dy«ck_ewma
(
u32
 
ﬁd
, u32 
√w
)

34  (
√w
 * (
EWMA_DIV
 - 
EWMA_LEVEL
Ë+ 
ﬁd
 * EWMA_LEVEL) / EWMA_DIV;

35 
	}
}

43 
ölöe
 
u32
 
	$©h_dy«ck_gë_sifs
(
©h_hw
 *
ah
, 
phy
)

45 
u32
 
sifs
 = 
CCK_SIFS_TIME
;

47 i‡(
phy
 =
WLAN_RC_PHY_OFDM
) {

48 i‡(
	`IS_CHAN_QUARTER_RATE
(
ah
->
curch™
))

49 
sifs
 = 
OFDM_SIFS_TIME_QUARTER
;

50 i‡(
	`IS_CHAN_HALF_RATE
(
ah
->
curch™
))

51 
sifs
 = 
OFDM_SIFS_TIME_HALF
;

53 
sifs
 = 
OFDM_SIFS_TIME
;

55  
sifs
;

56 
	}
}

63 
ölöe
 
boﬁ
 
	$©h_dy«ck_bssidmask
(
©h_hw
 *
ah
, c⁄° 
u8
 *
mac
)

65 
i
;

66 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

68 
i
 = 0; i < 
ETH_ALEN
; i++) {

69 i‡((
comm⁄
->
maˇddr
[
i
] & comm⁄->
bssidmask
[i]) !=

70 (
mac
[
i
] & 
comm⁄
->
bssidmask
[i]))

71  
Ál£
;

74  
åue
;

75 
	}
}

83 
	$©h_dy«ck_compuã_ackto
(
©h_hw
 *
ah
)

85 
©h_node
 *
™
;

86 
u32
 
to
 = 0;

87 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

88 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

90 
	`li°_f‹_óch_íåy
(
™
, &
da
->
nodes
, 
li°
)

91 i‡(
™
->
ackto
 > 
to
)

92 
to
 = 
™
->
ackto
;

94 i‡(
to
 && 
da
->
ackto
 !=Åo) {

95 
u32
 
¶Ÿtime
;

97 
¶Ÿtime
 = (
to
 - 3) / 2;

98 
da
->
ackto
 = 
to
;

99 
	`©h_dbg
(
comm⁄
, 
DYNACK
, "ACKÅimeout %u slottime %u\n",

100 
da
->
ackto
, 
¶Ÿtime
);

101 
	`©h9k_hw_£t¶Ÿtime
(
ah
, 
¶Ÿtime
);

102 
	`©h9k_hw_£t_ack_timeout
(
ah
, 
da
->
ackto
);

103 
	`©h9k_hw_£t_˘s_timeout
(
ah
, 
da
->
ackto
);

105 
	}
}

113 
	$©h_dy«ck_compuã_to
(
©h_hw
 *
ah
)

115 
u32
 
ackto
, 
ack_ts
;

116 
u8
 *
d°
, *
§c
;

117 
õì80211_°a
 *
°a
;

118 
©h_node
 *
™
;

119 
ts_öfo
 *
°_ts
;

120 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

122 
	`rcu_ªad_lock
();

124 
da
->
°_rbf
.
h_rb
 !da->°_rbf.
t_rb
 &&

125 
da
->
ack_rbf
.
h_rb
 !da->ack_rbf.
t_rb
) {

126 
ack_ts
 = 
da
->
ack_rbf
.
t°amp
[da->ack_rbf.
h_rb
];

127 
°_ts
 = &
da
->
°_rbf
.
ts
[da->°_rbf.
h_rb
];

128 
d°
 = 
da
->
°_rbf
.
addr
[da->°_rbf.
h_rb
].
h_de°
;

129 
§c
 = 
da
->
°_rbf
.
addr
[da->°_rbf.
h_rb
].
h_§c
;

131 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
DYNACK
,

133 
ack_ts
, 
°_ts
->
t°amp
, st_ts->
dur
,

134 
da
->
ack_rbf
.
h_rb
, da->
°_rbf
.h_rb);

136 i‡(
ack_ts
 > 
°_ts
->
t°amp
 + st_ts->
dur
) {

137 
ackto
 = 
ack_ts
 - 
°_ts
->
t°amp
 - st_ts->
dur
;

139 i‡(
ackto
 < 
MAX_DELAY
) {

140 
°a
 = 
	`õì80211_föd_°a_by_iÁddr
(
ah
->
hw
, 
d°
,

141 
§c
);

142 i‡(
°a
) {

143 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

144 
™
->
ackto
 = 
	`©h_dy«ck_ewma
(an->ackto,

145 
ackto
);

146 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
DYNACK
,

147 "%pMÅÿ%u\n", 
d°
, 
™
->
ackto
);

148 i‡(
	`time_is_bef‹e_jiffõs
(
da
->
…o
)) {

149 
	`©h_dy«ck_compuã_ackto
(
ah
);

150 
da
->
…o
 = 
jiffõs
 + 
COMPUTE_TO
;

153 
	`INCR
(
da
->
ack_rbf
.
h_rb
, 
ATH_DYN_BUF
);

155 
	`INCR
(
da
->
°_rbf
.
h_rb
, 
ATH_DYN_BUF
);

157 
	`INCR
(
da
->
ack_rbf
.
h_rb
, 
ATH_DYN_BUF
);

161 
	`rcu_ªad_u∆ock
();

162 
	}
}

171 
	$©h_dy«ck_ßm∂e_tx_ts
(
©h_hw
 *
ah
, 
sk_buff
 *
skb
,

172 
©h_tx_°©us
 *
ts
)

174 
u8
 
ridx
;

175 
õì80211_hdr
 *
hdr
;

176 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

177 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

178 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

180 i‡((
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
Ë|| !
da
->
íabÀd
)

183 
	`•ö_lock_bh
(&
da
->
qlock
);

185 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

188 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_XRETRY
) {

189 i‡(
	`õì80211_is_assoc_ªq
(
hdr
->
‰ame_c⁄åﬁ
) ||

190 
	`õì80211_is_assoc_ª•
(
hdr
->
‰ame_c⁄åﬁ
)) {

191 
	`©h_dbg
(
comm⁄
, 
DYNACK
, "lateáck\n");

192 
	`©h9k_hw_£t¶Ÿtime
(
ah
, (
LATEACK_TO
 - 3) / 2);

193 
	`©h9k_hw_£t_ack_timeout
(
ah
, 
LATEACK_TO
);

194 
	`©h9k_hw_£t_˘s_timeout
(
ah
, 
LATEACK_TO
);

195 
da
->
…o
 = 
jiffõs
 + 
LATEACK_DELAY
;

198 
	`•ö_u∆ock_bh
(&
da
->
qlock
);

202 
ridx
 = 
ts
->
ts_øãödex
;

204 
da
->
°_rbf
.
ts
[da->°_rbf.
t_rb
].
t°amp
 =Ås->
ts_t°amp
;

205 
da
->
°_rbf
.
ts
[da->°_rbf.
t_rb
].
dur
 =Ås->
duøti⁄
;

206 
	`ëhî_addr_c›y
(
da
->
°_rbf
.
addr
[da->°_rbf.
t_rb
].
h_de°
, 
hdr
->
addr1
);

207 
	`ëhî_addr_c›y
(
da
->
°_rbf
.
addr
[da->°_rbf.
t_rb
].
h_§c
, 
hdr
->
addr2
);

209 i‡(!(
öfo
->
°©us
.
øãs
[
ridx
].
Êags
 & 
IEEE80211_TX_RC_MCS
)) {

210 
u32
 
phy
, 
sifs
;

211 c⁄° 
õì80211_øã
 *
øã
;

212 
õì80211_tx_øã
 *
øãs
 = 
öfo
->
°©us
.rates;

214 
øã
 = &
comm⁄
->
sb™ds
[
öfo
->
b™d
].
bôøãs
[
øãs
[
ridx
].
idx
];

215 i‡(
öfo
->
b™d
 =
IEEE80211_BAND_2GHZ
 &&

216 !(
øã
->
Êags
 & 
IEEE80211_RATE_ERP_G
))

217 
phy
 = 
WLAN_RC_PHY_CCK
;

219 
phy
 = 
WLAN_RC_PHY_OFDM
;

221 
sifs
 = 
	`©h_dy«ck_gë_sifs
(
ah
, 
phy
);

222 
da
->
°_rbf
.
ts
[da->°_rbf.
t_rb
].
dur
 -
sifs
;

225 
	`©h_dbg
(
comm⁄
, 
DYNACK
, "{%pM}Åx sample %u [dur %u][h %u-t %u]\n",

226 
hdr
->
addr1
, 
da
->
°_rbf
.
ts
[da->°_rbf.
t_rb
].
t°amp
,

227 
da
->
°_rbf
.
ts
[da->°_rbf.
t_rb
].
dur
, da->°_rbf.
h_rb
,

228 (
da
->
°_rbf
.
t_rb
 + 1Ë% 
ATH_DYN_BUF
);

230 
	`INCR
(
da
->
°_rbf
.
t_rb
, 
ATH_DYN_BUF
);

231 i‡(
da
->
°_rbf
.
t_rb
 =da->°_rbf.
h_rb
)

232 
	`INCR
(
da
->
°_rbf
.
h_rb
, 
ATH_DYN_BUF
);

234 
	`©h_dy«ck_compuã_to
(
ah
);

236 
	`•ö_u∆ock_bh
(&
da
->
qlock
);

237 
	}
}

238 
EXPORT_SYMBOL
(
©h_dy«ck_ßm∂e_tx_ts
);

247 
	$©h_dy«ck_ßm∂e_ack_ts
(
©h_hw
 *
ah
, 
sk_buff
 *
skb
,

248 
u32
 
ts
)

250 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

251 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

252 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

254 i‡(!
	`©h_dy«ck_bssidmask
(
ah
, 
hdr
->
addr1
Ë|| !
da
->
íabÀd
)

257 
	`•ö_lock_bh
(&
da
->
qlock
);

258 
da
->
ack_rbf
.
t°amp
[da->ack_rbf.
t_rb
] = 
ts
;

260 
	`©h_dbg
(
comm⁄
, 
DYNACK
, "rx sample %u [h %u-t %u]\n",

261 
da
->
ack_rbf
.
t°amp
[da->ack_rbf.
t_rb
],

262 
da
->
ack_rbf
.
h_rb
, (da->ack_rbf.
t_rb
 + 1Ë% 
ATH_DYN_BUF
);

264 
	`INCR
(
da
->
ack_rbf
.
t_rb
, 
ATH_DYN_BUF
);

265 i‡(
da
->
ack_rbf
.
t_rb
 =da->ack_rbf.
h_rb
)

266 
	`INCR
(
da
->
ack_rbf
.
h_rb
, 
ATH_DYN_BUF
);

268 
	`©h_dy«ck_compuã_to
(
ah
);

270 
	`•ö_u∆ock_bh
(&
da
->
qlock
);

271 
	}
}

272 
EXPORT_SYMBOL
(
©h_dy«ck_ßm∂e_ack_ts
);

280 
	$©h_dy«ck_node_öô
(
©h_hw
 *
ah
, 
©h_node
 *
™
)

283 
u32
 
ackto
 = 
ATH9K_SLOT_TIME_9
 + 16 + 64;

284 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

286 
™
->
ackto
 =áckto;

288 
	`•ö_lock
(&
da
->
qlock
);

289 
	`li°_add_èû
(&
™
->
li°
, &
da
->
nodes
);

290 
	`•ö_u∆ock
(&
da
->
qlock
);

291 
	}
}

292 
EXPORT_SYMBOL
(
©h_dy«ck_node_öô
);

300 
	$©h_dy«ck_node_deöô
(
©h_hw
 *
ah
, 
©h_node
 *
™
)

302 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

304 
	`•ö_lock
(&
da
->
qlock
);

305 
	`li°_dñ
(&
™
->
li°
);

306 
	`•ö_u∆ock
(&
da
->
qlock
);

307 
	}
}

308 
EXPORT_SYMBOL
(
©h_dy«ck_node_deöô
);

315 
	$©h_dy«ck_ª£t
(
©h_hw
 *
ah
)

318 
u32
 
ackto
 = 
ATH9K_SLOT_TIME_9
 + 16 + 64;

319 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

321 
da
->
…o
 = 
jiffõs
;

322 
da
->
ackto
 =áckto;

324 
da
->
°_rbf
.
t_rb
 = 0;

325 
da
->
°_rbf
.
h_rb
 = 0;

326 
da
->
ack_rbf
.
t_rb
 = 0;

327 
da
->
ack_rbf
.
h_rb
 = 0;

330 
	`©h9k_hw_£t¶Ÿtime
(
ah
, (
ackto
 - 3) / 2);

331 
	`©h9k_hw_£t_ack_timeout
(
ah
, 
ackto
);

332 
	`©h9k_hw_£t_˘s_timeout
(
ah
, 
ackto
);

333 
	}
}

334 
EXPORT_SYMBOL
(
©h_dy«ck_ª£t
);

341 
	$©h_dy«ck_öô
(
©h_hw
 *
ah
)

343 
©h_dy«ck
 *
da
 = &
ah
->
dy«ck
;

345 
	`mem£t
(
da
, 0, (
©h_dy«ck
));

347 
	`•ö_lock_öô
(&
da
->
qlock
);

348 
	`INIT_LIST_HEAD
(&
da
->
nodes
);

350 
ah
->
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_ACKTO_ESTIMATION
;

351 
	}
}

	@dynack.h

17 #i‚de‡
DYNACK_H


18 
	#DYNACK_H


	)

20 
	#ATH_DYN_BUF
 64

	)

22 
	g©h_hw
;

23 
	g©h_node
;

31 
	s©h_dyn_rxbuf
 {

32 
u16
 
	mh_rb
, 
	mt_rb
;

33 
u32
 
	mt°amp
[
ATH_DYN_BUF
];

36 
	sts_öfo
 {

37 
u32
 
	mt°amp
;

38 
u32
 
	mdur
;

41 
	shaddr_∑ú
 {

42 
u8
 
	mh_de°
[
ETH_ALEN
];

43 
u8
 
	mh_§c
[
ETH_ALEN
];

53 
	s©h_dyn_txbuf
 {

54 
u16
 
	mh_rb
, 
	mt_rb
;

55 
haddr_∑ú
 
	maddr
[
ATH_DYN_BUF
];

56 
ts_öfo
 
	mts
[
ATH_DYN_BUF
];

69 
	s©h_dy«ck
 {

70 
boﬁ
 
	míabÀd
;

71 
	mackto
;

72 
	m…o
;

74 
li°_hód
 
	mnodes
;

77 
•ölock_t
 
	mqlock
;

78 
©h_dyn_rxbuf
 
	mack_rbf
;

79 
©h_dyn_txbuf
 
	m°_rbf
;

82 #i‡
deföed
(
CPTCFG_ATH9K_DYNACK
)

83 
©h_dy«ck_ª£t
(
©h_hw
 *
ah
);

84 
©h_dy«ck_node_öô
(
©h_hw
 *
ah
, 
©h_node
 *
™
);

85 
©h_dy«ck_node_deöô
(
©h_hw
 *
ah
, 
©h_node
 *
™
);

86 
©h_dy«ck_öô
(
©h_hw
 *
ah
);

87 
©h_dy«ck_ßm∂e_ack_ts
(
©h_hw
 *
ah
, 
sk_buff
 *
skb
, 
u32
 
ts
);

88 
©h_dy«ck_ßm∂e_tx_ts
(
©h_hw
 *
ah
, 
sk_buff
 *
skb
,

89 
©h_tx_°©us
 *
ts
);

91 
ölöe
 
	$©h_dy«ck_öô
(
©h_hw
 *
ah
Ë{
	}
}

92 
ölöe
 
	$©h_dy«ck_node_öô
(
©h_hw
 *
ah
,

93 
©h_node
 *
™
Ë{
	}
}

94 
ölöe
 
	$©h_dy«ck_node_deöô
(
©h_hw
 *
ah
,

95 
©h_node
 *
™
Ë{
	}
}

96 
ölöe
 
	$©h_dy«ck_ßm∂e_ack_ts
(
©h_hw
 *
ah
,

97 
sk_buff
 *
skb
, 
u32
 
ts
Ë{
	}
}

98 
ölöe
 
	$©h_dy«ck_ßm∂e_tx_ts
(
©h_hw
 *
ah
,

99 
sk_buff
 *
skb
,

100 
©h_tx_°©us
 *
ts
Ë{
	}
}

	@eeprom.c

17 
	~"hw.h
"

19 
	$©h9k_hw_™Æog_shi·_ªgwrôe
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
vÆ
)

21 
	`REG_WRITE
(
ah
, 
ªg
, 
vÆ
);

23 i‡(
ah
->
c⁄fig
.
™Æog_shi·ªg
)

24 
	`udñay
(100);

25 
	}
}

27 
	$©h9k_hw_™Æog_shi·_rmw
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
mask
,

28 
u32
 
shi·
, u32 
vÆ
)

30 
	`REG_RMW
(
ah
, 
ªg
, ((
vÆ
 << 
shi·
Ë& 
mask
), mask);

32 i‡(
ah
->
c⁄fig
.
™Æog_shi·ªg
)

33 
	`udñay
(100);

34 
	}
}

36 
öt16_t
 
	$©h9k_hw_öãΩﬁ©e
(
u16
 
èrgë
, u16 
§cLe·
, u16 
§cRight
,

37 
öt16_t
 
èrgëLe·
, i¡16_à
èrgëRight
)

39 
öt16_t
 
rv
;

41 i‡(
§cRight
 =
§cLe·
) {

42 
rv
 = 
èrgëLe·
;

44 
rv
 = (
öt16_t
Ë(((
èrgë
 - 
§cLe·
Ë* 
èrgëRight
 +

45 (
§cRight
 - 
èrgë
Ë* 
èrgëLe·
) /

46 (
§cRight
 - 
§cLe·
));

48  
rv
;

49 
	}
}

51 
boﬁ
 
	$©h9k_hw_gë_lowî_uµî_ödex
(
u8
 
èrgë
, u8 *
pLi°
, 
u16
 
li°Size
,

52 
u16
 *
ödexL
, u16 *
ödexR
)

54 
u16
 
i
;

56 i‡(
èrgë
 <
pLi°
[0]) {

57 *
ödexL
 = *
ödexR
 = 0;

58  
åue
;

60 i‡(
èrgë
 >
pLi°
[
li°Size
 - 1]) {

61 *
ödexL
 = *
ödexR
 = (
u16
Ë(
li°Size
 - 1);

62  
åue
;

65 
i
 = 0; i < 
li°Size
 - 1; i++) {

66 i‡(
pLi°
[
i
] =
èrgë
) {

67 *
ödexL
 = *
ödexR
 = 
i
;

68  
åue
;

70 i‡(
èrgë
 < 
pLi°
[
i
 + 1]) {

71 *
ödexL
 = 
i
;

72 *
ödexR
 = (
u16
Ë(
i
 + 1);

73  
Ál£
;

76  
Ál£
;

77 
	}
}

79 
	$©h9k_hw_usb_gí_fûl_ì¥om
(
©h_hw
 *
ah
, 
u16
 *
ìp_d©a
,

80 
ìp_°¨t_loc
, 
size
)

82 
i
 = 0, 
j
, 
addr
;

83 
u32
 
addrd©a
[8];

84 
u32
 
d©a
[8];

86 
addr
 = 0;ádd∏< 
size
;áddr++) {

87 
addrd©a
[
i
] = 
AR5416_EEPROM_OFFSET
 +

88 ((
addr
 + 
ìp_°¨t_loc
Ë<< 
AR5416_EEPROM_S
);

89 
i
++;

90 i‡(
i
 == 8) {

91 
	`REG_READ_MULTI
(
ah
, 
addrd©a
, 
d©a
, 
i
);

93 
j
 = 0; j < 
i
; j++) {

94 *
ìp_d©a
 = 
d©a
[
j
];

95 
ìp_d©a
++;

97 
i
 = 0;

101 i‡(
i
 != 0) {

102 
	`REG_READ_MULTI
(
ah
, 
addrd©a
, 
d©a
, 
i
);

104 
j
 = 0; j < 
i
; j++) {

105 *
ìp_d©a
 = 
d©a
[
j
];

106 
ìp_d©a
++;

109 
	}
}

111 
boﬁ
 
	$©h9k_hw_nvøm_ªad_blob
(
©h_hw
 *
ah
, 
u32
 
off
,

112 
u16
 *
d©a
)

114 
u16
 *
blob_d©a
;

116 i‡(
off
 * (
u16
Ë> 
ah
->
ì¥om_blob
->
size
)

117  
Ál£
;

119 
blob_d©a
 = (
u16
 *)
ah
->
ì¥om_blob
->
d©a
;

120 *
d©a
 = 
blob_d©a
[
off
];

121  
åue
;

122 
	}
}

124 
boﬁ
 
	$©h9k_hw_nvøm_ªad
(
©h_hw
 *
ah
, 
u32
 
off
, 
u16
 *
d©a
)

126 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

127 
boﬁ
 
ªt
;

129 i‡(
ah
->
ì¥om_blob
)

130 
ªt
 = 
	`©h9k_hw_nvøm_ªad_blob
(
ah
, 
off
, 
d©a
);

132 
ªt
 = 
comm⁄
->
bus_›s
->
	`ì¥om_ªad
(comm⁄, 
off
, 
d©a
);

134 i‡(!
ªt
)

135 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

136 "u«bÀÅÿªadÉïromÑegi⁄áàoff£à%u\n", 
off
);

138  
ªt
;

139 
	}
}

141 
	$©h9k_hw_nvøm_sw≠_d©a
(
©h_hw
 *
ah
, 
boﬁ
 *
sw≠_√eded
, 
size
)

143 
u16
 
magic
;

144 
u16
 *
ìpd©a
;

145 
i
;

146 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

148 i‡(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
AR5416_EEPROM_MAGIC_OFFSET
, &
magic
)) {

149 
	`©h_îr
(
comm⁄
, "Reading Magic # failed\n");

150  -
EIO
;

153 *
sw≠_√eded
 = 
Ál£
;

154 i‡(
	`swab16
(
magic
Ë=
AR5416_EEPROM_MAGIC
) {

155 i‡(
ah
->
ah_Êags
 & 
AH_NO_EEP_SWAP
) {

156 
	`©h_öfo
(
comm⁄
,

159 *
sw≠_√eded
 = 
åue
;

161 } i‡(
magic
 !
AR5416_EEPROM_MAGIC
) {

162 i‡(
	`©h9k_hw_u£_Êash
(
ah
))

165 
	`©h_îr
(
comm⁄
,

166 "InvÆid EEPROM Magi¯(0x%04x).\n", 
magic
);

167  -
EINVAL
;

170 
ìpd©a
 = (
u16
 *)(&
ah
->
ì¥om
);

172 i‡(*
sw≠_√eded
) {

173 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

176 
i
 = 0; i < 
size
; i++)

177 
ìpd©a
[
i
] = 
	`swab16
(eepdata[i]);

181 
	}
}

183 
boﬁ
 
	$©h9k_hw_nvøm_vÆid©e_checksum
(
©h_hw
 *
ah
, 
size
)

185 
u32
 
i
, 
sum
 = 0;

186 
u16
 *
ìpd©a
 = (u16 *)(&
ah
->
ì¥om
);

187 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

189 
i
 = 0; i < 
size
; i++)

190 
sum
 ^
ìpd©a
[
i
];

192 i‡(
sum
 != 0xffff) {

193 
	`©h_îr
(
comm⁄
, "Bad EEPROM checksum 0x%x\n", 
sum
);

194  
Ál£
;

197  
åue
;

198 
	}
}

200 
boﬁ
 
	$©h9k_hw_nvøm_check_vîsi⁄
(
©h_hw
 *
ah
, 
vîsi⁄
, 
möªv
)

202 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

204 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om_vî
◊hË!
vîsi⁄
 ||

205 
ah
->
ìp_›s
->
	`gë_ì¥om_ªv
◊hË< 
möªv
) {

206 
	`©h_îr
(
comm⁄
, "Bad EEPROM VER 0x%04x or REV 0x%04x\n",

207 
ah
->
ìp_›s
->
	`gë_ì¥om_vî
(ah),

208 
ah
->
ìp_›s
->
	`gë_ì¥om_ªv
(ah));

209  
Ál£
;

212  
åue
;

213 
	}
}

215 
	$©h9k_hw_fûl_vpd_èbÀ
(
u8
 
pwrMö
, u8 
pwrMax
, u8 *
pPwrLi°
,

216 
u8
 *
pVpdLi°
, 
u16
 
numI¡î˚±s
,

217 
u8
 *
pRëVpdLi°
)

219 
u16
 
i
, 
k
;

220 
u8
 
cuºPwr
 = 
pwrMö
;

221 
u16
 
idxL
 = 0, 
idxR
 = 0;

223 
i
 = 0; i <(
pwrMax
 - 
pwrMö
) / 2; i++) {

224 
	`©h9k_hw_gë_lowî_uµî_ödex
(
cuºPwr
, 
pPwrLi°
,

225 
numI¡î˚±s
, &(
idxL
),

226 &(
idxR
));

227 i‡(
idxR
 < 1)

228 
idxR
 = 1;

229 i‡(
idxL
 =
numI¡î˚±s
 - 1)

230 
idxL
 = (
u16
Ë(
numI¡î˚±s
 - 2);

231 i‡(
pPwrLi°
[
idxL
] =pPwrLi°[
idxR
])

232 
k
 = 
pVpdLi°
[
idxL
];

234 
k
 = (
u16
)(((
cuºPwr
 - 
pPwrLi°
[
idxL
]Ë* 
pVpdLi°
[
idxR
] +

235 (
pPwrLi°
[
idxR
] - 
cuºPwr
Ë* 
pVpdLi°
[
idxL
]) /

236 (
pPwrLi°
[
idxR
] -ÖPwrLi°[
idxL
]));

237 
pRëVpdLi°
[
i
] = (
u8
Ë
k
;

238 
cuºPwr
 += 2;

240 
	}
}

242 
	$©h9k_hw_gë_Àgacy_èrgë_powîs
(
©h_hw
 *
ah
,

243 
©h9k_ch™√l
 *
ch™
,

244 
ˇl_èrgë_powî_Àg
 *
powInfo
,

245 
u16
 
numCh™√ls
,

246 
ˇl_èrgë_powî_Àg
 *
pNewPowî
,

247 
u16
 
numR©es
, 
boﬁ
 
isExtT¨gë
)

249 
ch™_˚¡îs
 
˚¡îs
;

250 
u16
 
˛o
, 
chi
;

251 
i
;

252 
m©chIndex
 = -1, 
lowIndex
 = -1;

253 
u16
 
‰eq
;

255 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

256 
‰eq
 = (
isExtT¨gë
Ë? 
˚¡îs
.
ext_˚¡î
 : cíãrs.
˘l_˚¡î
;

258 i‡(
‰eq
 <
	`©h9k_hw_fbö2‰eq
(
powInfo
[0].
bCh™√l
,

259 
	`IS_CHAN_2GHZ
(
ch™
))) {

260 
m©chIndex
 = 0;

262 
i
 = 0; (ò< 
numCh™√ls
) &&

263 (
powInfo
[
i
].
bCh™√l
 !
AR5416_BCHAN_UNUSED
); i++) {

264 i‡(
‰eq
 =
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
].
bCh™√l
,

265 
	`IS_CHAN_2GHZ
(
ch™
))) {

266 
m©chIndex
 = 
i
;

268 } i‡(
‰eq
 < 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
].
bCh™√l
,

269 
	`IS_CHAN_2GHZ
(
ch™
)Ë&& 
i
 > 0 &&

270 
‰eq
 > 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
 - 1].
bCh™√l
,

271 
	`IS_CHAN_2GHZ
(
ch™
))) {

272 
lowIndex
 = 
i
 - 1;

276 i‡((
m©chIndex
 =-1Ë&& (
lowIndex
 == -1))

277 
m©chIndex
 = 
i
 - 1;

280 i‡(
m©chIndex
 != -1) {

281 *
pNewPowî
 = 
powInfo
[
m©chIndex
];

283 
˛o
 = 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
lowIndex
].
bCh™√l
,

284 
	`IS_CHAN_2GHZ
(
ch™
));

285 
chi
 = 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
lowIndex
 + 1].
bCh™√l
,

286 
	`IS_CHAN_2GHZ
(
ch™
));

288 
i
 = 0; i < 
numR©es
; i++) {

289 
pNewPowî
->
tPow2x
[
i
] =

290 (
u8
)
	`©h9k_hw_öãΩﬁ©e
(
‰eq
, 
˛o
, 
chi
,

291 
powInfo
[
lowIndex
].
tPow2x
[
i
],

292 
powInfo
[
lowIndex
 + 1].
tPow2x
[
i
]);

295 
	}
}

297 
	$©h9k_hw_gë_èrgë_powîs
(
©h_hw
 *
ah
,

298 
©h9k_ch™√l
 *
ch™
,

299 
ˇl_èrgë_powî_ht
 *
powInfo
,

300 
u16
 
numCh™√ls
,

301 
ˇl_èrgë_powî_ht
 *
pNewPowî
,

302 
u16
 
numR©es
, 
boﬁ
 
isHt40T¨gë
)

304 
ch™_˚¡îs
 
˚¡îs
;

305 
u16
 
˛o
, 
chi
;

306 
i
;

307 
m©chIndex
 = -1, 
lowIndex
 = -1;

308 
u16
 
‰eq
;

310 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

311 
‰eq
 = 
isHt40T¨gë
 ? 
˚¡îs
.
sy¡h_˚¡î
 : cíãrs.
˘l_˚¡î
;

313 i‡(
‰eq
 <
	`©h9k_hw_fbö2‰eq
(
powInfo
[0].
bCh™√l
, 
	`IS_CHAN_2GHZ
(
ch™
))) {

314 
m©chIndex
 = 0;

316 
i
 = 0; (ò< 
numCh™√ls
) &&

317 (
powInfo
[
i
].
bCh™√l
 !
AR5416_BCHAN_UNUSED
); i++) {

318 i‡(
‰eq
 =
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
].
bCh™√l
,

319 
	`IS_CHAN_2GHZ
(
ch™
))) {

320 
m©chIndex
 = 
i
;

323 i‡(
‰eq
 < 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
].
bCh™√l
,

324 
	`IS_CHAN_2GHZ
(
ch™
)Ë&& 
i
 > 0 &&

325 
‰eq
 > 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
i
 - 1].
bCh™√l
,

326 
	`IS_CHAN_2GHZ
(
ch™
))) {

327 
lowIndex
 = 
i
 - 1;

331 i‡((
m©chIndex
 =-1Ë&& (
lowIndex
 == -1))

332 
m©chIndex
 = 
i
 - 1;

335 i‡(
m©chIndex
 != -1) {

336 *
pNewPowî
 = 
powInfo
[
m©chIndex
];

338 
˛o
 = 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
lowIndex
].
bCh™√l
,

339 
	`IS_CHAN_2GHZ
(
ch™
));

340 
chi
 = 
	`©h9k_hw_fbö2‰eq
(
powInfo
[
lowIndex
 + 1].
bCh™√l
,

341 
	`IS_CHAN_2GHZ
(
ch™
));

343 
i
 = 0; i < 
numR©es
; i++) {

344 
pNewPowî
->
tPow2x
[
i
] = (
u8
)
	`©h9k_hw_öãΩﬁ©e
(
‰eq
,

345 
˛o
, 
chi
,

346 
powInfo
[
lowIndex
].
tPow2x
[
i
],

347 
powInfo
[
lowIndex
 + 1].
tPow2x
[
i
]);

350 
	}
}

352 
u16
 
	$©h9k_hw_gë_max_edge_powî
(
u16
 
‰eq
, 
ˇl_˘l_edges
 *
pRdEdgesPowî
,

353 
boﬁ
 
is2GHz
, 
num_b™d_edges
)

355 
u16
 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

356 
i
;

358 
i
 = 0; (ò< 
num_b™d_edges
) &&

359 (
pRdEdgesPowî
[
i
].
bCh™√l
 !
AR5416_BCHAN_UNUSED
); i++) {

360 i‡(
‰eq
 =
	`©h9k_hw_fbö2‰eq
(
pRdEdgesPowî
[
i
].
bCh™√l
, 
is2GHz
)) {

361 
twi˚MaxEdgePowî
 = 
	`CTL_EDGE_TPOWER
(
pRdEdgesPowî
[
i
].
˘l
);

363 } i‡((
i
 > 0) &&

364 (
‰eq
 < 
	`©h9k_hw_fbö2‰eq
(
pRdEdgesPowî
[
i
].
bCh™√l
,

365 
is2GHz
))) {

366 i‡(
	`©h9k_hw_fbö2‰eq
(
pRdEdgesPowî
[
i
 - 1].
bCh™√l
,

367 
is2GHz
Ë< 
‰eq
 &&

368 
	`CTL_EDGE_FLAGS
(
pRdEdgesPowî
[
i
 - 1].
˘l
)) {

369 
twi˚MaxEdgePowî
 =

370 
	`CTL_EDGE_TPOWER
(
pRdEdgesPowî
[
i
 - 1].
˘l
);

376  
twi˚MaxEdgePowî
;

377 
	}
}

379 
u16
 
	$©h9k_hw_gë_sˇÀd_powî
(
©h_hw
 *
ah
, 
u16
 
powî_limô
,

380 
u8
 
™ã¬a_ªdu˘i⁄
)

382 
u16
 
ªdu˘i⁄
 = 
™ã¬a_ªdu˘i⁄
;

388 
	`¨5416_gë_¡xchaös
(
ah
->
txchaömask
)) {

392 
ªdu˘i⁄
 +
POWER_CORRECTION_FOR_TWO_CHAIN
;

395 
ªdu˘i⁄
 +
POWER_CORRECTION_FOR_THREE_CHAIN
;

399 i‡(
powî_limô
 > 
ªdu˘i⁄
)

400 
powî_limô
 -
ªdu˘i⁄
;

402 
powî_limô
 = 0;

404  
powî_limô
;

405 
	}
}

407 
	$©h9k_hw_upd©e_ªguœt‹y_maxpowî
(
©h_hw
 *
ah
)

409 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

410 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

412 
	`¨5416_gë_¡xchaös
(
ah
->
txchaömask
)) {

416 
ªguœt‹y
->
max_powî_Àvñ
 +
POWER_CORRECTION_FOR_TWO_CHAIN
;

419 
ªguœt‹y
->
max_powî_Àvñ
 +
POWER_CORRECTION_FOR_THREE_CHAIN
;

422 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Invalid chainmask configuration\n");

425 
	}
}

427 
	$©h9k_hw_gë_gaö_bound¨õs_pdadcs
(
©h_hw
 *
ah
,

428 
©h9k_ch™√l
 *
ch™
,

429 *
pRawD©aSë
,

430 
u8
 *
bCh™s
, 
u16
 
avaûPõrs
,

431 
u16
 
tPdGaöOvîœp
,

432 
u16
 *
pPdGaöBound¨õs
, 
u8
 *
pPDADCVÆues
,

433 
u16
 
numXpdGaös
)

435 
i
, 
j
, 
k
;

436 
öt16_t
 
ss
;

437 
u16
 
idxL
 = 0, 
idxR
 = 0, 
numPõrs
;

438 
u8
 
vpdTabÀL
[
AR5416_NUM_PD_GAINS
]

439 [
AR5416_MAX_PWR_RANGE_IN_HALF_DB
];

440 
u8
 
vpdTabÀR
[
AR5416_NUM_PD_GAINS
]

441 [
AR5416_MAX_PWR_RANGE_IN_HALF_DB
];

442 
u8
 
vpdTabÀI
[
AR5416_NUM_PD_GAINS
]

443 [
AR5416_MAX_PWR_RANGE_IN_HALF_DB
];

445 
u8
 *
pVpdL
, *
pVpdR
, *
pPwrL
, *
pPwrR
;

446 
u8
 
möPwrT4
[
AR5416_NUM_PD_GAINS
];

447 
u8
 
maxPwrT4
[
AR5416_NUM_PD_GAINS
];

448 
öt16_t
 
vpdSãp
;

449 
öt16_t
 
tmpVÆ
;

450 
u16
 
sizeCuºVpdTabÀ
, 
maxIndex
, 
tgtIndex
;

451 
boﬁ
 
m©ch
;

452 
öt16_t
 
möDñè
 = 0;

453 
ch™_˚¡îs
 
˚¡îs
;

454 
pdgaö_bound¨y_deÁu…
;

455 
ˇl_d©a_≥r_‰eq
 *
d©a_def
 = 
pRawD©aSë
;

456 
ˇl_d©a_≥r_‰eq_4k
 *
d©a_4k
 = 
pRawD©aSë
;

457 
ˇl_d©a_≥r_‰eq_¨9287
 *
d©a_9287
 = 
pRawD©aSë
;

458 
boﬁ
 
ì¥om_4k
 = 
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
(ah);

459 
öãr˚±s
;

461 i‡(
	`AR_SREV_9287
(
ah
))

462 
öãr˚±s
 = 
AR9287_PD_GAIN_ICEPTS
;

464 
öãr˚±s
 = 
AR5416_PD_GAIN_ICEPTS
;

466 
	`mem£t
(&
möPwrT4
, 0, 
AR5416_NUM_PD_GAINS
);

467 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

469 
numPõrs
 = 0;ÇumPõr†< 
avaûPõrs
;ÇumPiers++) {

470 i‡(
bCh™s
[
numPõrs
] =
AR5416_BCHAN_UNUSED
)

474 
m©ch
 = 
	`©h9k_hw_gë_lowî_uµî_ödex
((
u8
)
	`FREQ2FBIN
(
˚¡îs
.
sy¡h_˚¡î
,

475 
	`IS_CHAN_2GHZ
(
ch™
)),

476 
bCh™s
, 
numPõrs
, &
idxL
, &
idxR
);

478 i‡(
m©ch
) {

479 i‡(
	`AR_SREV_9287
(
ah
)) {

481 
i
 = 0; i < 
numXpdGaös
; i++) {

482 
möPwrT4
[
i
] = 
d©a_9287
[
idxL
].
pwrPdg
[i][0];

483 
maxPwrT4
[
i
] = 
d©a_9287
[
idxL
].
pwrPdg
[i][4];

484 
	`©h9k_hw_fûl_vpd_èbÀ
(
möPwrT4
[
i
], 
maxPwrT4
[i],

485 
d©a_9287
[
idxL
].
pwrPdg
[
i
],

486 
d©a_9287
[
idxL
].
vpdPdg
[
i
],

487 
öãr˚±s
,

488 
vpdTabÀI
[
i
]);

490 } i‡(
ì¥om_4k
) {

491 
i
 = 0; i < 
numXpdGaös
; i++) {

492 
möPwrT4
[
i
] = 
d©a_4k
[
idxL
].
pwrPdg
[i][0];

493 
maxPwrT4
[
i
] = 
d©a_4k
[
idxL
].
pwrPdg
[i][4];

494 
	`©h9k_hw_fûl_vpd_èbÀ
(
möPwrT4
[
i
], 
maxPwrT4
[i],

495 
d©a_4k
[
idxL
].
pwrPdg
[
i
],

496 
d©a_4k
[
idxL
].
vpdPdg
[
i
],

497 
öãr˚±s
,

498 
vpdTabÀI
[
i
]);

501 
i
 = 0; i < 
numXpdGaös
; i++) {

502 
möPwrT4
[
i
] = 
d©a_def
[
idxL
].
pwrPdg
[i][0];

503 
maxPwrT4
[
i
] = 
d©a_def
[
idxL
].
pwrPdg
[i][4];

504 
	`©h9k_hw_fûl_vpd_èbÀ
(
möPwrT4
[
i
], 
maxPwrT4
[i],

505 
d©a_def
[
idxL
].
pwrPdg
[
i
],

506 
d©a_def
[
idxL
].
vpdPdg
[
i
],

507 
öãr˚±s
,

508 
vpdTabÀI
[
i
]);

512 
i
 = 0; i < 
numXpdGaös
; i++) {

513 i‡(
	`AR_SREV_9287
(
ah
)) {

514 
pVpdL
 = 
d©a_9287
[
idxL
].
vpdPdg
[
i
];

515 
pPwrL
 = 
d©a_9287
[
idxL
].
pwrPdg
[
i
];

516 
pVpdR
 = 
d©a_9287
[
idxR
].
vpdPdg
[
i
];

517 
pPwrR
 = 
d©a_9287
[
idxR
].
pwrPdg
[
i
];

518 } i‡(
ì¥om_4k
) {

519 
pVpdL
 = 
d©a_4k
[
idxL
].
vpdPdg
[
i
];

520 
pPwrL
 = 
d©a_4k
[
idxL
].
pwrPdg
[
i
];

521 
pVpdR
 = 
d©a_4k
[
idxR
].
vpdPdg
[
i
];

522 
pPwrR
 = 
d©a_4k
[
idxR
].
pwrPdg
[
i
];

524 
pVpdL
 = 
d©a_def
[
idxL
].
vpdPdg
[
i
];

525 
pPwrL
 = 
d©a_def
[
idxL
].
pwrPdg
[
i
];

526 
pVpdR
 = 
d©a_def
[
idxR
].
vpdPdg
[
i
];

527 
pPwrR
 = 
d©a_def
[
idxR
].
pwrPdg
[
i
];

530 
möPwrT4
[
i
] = 
	`max
(
pPwrL
[0], 
pPwrR
[0]);

532 
maxPwrT4
[
i
] =

533 
	`mö
(
pPwrL
[
öãr˚±s
 - 1],

534 
pPwrR
[
öãr˚±s
 - 1]);

537 
	`©h9k_hw_fûl_vpd_èbÀ
(
möPwrT4
[
i
], 
maxPwrT4
[i],

538 
pPwrL
, 
pVpdL
,

539 
öãr˚±s
,

540 
vpdTabÀL
[
i
]);

541 
	`©h9k_hw_fûl_vpd_èbÀ
(
möPwrT4
[
i
], 
maxPwrT4
[i],

542 
pPwrR
, 
pVpdR
,

543 
öãr˚±s
,

544 
vpdTabÀR
[
i
]);

546 
j
 = 0; j <(
maxPwrT4
[
i
] - 
möPwrT4
[i]) / 2; j++) {

547 
vpdTabÀI
[
i
][
j
] =

548 (
u8
)(
	`©h9k_hw_öãΩﬁ©e
((
u16
)

549 
	`FREQ2FBIN
(
˚¡îs
.

550 
sy¡h_˚¡î
,

551 
IS_CHAN_2GHZ


552 (
ch™
)),

553 
bCh™s
[
idxL
], bCh™s[
idxR
],

554 
vpdTabÀL
[
i
][
j
], 
vpdTabÀR
[i][j]));

559 
k
 = 0;

561 
i
 = 0; i < 
numXpdGaös
; i++) {

562 i‡(
i
 =(
numXpdGaös
 - 1))

563 
pPdGaöBound¨õs
[
i
] =

564 (
u16
)(
maxPwrT4
[
i
] / 2);

566 
pPdGaöBound¨õs
[
i
] =

567 (
u16
)((
maxPwrT4
[
i
] + 
möPwrT4
[i + 1]) / 4);

569 
pPdGaöBound¨õs
[
i
] =

570 
	`mö
((
u16
)
MAX_RATE_POWER
, 
pPdGaöBound¨õs
[
i
]);

572 
möDñè
 = 0;

574 i‡(
i
 == 0) {

575 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

576 
ss
 = (
öt16_t
)(0 - (
möPwrT4
[
i
] / 2));

578 
ss
 = 0;

580 
ss
 = (
öt16_t
)((
pPdGaöBound¨õs
[
i
 - 1] -

581 (
möPwrT4
[
i
] / 2)) -

582 
tPdGaöOvîœp
 + 1 + 
möDñè
);

584 
vpdSãp
 = (
öt16_t
)(
vpdTabÀI
[
i
][1] - vpdTableI[i][0]);

585 
vpdSãp
 = (
öt16_t
)((vpdStep < 1) ? 1 : vpdStep);

587 (
ss
 < 0Ë&& (
k
 < (
AR5416_NUM_PDADC_VALUES
 - 1))) {

588 
tmpVÆ
 = (
öt16_t
)(
vpdTabÀI
[
i
][0] + 
ss
 * 
vpdSãp
);

589 
pPDADCVÆues
[
k
++] = (
u8
)((
tmpVÆ
 < 0) ? 0 :ÅmpVal);

590 
ss
++;

593 
sizeCuºVpdTabÀ
 = (
u8
Ë((
maxPwrT4
[
i
] - 
möPwrT4
[i]) / 2 + 1);

594 
tgtIndex
 = (
u8
)(
pPdGaöBound¨õs
[
i
] + 
tPdGaöOvîœp
 -

595 (
möPwrT4
[
i
] / 2));

596 
maxIndex
 = (
tgtIndex
 < 
sizeCuºVpdTabÀ
) ?

597 
tgtIndex
 : 
sizeCuºVpdTabÀ
;

599 (
ss
 < 
maxIndex
Ë&& (
k
 < (
AR5416_NUM_PDADC_VALUES
 - 1))) {

600 
pPDADCVÆues
[
k
++] = 
vpdTabÀI
[
i
][
ss
++];

603 
vpdSãp
 = (
öt16_t
)(
vpdTabÀI
[
i
][
sizeCuºVpdTabÀ
 - 1] -

604 
vpdTabÀI
[
i
][
sizeCuºVpdTabÀ
 - 2]);

605 
vpdSãp
 = (
öt16_t
)((vpdStep < 1) ? 1 : vpdStep);

607 i‡(
tgtIndex
 >
maxIndex
) {

608 (
ss
 <
tgtIndex
) &&

609 (
k
 < (
AR5416_NUM_PDADC_VALUES
 - 1))) {

610 
tmpVÆ
 = (
öt16_t
)((
vpdTabÀI
[
i
][
sizeCuºVpdTabÀ
 - 1] +

611 (
ss
 - 
maxIndex
 + 1Ë* 
vpdSãp
));

612 
pPDADCVÆues
[
k
++] = (
u8
)((
tmpVÆ
 > 255) ?

613 255 : 
tmpVÆ
);

614 
ss
++;

619 i‡(
ì¥om_4k
)

620 
pdgaö_bound¨y_deÁu…
 = 58;

622 
pdgaö_bound¨y_deÁu…
 = 
pPdGaöBound¨õs
[
i
 - 1];

624 
i
 < 
AR5416_PD_GAINS_IN_MASK
) {

625 
pPdGaöBound¨õs
[
i
] = 
pdgaö_bound¨y_deÁu…
;

626 
i
++;

629 
k
 < 
AR5416_NUM_PDADC_VALUES
) {

630 
pPDADCVÆues
[
k
] =ÖPDADCValues[k - 1];

631 
k
++;

633 
	}
}

635 
	$©h9k_hw_ì¥om_öô
(
©h_hw
 *
ah
)

637 
°©us
;

639 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

640 
ah
->
ìp_›s
 = &
ìp_¨9300_›s
;

641 i‡(
	`AR_SREV_9287
(
ah
)) {

642 
ah
->
ìp_›s
 = &
ìp_¨9287_›s
;

643 } i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
(ah)) {

644 
ah
->
ìp_›s
 = &
ìp_4k_›s
;

646 
ah
->
ìp_›s
 = &
ìp_def_›s
;

649 i‡(!
ah
->
ìp_›s
->
	`fûl_ì¥om
(ah))

650  -
EIO
;

652 
°©us
 = 
ah
->
ìp_›s
->
	`check_ì¥om
(ah);

654  
°©us
;

655 
	}
}

	@eeprom.h

17 #i‚de‡
EEPROM_H


18 
	#EEPROM_H


	)

20 
	#AR_EEPROM_MODAL_SPURS
 5

	)

22 
	~"../©h.h
"

23 
	~<√t/cfg80211.h
>

24 
	~"¨9003_ì¥om.h
"

26 #ifde‡
__BIG_ENDIAN


27 
	#AR5416_EEPROM_MAGIC
 0x5Ø5

	)

29 
	#AR5416_EEPROM_MAGIC
 0xa55a

	)

32 
	#CTRY_DEBUG
 0x1ff

	)

33 
	#CTRY_DEFAULT
 0

	)

35 
	#AR_EEPROM_EEPCAP_COMPRESS_DIS
 0x0001

	)

36 
	#AR_EEPROM_EEPCAP_AES_DIS
 0x0002

	)

37 
	#AR_EEPROM_EEPCAP_FASTFRAME_DIS
 0x0004

	)

38 
	#AR_EEPROM_EEPCAP_BURST_DIS
 0x0008

	)

39 
	#AR_EEPROM_EEPCAP_MAXQCU
 0x01F0

	)

40 
	#AR_EEPROM_EEPCAP_MAXQCU_S
 4

	)

41 
	#AR_EEPROM_EEPCAP_HEAVY_CLIP_EN
 0x0200

	)

42 
	#AR_EEPROM_EEPCAP_KC_ENTRIES
 0xF000

	)

43 
	#AR_EEPROM_EEPCAP_KC_ENTRIES_S
 12

	)

45 
	#AR_EEPROM_EEREGCAP_EN_FCC_MIDBAND
 0x0040

	)

46 
	#AR_EEPROM_EEREGCAP_EN_KK_U1_EVEN
 0x0080

	)

47 
	#AR_EEPROM_EEREGCAP_EN_KK_U2
 0x0100

	)

48 
	#AR_EEPROM_EEREGCAP_EN_KK_MIDBAND
 0x0200

	)

49 
	#AR_EEPROM_EEREGCAP_EN_KK_U1_ODD
 0x0400

	)

50 
	#AR_EEPROM_EEREGCAP_EN_KK_NEW_11A
 0x0800

	)

52 
	#AR_EEPROM_EEREGCAP_EN_KK_U1_ODD_PRE4_0
 0x4000

	)

53 
	#AR_EEPROM_EEREGCAP_EN_KK_NEW_11A_PRE4_0
 0x8000

	)

55 
	#AR5416_EEPROM_MAGIC_OFFSET
 0x0

	)

56 
	#AR5416_EEPROM_S
 2

	)

57 
	#AR5416_EEPROM_OFFSET
 0x2000

	)

58 
	#AR5416_EEPROM_MAX
 0x´0

	)

60 
	#AR5416_EEPROM_START_ADDR
 \

61 (
	`AR_SREV_9100
(
ah
)Ë? 0x1fff1000 : 0x503f1200

	)

63 
	#SD_NO_CTL
 0xE0

	)

64 
	#NO_CTL
 0xff

	)

65 
	#CTL_MODE_M
 0xf

	)

66 
	#CTL_11A
 0

	)

67 
	#CTL_11B
 1

	)

68 
	#CTL_11G
 2

	)

69 
	#CTL_2GHT20
 5

	)

70 
	#CTL_5GHT20
 6

	)

71 
	#CTL_2GHT40
 7

	)

72 
	#CTL_5GHT40
 8

	)

74 
	#EXT_ADDITIVE
 (0x8000)

	)

75 
	#CTL_11A_EXT
 (
CTL_11A
 | 
EXT_ADDITIVE
)

	)

76 
	#CTL_11G_EXT
 (
CTL_11G
 | 
EXT_ADDITIVE
)

	)

77 
	#CTL_11B_EXT
 (
CTL_11B
 | 
EXT_ADDITIVE
)

	)

79 
	#SUB_NUM_CTL_MODES_AT_5G_40
 2

	)

80 
	#SUB_NUM_CTL_MODES_AT_2G_40
 3

	)

82 
	#POWER_CORRECTION_FOR_TWO_CHAIN
 6

	)

83 
	#POWER_CORRECTION_FOR_THREE_CHAIN
 10

	)

95 
	#AR9285_RDEXT_DEFAULT
 0x1F

	)

97 
	#ATH9K_POW_SM
(
_r
, 
_s
Ë(((_rË& 0x3fË<< (_s))

	)

98 
	#FREQ2FBIN
(
x
, 
y
Ë((yË? ((xË- 2300Ë: (((xË- 4800Ë/ 5))

	)

99 
	#FBIN2FREQ
(
x
, 
y
Ë((yË? (2300 + xË: (4800 + 5 * x))

	)

100 
	#©h9k_hw_u£_Êash
(
_ah
Ë(!(_ah->
ah_Êags
 & 
AH_USE_EEPROM
))

	)

102 
	#AR5416_VER_MASK
 (
ìp
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
)

	)

103 
	#OLC_FOR_AR9280_20_LATER
 (
	`AR_SREV_9280_20_OR_LATER
(
ah
) && \

104 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OL_PWRCTRL
))

	)

105 
	#OLC_FOR_AR9287_10_LATER
 (
	`AR_SREV_9287_11_OR_LATER
(
ah
) && \

106 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OL_PWRCTRL
))

	)

108 
	#EEP_RFSILENT_ENABLED
 0x0001

	)

109 
	#EEP_RFSILENT_ENABLED_S
 0

	)

110 
	#EEP_RFSILENT_POLARITY
 0x0002

	)

111 
	#EEP_RFSILENT_POLARITY_S
 1

	)

112 
	#EEP_RFSILENT_GPIO_SEL
 ((
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
◊h)Ë? 0x00f¯: 0x001c)

	)

113 
	#EEP_RFSILENT_GPIO_SEL_S
 2

	)

115 
	#AR5416_OPFLAGS_11A
 0x01

	)

116 
	#AR5416_OPFLAGS_11G
 0x02

	)

117 
	#AR5416_OPFLAGS_N_5G_HT40
 0x04

	)

118 
	#AR5416_OPFLAGS_N_2G_HT40
 0x08

	)

119 
	#AR5416_OPFLAGS_N_5G_HT20
 0x10

	)

120 
	#AR5416_OPFLAGS_N_2G_HT20
 0x20

	)

122 
	#AR5416_EEP_NO_BACK_VER
 0x1

	)

123 
	#AR5416_EEP_VER
 0xE

	)

124 
	#AR5416_EEP_VER_MINOR_MASK
 0x0FFF

	)

125 
	#AR5416_EEP_MINOR_VER_2
 0x2

	)

126 
	#AR5416_EEP_MINOR_VER_3
 0x3

	)

127 
	#AR5416_EEP_MINOR_VER_7
 0x7

	)

128 
	#AR5416_EEP_MINOR_VER_9
 0x9

	)

129 
	#AR5416_EEP_MINOR_VER_16
 0x10

	)

130 
	#AR5416_EEP_MINOR_VER_17
 0x11

	)

131 
	#AR5416_EEP_MINOR_VER_19
 0x13

	)

132 
	#AR5416_EEP_MINOR_VER_20
 0x14

	)

133 
	#AR5416_EEP_MINOR_VER_21
 0x15

	)

134 
	#AR5416_EEP_MINOR_VER_22
 0x16

	)

136 
	#AR5416_NUM_5G_CAL_PIERS
 8

	)

137 
	#AR5416_NUM_2G_CAL_PIERS
 4

	)

138 
	#AR5416_NUM_5G_20_TARGET_POWERS
 8

	)

139 
	#AR5416_NUM_5G_40_TARGET_POWERS
 8

	)

140 
	#AR5416_NUM_2G_CCK_TARGET_POWERS
 3

	)

141 
	#AR5416_NUM_2G_20_TARGET_POWERS
 4

	)

142 
	#AR5416_NUM_2G_40_TARGET_POWERS
 4

	)

143 
	#AR5416_NUM_CTLS
 24

	)

144 
	#AR5416_NUM_BAND_EDGES
 8

	)

145 
	#AR5416_NUM_PD_GAINS
 4

	)

146 
	#AR5416_PD_GAINS_IN_MASK
 4

	)

147 
	#AR5416_PD_GAIN_ICEPTS
 5

	)

148 
	#AR5416_NUM_PDADC_VALUES
 128

	)

149 
	#AR5416_BCHAN_UNUSED
 0xFF

	)

150 
	#AR5416_MAX_PWR_RANGE_IN_HALF_DB
 64

	)

151 
	#AR5416_MAX_CHAINS
 3

	)

152 
	#AR9300_MAX_CHAINS
 3

	)

153 
	#AR5416_PWR_TABLE_OFFSET_DB
 -5

	)

156 
	#AR5416_EEP_RXGAIN_23DB_BACKOFF
 0

	)

157 
	#AR5416_EEP_RXGAIN_13DB_BACKOFF
 1

	)

158 
	#AR5416_EEP_RXGAIN_ORIG
 2

	)

161 
	#AR5416_EEP_TXGAIN_ORIGINAL
 0

	)

162 
	#AR5416_EEP_TXGAIN_HIGH_POWER
 1

	)

164 
	#AR5416_EEP4K_START_LOC
 64

	)

165 
	#AR5416_EEP4K_NUM_2G_CAL_PIERS
 3

	)

166 
	#AR5416_EEP4K_NUM_2G_CCK_TARGET_POWERS
 3

	)

167 
	#AR5416_EEP4K_NUM_2G_20_TARGET_POWERS
 3

	)

168 
	#AR5416_EEP4K_NUM_2G_40_TARGET_POWERS
 3

	)

169 
	#AR5416_EEP4K_NUM_CTLS
 12

	)

170 
	#AR5416_EEP4K_NUM_BAND_EDGES
 4

	)

171 
	#AR5416_EEP4K_NUM_PD_GAINS
 2

	)

172 
	#AR5416_EEP4K_MAX_CHAINS
 1

	)

174 
	#AR9280_TX_GAIN_TABLE_SIZE
 22

	)

176 
	#AR9287_EEP_VER
 0xE

	)

177 
	#AR9287_EEP_VER_MINOR_MASK
 0xFFF

	)

178 
	#AR9287_EEP_MINOR_VER_1
 0x1

	)

179 
	#AR9287_EEP_MINOR_VER_2
 0x2

	)

180 
	#AR9287_EEP_MINOR_VER_3
 0x3

	)

181 
	#AR9287_EEP_MINOR_VER
 
AR9287_EEP_MINOR_VER_3


	)

182 
	#AR9287_EEP_MINOR_VER_b
 
AR9287_EEP_MINOR_VER


	)

183 
	#AR9287_EEP_NO_BACK_VER
 
AR9287_EEP_MINOR_VER_1


	)

185 
	#AR9287_EEP_START_LOC
 128

	)

186 
	#AR9287_HTC_EEP_START_LOC
 256

	)

187 
	#AR9287_NUM_2G_CAL_PIERS
 3

	)

188 
	#AR9287_NUM_2G_CCK_TARGET_POWERS
 3

	)

189 
	#AR9287_NUM_2G_20_TARGET_POWERS
 3

	)

190 
	#AR9287_NUM_2G_40_TARGET_POWERS
 3

	)

191 
	#AR9287_NUM_CTLS
 12

	)

192 
	#AR9287_NUM_BAND_EDGES
 4

	)

193 
	#AR9287_PD_GAIN_ICEPTS
 1

	)

194 
	#AR9287_EEPMISC_BIG_ENDIAN
 0x01

	)

195 
	#AR9287_EEPMISC_WOW
 0x02

	)

196 
	#AR9287_MAX_CHAINS
 2

	)

197 
	#AR9287_ANT_16S
 32

	)

199 
	#AR9287_DATA_SZ
 32

	)

201 
	#AR9287_PWR_TABLE_OFFSET_DB
 -5

	)

203 
	#AR9287_CHECKSUM_LOCATION
 (
AR9287_EEP_START_LOC
 + 1)

	)

205 
	#CTL_EDGE_TPOWER
(
_˘l
Ë((_˘lË& 0x3f)

	)

206 
	#CTL_EDGE_FLAGS
(
_˘l
Ë(((_˘lË>> 6Ë& 0x03)

	)

208 
	#LNA_CTL_BUF_MODE
 
	`BIT
(0)

	)

209 
	#LNA_CTL_ISEL_LO
 
	`BIT
(1)

	)

210 
	#LNA_CTL_ISEL_HI
 
	`BIT
(2)

	)

211 
	#LNA_CTL_BUF_IN
 
	`BIT
(3)

	)

212 
	#LNA_CTL_FEM_BAND
 
	`BIT
(4)

	)

213 
	#LNA_CTL_LOCAL_BIAS
 
	`BIT
(5)

	)

214 
	#LNA_CTL_FORCE_XPA
 
	`BIT
(6)

	)

215 
	#LNA_CTL_USE_ANT1
 
	`BIT
(7)

	)

217 
	eì¥om_∑øm
 {

218 
	mEEP_NFTHRESH_5
,

219 
	mEEP_NFTHRESH_2
,

220 
	mEEP_MAC_MSW
,

221 
	mEEP_MAC_MID
,

222 
	mEEP_MAC_LSW
,

223 
	mEEP_REG_0
,

224 
	mEEP_OP_CAP
,

225 
	mEEP_OP_MODE
,

226 
	mEEP_RF_SILENT
,

227 
	mEEP_OB_5
,

228 
	mEEP_DB_5
,

229 
	mEEP_OB_2
,

230 
	mEEP_DB_2
,

231 
	mEEP_MINOR_REV
,

232 
	mEEP_TX_MASK
,

233 
	mEEP_RX_MASK
,

234 
	mEEP_FSTCLK_5G
,

235 
	mEEP_RXGAIN_TYPE
,

236 
	mEEP_OL_PWRCTRL
,

237 
	mEEP_TXGAIN_TYPE
,

238 
	mEEP_RC_CHAIN_MASK
,

239 
	mEEP_DAC_HPWR_5G
,

240 
	mEEP_FRAC_N_5G
,

241 
	mEEP_DEV_TYPE
,

242 
	mEEP_TEMPSENSE_SLOPE
,

243 
	mEEP_TEMPSENSE_SLOPE_PAL_ON
,

244 
	mEEP_PWR_TABLE_OFFSET
,

245 
	mEEP_PAPRD
,

246 
	mEEP_MODAL_VER
,

247 
	mEEP_ANT_DIV_CTL1
,

248 
	mEEP_CHAIN_MASK_REDUCE
,

249 
	mEEP_ANTENNA_GAIN_2G
,

250 
	mEEP_ANTENNA_GAIN_5G
,

253 
	e¨5416_øãs
 {

254 
	møã6mb
, 
	møã9mb
, 
	møã12mb
, 
	møã18mb
,

255 
	møã24mb
, 
	møã36mb
, 
	møã48mb
, 
	møã54mb
,

256 
	møã1l
, 
	møã2l
, 
	møã2s
, 
	møã5_5l
,

257 
	møã5_5s
, 
	møã11l
, 
	møã11s
, 
	møãXr
,

258 
	møãHt20_0
, 
	møãHt20_1
, 
	møãHt20_2
, 
	møãHt20_3
,

259 
	møãHt20_4
, 
	møãHt20_5
, 
	møãHt20_6
, 
	møãHt20_7
,

260 
	møãHt40_0
, 
	møãHt40_1
, 
	møãHt40_2
, 
	møãHt40_3
,

261 
	møãHt40_4
, 
	møãHt40_5
, 
	møãHt40_6
, 
	møãHt40_7
,

262 
	møãDupCck
, 
	møãDupOfdm
, 
	møãExtCck
, 
	møãExtOfdm
,

263 
	mAr5416R©eSize


266 
	e©h9k_hÆ_‰eq_b™d
 {

267 
	mATH9K_HAL_FREQ_BAND_5GHZ
 = 0,

268 
	mATH9K_HAL_FREQ_BAND_2GHZ
 = 1

271 
	sba£_ìp_hódî
 {

272 
u16
 
	mÀngth
;

273 
u16
 
	mchecksum
;

274 
u16
 
	mvîsi⁄
;

275 
u8
 
	m›C≠Fœgs
;

276 
u8
 
	mìpMisc
;

277 
u16
 
	mªgDmn
[2];

278 
u8
 
	mmacAddr
[6];

279 
u8
 
	mrxMask
;

280 
u8
 
	mtxMask
;

281 
u16
 
	mrfSûít
;

282 
u16
 
	mblueToŸhO±i⁄s
;

283 
u16
 
	mdevi˚C≠
;

284 
u32
 
	mböBuûdNumbî
;

285 
u8
 
	mdevi˚Ty≥
;

286 
u8
 
	mpwd˛köd
;

287 
u8
 
	mÁ°Clk5g
;

288 
u8
 
	mdivChaö
;

289 
u8
 
	mrxGaöTy≥
;

290 
u8
 
	mdacHiPwrMode_5G
;

291 
u8
 
	m›íLo›PwrC¡l
;

292 
u8
 
	mdacLpMode
;

293 
u8
 
	mtxGaöTy≥
;

294 
u8
 
	mrcChaöMask
;

295 
u8
 
	mdesúedSˇÀCCK
;

296 
u8
 
	mpwr_èbÀ_off£t
;

297 
u8
 
	m‰ac_n_5g
;

298 
u8
 
	mfutuªBa£_3
[21];

299 } 
	g__∑cked
;

301 
	sba£_ìp_hódî_4k
 {

302 
u16
 
	mÀngth
;

303 
u16
 
	mchecksum
;

304 
u16
 
	mvîsi⁄
;

305 
u8
 
	m›C≠Fœgs
;

306 
u8
 
	mìpMisc
;

307 
u16
 
	mªgDmn
[2];

308 
u8
 
	mmacAddr
[6];

309 
u8
 
	mrxMask
;

310 
u8
 
	mtxMask
;

311 
u16
 
	mrfSûít
;

312 
u16
 
	mblueToŸhO±i⁄s
;

313 
u16
 
	mdevi˚C≠
;

314 
u32
 
	mböBuûdNumbî
;

315 
u8
 
	mdevi˚Ty≥
;

316 
u8
 
	mtxGaöTy≥
;

317 } 
	g__∑cked
;

320 
	s•ur_ch™
 {

321 
u16
 
	m•urCh™
;

322 
u8
 
	m•urR™geLow
;

323 
u8
 
	m•urR™geHigh
;

324 } 
	g__∑cked
;

326 
	smodÆ_ìp_hódî
 {

327 
u32
 
	m™tCålChaö
[
AR5416_MAX_CHAINS
];

328 
u32
 
	m™tCålComm⁄
;

329 
u8
 
	m™ã¬aGaöCh
[
AR5416_MAX_CHAINS
];

330 
u8
 
	mswôchSëéög
;

331 
u8
 
	mtxRxAâíCh
[
AR5416_MAX_CHAINS
];

332 
u8
 
	mrxTxM¨göCh
[
AR5416_MAX_CHAINS
];

333 
u8
 
	madcDesúedSize
;

334 
u8
 
	mpgaDesúedSize
;

335 
u8
 
	mx aGaöCh
[
AR5416_MAX_CHAINS
];

336 
u8
 
	mtxEndToX∑Off
;

337 
u8
 
	mtxEndToRxOn
;

338 
u8
 
	mtxFømeToX∑On
;

339 
u8
 
	mthªsh62
;

340 
u8
 
	mnoi£Flo‹ThªshCh
[
AR5416_MAX_CHAINS
];

341 
u8
 
	mxpdGaö
;

342 
u8
 
	mxpd
;

343 
u8
 
	miqCÆICh
[
AR5416_MAX_CHAINS
];

344 
u8
 
	miqCÆQCh
[
AR5416_MAX_CHAINS
];

345 
u8
 
	mpdGaöOvîœp
;

346 
u8
 
	mob
;

347 
u8
 
	mdb
;

348 
u8
 
	mx∑BüsLvl
;

349 
u8
 
	mpwrDe¸ó£F‹2Chaö
;

350 
u8
 
	mpwrDe¸ó£F‹3Chaö
;

351 
u8
 
	mtxFømeToD©aSèπ
;

352 
u8
 
	mtxFømeToPaOn
;

353 
u8
 
	mht40PowîIncF‹Pdadc
;

354 
u8
 
	mbswAâí
[
AR5416_MAX_CHAINS
];

355 
u8
 
	mbswM¨gö
[
AR5416_MAX_CHAINS
];

356 
u8
 
	mswSëéeHt40
;

357 
u8
 
	mx©ãn2Db
[
AR5416_MAX_CHAINS
];

358 
u8
 
	mx©ãn2M¨gö
[
AR5416_MAX_CHAINS
];

359 
u8
 
	mob_ch1
;

360 
u8
 
	mdb_ch1
;

361 
u8
 
	m a_˘l
;

362 
u8
 
	mmiscBôs
;

363 
u16
 
	mx∑BüsLvlFªq
[3];

364 
u8
 
	mfutuªModÆ
[6];

366 
•ur_ch™
 
	m•urCh™s
[
AR_EEPROM_MODAL_SPURS
];

367 } 
	g__∑cked
;

369 
	sˇlD©aPîFªqOpLo›
 {

370 
u8
 
	mpwrPdg
[2][5];

371 
u8
 
	mvpdPdg
[2][5];

372 
u8
 
	mpcdac
[2][5];

373 
u8
 
	mem±y
[2][5];

374 } 
	g__∑cked
;

376 
	smodÆ_ìp_4k_hódî
 {

377 
u32
 
	m™tCålChaö
[
AR5416_EEP4K_MAX_CHAINS
];

378 
u32
 
	m™tCålComm⁄
;

379 
u8
 
	m™ã¬aGaöCh
[
AR5416_EEP4K_MAX_CHAINS
];

380 
u8
 
	mswôchSëéög
;

381 
u8
 
	mtxRxAâíCh
[
AR5416_EEP4K_MAX_CHAINS
];

382 
u8
 
	mrxTxM¨göCh
[
AR5416_EEP4K_MAX_CHAINS
];

383 
u8
 
	madcDesúedSize
;

384 
u8
 
	mpgaDesúedSize
;

385 
u8
 
	mx aGaöCh
[
AR5416_EEP4K_MAX_CHAINS
];

386 
u8
 
	mtxEndToX∑Off
;

387 
u8
 
	mtxEndToRxOn
;

388 
u8
 
	mtxFømeToX∑On
;

389 
u8
 
	mthªsh62
;

390 
u8
 
	mnoi£Flo‹ThªshCh
[
AR5416_EEP4K_MAX_CHAINS
];

391 
u8
 
	mxpdGaö
;

392 
u8
 
	mxpd
;

393 
u8
 
	miqCÆICh
[
AR5416_EEP4K_MAX_CHAINS
];

394 
u8
 
	miqCÆQCh
[
AR5416_EEP4K_MAX_CHAINS
];

395 
u8
 
	mpdGaöOvîœp
;

396 #ifde‡
__BIG_ENDIAN_BITFIELD


397 
u8
 
	mob_1
:4, 
	mob_0
:4;

398 
u8
 
	mdb1_1
:4, 
	mdb1_0
:4;

400 
u8
 
	mob_0
:4, 
	mob_1
:4;

401 
u8
 
	mdb1_0
:4, 
	mdb1_1
:4;

403 
u8
 
	mx∑BüsLvl
;

404 
u8
 
	mtxFømeToD©aSèπ
;

405 
u8
 
	mtxFømeToPaOn
;

406 
u8
 
	mht40PowîIncF‹Pdadc
;

407 
u8
 
	mbswAâí
[
AR5416_EEP4K_MAX_CHAINS
];

408 
u8
 
	mbswM¨gö
[
AR5416_EEP4K_MAX_CHAINS
];

409 
u8
 
	mswSëéeHt40
;

410 
u8
 
	mx©ãn2Db
[
AR5416_EEP4K_MAX_CHAINS
];

411 
u8
 
	mx©ãn2M¨gö
[
AR5416_EEP4K_MAX_CHAINS
];

412 #ifde‡
__BIG_ENDIAN_BITFIELD


413 
u8
 
	mdb2_1
:4, 
	mdb2_0
:4;

415 
u8
 
	mdb2_0
:4, 
	mdb2_1
:4;

417 
u8
 
	mvîsi⁄
;

418 #ifde‡
__BIG_ENDIAN_BITFIELD


419 
u8
 
	mob_3
:4, 
	mob_2
:4;

420 
u8
 
	m™tdiv_˘l1
:4, 
	mob_4
:4;

421 
u8
 
	mdb1_3
:4, 
	mdb1_2
:4;

422 
u8
 
	m™tdiv_˘l2
:4, 
	mdb1_4
:4;

423 
u8
 
	mdb2_2
:4, 
	mdb2_3
:4;

424 
u8
 
	mª£rved
:4, 
	mdb2_4
:4;

426 
u8
 
	mob_2
:4, 
	mob_3
:4;

427 
u8
 
	mob_4
:4, 
	m™tdiv_˘l1
:4;

428 
u8
 
	mdb1_2
:4, 
	mdb1_3
:4;

429 
u8
 
	mdb1_4
:4, 
	m™tdiv_˘l2
:4;

430 
u8
 
	mdb2_2
:4, 
	mdb2_3
:4;

431 
u8
 
	mdb2_4
:4, 
	mª£rved
:4;

433 
u8
 
	mtx_divîsôy
;

434 
u8
 
	mÊc_pwr_thªsh
;

435 
u8
 
	mbb_sˇÀ_smπ_™ã¬a
;

436 
	#EEP_4K_BB_DESIRED_SCALE_MASK
 0x1f

	)

437 
u8
 
	mfutuªModÆ
[1];

438 
•ur_ch™
 
	m•urCh™s
[
AR_EEPROM_MODAL_SPURS
];

439 } 
	g__∑cked
;

441 
	sba£_ìp_¨9287_hódî
 {

442 
u16
 
	mÀngth
;

443 
u16
 
	mchecksum
;

444 
u16
 
	mvîsi⁄
;

445 
u8
 
	m›C≠Fœgs
;

446 
u8
 
	mìpMisc
;

447 
u16
 
	mªgDmn
[2];

448 
u8
 
	mmacAddr
[6];

449 
u8
 
	mrxMask
;

450 
u8
 
	mtxMask
;

451 
u16
 
	mrfSûít
;

452 
u16
 
	mblueToŸhO±i⁄s
;

453 
u16
 
	mdevi˚C≠
;

454 
u32
 
	mböBuûdNumbî
;

455 
u8
 
	mdevi˚Ty≥
;

456 
u8
 
	m›íLo›PwrC¡l
;

457 
öt8_t
 
	mpwrTabÀOff£t
;

458 
öt8_t
 
	mãmpSísSl›e
;

459 
öt8_t
 
	mãmpSísSl›ePÆOn
;

460 
u8
 
	mfutuªBa£
[29];

461 } 
	g__∑cked
;

463 
	smodÆ_ìp_¨9287_hódî
 {

464 
u32
 
	m™tCålChaö
[
AR9287_MAX_CHAINS
];

465 
u32
 
	m™tCålComm⁄
;

466 
öt8_t
 
	m™ã¬aGaöCh
[
AR9287_MAX_CHAINS
];

467 
u8
 
	mswôchSëéög
;

468 
u8
 
	mtxRxAâíCh
[
AR9287_MAX_CHAINS
];

469 
u8
 
	mrxTxM¨göCh
[
AR9287_MAX_CHAINS
];

470 
öt8_t
 
	madcDesúedSize
;

471 
u8
 
	mtxEndToX∑Off
;

472 
u8
 
	mtxEndToRxOn
;

473 
u8
 
	mtxFømeToX∑On
;

474 
u8
 
	mthªsh62
;

475 
öt8_t
 
	mnoi£Flo‹ThªshCh
[
AR9287_MAX_CHAINS
];

476 
u8
 
	mxpdGaö
;

477 
u8
 
	mxpd
;

478 
öt8_t
 
	miqCÆICh
[
AR9287_MAX_CHAINS
];

479 
öt8_t
 
	miqCÆQCh
[
AR9287_MAX_CHAINS
];

480 
u8
 
	mpdGaöOvîœp
;

481 
u8
 
	mx∑BüsLvl
;

482 
u8
 
	mtxFømeToD©aSèπ
;

483 
u8
 
	mtxFømeToPaOn
;

484 
u8
 
	mht40PowîIncF‹Pdadc
;

485 
u8
 
	mbswAâí
[
AR9287_MAX_CHAINS
];

486 
u8
 
	mbswM¨gö
[
AR9287_MAX_CHAINS
];

487 
u8
 
	mswSëéeHt40
;

488 
u8
 
	mvîsi⁄
;

489 
u8
 
	mdb1
;

490 
u8
 
	mdb2
;

491 
u8
 
	mob_cck
;

492 
u8
 
	mob_psk
;

493 
u8
 
	mob_qam
;

494 
u8
 
	mob_∑l_off
;

495 
u8
 
	mfutuªModÆ
[30];

496 
•ur_ch™
 
	m•urCh™s
[
AR_EEPROM_MODAL_SPURS
];

497 } 
	g__∑cked
;

499 
	sˇl_d©a_≥r_‰eq
 {

500 
u8
 
	mpwrPdg
[
AR5416_NUM_PD_GAINS
][
AR5416_PD_GAIN_ICEPTS
];

501 
u8
 
	mvpdPdg
[
AR5416_NUM_PD_GAINS
][
AR5416_PD_GAIN_ICEPTS
];

502 } 
	g__∑cked
;

504 
	sˇl_d©a_≥r_‰eq_4k
 {

505 
u8
 
	mpwrPdg
[
AR5416_EEP4K_NUM_PD_GAINS
][
AR5416_PD_GAIN_ICEPTS
];

506 
u8
 
	mvpdPdg
[
AR5416_EEP4K_NUM_PD_GAINS
][
AR5416_PD_GAIN_ICEPTS
];

507 } 
	g__∑cked
;

509 
	sˇl_èrgë_powî_Àg
 {

510 
u8
 
	mbCh™√l
;

511 
u8
 
	mtPow2x
[4];

512 } 
	g__∑cked
;

514 
	sˇl_èrgë_powî_ht
 {

515 
u8
 
	mbCh™√l
;

516 
u8
 
	mtPow2x
[8];

517 } 
	g__∑cked
;

519 
	sˇl_˘l_edges
 {

520 
u8
 
	mbCh™√l
;

521 
u8
 
	m˘l
;

522 } 
	g__∑cked
;

524 
	sˇl_d©a_›_lo›_¨9287
 {

525 
u8
 
	mpwrPdg
[2][5];

526 
u8
 
	mvpdPdg
[2][5];

527 
u8
 
	mpcdac
[2][5];

528 
u8
 
	mem±y
[2][5];

529 } 
	g__∑cked
;

531 
	sˇl_d©a_≥r_‰eq_¨9287
 {

532 
u8
 
	mpwrPdg
[
AR5416_NUM_PD_GAINS
][
AR9287_PD_GAIN_ICEPTS
];

533 
u8
 
	mvpdPdg
[
AR5416_NUM_PD_GAINS
][
AR9287_PD_GAIN_ICEPTS
];

534 } 
	g__∑cked
;

536 
	uˇl_d©a_≥r_‰eq_¨9287_u
 {

537 
ˇl_d©a_›_lo›_¨9287
 
	mˇlD©aO≥n
;

538 
ˇl_d©a_≥r_‰eq_¨9287
 
	mˇlD©aClo£
;

539 } 
	g__∑cked
;

541 
	sˇl_˘l_d©a_¨9287
 {

542 
ˇl_˘l_edges


543 
	m˘lEdges
[
AR9287_MAX_CHAINS
][
AR9287_NUM_BAND_EDGES
];

544 } 
	g__∑cked
;

546 
	sˇl_˘l_d©a
 {

547 
ˇl_˘l_edges


548 
	m˘lEdges
[
AR5416_MAX_CHAINS
][
AR5416_NUM_BAND_EDGES
];

549 } 
	g__∑cked
;

551 
	sˇl_˘l_d©a_4k
 {

552 
ˇl_˘l_edges


553 
	m˘lEdges
[
AR5416_EEP4K_MAX_CHAINS
][
AR5416_EEP4K_NUM_BAND_EDGES
];

554 } 
	g__∑cked
;

556 
	s¨5416_ì¥om_def
 {

557 
ba£_ìp_hódî
 
	mba£EïHódî
;

558 
u8
 
	mcu°D©a
[64];

559 
modÆ_ìp_hódî
 
	mmodÆHódî
[2];

560 
u8
 
	mˇlFªqPõr5G
[
AR5416_NUM_5G_CAL_PIERS
];

561 
u8
 
	mˇlFªqPõr2G
[
AR5416_NUM_2G_CAL_PIERS
];

562 
ˇl_d©a_≥r_‰eq


563 
	mˇlPõrD©a5G
[
AR5416_MAX_CHAINS
][
AR5416_NUM_5G_CAL_PIERS
];

564 
ˇl_d©a_≥r_‰eq


565 
	mˇlPõrD©a2G
[
AR5416_MAX_CHAINS
][
AR5416_NUM_2G_CAL_PIERS
];

566 
ˇl_èrgë_powî_Àg


567 
	mˇlT¨gëPowî5G
[
AR5416_NUM_5G_20_TARGET_POWERS
];

568 
ˇl_èrgë_powî_ht


569 
	mˇlT¨gëPowî5GHT20
[
AR5416_NUM_5G_20_TARGET_POWERS
];

570 
ˇl_èrgë_powî_ht


571 
	mˇlT¨gëPowî5GHT40
[
AR5416_NUM_5G_40_TARGET_POWERS
];

572 
ˇl_èrgë_powî_Àg


573 
	mˇlT¨gëPowîCck
[
AR5416_NUM_2G_CCK_TARGET_POWERS
];

574 
ˇl_èrgë_powî_Àg


575 
	mˇlT¨gëPowî2G
[
AR5416_NUM_2G_20_TARGET_POWERS
];

576 
ˇl_èrgë_powî_ht


577 
	mˇlT¨gëPowî2GHT20
[
AR5416_NUM_2G_20_TARGET_POWERS
];

578 
ˇl_èrgë_powî_ht


579 
	mˇlT¨gëPowî2GHT40
[
AR5416_NUM_2G_40_TARGET_POWERS
];

580 
u8
 
	m˘lIndex
[
AR5416_NUM_CTLS
];

581 
ˇl_˘l_d©a
 
	m˘lD©a
[
AR5416_NUM_CTLS
];

582 
u8
 
	m∑ddög
;

583 } 
	g__∑cked
;

585 
	s¨5416_ì¥om_4k
 {

586 
ba£_ìp_hódî_4k
 
	mba£EïHódî
;

587 
u8
 
	mcu°D©a
[20];

588 
modÆ_ìp_4k_hódî
 
	mmodÆHódî
;

589 
u8
 
	mˇlFªqPõr2G
[
AR5416_EEP4K_NUM_2G_CAL_PIERS
];

590 
ˇl_d©a_≥r_‰eq_4k


591 
	mˇlPõrD©a2G
[
AR5416_EEP4K_MAX_CHAINS
][
AR5416_EEP4K_NUM_2G_CAL_PIERS
];

592 
ˇl_èrgë_powî_Àg


593 
	mˇlT¨gëPowîCck
[
AR5416_EEP4K_NUM_2G_CCK_TARGET_POWERS
];

594 
ˇl_èrgë_powî_Àg


595 
	mˇlT¨gëPowî2G
[
AR5416_EEP4K_NUM_2G_20_TARGET_POWERS
];

596 
ˇl_èrgë_powî_ht


597 
	mˇlT¨gëPowî2GHT20
[
AR5416_EEP4K_NUM_2G_20_TARGET_POWERS
];

598 
ˇl_èrgë_powî_ht


599 
	mˇlT¨gëPowî2GHT40
[
AR5416_EEP4K_NUM_2G_40_TARGET_POWERS
];

600 
u8
 
	m˘lIndex
[
AR5416_EEP4K_NUM_CTLS
];

601 
ˇl_˘l_d©a_4k
 
	m˘lD©a
[
AR5416_EEP4K_NUM_CTLS
];

602 
u8
 
	m∑ddög
;

603 } 
	g__∑cked
;

605 
	s¨9287_ì¥om
 {

606 
ba£_ìp_¨9287_hódî
 
	mba£EïHódî
;

607 
u8
 
	mcu°D©a
[
AR9287_DATA_SZ
];

608 
modÆ_ìp_¨9287_hódî
 
	mmodÆHódî
;

609 
u8
 
	mˇlFªqPõr2G
[
AR9287_NUM_2G_CAL_PIERS
];

610 
ˇl_d©a_≥r_‰eq_¨9287_u


611 
	mˇlPõrD©a2G
[
AR9287_MAX_CHAINS
][
AR9287_NUM_2G_CAL_PIERS
];

612 
ˇl_èrgë_powî_Àg


613 
	mˇlT¨gëPowîCck
[
AR9287_NUM_2G_CCK_TARGET_POWERS
];

614 
ˇl_èrgë_powî_Àg


615 
	mˇlT¨gëPowî2G
[
AR9287_NUM_2G_20_TARGET_POWERS
];

616 
ˇl_èrgë_powî_ht


617 
	mˇlT¨gëPowî2GHT20
[
AR9287_NUM_2G_20_TARGET_POWERS
];

618 
ˇl_èrgë_powî_ht


619 
	mˇlT¨gëPowî2GHT40
[
AR9287_NUM_2G_40_TARGET_POWERS
];

620 
u8
 
	m˘lIndex
[
AR9287_NUM_CTLS
];

621 
ˇl_˘l_d©a_¨9287
 
	m˘lD©a
[
AR9287_NUM_CTLS
];

622 
u8
 
	m∑ddög
;

623 } 
	g__∑cked
;

625 
	eªg_ext_bôm≠
 {

626 
	mREG_EXT_FCC_MIDBAND
 = 0,

627 
	mREG_EXT_JAPAN_MIDBAND
 = 1,

628 
	mREG_EXT_FCC_DFS_HT40
 = 2,

629 
	mREG_EXT_JAPAN_NONDFS_HT40
 = 3,

630 
	mREG_EXT_JAPAN_DFS_HT40
 = 4

633 
	s©h9k_cou¡ry_íåy
 {

634 
u16
 
	mcou¡ryCode
;

635 
u16
 
	mªgDmnEnum
;

636 
u16
 
	mªgDmn5G
;

637 
u16
 
	mªgDmn2G
;

638 
u8
 
	misMu…idomaö
;

639 
u8
 
	miso
[3];

642 
	sì¥om_›s
 {

643 (*
	mcheck_ì¥om
)(
©h_hw
 *
	mhw
);

644 
u32
 (*
gë_ì¥om
)(
©h_hw
 *
	mhw
, 
ì¥om_∑øm
 
	m∑øm
);

645 
boﬁ
 (*
fûl_ì¥om
)(
©h_hw
 *
	mhw
);

646 
u32
 (*
dump_ì¥om
)(
©h_hw
 *
	mhw
, 
boﬁ
 
	mdump_ba£_hdr
, 
u8
 *
	mbuf
,

647 
u32
 
	mÀn
, u32 
	msize
);

648 (*
	mgë_ì¥om_vî
)(
©h_hw
 *
	mhw
);

649 (*
	mgë_ì¥om_ªv
)(
©h_hw
 *
	mhw
);

650 (*
	m£t_bﬂrd_vÆues
)(
©h_hw
 *
	mhw
, 
©h9k_ch™√l
 *
	mch™
);

651 (*
	m£t_addac
)(
©h_hw
 *
	mhw
, 
©h9k_ch™√l
 *
	mch™
);

652 (*
	m£t_txpowî
)(
©h_hw
 *
	mhw
, 
©h9k_ch™√l
 *
	mch™
,

653 
u16
 
	mcfgCé
, 
u8
 
	mtwi˚A¡í«Redu˘i⁄
,

654 
u8
 
	mpowîLimô
, 
boﬁ
 
	mã°
);

655 
u16
 (*
gë_•ur_ch™√l
)(
©h_hw
 *
	mah
, u16 
	mi
, 
boﬁ
 
	mis2GHz
);

658 
©h9k_hw_™Æog_shi·_ªgwrôe
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
vÆ
);

659 
©h9k_hw_™Æog_shi·_rmw
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
mask
,

660 
u32
 
shi·
, u32 
vÆ
);

661 
öt16_t
 
©h9k_hw_öãΩﬁ©e
(
u16
 
èrgë
, u16 
§cLe·
, u16 
§cRight
,

662 
öt16_t
 
èrgëLe·
,

663 
öt16_t
 
èrgëRight
);

664 
boﬁ
 
©h9k_hw_gë_lowî_uµî_ödex
(
u8
 
èrgë
, u8 *
pLi°
, 
u16
 
li°Size
,

665 
u16
 *
ödexL
, u16 *
ödexR
);

666 
boﬁ
 
©h9k_hw_nvøm_ªad
(
©h_hw
 *
ah
, 
u32
 
off
, 
u16
 *
d©a
);

667 
©h9k_hw_nvøm_sw≠_d©a
(
©h_hw
 *
ah
, 
boﬁ
 *
sw≠_√eded
, 
size
);

668 
boﬁ
 
©h9k_hw_nvøm_vÆid©e_checksum
(
©h_hw
 *
ah
, 
size
);

669 
boﬁ
 
©h9k_hw_nvøm_check_vîsi⁄
(
©h_hw
 *
ah
, 
vîsi⁄
, 
möªv
);

670 
©h9k_hw_usb_gí_fûl_ì¥om
(
©h_hw
 *
ah
, 
u16
 *
ìp_d©a
,

671 
ìp_°¨t_loc
, 
size
);

672 
©h9k_hw_fûl_vpd_èbÀ
(
u8
 
pwrMö
, u8 
pwrMax
, u8 *
pPwrLi°
,

673 
u8
 *
pVpdLi°
, 
u16
 
numI¡î˚±s
,

674 
u8
 *
pRëVpdLi°
);

675 
©h9k_hw_gë_Àgacy_èrgë_powîs
(
©h_hw
 *
ah
,

676 
©h9k_ch™√l
 *
ch™
,

677 
ˇl_èrgë_powî_Àg
 *
powInfo
,

678 
u16
 
numCh™√ls
,

679 
ˇl_èrgë_powî_Àg
 *
pNewPowî
,

680 
u16
 
numR©es
, 
boﬁ
 
isExtT¨gë
);

681 
©h9k_hw_gë_èrgë_powîs
(
©h_hw
 *
ah
,

682 
©h9k_ch™√l
 *
ch™
,

683 
ˇl_èrgë_powî_ht
 *
powInfo
,

684 
u16
 
numCh™√ls
,

685 
ˇl_èrgë_powî_ht
 *
pNewPowî
,

686 
u16
 
numR©es
, 
boﬁ
 
isHt40T¨gë
);

687 
u16
 
©h9k_hw_gë_max_edge_powî
(u16 
‰eq
, 
ˇl_˘l_edges
 *
pRdEdgesPowî
,

688 
boﬁ
 
is2GHz
, 
num_b™d_edges
);

689 
u16
 
©h9k_hw_gë_sˇÀd_powî
(
©h_hw
 *
ah
, u16 
powî_limô
,

690 
u8
 
™ã¬a_ªdu˘i⁄
);

691 
©h9k_hw_upd©e_ªguœt‹y_maxpowî
(
©h_hw
 *
ah
);

692 
©h9k_hw_ì¥om_öô
(
©h_hw
 *
ah
);

694 
©h9k_hw_gë_gaö_bound¨õs_pdadcs
(
©h_hw
 *
ah
,

695 
©h9k_ch™√l
 *
ch™
,

696 *
pRawD©aSë
,

697 
u8
 *
bCh™s
, 
u16
 
avaûPõrs
,

698 
u16
 
tPdGaöOvîœp
,

699 
u16
 *
pPdGaöBound¨õs
, 
u8
 *
pPDADCVÆues
,

700 
u16
 
numXpdGaös
);

702 
ölöe
 
u16
 
	$©h9k_hw_fbö2‰eq
(
u8
 
fbö
, 
boﬁ
 
is2GHz
)

704 i‡(
fbö
 =
AR5416_BCHAN_UNUSED
)

705  
fbö
;

707  (
u16
Ë((
is2GHz
Ë? (2300 + 
fbö
) : (4800 + 5 * fbin));

708 
	}
}

710 
	#¨5416_gë_¡xchaös
(
_txchaömask
) \

711 (((
_txchaömask
 >> 2) & 1) + \

712 ((
_txchaömask
 >> 1Ë& 1Ë+ (_txchaömask & 1))

	)

714 c⁄° 
ì¥om_›s
 
ìp_def_›s
;

715 c⁄° 
ì¥om_›s
 
ìp_4k_›s
;

716 c⁄° 
ì¥om_›s
 
ìp_¨9287_›s
;

717 c⁄° 
ì¥om_›s
 
ìp_¨9287_›s
;

718 c⁄° 
ì¥om_›s
 
ìp_¨9300_›s
;

	@eeprom_4k.c

17 
	~<asm/u«lig√d.h
>

18 
	~"hw.h
"

19 
	~"¨9002_phy.h
"

21 
	$©h9k_hw_4k_gë_ì¥om_vî
(
©h_hw
 *
ah
)

23  ((
ah
->
ì¥om
.
m≠4k
.
ba£EïHódî
.
vîsi⁄
 >> 12) & 0xF);

24 
	}
}

26 
	$©h9k_hw_4k_gë_ì¥om_ªv
(
©h_hw
 *
ah
)

28  ((
ah
->
ì¥om
.
m≠4k
.
ba£EïHódî
.
vîsi⁄
) & 0xFFF);

29 
	}
}

31 
	#SIZE_EEPROM_4K
 ((
¨5416_ì¥om_4k
Ë/ (
u16
))

	)

33 
boﬁ
 
	$__©h9k_hw_4k_fûl_ì¥om
(
©h_hw
 *
ah
)

35 
u16
 *
ìp_d©a
 = (u16 *)&
ah
->
ì¥om
.
m≠4k
;

36 
addr
, 
ìp_°¨t_loc
 = 64;

38 
addr
 = 0;ádd∏< 
SIZE_EEPROM_4K
;áddr++) {

39 i‡(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
addr
 + 
ìp_°¨t_loc
, 
ìp_d©a
))

40  
Ál£
;

41 
ìp_d©a
++;

44  
åue
;

45 
	}
}

47 
boﬁ
 
	$__©h9k_hw_usb_4k_fûl_ì¥om
(
©h_hw
 *
ah
)

49 
u16
 *
ìp_d©a
 = (u16 *)&
ah
->
ì¥om
.
m≠4k
;

51 
	`©h9k_hw_usb_gí_fûl_ì¥om
(
ah
, 
ìp_d©a
, 64, 
SIZE_EEPROM_4K
);

53  
åue
;

54 
	}
}

56 
boﬁ
 
	$©h9k_hw_4k_fûl_ì¥om
(
©h_hw
 *
ah
)

58 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

60 i‡(!
	`©h9k_hw_u£_Êash
(
ah
)) {

61 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Reading from EEPROM,Çot flash\n");

64 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
)

65  
	`__©h9k_hw_usb_4k_fûl_ì¥om
(
ah
);

67  
	`__©h9k_hw_4k_fûl_ì¥om
(
ah
);

68 
	}
}

70 #i‡
deföed
(
CPTCFG_ATH9K_DEBUGFS
Ë|| deföed(
CPTCFG_ATH9K_HTC_DEBUGFS
)

71 
u32
 
	$©h9k_dump_4k_modÆ_ì¥om
(*
buf
, 
u32
 
Àn
, u32 
size
,

72 
modÆ_ìp_4k_hódî
 *
modÆ_hdr
)

74 
	`PR_EEP
("Chaö0 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[0]);

75 
	`PR_EEP
("A¡. Comm⁄ C⁄åﬁ", 
modÆ_hdr
->
™tCålComm⁄
);

76 
	`PR_EEP
("Chaö0 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[0]);

77 
	`PR_EEP
("Swôch Sëée", 
modÆ_hdr
->
swôchSëéög
);

78 
	`PR_EEP
("Chaö0 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[0]);

79 
	`PR_EEP
("Chaö0 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[0]);

80 
	`PR_EEP
("ADC Desúed size", 
modÆ_hdr
->
adcDesúedSize
);

81 
	`PR_EEP
("PGA Desúed size", 
modÆ_hdr
->
pgaDesúedSize
);

82 
	`PR_EEP
("Chaö0 x ®Gaö", 
modÆ_hdr
->
x aGaöCh
[0]);

83 
	`PR_EEP
("txEndToX∑Off", 
modÆ_hdr
->
txEndToX∑Off
);

84 
	`PR_EEP
("txEndToRxOn", 
modÆ_hdr
->
txEndToRxOn
);

85 
	`PR_EEP
("txFømeToX∑On", 
modÆ_hdr
->
txFømeToX∑On
);

86 
	`PR_EEP
("CCA Thªshﬁd)", 
modÆ_hdr
->
thªsh62
);

87 
	`PR_EEP
("Chaö0 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[0]);

88 
	`PR_EEP
("xpdGaö", 
modÆ_hdr
->
xpdGaö
);

89 
	`PR_EEP
("Exã∫Æ PD", 
modÆ_hdr
->
xpd
);

90 
	`PR_EEP
("Chaö0 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[0]);

91 
	`PR_EEP
("Chaö0 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[0]);

92 
	`PR_EEP
("pdGaöOvîœp", 
modÆ_hdr
->
pdGaöOvîœp
);

93 
	`PR_EEP
("O/D Bü†Vîsi⁄", 
modÆ_hdr
->
vîsi⁄
);

94 
	`PR_EEP
("CCK OuçutBüs", 
modÆ_hdr
->
ob_0
);

95 
	`PR_EEP
("BPSK OuçutBüs", 
modÆ_hdr
->
ob_1
);

96 
	`PR_EEP
("QPSK OuçutBüs", 
modÆ_hdr
->
ob_2
);

97 
	`PR_EEP
("16QAM OuçutBüs", 
modÆ_hdr
->
ob_3
);

98 
	`PR_EEP
("64QAM OuçutBüs", 
modÆ_hdr
->
ob_4
);

99 
	`PR_EEP
("CCK Drivî1_Büs", 
modÆ_hdr
->
db1_0
);

100 
	`PR_EEP
("BPSK Drivî1_Büs", 
modÆ_hdr
->
db1_1
);

101 
	`PR_EEP
("QPSK Drivî1_Büs", 
modÆ_hdr
->
db1_2
);

102 
	`PR_EEP
("16QAM Drivî1_Büs", 
modÆ_hdr
->
db1_3
);

103 
	`PR_EEP
("64QAM Drivî1_Büs", 
modÆ_hdr
->
db1_4
);

104 
	`PR_EEP
("CCK Drivî2_Büs", 
modÆ_hdr
->
db2_0
);

105 
	`PR_EEP
("BPSK Drivî2_Büs", 
modÆ_hdr
->
db2_1
);

106 
	`PR_EEP
("QPSK Drivî2_Büs", 
modÆ_hdr
->
db2_2
);

107 
	`PR_EEP
("16QAM Drivî2_Büs", 
modÆ_hdr
->
db2_3
);

108 
	`PR_EEP
("64QAM Drivî2_Büs", 
modÆ_hdr
->
db2_4
);

109 
	`PR_EEP
("xPA Bü†Levñ", 
modÆ_hdr
->
x∑BüsLvl
);

110 
	`PR_EEP
("txFømeToD©aSèπ", 
modÆ_hdr
->
txFømeToD©aSèπ
);

111 
	`PR_EEP
("txFømeToPaOn", 
modÆ_hdr
->
txFømeToPaOn
);

112 
	`PR_EEP
("HT40 Powî Inc.", 
modÆ_hdr
->
ht40PowîIncF‹Pdadc
);

113 
	`PR_EEP
("Chaö0 bswAâí", 
modÆ_hdr
->
bswAâí
[0]);

114 
	`PR_EEP
("Chaö0 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[0]);

115 
	`PR_EEP
("HT40 Swôch Sëée", 
modÆ_hdr
->
swSëéeHt40
);

116 
	`PR_EEP
("Chaö0 x©ãn2Db", 
modÆ_hdr
->
x©ãn2Db
[0]);

117 
	`PR_EEP
("Chaö0 x©ãn2M¨gö", 
modÆ_hdr
->
x©ãn2M¨gö
[0]);

118 
	`PR_EEP
("A¡. Divîsôy cé1", 
modÆ_hdr
->
™tdiv_˘l1
);

119 
	`PR_EEP
("A¡. Divîsôy cé2", 
modÆ_hdr
->
™tdiv_˘l2
);

120 
	`PR_EEP
("TX Divîsôy", 
modÆ_hdr
->
tx_divîsôy
);

122  
Àn
;

123 
	}
}

125 
u32
 
	$©h9k_hw_4k_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

126 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

128 
¨5416_ì¥om_4k
 *
ìp
 = &
ah
->
ì¥om
.
m≠4k
;

129 
ba£_ìp_hódî_4k
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

131 i‡(!
dump_ba£_hdr
) {

132 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

134 
Àn
 = 
	`©h9k_dump_4k_modÆ_ì¥om
(
buf
,Üí, 
size
,

135 &
ìp
->
modÆHódî
);

136 
out
;

139 
	`PR_EEP
("Maj‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 >> 12);

140 
	`PR_EEP
("Mö‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 & 0xFFF);

141 
	`PR_EEP
("Checksum", 
pBa£
->
checksum
);

142 
	`PR_EEP
("Lígth", 
pBa£
->
Àngth
);

143 
	`PR_EEP
("RegDomaö1", 
pBa£
->
ªgDmn
[0]);

144 
	`PR_EEP
("RegDomaö2", 
pBa£
->
ªgDmn
[1]);

145 
	`PR_EEP
("TX Mask", 
pBa£
->
txMask
);

146 
	`PR_EEP
("RX Mask", 
pBa£
->
rxMask
);

147 
	`PR_EEP
("AŒow 5GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11A
));

148 
	`PR_EEP
("AŒow 2GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11G
));

149 
	`PR_EEP
("DißbÀ 2GHz HT20", !!(
pBa£
->
›C≠Fœgs
 &

150 
AR5416_OPFLAGS_N_2G_HT20
));

151 
	`PR_EEP
("DißbÀ 2GHz HT40", !!(
pBa£
->
›C≠Fœgs
 &

152 
AR5416_OPFLAGS_N_2G_HT40
));

153 
	`PR_EEP
("DißbÀ 5Ghz HT20", !!(
pBa£
->
›C≠Fœgs
 &

154 
AR5416_OPFLAGS_N_5G_HT20
));

155 
	`PR_EEP
("DißbÀ 5Ghz HT40", !!(
pBa£
->
›C≠Fœgs
 &

156 
AR5416_OPFLAGS_N_5G_HT40
));

157 
	`PR_EEP
("Big Endün", !!(
pBa£
->
ìpMisc
 & 0x01));

158 
	`PR_EEP
("CÆ Bö Maj‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 24) & 0xFF);

159 
	`PR_EEP
("CÆ Bö Mö‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 16) & 0xFF);

160 
	`PR_EEP
("CÆ Bö Buûd", (
pBa£
->
böBuûdNumbî
 >> 8) & 0xFF);

161 
	`PR_EEP
("TX GaöÅy≥", 
pBa£
->
txGaöTy≥
);

163 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%20s : %pM\n", "MacAddress",

164 
pBa£
->
macAddr
);

166 
out
:

167 i‡(
Àn
 > 
size
)

168 
Àn
 = 
size
;

170  
Àn
;

171 
	}
}

173 
u32
 
	$©h9k_hw_4k_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

174 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

177 
	}
}

180 
	$©h9k_hw_4k_check_ì¥om
(
©h_hw
 *
ah
)

182 
¨5416_ì¥om_4k
 *
ìp
 = &
ah
->
ì¥om
.
m≠4k
;

183 
u32
 
ñ
;

184 
boﬁ
 
√ed_sw≠
;

185 
i
, 
îr
;

187 
îr
 = 
	`©h9k_hw_nvøm_sw≠_d©a
(
ah
, &
√ed_sw≠
, 
SIZE_EEPROM_4K
);

188 i‡(
îr
)

189  
îr
;

191 i‡(
√ed_sw≠
)

192 
ñ
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

194 
ñ
 = 
ìp
->
ba£EïHódî
.
Àngth
;

196 
ñ
 = 
	`mö
”»/ (
u16
), 
SIZE_EEPROM_4K
);

197 i‡(!
	`©h9k_hw_nvøm_vÆid©e_checksum
(
ah
, 
ñ
))

198  -
EINVAL
;

200 i‡(
√ed_sw≠
) {

201 
u32
 
öãgî
;

202 
u16
 
w‹d
;

204 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

205 
ìp
->
ba£EïHódî
.
Àngth
 = 
w‹d
;

207 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
checksum
);

208 
ìp
->
ba£EïHódî
.
checksum
 = 
w‹d
;

210 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
vîsi⁄
);

211 
ìp
->
ba£EïHódî
.
vîsi⁄
 = 
w‹d
;

213 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[0]);

214 
ìp
->
ba£EïHódî
.
ªgDmn
[0] = 
w‹d
;

216 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[1]);

217 
ìp
->
ba£EïHódî
.
ªgDmn
[1] = 
w‹d
;

219 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
rfSûít
);

220 
ìp
->
ba£EïHódî
.
rfSûít
 = 
w‹d
;

222 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
);

223 
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
 = 
w‹d
;

225 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
devi˚C≠
);

226 
ìp
->
ba£EïHódî
.
devi˚C≠
 = 
w‹d
;

228 
öãgî
 = 
	`swab32
(
ìp
->
modÆHódî
.
™tCålComm⁄
);

229 
ìp
->
modÆHódî
.
™tCålComm⁄
 = 
öãgî
;

231 
i
 = 0; i < 
AR5416_EEP4K_MAX_CHAINS
; i++) {

232 
öãgî
 = 
	`swab32
(
ìp
->
modÆHódî
.
™tCålChaö
[
i
]);

233 
ìp
->
modÆHódî
.
™tCålChaö
[
i
] = 
öãgî
;

236 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
; i++) {

237 
w‹d
 = 
	`swab16
(
ìp
->
modÆHódî
.
•urCh™s
[
i
].
•urCh™
);

238 
ìp
->
modÆHódî
.
•urCh™s
[
i
].
•urCh™
 = 
w‹d
;

242 i‡(!
	`©h9k_hw_nvøm_check_vîsi⁄
(
ah
, 
AR5416_EEP_VER
,

243 
AR5416_EEP_NO_BACK_VER
))

244  -
EINVAL
;

247 
	}
}

249 #unde‡
SIZE_EEPROM_4K


251 
u32
 
	$©h9k_hw_4k_gë_ì¥om
(
©h_hw
 *
ah
,

252 
ì¥om_∑øm
 
∑øm
)

254 
¨5416_ì¥om_4k
 *
ìp
 = &
ah
->
ì¥om
.
m≠4k
;

255 
modÆ_ìp_4k_hódî
 *
pModÆ
 = &
ìp
->
modÆHódî
;

256 
ba£_ìp_hódî_4k
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

257 
u16
 
vî_mö‹
;

259 
vî_mö‹
 = 
pBa£
->
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
;

261 
∑øm
) {

262 
EEP_NFTHRESH_2
:

263  
pModÆ
->
noi£Flo‹ThªshCh
[0];

264 
EEP_MAC_LSW
:

265  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
);

266 
EEP_MAC_MID
:

267  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 2);

268 
EEP_MAC_MSW
:

269  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 4);

270 
EEP_REG_0
:

271  
pBa£
->
ªgDmn
[0];

272 
EEP_OP_CAP
:

273  
pBa£
->
devi˚C≠
;

274 
EEP_OP_MODE
:

275  
pBa£
->
›C≠Fœgs
;

276 
EEP_RF_SILENT
:

277  
pBa£
->
rfSûít
;

278 
EEP_OB_2
:

279  
pModÆ
->
ob_0
;

280 
EEP_DB_2
:

281  
pModÆ
->
db1_1
;

282 
EEP_MINOR_REV
:

283  
vî_mö‹
;

284 
EEP_TX_MASK
:

285  
pBa£
->
txMask
;

286 
EEP_RX_MASK
:

287  
pBa£
->
rxMask
;

288 
EEP_FRAC_N_5G
:

290 
EEP_PWR_TABLE_OFFSET
:

291  
AR5416_PWR_TABLE_OFFSET_DB
;

292 
EEP_MODAL_VER
:

293  
pModÆ
->
vîsi⁄
;

294 
EEP_ANT_DIV_CTL1
:

295  
pModÆ
->
™tdiv_˘l1
;

296 
EEP_TXGAIN_TYPE
:

297  
pBa£
->
txGaöTy≥
;

298 
EEP_ANTENNA_GAIN_2G
:

299  
pModÆ
->
™ã¬aGaöCh
[0];

303 
	}
}

305 
	$©h9k_hw_£t_4k_powî_ˇl_èbÀ
(
©h_hw
 *
ah
,

306 
©h9k_ch™√l
 *
ch™
)

308 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

309 
¨5416_ì¥om_4k
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠4k
;

310 
ˇl_d©a_≥r_‰eq_4k
 *
pRawD©a£t
;

311 
u8
 *
pCÆBCh™s
 = 
NULL
;

312 
u16
 
pdGaöOvîœp_t2
;

313 
u8
 
pdadcVÆues
[
AR5416_NUM_PDADC_VALUES
];

314 
u16
 
gaöBound¨õs
[
AR5416_PD_GAINS_IN_MASK
];

315 
u16
 
numPõrs
, 
i
, 
j
;

316 
u16
 
numXpdGaö
, 
xpdMask
;

317 
u16
 
xpdGaöVÆues
[
AR5416_EEP4K_NUM_PD_GAINS
] = { 0, 0 };

318 
u32
 
ªg32
, 
ªgOff£t
, 
ªgChaöOff£t
;

320 
xpdMask
 = 
pEïD©a
->
modÆHódî
.
xpdGaö
;

322 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

323 
AR5416_EEP_MINOR_VER_2
) {

324 
pdGaöOvîœp_t2
 =

325 
pEïD©a
->
modÆHódî
.
pdGaöOvîœp
;

327 
pdGaöOvîœp_t2
 = (
u16
)(
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_TPCRG5
),

328 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
));

331 
pCÆBCh™s
 = 
pEïD©a
->
ˇlFªqPõr2G
;

332 
numPõrs
 = 
AR5416_EEP4K_NUM_2G_CAL_PIERS
;

334 
numXpdGaö
 = 0;

336 
i
 = 1; i <
AR5416_PD_GAINS_IN_MASK
; i++) {

337 i‡((
xpdMask
 >> (
AR5416_PD_GAINS_IN_MASK
 - 
i
)) & 1) {

338 i‡(
numXpdGaö
 >
AR5416_EEP4K_NUM_PD_GAINS
)

340 
xpdGaöVÆues
[
numXpdGaö
] =

341 (
u16
)(
AR5416_PD_GAINS_IN_MASK
 - 
i
);

342 
numXpdGaö
++;

346 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

347 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_NUM_PD_GAIN
,

348 (
numXpdGaö
 - 1) & 0x3);

349 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_1
,

350 
xpdGaöVÆues
[0]);

351 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_2
,

352 
xpdGaöVÆues
[1]);

353 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_3
, 0);

354 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

356 
i
 = 0; i < 
AR5416_EEP4K_MAX_CHAINS
; i++) {

357 
ªgChaöOff£t
 = 
i
 * 0x1000;

359 i‡(
pEïD©a
->
ba£EïHódî
.
txMask
 & (1 << 
i
)) {

360 
pRawD©a£t
 = 
pEïD©a
->
ˇlPõrD©a2G
[
i
];

362 
	`©h9k_hw_gë_gaö_bound¨õs_pdadcs
(
ah
, 
ch™
,

363 
pRawD©a£t
, 
pCÆBCh™s
,

364 
numPõrs
, 
pdGaöOvîœp_t2
,

365 
gaöBound¨õs
,

366 
pdadcVÆues
, 
numXpdGaö
);

368 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

370 
	`REG_WRITE
(
ah
, 
AR_PHY_TPCRG5
 + 
ªgChaöOff£t
,

371 
	`SM
(
pdGaöOvîœp_t2
,

372 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
)

373 | 
	`SM
(
gaöBound¨õs
[0],

374 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1
)

375 | 
	`SM
(
gaöBound¨õs
[1],

376 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2
)

377 | 
	`SM
(
gaöBound¨õs
[2],

378 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3
)

379 | 
	`SM
(
gaöBound¨õs
[3],

380 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4
));

382 
ªgOff£t
 = 
AR_PHY_BASE
 + (672 << 2Ë+ 
ªgChaöOff£t
;

383 
j
 = 0; j < 32; j++) {

384 
ªg32
 = 
	`gë_u«lig√d_À32
(&
pdadcVÆues
[4 * 
j
]);

385 
	`REG_WRITE
(
ah
, 
ªgOff£t
, 
ªg32
);

387 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

389 
i
, 
ªgChaöOff£t
, 
ªgOff£t
,

390 
ªg32
);

391 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

397 
i
, 4 * 
j
, 
pdadcVÆues
[4 * j],

398 4 * 
j
 + 1, 
pdadcVÆues
[4 * j + 1],

399 4 * 
j
 + 2, 
pdadcVÆues
[4 * j + 2],

400 4 * 
j
 + 3, 
pdadcVÆues
[4 * j + 3]);

402 
ªgOff£t
 += 4;

405 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

408 
	}
}

410 
	$©h9k_hw_£t_4k_powî_≥r_øã_èbÀ
(
©h_hw
 *
ah
,

411 
©h9k_ch™√l
 *
ch™
,

412 
öt16_t
 *
øãsAºay
,

413 
u16
 
cfgCé
,

414 
u16
 
™ã¬a_ªdu˘i⁄
,

415 
u16
 
powîLimô
)

417 
	#CMP_TEST_GRP
 \

418 (((
cfgCé
 & ~
CTL_MODE_M
)| (
pCéMode
[
˘lMode
] & CTL_MODE_M)) == \

419 
pEïD©a
->
˘lIndex
[
i
]) \

420 || (((
cfgCé
 & ~
CTL_MODE_M
Ë| (
pCéMode
[
˘lMode
] & CTL_MODE_M)) == \

421 ((
pEïD©a
->
˘lIndex
[
i
] & 
CTL_MODE_M
Ë| 
SD_NO_CTL
))

	)

423 
i
;

424 
u16
 
twi˚MöEdgePowî
;

425 
u16
 
twi˚MaxEdgePowî
;

426 
u16
 
sˇÀdPowî
 = 0, 
möCéPowî
;

427 
u16
 
numCéModes
;

428 c⁄° 
u16
 *
pCéMode
;

429 
u16
 
˘lMode
, 
‰eq
;

430 
ch™_˚¡îs
 
˚¡îs
;

431 
ˇl_˘l_d©a_4k
 *
ªp
;

432 
¨5416_ì¥om_4k
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠4k
;

433 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdm
, 
èrgëPowîCck
 = {

436 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdmExt
 = {

437 0, { 0, 0, 0, 0} }, 
èrgëPowîCckExt
 = {

440 
ˇl_èrgë_powî_ht
 
èrgëPowîHt20
, 
èrgëPowîHt40
 = {

443 c⁄° 
u16
 
˘lModesF‹11g
[] = {

444 
CTL_11B
, 
CTL_11G
, 
CTL_2GHT20
,

445 
CTL_11B_EXT
, 
CTL_11G_EXT
, 
CTL_2GHT40


448 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

450 
sˇÀdPowî
 = 
powîLimô
 - 
™ã¬a_ªdu˘i⁄
;

451 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
Ë- 
SUB_NUM_CTL_MODES_AT_2G_40
;

452 
pCéMode
 = 
˘lModesF‹11g
;

454 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

455 
pEïD©a
->
ˇlT¨gëPowîCck
,

456 
AR5416_NUM_2G_CCK_TARGET_POWERS
,

457 &
èrgëPowîCck
, 4, 
Ál£
);

458 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

459 
pEïD©a
->
ˇlT¨gëPowî2G
,

460 
AR5416_NUM_2G_20_TARGET_POWERS
,

461 &
èrgëPowîOfdm
, 4, 
Ál£
);

462 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

463 
pEïD©a
->
ˇlT¨gëPowî2GHT20
,

464 
AR5416_NUM_2G_20_TARGET_POWERS
,

465 &
èrgëPowîHt20
, 8, 
Ál£
);

467 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

468 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
);

469 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

470 
pEïD©a
->
ˇlT¨gëPowî2GHT40
,

471 
AR5416_NUM_2G_40_TARGET_POWERS
,

472 &
èrgëPowîHt40
, 8, 
åue
);

473 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

474 
pEïD©a
->
ˇlT¨gëPowîCck
,

475 
AR5416_NUM_2G_CCK_TARGET_POWERS
,

476 &
èrgëPowîCckExt
, 4, 
åue
);

477 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

478 
pEïD©a
->
ˇlT¨gëPowî2G
,

479 
AR5416_NUM_2G_20_TARGET_POWERS
,

480 &
èrgëPowîOfdmExt
, 4, 
åue
);

483 
˘lMode
 = 0; céModê< 
numCéModes
; ctlMode++) {

484 
boﬁ
 
isHt40CéMode
 = (
pCéMode
[
˘lMode
] =
CTL_5GHT40
) ||

485 (
pCéMode
[
˘lMode
] =
CTL_2GHT40
);

487 i‡(
isHt40CéMode
)

488 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

489 i‡(
pCéMode
[
˘lMode
] & 
EXT_ADDITIVE
)

490 
‰eq
 = 
˚¡îs
.
ext_˚¡î
;

492 
‰eq
 = 
˚¡îs
.
˘l_˚¡î
;

494 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

496 
i
 = 0; (ò< 
AR5416_EEP4K_NUM_CTLS
) &&

497 
pEïD©a
->
˘lIndex
[
i
]; i++) {

499 i‡(
CMP_TEST_GRP
) {

500 
ªp
 = &(
pEïD©a
->
˘lD©a
[
i
]);

502 
twi˚MöEdgePowî
 = 
	`©h9k_hw_gë_max_edge_powî
(

503 
‰eq
,

504 
ªp
->
˘lEdges
[

505 
	`¨5416_gë_¡xchaös
(
ah
->
txchaömask
) - 1],

506 
	`IS_CHAN_2GHZ
(
ch™
),

507 
AR5416_EEP4K_NUM_BAND_EDGES
);

509 i‡((
cfgCé
 & ~
CTL_MODE_M
Ë=
SD_NO_CTL
) {

510 
twi˚MaxEdgePowî
 =

511 
	`mö
(
twi˚MaxEdgePowî
,

512 
twi˚MöEdgePowî
);

514 
twi˚MaxEdgePowî
 = 
twi˚MöEdgePowî
;

520 
möCéPowî
 = (
u8
)
	`mö
(
twi˚MaxEdgePowî
, 
sˇÀdPowî
);

522 
pCéMode
[
˘lMode
]) {

523 
CTL_11B
:

524 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîCck
.
tPow2x
); i++) {

525 
èrgëPowîCck
.
tPow2x
[
i
] =

526 
	`mö
((
u16
)
èrgëPowîCck
.
tPow2x
[
i
],

527 
möCéPowî
);

530 
CTL_11G
:

531 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîOfdm
.
tPow2x
); i++) {

532 
èrgëPowîOfdm
.
tPow2x
[
i
] =

533 
	`mö
((
u16
)
èrgëPowîOfdm
.
tPow2x
[
i
],

534 
möCéPowî
);

537 
CTL_2GHT20
:

538 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++) {

539 
èrgëPowîHt20
.
tPow2x
[
i
] =

540 
	`mö
((
u16
)
èrgëPowîHt20
.
tPow2x
[
i
],

541 
möCéPowî
);

544 
CTL_11B_EXT
:

545 
èrgëPowîCckExt
.
tPow2x
[0] =

546 
	`mö
((
u16
)
èrgëPowîCckExt
.
tPow2x
[0],

547 
möCéPowî
);

549 
CTL_11G_EXT
:

550 
èrgëPowîOfdmExt
.
tPow2x
[0] =

551 
	`mö
((
u16
)
èrgëPowîOfdmExt
.
tPow2x
[0],

552 
möCéPowî
);

554 
CTL_2GHT40
:

555 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++) {

556 
èrgëPowîHt40
.
tPow2x
[
i
] =

557 
	`mö
((
u16
)
èrgëPowîHt40
.
tPow2x
[
i
],

558 
möCéPowî
);

566 
øãsAºay
[
øã6mb
] =

567 
øãsAºay
[
øã9mb
] =

568 
øãsAºay
[
øã12mb
] =

569 
øãsAºay
[
øã18mb
] =

570 
øãsAºay
[
øã24mb
] =

571 
èrgëPowîOfdm
.
tPow2x
[0];

573 
øãsAºay
[
øã36mb
] = 
èrgëPowîOfdm
.
tPow2x
[1];

574 
øãsAºay
[
øã48mb
] = 
èrgëPowîOfdm
.
tPow2x
[2];

575 
øãsAºay
[
øã54mb
] = 
èrgëPowîOfdm
.
tPow2x
[3];

576 
øãsAºay
[
øãXr
] = 
èrgëPowîOfdm
.
tPow2x
[0];

578 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++)

579 
øãsAºay
[
øãHt20_0
 + 
i
] = 
èrgëPowîHt20
.
tPow2x
[i];

581 
øãsAºay
[
øã1l
] = 
èrgëPowîCck
.
tPow2x
[0];

582 
øãsAºay
[
øã2s
] =Ñ©esAºay[
øã2l
] = 
èrgëPowîCck
.
tPow2x
[1];

583 
øãsAºay
[
øã5_5s
] =Ñ©esAºay[
øã5_5l
] = 
èrgëPowîCck
.
tPow2x
[2];

584 
øãsAºay
[
øã11s
] =Ñ©esAºay[
øã11l
] = 
èrgëPowîCck
.
tPow2x
[3];

586 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

587 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++) {

588 
øãsAºay
[
øãHt40_0
 + 
i
] =

589 
èrgëPowîHt40
.
tPow2x
[
i
];

591 
øãsAºay
[
øãDupOfdm
] = 
èrgëPowîHt40
.
tPow2x
[0];

592 
øãsAºay
[
øãDupCck
] = 
èrgëPowîHt40
.
tPow2x
[0];

593 
øãsAºay
[
øãExtOfdm
] = 
èrgëPowîOfdmExt
.
tPow2x
[0];

594 
øãsAºay
[
øãExtCck
] = 
èrgëPowîCckExt
.
tPow2x
[0];

597 #unde‡
CMP_TEST_GRP


598 
	}
}

600 
	$©h9k_hw_4k_£t_txpowî
(
©h_hw
 *
ah
,

601 
©h9k_ch™√l
 *
ch™
,

602 
u16
 
cfgCé
,

603 
u8
 
twi˚A¡í«Redu˘i⁄
,

604 
u8
 
powîLimô
, 
boﬁ
 
ã°
)

606 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

607 
¨5416_ì¥om_4k
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠4k
;

608 
modÆ_ìp_4k_hódî
 *
pModÆ
 = &
pEïD©a
->
modÆHódî
;

609 
öt16_t
 
øãsAºay
[
Ar5416R©eSize
];

610 
u8
 
ht40PowîIncF‹Pdadc
 = 2;

611 
i
;

613 
	`mem£t
(
øãsAºay
, 0, (ratesArray));

615 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

616 
AR5416_EEP_MINOR_VER_2
) {

617 
ht40PowîIncF‹Pdadc
 = 
pModÆ
->ht40PowerIncForPdadc;

620 
	`©h9k_hw_£t_4k_powî_≥r_øã_èbÀ
(
ah
, 
ch™
,

621 &
øãsAºay
[0], 
cfgCé
,

622 
twi˚A¡í«Redu˘i⁄
,

623 
powîLimô
);

625 
	`©h9k_hw_£t_4k_powî_ˇl_èbÀ
(
ah
, 
ch™
);

627 
ªguœt‹y
->
max_powî_Àvñ
 = 0;

628 
i
 = 0; i < 
	`ARRAY_SIZE
(
øãsAºay
); i++) {

629 i‡(
øãsAºay
[
i
] > 
MAX_RATE_POWER
)

630 
øãsAºay
[
i
] = 
MAX_RATE_POWER
;

632 i‡(
øãsAºay
[
i
] > 
ªguœt‹y
->
max_powî_Àvñ
)

633 
ªguœt‹y
->
max_powî_Àvñ
 = 
øãsAºay
[
i
];

636 i‡(
ã°
)

639 
i
 = 0; i < 
Ar5416R©eSize
; i++)

640 
øãsAºay
[
i
] -
AR5416_PWR_TABLE_OFFSET_DB
 * 2;

642 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

645 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE1
,

646 
	`ATH9K_POW_SM
(
øãsAºay
[
øã18mb
], 24)

647 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã12mb
], 16)

648 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã9mb
], 8)

649 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã6mb
], 0));

650 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE2
,

651 
	`ATH9K_POW_SM
(
øãsAºay
[
øã54mb
], 24)

652 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã48mb
], 16)

653 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã36mb
], 8)

654 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã24mb
], 0));

657 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE3
,

658 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2s
], 24)

659 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2l
], 16)

660 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãXr
], 8)

661 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã1l
], 0));

662 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE4
,

663 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11s
], 24)

664 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11l
], 16)

665 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5s
], 8)

666 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5l
], 0));

669 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE5
,

670 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_3
], 24)

671 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_2
], 16)

672 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_1
], 8)

673 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_0
], 0));

674 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE6
,

675 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_7
], 24)

676 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_6
], 16)

677 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_5
], 8)

678 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_4
], 0));

681 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

682 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE7
,

683 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_3
] +

684 
ht40PowîIncF‹Pdadc
, 24)

685 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_2
] +

686 
ht40PowîIncF‹Pdadc
, 16)

687 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_1
] +

688 
ht40PowîIncF‹Pdadc
, 8)

689 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_0
] +

690 
ht40PowîIncF‹Pdadc
, 0));

691 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE8
,

692 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_7
] +

693 
ht40PowîIncF‹Pdadc
, 24)

694 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_6
] +

695 
ht40PowîIncF‹Pdadc
, 16)

696 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_5
] +

697 
ht40PowîIncF‹Pdadc
, 8)

698 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_4
] +

699 
ht40PowîIncF‹Pdadc
, 0));

700 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE9
,

701 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtOfdm
], 24)

702 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtCck
], 16)

703 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupOfdm
], 8)

704 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupCck
], 0));

708 i‡(
ah
->
çc_íabÀd
) {

709 
ht40_dñè
;

711 
ht40_dñè
 = (
	`IS_CHAN_HT40
(
ch™
)Ë? 
ht40PowîIncF‹Pdadc
 : 0;

712 
	`¨5008_hw_öô_øã_txpowî
(
ah
, 
øãsAºay
, 
ch™
, 
ht40_dñè
);

714 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
,

715 
MAX_RATE_POWER
 | 
AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
);

718 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
, 
MAX_RATE_POWER
);

721 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

722 
	}
}

724 
	$©h9k_hw_4k_£t_gaö
(
©h_hw
 *
ah
,

725 
modÆ_ìp_4k_hódî
 *
pModÆ
,

726 
¨5416_ì¥om_4k
 *
ìp
,

727 
u8
 
txRxAâíLoˇl
)

729 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

730 
	`REG_RMW
(
ah
, 
AR_PHY_SWITCH_CHAIN_0
,

731 
pModÆ
->
™tCålChaö
[0], 0);

733 
	`REG_RMW
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0),

734 
	`SM
(
pModÆ
->
iqCÆICh
[0], 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
) |

735 
	`SM
(
pModÆ
->
iqCÆQCh
[0], 
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
),

736 
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
 | 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
);

738 i‡((
ìp
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

739 
AR5416_EEP_MINOR_VER_3
) {

740 
txRxAâíLoˇl
 = 
pModÆ
->
txRxAâíCh
[0];

742 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
,

743 
AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN
, 
pModÆ
->
bswM¨gö
[0]);

744 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
,

745 
AR_PHY_GAIN_2GHZ_XATTEN1_DB
, 
pModÆ
->
bswAâí
[0]);

746 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
,

747 
AR_PHY_GAIN_2GHZ_XATTEN2_MARGIN
,

748 
pModÆ
->
x©ãn2M¨gö
[0]);

749 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
,

750 
AR_PHY_GAIN_2GHZ_XATTEN2_DB
, 
pModÆ
->
x©ãn2Db
[0]);

753 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 0x1000,

754 
AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN
,

755 
pModÆ
->
bswM¨gö
[0]);

756 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 0x1000,

757 
AR_PHY_GAIN_2GHZ_XATTEN1_DB
, 
pModÆ
->
bswAâí
[0]);

758 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 0x1000,

759 
AR_PHY_GAIN_2GHZ_XATTEN2_MARGIN
,

760 
pModÆ
->
x©ãn2M¨gö
[0]);

761 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 0x1000,

762 
AR_PHY_GAIN_2GHZ_XATTEN2_DB
,

763 
pModÆ
->
x©ãn2Db
[0]);

766 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
,

767 
AR9280_PHY_RXGAIN_TXRX_ATTEN
, 
txRxAâíLoˇl
);

768 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
,

769 
AR9280_PHY_RXGAIN_TXRX_MARGIN
, 
pModÆ
->
rxTxM¨göCh
[0]);

771 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
 + 0x1000,

772 
AR9280_PHY_RXGAIN_TXRX_ATTEN
, 
txRxAâíLoˇl
);

773 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
 + 0x1000,

774 
AR9280_PHY_RXGAIN_TXRX_MARGIN
, 
pModÆ
->
rxTxM¨göCh
[0]);

775 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

776 
	}
}

782 
	$©h9k_hw_4k_£t_bﬂrd_vÆues
(
©h_hw
 *
ah
,

783 
©h9k_ch™√l
 *
ch™
)

785 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

786 
modÆ_ìp_4k_hódî
 *
pModÆ
;

787 
¨5416_ì¥om_4k
 *
ìp
 = &
ah
->
ì¥om
.
m≠4k
;

788 
ba£_ìp_hódî_4k
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

789 
u8
 
txRxAâíLoˇl
;

790 
u8
 
ob
[5], 
db1
[5], 
db2
[5];

791 
u8
 
™t_div_c⁄åﬁ1
, 
™t_div_c⁄åﬁ2
;

792 
u8
 
bb_desúed_sˇÀ
;

793 
u32
 
ªgVÆ
;

795 
pModÆ
 = &
ìp
->
modÆHódî
;

796 
txRxAâíLoˇl
 = 23;

798 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_COM
, 
pModÆ
->
™tCålComm⁄
);

801 
	`©h9k_hw_4k_£t_gaö
(
ah
, 
pModÆ
, 
ìp
, 
txRxAâíLoˇl
);

804 i‡(
pModÆ
->
vîsi⁄
 >= 3) {

805 
™t_div_c⁄åﬁ1
 = 
pModÆ
->
™tdiv_˘l1
;

806 
™t_div_c⁄åﬁ2
 = 
pModÆ
->
™tdiv_˘l2
;

808 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

809 
ªgVÆ
 &(~(
AR_PHY_9285_ANT_DIV_CTL_ALL
));

811 
ªgVÆ
 |
	`SM
(
™t_div_c⁄åﬁ1
,

812 
AR_PHY_9285_ANT_DIV_CTL
);

813 
ªgVÆ
 |
	`SM
(
™t_div_c⁄åﬁ2
,

814 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
);

815 
ªgVÆ
 |
	`SM
((
™t_div_c⁄åﬁ2
 >> 2),

816 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
);

817 
ªgVÆ
 |
	`SM
((
™t_div_c⁄åﬁ1
 >> 1),

818 
AR_PHY_9285_ANT_DIV_ALT_GAINTB
);

819 
ªgVÆ
 |
	`SM
((
™t_div_c⁄åﬁ1
 >> 2),

820 
AR_PHY_9285_ANT_DIV_MAIN_GAINTB
);

823 
	`REG_WRITE
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
, 
ªgVÆ
);

824 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

825 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_DETECT
);

826 
ªgVÆ
 &(~
AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
);

827 
ªgVÆ
 |
	`SM
((
™t_div_c⁄åﬁ1
 >> 3),

828 
AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV
);

830 
	`REG_WRITE
(
ah
, 
AR_PHY_CCK_DETECT
, 
ªgVÆ
);

831 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_CCK_DETECT
);

833 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
) {

838 
ªgVÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
);

839 
ªgVÆ
 &(~(
AR_PHY_9285_ANT_DIV_MAIN_LNACONF
 |

840 
AR_PHY_9285_ANT_DIV_ALT_LNACONF
));

842 
ªgVÆ
 |(
ATH_ANT_DIV_COMB_LNA1
 <<

843 
AR_PHY_9285_ANT_DIV_MAIN_LNACONF_S
);

844 
ªgVÆ
 |(
ATH_ANT_DIV_COMB_LNA2
 <<

845 
AR_PHY_9285_ANT_DIV_ALT_LNACONF_S
);

846 
ªgVÆ
 &(~(
AR_PHY_9285_FAST_DIV_BIAS
));

847 
ªgVÆ
 |(0 << 
AR_PHY_9285_FAST_DIV_BIAS_S
);

848 
	`REG_WRITE
(
ah
, 
AR_PHY_MULTICHAIN_GAIN_CTL
, 
ªgVÆ
);

852 i‡(
pModÆ
->
vîsi⁄
 >= 2) {

853 
ob
[0] = 
pModÆ
->
ob_0
;

854 
ob
[1] = 
pModÆ
->
ob_1
;

855 
ob
[2] = 
pModÆ
->
ob_2
;

856 
ob
[3] = 
pModÆ
->
ob_3
;

857 
ob
[4] = 
pModÆ
->
ob_4
;

859 
db1
[0] = 
pModÆ
->
db1_0
;

860 
db1
[1] = 
pModÆ
->
db1_1
;

861 
db1
[2] = 
pModÆ
->
db1_2
;

862 
db1
[3] = 
pModÆ
->
db1_3
;

863 
db1
[4] = 
pModÆ
->
db1_4
;

865 
db2
[0] = 
pModÆ
->
db2_0
;

866 
db2
[1] = 
pModÆ
->
db2_1
;

867 
db2
[2] = 
pModÆ
->
db2_2
;

868 
db2
[3] = 
pModÆ
->
db2_3
;

869 
db2
[4] = 
pModÆ
->
db2_4
;

870 } i‡(
pModÆ
->
vîsi⁄
 == 1) {

871 
ob
[0] = 
pModÆ
->
ob_0
;

872 
ob
[1] = ob[2] = ob[3] = ob[4] = 
pModÆ
->
ob_1
;

873 
db1
[0] = 
pModÆ
->
db1_0
;

874 
db1
[1] = db1[2] = db1[3] = db1[4] = 
pModÆ
->
db1_1
;

875 
db2
[0] = 
pModÆ
->
db2_0
;

876 
db2
[1] = db2[2] = db2[3] = db2[4] = 
pModÆ
->
db2_1
;

878 
i
;

880 
i
 = 0; i < 5; i++) {

881 
ob
[
i
] = 
pModÆ
->
ob_0
;

882 
db1
[
i
] = 
pModÆ
->
db1_0
;

883 
db2
[
i
] = 
pModÆ
->
db1_0
;

887 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

888 i‡(
	`AR_SREV_9271
(
ah
)) {

889 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

890 
AR9285_AN_RF2G3
,

891 
AR9271_AN_RF2G3_OB_cck
,

892 
AR9271_AN_RF2G3_OB_cck_S
,

893 
ob
[0]);

894 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

895 
AR9285_AN_RF2G3
,

896 
AR9271_AN_RF2G3_OB_psk
,

897 
AR9271_AN_RF2G3_OB_psk_S
,

898 
ob
[1]);

899 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

900 
AR9285_AN_RF2G3
,

901 
AR9271_AN_RF2G3_OB_qam
,

902 
AR9271_AN_RF2G3_OB_qam_S
,

903 
ob
[2]);

904 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

905 
AR9285_AN_RF2G3
,

906 
AR9271_AN_RF2G3_DB_1
,

907 
AR9271_AN_RF2G3_DB_1_S
,

908 
db1
[0]);

909 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

910 
AR9285_AN_RF2G4
,

911 
AR9271_AN_RF2G4_DB_2
,

912 
AR9271_AN_RF2G4_DB_2_S
,

913 
db2
[0]);

915 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

916 
AR9285_AN_RF2G3
,

917 
AR9285_AN_RF2G3_OB_0
,

918 
AR9285_AN_RF2G3_OB_0_S
,

919 
ob
[0]);

920 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

921 
AR9285_AN_RF2G3
,

922 
AR9285_AN_RF2G3_OB_1
,

923 
AR9285_AN_RF2G3_OB_1_S
,

924 
ob
[1]);

925 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

926 
AR9285_AN_RF2G3
,

927 
AR9285_AN_RF2G3_OB_2
,

928 
AR9285_AN_RF2G3_OB_2_S
,

929 
ob
[2]);

930 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

931 
AR9285_AN_RF2G3
,

932 
AR9285_AN_RF2G3_OB_3
,

933 
AR9285_AN_RF2G3_OB_3_S
,

934 
ob
[3]);

935 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

936 
AR9285_AN_RF2G3
,

937 
AR9285_AN_RF2G3_OB_4
,

938 
AR9285_AN_RF2G3_OB_4_S
,

939 
ob
[4]);

941 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

942 
AR9285_AN_RF2G3
,

943 
AR9285_AN_RF2G3_DB1_0
,

944 
AR9285_AN_RF2G3_DB1_0_S
,

945 
db1
[0]);

946 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

947 
AR9285_AN_RF2G3
,

948 
AR9285_AN_RF2G3_DB1_1
,

949 
AR9285_AN_RF2G3_DB1_1_S
,

950 
db1
[1]);

951 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

952 
AR9285_AN_RF2G3
,

953 
AR9285_AN_RF2G3_DB1_2
,

954 
AR9285_AN_RF2G3_DB1_2_S
,

955 
db1
[2]);

956 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

957 
AR9285_AN_RF2G4
,

958 
AR9285_AN_RF2G4_DB1_3
,

959 
AR9285_AN_RF2G4_DB1_3_S
,

960 
db1
[3]);

961 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

962 
AR9285_AN_RF2G4
,

963 
AR9285_AN_RF2G4_DB1_4
,

964 
AR9285_AN_RF2G4_DB1_4_S
, 
db1
[4]);

966 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

967 
AR9285_AN_RF2G4
,

968 
AR9285_AN_RF2G4_DB2_0
,

969 
AR9285_AN_RF2G4_DB2_0_S
,

970 
db2
[0]);

971 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

972 
AR9285_AN_RF2G4
,

973 
AR9285_AN_RF2G4_DB2_1
,

974 
AR9285_AN_RF2G4_DB2_1_S
,

975 
db2
[1]);

976 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

977 
AR9285_AN_RF2G4
,

978 
AR9285_AN_RF2G4_DB2_2
,

979 
AR9285_AN_RF2G4_DB2_2_S
,

980 
db2
[2]);

981 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

982 
AR9285_AN_RF2G4
,

983 
AR9285_AN_RF2G4_DB2_3
,

984 
AR9285_AN_RF2G4_DB2_3_S
,

985 
db2
[3]);

986 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
,

987 
AR9285_AN_RF2G4
,

988 
AR9285_AN_RF2G4_DB2_4
,

989 
AR9285_AN_RF2G4_DB2_4_S
,

990 
db2
[4]);

992 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

994 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

995 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
, 
AR_PHY_SETTLING_SWITCH
,

996 
pModÆ
->
swôchSëéög
);

997 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_DESIRED_SZ
, 
AR_PHY_DESIRED_SZ_ADC
,

998 
pModÆ
->
adcDesúedSize
);

1000 
	`REG_RMW
(
ah
, 
AR_PHY_RF_CTL4
,

1001 
	`SM
(
pModÆ
->
txEndToX∑Off
, 
AR_PHY_RF_CTL4_TX_END_XPAA_OFF
) |

1002 
	`SM
(
pModÆ
->
txEndToX∑Off
, 
AR_PHY_RF_CTL4_TX_END_XPAB_OFF
) |

1003 
	`SM
(
pModÆ
->
txFømeToX∑On
, 
AR_PHY_RF_CTL4_FRAME_XPAA_ON
) |

1004 
	`SM
(
pModÆ
->
txFømeToX∑On
, 
AR_PHY_RF_CTL4_FRAME_XPAB_ON
), 0);

1006 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL3
, 
AR_PHY_TX_END_TO_A2_RX_ON
,

1007 
pModÆ
->
txEndToRxOn
);

1009 i‡(
	`AR_SREV_9271_10
(
ah
))

1010 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL3
, 
AR_PHY_TX_END_TO_A2_RX_ON
,

1011 
pModÆ
->
txEndToRxOn
);

1012 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCA
, 
AR9280_PHY_CCA_THRESH62
,

1013 
pModÆ
->
thªsh62
);

1014 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA0
, 
AR_PHY_EXT_CCA0_THRESH62
,

1015 
pModÆ
->
thªsh62
);

1017 i‡((
ìp
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

1018 
AR5416_EEP_MINOR_VER_2
) {

1019 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
, 
AR_PHY_TX_END_DATA_START
,

1020 
pModÆ
->
txFømeToD©aSèπ
);

1021 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
, 
AR_PHY_TX_END_PA_ON
,

1022 
pModÆ
->
txFømeToPaOn
);

1025 i‡((
ìp
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

1026 
AR5416_EEP_MINOR_VER_3
) {

1027 i‡(
	`IS_CHAN_HT40
(
ch™
))

1028 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
,

1029 
AR_PHY_SETTLING_SWITCH
,

1030 
pModÆ
->
swSëéeHt40
);

1033 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

1035 
bb_desúed_sˇÀ
 = (
pModÆ
->
bb_sˇÀ_smπ_™ã¬a
 &

1036 
EEP_4K_BB_DESIRED_SCALE_MASK
);

1037 i‡((
pBa£
->
txGaöTy≥
 =0Ë&& (
bb_desúed_sˇÀ
 != 0)) {

1038 
u32
 
pwr˘æ
, 
mask
, 
˛r
;

1040 
mask
 = 
	`BIT
(0)|BIT(5)|BIT(10)|BIT(15)|BIT(20)|BIT(25);

1041 
pwr˘æ
 = 
mask
 * 
bb_desúed_sˇÀ
;

1042 
˛r
 = 
mask
 * 0x1f;

1043 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

1044 
	`REG_RMW
(
ah
, 
AR_PHY_TX_PWRCTRL8
, 
pwr˘æ
, 
˛r
);

1045 
	`REG_RMW
(
ah
, 
AR_PHY_TX_PWRCTRL10
, 
pwr˘æ
, 
˛r
);

1046 
	`REG_RMW
(
ah
, 
AR_PHY_CH0_TX_PWRCTRL12
, 
pwr˘æ
, 
˛r
);

1048 
mask
 = 
	`BIT
(0)|BIT(5)|BIT(15);

1049 
pwr˘æ
 = 
mask
 * 
bb_desúed_sˇÀ
;

1050 
˛r
 = 
mask
 * 0x1f;

1051 
	`REG_RMW
(
ah
, 
AR_PHY_TX_PWRCTRL9
, 
pwr˘æ
, 
˛r
);

1053 
mask
 = 
	`BIT
(0)|BIT(5);

1054 
pwr˘æ
 = 
mask
 * 
bb_desúed_sˇÀ
;

1055 
˛r
 = 
mask
 * 0x1f;

1056 
	`REG_RMW
(
ah
, 
AR_PHY_CH0_TX_PWRCTRL11
, 
pwr˘æ
, 
˛r
);

1057 
	`REG_RMW
(
ah
, 
AR_PHY_CH0_TX_PWRCTRL13
, 
pwr˘æ
, 
˛r
);

1058 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

1060 
	}
}

1062 
u16
 
	$©h9k_hw_4k_gë_•ur_ch™√l
(
©h_hw
 *
ah
, 
u16
 
i
, 
boﬁ
 
is2GHz
)

1064  
ah
->
ì¥om
.
m≠4k
.
modÆHódî
.
•urCh™s
[
i
].
•urCh™
;

1065 
	}
}

1067 c⁄° 
ì¥om_›s
 
	gìp_4k_›s
 = {

1068 .
check_ì¥om
 = 
©h9k_hw_4k_check_ì¥om
,

1069 .
	ggë_ì¥om
 = 
©h9k_hw_4k_gë_ì¥om
,

1070 .
	gfûl_ì¥om
 = 
©h9k_hw_4k_fûl_ì¥om
,

1071 .
	gdump_ì¥om
 = 
©h9k_hw_4k_dump_ì¥om
,

1072 .
	ggë_ì¥om_vî
 = 
©h9k_hw_4k_gë_ì¥om_vî
,

1073 .
	ggë_ì¥om_ªv
 = 
©h9k_hw_4k_gë_ì¥om_ªv
,

1074 .
	g£t_bﬂrd_vÆues
 = 
©h9k_hw_4k_£t_bﬂrd_vÆues
,

1075 .
	g£t_txpowî
 = 
©h9k_hw_4k_£t_txpowî
,

1076 .
	ggë_•ur_ch™√l
 = 
©h9k_hw_4k_gë_•ur_ch™√l


	@eeprom_9287.c

17 
	~<asm/u«lig√d.h
>

18 
	~"hw.h
"

19 
	~"¨9002_phy.h
"

21 
	#SIZE_EEPROM_AR9287
 ((
¨9287_ì¥om
Ë/ (
u16
))

	)

23 
	$©h9k_hw_¨9287_gë_ì¥om_vî
(
©h_hw
 *
ah
)

25  (
ah
->
ì¥om
.
m≠9287
.
ba£EïHódî
.
vîsi⁄
 >> 12) & 0xF;

26 
	}
}

28 
	$©h9k_hw_¨9287_gë_ì¥om_ªv
(
©h_hw
 *
ah
)

30  (
ah
->
ì¥om
.
m≠9287
.
ba£EïHódî
.
vîsi⁄
) & 0xFFF;

31 
	}
}

33 
boﬁ
 
	$__©h9k_hw_¨9287_fûl_ì¥om
(
©h_hw
 *
ah
)

35 
¨9287_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
m≠9287
;

36 
u16
 *
ìp_d©a
;

37 
addr
, 
ìp_°¨t_loc
 = 
AR9287_EEP_START_LOC
;

38 
ìp_d©a
 = (
u16
 *)
ìp
;

40 
addr
 = 0;ádd∏< 
SIZE_EEPROM_AR9287
;áddr++) {

41 i‡(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
addr
 + 
ìp_°¨t_loc
, 
ìp_d©a
))

42  
Ál£
;

43 
ìp_d©a
++;

46  
åue
;

47 
	}
}

49 
boﬁ
 
	$__©h9k_hw_usb_¨9287_fûl_ì¥om
(
©h_hw
 *
ah
)

51 
u16
 *
ìp_d©a
 = (u16 *)&
ah
->
ì¥om
.
m≠9287
;

53 
	`©h9k_hw_usb_gí_fûl_ì¥om
(
ah
, 
ìp_d©a
,

54 
AR9287_HTC_EEP_START_LOC
,

55 
SIZE_EEPROM_AR9287
);

56  
åue
;

57 
	}
}

59 
boﬁ
 
	$©h9k_hw_¨9287_fûl_ì¥om
(
©h_hw
 *
ah
)

61 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

63 i‡(!
	`©h9k_hw_u£_Êash
(
ah
)) {

64 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Reading from EEPROM,Çot flash\n");

67 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
)

68  
	`__©h9k_hw_usb_¨9287_fûl_ì¥om
(
ah
);

70  
	`__©h9k_hw_¨9287_fûl_ì¥om
(
ah
);

71 
	}
}

73 #i‡
deföed
(
CPTCFG_ATH9K_DEBUGFS
Ë|| deföed(
CPTCFG_ATH9K_HTC_DEBUGFS
)

74 
u32
 
	$¨9287_dump_modÆ_ì¥om
(*
buf
, 
u32
 
Àn
, u32 
size
,

75 
modÆ_ìp_¨9287_hódî
 *
modÆ_hdr
)

77 
	`PR_EEP
("Chaö0 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[0]);

78 
	`PR_EEP
("Chaö1 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[1]);

79 
	`PR_EEP
("A¡. Comm⁄ C⁄åﬁ", 
modÆ_hdr
->
™tCålComm⁄
);

80 
	`PR_EEP
("Chaö0 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[0]);

81 
	`PR_EEP
("Chaö1 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[1]);

82 
	`PR_EEP
("Swôch Sëée", 
modÆ_hdr
->
swôchSëéög
);

83 
	`PR_EEP
("Chaö0 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[0]);

84 
	`PR_EEP
("Chaö1 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[1]);

85 
	`PR_EEP
("Chaö0 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[0]);

86 
	`PR_EEP
("Chaö1 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[1]);

87 
	`PR_EEP
("ADC Desúed size", 
modÆ_hdr
->
adcDesúedSize
);

88 
	`PR_EEP
("txEndToX∑Off", 
modÆ_hdr
->
txEndToX∑Off
);

89 
	`PR_EEP
("txEndToRxOn", 
modÆ_hdr
->
txEndToRxOn
);

90 
	`PR_EEP
("txFømeToX∑On", 
modÆ_hdr
->
txFømeToX∑On
);

91 
	`PR_EEP
("CCA Thªshﬁd)", 
modÆ_hdr
->
thªsh62
);

92 
	`PR_EEP
("Chaö0 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[0]);

93 
	`PR_EEP
("Chaö1 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[1]);

94 
	`PR_EEP
("xpdGaö", 
modÆ_hdr
->
xpdGaö
);

95 
	`PR_EEP
("Exã∫Æ PD", 
modÆ_hdr
->
xpd
);

96 
	`PR_EEP
("Chaö0 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[0]);

97 
	`PR_EEP
("Chaö1 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[1]);

98 
	`PR_EEP
("Chaö0 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[0]);

99 
	`PR_EEP
("Chaö1 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[1]);

100 
	`PR_EEP
("pdGaöOvîœp", 
modÆ_hdr
->
pdGaöOvîœp
);

101 
	`PR_EEP
("xPA Bü†Levñ", 
modÆ_hdr
->
x∑BüsLvl
);

102 
	`PR_EEP
("txFømeToD©aSèπ", 
modÆ_hdr
->
txFømeToD©aSèπ
);

103 
	`PR_EEP
("txFømeToPaOn", 
modÆ_hdr
->
txFømeToPaOn
);

104 
	`PR_EEP
("HT40 Powî Inc.", 
modÆ_hdr
->
ht40PowîIncF‹Pdadc
);

105 
	`PR_EEP
("Chaö0 bswAâí", 
modÆ_hdr
->
bswAâí
[0]);

106 
	`PR_EEP
("Chaö1 bswAâí", 
modÆ_hdr
->
bswAâí
[1]);

107 
	`PR_EEP
("Chaö0 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[0]);

108 
	`PR_EEP
("Chaö1 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[1]);

109 
	`PR_EEP
("HT40 Swôch Sëée", 
modÆ_hdr
->
swSëéeHt40
);

110 
	`PR_EEP
("AR92x7 Vîsi⁄", 
modÆ_hdr
->
vîsi⁄
);

111 
	`PR_EEP
("DrivîBüs1", 
modÆ_hdr
->
db1
);

112 
	`PR_EEP
("DrivîBüs2", 
modÆ_hdr
->
db1
);

113 
	`PR_EEP
("CCK OuçutBüs", 
modÆ_hdr
->
ob_cck
);

114 
	`PR_EEP
("PSK OuçutBüs", 
modÆ_hdr
->
ob_psk
);

115 
	`PR_EEP
("QAM OuçutBüs", 
modÆ_hdr
->
ob_qam
);

116 
	`PR_EEP
("PAL_OFF OuçutBüs", 
modÆ_hdr
->
ob_∑l_off
);

118  
Àn
;

119 
	}
}

121 
u32
 
	$©h9k_hw_¨9287_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

122 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

124 
¨9287_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
m≠9287
;

125 
ba£_ìp_¨9287_hódî
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

127 i‡(!
dump_ba£_hdr
) {

128 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

130 
Àn
 = 
	`¨9287_dump_modÆ_ì¥om
(
buf
,Üí, 
size
,

131 &
ìp
->
modÆHódî
);

132 
out
;

135 
	`PR_EEP
("Maj‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 >> 12);

136 
	`PR_EEP
("Mö‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 & 0xFFF);

137 
	`PR_EEP
("Checksum", 
pBa£
->
checksum
);

138 
	`PR_EEP
("Lígth", 
pBa£
->
Àngth
);

139 
	`PR_EEP
("RegDomaö1", 
pBa£
->
ªgDmn
[0]);

140 
	`PR_EEP
("RegDomaö2", 
pBa£
->
ªgDmn
[1]);

141 
	`PR_EEP
("TX Mask", 
pBa£
->
txMask
);

142 
	`PR_EEP
("RX Mask", 
pBa£
->
rxMask
);

143 
	`PR_EEP
("AŒow 5GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11A
));

144 
	`PR_EEP
("AŒow 2GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11G
));

145 
	`PR_EEP
("DißbÀ 2GHz HT20", !!(
pBa£
->
›C≠Fœgs
 &

146 
AR5416_OPFLAGS_N_2G_HT20
));

147 
	`PR_EEP
("DißbÀ 2GHz HT40", !!(
pBa£
->
›C≠Fœgs
 &

148 
AR5416_OPFLAGS_N_2G_HT40
));

149 
	`PR_EEP
("DißbÀ 5Ghz HT20", !!(
pBa£
->
›C≠Fœgs
 &

150 
AR5416_OPFLAGS_N_5G_HT20
));

151 
	`PR_EEP
("DißbÀ 5Ghz HT40", !!(
pBa£
->
›C≠Fœgs
 &

152 
AR5416_OPFLAGS_N_5G_HT40
));

153 
	`PR_EEP
("Big Endün", !!(
pBa£
->
ìpMisc
 & 0x01));

154 
	`PR_EEP
("CÆ Bö Maj‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 24) & 0xFF);

155 
	`PR_EEP
("CÆ Bö Mö‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 16) & 0xFF);

156 
	`PR_EEP
("CÆ Bö Buûd", (
pBa£
->
böBuûdNumbî
 >> 8) & 0xFF);

157 
	`PR_EEP
("Powî TabÀ Off£t", 
pBa£
->
pwrTabÀOff£t
);

158 
	`PR_EEP
("O≥nLo› Powî Cål", 
pBa£
->
›íLo›PwrC¡l
);

160 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%20s : %pM\n", "MacAddress",

161 
pBa£
->
macAddr
);

163 
out
:

164 i‡(
Àn
 > 
size
)

165 
Àn
 = 
size
;

167  
Àn
;

168 
	}
}

170 
u32
 
	$©h9k_hw_¨9287_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

171 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

174 
	}
}

178 
	$©h9k_hw_¨9287_check_ì¥om
(
©h_hw
 *
ah
)

180 
u32
 
ñ
, 
öãgî
;

181 
u16
 
w‹d
;

182 
i
, 
îr
;

183 
boﬁ
 
√ed_sw≠
;

184 
¨9287_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
m≠9287
;

186 
îr
 = 
	`©h9k_hw_nvøm_sw≠_d©a
(
ah
, &
√ed_sw≠
, 
SIZE_EEPROM_AR9287
);

187 i‡(
îr
)

188  
îr
;

190 i‡(
√ed_sw≠
)

191 
ñ
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

193 
ñ
 = 
ìp
->
ba£EïHódî
.
Àngth
;

195 
ñ
 = 
	`mö
”»/ (
u16
), 
SIZE_EEPROM_AR9287
);

196 i‡(!
	`©h9k_hw_nvøm_vÆid©e_checksum
(
ah
, 
ñ
))

197  -
EINVAL
;

199 i‡(
√ed_sw≠
) {

200 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

201 
ìp
->
ba£EïHódî
.
Àngth
 = 
w‹d
;

203 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
checksum
);

204 
ìp
->
ba£EïHódî
.
checksum
 = 
w‹d
;

206 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
vîsi⁄
);

207 
ìp
->
ba£EïHódî
.
vîsi⁄
 = 
w‹d
;

209 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[0]);

210 
ìp
->
ba£EïHódî
.
ªgDmn
[0] = 
w‹d
;

212 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[1]);

213 
ìp
->
ba£EïHódî
.
ªgDmn
[1] = 
w‹d
;

215 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
rfSûít
);

216 
ìp
->
ba£EïHódî
.
rfSûít
 = 
w‹d
;

218 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
);

219 
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
 = 
w‹d
;

221 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
devi˚C≠
);

222 
ìp
->
ba£EïHódî
.
devi˚C≠
 = 
w‹d
;

224 
öãgî
 = 
	`swab32
(
ìp
->
modÆHódî
.
™tCålComm⁄
);

225 
ìp
->
modÆHódî
.
™tCålComm⁄
 = 
öãgî
;

227 
i
 = 0; i < 
AR9287_MAX_CHAINS
; i++) {

228 
öãgî
 = 
	`swab32
(
ìp
->
modÆHódî
.
™tCålChaö
[
i
]);

229 
ìp
->
modÆHódî
.
™tCålChaö
[
i
] = 
öãgî
;

232 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
; i++) {

233 
w‹d
 = 
	`swab16
(
ìp
->
modÆHódî
.
•urCh™s
[
i
].
•urCh™
);

234 
ìp
->
modÆHódî
.
•urCh™s
[
i
].
•urCh™
 = 
w‹d
;

238 i‡(!
	`©h9k_hw_nvøm_check_vîsi⁄
(
ah
, 
AR9287_EEP_VER
,

239 
AR5416_EEP_NO_BACK_VER
))

240  -
EINVAL
;

243 
	}
}

245 #unde‡
SIZE_EEPROM_AR9287


247 
u32
 
	$©h9k_hw_¨9287_gë_ì¥om
(
©h_hw
 *
ah
,

248 
ì¥om_∑øm
 
∑øm
)

250 
¨9287_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
m≠9287
;

251 
modÆ_ìp_¨9287_hódî
 *
pModÆ
 = &
ìp
->
modÆHódî
;

252 
ba£_ìp_¨9287_hódî
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

253 
u16
 
vî_mö‹
;

255 
vî_mö‹
 = 
pBa£
->
vîsi⁄
 & 
AR9287_EEP_VER_MINOR_MASK
;

257 
∑øm
) {

258 
EEP_NFTHRESH_2
:

259  
pModÆ
->
noi£Flo‹ThªshCh
[0];

260 
EEP_MAC_LSW
:

261  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
);

262 
EEP_MAC_MID
:

263  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 2);

264 
EEP_MAC_MSW
:

265  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 4);

266 
EEP_REG_0
:

267  
pBa£
->
ªgDmn
[0];

268 
EEP_OP_CAP
:

269  
pBa£
->
devi˚C≠
;

270 
EEP_OP_MODE
:

271  
pBa£
->
›C≠Fœgs
;

272 
EEP_RF_SILENT
:

273  
pBa£
->
rfSûít
;

274 
EEP_MINOR_REV
:

275  
vî_mö‹
;

276 
EEP_TX_MASK
:

277  
pBa£
->
txMask
;

278 
EEP_RX_MASK
:

279  
pBa£
->
rxMask
;

280 
EEP_DEV_TYPE
:

281  
pBa£
->
devi˚Ty≥
;

282 
EEP_OL_PWRCTRL
:

283  
pBa£
->
›íLo›PwrC¡l
;

284 
EEP_TEMPSENSE_SLOPE
:

285 i‡(
vî_mö‹
 >
AR9287_EEP_MINOR_VER_2
)

286  
pBa£
->
ãmpSísSl›e
;

289 
EEP_TEMPSENSE_SLOPE_PAL_ON
:

290 i‡(
vî_mö‹
 >
AR9287_EEP_MINOR_VER_3
)

291  
pBa£
->
ãmpSísSl›ePÆOn
;

294 
EEP_ANTENNA_GAIN_2G
:

295  
	`max_t
(
u8
, 
pModÆ
->
™ã¬aGaöCh
[0],

296 
pModÆ
->
™ã¬aGaöCh
[1]);

300 
	}
}

302 
	$¨9287_ì¥om_gë_tx_gaö_ödex
(
©h_hw
 *
ah
,

303 
©h9k_ch™√l
 *
ch™
,

304 
ˇl_d©a_›_lo›_¨9287
 *
pRawD©a£tOpLo›
,

305 
u8
 *
pCÆCh™s
, 
u16
 
avaûPõrs
, 
öt8_t
 *
pPwr
)

307 
u16
 
idxL
 = 0, 
idxR
 = 0, 
numPõrs
;

308 
boﬁ
 
m©ch
;

309 
ch™_˚¡îs
 
˚¡îs
;

311 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

313 
numPõrs
 = 0;ÇumPõr†< 
avaûPõrs
;ÇumPiers++) {

314 i‡(
pCÆCh™s
[
numPõrs
] =
AR5416_BCHAN_UNUSED
)

318 
m©ch
 = 
	`©h9k_hw_gë_lowî_uµî_ödex
(

319 (
u8
)
	`FREQ2FBIN
(
˚¡îs
.
sy¡h_˚¡î
, 
	`IS_CHAN_2GHZ
(
ch™
)),

320 
pCÆCh™s
, 
numPõrs
, &
idxL
, &
idxR
);

322 i‡(
m©ch
) {

323 *
pPwr
 = (
öt8_t
Ë
pRawD©a£tOpLo›
[
idxL
].
pwrPdg
[0][0];

325 *
pPwr
 = ((
öt8_t
Ë
pRawD©a£tOpLo›
[
idxL
].
pwrPdg
[0][0] +

326 (
öt8_t
Ë
pRawD©a£tOpLo›
[
idxR
].
pwrPdg
[0][0])/2;

329 
	}
}

331 
	$¨9287_ì¥om_ﬁpc_£t_pdadcs
(
©h_hw
 *
ah
,

332 
öt32_t
 
txPowî
, 
u16
 
chaö
)

334 
u32
 
tmpVÆ
;

335 
u32
 
a
;

339 
tmpVÆ
 = 
	`REG_READ
(
ah
, 0xa270);

340 
tmpVÆ
 =ÅmpVal & 0xFCFFFFFF;

341 
tmpVÆ
 =ÅmpVal | (0x3 << 24);

342 
	`REG_WRITE
(
ah
, 0xa270, 
tmpVÆ
);

346 
tmpVÆ
 = 
	`REG_READ
(
ah
, 0xb270);

347 
tmpVÆ
 =ÅmpVal & 0xFCFFFFFF;

348 
tmpVÆ
 =ÅmpVal | (0x3 << 24);

349 
	`REG_WRITE
(
ah
, 0xb270, 
tmpVÆ
);

353 i‡(
chaö
 == 0) {

354 
tmpVÆ
 = 
	`REG_READ
(
ah
, 0xa398);

355 
tmpVÆ
 =ÅmpVal & 0xff00ffff;

356 
a
 = (
txPowî
)&0xff;

357 
tmpVÆ
 =ÅmpVÆ | (
a
 << 16);

358 
	`REG_WRITE
(
ah
, 0xa398, 
tmpVÆ
);

363 i‡(
chaö
 == 1) {

364 
tmpVÆ
 = 
	`REG_READ
(
ah
, 0xb398);

365 
tmpVÆ
 =ÅmpVal & 0xff00ffff;

366 
a
 = (
txPowî
)&0xff;

367 
tmpVÆ
 =ÅmpVÆ | (
a
 << 16);

368 
	`REG_WRITE
(
ah
, 0xb398, 
tmpVÆ
);

370 
	}
}

372 
	$©h9k_hw_£t_¨9287_powî_ˇl_èbÀ
(
©h_hw
 *
ah
,

373 
©h9k_ch™√l
 *
ch™
)

375 
ˇl_d©a_≥r_‰eq_¨9287
 *
pRawD©a£t
;

376 
ˇl_d©a_›_lo›_¨9287
 *
pRawD©a£tO≥nLo›
;

377 
u8
 *
pCÆBCh™s
 = 
NULL
;

378 
u16
 
pdGaöOvîœp_t2
;

379 
u8
 
pdadcVÆues
[
AR5416_NUM_PDADC_VALUES
];

380 
u16
 
gaöBound¨õs
[
AR5416_PD_GAINS_IN_MASK
];

381 
u16
 
numPõrs
 = 0, 
i
, 
j
;

382 
u16
 
numXpdGaö
, 
xpdMask
;

383 
u16
 
xpdGaöVÆues
[
AR5416_NUM_PD_GAINS
] = {0, 0, 0, 0};

384 
u32
 
ªg32
, 
ªgOff£t
, 
ªgChaöOff£t
, 
ªgvÆ
;

385 
öt16_t
 
diff
 = 0;

386 
¨9287_ì¥om
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠9287
;

388 
xpdMask
 = 
pEïD©a
->
modÆHódî
.
xpdGaö
;

390 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR9287_EEP_VER_MINOR_MASK
) >=

391 
AR9287_EEP_MINOR_VER_2
)

392 
pdGaöOvîœp_t2
 = 
pEïD©a
->
modÆHódî
.
pdGaöOvîœp
;

394 
pdGaöOvîœp_t2
 = (
u16
)(
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_TPCRG5
),

395 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
));

397 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

398 
pCÆBCh™s
 = 
pEïD©a
->
ˇlFªqPõr2G
;

399 
numPõrs
 = 
AR9287_NUM_2G_CAL_PIERS
;

400 i‡(
	`©h9k_hw_¨9287_gë_ì¥om
(
ah
, 
EEP_OL_PWRCTRL
)) {

401 
pRawD©a£tO≥nLo›
 =

402 (
ˇl_d©a_›_lo›_¨9287
 *)
pEïD©a
->
ˇlPõrD©a2G
[0];

403 
ah
->
öôPDADC
 = 
pRawD©a£tO≥nLo›
->
vpdPdg
[0][0];

407 
numXpdGaö
 = 0;

410 
i
 = 1; i <
AR5416_PD_GAINS_IN_MASK
; i++) {

411 i‡((
xpdMask
 >> (
AR5416_PD_GAINS_IN_MASK
 - 
i
)) & 1) {

412 i‡(
numXpdGaö
 >
AR5416_NUM_PD_GAINS
)

414 
xpdGaöVÆues
[
numXpdGaö
] =

415 (
u16
)(
AR5416_PD_GAINS_IN_MASK
-
i
);

416 
numXpdGaö
++;

420 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_NUM_PD_GAIN
,

421 (
numXpdGaö
 - 1) & 0x3);

422 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_1
,

423 
xpdGaöVÆues
[0]);

424 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_2
,

425 
xpdGaöVÆues
[1]);

426 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_3
,

427 
xpdGaöVÆues
[2]);

429 
i
 = 0; i < 
AR9287_MAX_CHAINS
; i++) {

430 
ªgChaöOff£t
 = 
i
 * 0x1000;

432 i‡(
pEïD©a
->
ba£EïHódî
.
txMask
 & (1 << 
i
)) {

433 
pRawD©a£tO≥nLo›
 =

434 (
ˇl_d©a_›_lo›_¨9287
 *)
pEïD©a
->
ˇlPõrD©a2G
[
i
];

436 i‡(
	`©h9k_hw_¨9287_gë_ì¥om
(
ah
, 
EEP_OL_PWRCTRL
)) {

437 
öt8_t
 
txPowî
;

438 
	`¨9287_ì¥om_gë_tx_gaö_ödex
(
ah
, 
ch™
,

439 
pRawD©a£tO≥nLo›
,

440 
pCÆBCh™s
, 
numPõrs
,

441 &
txPowî
);

442 
	`¨9287_ì¥om_ﬁpc_£t_pdadcs
(
ah
, 
txPowî
, 
i
);

444 
pRawD©a£t
 =

445 (
ˇl_d©a_≥r_‰eq_¨9287
 *)

446 
pEïD©a
->
ˇlPõrD©a2G
[
i
];

448 
	`©h9k_hw_gë_gaö_bound¨õs_pdadcs
(
ah
, 
ch™
,

449 
pRawD©a£t
,

450 
pCÆBCh™s
, 
numPõrs
,

451 
pdGaöOvîœp_t2
,

452 
gaöBound¨õs
,

453 
pdadcVÆues
,

454 
numXpdGaö
);

457 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

459 i‡(
i
 == 0) {

460 i‡(!
	`©h9k_hw_¨9287_gë_ì¥om
(
ah
,

461 
EEP_OL_PWRCTRL
)) {

463 
ªgvÆ
 = 
	`SM
(
pdGaöOvîœp_t2
,

464 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
)

465 | 
	`SM
(
gaöBound¨õs
[0],

466 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1
)

467 | 
	`SM
(
gaöBound¨õs
[1],

468 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2
)

469 | 
	`SM
(
gaöBound¨õs
[2],

470 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3
)

471 | 
	`SM
(
gaöBound¨õs
[3],

472 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4
);

474 
	`REG_WRITE
(
ah
,

475 
AR_PHY_TPCRG5
 + 
ªgChaöOff£t
,

476 
ªgvÆ
);

480 i‡((
öt32_t
)
AR9287_PWR_TABLE_OFFSET_DB
 !=

481 
pEïD©a
->
ba£EïHódî
.
pwrTabÀOff£t
) {

482 
diff
 = (
u16
)(
pEïD©a
->
ba£EïHódî
.
pwrTabÀOff£t
 -

483 (
öt32_t
)
AR9287_PWR_TABLE_OFFSET_DB
);

484 
diff
 *= 2;

486 
j
 = 0; j < ((
u16
)
AR5416_NUM_PDADC_VALUES
-
diff
); j++)

487 
pdadcVÆues
[
j
] =ÖdadcVÆues[j+
diff
];

489 
j
 = (
u16
)(
AR5416_NUM_PDADC_VALUES
-
diff
);

490 
j
 < 
AR5416_NUM_PDADC_VALUES
; j++)

491 
pdadcVÆues
[
j
] =

492 
pdadcVÆues
[
AR5416_NUM_PDADC_VALUES
-
diff
];

495 i‡(!
	`©h9k_hw_¨9287_gë_ì¥om
(
ah
, 
EEP_OL_PWRCTRL
)) {

496 
ªgOff£t
 = 
AR_PHY_BASE
 +

497 (672 << 2Ë+ 
ªgChaöOff£t
;

499 
j
 = 0; j < 32; j++) {

500 
ªg32
 = 
	`gë_u«lig√d_À32
(&
pdadcVÆues
[4 * 
j
]);

502 
	`REG_WRITE
(
ah
, 
ªgOff£t
, 
ªg32
);

503 
ªgOff£t
 += 4;

506 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

509 
	}
}

511 
	$©h9k_hw_£t_¨9287_powî_≥r_øã_èbÀ
(
©h_hw
 *
ah
,

512 
©h9k_ch™√l
 *
ch™
,

513 
öt16_t
 *
øãsAºay
,

514 
u16
 
cfgCé
,

515 
u16
 
™ã¬a_ªdu˘i⁄
,

516 
u16
 
powîLimô
)

518 
	#CMP_CTL
 \

519 (((
cfgCé
 & ~
CTL_MODE_M
Ë| (
pCéMode
[
˘lMode
] & CTL_MODE_M)) == \

520 
pEïD©a
->
˘lIndex
[
i
])

	)

522 
	#CMP_NO_CTL
 \

523 (((
cfgCé
 & ~
CTL_MODE_M
Ë| (
pCéMode
[
˘lMode
] & CTL_MODE_M)) == \

524 ((
pEïD©a
->
˘lIndex
[
i
] & 
CTL_MODE_M
Ë| 
SD_NO_CTL
))

	)

526 
u16
 
twi˚MaxEdgePowî
;

527 
i
;

528 
ˇl_˘l_d©a_¨9287
 *
ªp
;

529 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdm
 = {0, {0, 0, 0, 0} },

530 
èrgëPowîCck
 = {0, {0, 0, 0, 0} };

531 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdmExt
 = {0, {0, 0, 0, 0} },

532 
èrgëPowîCckExt
 = {0, {0, 0, 0, 0} };

533 
ˇl_èrgë_powî_ht
 
èrgëPowîHt20
,

534 
èrgëPowîHt40
 = {0, {0, 0, 0, 0} };

535 
u16
 
sˇÀdPowî
 = 0, 
möCéPowî
;

536 c⁄° 
u16
 
˘lModesF‹11g
[] = {

537 
CTL_11B
, 
CTL_11G
, 
CTL_2GHT20
,

538 
CTL_11B_EXT
, 
CTL_11G_EXT
, 
CTL_2GHT40


540 
u16
 
numCéModes
 = 0;

541 c⁄° 
u16
 *
pCéMode
 = 
NULL
;

542 
u16
 
˘lMode
, 
‰eq
;

543 
ch™_˚¡îs
 
˚¡îs
;

544 
tx_chaömask
;

545 
u16
 
twi˚MöEdgePowî
;

546 
¨9287_ì¥om
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠9287
;

547 
tx_chaömask
 = 
ah
->
txchaömask
;

549 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

550 
sˇÀdPowî
 = 
	`©h9k_hw_gë_sˇÀd_powî
(
ah
, 
powîLimô
,

551 
™ã¬a_ªdu˘i⁄
);

556 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

558 
numCéModes
 =

559 
	`ARRAY_SIZE
(
˘lModesF‹11g
Ë- 
SUB_NUM_CTL_MODES_AT_2G_40
;

561 
pCéMode
 = 
˘lModesF‹11g
;

563 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

564 
pEïD©a
->
ˇlT¨gëPowîCck
,

565 
AR9287_NUM_2G_CCK_TARGET_POWERS
,

566 &
èrgëPowîCck
, 4, 
Ál£
);

567 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

568 
pEïD©a
->
ˇlT¨gëPowî2G
,

569 
AR9287_NUM_2G_20_TARGET_POWERS
,

570 &
èrgëPowîOfdm
, 4, 
Ál£
);

571 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

572 
pEïD©a
->
ˇlT¨gëPowî2GHT20
,

573 
AR9287_NUM_2G_20_TARGET_POWERS
,

574 &
èrgëPowîHt20
, 8, 
Ál£
);

576 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

578 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
);

579 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

580 
pEïD©a
->
ˇlT¨gëPowî2GHT40
,

581 
AR9287_NUM_2G_40_TARGET_POWERS
,

582 &
èrgëPowîHt40
, 8, 
åue
);

583 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

584 
pEïD©a
->
ˇlT¨gëPowîCck
,

585 
AR9287_NUM_2G_CCK_TARGET_POWERS
,

586 &
èrgëPowîCckExt
, 4, 
åue
);

587 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

588 
pEïD©a
->
ˇlT¨gëPowî2G
,

589 
AR9287_NUM_2G_20_TARGET_POWERS
,

590 &
èrgëPowîOfdmExt
, 4, 
åue
);

594 
˘lMode
 = 0; céModê< 
numCéModes
; ctlMode++) {

595 
boﬁ
 
isHt40CéMode
 =

596 (
pCéMode
[
˘lMode
] =
CTL_2GHT40
Ë? 
åue
 : 
Ál£
;

598 i‡(
isHt40CéMode
)

599 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

600 i‡(
pCéMode
[
˘lMode
] & 
EXT_ADDITIVE
)

601 
‰eq
 = 
˚¡îs
.
ext_˚¡î
;

603 
‰eq
 = 
˚¡îs
.
˘l_˚¡î
;

605 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

607 
i
 = 0; (ò< 
AR9287_NUM_CTLS
Ë&& 
pEïD©a
->
˘lIndex
[i]; i++) {

608 
ˇl_˘l_edges
 *
pRdEdgesPowî
;

614 i‡(
CMP_CTL
 || 
CMP_NO_CTL
) {

615 
ªp
 = &(
pEïD©a
->
˘lD©a
[
i
]);

616 
pRdEdgesPowî
 =

617 
ªp
->
˘lEdges
[
	`¨5416_gë_¡xchaös
(
tx_chaömask
) - 1];

619 
twi˚MöEdgePowî
 = 
	`©h9k_hw_gë_max_edge_powî
(
‰eq
,

620 
pRdEdgesPowî
,

621 
	`IS_CHAN_2GHZ
(
ch™
),

622 
AR5416_NUM_BAND_EDGES
);

624 i‡((
cfgCé
 & ~
CTL_MODE_M
Ë=
SD_NO_CTL
) {

625 
twi˚MaxEdgePowî
 = 
	`mö
(twiceMaxEdgePower,

626 
twi˚MöEdgePowî
);

628 
twi˚MaxEdgePowî
 = 
twi˚MöEdgePowî
;

634 
möCéPowî
 = (
u8
)
	`mö
(
twi˚MaxEdgePowî
, 
sˇÀdPowî
);

637 
pCéMode
[
˘lMode
]) {

638 
CTL_11B
:

639 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîCck
.
tPow2x
); i++) {

640 
èrgëPowîCck
.
tPow2x
[
i
] =

641 (
u8
)
	`mö
((
u16
)
èrgëPowîCck
.
tPow2x
[
i
],

642 
möCéPowî
);

645 
CTL_11A
:

646 
CTL_11G
:

647 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîOfdm
.
tPow2x
); i++) {

648 
èrgëPowîOfdm
.
tPow2x
[
i
] =

649 (
u8
)
	`mö
((
u16
)
èrgëPowîOfdm
.
tPow2x
[
i
],

650 
möCéPowî
);

653 
CTL_5GHT20
:

654 
CTL_2GHT20
:

655 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++) {

656 
èrgëPowîHt20
.
tPow2x
[
i
] =

657 (
u8
)
	`mö
((
u16
)
èrgëPowîHt20
.
tPow2x
[
i
],

658 
möCéPowî
);

661 
CTL_11B_EXT
:

662 
èrgëPowîCckExt
.
tPow2x
[0] =

663 (
u8
)
	`mö
((
u16
)
èrgëPowîCckExt
.
tPow2x
[0],

664 
möCéPowî
);

666 
CTL_11A_EXT
:

667 
CTL_11G_EXT
:

668 
èrgëPowîOfdmExt
.
tPow2x
[0] =

669 (
u8
)
	`mö
((
u16
)
èrgëPowîOfdmExt
.
tPow2x
[0],

670 
möCéPowî
);

672 
CTL_5GHT40
:

673 
CTL_2GHT40
:

674 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++) {

675 
èrgëPowîHt40
.
tPow2x
[
i
] =

676 (
u8
)
	`mö
((
u16
)
èrgëPowîHt40
.
tPow2x
[
i
],

677 
möCéPowî
);

687 
øãsAºay
[
øã6mb
] =

688 
øãsAºay
[
øã9mb
] =

689 
øãsAºay
[
øã12mb
] =

690 
øãsAºay
[
øã18mb
] =

691 
øãsAºay
[
øã24mb
] = 
èrgëPowîOfdm
.
tPow2x
[0];

693 
øãsAºay
[
øã36mb
] = 
èrgëPowîOfdm
.
tPow2x
[1];

694 
øãsAºay
[
øã48mb
] = 
èrgëPowîOfdm
.
tPow2x
[2];

695 
øãsAºay
[
øã54mb
] = 
èrgëPowîOfdm
.
tPow2x
[3];

696 
øãsAºay
[
øãXr
] = 
èrgëPowîOfdm
.
tPow2x
[0];

698 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++)

699 
øãsAºay
[
øãHt20_0
 + 
i
] = 
èrgëPowîHt20
.
tPow2x
[i];

701 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

702 
øãsAºay
[
øã1l
] = 
èrgëPowîCck
.
tPow2x
[0];

703 
øãsAºay
[
øã2s
] =

704 
øãsAºay
[
øã2l
] = 
èrgëPowîCck
.
tPow2x
[1];

705 
øãsAºay
[
øã5_5s
] =

706 
øãsAºay
[
øã5_5l
] = 
èrgëPowîCck
.
tPow2x
[2];

707 
øãsAºay
[
øã11s
] =

708 
øãsAºay
[
øã11l
] = 
èrgëPowîCck
.
tPow2x
[3];

710 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

711 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++)

712 
øãsAºay
[
øãHt40_0
 + 
i
] = 
èrgëPowîHt40
.
tPow2x
[i];

714 
øãsAºay
[
øãDupOfdm
] = 
èrgëPowîHt40
.
tPow2x
[0];

715 
øãsAºay
[
øãDupCck
] = 
èrgëPowîHt40
.
tPow2x
[0];

716 
øãsAºay
[
øãExtOfdm
] = 
èrgëPowîOfdmExt
.
tPow2x
[0];

718 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

719 
øãsAºay
[
øãExtCck
] = 
èrgëPowîCckExt
.
tPow2x
[0];

722 #unde‡
CMP_CTL


723 #unde‡
CMP_NO_CTL


724 
	}
}

726 
	$©h9k_hw_¨9287_£t_txpowî
(
©h_hw
 *
ah
,

727 
©h9k_ch™√l
 *
ch™
, 
u16
 
cfgCé
,

728 
u8
 
twi˚A¡í«Redu˘i⁄
,

729 
u8
 
powîLimô
, 
boﬁ
 
ã°
)

731 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

732 
¨9287_ì¥om
 *
pEïD©a
 = &
ah
->
ì¥om
.
m≠9287
;

733 
modÆ_ìp_¨9287_hódî
 *
pModÆ
 = &
pEïD©a
->
modÆHódî
;

734 
öt16_t
 
øãsAºay
[
Ar5416R©eSize
];

735 
u8
 
ht40PowîIncF‹Pdadc
 = 2;

736 
i
;

738 
	`mem£t
(
øãsAºay
, 0, (ratesArray));

740 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR9287_EEP_VER_MINOR_MASK
) >=

741 
AR9287_EEP_MINOR_VER_2
)

742 
ht40PowîIncF‹Pdadc
 = 
pModÆ
->ht40PowerIncForPdadc;

744 
	`©h9k_hw_£t_¨9287_powî_≥r_øã_èbÀ
(
ah
, 
ch™
,

745 &
øãsAºay
[0], 
cfgCé
,

746 
twi˚A¡í«Redu˘i⁄
,

747 
powîLimô
);

749 
	`©h9k_hw_£t_¨9287_powî_ˇl_èbÀ
(
ah
, 
ch™
);

751 
ªguœt‹y
->
max_powî_Àvñ
 = 0;

752 
i
 = 0; i < 
	`ARRAY_SIZE
(
øãsAºay
); i++) {

753 i‡(
øãsAºay
[
i
] > 
MAX_RATE_POWER
)

754 
øãsAºay
[
i
] = 
MAX_RATE_POWER
;

756 i‡(
øãsAºay
[
i
] > 
ªguœt‹y
->
max_powî_Àvñ
)

757 
ªguœt‹y
->
max_powî_Àvñ
 = 
øãsAºay
[
i
];

760 
	`©h9k_hw_upd©e_ªguœt‹y_maxpowî
(
ah
);

762 i‡(
ã°
)

765 
i
 = 0; i < 
Ar5416R©eSize
; i++)

766 
øãsAºay
[
i
] -
AR9287_PWR_TABLE_OFFSET_DB
 * 2;

768 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

771 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE1
,

772 
	`ATH9K_POW_SM
(
øãsAºay
[
øã18mb
], 24)

773 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã12mb
], 16)

774 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã9mb
], 8)

775 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã6mb
], 0));

777 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE2
,

778 
	`ATH9K_POW_SM
(
øãsAºay
[
øã54mb
], 24)

779 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã48mb
], 16)

780 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã36mb
], 8)

781 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã24mb
], 0));

784 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

785 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE3
,

786 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2s
], 24)

787 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2l
], 16)

788 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãXr
], 8)

789 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã1l
], 0));

790 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE4
,

791 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11s
], 24)

792 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11l
], 16)

793 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5s
], 8)

794 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5l
], 0));

798 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE5
,

799 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_3
], 24)

800 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_2
], 16)

801 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_1
], 8)

802 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_0
], 0));

804 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE6
,

805 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_7
], 24)

806 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_6
], 16)

807 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_5
], 8)

808 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_4
], 0));

811 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

812 i‡(
	`©h9k_hw_¨9287_gë_ì¥om
(
ah
, 
EEP_OL_PWRCTRL
)) {

813 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE7
,

814 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_3
], 24)

815 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_2
], 16)

816 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_1
], 8)

817 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_0
], 0));

819 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE8
,

820 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_7
], 24)

821 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_6
], 16)

822 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_5
], 8)

823 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_4
], 0));

825 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE7
,

826 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_3
] +

827 
ht40PowîIncF‹Pdadc
, 24)

828 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_2
] +

829 
ht40PowîIncF‹Pdadc
, 16)

830 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_1
] +

831 
ht40PowîIncF‹Pdadc
, 8)

832 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_0
] +

833 
ht40PowîIncF‹Pdadc
, 0));

835 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE8
,

836 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_7
] +

837 
ht40PowîIncF‹Pdadc
, 24)

838 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_6
] +

839 
ht40PowîIncF‹Pdadc
, 16)

840 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_5
] +

841 
ht40PowîIncF‹Pdadc
, 8)

842 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_4
] +

843 
ht40PowîIncF‹Pdadc
, 0));

847 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE9
,

848 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtOfdm
], 24)

849 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtCck
], 16)

850 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupOfdm
], 8)

851 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupCck
], 0));

855 i‡(
ah
->
çc_íabÀd
) {

856 
ht40_dñè
;

858 
ht40_dñè
 = (
	`IS_CHAN_HT40
(
ch™
)Ë? 
ht40PowîIncF‹Pdadc
 : 0;

859 
	`¨5008_hw_öô_øã_txpowî
(
ah
, 
øãsAºay
, 
ch™
, 
ht40_dñè
);

861 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
,

862 
MAX_RATE_POWER
 | 
AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
);

865 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
, 
MAX_RATE_POWER
);

868 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

869 
	}
}

871 
	$©h9k_hw_¨9287_£t_bﬂrd_vÆues
(
©h_hw
 *
ah
,

872 
©h9k_ch™√l
 *
ch™
)

874 
¨9287_ì¥om
 *
ìp
 = &
ah
->
ì¥om
.
m≠9287
;

875 
modÆ_ìp_¨9287_hódî
 *
pModÆ
 = &
ìp
->
modÆHódî
;

876 
u32
 
ªgChaöOff£t
, 
ªgvÆ
;

877 
u8
 
txRxAâíLoˇl
;

878 
i
;

880 
pModÆ
 = &
ìp
->
modÆHódî
;

882 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_COM
, 
pModÆ
->
™tCålComm⁄
);

884 
i
 = 0; i < 
AR9287_MAX_CHAINS
; i++) {

885 
ªgChaöOff£t
 = 
i
 * 0x1000;

887 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_CHAIN_0
 + 
ªgChaöOff£t
,

888 
pModÆ
->
™tCålChaö
[
i
]);

890 
	`REG_WRITE
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0Ë+ 
ªgChaöOff£t
,

891 (
	`REG_READ
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0Ë+ 
ªgChaöOff£t
)

892 & ~(
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
 |

893 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
)) |

894 
	`SM
(
pModÆ
->
iqCÆICh
[
i
],

895 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
) |

896 
	`SM
(
pModÆ
->
iqCÆQCh
[
i
],

897 
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
));

899 
txRxAâíLoˇl
 = 
pModÆ
->
txRxAâíCh
[
i
];

901 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

902 
AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN
,

903 
pModÆ
->
bswM¨gö
[
i
]);

904 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

905 
AR_PHY_GAIN_2GHZ_XATTEN1_DB
,

906 
pModÆ
->
bswAâí
[
i
]);

907 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
 + 
ªgChaöOff£t
,

908 
AR9280_PHY_RXGAIN_TXRX_ATTEN
,

909 
txRxAâíLoˇl
);

910 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RXGAIN
 + 
ªgChaöOff£t
,

911 
AR9280_PHY_RXGAIN_TXRX_MARGIN
,

912 
pModÆ
->
rxTxM¨göCh
[
i
]);

916 i‡(
	`IS_CHAN_HT40
(
ch™
))

917 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
,

918 
AR_PHY_SETTLING_SWITCH
, 
pModÆ
->
swSëéeHt40
);

920 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
,

921 
AR_PHY_SETTLING_SWITCH
, 
pModÆ
->
swôchSëéög
);

923 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_DESIRED_SZ
,

924 
AR_PHY_DESIRED_SZ_ADC
, 
pModÆ
->
adcDesúedSize
);

926 
	`REG_WRITE
(
ah
, 
AR_PHY_RF_CTL4
,

927 
	`SM
(
pModÆ
->
txEndToX∑Off
, 
AR_PHY_RF_CTL4_TX_END_XPAA_OFF
)

928 | 
	`SM
(
pModÆ
->
txEndToX∑Off
, 
AR_PHY_RF_CTL4_TX_END_XPAB_OFF
)

929 | 
	`SM
(
pModÆ
->
txFømeToX∑On
, 
AR_PHY_RF_CTL4_FRAME_XPAA_ON
)

930 | 
	`SM
(
pModÆ
->
txFømeToX∑On
, 
AR_PHY_RF_CTL4_FRAME_XPAB_ON
));

932 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL3
,

933 
AR_PHY_TX_END_TO_A2_RX_ON
, 
pModÆ
->
txEndToRxOn
);

935 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCA
,

936 
AR9280_PHY_CCA_THRESH62
, 
pModÆ
->
thªsh62
);

937 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA0
,

938 
AR_PHY_EXT_CCA0_THRESH62
, 
pModÆ
->
thªsh62
);

940 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR9287_AN_RF2G3_CH0
);

941 
ªgvÆ
 &~(
AR9287_AN_RF2G3_DB1
 |

942 
AR9287_AN_RF2G3_DB2
 |

943 
AR9287_AN_RF2G3_OB_CCK
 |

944 
AR9287_AN_RF2G3_OB_PSK
 |

945 
AR9287_AN_RF2G3_OB_QAM
 |

946 
AR9287_AN_RF2G3_OB_PAL_OFF
);

947 
ªgvÆ
 |(
	`SM
(
pModÆ
->
db1
, 
AR9287_AN_RF2G3_DB1
) |

948 
	`SM
(
pModÆ
->
db2
, 
AR9287_AN_RF2G3_DB2
) |

949 
	`SM
(
pModÆ
->
ob_cck
, 
AR9287_AN_RF2G3_OB_CCK
) |

950 
	`SM
(
pModÆ
->
ob_psk
, 
AR9287_AN_RF2G3_OB_PSK
) |

951 
	`SM
(
pModÆ
->
ob_qam
, 
AR9287_AN_RF2G3_OB_QAM
) |

952 
	`SM
(
pModÆ
->
ob_∑l_off
, 
AR9287_AN_RF2G3_OB_PAL_OFF
));

954 
	`©h9k_hw_™Æog_shi·_ªgwrôe
(
ah
, 
AR9287_AN_RF2G3_CH0
, 
ªgvÆ
);

956 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR9287_AN_RF2G3_CH1
);

957 
ªgvÆ
 &~(
AR9287_AN_RF2G3_DB1
 |

958 
AR9287_AN_RF2G3_DB2
 |

959 
AR9287_AN_RF2G3_OB_CCK
 |

960 
AR9287_AN_RF2G3_OB_PSK
 |

961 
AR9287_AN_RF2G3_OB_QAM
 |

962 
AR9287_AN_RF2G3_OB_PAL_OFF
);

963 
ªgvÆ
 |(
	`SM
(
pModÆ
->
db1
, 
AR9287_AN_RF2G3_DB1
) |

964 
	`SM
(
pModÆ
->
db2
, 
AR9287_AN_RF2G3_DB2
) |

965 
	`SM
(
pModÆ
->
ob_cck
, 
AR9287_AN_RF2G3_OB_CCK
) |

966 
	`SM
(
pModÆ
->
ob_psk
, 
AR9287_AN_RF2G3_OB_PSK
) |

967 
	`SM
(
pModÆ
->
ob_qam
, 
AR9287_AN_RF2G3_OB_QAM
) |

968 
	`SM
(
pModÆ
->
ob_∑l_off
, 
AR9287_AN_RF2G3_OB_PAL_OFF
));

970 
	`©h9k_hw_™Æog_shi·_ªgwrôe
(
ah
, 
AR9287_AN_RF2G3_CH1
, 
ªgvÆ
);

972 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
,

973 
AR_PHY_TX_END_DATA_START
, 
pModÆ
->
txFømeToD©aSèπ
);

974 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
,

975 
AR_PHY_TX_END_PA_ON
, 
pModÆ
->
txFømeToPaOn
);

977 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR9287_AN_TOP2
,

978 
AR9287_AN_TOP2_XPABIAS_LVL
,

979 
AR9287_AN_TOP2_XPABIAS_LVL_S
,

980 
pModÆ
->
x∑BüsLvl
);

981 
	}
}

983 
u16
 
	$©h9k_hw_¨9287_gë_•ur_ch™√l
(
©h_hw
 *
ah
,

984 
u16
 
i
, 
boﬁ
 
is2GHz
)

986  
ah
->
ì¥om
.
m≠9287
.
modÆHódî
.
•urCh™s
[
i
].
•urCh™
;

987 
	}
}

989 c⁄° 
ì¥om_›s
 
	gìp_¨9287_›s
 = {

990 .
check_ì¥om
 = 
©h9k_hw_¨9287_check_ì¥om
,

991 .
	ggë_ì¥om
 = 
©h9k_hw_¨9287_gë_ì¥om
,

992 .
	gfûl_ì¥om
 = 
©h9k_hw_¨9287_fûl_ì¥om
,

993 .
	gdump_ì¥om
 = 
©h9k_hw_¨9287_dump_ì¥om
,

994 .
	ggë_ì¥om_vî
 = 
©h9k_hw_¨9287_gë_ì¥om_vî
,

995 .
	ggë_ì¥om_ªv
 = 
©h9k_hw_¨9287_gë_ì¥om_ªv
,

996 .
	g£t_bﬂrd_vÆues
 = 
©h9k_hw_¨9287_£t_bﬂrd_vÆues
,

997 .
	g£t_txpowî
 = 
©h9k_hw_¨9287_£t_txpowî
,

998 .
	ggë_•ur_ch™√l
 = 
©h9k_hw_¨9287_gë_•ur_ch™√l


	@eeprom_def.c

17 
	~<asm/u«lig√d.h
>

18 
	~"hw.h
"

19 
	~"¨9002_phy.h
"

21 
	$©h9k_gë_txgaö_ödex
(
©h_hw
 *
ah
,

22 
©h9k_ch™√l
 *
ch™
,

23 
ˇlD©aPîFªqOpLo›
 *
øwD©a£tOpLo›
,

24 
u8
 *
ˇlCh™s
, 
u16
 
avaûPõrs
, u8 *
pwr
, u8 *
pcdacIdx
)

26 
u8
 
pcdac
, 
i
 = 0;

27 
u16
 
idxL
 = 0, 
idxR
 = 0, 
numPõrs
;

28 
boﬁ
 
m©ch
;

29 
ch™_˚¡îs
 
˚¡îs
;

31 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

33 
numPõrs
 = 0;ÇumPõr†< 
avaûPõrs
;ÇumPiers++)

34 i‡(
ˇlCh™s
[
numPõrs
] =
AR5416_BCHAN_UNUSED
)

37 
m©ch
 = 
	`©h9k_hw_gë_lowî_uµî_ödex
(

38 (
u8
)
	`FREQ2FBIN
(
˚¡îs
.
sy¡h_˚¡î
, 
	`IS_CHAN_2GHZ
(
ch™
)),

39 
ˇlCh™s
, 
numPõrs
, &
idxL
, &
idxR
);

40 i‡(
m©ch
) {

41 
pcdac
 = 
øwD©a£tOpLo›
[
idxL
].pcdac[0][0];

42 *
pwr
 = 
øwD©a£tOpLo›
[
idxL
].
pwrPdg
[0][0];

44 
pcdac
 = 
øwD©a£tOpLo›
[
idxR
].pcdac[0][0];

45 *
pwr
 = (
øwD©a£tOpLo›
[
idxL
].
pwrPdg
[0][0] +

46 
øwD©a£tOpLo›
[
idxR
].
pwrPdg
[0][0])/2;

49 
pcdac
 > 
ah
->
‹igöÆGaö
[
i
] &&

50 
i
 < (
AR9280_TX_GAIN_TABLE_SIZE
 - 1))

51 
i
++;

53 *
pcdacIdx
 = 
i
;

54 
	}
}

56 
	$©h9k_ﬁc_gë_pdadcs
(
©h_hw
 *
ah
,

57 
u32
 
öôTxGaö
,

58 
txPowî
,

59 
u8
 *
pPDADCVÆues
)

61 
u32
 
i
;

62 
u32
 
off£t
;

64 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_PWRCTRL6_0
,

65 
AR_PHY_TX_PWRCTRL_ERR_EST_MODE
, 3);

66 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_PWRCTRL6_1
,

67 
AR_PHY_TX_PWRCTRL_ERR_EST_MODE
, 3);

69 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_PWRCTRL7
,

70 
AR_PHY_TX_PWRCTRL_INIT_TX_GAIN
, 
öôTxGaö
);

72 
off£t
 = 
txPowî
;

73 
i
 = 0; i < 
AR5416_NUM_PDADC_VALUES
; i++)

74 i‡(
i
 < 
off£t
)

75 
pPDADCVÆues
[
i
] = 0x0;

77 
pPDADCVÆues
[
i
] = 0xFF;

78 
	}
}

80 
	$©h9k_hw_def_gë_ì¥om_vî
(
©h_hw
 *
ah
)

82  ((
ah
->
ì¥om
.
def
.
ba£EïHódî
.
vîsi⁄
 >> 12) & 0xF);

83 
	}
}

85 
	$©h9k_hw_def_gë_ì¥om_ªv
(
©h_hw
 *
ah
)

87  ((
ah
->
ì¥om
.
def
.
ba£EïHódî
.
vîsi⁄
) & 0xFFF);

88 
	}
}

90 
	#SIZE_EEPROM_DEF
 ((
¨5416_ì¥om_def
Ë/ (
u16
))

	)

92 
boﬁ
 
	$__©h9k_hw_def_fûl_ì¥om
(
©h_hw
 *
ah
)

94 
u16
 *
ìp_d©a
 = (u16 *)&
ah
->
ì¥om
.
def
;

95 
addr
, 
¨5416_ìp_°¨t_loc
 = 0x100;

97 
addr
 = 0;ádd∏< 
SIZE_EEPROM_DEF
;áddr++) {

98 i‡(!
	`©h9k_hw_nvøm_ªad
(
ah
, 
addr
 + 
¨5416_ìp_°¨t_loc
,

99 
ìp_d©a
))

100  
Ál£
;

101 
ìp_d©a
++;

103  
åue
;

104 
	}
}

106 
boﬁ
 
	$__©h9k_hw_usb_def_fûl_ì¥om
(
©h_hw
 *
ah
)

108 
u16
 *
ìp_d©a
 = (u16 *)&
ah
->
ì¥om
.
def
;

110 
	`©h9k_hw_usb_gí_fûl_ì¥om
(
ah
, 
ìp_d©a
,

111 0x100, 
SIZE_EEPROM_DEF
);

112  
åue
;

113 
	}
}

115 
boﬁ
 
	$©h9k_hw_def_fûl_ì¥om
(
©h_hw
 *
ah
)

117 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

119 i‡(!
	`©h9k_hw_u£_Êash
(
ah
)) {

120 
	`©h_dbg
(
comm⁄
, 
EEPROM
, "Reading from EEPROM,Çot flash\n");

123 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
)

124  
	`__©h9k_hw_usb_def_fûl_ì¥om
(
ah
);

126  
	`__©h9k_hw_def_fûl_ì¥om
(
ah
);

127 
	}
}

129 #i‡
deföed
(
CPTCFG_ATH9K_DEBUGFS
Ë|| deföed(
CPTCFG_ATH9K_HTC_DEBUGFS
)

130 
u32
 
	$©h9k_def_dump_modÆ_ì¥om
(*
buf
, 
u32
 
Àn
, u32 
size
,

131 
modÆ_ìp_hódî
 *
modÆ_hdr
)

133 
	`PR_EEP
("Chaö0 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[0]);

134 
	`PR_EEP
("Chaö1 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[1]);

135 
	`PR_EEP
("Chaö2 A¡. C⁄åﬁ", 
modÆ_hdr
->
™tCålChaö
[2]);

136 
	`PR_EEP
("A¡. Comm⁄ C⁄åﬁ", 
modÆ_hdr
->
™tCålComm⁄
);

137 
	`PR_EEP
("Chaö0 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[0]);

138 
	`PR_EEP
("Chaö1 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[1]);

139 
	`PR_EEP
("Chaö2 A¡. Gaö", 
modÆ_hdr
->
™ã¬aGaöCh
[2]);

140 
	`PR_EEP
("Swôch Sëée", 
modÆ_hdr
->
swôchSëéög
);

141 
	`PR_EEP
("Chaö0 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[0]);

142 
	`PR_EEP
("Chaö1 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[1]);

143 
	`PR_EEP
("Chaö2 TxRxAâí", 
modÆ_hdr
->
txRxAâíCh
[2]);

144 
	`PR_EEP
("Chaö0 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[0]);

145 
	`PR_EEP
("Chaö1 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[1]);

146 
	`PR_EEP
("Chaö2 RxTxM¨gö", 
modÆ_hdr
->
rxTxM¨göCh
[2]);

147 
	`PR_EEP
("ADC Desúed size", 
modÆ_hdr
->
adcDesúedSize
);

148 
	`PR_EEP
("PGA Desúed size", 
modÆ_hdr
->
pgaDesúedSize
);

149 
	`PR_EEP
("Chaö0 x ®Gaö", 
modÆ_hdr
->
x aGaöCh
[0]);

150 
	`PR_EEP
("Chaö1 x ®Gaö", 
modÆ_hdr
->
x aGaöCh
[1]);

151 
	`PR_EEP
("Chaö2 x ®Gaö", 
modÆ_hdr
->
x aGaöCh
[2]);

152 
	`PR_EEP
("txEndToX∑Off", 
modÆ_hdr
->
txEndToX∑Off
);

153 
	`PR_EEP
("txEndToRxOn", 
modÆ_hdr
->
txEndToRxOn
);

154 
	`PR_EEP
("txFømeToX∑On", 
modÆ_hdr
->
txFømeToX∑On
);

155 
	`PR_EEP
("CCA Thªshﬁd)", 
modÆ_hdr
->
thªsh62
);

156 
	`PR_EEP
("Chaö0 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[0]);

157 
	`PR_EEP
("Chaö1 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[1]);

158 
	`PR_EEP
("Chaö2 NF Thªshﬁd", 
modÆ_hdr
->
noi£Flo‹ThªshCh
[2]);

159 
	`PR_EEP
("xpdGaö", 
modÆ_hdr
->
xpdGaö
);

160 
	`PR_EEP
("Exã∫Æ PD", 
modÆ_hdr
->
xpd
);

161 
	`PR_EEP
("Chaö0 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[0]);

162 
	`PR_EEP
("Chaö1 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[1]);

163 
	`PR_EEP
("Chaö2 I C€fficõ¡", 
modÆ_hdr
->
iqCÆICh
[2]);

164 
	`PR_EEP
("Chaö0 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[0]);

165 
	`PR_EEP
("Chaö1 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[1]);

166 
	`PR_EEP
("Chaö2 Q C€fficõ¡", 
modÆ_hdr
->
iqCÆQCh
[2]);

167 
	`PR_EEP
("pdGaöOvîœp", 
modÆ_hdr
->
pdGaöOvîœp
);

168 
	`PR_EEP
("Chaö0 OuçutBüs", 
modÆ_hdr
->
ob
);

169 
	`PR_EEP
("Chaö0 DrivîBüs", 
modÆ_hdr
->
db
);

170 
	`PR_EEP
("xPA Bü†Levñ", 
modÆ_hdr
->
x∑BüsLvl
);

171 
	`PR_EEP
("2chaöÖw∏de¸ó£", 
modÆ_hdr
->
pwrDe¸ó£F‹2Chaö
);

172 
	`PR_EEP
("3chaöÖw∏de¸ó£", 
modÆ_hdr
->
pwrDe¸ó£F‹3Chaö
);

173 
	`PR_EEP
("txFømeToD©aSèπ", 
modÆ_hdr
->
txFømeToD©aSèπ
);

174 
	`PR_EEP
("txFømeToPaOn", 
modÆ_hdr
->
txFømeToPaOn
);

175 
	`PR_EEP
("HT40 Powî Inc.", 
modÆ_hdr
->
ht40PowîIncF‹Pdadc
);

176 
	`PR_EEP
("Chaö0 bswAâí", 
modÆ_hdr
->
bswAâí
[0]);

177 
	`PR_EEP
("Chaö1 bswAâí", 
modÆ_hdr
->
bswAâí
[1]);

178 
	`PR_EEP
("Chaö2 bswAâí", 
modÆ_hdr
->
bswAâí
[2]);

179 
	`PR_EEP
("Chaö0 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[0]);

180 
	`PR_EEP
("Chaö1 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[1]);

181 
	`PR_EEP
("Chaö2 bswM¨gö", 
modÆ_hdr
->
bswM¨gö
[2]);

182 
	`PR_EEP
("HT40 Swôch Sëée", 
modÆ_hdr
->
swSëéeHt40
);

183 
	`PR_EEP
("Chaö0 x©ãn2Db", 
modÆ_hdr
->
x©ãn2Db
[0]);

184 
	`PR_EEP
("Chaö1 x©ãn2Db", 
modÆ_hdr
->
x©ãn2Db
[1]);

185 
	`PR_EEP
("Chaö2 x©ãn2Db", 
modÆ_hdr
->
x©ãn2Db
[2]);

186 
	`PR_EEP
("Chaö0 x©ãn2M¨gö", 
modÆ_hdr
->
x©ãn2M¨gö
[0]);

187 
	`PR_EEP
("Chaö1 x©ãn2M¨gö", 
modÆ_hdr
->
x©ãn2M¨gö
[1]);

188 
	`PR_EEP
("Chaö2 x©ãn2M¨gö", 
modÆ_hdr
->
x©ãn2M¨gö
[2]);

189 
	`PR_EEP
("Chaö1 OuçutBüs", 
modÆ_hdr
->
ob_ch1
);

190 
	`PR_EEP
("Chaö1 DrivîBüs", 
modÆ_hdr
->
db_ch1
);

191 
	`PR_EEP
("LNA C⁄åﬁ", 
modÆ_hdr
->
 a_˘l
);

192 
	`PR_EEP
("XPA Bü†Fªq0", 
modÆ_hdr
->
x∑BüsLvlFªq
[0]);

193 
	`PR_EEP
("XPA Bü†Fªq1", 
modÆ_hdr
->
x∑BüsLvlFªq
[1]);

194 
	`PR_EEP
("XPA Bü†Fªq2", 
modÆ_hdr
->
x∑BüsLvlFªq
[2]);

196  
Àn
;

197 
	}
}

199 
u32
 
	$©h9k_hw_def_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

200 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

202 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

203 
ba£_ìp_hódî
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

205 i‡(!
dump_ba£_hdr
) {

206 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

208 
Àn
 = 
	`©h9k_def_dump_modÆ_ì¥om
(
buf
,Üí, 
size
,

209 &
ìp
->
modÆHódî
[0]);

210 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

212 
Àn
 = 
	`©h9k_def_dump_modÆ_ì¥om
(
buf
,Üí, 
size
,

213 &
ìp
->
modÆHódî
[1]);

214 
out
;

217 
	`PR_EEP
("Maj‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 >> 12);

218 
	`PR_EEP
("Mö‹ Vîsi⁄", 
pBa£
->
vîsi⁄
 & 0xFFF);

219 
	`PR_EEP
("Checksum", 
pBa£
->
checksum
);

220 
	`PR_EEP
("Lígth", 
pBa£
->
Àngth
);

221 
	`PR_EEP
("RegDomaö1", 
pBa£
->
ªgDmn
[0]);

222 
	`PR_EEP
("RegDomaö2", 
pBa£
->
ªgDmn
[1]);

223 
	`PR_EEP
("TX Mask", 
pBa£
->
txMask
);

224 
	`PR_EEP
("RX Mask", 
pBa£
->
rxMask
);

225 
	`PR_EEP
("AŒow 5GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11A
));

226 
	`PR_EEP
("AŒow 2GHz", !!(
pBa£
->
›C≠Fœgs
 & 
AR5416_OPFLAGS_11G
));

227 
	`PR_EEP
("DißbÀ 2GHz HT20", !!(
pBa£
->
›C≠Fœgs
 &

228 
AR5416_OPFLAGS_N_2G_HT20
));

229 
	`PR_EEP
("DißbÀ 2GHz HT40", !!(
pBa£
->
›C≠Fœgs
 &

230 
AR5416_OPFLAGS_N_2G_HT40
));

231 
	`PR_EEP
("DißbÀ 5Ghz HT20", !!(
pBa£
->
›C≠Fœgs
 &

232 
AR5416_OPFLAGS_N_5G_HT20
));

233 
	`PR_EEP
("DißbÀ 5Ghz HT40", !!(
pBa£
->
›C≠Fœgs
 &

234 
AR5416_OPFLAGS_N_5G_HT40
));

235 
	`PR_EEP
("Big Endün", !!(
pBa£
->
ìpMisc
 & 0x01));

236 
	`PR_EEP
("CÆ Bö Maj‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 24) & 0xFF);

237 
	`PR_EEP
("CÆ Bö Mö‹ Vî", (
pBa£
->
böBuûdNumbî
 >> 16) & 0xFF);

238 
	`PR_EEP
("CÆ Bö Buûd", (
pBa£
->
böBuûdNumbî
 >> 8) & 0xFF);

239 
	`PR_EEP
("O≥nLo› Powî Cål", 
pBa£
->
›íLo›PwrC¡l
);

241 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%20s : %pM\n", "MacAddress",

242 
pBa£
->
macAddr
);

244 
out
:

245 i‡(
Àn
 > 
size
)

246 
Àn
 = 
size
;

248  
Àn
;

249 
	}
}

251 
u32
 
	$©h9k_hw_def_dump_ì¥om
(
©h_hw
 *
ah
, 
boﬁ
 
dump_ba£_hdr
,

252 
u8
 *
buf
, 
u32
 
Àn
, u32 
size
)

255 
	}
}

258 
	$©h9k_hw_def_check_ì¥om
(
©h_hw
 *
ah
)

260 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

261 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

262 
u32
 
ñ
;

263 
boﬁ
 
√ed_sw≠
;

264 
i
, 
îr
;

266 
îr
 = 
	`©h9k_hw_nvøm_sw≠_d©a
(
ah
, &
√ed_sw≠
, 
SIZE_EEPROM_DEF
);

267 i‡(
îr
)

268  
îr
;

270 i‡(
√ed_sw≠
)

271 
ñ
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

273 
ñ
 = 
ìp
->
ba£EïHódî
.
Àngth
;

275 
ñ
 = 
	`mö
”»/ (
u16
), 
SIZE_EEPROM_DEF
);

276 i‡(!
	`©h9k_hw_nvøm_vÆid©e_checksum
(
ah
, 
ñ
))

277  -
EINVAL
;

279 i‡(
√ed_sw≠
) {

280 
u32
 
öãgî
, 
j
;

281 
u16
 
w‹d
;

283 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
Àngth
);

284 
ìp
->
ba£EïHódî
.
Àngth
 = 
w‹d
;

286 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
checksum
);

287 
ìp
->
ba£EïHódî
.
checksum
 = 
w‹d
;

289 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
vîsi⁄
);

290 
ìp
->
ba£EïHódî
.
vîsi⁄
 = 
w‹d
;

292 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[0]);

293 
ìp
->
ba£EïHódî
.
ªgDmn
[0] = 
w‹d
;

295 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
ªgDmn
[1]);

296 
ìp
->
ba£EïHódî
.
ªgDmn
[1] = 
w‹d
;

298 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
rfSûít
);

299 
ìp
->
ba£EïHódî
.
rfSûít
 = 
w‹d
;

301 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
);

302 
ìp
->
ba£EïHódî
.
blueToŸhO±i⁄s
 = 
w‹d
;

304 
w‹d
 = 
	`swab16
(
ìp
->
ba£EïHódî
.
devi˚C≠
);

305 
ìp
->
ba£EïHódî
.
devi˚C≠
 = 
w‹d
;

307 
j
 = 0; j < 
	`ARRAY_SIZE
(
ìp
->
modÆHódî
); j++) {

308 
modÆ_ìp_hódî
 *
pModÆ
 =

309 &
ìp
->
modÆHódî
[
j
];

310 
öãgî
 = 
	`swab32
(
pModÆ
->
™tCålComm⁄
);

311 
pModÆ
->
™tCålComm⁄
 = 
öãgî
;

313 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

314 
öãgî
 = 
	`swab32
(
pModÆ
->
™tCålChaö
[
i
]);

315 
pModÆ
->
™tCålChaö
[
i
] = 
öãgî
;

317 
i
 = 0; i < 3; i++) {

318 
w‹d
 = 
	`swab16
(
pModÆ
->
x∑BüsLvlFªq
[
i
]);

319 
pModÆ
->
x∑BüsLvlFªq
[
i
] = 
w‹d
;

322 
i
 = 0; i < 
AR_EEPROM_MODAL_SPURS
; i++) {

323 
w‹d
 = 
	`swab16
(
pModÆ
->
•urCh™s
[
i
].
•urCh™
);

324 
pModÆ
->
•urCh™s
[
i
].
•urCh™
 = 
w‹d
;

329 i‡(!
	`©h9k_hw_nvøm_check_vîsi⁄
(
ah
, 
AR5416_EEP_VER
,

330 
AR5416_EEP_NO_BACK_VER
))

331  -
EINVAL
;

334 i‡((
ah
->
hw_vîsi⁄
.
devid
 =
AR9280_DEVID_PCI
) &&

335 ((
ìp
->
ba£EïHódî
.
vîsi⁄
 & 0xff) > 0x0a) &&

336 (
ìp
->
ba£EïHódî
.
pwd˛köd
 == 0))

337 
ah
->
√ed_™_t›2_fixup
 = 
åue
;

339 i‡((
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
) &&

340 (
	`AR_SREV_9280
(
ah
)))

341 
ìp
->
modÆHódî
[0].
x∑BüsLvl
 = 0;

344 
	}
}

346 #unde‡
SIZE_EEPROM_DEF


348 
u32
 
	$©h9k_hw_def_gë_ì¥om
(
©h_hw
 *
ah
,

349 
ì¥om_∑øm
 
∑øm
)

351 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

352 
modÆ_ìp_hódî
 *
pModÆ
 = 
ìp
->
modÆHódî
;

353 
ba£_ìp_hódî
 *
pBa£
 = &
ìp
->
ba£EïHódî
;

354 
b™d
 = 0;

356 
∑øm
) {

357 
EEP_NFTHRESH_5
:

358  
pModÆ
[0].
noi£Flo‹ThªshCh
[0];

359 
EEP_NFTHRESH_2
:

360  
pModÆ
[1].
noi£Flo‹ThªshCh
[0];

361 
EEP_MAC_LSW
:

362  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
);

363 
EEP_MAC_MID
:

364  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 2);

365 
EEP_MAC_MSW
:

366  
	`gë_u«lig√d_be16
(
pBa£
->
macAddr
 + 4);

367 
EEP_REG_0
:

368  
pBa£
->
ªgDmn
[0];

369 
EEP_OP_CAP
:

370  
pBa£
->
devi˚C≠
;

371 
EEP_OP_MODE
:

372  
pBa£
->
›C≠Fœgs
;

373 
EEP_RF_SILENT
:

374  
pBa£
->
rfSûít
;

375 
EEP_OB_5
:

376  
pModÆ
[0].
ob
;

377 
EEP_DB_5
:

378  
pModÆ
[0].
db
;

379 
EEP_OB_2
:

380  
pModÆ
[1].
ob
;

381 
EEP_DB_2
:

382  
pModÆ
[1].
db
;

383 
EEP_MINOR_REV
:

384  
AR5416_VER_MASK
;

385 
EEP_TX_MASK
:

386  
pBa£
->
txMask
;

387 
EEP_RX_MASK
:

388  
pBa£
->
rxMask
;

389 
EEP_FSTCLK_5G
:

390  
pBa£
->
Á°Clk5g
;

391 
EEP_RXGAIN_TYPE
:

392  
pBa£
->
rxGaöTy≥
;

393 
EEP_TXGAIN_TYPE
:

394  
pBa£
->
txGaöTy≥
;

395 
EEP_OL_PWRCTRL
:

396 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_19
)

397  
pBa£
->
›íLo›PwrC¡l
 ? 
åue
 : 
Ál£
;

399  
Ál£
;

400 
EEP_RC_CHAIN_MASK
:

401 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_19
)

402  
pBa£
->
rcChaöMask
;

405 
EEP_DAC_HPWR_5G
:

406 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_20
)

407  
pBa£
->
dacHiPwrMode_5G
;

410 
EEP_FRAC_N_5G
:

411 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_22
)

412  
pBa£
->
‰ac_n_5g
;

415 
EEP_PWR_TABLE_OFFSET
:

416 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_21
)

417  
pBa£
->
pwr_èbÀ_off£t
;

419  
AR5416_PWR_TABLE_OFFSET_DB
;

420 
EEP_ANTENNA_GAIN_2G
:

421 
b™d
 = 1;

423 
EEP_ANTENNA_GAIN_5G
:

424  
	`max_t
(
u8
, max_t(u8,

425 
pModÆ
[
b™d
].
™ã¬aGaöCh
[0],

426 
pModÆ
[
b™d
].
™ã¬aGaöCh
[1]),

427 
pModÆ
[
b™d
].
™ã¬aGaöCh
[2]);

431 
	}
}

433 
	$©h9k_hw_def_£t_gaö
(
©h_hw
 *
ah
,

434 
modÆ_ìp_hódî
 *
pModÆ
,

435 
¨5416_ì¥om_def
 *
ìp
,

436 
u8
 
txRxAâíLoˇl
, 
ªgChaöOff£t
, 
i
)

438 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

439 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_3
) {

440 
txRxAâíLoˇl
 = 
pModÆ
->
txRxAâíCh
[
i
];

442 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

443 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

444 
AR_PHY_GAIN_2GHZ_XATTEN1_MARGIN
,

445 
pModÆ
->
bswM¨gö
[
i
]);

446 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

447 
AR_PHY_GAIN_2GHZ_XATTEN1_DB
,

448 
pModÆ
->
bswAâí
[
i
]);

449 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

450 
AR_PHY_GAIN_2GHZ_XATTEN2_MARGIN
,

451 
pModÆ
->
x©ãn2M¨gö
[
i
]);

452 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

453 
AR_PHY_GAIN_2GHZ_XATTEN2_DB
,

454 
pModÆ
->
x©ãn2Db
[
i
]);

456 
	`REG_RMW
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

457 
	`SM
(
pModÆ
-> 
bswM¨gö
[
i
], 
AR_PHY_GAIN_2GHZ_BSW_MARGIN
),

458 
AR_PHY_GAIN_2GHZ_BSW_MARGIN
);

459 
	`REG_RMW
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

460 
	`SM
(
pModÆ
->
bswAâí
[
i
], 
AR_PHY_GAIN_2GHZ_BSW_ATTEN
),

461 
AR_PHY_GAIN_2GHZ_BSW_ATTEN
);

465 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

466 
	`REG_RMW_FIELD
(
ah
,

467 
AR_PHY_RXGAIN
 + 
ªgChaöOff£t
,

468 
AR9280_PHY_RXGAIN_TXRX_ATTEN
, 
txRxAâíLoˇl
);

469 
	`REG_RMW_FIELD
(
ah
,

470 
AR_PHY_RXGAIN
 + 
ªgChaöOff£t
,

471 
AR9280_PHY_RXGAIN_TXRX_MARGIN
, 
pModÆ
->
rxTxM¨göCh
[
i
]);

473 
	`REG_RMW
(
ah
, 
AR_PHY_RXGAIN
 + 
ªgChaöOff£t
,

474 
	`SM
(
txRxAâíLoˇl
, 
AR_PHY_RXGAIN_TXRX_ATTEN
),

475 
AR_PHY_RXGAIN_TXRX_ATTEN
);

476 
	`REG_RMW
(
ah
, 
AR_PHY_GAIN_2GHZ
 + 
ªgChaöOff£t
,

477 
	`SM
(
pModÆ
->
rxTxM¨göCh
[
i
], 
AR_PHY_GAIN_2GHZ_RXTX_MARGIN
),

478 
AR_PHY_GAIN_2GHZ_RXTX_MARGIN
);

480 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

481 
	}
}

483 
	$©h9k_hw_def_£t_bﬂrd_vÆues
(
©h_hw
 *
ah
,

484 
©h9k_ch™√l
 *
ch™
)

486 
modÆ_ìp_hódî
 *
pModÆ
;

487 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

488 
i
, 
ªgChaöOff£t
;

489 
u8
 
txRxAâíLoˇl
;

491 
pModÆ
 = &(
ìp
->
modÆHódî
[
	`IS_CHAN_2GHZ
(
ch™
)]);

492 
txRxAâíLoˇl
 = 
	`IS_CHAN_2GHZ
(
ch™
) ? 23 : 44;

494 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_COM
, 
pModÆ
->
™tCålComm⁄
 & 0xffff);

496 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

497 i‡(
	`AR_SREV_9280
(
ah
)) {

498 i‡(
i
 >= 2)

502 i‡((
ah
->
rxchaömask
 =5 ||áh->
txchaömask
 =5Ë&& (
i
 != 0))

503 
ªgChaöOff£t
 = (
i
 == 1) ? 0x2000 : 0x1000;

505 
ªgChaöOff£t
 = 
i
 * 0x1000;

507 
	`REG_WRITE
(
ah
, 
AR_PHY_SWITCH_CHAIN_0
 + 
ªgChaöOff£t
,

508 
pModÆ
->
™tCålChaö
[
i
]);

510 
	`REG_WRITE
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0Ë+ 
ªgChaöOff£t
,

511 (
	`REG_READ
(
ah
, 
	`AR_PHY_TIMING_CTRL4
(0Ë+ 
ªgChaöOff£t
) &

512 ~(
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
 |

513 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
)) |

514 
	`SM
(
pModÆ
->
iqCÆICh
[
i
],

515 
AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF
) |

516 
	`SM
(
pModÆ
->
iqCÆQCh
[
i
],

517 
AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF
));

519 
	`©h9k_hw_def_£t_gaö
(
ah
, 
pModÆ
, 
ìp
, 
txRxAâíLoˇl
,

520 
ªgChaöOff£t
, 
i
);

523 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

524 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

525 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF2G1_CH0
,

526 
AR_AN_RF2G1_CH0_OB
,

527 
AR_AN_RF2G1_CH0_OB_S
,

528 
pModÆ
->
ob
);

529 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF2G1_CH0
,

530 
AR_AN_RF2G1_CH0_DB
,

531 
AR_AN_RF2G1_CH0_DB_S
,

532 
pModÆ
->
db
);

533 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF2G1_CH1
,

534 
AR_AN_RF2G1_CH1_OB
,

535 
AR_AN_RF2G1_CH1_OB_S
,

536 
pModÆ
->
ob_ch1
);

537 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF2G1_CH1
,

538 
AR_AN_RF2G1_CH1_DB
,

539 
AR_AN_RF2G1_CH1_DB_S
,

540 
pModÆ
->
db_ch1
);

542 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF5G1_CH0
,

543 
AR_AN_RF5G1_CH0_OB5
,

544 
AR_AN_RF5G1_CH0_OB5_S
,

545 
pModÆ
->
ob
);

546 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF5G1_CH0
,

547 
AR_AN_RF5G1_CH0_DB5
,

548 
AR_AN_RF5G1_CH0_DB5_S
,

549 
pModÆ
->
db
);

550 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF5G1_CH1
,

551 
AR_AN_RF5G1_CH1_OB5
,

552 
AR_AN_RF5G1_CH1_OB5_S
,

553 
pModÆ
->
ob_ch1
);

554 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_RF5G1_CH1
,

555 
AR_AN_RF5G1_CH1_DB5
,

556 
AR_AN_RF5G1_CH1_DB5_S
,

557 
pModÆ
->
db_ch1
);

559 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_TOP2
,

560 
AR_AN_TOP2_XPABIAS_LVL
,

561 
AR_AN_TOP2_XPABIAS_LVL_S
,

562 
pModÆ
->
x∑BüsLvl
);

563 
	`©h9k_hw_™Æog_shi·_rmw
(
ah
, 
AR_AN_TOP2
,

564 
AR_AN_TOP2_LOCALBIAS
,

565 
AR_AN_TOP2_LOCALBIAS_S
,

566 !!(
pModÆ
->
 a_˘l
 &

567 
LNA_CTL_LOCAL_BIAS
));

568 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_XPA_CFG
, 
AR_PHY_FORCE_XPA_CFG
,

569 !!(
pModÆ
->
 a_˘l
 & 
LNA_CTL_FORCE_XPA
));

572 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
, 
AR_PHY_SETTLING_SWITCH
,

573 
pModÆ
->
swôchSëéög
);

574 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_DESIRED_SZ
, 
AR_PHY_DESIRED_SZ_ADC
,

575 
pModÆ
->
adcDesúedSize
);

577 i‡(!
	`AR_SREV_9280_20_OR_LATER
(
ah
))

578 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_DESIRED_SZ
,

579 
AR_PHY_DESIRED_SZ_PGA
,

580 
pModÆ
->
pgaDesúedSize
);

582 
	`REG_WRITE
(
ah
, 
AR_PHY_RF_CTL4
,

583 
	`SM
(
pModÆ
->
txEndToX∑Off
, 
AR_PHY_RF_CTL4_TX_END_XPAA_OFF
)

584 | 
	`SM
(
pModÆ
->
txEndToX∑Off
,

585 
AR_PHY_RF_CTL4_TX_END_XPAB_OFF
)

586 | 
	`SM
(
pModÆ
->
txFømeToX∑On
,

587 
AR_PHY_RF_CTL4_FRAME_XPAA_ON
)

588 | 
	`SM
(
pModÆ
->
txFømeToX∑On
,

589 
AR_PHY_RF_CTL4_FRAME_XPAB_ON
));

591 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL3
, 
AR_PHY_TX_END_TO_A2_RX_ON
,

592 
pModÆ
->
txEndToRxOn
);

594 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

595 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCA
, 
AR9280_PHY_CCA_THRESH62
,

596 
pModÆ
->
thªsh62
);

597 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA0
,

598 
AR_PHY_EXT_CCA0_THRESH62
,

599 
pModÆ
->
thªsh62
);

601 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCA
, 
AR_PHY_CCA_THRESH62
,

602 
pModÆ
->
thªsh62
);

603 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_EXT_CCA
,

604 
AR_PHY_EXT_CCA_THRESH62
,

605 
pModÆ
->
thªsh62
);

608 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_2
) {

609 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
,

610 
AR_PHY_TX_END_DATA_START
,

611 
pModÆ
->
txFømeToD©aSèπ
);

612 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_RF_CTL2
, 
AR_PHY_TX_END_PA_ON
,

613 
pModÆ
->
txFømeToPaOn
);

616 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_3
) {

617 i‡(
	`IS_CHAN_HT40
(
ch™
))

618 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_SETTLING
,

619 
AR_PHY_SETTLING_SWITCH
,

620 
pModÆ
->
swSëéeHt40
);

623 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
) &&

624 
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_19
)

625 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_CCK_TX_CTRL
,

626 
AR_PHY_CCK_TX_CTRL_TX_DAC_SCALE_CCK
,

627 
pModÆ
->
miscBôs
);

630 i‡(
	`AR_SREV_9280_20
(
ah
Ë&& 
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_20
) {

631 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

632 
	`REG_RMW_FIELD
(
ah
, 
AR_AN_TOP1
, 
AR_AN_TOP1_DACIPMODE
,

633 
ìp
->
ba£EïHódî
.
dacLpMode
);

634 i‡(
ìp
->
ba£EïHódî
.
dacHiPwrMode_5G
)

635 
	`REG_RMW_FIELD
(
ah
, 
AR_AN_TOP1
, 
AR_AN_TOP1_DACIPMODE
, 0);

637 
	`REG_RMW_FIELD
(
ah
, 
AR_AN_TOP1
, 
AR_AN_TOP1_DACIPMODE
,

638 
ìp
->
ba£EïHódî
.
dacLpMode
);

640 
	`udñay
(100);

642 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_FRAME_CTL
, 
AR_PHY_FRAME_CTL_TX_CLIP
,

643 
pModÆ
->
miscBôs
 >> 2);

645 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TX_PWRCTRL9
,

646 
AR_PHY_TX_DESIRED_SCALE_CCK
,

647 
ìp
->
ba£EïHódî
.
desúedSˇÀCCK
);

649 
	}
}

651 
	$©h9k_hw_def_£t_addac
(
©h_hw
 *
ah
,

652 
©h9k_ch™√l
 *
ch™
)

654 
	#XPA_LVL_FREQ
(
˙t
Ë(
pModÆ
->
x∑BüsLvlFªq
[˙t])

	)

655 
modÆ_ìp_hódî
 *
pModÆ
;

656 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

657 
u8
 
bü¶evñ
;

659 i‡(
ah
->
hw_vîsi⁄
.
macVîsi⁄
 !
AR_SREV_VERSION_9160
)

662 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om_ªv
◊hË< 
AR5416_EEP_MINOR_VER_7
)

665 
pModÆ
 = &(
ìp
->
modÆHódî
[
	`IS_CHAN_2GHZ
(
ch™
)]);

667 i‡(
pModÆ
->
x∑BüsLvl
 != 0xff) {

668 
bü¶evñ
 = 
pModÆ
->
x∑BüsLvl
;

670 
u16
 
ª£tFªqBö
, 
‰eqBö
, 
‰eqCou¡
 = 0;

671 
ch™_˚¡îs
 
˚¡îs
;

673 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

675 
ª£tFªqBö
 = 
	`FREQ2FBIN
(
˚¡îs
.
sy¡h_˚¡î
,

676 
	`IS_CHAN_2GHZ
(
ch™
));

677 
‰eqBö
 = 
	`XPA_LVL_FREQ
(0) & 0xff;

678 
bü¶evñ
 = (
u8
Ë(
	`XPA_LVL_FREQ
(0) >> 14);

680 
‰eqCou¡
++;

682 
‰eqCou¡
 < 3) {

683 i‡(
	`XPA_LVL_FREQ
(
‰eqCou¡
) == 0x0)

686 
‰eqBö
 = 
	`XPA_LVL_FREQ
(
‰eqCou¡
) & 0xff;

687 i‡(
ª£tFªqBö
 >
‰eqBö
)

688 
bü¶evñ
 = (
u8
)(
	`XPA_LVL_FREQ
(
‰eqCou¡
) >> 14);

691 
‰eqCou¡
++;

695 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

696 
	`INI_RA
(&
ah
->
öiAddac
, 7, 1) = (INI_RA(&ah->iniAddac,

697 7, 1Ë& (~0x18)Ë| 
bü¶evñ
 << 3;

699 
	`INI_RA
(&
ah
->
öiAddac
, 6, 1) = (INI_RA(&ah->iniAddac,

700 6, 1Ë& (~0xc0)Ë| 
bü¶evñ
 << 6;

702 #unde‡
XPA_LVL_FREQ


703 
	}
}

705 
öt16_t
 
	$©h9k_ch™ge_gaö_bound¨y_£âög
(
©h_hw
 *
ah
,

706 
u16
 *
gb
,

707 
u16
 
numXpdGaö
,

708 
u16
 
pdGaöOvîœp_t2
,

709 
öt8_t
 
pwr_èbÀ_off£t
,

710 
öt16_t
 *
diff
)

713 
u16
 
k
;

720 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

721 
u16
 
gb_limô
;

723 i‡(
AR5416_PWR_TABLE_OFFSET_DB
 !
pwr_èbÀ_off£t
) {

725 *
diff
 = (
u16
)(
pwr_èbÀ_off£t
 - 
AR5416_PWR_TABLE_OFFSET_DB
);

727 *
diff
 *= 2;

731 
k
 = 0; k < 
numXpdGaö
; k++)

732 
gb
[
k
] = (
u16
)(gb[k] - *
diff
);

737 
gb_limô
 = (
u16
)(
MAX_RATE_POWER
 - 
pdGaöOvîœp_t2
);

739 
k
 = 0; k < 
numXpdGaö
; k++)

740 
gb
[
k
] = (
u16
)
	`mö
(
gb_limô
, gb[k]);

743  *
diff
;

744 
	}
}

746 
	$©h9k_adju°_pdadc_vÆues
(
©h_hw
 *
ah
,

747 
öt8_t
 
pwr_èbÀ_off£t
,

748 
öt16_t
 
diff
,

749 
u8
 *
pdadcVÆues
)

751 
	#NUM_PDADC
(
diff
Ë(
AR5416_NUM_PDADC_VALUES
 - diff)

	)

752 
u16
 
k
;

759 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

760 i‡(
AR5416_PWR_TABLE_OFFSET_DB
 !
pwr_èbÀ_off£t
) {

762 
k
 = 0; k < (
u16
)
	`NUM_PDADC
(
diff
); k++ ) {

763 
pdadcVÆues
[
k
] =ÖdadcVÆues[k + 
diff
];

767 
k
 = (
u16
)
	`NUM_PDADC
(
diff
); k < NUM_PDADC(0); k++) {

768 
pdadcVÆues
[
k
] =ÖdadcVÆues[
	`NUM_PDADC
(
diff
)];

772 #unde‡
NUM_PDADC


773 
	}
}

775 
	$©h9k_hw_£t_def_powî_ˇl_èbÀ
(
©h_hw
 *
ah
,

776 
©h9k_ch™√l
 *
ch™
)

778 
	#SM_PD_GAIN
(
x
Ë
	`SM
(0x38, 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_
##x)

	)

779 
	#SM_PDGAIN_B
(
x
, 
y
) \

780 
	`SM
((
gaöBound¨õs
[
x
]), 
AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_
##
y
)

	)

781 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

782 
¨5416_ì¥om_def
 *
pEïD©a
 = &
ah
->
ì¥om
.
def
;

783 
ˇl_d©a_≥r_‰eq
 *
pRawD©a£t
;

784 
u8
 *
pCÆBCh™s
 = 
NULL
;

785 
u16
 
pdGaöOvîœp_t2
;

786 
u8
 
pdadcVÆues
[
AR5416_NUM_PDADC_VALUES
];

787 
u16
 
gaöBound¨õs
[
AR5416_PD_GAINS_IN_MASK
];

788 
u16
 
numPõrs
, 
i
, 
j
;

789 
öt16_t
 
diff
 = 0;

790 
u16
 
numXpdGaö
, 
xpdMask
;

791 
u16
 
xpdGaöVÆues
[
AR5416_NUM_PD_GAINS
] = { 0, 0, 0, 0 };

792 
u32
 
ªg32
, 
ªgOff£t
, 
ªgChaöOff£t
;

793 
öt16_t
 
modÆIdx
;

794 
öt8_t
 
pwr_èbÀ_off£t
;

796 
modÆIdx
 = 
	`IS_CHAN_2GHZ
(
ch™
) ? 1 : 0;

797 
xpdMask
 = 
pEïD©a
->
modÆHódî
[
modÆIdx
].
xpdGaö
;

799 
pwr_èbÀ_off£t
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_PWR_TABLE_OFFSET
);

801 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

802 
AR5416_EEP_MINOR_VER_2
) {

803 
pdGaöOvîœp_t2
 =

804 
pEïD©a
->
modÆHódî
[
modÆIdx
].
pdGaöOvîœp
;

806 
pdGaöOvîœp_t2
 = (
u16
)(
	`MS
(
	`REG_READ
(
ah
, 
AR_PHY_TPCRG5
),

807 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
));

810 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

811 
pCÆBCh™s
 = 
pEïD©a
->
ˇlFªqPõr2G
;

812 
numPõrs
 = 
AR5416_NUM_2G_CAL_PIERS
;

814 
pCÆBCh™s
 = 
pEïD©a
->
ˇlFªqPõr5G
;

815 
numPõrs
 = 
AR5416_NUM_5G_CAL_PIERS
;

818 i‡(
OLC_FOR_AR9280_20_LATER
 && 
	`IS_CHAN_2GHZ
(
ch™
)) {

819 
pRawD©a£t
 = 
pEïD©a
->
ˇlPõrD©a2G
[0];

820 
ah
->
öôPDADC
 = ((
ˇlD©aPîFªqOpLo›
 *)

821 
pRawD©a£t
)->
vpdPdg
[0][0];

824 
numXpdGaö
 = 0;

826 
i
 = 1; i <
AR5416_PD_GAINS_IN_MASK
; i++) {

827 i‡((
xpdMask
 >> (
AR5416_PD_GAINS_IN_MASK
 - 
i
)) & 1) {

828 i‡(
numXpdGaö
 >
AR5416_NUM_PD_GAINS
)

830 
xpdGaöVÆues
[
numXpdGaö
] =

831 (
u16
)(
AR5416_PD_GAINS_IN_MASK
 - 
i
);

832 
numXpdGaö
++;

836 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_NUM_PD_GAIN
,

837 (
numXpdGaö
 - 1) & 0x3);

838 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_1
,

839 
xpdGaöVÆues
[0]);

840 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_2
,

841 
xpdGaöVÆues
[1]);

842 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TPCRG1
, 
AR_PHY_TPCRG1_PD_GAIN_3
,

843 
xpdGaöVÆues
[2]);

845 
i
 = 0; i < 
AR5416_MAX_CHAINS
; i++) {

846 i‡((
ah
->
rxchaömask
 =5 ||áh->
txchaömask
 == 5) &&

847 (
i
 != 0)) {

848 
ªgChaöOff£t
 = (
i
 == 1) ? 0x2000 : 0x1000;

850 
ªgChaöOff£t
 = 
i
 * 0x1000;

852 i‡(
pEïD©a
->
ba£EïHódî
.
txMask
 & (1 << 
i
)) {

853 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

854 
pRawD©a£t
 = 
pEïD©a
->
ˇlPõrD©a2G
[
i
];

856 
pRawD©a£t
 = 
pEïD©a
->
ˇlPõrD©a5G
[
i
];

859 i‡(
OLC_FOR_AR9280_20_LATER
) {

860 
u8
 
pcdacIdx
;

861 
u8
 
txPowî
;

863 
	`©h9k_gë_txgaö_ödex
(
ah
, 
ch™
,

864 (
ˇlD©aPîFªqOpLo›
 *)
pRawD©a£t
,

865 
pCÆBCh™s
, 
numPõrs
, &
txPowî
, &
pcdacIdx
);

866 
	`©h9k_ﬁc_gë_pdadcs
(
ah
, 
pcdacIdx
,

867 
txPowî
/2, 
pdadcVÆues
);

869 
	`©h9k_hw_gë_gaö_bound¨õs_pdadcs
(
ah
,

870 
ch™
, 
pRawD©a£t
,

871 
pCÆBCh™s
, 
numPõrs
,

872 
pdGaöOvîœp_t2
,

873 
gaöBound¨õs
,

874 
pdadcVÆues
,

875 
numXpdGaö
);

878 
diff
 = 
	`©h9k_ch™ge_gaö_bound¨y_£âög
(
ah
,

879 
gaöBound¨õs
,

880 
numXpdGaö
,

881 
pdGaöOvîœp_t2
,

882 
pwr_èbÀ_off£t
,

883 &
diff
);

885 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

887 i‡(
OLC_FOR_AR9280_20_LATER
) {

888 
	`REG_WRITE
(
ah
,

889 
AR_PHY_TPCRG5
 + 
ªgChaöOff£t
,

890 
	`SM
(0x6,

891 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
) |

892 
	`SM_PD_GAIN
(1) | SM_PD_GAIN(2) |

893 
	`SM_PD_GAIN
(3) | SM_PD_GAIN(4));

895 
	`REG_WRITE
(
ah
,

896 
AR_PHY_TPCRG5
 + 
ªgChaöOff£t
,

897 
	`SM
(
pdGaöOvîœp_t2
,

898 
AR_PHY_TPCRG5_PD_GAIN_OVERLAP
)|

899 
	`SM_PDGAIN_B
(0, 1) |

900 
	`SM_PDGAIN_B
(1, 2) |

901 
	`SM_PDGAIN_B
(2, 3) |

902 
	`SM_PDGAIN_B
(3, 4));

905 
	`©h9k_adju°_pdadc_vÆues
(
ah
, 
pwr_èbÀ_off£t
,

906 
diff
, 
pdadcVÆues
);

908 
ªgOff£t
 = 
AR_PHY_BASE
 + (672 << 2Ë+ 
ªgChaöOff£t
;

909 
j
 = 0; j < 32; j++) {

910 
ªg32
 = 
	`gë_u«lig√d_À32
(&
pdadcVÆues
[4 * 
j
]);

911 
	`REG_WRITE
(
ah
, 
ªgOff£t
, 
ªg32
);

913 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

915 
i
, 
ªgChaöOff£t
, 
ªgOff£t
,

916 
ªg32
);

917 
	`©h_dbg
(
comm⁄
, 
EEPROM
,

919 
i
, 4 * 
j
, 
pdadcVÆues
[4 * j],

920 4 * 
j
 + 1, 
pdadcVÆues
[4 * j + 1],

921 4 * 
j
 + 2, 
pdadcVÆues
[4 * j + 2],

922 4 * 
j
 + 3, 
pdadcVÆues
[4 * j + 3]);

924 
ªgOff£t
 += 4;

926 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

930 #unde‡
SM_PD_GAIN


931 #unde‡
SM_PDGAIN_B


932 
	}
}

934 
	$©h9k_hw_£t_def_powî_≥r_øã_èbÀ
(
©h_hw
 *
ah
,

935 
©h9k_ch™√l
 *
ch™
,

936 
öt16_t
 *
øãsAºay
,

937 
u16
 
cfgCé
,

938 
u16
 
™ã¬a_ªdu˘i⁄
,

939 
u16
 
powîLimô
)

941 
¨5416_ì¥om_def
 *
pEïD©a
 = &
ah
->
ì¥om
.
def
;

942 
u16
 
twi˚MaxEdgePowî
;

943 
i
;

944 
ˇl_˘l_d©a
 *
ªp
;

945 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdm
, 
èrgëPowîCck
 = {

948 
ˇl_èrgë_powî_Àg
 
èrgëPowîOfdmExt
 = {

949 0, { 0, 0, 0, 0} }, 
èrgëPowîCckExt
 = {

952 
ˇl_èrgë_powî_ht
 
èrgëPowîHt20
, 
èrgëPowîHt40
 = {

955 
u16
 
sˇÀdPowî
 = 0, 
möCéPowî
;

956 c⁄° 
u16
 
˘lModesF‹11a
[] = {

957 
CTL_11A
, 
CTL_5GHT20
, 
CTL_11A_EXT
, 
CTL_5GHT40


959 c⁄° 
u16
 
˘lModesF‹11g
[] = {

960 
CTL_11B
, 
CTL_11G
, 
CTL_2GHT20
,

961 
CTL_11B_EXT
, 
CTL_11G_EXT
, 
CTL_2GHT40


963 
u16
 
numCéModes
;

964 c⁄° 
u16
 *
pCéMode
;

965 
u16
 
˘lMode
, 
‰eq
;

966 
ch™_˚¡îs
 
˚¡îs
;

967 
tx_chaömask
;

968 
u16
 
twi˚MöEdgePowî
;

970 
tx_chaömask
 = 
ah
->
txchaömask
;

972 
	`©h9k_hw_gë_ch™√l_˚¡îs
(
ah
, 
ch™
, &
˚¡îs
);

974 
sˇÀdPowî
 = 
	`©h9k_hw_gë_sˇÀd_powî
(
ah
, 
powîLimô
,

975 
™ã¬a_ªdu˘i⁄
);

977 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

978 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
) -

979 
SUB_NUM_CTL_MODES_AT_2G_40
;

980 
pCéMode
 = 
˘lModesF‹11g
;

982 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

983 
pEïD©a
->
ˇlT¨gëPowîCck
,

984 
AR5416_NUM_2G_CCK_TARGET_POWERS
,

985 &
èrgëPowîCck
, 4, 
Ál£
);

986 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

987 
pEïD©a
->
ˇlT¨gëPowî2G
,

988 
AR5416_NUM_2G_20_TARGET_POWERS
,

989 &
èrgëPowîOfdm
, 4, 
Ál£
);

990 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

991 
pEïD©a
->
ˇlT¨gëPowî2GHT20
,

992 
AR5416_NUM_2G_20_TARGET_POWERS
,

993 &
èrgëPowîHt20
, 8, 
Ál£
);

995 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

996 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11g
);

997 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

998 
pEïD©a
->
ˇlT¨gëPowî2GHT40
,

999 
AR5416_NUM_2G_40_TARGET_POWERS
,

1000 &
èrgëPowîHt40
, 8, 
åue
);

1001 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

1002 
pEïD©a
->
ˇlT¨gëPowîCck
,

1003 
AR5416_NUM_2G_CCK_TARGET_POWERS
,

1004 &
èrgëPowîCckExt
, 4, 
åue
);

1005 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

1006 
pEïD©a
->
ˇlT¨gëPowî2G
,

1007 
AR5416_NUM_2G_20_TARGET_POWERS
,

1008 &
èrgëPowîOfdmExt
, 4, 
åue
);

1011 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11a
) -

1012 
SUB_NUM_CTL_MODES_AT_5G_40
;

1013 
pCéMode
 = 
˘lModesF‹11a
;

1015 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

1016 
pEïD©a
->
ˇlT¨gëPowî5G
,

1017 
AR5416_NUM_5G_20_TARGET_POWERS
,

1018 &
èrgëPowîOfdm
, 4, 
Ál£
);

1019 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

1020 
pEïD©a
->
ˇlT¨gëPowî5GHT20
,

1021 
AR5416_NUM_5G_20_TARGET_POWERS
,

1022 &
èrgëPowîHt20
, 8, 
Ál£
);

1024 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

1025 
numCéModes
 = 
	`ARRAY_SIZE
(
˘lModesF‹11a
);

1026 
	`©h9k_hw_gë_èrgë_powîs
(
ah
, 
ch™
,

1027 
pEïD©a
->
ˇlT¨gëPowî5GHT40
,

1028 
AR5416_NUM_5G_40_TARGET_POWERS
,

1029 &
èrgëPowîHt40
, 8, 
åue
);

1030 
	`©h9k_hw_gë_Àgacy_èrgë_powîs
(
ah
, 
ch™
,

1031 
pEïD©a
->
ˇlT¨gëPowî5G
,

1032 
AR5416_NUM_5G_20_TARGET_POWERS
,

1033 &
èrgëPowîOfdmExt
, 4, 
åue
);

1037 
˘lMode
 = 0; céModê< 
numCéModes
; ctlMode++) {

1038 
boﬁ
 
isHt40CéMode
 = (
pCéMode
[
˘lMode
] =
CTL_5GHT40
) ||

1039 (
pCéMode
[
˘lMode
] =
CTL_2GHT40
);

1040 i‡(
isHt40CéMode
)

1041 
‰eq
 = 
˚¡îs
.
sy¡h_˚¡î
;

1042 i‡(
pCéMode
[
˘lMode
] & 
EXT_ADDITIVE
)

1043 
‰eq
 = 
˚¡îs
.
ext_˚¡î
;

1045 
‰eq
 = 
˚¡îs
.
˘l_˚¡î
;

1047 
twi˚MaxEdgePowî
 = 
MAX_RATE_POWER
;

1049 
i
 = 0; (ò< 
AR5416_NUM_CTLS
Ë&& 
pEïD©a
->
˘lIndex
[i]; i++) {

1050 i‡((((
cfgCé
 & ~
CTL_MODE_M
) |

1051 (
pCéMode
[
˘lMode
] & 
CTL_MODE_M
)) ==

1052 
pEïD©a
->
˘lIndex
[
i
]) ||

1053 (((
cfgCé
 & ~
CTL_MODE_M
) |

1054 (
pCéMode
[
˘lMode
] & 
CTL_MODE_M
)) ==

1055 ((
pEïD©a
->
˘lIndex
[
i
] & 
CTL_MODE_M
Ë| 
SD_NO_CTL
))) {

1056 
ªp
 = &(
pEïD©a
->
˘lD©a
[
i
]);

1058 
twi˚MöEdgePowî
 = 
	`©h9k_hw_gë_max_edge_powî
(
‰eq
,

1059 
ªp
->
˘lEdges
[
	`¨5416_gë_¡xchaös
(
tx_chaömask
) - 1],

1060 
	`IS_CHAN_2GHZ
(
ch™
), 
AR5416_NUM_BAND_EDGES
);

1062 i‡((
cfgCé
 & ~
CTL_MODE_M
Ë=
SD_NO_CTL
) {

1063 
twi˚MaxEdgePowî
 = 
	`mö
(twiceMaxEdgePower,

1064 
twi˚MöEdgePowî
);

1066 
twi˚MaxEdgePowî
 = 
twi˚MöEdgePowî
;

1072 
möCéPowî
 = 
	`mö
(
twi˚MaxEdgePowî
, 
sˇÀdPowî
);

1074 
pCéMode
[
˘lMode
]) {

1075 
CTL_11B
:

1076 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîCck
.
tPow2x
); i++) {

1077 
èrgëPowîCck
.
tPow2x
[
i
] =

1078 
	`mö
((
u16
)
èrgëPowîCck
.
tPow2x
[
i
],

1079 
möCéPowî
);

1082 
CTL_11A
:

1083 
CTL_11G
:

1084 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîOfdm
.
tPow2x
); i++) {

1085 
èrgëPowîOfdm
.
tPow2x
[
i
] =

1086 
	`mö
((
u16
)
èrgëPowîOfdm
.
tPow2x
[
i
],

1087 
möCéPowî
);

1090 
CTL_5GHT20
:

1091 
CTL_2GHT20
:

1092 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++) {

1093 
èrgëPowîHt20
.
tPow2x
[
i
] =

1094 
	`mö
((
u16
)
èrgëPowîHt20
.
tPow2x
[
i
],

1095 
möCéPowî
);

1098 
CTL_11B_EXT
:

1099 
èrgëPowîCckExt
.
tPow2x
[0] = 
	`mö
((
u16
)

1100 
èrgëPowîCckExt
.
tPow2x
[0],

1101 
möCéPowî
);

1103 
CTL_11A_EXT
:

1104 
CTL_11G_EXT
:

1105 
èrgëPowîOfdmExt
.
tPow2x
[0] = 
	`mö
((
u16
)

1106 
èrgëPowîOfdmExt
.
tPow2x
[0],

1107 
möCéPowî
);

1109 
CTL_5GHT40
:

1110 
CTL_2GHT40
:

1111 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++) {

1112 
èrgëPowîHt40
.
tPow2x
[
i
] =

1113 
	`mö
((
u16
)
èrgëPowîHt40
.
tPow2x
[
i
],

1114 
möCéPowî
);

1122 
øãsAºay
[
øã6mb
] =Ñ©esAºay[
øã9mb
] =Ñ©esAºay[
øã12mb
] =

1123 
øãsAºay
[
øã18mb
] =Ñ©esAºay[
øã24mb
] =

1124 
èrgëPowîOfdm
.
tPow2x
[0];

1125 
øãsAºay
[
øã36mb
] = 
èrgëPowîOfdm
.
tPow2x
[1];

1126 
øãsAºay
[
øã48mb
] = 
èrgëPowîOfdm
.
tPow2x
[2];

1127 
øãsAºay
[
øã54mb
] = 
èrgëPowîOfdm
.
tPow2x
[3];

1128 
øãsAºay
[
øãXr
] = 
èrgëPowîOfdm
.
tPow2x
[0];

1130 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt20
.
tPow2x
); i++)

1131 
øãsAºay
[
øãHt20_0
 + 
i
] = 
èrgëPowîHt20
.
tPow2x
[i];

1133 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

1134 
øãsAºay
[
øã1l
] = 
èrgëPowîCck
.
tPow2x
[0];

1135 
øãsAºay
[
øã2s
] =Ñ©esAºay[
øã2l
] =

1136 
èrgëPowîCck
.
tPow2x
[1];

1137 
øãsAºay
[
øã5_5s
] =Ñ©esAºay[
øã5_5l
] =

1138 
èrgëPowîCck
.
tPow2x
[2];

1139 
øãsAºay
[
øã11s
] =Ñ©esAºay[
øã11l
] =

1140 
èrgëPowîCck
.
tPow2x
[3];

1142 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

1143 
i
 = 0; i < 
	`ARRAY_SIZE
(
èrgëPowîHt40
.
tPow2x
); i++) {

1144 
øãsAºay
[
øãHt40_0
 + 
i
] =

1145 
èrgëPowîHt40
.
tPow2x
[
i
];

1147 
øãsAºay
[
øãDupOfdm
] = 
èrgëPowîHt40
.
tPow2x
[0];

1148 
øãsAºay
[
øãDupCck
] = 
èrgëPowîHt40
.
tPow2x
[0];

1149 
øãsAºay
[
øãExtOfdm
] = 
èrgëPowîOfdmExt
.
tPow2x
[0];

1150 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

1151 
øãsAºay
[
øãExtCck
] =

1152 
èrgëPowîCckExt
.
tPow2x
[0];

1155 
	}
}

1157 
	$©h9k_hw_def_£t_txpowî
(
©h_hw
 *
ah
,

1158 
©h9k_ch™√l
 *
ch™
,

1159 
u16
 
cfgCé
,

1160 
u8
 
twi˚A¡í«Redu˘i⁄
,

1161 
u8
 
powîLimô
, 
boﬁ
 
ã°
)

1163 
	#RT_AR_DELTA
(
x
Ë(
øãsAºay
[x] - 
cck_ofdm_dñè
)

	)

1164 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

1165 
¨5416_ì¥om_def
 *
pEïD©a
 = &
ah
->
ì¥om
.
def
;

1166 
modÆ_ìp_hódî
 *
pModÆ
 =

1167 &(
pEïD©a
->
modÆHódî
[
	`IS_CHAN_2GHZ
(
ch™
)]);

1168 
öt16_t
 
øãsAºay
[
Ar5416R©eSize
];

1169 
u8
 
ht40PowîIncF‹Pdadc
 = 2;

1170 
i
, 
cck_ofdm_dñè
 = 0;

1172 
	`mem£t
(
øãsAºay
, 0, (ratesArray));

1174 i‡((
pEïD©a
->
ba£EïHódî
.
vîsi⁄
 & 
AR5416_EEP_VER_MINOR_MASK
) >=

1175 
AR5416_EEP_MINOR_VER_2
) {

1176 
ht40PowîIncF‹Pdadc
 = 
pModÆ
->ht40PowerIncForPdadc;

1179 
	`©h9k_hw_£t_def_powî_≥r_øã_èbÀ
(
ah
, 
ch™
,

1180 &
øãsAºay
[0], 
cfgCé
,

1181 
twi˚A¡í«Redu˘i⁄
,

1182 
powîLimô
);

1184 
	`©h9k_hw_£t_def_powî_ˇl_èbÀ
(
ah
, 
ch™
);

1186 
ªguœt‹y
->
max_powî_Àvñ
 = 0;

1187 
i
 = 0; i < 
	`ARRAY_SIZE
(
øãsAºay
); i++) {

1188 i‡(
øãsAºay
[
i
] > 
MAX_RATE_POWER
)

1189 
øãsAºay
[
i
] = 
MAX_RATE_POWER
;

1190 i‡(
øãsAºay
[
i
] > 
ªguœt‹y
->
max_powî_Àvñ
)

1191 
ªguœt‹y
->
max_powî_Àvñ
 = 
øãsAºay
[
i
];

1194 
	`©h9k_hw_upd©e_ªguœt‹y_maxpowî
(
ah
);

1196 i‡(
ã°
)

1199 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

1200 
i
 = 0; i < 
Ar5416R©eSize
; i++) {

1201 
öt8_t
 
pwr_èbÀ_off£t
;

1203 
pwr_èbÀ_off£t
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
(ah,

1204 
EEP_PWR_TABLE_OFFSET
);

1205 
øãsAºay
[
i
] -
pwr_èbÀ_off£t
 * 2;

1209 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1211 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE1
,

1212 
	`ATH9K_POW_SM
(
øãsAºay
[
øã18mb
], 24)

1213 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã12mb
], 16)

1214 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã9mb
], 8)

1215 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã6mb
], 0));

1216 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE2
,

1217 
	`ATH9K_POW_SM
(
øãsAºay
[
øã54mb
], 24)

1218 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã48mb
], 16)

1219 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã36mb
], 8)

1220 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã24mb
], 0));

1222 i‡(
	`IS_CHAN_2GHZ
(
ch™
)) {

1223 i‡(
OLC_FOR_AR9280_20_LATER
) {

1224 
cck_ofdm_dñè
 = 2;

1225 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE3
,

1226 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã2s
), 24)

1227 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã2l
), 16)

1228 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãXr
], 8)

1229 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã1l
), 0));

1230 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE4
,

1231 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã11s
), 24)

1232 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã11l
), 16)

1233 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã5_5s
), 8)

1234 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øã5_5l
), 0));

1236 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE3
,

1237 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2s
], 24)

1238 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã2l
], 16)

1239 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãXr
], 8)

1240 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã1l
], 0));

1241 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE4
,

1242 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11s
], 24)

1243 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã11l
], 16)

1244 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5s
], 8)

1245 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øã5_5l
], 0));

1249 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE5
,

1250 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_3
], 24)

1251 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_2
], 16)

1252 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_1
], 8)

1253 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_0
], 0));

1254 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE6
,

1255 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_7
], 24)

1256 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_6
], 16)

1257 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_5
], 8)

1258 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt20_4
], 0));

1260 i‡(
	`IS_CHAN_HT40
(
ch™
)) {

1261 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE7
,

1262 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_3
] +

1263 
ht40PowîIncF‹Pdadc
, 24)

1264 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_2
] +

1265 
ht40PowîIncF‹Pdadc
, 16)

1266 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_1
] +

1267 
ht40PowîIncF‹Pdadc
, 8)

1268 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_0
] +

1269 
ht40PowîIncF‹Pdadc
, 0));

1270 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE8
,

1271 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_7
] +

1272 
ht40PowîIncF‹Pdadc
, 24)

1273 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_6
] +

1274 
ht40PowîIncF‹Pdadc
, 16)

1275 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_5
] +

1276 
ht40PowîIncF‹Pdadc
, 8)

1277 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãHt40_4
] +

1278 
ht40PowîIncF‹Pdadc
, 0));

1279 i‡(
OLC_FOR_AR9280_20_LATER
) {

1280 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE9
,

1281 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtOfdm
], 24)

1282 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øãExtCck
), 16)

1283 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupOfdm
], 8)

1284 | 
	`ATH9K_POW_SM
(
	`RT_AR_DELTA
(
øãDupCck
), 0));

1286 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE9
,

1287 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtOfdm
], 24)

1288 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãExtCck
], 16)

1289 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupOfdm
], 8)

1290 | 
	`ATH9K_POW_SM
(
øãsAºay
[
øãDupCck
], 0));

1294 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_SUB
,

1295 
	`ATH9K_POW_SM
(
pModÆ
->
pwrDe¸ó£F‹3Chaö
, 6)

1296 | 
	`ATH9K_POW_SM
(
pModÆ
->
pwrDe¸ó£F‹2Chaö
, 0));

1299 i‡(
ah
->
çc_íabÀd
) {

1300 
ht40_dñè
;

1302 
ht40_dñè
 = (
	`IS_CHAN_HT40
(
ch™
)Ë? 
ht40PowîIncF‹Pdadc
 : 0;

1303 
	`¨5008_hw_öô_øã_txpowî
(
ah
, 
øãsAºay
, 
ch™
, 
ht40_dñè
);

1305 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
,

1306 
MAX_RATE_POWER
 | 
AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE
);

1309 
	`REG_WRITE
(
ah
, 
AR_PHY_POWER_TX_RATE_MAX
, 
MAX_RATE_POWER
);

1312 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1313 
	}
}

1315 
u16
 
	$©h9k_hw_def_gë_•ur_ch™√l
(
©h_hw
 *
ah
, 
u16
 
i
, 
boﬁ
 
is2GHz
)

1317  
ah
->
ì¥om
.
def
.
modÆHódî
[
is2GHz
].
•urCh™s
[
i
].
•urCh™
;

1318 
	}
}

1320 c⁄° 
ì¥om_›s
 
	gìp_def_›s
 = {

1321 .
check_ì¥om
 = 
©h9k_hw_def_check_ì¥om
,

1322 .
	ggë_ì¥om
 = 
©h9k_hw_def_gë_ì¥om
,

1323 .
	gfûl_ì¥om
 = 
©h9k_hw_def_fûl_ì¥om
,

1324 .
	gdump_ì¥om
 = 
©h9k_hw_def_dump_ì¥om
,

1325 .
	ggë_ì¥om_vî
 = 
©h9k_hw_def_gë_ì¥om_vî
,

1326 .
	ggë_ì¥om_ªv
 = 
©h9k_hw_def_gë_ì¥om_ªv
,

1327 .
	g£t_bﬂrd_vÆues
 = 
©h9k_hw_def_£t_bﬂrd_vÆues
,

1328 .
	g£t_addac
 = 
©h9k_hw_def_£t_addac
,

1329 .
	g£t_txpowî
 = 
©h9k_hw_def_£t_txpowî
,

1330 .
	ggë_•ur_ch™√l
 = 
©h9k_hw_def_gë_•ur_ch™√l


	@gpio.c

17 
	~"©h9k.h
"

18 
	~<löux/©h9k_∂©f‹m.h
>

24 #ifde‡
CPTCFG_MAC80211_LEDS


25 
	$©h_Àd_brighäess
(
Àd_˛assdev
 *
Àd_cdev
,

26 
Àd_brighäess
 
brighäess
)

28 
©h_Àd
 *
Àd
 = 
	`c⁄èöî_of
(
Àd_cdev
, ©h_Àd, 
cdev
);

29 
©h_so·c
 *
sc
 = 
Àd
->sc;

31 
	`©h9k_ps_wakeup
(
sc
);

32 
	`©h9k_hw_£t_gpio
(
sc
->
sc_ah
, 
Àd
->
gpio
->gpio,

33 (
brighäess
 !
LED_OFF
Ë^ 
Àd
->
gpio
->
a˘ive_low
);

34 
	`©h9k_ps_ª°‹e
(
sc
);

35 
	}
}

37 
	$©h_add_Àd
(
©h_so·c
 *
sc
, 
©h_Àd
 *
Àd
)

39 c⁄° 
gpio_Àd
 *
gpio
 = 
Àd
->gpio;

40 
ªt
;

42 
Àd
->
cdev
.
«me
 = 
gpio
->name;

43 
Àd
->
cdev
.
deÁu…_åiggî
 = 
gpio
->default_trigger;

44 
Àd
->
cdev
.
brighäess_£t
 = 
©h_Àd_brighäess
;

46 
ªt
 = 
	`Àd_˛assdev_ªgi°î
(
	`wùhy_dev
(
sc
->
hw
->
wùhy
), &
Àd
->
cdev
);

47 i‡(
ªt
 < 0)

48  
ªt
;

50 
Àd
->
sc
 = sc;

51 
	`li°_add
(&
Àd
->
li°
, &
sc
->
Àds
);

54 
	`©h9k_hw_cfg_ouçut
(
sc
->
sc_ah
, 
gpio
->gpio,

55 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

58 
	`©h9k_hw_£t_gpio
(
sc
->
sc_ah
, 
gpio
->gpio, gpio->
a˘ive_low
);

61 
	}
}

63 
	$©h_¸óã_gpio_Àd
(
©h_so·c
 *
sc
, 
gpio_num
, c⁄° *
«me
,

64 c⁄° *
åiggî
, 
boﬁ
 
a˘ive_low
)

66 
©h_Àd
 *
Àd
;

67 
gpio_Àd
 *
gpio
;

68 *
_«me
;

69 
ªt
;

71 
Àd
 = 
	`kzÆloc
((*ÀdË+ (*
gpio
Ë+ 
	`°æí
(
«me
) + 1,

72 
GFP_KERNEL
);

73 i‡(!
Àd
)

74  -
ENOMEM
;

76 
Àd
->
gpio
 = gpiÿ(
gpio_Àd
 *) (led + 1);

77 
_«me
 = (*Ë(
Àd
->
gpio
 + 1);

79 
	`°r˝y
(
_«me
, 
«me
);

80 
gpio
->
«me
 = 
_«me
;

81 
gpio
->gpiÿ
gpio_num
;

82 
gpio
->
a˘ive_low
 =áctive_low;

83 
gpio
->
deÁu…_åiggî
 = 
åiggî
;

85 
ªt
 = 
	`©h_add_Àd
(
sc
, 
Àd
);

86 i‡(
	`u∆ikñy
(
ªt
 < 0))

87 
	`k‰ì
(
Àd
);

89  
ªt
;

90 
	}
}

92 
	$©h_¸óã_∂©f‹m_Àd
(
©h_so·c
 *
sc
,

93 c⁄° 
gpio_Àd
 *
gpio
)

95 
©h_Àd
 *
Àd
;

96 
ªt
;

98 
Àd
 = 
	`kzÆloc
((*Àd), 
GFP_KERNEL
);

99 i‡(!
Àd
)

100  -
ENOMEM
;

102 
Àd
->
gpio
 = gpio;

103 
ªt
 = 
	`©h_add_Àd
(
sc
, 
Àd
);

104 i‡(
ªt
 < 0)

105 
	`k‰ì
(
Àd
);

107  
ªt
;

108 
	}
}

110 
	$©h_deöô_Àds
(
©h_so·c
 *
sc
)

112 
©h_Àd
 *
Àd
;

114 !
	`li°_em±y
(&
sc
->
Àds
)) {

115 
Àd
 = 
	`li°_fú°_íåy
(&
sc
->
Àds
, 
©h_Àd
, 
li°
);

116 
	`li°_dñ
(&
Àd
->
li°
);

117 
	`©h_Àd_brighäess
(&
Àd
->
cdev
, 
LED_OFF
);

118 
	`Àd_˛assdev_uƒegi°î
(&
Àd
->
cdev
);

119 
	`k‰ì
(
Àd
);

121 
	}
}

123 
	$©h_öô_Àds
(
©h_so·c
 *
sc
)

125 
©h9k_∂©f‹m_d©a
 *
pd©a
 = 
sc
->
dev
->
∂©f‹m_d©a
;

126 
Àd_«me
[32];

127 c⁄° *
åiggî
;

128 
i
;

130 
	`INIT_LIST_HEAD
(&
sc
->
Àds
);

132 i‡(
	`AR_SREV_9100
(
sc
->
sc_ah
))

135 
	`¢¥ötf
(
Àd_«me
, (led_name), "ath9k-%s",

136 
	`wùhy_«me
(
sc
->
hw
->
wùhy
));

138 i‡(
©h9k_Àd_blök
)

139 
åiggî
 = 
sc
->
Àd_deÁu…_åiggî
;

141 
åiggî
 = 
	`õì80211_gë_ødio_Àd_«me
(
sc
->
hw
);

143 
	`©h_¸óã_gpio_Àd
(
sc
, sc->
sc_ah
->
Àd_pö
, 
Àd_«me
, 
åiggî
, !sc->sc_ah->
c⁄fig
.
Àd_a˘ive_high
);

145 i‡(!
pd©a
)

148 
i
 = 0; i < 
pd©a
->
num_Àds
; i++)

149 
	`©h_¸óã_∂©f‹m_Àd
(
sc
, &
pd©a
->
Àds
[
i
]);

150 
	}
}

152 
	$©h_fûl_Àd_pö
(
©h_so·c
 *
sc
)

154 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

156 i‡(
	`AR_SREV_9100
(
ah
))

159 i‡(
ah
->
Àd_pö
 >= 0) {

160 i‡(!((1 << 
ah
->
Àd_pö
Ë& 
AR_GPIO_OE_OUT_MASK
))

161 
	`©h9k_hw_ªque°_gpio
(
ah
,áh->
Àd_pö
, "ath9k-led");

165 i‡(
	`AR_SREV_9287
(
ah
))

166 
ah
->
Àd_pö
 = 
ATH_LED_PIN_9287
;

167 i‡(
	`AR_SREV_9485
(
sc
->
sc_ah
))

168 
ah
->
Àd_pö
 = 
ATH_LED_PIN_9485
;

169 i‡(
	`AR_SREV_9300
(
sc
->
sc_ah
))

170 
ah
->
Àd_pö
 = 
ATH_LED_PIN_9300
;

171 i‡(
	`AR_SREV_9462
(
sc
->
sc_ah
Ë|| 
	`AR_SREV_9565
(sc->sc_ah))

172 
ah
->
Àd_pö
 = 
ATH_LED_PIN_9462
;

174 
ah
->
Àd_pö
 = 
ATH_LED_PIN_DEF
;

177 
	`©h9k_hw_cfg_ouçut
(
ah
,áh->
Àd_pö
, 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

180 
	`©h9k_hw_£t_gpio
(
ah
,áh->
Àd_pö
, (ah->
c⁄fig
.
Àd_a˘ive_high
) ? 0 : 1);

181 
	}
}

188 
boﬁ
 
	$©h_is_rfkûl_£t
(
©h_so·c
 *
sc
)

190 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

191 
boﬁ
 
is_blocked
;

193 
	`©h9k_ps_wakeup
(
sc
);

194 
is_blocked
 = 
	`©h9k_hw_gpio_gë
(
ah
,áh->
rfkûl_gpio
) ==

195 
ah
->
rfkûl_pﬁ¨ôy
;

196 
	`©h9k_ps_ª°‹e
(
sc
);

198  
is_blocked
;

199 
	}
}

201 
	$©h9k_rfkûl_pﬁl_°©e
(
õì80211_hw
 *
hw
)

203 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

204 
boﬁ
 
blocked
 = !!
	`©h_is_rfkûl_£t
(
sc
);

206 
	`wùhy_rfkûl_£t_hw_°©e
(
hw
->
wùhy
, 
blocked
);

207 
	}
}

209 
	$©h_°¨t_rfkûl_pﬁl
(
©h_so·c
 *
sc
)

211 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

213 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RFSILENT
)

214 
	`wùhy_rfkûl_°¨t_pﬁlög
(
sc
->
hw
->
wùhy
);

215 
	}
}

217 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


226 
	$©h_dëe˘_bt_¥i‹ôy
(
©h_so·c
 *
sc
)

228 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

229 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

231 i‡(
	`©h9k_hw_gpio_gë
(
sc
->
sc_ah
, 
ah
->
btc€x_hw
.
bçri‹ôy_gpio
))

232 
btc€x
->
bt_¥i‹ôy_˙t
++;

234 i‡(
	`time_a·î
(
jiffõs
, 
btc€x
->
bt_¥i‹ôy_time
 +

235 
	`m£cs_to_jiffõs
(
ATH_BT_PRIORITY_TIME_THRESHOLD
))) {

236 
	`˛ór_bô
(
BT_OP_PRIORITY_DETECTED
, &
btc€x
->
›_Êags
);

237 
	`˛ór_bô
(
BT_OP_SCAN
, &
btc€x
->
›_Êags
);

239 i‡(
btc€x
->
bt_¥i‹ôy_˙t
 >
ATH_BT_CNT_SCAN_THRESHOLD
) {

240 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
BTCOEX
,

242 
	`£t_bô
(
BT_OP_PRIORITY_DETECTED
, &
btc€x
->
›_Êags
);

243 
	`£t_bô
(
BT_OP_SCAN
, &
btc€x
->
›_Êags
);

244 } i‡(
btc€x
->
bt_¥i‹ôy_˙t
 >
ATH_BT_CNT_THRESHOLD
) {

245 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
BTCOEX
,

247 
	`£t_bô
(
BT_OP_PRIORITY_DETECTED
, &
btc€x
->
›_Êags
);

250 
btc€x
->
bt_¥i‹ôy_˙t
 = 0;

251 
btc€x
->
bt_¥i‹ôy_time
 = 
jiffõs
;

253 
	}
}

255 
	$©h_mci_·p_adju°
(
©h_so·c
 *
sc
)

257 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

258 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

259 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

261 i‡(
btc€x
->
bt_waô_time
 > 
ATH_BTCOEX_RX_WAIT_TIME
) {

262 i‡(
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_NEED_FTP_STOMP
) &&

263 (
mci
->
num_∑n
 || mci->
num_Ÿhî_a˛
))

264 
ah
->
btc€x_hw
.
mci
.
°omp_·p
 =

265 (
sc
->
rx
.
num_pkts
 < 
ATH_BTCOEX_STOMP_FTP_THRESH
);

267 
ah
->
btc€x_hw
.
mci
.
°omp_·p
 = 
Ál£
;

268 
btc€x
->
bt_waô_time
 = 0;

269 
sc
->
rx
.
num_pkts
 = 0;

271 
	}
}

278 
	$©h_btc€x_≥riod_timî
(
d©a
)

280 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
d©a
;

281 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

282 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

283 
©h_°omp_ty≥
 
°omp_ty≥
;

284 
u32
 
timî_≥riod
;

285 
Êags
;

287 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

288 i‡(
sc
->
sc_ah
->
powî_mode
 =
ATH9K_PM_NETWORK_SLEEP
) {

289 
btc€x
->
bt_waô_time
 +btc€x->
btc€x_≥riod
;

290 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

291 
skù_hw_wakeup
;

293 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

295 
	`©h9k_ps_wakeup
(
sc
);

296 
	`•ö_lock_bh
(&
btc€x
->
btc€x_lock
);

298 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
) {

299 
	`©h9k_mci_upd©e_rssi
(
sc
);

300 
	`©h_mci_·p_adju°
(
sc
);

303 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
))

304 
	`©h_dëe˘_bt_¥i‹ôy
(
sc
);

306 
°omp_ty≥
 = 
btc€x
->
bt_°omp_ty≥
;

307 
timî_≥riod
 = 
btc€x
->
btc€x_no_°omp
;

309 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
)) {

310 i‡(
	`ã°_bô
(
BT_OP_SCAN
, &
btc€x
->
›_Êags
)) {

311 
°omp_ty≥
 = 
ATH_BTCOEX_STOMP_ALL
;

312 
timî_≥riod
 = 
btc€x
->
btsˇn_no_°omp
;

314 } i‡(
btc€x
->
°omp_audio
 >= 5) {

315 
°omp_ty≥
 = 
ATH_BTCOEX_STOMP_AUDIO
;

316 
btc€x
->
°omp_audio
 = 0;

319 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
°omp_ty≥
);

320 
	`©h9k_hw_btc€x_íabÀ
(
ah
);

322 
	`•ö_u∆ock_bh
(&
btc€x
->
btc€x_lock
);

324 i‡(
btc€x
->
btc€x_≥riod
 !btc€x->
btc€x_no_°omp
)

325 
	`mod_timî
(&
btc€x
->
no_°omp_timî
,

326 
jiffõs
 + 
	`m£cs_to_jiffõs
(
timî_≥riod
));

328 
	`©h9k_ps_ª°‹e
(
sc
);

330 
skù_hw_wakeup
:

331 
	`mod_timî
(&
btc€x
->
≥riod_timî
,

332 
jiffõs
 + 
	`m£cs_to_jiffõs
(
btc€x
->
btc€x_≥riod
));

333 
	}
}

339 
	$©h_btc€x_no_°omp_timî
(
¨g
)

341 
©h_so·c
 *
sc
 = (©h_so·¯*)
¨g
;

342 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

343 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

345 
	`©h9k_ps_wakeup
(
sc
);

346 
	`•ö_lock_bh
(&
btc€x
->
btc€x_lock
);

348 i‡(
btc€x
->
bt_°omp_ty≥
 =
ATH_BTCOEX_STOMP_LOW
 ||

349 (!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
) &&

350 
	`ã°_bô
(
BT_OP_SCAN
, &
btc€x
->
›_Êags
)))

351 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
ATH_BTCOEX_STOMP_NONE
);

352 i‡(
btc€x
->
bt_°omp_ty≥
 =
ATH_BTCOEX_STOMP_ALL
)

353 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
ATH_BTCOEX_STOMP_LOW
);

355 
	`©h9k_hw_btc€x_íabÀ
(
ah
);

356 
	`•ö_u∆ock_bh
(&
btc€x
->
btc€x_lock
);

357 
	`©h9k_ps_ª°‹e
(
sc
);

358 
	}
}

360 
	$©h_öô_btc€x_timî
(
©h_so·c
 *
sc
)

362 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

364 
btc€x
->
btc€x_≥riod
 = 
ATH_BTCOEX_DEF_BT_PERIOD
;

365 
btc€x
->
btc€x_no_°omp
 = (100 - 
ATH_BTCOEX_DEF_DUTY_CYCLE
) *

366 
btc€x
->
btc€x_≥riod
 / 100;

367 
btc€x
->
btsˇn_no_°omp
 = (100 - 
ATH_BTCOEX_BTSCAN_DUTY_CYCLE
) *

368 
btc€x
->
btc€x_≥riod
 / 100;

369 
btc€x
->
bt_°omp_ty≥
 = 
ATH_BTCOEX_STOMP_LOW
;

371 
	`£tup_timî
(&
btc€x
->
≥riod_timî
, 
©h_btc€x_≥riod_timî
,

372 (Ë
sc
);

373 
	`£tup_timî
(&
btc€x
->
no_°omp_timî
, 
©h_btc€x_no_°omp_timî
,

374 (Ë
sc
);

376 
	`•ö_lock_öô
(&
btc€x
->
btc€x_lock
);

377 
	}
}

382 
	$©h9k_btc€x_timî_ªsume
(
©h_so·c
 *
sc
)

384 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

385 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

387 i‡(
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_3WIRE
 &&

388 
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_MCI
)

391 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
, "Starting btcoexÅimers\n");

394 
	`dñ_timî_sync
(&
btc€x
->
no_°omp_timî
);

396 
btc€x
->
bt_¥i‹ôy_˙t
 = 0;

397 
btc€x
->
bt_¥i‹ôy_time
 = 
jiffõs
;

398 
	`˛ór_bô
(
BT_OP_PRIORITY_DETECTED
, &
btc€x
->
›_Êags
);

399 
	`˛ór_bô
(
BT_OP_SCAN
, &
btc€x
->
›_Êags
);

401 
	`mod_timî
(&
btc€x
->
≥riod_timî
, 
jiffõs
);

402 
	}
}

407 
	$©h9k_btc€x_timî_∑u£
(
©h_so·c
 *
sc
)

409 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

410 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

412 i‡(
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_3WIRE
 &&

413 
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_MCI
)

416 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
, "Stopping btcoexÅimers\n");

418 
	`dñ_timî_sync
(&
btc€x
->
≥riod_timî
);

419 
	`dñ_timî_sync
(&
btc€x
->
no_°omp_timî
);

420 
	}
}

422 
	$©h9k_btc€x_°›_gí_timî
(
©h_so·c
 *
sc
)

424 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

426 
	`dñ_timî_sync
(&
btc€x
->
no_°omp_timî
);

427 
	}
}

429 
u16
 
	$©h9k_btc€x_aggr_limô
(
©h_so·c
 *
sc
, 
u32
 
max_4ms_‰amñí
)

431 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

432 
©h_mci_¥ofûe
 *
mci
 = &
sc
->
btc€x
.mci;

433 
u16
 
aggr_limô
 = 0;

435 i‡((
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
Ë&& 
mci
->
aggr_limô
)

436 
aggr_limô
 = (
max_4ms_‰amñí
 * 
mci
->aggr_limit) >> 4;

437 i‡(
	`ã°_bô
(
BT_OP_PRIORITY_DETECTED
, &
btc€x
->
›_Êags
))

438 
aggr_limô
 = 
	`mö
((
max_4ms_‰amñí
 * 3) / 8,

439 (
u32
)
ATH_AMPDU_LIMIT_MAX
);

441  
aggr_limô
;

442 
	}
}

444 
	$©h9k_btc€x_h™dÀ_öãºu±
(
©h_so·c
 *
sc
, 
u32
 
°©us
)

446 i‡(
°©us
 & 
ATH9K_INT_MCI
)

447 
	`©h_mci_öå
(
sc
);

448 
	}
}

450 
	$©h9k_°¨t_btc€x
(
©h_so·c
 *
sc
)

452 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

454 i‡(
ah
->
btc€x_hw
.
íabÀd
 ||

455 
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë=
ATH_BTCOEX_CFG_NONE
)

458 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
))

459 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 
AR_BT_COEX_WGHT
,

460 
AR_STOMP_LOW_WLAN_WGHT
, 0);

462 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 0, 0,

463 
ATH_BTCOEX_STOMP_NONE
);

464 
	`©h9k_hw_btc€x_íabÀ
(
ah
);

465 
	`©h9k_btc€x_timî_ªsume
(
sc
);

466 
	}
}

468 
	$©h9k_°›_btc€x
(
©h_so·c
 *
sc
)

470 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

472 i‡(!
ah
->
btc€x_hw
.
íabÀd
 ||

473 
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë=
ATH_BTCOEX_CFG_NONE
)

476 
	`©h9k_btc€x_timî_∑u£
(
sc
);

477 
	`©h9k_hw_btc€x_dißbÀ
(
ah
);

479 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
)

480 
	`©h_mci_Êush_¥ofûe
(&
sc
->
btc€x
.
mci
);

481 
	}
}

483 
	$©h9k_deöô_btc€x
(
©h_so·c
 *
sc
)

485 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

487 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

488 
	`©h_mci_˛ónup
(
sc
);

489 
	}
}

491 
	$©h9k_öô_btc€x
(
©h_so·c
 *
sc
)

493 
©h_txq
 *
txq
;

494 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

495 
r
;

497 
	`©h9k_hw_btc€x_öô_scheme
(
ah
);

499 
	`©h9k_hw_gë_btc€x_scheme
(
sc
->
sc_ah
)) {

500 
ATH_BTCOEX_CFG_NONE
:

502 
ATH_BTCOEX_CFG_2WIRE
:

503 
	`©h9k_hw_btc€x_öô_2wúe
(
sc
->
sc_ah
);

505 
ATH_BTCOEX_CFG_3WIRE
:

506 
	`©h9k_hw_btc€x_öô_3wúe
(
sc
->
sc_ah
);

507 
	`©h_öô_btc€x_timî
(
sc
);

508 
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_BE
];

509 
	`©h9k_hw_öô_btc€x_hw
(
sc
->
sc_ah
, 
txq
->
axq_qnum
);

511 
ATH_BTCOEX_CFG_MCI
:

512 
	`©h_öô_btc€x_timî
(
sc
);

514 
sc
->
btc€x
.
duty_cy˛e
 = 
ATH_BTCOEX_DEF_DUTY_CYCLE
;

515 
	`INIT_LIST_HEAD
(&
sc
->
btc€x
.
mci
.
öfo
);

516 
	`©h9k_hw_btc€x_öô_mci
(
ah
);

518 
r
 = 
	`©h_mci_£tup
(
sc
);

519 i‡(
r
)

520  
r
;

524 
	`WARN_ON
(1);

529 
	}
}

531 
	$©h9k_dump_mci_btc€x
(
©h_so·c
 *
sc
, 
u8
 *
buf
, 
u32
 
size
)

533 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

534 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

535 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

536 
©h_btc€x_hw
 *
btc€x_hw
 = &
ah
->btcoex_hw;

537 
u32
 
Àn
 = 0;

538 
i
;

540 
	`ATH_DUMP_BTCOEX
("TŸÆ BTÖrofûes", 
	`NUM_PROF
(
mci
));

541 
	`ATH_DUMP_BTCOEX
("MGMT", 
mci
->
num_mgmt
);

542 
	`ATH_DUMP_BTCOEX
("SCO", 
mci
->
num_sco
);

543 
	`ATH_DUMP_BTCOEX
("A2DP", 
mci
->
num_a2dp
);

544 
	`ATH_DUMP_BTCOEX
("HID", 
mci
->
num_hid
);

545 
	`ATH_DUMP_BTCOEX
("PAN", 
mci
->
num_∑n
);

546 
	`ATH_DUMP_BTCOEX
("ACL", 
mci
->
num_Ÿhî_a˛
);

547 
	`ATH_DUMP_BTCOEX
("BDR", 
mci
->
num_bdr
);

548 
	`ATH_DUMP_BTCOEX
("Aggr. Limô", 
mci
->
aggr_limô
);

549 
	`ATH_DUMP_BTCOEX
("Stom∞Ty≥", 
btc€x
->
bt_°omp_ty≥
);

550 
	`ATH_DUMP_BTCOEX
("BTC€x Pîiod (m£c)", 
btc€x
->
btc€x_≥riod
);

551 
	`ATH_DUMP_BTCOEX
("Duty Cy˛e", 
btc€x
->
duty_cy˛e
);

552 
	`ATH_DUMP_BTCOEX
("BT WaôÅime", 
btc€x
->
bt_waô_time
);

553 
	`ATH_DUMP_BTCOEX
("C⁄cuºíàTx", 
btc€x_hw
->
mci
.
c⁄cur_tx
);

554 
	`ATH_DUMP_BTCOEX
("C⁄cuºíàRSSI c¡", 
btc€x
->
rssi_cou¡
);

556 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "BT Weights: ");

557 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

558 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%08x ",

559 
btc€x_hw
->
bt_weight
[
i
]);

560 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "\n");

561 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "WLAN Weights: ");

562 
i
 = 0; i < 
AR9300_NUM_BT_WEIGHTS
; i++)

563 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%08x ",

564 
btc€x_hw
->
wœn_weight
[
i
]);

565 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "\n");

566 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "Tx Priorities: ");

567 
i
 = 0; i < 
ATH_BTCOEX_STOMP_MAX
; i++)

568 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%08x ",

569 
btc€x_hw
->
tx_¥io
[
i
]);

571 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "\n");

573  
Àn
;

574 
	}
}

576 
	$©h9k_dump_Àgacy_btc€x
(
©h_so·c
 *
sc
, 
u8
 *
buf
, 
u32
 
size
)

579 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

580 
u32
 
Àn
 = 0;

582 
	`ATH_DUMP_BTCOEX
("Stom∞Ty≥", 
btc€x
->
bt_°omp_ty≥
);

583 
	`ATH_DUMP_BTCOEX
("BTC€x Pîiod (m£c)", 
btc€x
->
btc€x_≥riod
);

584 
	`ATH_DUMP_BTCOEX
("Duty Cy˛e", 
btc€x
->
duty_cy˛e
);

585 
	`ATH_DUMP_BTCOEX
("BT WaôÅime", 
btc€x
->
bt_waô_time
);

587  
Àn
;

588 
	}
}

590 
	$©h9k_dump_btc€x
(
©h_so·c
 *
sc
, 
u8
 *
buf
, 
u32
 
size
)

592 i‡(
	`©h9k_hw_mci_is_íabÀd
(
sc
->
sc_ah
))

593  
	`©h9k_dump_mci_btc€x
(
sc
, 
buf
, 
size
);

595  
	`©h9k_dump_Àgacy_btc€x
(
sc
, 
buf
, 
size
);

596 
	}
}

	@hif_usb.c

17 
	~<asm/u«lig√d.h
>

18 
	~"htc.h
"

20 
MODULE_FIRMWARE
(
HTC_7010_MODULE_FW
);

21 
MODULE_FIRMWARE
(
HTC_9271_MODULE_FW
);

23 
usb_devi˚_id
 
	g©h9k_hif_usb_ids
[] = {

24 { 
USB_DEVICE
(0x0cf3, 0x9271) },

25 { 
USB_DEVICE
(0x0cf3, 0x1006) },

26 { 
USB_DEVICE
(0x0846, 0x9030) },

27 { 
USB_DEVICE
(0x07D1, 0x3A10) },

28 { 
USB_DEVICE
(0x13D3, 0x3327) },

29 { 
USB_DEVICE
(0x13D3, 0x3328) },

30 { 
USB_DEVICE
(0x13D3, 0x3346) },

31 { 
USB_DEVICE
(0x13D3, 0x3348) },

32 { 
USB_DEVICE
(0x13D3, 0x3349) },

33 { 
USB_DEVICE
(0x13D3, 0x3350) },

34 { 
USB_DEVICE
(0x04CA, 0x4605) },

35 { 
USB_DEVICE
(0x040D, 0x3801) },

36 { 
USB_DEVICE
(0x0cf3, 0xb003) },

37 { 
USB_DEVICE
(0x0cf3, 0xb002) },

38 { 
USB_DEVICE
(0x057c, 0x8403) },

39 { 
USB_DEVICE
(0x0471, 0x209e) },

41 { 
USB_DEVICE
(0x0cf3, 0x7015),

42 .
drivî_öfo
 = 
AR9287_USB
 },

43 { 
USB_DEVICE
(0x1668, 0x1200),

44 .
	gdrivî_öfo
 = 
AR9287_USB
 },

46 { 
USB_DEVICE
(0x0cf3, 0x7010),

47 .
	gdrivî_öfo
 = 
AR9280_USB
 },

48 { 
USB_DEVICE
(0x0846, 0x9018),

49 .
	gdrivî_öfo
 = 
AR9280_USB
 },

50 { 
USB_DEVICE
(0x083A, 0xA704),

51 .
	gdrivî_öfo
 = 
AR9280_USB
 },

52 { 
USB_DEVICE
(0x0411, 0x017f),

53 .
	gdrivî_öfo
 = 
AR9280_USB
 },

54 { 
USB_DEVICE
(0x0411, 0x0197),

55 .
	gdrivî_öfo
 = 
AR9280_USB
 },

56 { 
USB_DEVICE
(0x04da, 0x3904),

57 .
	gdrivî_öfo
 = 
AR9280_USB
 },

59 { 
USB_DEVICE
(0x0cf3, 0x20ff),

60 .
	gdrivî_öfo
 = 
STORAGE_DEVICE
 },

65 
MODULE_DEVICE_TABLE
(
usb
, 
©h9k_hif_usb_ids
);

67 
__hif_usb_tx
(
hif_devi˚_usb
 *
hif_dev
);

69 
	$hif_usb_ªgout_cb
(
urb
 *urb)

71 
cmd_buf
 *
cmd
 = (cmd_bu‡*)
urb
->
c⁄ãxt
;

73 
urb
->
°©us
) {

76 -
ENOENT
:

77 -
ECONNRESET
:

78 -
ENODEV
:

79 -
ESHUTDOWN
:

80 
‰ì
;

85 i‡(
cmd
) {

86 
	`©h9k_htc_txcom∂ëi⁄_cb
(
cmd
->
hif_dev
->
htc_h™dÀ
,

87 
cmd
->
skb
, 
åue
);

88 
	`k‰ì
(
cmd
);

92 
‰ì
:

93 
	`k‰ì_skb
(
cmd
->
skb
);

94 
	`k‰ì
(
cmd
);

95 
	}
}

97 
	$hif_usb_£nd_ªgout
(
hif_devi˚_usb
 *
hif_dev
,

98 
sk_buff
 *
skb
)

100 
urb
 *urb;

101 
cmd_buf
 *
cmd
;

102 
ªt
 = 0;

104 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_KERNEL
);

105 i‡(
urb
 =
NULL
)

106  -
ENOMEM
;

108 
cmd
 = 
	`kzÆloc
((*cmd), 
GFP_KERNEL
);

109 i‡(
cmd
 =
NULL
) {

110 
	`usb_‰ì_urb
(
urb
);

111  -
ENOMEM
;

114 
cmd
->
skb
 = skb;

115 
cmd
->
hif_dev
 = hif_dev;

117 
	`usb_fûl_öt_urb
(
urb
, 
hif_dev
->
udev
,

118 
	`usb_¢döçùe
(
hif_dev
->
udev
, 
USB_REG_OUT_PIPE
),

119 
skb
->
d©a
, skb->
Àn
,

120 
hif_usb_ªgout_cb
, 
cmd
, 1);

122 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
ªgout_submôãd
);

123 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_KERNEL
);

124 i‡(
ªt
) {

125 
	`usb_u«nch‹_urb
(
urb
);

126 
	`k‰ì
(
cmd
);

128 
	`usb_‰ì_urb
(
urb
);

130  
ªt
;

131 
	}
}

133 
	$hif_usb_mgmt_cb
(
urb
 *urb)

135 
cmd_buf
 *
cmd
 = (cmd_bu‡*)
urb
->
c⁄ãxt
;

136 
hif_devi˚_usb
 *
hif_dev
;

137 
boﬁ
 
txok
 = 
åue
;

139 i‡(!
cmd
 || !cmd->
skb
 || !cmd->
hif_dev
)

142 
hif_dev
 = 
cmd
->hif_dev;

144 
urb
->
°©us
) {

147 -
ENOENT
:

148 -
ECONNRESET
:

149 -
ENODEV
:

150 -
ESHUTDOWN
:

151 
txok
 = 
Ál£
;

157 
	`•ö_lock
(&
hif_dev
->
tx
.
tx_lock
);

158 i‡(
hif_dev
->
tx
.
Êags
 & 
HIF_USB_TX_FLUSH
) {

159 
	`•ö_u∆ock
(&
hif_dev
->
tx
.
tx_lock
);

160 
	`dev_k‰ì_skb_™y
(
cmd
->
skb
);

161 
	`k‰ì
(
cmd
);

164 
	`•ö_u∆ock
(&
hif_dev
->
tx
.
tx_lock
);

168 
txok
 = 
Ál£
;

172 
	`skb_puŒ
(
cmd
->
skb
, 4);

173 
	`©h9k_htc_txcom∂ëi⁄_cb
(
cmd
->
hif_dev
->
htc_h™dÀ
,

174 
cmd
->
skb
, 
txok
);

175 
	`k‰ì
(
cmd
);

176 
	}
}

178 
	$hif_usb_£nd_mgmt
(
hif_devi˚_usb
 *
hif_dev
,

179 
sk_buff
 *
skb
)

181 
urb
 *urb;

182 
cmd_buf
 *
cmd
;

183 
ªt
 = 0;

184 
__À16
 *
hdr
;

186 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

187 i‡(
urb
 =
NULL
)

188  -
ENOMEM
;

190 
cmd
 = 
	`kzÆloc
((*cmd), 
GFP_ATOMIC
);

191 i‡(
cmd
 =
NULL
) {

192 
	`usb_‰ì_urb
(
urb
);

193  -
ENOMEM
;

196 
cmd
->
skb
 = skb;

197 
cmd
->
hif_dev
 = hif_dev;

199 
hdr
 = (
__À16
 *Ë
	`skb_push
(
skb
, 4);

200 *
hdr
++ = 
	`˝u_to_À16
(
skb
->
Àn
 - 4);

201 *
hdr
++ = 
	`˝u_to_À16
(
ATH_USB_TX_STREAM_MODE_TAG
);

203 
	`usb_fûl_bulk_urb
(
urb
, 
hif_dev
->
udev
,

204 
	`usb_¢dbulkpùe
(
hif_dev
->
udev
, 
USB_WLAN_TX_PIPE
),

205 
skb
->
d©a
, skb->
Àn
,

206 
hif_usb_mgmt_cb
, 
cmd
);

208 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
mgmt_submôãd
);

209 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

210 i‡(
ªt
) {

211 
	`usb_u«nch‹_urb
(
urb
);

212 
	`k‰ì
(
cmd
);

214 
	`usb_‰ì_urb
(
urb
);

216  
ªt
;

217 
	}
}

219 
ölöe
 
	$©h9k_skb_queue_purge
(
hif_devi˚_usb
 *
hif_dev
,

220 
sk_buff_hód
 *
li°
)

222 
sk_buff
 *
skb
;

224 (
skb
 = 
	`__skb_dequeue
(
li°
)Ë!
NULL
) {

225 
	`dev_k‰ì_skb_™y
(
skb
);

227 
	}
}

229 
ölöe
 
	$©h9k_skb_queue_com∂ëe
(
hif_devi˚_usb
 *
hif_dev
,

230 
sk_buff_hód
 *
queue
,

231 
boﬁ
 
txok
)

233 
sk_buff
 *
skb
;

235 (
skb
 = 
	`__skb_dequeue
(
queue
)Ë!
NULL
) {

236 #ifde‡
CPTCFG_ATH9K_HTC_DEBUGFS


237 
 
 = 
skb
->
Àn
;

239 
	`©h9k_htc_txcom∂ëi⁄_cb
(
hif_dev
->
htc_h™dÀ
,

240 
skb
, 
txok
);

241 i‡(
txok
) {

242 
	`TX_STAT_INC
(
skb_suc˚ss
);

243 
	`TX_STAT_ADD
(
skb_suc˚ss_byãs
, 
 
);

246 
	`TX_STAT_INC
(
skb_Áûed
);

248 
	}
}

250 
	$hif_usb_tx_cb
(
urb
 *urb)

252 
tx_buf
 *tx_bu‡(tx_bu‡*Ë
urb
->
c⁄ãxt
;

253 
hif_devi˚_usb
 *
hif_dev
;

254 
boﬁ
 
txok
 = 
åue
;

256 i‡(!
tx_buf
 || !tx_buf->
hif_dev
)

259 
hif_dev
 = 
tx_buf
->hif_dev;

261 
urb
->
°©us
) {

264 -
ENOENT
:

265 -
ECONNRESET
:

266 -
ENODEV
:

267 -
ESHUTDOWN
:

268 
txok
 = 
Ál£
;

274 
	`•ö_lock
(&
hif_dev
->
tx
.
tx_lock
);

275 i‡(
hif_dev
->
tx
.
Êags
 & 
HIF_USB_TX_FLUSH
) {

276 
	`•ö_u∆ock
(&
hif_dev
->
tx
.
tx_lock
);

277 
	`©h9k_skb_queue_purge
(
hif_dev
, &
tx_buf
->
skb_queue
);

280 
	`•ö_u∆ock
(&
hif_dev
->
tx
.
tx_lock
);

284 
txok
 = 
Ál£
;

288 
	`©h9k_skb_queue_com∂ëe
(
hif_dev
, &
tx_buf
->
skb_queue
, 
txok
);

291 
tx_buf
->
Àn
 =Åx_buf->
off£t
 = 0;

292 
	`__skb_queue_hód_öô
(&
tx_buf
->
skb_queue
);

295 
	`•ö_lock
(&
hif_dev
->
tx
.
tx_lock
);

296 
	`li°_move_èû
(&
tx_buf
->
li°
, &
hif_dev
->
tx
.tx_buf);

297 
hif_dev
->
tx
.
tx_buf_˙t
++;

298 i‡(!(
hif_dev
->
tx
.
Êags
 & 
HIF_USB_TX_STOP
))

299 
	`__hif_usb_tx
(
hif_dev
);

300 
	`TX_STAT_INC
(
buf_com∂ëed
);

301 
	`•ö_u∆ock
(&
hif_dev
->
tx
.
tx_lock
);

302 
	}
}

305 
	$__hif_usb_tx
(
hif_devi˚_usb
 *
hif_dev
)

307 
tx_buf
 *tx_bu‡
NULL
;

308 
sk_buff
 *
nskb
 = 
NULL
;

309 
ªt
 = 0, 
i
;

310 
u16
 
tx_skb_˙t
 = 0;

311 
u8
 *
buf
;

312 
__À16
 *
hdr
;

314 i‡(
hif_dev
->
tx
.
tx_skb_˙t
 == 0)

318 i‡(
	`li°_em±y
(&
hif_dev
->
tx
.
tx_buf
))

321 
tx_buf
 = 
	`li°_fú°_íåy
(&
hif_dev
->
tx
.tx_buf, tx_buf, 
li°
);

322 
	`li°_move_èû
(&
tx_buf
->
li°
, &
hif_dev
->
tx
.
tx_≥ndög
);

323 
hif_dev
->
tx
.
tx_buf_˙t
--;

325 
tx_skb_˙t
 = 
	`mö_t
(
u16
, 
hif_dev
->
tx
.tx_skb_˙t, 
MAX_TX_AGGR_NUM
);

327 
i
 = 0; i < 
tx_skb_˙t
; i++) {

328 
nskb
 = 
	`__skb_dequeue
(&
hif_dev
->
tx
.
tx_skb_queue
);

331 
	`BUG_ON
(!
nskb
);

333 
hif_dev
->
tx
.
tx_skb_˙t
--;

335 
buf
 = 
tx_buf
->buf;

336 
buf
 +
tx_buf
->
off£t
;

337 
hdr
 = (
__À16
 *)
buf
;

338 *
hdr
++ = 
	`˝u_to_À16
(
nskb
->
Àn
);

339 *
hdr
++ = 
	`˝u_to_À16
(
ATH_USB_TX_STREAM_MODE_TAG
);

340 
buf
 += 4;

341 
	`mem˝y
(
buf
, 
nskb
->
d©a
,Çskb->
Àn
);

342 
tx_buf
->
Àn
 = 
nskb
->len + 4;

344 i‡(
i
 < (
tx_skb_˙t
 - 1))

345 
tx_buf
->
off£t
 +((—x_buf->
Àn
 - 1) / 4) + 1) * 4;

347 i‡(
i
 =(
tx_skb_˙t
 - 1))

348 
tx_buf
->
Àn
 +tx_buf->
off£t
;

350 
	`__skb_queue_èû
(&
tx_buf
->
skb_queue
, 
nskb
);

351 
	`TX_STAT_INC
(
skb_queued
);

354 
	`usb_fûl_bulk_urb
(
tx_buf
->
urb
, 
hif_dev
->
udev
,

355 
	`usb_¢dbulkpùe
(
hif_dev
->
udev
, 
USB_WLAN_TX_PIPE
),

356 
tx_buf
->
buf
,Åx_buf->
Àn
,

357 
hif_usb_tx_cb
, 
tx_buf
);

359 
ªt
 = 
	`usb_submô_urb
(
tx_buf
->
urb
, 
GFP_ATOMIC
);

360 i‡(
ªt
) {

361 
tx_buf
->
Àn
 =Åx_buf->
off£t
 = 0;

362 
	`©h9k_skb_queue_com∂ëe
(
hif_dev
, &
tx_buf
->
skb_queue
, 
Ál£
);

363 
	`__skb_queue_hód_öô
(&
tx_buf
->
skb_queue
);

364 
	`li°_move_èû
(&
tx_buf
->
li°
, &
hif_dev
->
tx
.tx_buf);

365 
hif_dev
->
tx
.
tx_buf_˙t
++;

368 i‡(!
ªt
)

369 
	`TX_STAT_INC
(
buf_queued
);

371  
ªt
;

372 
	}
}

374 
	$hif_usb_£nd_tx
(
hif_devi˚_usb
 *
hif_dev
, 
sk_buff
 *
skb
)

376 
©h9k_htc_tx_˘l
 *
tx_˘l
;

377 
Êags
;

378 
ªt
 = 0;

380 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

382 i‡(
hif_dev
->
tx
.
Êags
 & 
HIF_USB_TX_STOP
) {

383 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

384  -
ENODEV
;

388 i‡(
hif_dev
->
tx
.
tx_skb_˙t
 > 
MAX_TX_BUF_NUM
) {

389 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

390  -
ENOMEM
;

393 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

395 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

398 i‡((
tx_˘l
->
ty≥
 =
ATH9K_HTC_MGMT
) ||

399 (
tx_˘l
->
ty≥
 =
ATH9K_HTC_BEACON
)) {

400 
ªt
 = 
	`hif_usb_£nd_mgmt
(
hif_dev
, 
skb
);

403 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

405 i‡((
tx_˘l
->
ty≥
 =
ATH9K_HTC_NORMAL
) ||

406 (
tx_˘l
->
ty≥
 =
ATH9K_HTC_AMPDU
)) {

407 
	`__skb_queue_èû
(&
hif_dev
->
tx
.
tx_skb_queue
, 
skb
);

408 
hif_dev
->
tx
.
tx_skb_˙t
++;

412 i‡((
hif_dev
->
tx
.
tx_buf_˙t
 =
MAX_TX_URB_NUM
) &&

413 (
hif_dev
->
tx
.
tx_skb_˙t
 < 2)) {

414 
	`__hif_usb_tx
(
hif_dev
);

417 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

419  
ªt
;

420 
	}
}

422 
	$hif_usb_°¨t
(*
hif_h™dÀ
)

424 
hif_devi˚_usb
 *
hif_dev
 = (hif_devi˚_usb *)
hif_h™dÀ
;

425 
Êags
;

427 
hif_dev
->
Êags
 |
HIF_USB_START
;

429 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

430 
hif_dev
->
tx
.
Êags
 &~
HIF_USB_TX_STOP
;

431 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

432 
	}
}

434 
	$hif_usb_°›
(*
hif_h™dÀ
)

436 
hif_devi˚_usb
 *
hif_dev
 = (hif_devi˚_usb *)
hif_h™dÀ
;

437 
tx_buf
 *tx_bu‡
NULL
, *
tx_buf_tmp
 = NULL;

438 
Êags
;

440 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

441 
	`©h9k_skb_queue_com∂ëe
(
hif_dev
, &hif_dev->
tx
.
tx_skb_queue
, 
Ál£
);

442 
hif_dev
->
tx
.
tx_skb_˙t
 = 0;

443 
hif_dev
->
tx
.
Êags
 |
HIF_USB_TX_STOP
;

444 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

447 
	`li°_f‹_óch_íåy_ß„
(
tx_buf
, 
tx_buf_tmp
,

448 &
hif_dev
->
tx
.
tx_≥ndög
, 
li°
) {

449 
	`usb_kûl_urb
(
tx_buf
->
urb
);

452 
	`usb_kûl_™ch‹ed_urbs
(&
hif_dev
->
mgmt_submôãd
);

453 
	}
}

455 
	$hif_usb_£nd
(*
hif_h™dÀ
, 
u8
 
pùe_id
, 
sk_buff
 *
skb
)

457 
hif_devi˚_usb
 *
hif_dev
 = (hif_devi˚_usb *)
hif_h™dÀ
;

458 
ªt
 = 0;

460 
pùe_id
) {

461 
USB_WLAN_TX_PIPE
:

462 
ªt
 = 
	`hif_usb_£nd_tx
(
hif_dev
, 
skb
);

464 
USB_REG_OUT_PIPE
:

465 
ªt
 = 
	`hif_usb_£nd_ªgout
(
hif_dev
, 
skb
);

468 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

469 "©h9k_htc: InvÆid TXÖùe: %d\n", 
pùe_id
);

470 
ªt
 = -
EINVAL
;

474  
ªt
;

475 
	}
}

477 
ölöe
 
boﬁ
 
	$check_ödex
(
sk_buff
 *
skb
, 
u8
 
idx
)

479 
©h9k_htc_tx_˘l
 *
tx_˘l
;

481 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

483 i‡((
tx_˘l
->
ty≥
 =
ATH9K_HTC_AMPDU
) &&

484 (
tx_˘l
->
°a_idx
 =
idx
))

485  
åue
;

487  
Ál£
;

488 
	}
}

490 
	$hif_usb_°a_døö
(*
hif_h™dÀ
, 
u8
 
idx
)

492 
hif_devi˚_usb
 *
hif_dev
 = (hif_devi˚_usb *)
hif_h™dÀ
;

493 
sk_buff
 *
skb
, *
tmp
;

494 
Êags
;

496 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

498 
	`skb_queue_wÆk_ß„
(&
hif_dev
->
tx
.
tx_skb_queue
, 
skb
, 
tmp
) {

499 i‡(
	`check_ödex
(
skb
, 
idx
)) {

500 
	`__skb_u∆ök
(
skb
, &
hif_dev
->
tx
.
tx_skb_queue
);

501 
	`©h9k_htc_txcom∂ëi⁄_cb
(
hif_dev
->
htc_h™dÀ
,

502 
skb
, 
Ál£
);

503 
hif_dev
->
tx
.
tx_skb_˙t
--;

504 
	`TX_STAT_INC
(
skb_Áûed
);

508 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

509 
	}
}

511 
©h9k_htc_hif
 
	ghif_usb
 = {

512 .
å™•‹t
 = 
ATH9K_HIF_USB
,

513 .
	g«me
 = "ath9k_hif_usb",

515 .
	gc⁄åﬁ_ul_pùe
 = 
USB_REG_OUT_PIPE
,

516 .
	gc⁄åﬁ_dl_pùe
 = 
USB_REG_IN_PIPE
,

518 .
	g°¨t
 = 
hif_usb_°¨t
,

519 .
	g°›
 = 
hif_usb_°›
,

520 .
	g°a_døö
 = 
hif_usb_°a_døö
,

521 .
	g£nd
 = 
hif_usb_£nd
,

524 
	$©h9k_hif_usb_rx_°ªam
(
hif_devi˚_usb
 *
hif_dev
,

525 
sk_buff
 *
skb
)

527 
sk_buff
 *
nskb
, *
skb_poﬁ
[
MAX_PKT_NUM_IN_TRANSFER
];

528 
ödex
 = 0, 
i
 = 0, 
Àn
 = 
skb
->len;

529 
rx_ªmaö_Àn
, 
rx_pkt_Àn
;

530 
u16
 
poﬁ_ödex
 = 0;

531 
u8
 *
±r
;

533 
	`•ö_lock
(&
hif_dev
->
rx_lock
);

535 
rx_ªmaö_Àn
 = 
hif_dev
->rx_remain_len;

536 
rx_pkt_Àn
 = 
hif_dev
->
rx_å™s„r_Àn
;

538 i‡(
rx_ªmaö_Àn
 != 0) {

539 
sk_buff
 *
ªmaö_skb
 = 
hif_dev
->remain_skb;

541 i‡(
ªmaö_skb
) {

542 
±r
 = (
u8
 *Ë
ªmaö_skb
->
d©a
;

544 
ödex
 = 
rx_ªmaö_Àn
;

545 
rx_ªmaö_Àn
 -
hif_dev
->
rx_∑d_Àn
;

546 
±r
 +
rx_pkt_Àn
;

548 
	`mem˝y
(
±r
, 
skb
->
d©a
, 
rx_ªmaö_Àn
);

550 
rx_pkt_Àn
 +
rx_ªmaö_Àn
;

551 
hif_dev
->
rx_ªmaö_Àn
 = 0;

552 
	`skb_put
(
ªmaö_skb
, 
rx_pkt_Àn
);

554 
skb_poﬁ
[
poﬁ_ödex
++] = 
ªmaö_skb
;

557 
ödex
 = 
rx_ªmaö_Àn
;

561 
	`•ö_u∆ock
(&
hif_dev
->
rx_lock
);

563 
ödex
 < 
Àn
) {

564 
u16
 
pkt_Àn
;

565 
u16
 
pkt_èg
;

566 
u16
 
∑d_Àn
;

567 
chk_idx
;

569 
±r
 = (
u8
 *Ë
skb
->
d©a
;

571 
pkt_Àn
 = 
	`gë_u«lig√d_À16
(
±r
 + 
ödex
);

572 
pkt_èg
 = 
	`gë_u«lig√d_À16
(
±r
 + 
ödex
 + 2);

574 i‡(
pkt_èg
 !
ATH_USB_RX_STREAM_MODE_TAG
) {

575 
	`RX_STAT_INC
(
skb_dr›≥d
);

579 
∑d_Àn
 = 4 - (
pkt_Àn
 & 0x3);

580 i‡(
∑d_Àn
 == 4)

581 
∑d_Àn
 = 0;

583 
chk_idx
 = 
ödex
;

584 
ödex
 = index + 4 + 
pkt_Àn
 + 
∑d_Àn
;

586 i‡(
ödex
 > 
MAX_RX_BUF_SIZE
) {

587 
	`•ö_lock
(&
hif_dev
->
rx_lock
);

588 
hif_dev
->
rx_ªmaö_Àn
 = 
ödex
 - 
MAX_RX_BUF_SIZE
;

589 
hif_dev
->
rx_å™s„r_Àn
 =

590 
MAX_RX_BUF_SIZE
 - 
chk_idx
 - 4;

591 
hif_dev
->
rx_∑d_Àn
 = 
∑d_Àn
;

593 
nskb
 = 
	`__dev_Æloc_skb
(
pkt_Àn
 + 32, 
GFP_ATOMIC
);

594 i‡(!
nskb
) {

595 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

597 
	`•ö_u∆ock
(&
hif_dev
->
rx_lock
);

598 
îr
;

600 
	`skb_ª£rve
(
nskb
, 32);

601 
	`RX_STAT_INC
(
skb_Æloˇãd
);

603 
	`mem˝y
(
nskb
->
d©a
, &(
skb
->d©a[
chk_idx
+4]),

604 
hif_dev
->
rx_å™s„r_Àn
);

607 
hif_dev
->
ªmaö_skb
 = 
nskb
;

608 
	`•ö_u∆ock
(&
hif_dev
->
rx_lock
);

610 
nskb
 = 
	`__dev_Æloc_skb
(
pkt_Àn
 + 32, 
GFP_ATOMIC
);

611 i‡(!
nskb
) {

612 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

614 
îr
;

616 
	`skb_ª£rve
(
nskb
, 32);

617 
	`RX_STAT_INC
(
skb_Æloˇãd
);

619 
	`mem˝y
(
nskb
->
d©a
, &(
skb
->d©a[
chk_idx
+4]), 
pkt_Àn
);

620 
	`skb_put
(
nskb
, 
pkt_Àn
);

621 
skb_poﬁ
[
poﬁ_ödex
++] = 
nskb
;

625 
îr
:

626 
i
 = 0; i < 
poﬁ_ödex
; i++) {

627 
	`RX_STAT_ADD
(
skb_com∂ëed_byãs
, 
skb_poﬁ
[
i
]->
Àn
);

628 
	`©h9k_htc_rx_msg
(
hif_dev
->
htc_h™dÀ
, 
skb_poﬁ
[
i
],

629 
skb_poﬁ
[
i
]->
Àn
, 
USB_WLAN_RX_PIPE
);

630 
	`RX_STAT_INC
(
skb_com∂ëed
);

632 
	}
}

634 
	$©h9k_hif_usb_rx_cb
(
urb
 *urb)

636 
sk_buff
 *
skb
 = (sk_buf‡*Ë
urb
->
c⁄ãxt
;

637 
hif_devi˚_usb
 *
hif_dev
 =

638 
	`usb_gë_ötfd©a
(
	`usb_i‚um_to_if
(
urb
->
dev
, 0));

639 
ªt
;

641 i‡(!
skb
)

644 i‡(!
hif_dev
)

645 
‰ì
;

647 
urb
->
°©us
) {

650 -
ENOENT
:

651 -
ECONNRESET
:

652 -
ENODEV
:

653 -
ESHUTDOWN
:

654 
‰ì
;

656 
ªsubmô
;

659 i‡(
	`likñy
(
urb
->
a˘uÆ_Àngth
 != 0)) {

660 
	`skb_put
(
skb
, 
urb
->
a˘uÆ_Àngth
);

661 
	`©h9k_hif_usb_rx_°ªam
(
hif_dev
, 
skb
);

664 
ªsubmô
:

665 
	`skb_ª£t_èû_poöãr
(
skb
);

666 
	`skb_åim
(
skb
, 0);

668 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
rx_submôãd
);

669 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

670 i‡(
ªt
) {

671 
	`usb_u«nch‹_urb
(
urb
);

672 
‰ì
;

676 
‰ì
:

677 
	`k‰ì_skb
(
skb
);

678 
	}
}

680 
	$©h9k_hif_usb_ªg_ö_cb
(
urb
 *urb)

682 
sk_buff
 *
skb
 = (sk_buf‡*Ë
urb
->
c⁄ãxt
;

683 
sk_buff
 *
nskb
;

684 
hif_devi˚_usb
 *
hif_dev
 =

685 
	`usb_gë_ötfd©a
(
	`usb_i‚um_to_if
(
urb
->
dev
, 0));

686 
ªt
;

688 i‡(!
skb
)

691 i‡(!
hif_dev
)

692 
‰ì
;

694 
urb
->
°©us
) {

697 -
ENOENT
:

698 -
ECONNRESET
:

699 -
ENODEV
:

700 -
ESHUTDOWN
:

701 
‰ì
;

703 
	`skb_ª£t_èû_poöãr
(
skb
);

704 
	`skb_åim
(
skb
, 0);

706 
ªsubmô
;

709 i‡(
	`likñy
(
urb
->
a˘uÆ_Àngth
 != 0)) {

710 
	`skb_put
(
skb
, 
urb
->
a˘uÆ_Àngth
);

713 
	`©h9k_htc_rx_msg
(
hif_dev
->
htc_h™dÀ
, 
skb
,

714 
skb
->
Àn
, 
USB_REG_IN_PIPE
);

717 
nskb
 = 
	`Æloc_skb
(
MAX_REG_IN_BUF_SIZE
, 
GFP_ATOMIC
);

718 i‡(!
nskb
) {

719 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

721 
urb
->
c⁄ãxt
 = 
NULL
;

725 
	`usb_fûl_öt_urb
(
urb
, 
hif_dev
->
udev
,

726 
	`usb_rcvöçùe
(
hif_dev
->
udev
,

727 
USB_REG_IN_PIPE
),

728 
nskb
->
d©a
, 
MAX_REG_IN_BUF_SIZE
,

729 
©h9k_hif_usb_ªg_ö_cb
, 
nskb
, 1);

732 
ªsubmô
:

733 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
ªg_ö_submôãd
);

734 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

735 i‡(
ªt
) {

736 
	`usb_u«nch‹_urb
(
urb
);

737 
‰ì
;

741 
‰ì
:

742 
	`k‰ì_skb
(
skb
);

743 
urb
->
c⁄ãxt
 = 
NULL
;

744 
	}
}

746 
	$©h9k_hif_usb_dóŒoc_tx_urbs
(
hif_devi˚_usb
 *
hif_dev
)

748 
tx_buf
 *tx_bu‡
NULL
, *
tx_buf_tmp
 = NULL;

749 
Êags
;

751 
	`li°_f‹_óch_íåy_ß„
(
tx_buf
, 
tx_buf_tmp
,

752 &
hif_dev
->
tx
.
tx_buf
, 
li°
) {

753 
	`usb_kûl_urb
(
tx_buf
->
urb
);

754 
	`li°_dñ
(&
tx_buf
->
li°
);

755 
	`usb_‰ì_urb
(
tx_buf
->
urb
);

756 
	`k‰ì
(
tx_buf
->
buf
);

757 
	`k‰ì
(
tx_buf
);

760 
	`•ö_lock_úqßve
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

761 
hif_dev
->
tx
.
Êags
 |
HIF_USB_TX_FLUSH
;

762 
	`•ö_u∆ock_úqª°‹e
(&
hif_dev
->
tx
.
tx_lock
, 
Êags
);

764 
	`li°_f‹_óch_íåy_ß„
(
tx_buf
, 
tx_buf_tmp
,

765 &
hif_dev
->
tx
.
tx_≥ndög
, 
li°
) {

766 
	`usb_kûl_urb
(
tx_buf
->
urb
);

767 
	`li°_dñ
(&
tx_buf
->
li°
);

768 
	`usb_‰ì_urb
(
tx_buf
->
urb
);

769 
	`k‰ì
(
tx_buf
->
buf
);

770 
	`k‰ì
(
tx_buf
);

773 
	`usb_kûl_™ch‹ed_urbs
(&
hif_dev
->
mgmt_submôãd
);

774 
	}
}

776 
	$©h9k_hif_usb_Æloc_tx_urbs
(
hif_devi˚_usb
 *
hif_dev
)

778 
tx_buf
 *tx_buf;

779 
i
;

781 
	`INIT_LIST_HEAD
(&
hif_dev
->
tx
.
tx_buf
);

782 
	`INIT_LIST_HEAD
(&
hif_dev
->
tx
.
tx_≥ndög
);

783 
	`•ö_lock_öô
(&
hif_dev
->
tx
.
tx_lock
);

784 
	`__skb_queue_hód_öô
(&
hif_dev
->
tx
.
tx_skb_queue
);

785 
	`öô_usb_™ch‹
(&
hif_dev
->
mgmt_submôãd
);

787 
i
 = 0; i < 
MAX_TX_URB_NUM
; i++) {

788 
tx_buf
 = 
	`kzÆloc
((tx_buf), 
GFP_KERNEL
);

789 i‡(!
tx_buf
)

790 
îr
;

792 
tx_buf
->
buf
 = 
	`kzÆloc
(
MAX_TX_BUF_SIZE
, 
GFP_KERNEL
);

793 i‡(!
tx_buf
->
buf
)

794 
îr
;

796 
tx_buf
->
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_KERNEL
);

797 i‡(!
tx_buf
->
urb
)

798 
îr
;

800 
tx_buf
->
hif_dev
 = hif_dev;

801 
	`__skb_queue_hód_öô
(&
tx_buf
->
skb_queue
);

803 
	`li°_add_èû
(&
tx_buf
->
li°
, &
hif_dev
->
tx
.tx_buf);

806 
hif_dev
->
tx
.
tx_buf_˙t
 = 
MAX_TX_URB_NUM
;

809 
îr
:

810 i‡(
tx_buf
) {

811 
	`k‰ì
(
tx_buf
->
buf
);

812 
	`k‰ì
(
tx_buf
);

814 
	`©h9k_hif_usb_dóŒoc_tx_urbs
(
hif_dev
);

815  -
ENOMEM
;

816 
	}
}

818 
	$©h9k_hif_usb_dóŒoc_rx_urbs
(
hif_devi˚_usb
 *
hif_dev
)

820 
	`usb_kûl_™ch‹ed_urbs
(&
hif_dev
->
rx_submôãd
);

821 
	}
}

823 
	$©h9k_hif_usb_Æloc_rx_urbs
(
hif_devi˚_usb
 *
hif_dev
)

825 
urb
 *urb = 
NULL
;

826 
sk_buff
 *
skb
 = 
NULL
;

827 
i
, 
ªt
;

829 
	`öô_usb_™ch‹
(&
hif_dev
->
rx_submôãd
);

830 
	`•ö_lock_öô
(&
hif_dev
->
rx_lock
);

832 
i
 = 0; i < 
MAX_RX_URB_NUM
; i++) {

835 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_KERNEL
);

836 i‡(
urb
 =
NULL
) {

837 
ªt
 = -
ENOMEM
;

838 
îr_urb
;

842 
skb
 = 
	`Æloc_skb
(
MAX_RX_BUF_SIZE
, 
GFP_KERNEL
);

843 i‡(!
skb
) {

844 
ªt
 = -
ENOMEM
;

845 
îr_skb
;

848 
	`usb_fûl_bulk_urb
(
urb
, 
hif_dev
->
udev
,

849 
	`usb_rcvbulkpùe
(
hif_dev
->
udev
,

850 
USB_WLAN_RX_PIPE
),

851 
skb
->
d©a
, 
MAX_RX_BUF_SIZE
,

852 
©h9k_hif_usb_rx_cb
, 
skb
);

855 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
rx_submôãd
);

858 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_KERNEL
);

859 i‡(
ªt
) {

860 
	`usb_u«nch‹_urb
(
urb
);

861 
îr_submô
;

868 
	`usb_‰ì_urb
(
urb
);

873 
îr_submô
:

874 
	`k‰ì_skb
(
skb
);

875 
îr_skb
:

876 
	`usb_‰ì_urb
(
urb
);

877 
îr_urb
:

878 
	`©h9k_hif_usb_dóŒoc_rx_urbs
(
hif_dev
);

879  
ªt
;

880 
	}
}

882 
	$©h9k_hif_usb_dóŒoc_ªg_ö_urbs
(
hif_devi˚_usb
 *
hif_dev
)

884 
	`usb_kûl_™ch‹ed_urbs
(&
hif_dev
->
ªg_ö_submôãd
);

885 
	}
}

887 
	$©h9k_hif_usb_Æloc_ªg_ö_urbs
(
hif_devi˚_usb
 *
hif_dev
)

889 
urb
 *urb = 
NULL
;

890 
sk_buff
 *
skb
 = 
NULL
;

891 
i
, 
ªt
;

893 
	`öô_usb_™ch‹
(&
hif_dev
->
ªg_ö_submôãd
);

895 
i
 = 0; i < 
MAX_REG_IN_URB_NUM
; i++) {

898 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_KERNEL
);

899 i‡(
urb
 =
NULL
) {

900 
ªt
 = -
ENOMEM
;

901 
îr_urb
;

905 
skb
 = 
	`Æloc_skb
(
MAX_REG_IN_BUF_SIZE
, 
GFP_KERNEL
);

906 i‡(!
skb
) {

907 
ªt
 = -
ENOMEM
;

908 
îr_skb
;

911 
	`usb_fûl_öt_urb
(
urb
, 
hif_dev
->
udev
,

912 
	`usb_rcvöçùe
(
hif_dev
->
udev
,

913 
USB_REG_IN_PIPE
),

914 
skb
->
d©a
, 
MAX_REG_IN_BUF_SIZE
,

915 
©h9k_hif_usb_ªg_ö_cb
, 
skb
, 1);

918 
	`usb_™ch‹_urb
(
urb
, &
hif_dev
->
ªg_ö_submôãd
);

921 
ªt
 = 
	`usb_submô_urb
(
urb
, 
GFP_KERNEL
);

922 i‡(
ªt
) {

923 
	`usb_u«nch‹_urb
(
urb
);

924 
îr_submô
;

931 
	`usb_‰ì_urb
(
urb
);

936 
îr_submô
:

937 
	`k‰ì_skb
(
skb
);

938 
îr_skb
:

939 
	`usb_‰ì_urb
(
urb
);

940 
îr_urb
:

941 
	`©h9k_hif_usb_dóŒoc_ªg_ö_urbs
(
hif_dev
);

942  
ªt
;

943 
	}
}

945 
	$©h9k_hif_usb_Æloc_urbs
(
hif_devi˚_usb
 *
hif_dev
)

948 
	`öô_usb_™ch‹
(&
hif_dev
->
ªgout_submôãd
);

951 i‡(
	`©h9k_hif_usb_Æloc_tx_urbs
(
hif_dev
) < 0)

952 
îr
;

955 i‡(
	`©h9k_hif_usb_Æloc_rx_urbs
(
hif_dev
) < 0)

956 
îr_rx
;

959 i‡(
	`©h9k_hif_usb_Æloc_ªg_ö_urbs
(
hif_dev
) < 0)

960 
îr_ªg
;

963 
îr_ªg
:

964 
	`©h9k_hif_usb_dóŒoc_rx_urbs
(
hif_dev
);

965 
îr_rx
:

966 
	`©h9k_hif_usb_dóŒoc_tx_urbs
(
hif_dev
);

967 
îr
:

968  -
ENOMEM
;

969 
	}
}

971 
	$©h9k_hif_usb_dóŒoc_urbs
(
hif_devi˚_usb
 *
hif_dev
)

973 
	`usb_kûl_™ch‹ed_urbs
(&
hif_dev
->
ªgout_submôãd
);

974 
	`©h9k_hif_usb_dóŒoc_ªg_ö_urbs
(
hif_dev
);

975 
	`©h9k_hif_usb_dóŒoc_tx_urbs
(
hif_dev
);

976 
	`©h9k_hif_usb_dóŒoc_rx_urbs
(
hif_dev
);

977 
	}
}

979 
	$©h9k_hif_usb_dow∆ﬂd_fw
(
hif_devi˚_usb
 *
hif_dev
)

981 
å™s„r
, 
îr
;

982 c⁄° *
d©a
 = 
hif_dev
->
fw_d©a
;

983 
size_t
 
Àn
 = 
hif_dev
->
fw_size
;

984 
u32
 
addr
 = 
AR9271_FIRMWARE
;

985 
u8
 *
buf
 = 
	`kzÆloc
(4096, 
GFP_KERNEL
);

986 
u32
 
fúm_off£t
;

988 i‡(!
buf
)

989  -
ENOMEM
;

991 
Àn
) {

992 
å™s„r
 = 
	`mö_t
(
size_t
, 
Àn
, 4096);

993 
	`mem˝y
(
buf
, 
d©a
, 
å™s„r
);

995 
îr
 = 
	`usb_c⁄åﬁ_msg
(
hif_dev
->
udev
,

996 
	`usb_¢d˘æpùe
(
hif_dev
->
udev
, 0),

997 
FIRMWARE_DOWNLOAD
, 0x40 | 
USB_DIR_OUT
,

998 
addr
 >> 8, 0, 
buf
, 
å™s„r
, 
HZ
);

999 i‡(
îr
 < 0) {

1000 
	`k‰ì
(
buf
);

1001  
îr
;

1004 
Àn
 -
å™s„r
;

1005 
d©a
 +
å™s„r
;

1006 
addr
 +
å™s„r
;

1008 
	`k‰ì
(
buf
);

1010 i‡(
	`IS_AR7010_DEVICE
(
hif_dev
->
usb_devi˚_id
->
drivî_öfo
))

1011 
fúm_off£t
 = 
AR7010_FIRMWARE_TEXT
;

1013 
fúm_off£t
 = 
AR9271_FIRMWARE_TEXT
;

1018 
îr
 = 
	`usb_c⁄åﬁ_msg
(
hif_dev
->
udev
, 
	`usb_¢d˘æpùe
(hif_dev->udev, 0),

1019 
FIRMWARE_DOWNLOAD_COMP
,

1020 0x40 | 
USB_DIR_OUT
,

1021 
fúm_off£t
 >> 8, 0, 
NULL
, 0, 
HZ
);

1022 i‡(
îr
)

1023  -
EIO
;

1025 
	`dev_öfo
(&
hif_dev
->
udev
->
dev
, "ath9k_htc: Transferred FW: %s, size: %ld\n",

1026 
hif_dev
->
fw_«me
, (Ëhif_dev->
fw_size
);

1029 
	}
}

1031 
	$©h9k_hif_usb_dev_öô
(
hif_devi˚_usb
 *
hif_dev
)

1033 
ªt
;

1035 
ªt
 = 
	`©h9k_hif_usb_dow∆ﬂd_fw
(
hif_dev
);

1036 i‡(
ªt
) {

1037 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

1039 
hif_dev
->
fw_«me
);

1040  
ªt
;

1044 
ªt
 = 
	`©h9k_hif_usb_Æloc_urbs
(
hif_dev
);

1045 i‡(
ªt
) {

1046 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

1048  
ªt
;

1052 
	}
}

1054 
	$©h9k_hif_usb_dev_deöô
(
hif_devi˚_usb
 *
hif_dev
)

1056 
	`©h9k_hif_usb_dóŒoc_urbs
(
hif_dev
);

1057 
	}
}

1063 
	$©h9k_hif_usb_fúmw¨e_Áû
(
hif_devi˚_usb
 *
hif_dev
)

1065 
devi˚
 *
dev
 = &
hif_dev
->
udev
->dev;

1066 
devi˚
 *
∑ª¡
 = 
dev
->parent;

1068 
	`com∂ëe_Æl
(&
hif_dev
->
fw_d⁄e
);

1070 i‡(
∑ª¡
)

1071 
	`devi˚_lock
(
∑ª¡
);

1073 
	`devi˚_ªÀa£_drivî
(
dev
);

1075 i‡(
∑ª¡
)

1076 
	`devi˚_u∆ock
(
∑ª¡
);

1077 
	}
}

1079 
©h9k_hif_usb_fúmw¨e_cb
(c⁄° 
fúmw¨e
 *
fw
, *
c⁄ãxt
);

1082 
	$©h9k_hif_ªque°_fúmw¨e
(
hif_devi˚_usb
 *
hif_dev
,

1083 
boﬁ
 
fú°
)

1085 
ödex
[8], *
chù
;

1086 
ªt
;

1088 i‡(
fú°
) {

1089 i‡(
htc_u£_dev_fw
) {

1090 
hif_dev
->
fw_mö‹_ödex
 = 
FIRMWARE_MINOR_IDX_MAX
 + 1;

1091 
	`•rötf
(
ödex
, "%s", "dev");

1093 
hif_dev
->
fw_mö‹_ödex
 = 
FIRMWARE_MINOR_IDX_MAX
;

1094 
	`•rötf
(
ödex
, "%d", 
hif_dev
->
fw_mö‹_ödex
);

1097 
hif_dev
->
fw_mö‹_ödex
--;

1098 
	`•rötf
(
ödex
, "%d", 
hif_dev
->
fw_mö‹_ödex
);

1102 i‡(
MAJOR_VERSION_REQ
 =1 && 
hif_dev
->
fw_mö‹_ödex
 == 3) {

1103 c⁄° *
fûíame
;

1105 i‡(
	`IS_AR7010_DEVICE
(
hif_dev
->
usb_devi˚_id
->
drivî_öfo
))

1106 
fûíame
 = 
FIRMWARE_AR7010_1_1
;

1108 
fûíame
 = 
FIRMWARE_AR9271
;

1113 
	`¢¥ötf
(
hif_dev
->
fw_«me
, (hif_dev->fw_name),

1114 "%s", 
fûíame
);

1116 } i‡(
hif_dev
->
fw_mö‹_ödex
 < 
FIRMWARE_MINOR_IDX_MIN
) {

1117 
	`dev_îr
(&
hif_dev
->
udev
->
dev
, "no suitable firmware found!\n");

1119  -
ENOENT
;

1121 i‡(
	`IS_AR7010_DEVICE
(
hif_dev
->
usb_devi˚_id
->
drivî_öfo
))

1122 
chù
 = "7010";

1124 
chù
 = "9271";

1130 
	`¢¥ötf
(
hif_dev
->
fw_«me
, (hif_dev->fw_name),

1131 "%s/htc_%s-%d.%s.0.fw", 
HTC_FW_PATH
,

1132 
chù
, 
MAJOR_VERSION_REQ
, 
ödex
);

1135 
ªt
 = 
	`ªque°_fúmw¨e_nowaô
(
THIS_MODULE
, 
åue
, 
hif_dev
->
fw_«me
,

1136 &
hif_dev
->
udev
->
dev
, 
GFP_KERNEL
,

1137 
hif_dev
, 
©h9k_hif_usb_fúmw¨e_cb
);

1138 i‡(
ªt
) {

1139 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

1141 
hif_dev
->
fw_«me
);

1142  
ªt
;

1145 
	`dev_öfo
(&
hif_dev
->
udev
->
dev
, "ath9k_htc: Firmware %sÑequested\n",

1146 
hif_dev
->
fw_«me
);

1148  
ªt
;

1149 
	}
}

1151 
	$©h9k_hif_usb_fúmw¨e_cb
(c⁄° 
fúmw¨e
 *
fw
, *
c⁄ãxt
)

1153 
hif_devi˚_usb
 *
hif_dev
 = 
c⁄ãxt
;

1154 
ªt
;

1156 i‡(!
fw
) {

1157 
ªt
 = 
	`©h9k_hif_ªque°_fúmw¨e
(
hif_dev
, 
Ál£
);

1158 i‡(!
ªt
)

1161 
	`dev_îr
(&
hif_dev
->
udev
->
dev
,

1163 
hif_dev
->
fw_«me
);

1164 
îr_fw
;

1167 
hif_dev
->
htc_h™dÀ
 = 
	`©h9k_htc_hw_Æloc
(hif_dev, &
hif_usb
,

1168 &
hif_dev
->
udev
->
dev
);

1169 i‡(
hif_dev
->
htc_h™dÀ
 =
NULL
)

1170 
îr_dev_Æloc
;

1172 
hif_dev
->
fw_d©a
 = 
fw
->
d©a
;

1173 
hif_dev
->
fw_size
 = 
fw
->
size
;

1177 
ªt
 = 
	`©h9k_hif_usb_dev_öô
(
hif_dev
);

1178 i‡(
ªt
)

1179 
îr_dev_öô
;

1181 
ªt
 = 
	`©h9k_htc_hw_öô
(
hif_dev
->
htc_h™dÀ
,

1182 &
hif_dev
->
öãrÁ˚
->
dev
,

1183 
hif_dev
->
usb_devi˚_id
->
idProdu˘
,

1184 
hif_dev
->
udev
->
¥odu˘
,

1185 
hif_dev
->
usb_devi˚_id
->
drivî_öfo
);

1186 i‡(
ªt
) {

1187 
ªt
 = -
EINVAL
;

1188 
îr_htc_hw_öô
;

1191 
	`ªÀa£_fúmw¨e
(
fw
);

1192 
hif_dev
->
Êags
 |
HIF_USB_READY
;

1193 
	`com∂ëe_Æl
(&
hif_dev
->
fw_d⁄e
);

1197 
îr_htc_hw_öô
:

1198 
	`©h9k_hif_usb_dev_deöô
(
hif_dev
);

1199 
îr_dev_öô
:

1200 
	`©h9k_htc_hw_‰ì
(
hif_dev
->
htc_h™dÀ
);

1201 
îr_dev_Æloc
:

1202 
	`ªÀa£_fúmw¨e
(
fw
);

1203 
îr_fw
:

1204 
	`©h9k_hif_usb_fúmw¨e_Áû
(
hif_dev
);

1205 
	}
}

1210 
	$£nd_eje˘_comm™d
(
usb_öãrÁ˚
 *
öãrÁ˚
)

1212 
usb_devi˚
 *
udev
 = 
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
);

1213 
usb_ho°_öãrÁ˚
 *
iÁ˚_desc
 = &
öãrÁ˚
->
Æt£âög
[0];

1214 
usb_ídpoöt_des¸ùt‹
 *
ídpoöt
;

1215 *
cmd
;

1216 
u8
 
bulk_out_ï
;

1217 
r
;

1220 
r
 = 1;Ñ >= 0;Ñ--) {

1221 
ídpoöt
 = &
iÁ˚_desc
->ídpoöt[
r
].
desc
;

1222 i‡(
	`usb_ídpoöt_dú_out
(
ídpoöt
) &&

1223 
	`usb_ídpoöt_x„r_bulk
(
ídpoöt
)) {

1224 
bulk_out_ï
 = 
ídpoöt
->
bEndpoötAddªss
;

1228 i‡(
r
 == -1) {

1229 
	`dev_îr
(&
udev
->
dev
,

1231  -
ENODEV
;

1234 
cmd
 = 
	`kzÆloc
(31, 
GFP_KERNEL
);

1235 i‡(
cmd
 =
NULL
)

1236  -
ENODEV
;

1239 
cmd
[0] = 0x55;

1240 
cmd
[1] = 0x53;

1241 
cmd
[2] = 0x42;

1242 
cmd
[3] = 0x43;

1243 
cmd
[14] = 6;

1245 
cmd
[15] = 0x1b;

1246 
cmd
[19] = 0x2;

1248 
	`dev_öfo
(&
udev
->
dev
, "Ejecting storage device...\n");

1249 
r
 = 
	`usb_bulk_msg
(
udev
, 
	`usb_¢dbulkpùe
(udev, 
bulk_out_ï
),

1250 
cmd
, 31, 
NULL
, 2000);

1251 
	`k‰ì
(
cmd
);

1252 i‡(
r
)

1253  
r
;

1258 
	`usb_£t_ötfd©a
(
öãrÁ˚
, 
NULL
);

1260 
	}
}

1262 
	$©h9k_hif_usb_¥obe
(
usb_öãrÁ˚
 *
öãrÁ˚
,

1263 c⁄° 
usb_devi˚_id
 *
id
)

1265 
usb_devi˚
 *
udev
 = 
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
);

1266 
hif_devi˚_usb
 *
hif_dev
;

1267 
ªt
 = 0;

1269 i‡(
id
->
drivî_öfo
 =
STORAGE_DEVICE
)

1270  
	`£nd_eje˘_comm™d
(
öãrÁ˚
);

1272 
hif_dev
 = 
	`kzÆloc
((
hif_devi˚_usb
), 
GFP_KERNEL
);

1273 i‡(!
hif_dev
) {

1274 
ªt
 = -
ENOMEM
;

1275 
îr_Æloc
;

1278 
	`usb_gë_dev
(
udev
);

1280 
hif_dev
->
udev
 = udev;

1281 
hif_dev
->
öãrÁ˚
 = interface;

1282 
hif_dev
->
usb_devi˚_id
 = 
id
;

1283 #ifde‡
CONFIG_PM


1284 
udev
->
ª£t_ªsume
 = 1;

1286 
	`usb_£t_ötfd©a
(
öãrÁ˚
, 
hif_dev
);

1288 
	`öô_com∂ëi⁄
(&
hif_dev
->
fw_d⁄e
);

1290 
ªt
 = 
	`©h9k_hif_ªque°_fúmw¨e
(
hif_dev
, 
åue
);

1291 i‡(
ªt
)

1292 
îr_fw_ªq
;

1294  
ªt
;

1296 
îr_fw_ªq
:

1297 
	`usb_£t_ötfd©a
(
öãrÁ˚
, 
NULL
);

1298 
	`k‰ì
(
hif_dev
);

1299 
	`usb_put_dev
(
udev
);

1300 
îr_Æloc
:

1301  
ªt
;

1302 
	}
}

1304 
	$©h9k_hif_usb_ªboŸ
(
usb_devi˚
 *
udev
)

1306 
u32
 
ªboŸ_cmd
 = 0xffffffff;

1307 *
buf
;

1308 
ªt
;

1310 
buf
 = 
	`kmemdup
(&
ªboŸ_cmd
, 4, 
GFP_KERNEL
);

1311 i‡(!
buf
)

1314 
ªt
 = 
	`usb_öãºu±_msg
(
udev
, 
	`usb_¢döçùe
(udev, 
USB_REG_OUT_PIPE
),

1315 
buf
, 4, 
NULL
, 
HZ
);

1316 i‡(
ªt
)

1317 
	`dev_îr
(&
udev
->
dev
, "ath9k_htc: USBÑeboot failed\n");

1319 
	`k‰ì
(
buf
);

1320 
	}
}

1322 
	$©h9k_hif_usb_disc⁄√˘
(
usb_öãrÁ˚
 *
öãrÁ˚
)

1324 
usb_devi˚
 *
udev
 = 
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
);

1325 
hif_devi˚_usb
 *
hif_dev
 = 
	`usb_gë_ötfd©a
(
öãrÁ˚
);

1326 
boﬁ
 
u≈lugged
 = (
udev
->
°©e
 =
USB_STATE_NOTATTACHED
Ë? 
åue
 : 
Ál£
;

1328 i‡(!
hif_dev
)

1331 
	`waô_f‹_com∂ëi⁄
(&
hif_dev
->
fw_d⁄e
);

1333 i‡(
hif_dev
->
Êags
 & 
HIF_USB_READY
) {

1334 
	`©h9k_htc_hw_deöô
(
hif_dev
->
htc_h™dÀ
, 
u≈lugged
);

1335 
	`©h9k_htc_hw_‰ì
(
hif_dev
->
htc_h™dÀ
);

1336 
	`©h9k_hif_usb_dev_deöô
(
hif_dev
);

1339 
	`usb_£t_ötfd©a
(
öãrÁ˚
, 
NULL
);

1343 i‡(!
u≈lugged
 && (
hif_dev
->
Êags
 & 
HIF_USB_READY
))

1344 
	`©h9k_hif_usb_ªboŸ
(
udev
);

1346 
	`k‰ì
(
hif_dev
);

1347 
	`dev_öfo
(&
udev
->
dev
, "ath9k_htc: USBÜayer deinitialized\n");

1348 
	`usb_put_dev
(
udev
);

1349 
	}
}

1351 #ifde‡
CONFIG_PM


1352 
	$©h9k_hif_usb_su•íd
(
usb_öãrÁ˚
 *
öãrÁ˚
,

1353 
pm_mesßge_t
 
mesßge
)

1355 
hif_devi˚_usb
 *
hif_dev
 = 
	`usb_gë_ötfd©a
(
öãrÁ˚
);

1361 i‡(!(
hif_dev
->
Êags
 & 
HIF_USB_START
))

1362 
	`©h9k_htc_su•íd
(
hif_dev
->
htc_h™dÀ
);

1364 
	`waô_f‹_com∂ëi⁄
(&
hif_dev
->
fw_d⁄e
);

1366 i‡(
hif_dev
->
Êags
 & 
HIF_USB_READY
)

1367 
	`©h9k_hif_usb_dóŒoc_urbs
(
hif_dev
);

1370 
	}
}

1372 
	$©h9k_hif_usb_ªsume
(
usb_öãrÁ˚
 *
öãrÁ˚
)

1374 
hif_devi˚_usb
 *
hif_dev
 = 
	`usb_gë_ötfd©a
(
öãrÁ˚
);

1375 
htc_èrgë
 *
htc_h™dÀ
 = 
hif_dev
->htc_handle;

1376 
ªt
;

1377 c⁄° 
fúmw¨e
 *
fw
;

1379 
ªt
 = 
	`©h9k_hif_usb_Æloc_urbs
(
hif_dev
);

1380 i‡(
ªt
)

1381  
ªt
;

1383 i‡(
hif_dev
->
Êags
 & 
HIF_USB_READY
) {

1385 
ªt
 = 
	`ªque°_fúmw¨e
(&
fw
, 
hif_dev
->
fw_«me
,

1386 &
hif_dev
->
udev
->
dev
);

1387 i‡(
ªt
)

1388 
Áû_ªsume
;

1390 
hif_dev
->
fw_d©a
 = 
fw
->
d©a
;

1391 
hif_dev
->
fw_size
 = 
fw
->
size
;

1392 
ªt
 = 
	`©h9k_hif_usb_dow∆ﬂd_fw
(
hif_dev
);

1393 
	`ªÀa£_fúmw¨e
(
fw
);

1394 i‡(
ªt
)

1395 
Áû_ªsume
;

1397 
	`©h9k_hif_usb_dóŒoc_urbs
(
hif_dev
);

1398  -
EIO
;

1401 
	`mdñay
(100);

1403 
ªt
 = 
	`©h9k_htc_ªsume
(
htc_h™dÀ
);

1405 i‡(
ªt
)

1406 
Áû_ªsume
;

1410 
Áû_ªsume
:

1411 
	`©h9k_hif_usb_dóŒoc_urbs
(
hif_dev
);

1413  
ªt
;

1414 
	}
}

1417 
usb_drivî
 
	g©h9k_hif_usb_drivî
 = {

1418 .
«me
 = 
KBUILD_MODNAME
,

1419 .
	g¥obe
 = 
©h9k_hif_usb_¥obe
,

1420 .
	gdisc⁄√˘
 = 
©h9k_hif_usb_disc⁄√˘
,

1421 #ifde‡
CONFIG_PM


1422 .
	gsu•íd
 = 
©h9k_hif_usb_su•íd
,

1423 .
	gªsume
 = 
©h9k_hif_usb_ªsume
,

1424 .
	gª£t_ªsume
 = 
©h9k_hif_usb_ªsume
,

1426 .
	gid_èbÀ
 = 
©h9k_hif_usb_ids
,

1427 .
	gso·_unböd
 = 1,

1428 #i‡(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(3,5,0))

1429 .
	gdißbÀ_hub_öôüãd_Õm
 = 1,

1433 
	$©h9k_hif_usb_öô
()

1435  
	`usb_ªgi°î
(&
©h9k_hif_usb_drivî
);

1436 
	}
}

1438 
	$©h9k_hif_usb_exô
()

1440 
	`usb_dîegi°î
(&
©h9k_hif_usb_drivî
);

1441 
	}
}

	@hif_usb.h

17 #i‚de‡
HTC_USB_H


18 
	#HTC_USB_H


	)

21 
	#FIRMWARE_AR7010_1_1
 "htc_7010.fw"

	)

22 
	#FIRMWARE_AR9271
 "htc_9271.fw"

	)

25 
	#MAJOR_VERSION_REQ
 1

	)

26 
	#MINOR_VERSION_REQ
 3

	)

28 
	#FIRMWARE_MINOR_IDX_MAX
 4

	)

29 
	#FIRMWARE_MINOR_IDX_MIN
 3

	)

30 
	#HTC_FW_PATH
 "©h9k_htc"

	)

32 
	#HTC_9271_MODULE_FW
 
HTC_FW_PATH
 "/htc_9271-" \

33 
	`__°rögify
(
MAJOR_VERSION_REQ
) \

34 "." 
	`__°rögify
(
FIRMWARE_MINOR_IDX_MAX
Ë".0.fw"

	)

35 
	#HTC_7010_MODULE_FW
 
HTC_FW_PATH
 "/htc_7010-" \

36 
	`__°rögify
(
MAJOR_VERSION_REQ
) \

37 "." 
	`__°rögify
(
FIRMWARE_MINOR_IDX_MAX
Ë".0.fw"

	)

39 
htc_u£_dev_fw
;

41 
	#IS_AR7010_DEVICE
(
_v
Ë(((_vË=
AR9280_USB
Ë|| ((_vË=
AR9287_USB
))

	)

43 
	#AR9271_FIRMWARE
 0x501000

	)

44 
	#AR9271_FIRMWARE_TEXT
 0x903000

	)

45 
	#AR7010_FIRMWARE_TEXT
 0x906000

	)

47 
	#FIRMWARE_DOWNLOAD
 0x30

	)

48 
	#FIRMWARE_DOWNLOAD_COMP
 0x31

	)

50 
	#ATH_USB_RX_STREAM_MODE_TAG
 0x4e00

	)

51 
	#ATH_USB_TX_STREAM_MODE_TAG
 0x697e

	)

54 
	#MAX_TX_URB_NUM
 8

	)

55 
	#MAX_TX_BUF_NUM
 256

	)

56 
	#MAX_TX_BUF_SIZE
 32768

	)

57 
	#MAX_TX_AGGR_NUM
 20

	)

59 
	#MAX_RX_URB_NUM
 8

	)

60 
	#MAX_RX_BUF_SIZE
 16384

	)

61 
	#MAX_PKT_NUM_IN_TRANSFER
 10

	)

63 
	#MAX_REG_OUT_URB_NUM
 1

	)

64 
	#MAX_REG_IN_URB_NUM
 64

	)

66 
	#MAX_REG_IN_BUF_SIZE
 64

	)

69 
	#USB_WLAN_TX_PIPE
 1

	)

70 
	#USB_WLAN_RX_PIPE
 2

	)

71 
	#USB_REG_IN_PIPE
 3

	)

72 
	#USB_REG_OUT_PIPE
 4

	)

74 
	#HIF_USB_MAX_RXPIPES
 2

	)

75 
	#HIF_USB_MAX_TXPIPES
 4

	)

77 
	stx_buf
 {

78 
u8
 *
	mbuf
;

79 
u16
 
	mÀn
;

80 
u16
 
	moff£t
;

81 
urb
 *
	murb
;

82 
sk_buff_hód
 
	mskb_queue
;

83 
hif_devi˚_usb
 *
	mhif_dev
;

84 
li°_hód
 
	mli°
;

87 
	#HIF_USB_TX_STOP
 
	`BIT
(0)

	)

88 
	#HIF_USB_TX_FLUSH
 
	`BIT
(1)

	)

90 
	shif_usb_tx
 {

91 
u8
 
	mÊags
;

92 
u8
 
	mtx_buf_˙t
;

93 
u16
 
	mtx_skb_˙t
;

94 
sk_buff_hód
 
	mtx_skb_queue
;

95 
li°_hód
 
	mtx_buf
;

96 
li°_hód
 
	mtx_≥ndög
;

97 
•ölock_t
 
	mtx_lock
;

100 
	scmd_buf
 {

101 
sk_buff
 *
	mskb
;

102 
hif_devi˚_usb
 *
	mhif_dev
;

105 
	#HIF_USB_START
 
	`BIT
(0)

	)

106 
	#HIF_USB_READY
 
	`BIT
(1)

	)

108 
	shif_devi˚_usb
 {

109 
usb_devi˚
 *
	mudev
;

110 
usb_öãrÁ˚
 *
	möãrÁ˚
;

111 c⁄° 
usb_devi˚_id
 *
	musb_devi˚_id
;

112 c⁄° *
	mfw_d©a
;

113 
size_t
 
	mfw_size
;

114 
com∂ëi⁄
 
	mfw_d⁄e
;

115 
htc_èrgë
 *
	mhtc_h™dÀ
;

116 
hif_usb_tx
 
	mtx
;

117 
usb_™ch‹
 
	mªgout_submôãd
;

118 
usb_™ch‹
 
	mrx_submôãd
;

119 
usb_™ch‹
 
	mªg_ö_submôãd
;

120 
usb_™ch‹
 
	mmgmt_submôãd
;

121 
sk_buff
 *
	mªmaö_skb
;

122 
	mfw_«me
[32];

123 
	mfw_mö‹_ödex
;

124 
	mrx_ªmaö_Àn
;

125 
	mrx_pkt_Àn
;

126 
	mrx_å™s„r_Àn
;

127 
	mrx_∑d_Àn
;

128 
•ölock_t
 
	mrx_lock
;

129 
u8
 
	mÊags
;

132 
©h9k_hif_usb_öô
();

133 
©h9k_hif_usb_exô
();

	@htc.h

17 #i‚de‡
HTC_H


18 
	#HTC_H


	)

20 
	~<löux/moduÀ.h
>

21 
	~<löux/usb.h
>

22 
	~<löux/fúmw¨e.h
>

23 
	~<löux/skbuff.h
>

24 
	~<löux/√tdevi˚.h
>

25 
	~<löux/ëhîdevi˚.h
>

26 
	~<löux/Àds.h
>

27 
	~<löux/¶ab.h
>

28 
	~<√t/mac80211.h
>

30 
	~"comm⁄.h
"

31 
	~"htc_h°.h
"

32 
	~"hif_usb.h
"

33 
	~"wmi.h
"

35 
	#ATH_STA_SHORT_CALINTERVAL
 1000

	)

36 
	#ATH_AP_SHORT_CALINTERVAL
 100

	)

37 
	#ATH_ANI_POLLINTERVAL
 100

	)

38 
	#ATH_LONG_CALINTERVAL
 30000

	)

39 
	#ATH_RESTART_CALINTERVAL
 1200000

	)

41 
	#ATH_DEFAULT_BMISS_LIMIT
 10

	)

42 
	#TSF_TO_TU
(
_h
, 
_l
) \

43 ((((
u32
)(
_h
)Ë<< 22Ë| (((u32)(
_l
)Ë>> 10))

	)

45 
õì80211_›s
 
©h9k_htc_›s
;

46 
htc_mod∑øm_nohw¸y±
;

47 #ifde‡
CPTCFG_MAC80211_LEDS


48 
©h9k_htc_Àd_blök
;

51 
	ehtc_phymode
 {

52 
	mHTC_MODE_11NA
 = 0,

53 
	mHTC_MODE_11NG
 = 1

56 
	ehtc_›mode
 {

57 
	mHTC_M_STA
 = 1,

58 
	mHTC_M_IBSS
 = 0,

59 
	mHTC_M_AHDEMO
 = 3,

60 
	mHTC_M_HOSTAP
 = 6,

61 
	mHTC_M_MONITOR
 = 8,

62 
	mHTC_M_WDS
 = 2

65 
	#ATH9K_HTC_AMPDU
 1

	)

66 
	#ATH9K_HTC_NORMAL
 2

	)

67 
	#ATH9K_HTC_BEACON
 3

	)

68 
	#ATH9K_HTC_MGMT
 4

	)

70 
	#ATH9K_HTC_TX_CTSONLY
 0x1

	)

71 
	#ATH9K_HTC_TX_RTSCTS
 0x2

	)

73 
	stx_‰ame_hdr
 {

74 
u8
 
	md©a_ty≥
;

75 
u8
 
	mnode_idx
;

76 
u8
 
	mvif_idx
;

77 
u8
 
	mtidno
;

78 
__be32
 
	mÊags
;

79 
u8
 
	mkey_ty≥
;

80 
u8
 
	mkeyix
;

81 
u8
 
	mcookõ
;

82 
u8
 
	m∑d
;

83 } 
	g__∑cked
;

85 
	stx_mgmt_hdr
 {

86 
u8
 
	mnode_idx
;

87 
u8
 
	mvif_idx
;

88 
u8
 
	mtidno
;

89 
u8
 
	mÊags
;

90 
u8
 
	mkey_ty≥
;

91 
u8
 
	mkeyix
;

92 
u8
 
	mcookõ
;

93 
u8
 
	m∑d
;

94 } 
	g__∑cked
;

96 
	stx_bóc⁄_hódî
 {

97 
u8
 
	mvif_ödex
;

98 
u8
 
	mÀn_ch™ged
;

99 
u16
 
	mªv
;

100 } 
	g__∑cked
;

102 
	#MAX_TX_AMPDU_SUBFRAMES_9271
 17

	)

103 
	#MAX_TX_AMPDU_SUBFRAMES_7010
 22

	)

105 
	s©h9k_htc_ˇp_èrgë
 {

106 
__be32
 
	mampdu_limô
;

107 
u8
 
	mampdu_sub‰ames
;

108 
u8
 
	míabÀ_c€x
;

109 
u8
 
	mtx_chaömask
;

110 
u8
 
	m∑d
;

111 } 
	g__∑cked
;

113 
	s©h9k_htc_èrgë_vif
 {

114 
u8
 
	mödex
;

115 
u8
 
	m›mode
;

116 
u8
 
	mmyaddr
[
ETH_ALEN
];

117 
u8
 
	m©h_ˇp
;

118 
__be16
 
	mπ°hªshﬁd
;

119 
u8
 
	m∑d
;

120 } 
	g__∑cked
;

122 
	s©h9k_htc_èrgë_°a
 {

123 
u8
 
	mmaˇddr
[
ETH_ALEN
];

124 
u8
 
	mbssid
[
ETH_ALEN
];

125 
u8
 
	m°a_ödex
;

126 
u8
 
	mvif_ödex
;

127 
u8
 
	mis_vif_°a
;

128 
__be16
 
	mÊags
;

129 
__be16
 
	mhtˇp
;

130 
__be16
 
	mmaxampdu
;

131 
u8
 
	m∑d
;

132 } 
	g__∑cked
;

134 
	s©h9k_htc_èrgë_aggr
 {

135 
u8
 
	m°a_ödex
;

136 
u8
 
	mtidno
;

137 
u8
 
	maggr_íabÀ
;

138 
u8
 
	m∑ddög
;

139 } 
	g__∑cked
;

141 
	#ATH_HTC_RATE_MAX
 30

	)

143 
	#WLAN_RC_DS_FLAG
 0x01

	)

144 
	#WLAN_RC_40_FLAG
 0x02

	)

145 
	#WLAN_RC_SGI_FLAG
 0x04

	)

146 
	#WLAN_RC_HT_FLAG
 0x08

	)

147 
	#ATH_RC_TX_STBC_FLAG
 0x20

	)

149 
	s©h9k_htc_øã£t
 {

150 
u8
 
	mrs_ƒ©es
;

151 
u8
 
	mrs_øãs
[
ATH_HTC_RATE_MAX
];

154 
	s©h9k_htc_øã
 {

155 
©h9k_htc_øã£t
 
	mÀgacy_øãs
;

156 
©h9k_htc_øã£t
 
	mht_øãs
;

157 } 
	g__∑cked
;

159 
	s©h9k_htc_èrgë_øã
 {

160 
u8
 
	m°a_ödex
;

161 
u8
 
	mi¢ew
;

162 
__be32
 
	mˇpÊags
;

163 
©h9k_htc_øã
 
	møãs
;

166 
	s©h9k_htc_èrgë_øã_mask
 {

167 
u8
 
	mvif_ödex
;

168 
u8
 
	mb™d
;

169 
__be32
 
	mmask
;

170 
u16
 
	m∑d
;

171 } 
	g__∑cked
;

173 
	s©h9k_htc_èrgë_öt_°©s
 {

174 
__be32
 
	mrx
;

175 
__be32
 
	mrx‹n
;

176 
__be32
 
	mrxeﬁ
;

177 
__be32
 
	mtxu∫
;

178 
__be32
 
	mtxto
;

179 
__be32
 
	mc°
;

180 } 
	g__∑cked
;

182 
	s©h9k_htc_èrgë_tx_°©s
 {

183 
__be32
 
	mxªåõs
;

184 
__be32
 
	mfif€º
;

185 
__be32
 
	mfûãªd
;

186 
__be32
 
	mtimî_exp
;

187 
__be32
 
	msh‹åërõs
;

188 
__be32
 
	ml⁄gªåõs
;

189 
__be32
 
	mqnuŒ
;

190 
__be32
 
	míˇp_Áû
;

191 
__be32
 
	mnobuf
;

192 } 
	g__∑cked
;

194 
	s©h9k_htc_èrgë_rx_°©s
 {

195 
__be32
 
	mnobuf
;

196 
__be32
 
	mho°_£nd
;

197 
__be32
 
	mho°_d⁄e
;

198 } 
	g__∑cked
;

200 
	#ATH9K_HTC_MAX_VIF
 2

	)

201 
	#ATH9K_HTC_MAX_BCN_VIF
 2

	)

203 
	#INC_VIF
(
_¥iv
, 
_ty≥
) do { \

204 
_ty≥
) { \

205 
NL80211_IFTYPE_STATION
: \

206 
_¥iv
->
num_°a_vif
++; \

208 
NL80211_IFTYPE_ADHOC
: \

209 
_¥iv
->
num_ibss_vif
++; \

211 
NL80211_IFTYPE_AP
: \

212 
_¥iv
->
num_≠_vif
++; \

214 
NL80211_IFTYPE_MESH_POINT
: \

215 
_¥iv
->
num_mbss_vif
++; \

220 } 0)

	)

222 
	#DEC_VIF
(
_¥iv
, 
_ty≥
) do { \

223 
_ty≥
) { \

224 
NL80211_IFTYPE_STATION
: \

225 
_¥iv
->
num_°a_vif
--; \

227 
NL80211_IFTYPE_ADHOC
: \

228 
_¥iv
->
num_ibss_vif
--; \

230 
NL80211_IFTYPE_AP
: \

231 
_¥iv
->
num_≠_vif
--; \

233 
NL80211_IFTYPE_MESH_POINT
: \

234 
_¥iv
->
num_mbss_vif
--; \

239 } 0)

	)

241 
	s©h9k_htc_vif
 {

242 
u8
 
	mödex
;

243 
u16
 
	m£q_no
;

244 
boﬁ
 
	mbóc⁄_c⁄figuªd
;

245 
	mb¶Ÿ
;

246 
__À64
 
	mtsÁdju°
;

249 
	s©h9k_vif_ôî_d©a
 {

250 c⁄° 
u8
 *
	mhw_maˇddr
;

251 
u8
 
	mmask
[
ETH_ALEN
];

254 
	#ATH9K_HTC_MAX_STA
 8

	)

255 
	#ATH9K_HTC_MAX_TID
 8

	)

257 
	etid_aggr_°©e
 {

258 
	mAGGR_STOP
 = 0,

259 
	mAGGR_PROGRESS
,

260 
	mAGGR_START
,

261 
	mAGGR_OPERATIONAL


264 
	s©h9k_htc_°a
 {

265 
u8
 
	mödex
;

266 
tid_aggr_°©e
 
	mtid_°©e
[
ATH9K_HTC_MAX_TID
];

267 
w‹k_°ru˘
 
	mrc_upd©e_w‹k
;

268 
©h9k_htc_¥iv
 *
	mhtc_¥iv
;

271 
	#ATH9K_HTC_RXBUF
 256

	)

272 
	#HTC_RX_FRAME_HEADER_SIZE
 40

	)

274 
	s©h9k_htc_rxbuf
 {

275 
boﬁ
 
	mö_¥o˚ss
;

276 
sk_buff
 *
	mskb
;

277 
©h_htc_rx_°©us
 
	mrx°©us
;

278 
li°_hód
 
	mli°
;

281 
	s©h9k_htc_rx
 {

282 
li°_hód
 
	mrxbuf
;

283 
•ölock_t
 
	mrxbuÊock
;

286 
	#ATH9K_HTC_TX_CLEANUP_INTERVAL
 50

	)

287 
	#ATH9K_HTC_TX_TIMEOUT_INTERVAL
 3000

	)

288 
	#ATH9K_HTC_TX_RESERVE
 10

	)

289 
	#ATH9K_HTC_TX_TIMEOUT_COUNT
 40

	)

290 
	#ATH9K_HTC_TX_THRESHOLD
 (
MAX_TX_BUF_NUM
 - 
ATH9K_HTC_TX_RESERVE
)

	)

292 
	#ATH9K_HTC_OP_TX_QUEUES_STOP
 
	`BIT
(0)

	)

293 
	#ATH9K_HTC_OP_TX_DRAIN
 
	`BIT
(1)

	)

295 
	s©h9k_htc_tx
 {

296 
u8
 
	mÊags
;

297 
	mqueued_˙t
;

298 
sk_buff_hód
 
	mmgmt_ï_queue
;

299 
sk_buff_hód
 
	mˇb_ï_queue
;

300 
sk_buff_hód
 
	md©a_be_queue
;

301 
sk_buff_hód
 
	md©a_bk_queue
;

302 
sk_buff_hód
 
	md©a_vi_queue
;

303 
sk_buff_hód
 
	md©a_vo_queue
;

304 
sk_buff_hód
 
	mtx_Áûed
;

305 
DECLARE_BITMAP
(
tx_¶Ÿ
, 
MAX_TX_BUF_NUM
);

306 
timî_li°
 
	m˛ónup_timî
;

307 
•ölock_t
 
	mtx_lock
;

310 
	s©h9k_htc_tx_˘l
 {

311 
u8
 
	mty≥
;

312 
u8
 
	mïid
;

313 
u8
 
	mtxok
;

314 
u8
 
	m°a_idx
;

315 
	mtime°amp
;

318 
ölöe
 
©h9k_htc_tx_˘l
 *
	$HTC_SKB_CB
(
sk_buff
 *
skb
)

320 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

322 
	`BUILD_BUG_ON
((
©h9k_htc_tx_˘l
) >

323 
IEEE80211_TX_INFO_DRIVER_DATA_SIZE
);

324  (
©h9k_htc_tx_˘l
 *Ë&
tx_öfo
->
drivî_d©a
;

325 
	}
}

327 #ifde‡
CPTCFG_ATH9K_HTC_DEBUGFS


329 
	#TX_STAT_INC
(
c
Ë(
hif_dev
->
htc_h™dÀ
->
drv_¥iv
->
debug
.
tx_°©s
.c++)

	)

330 
	#TX_STAT_ADD
(
c
, 
a
Ë(
hif_dev
->
htc_h™dÀ
->
drv_¥iv
->
debug
.
tx_°©s
.¯+a)

	)

331 
	#RX_STAT_INC
(
c
Ë(
hif_dev
->
htc_h™dÀ
->
drv_¥iv
->
debug
.
skbrx_°©s
.c++)

	)

332 
	#RX_STAT_ADD
(
c
, 
a
Ë(
hif_dev
->
htc_h™dÀ
->
drv_¥iv
->
debug
.
skbrx_°©s
.¯+a)

	)

333 
	#CAB_STAT_INC
 
¥iv
->
debug
.
tx_°©s
.
ˇb_queued
++

	)

335 
	#TX_QSTAT_INC
(
q
Ë(
¥iv
->
debug
.
tx_°©s
.
queue_°©s
[q]++)

	)

337 
©h9k_htc_îr_°©_rx
(
©h9k_htc_¥iv
 *
¥iv
,

338 
©h_rx_°©us
 *
rs
);

340 
	s©h_tx_°©s
 {

341 
u32
 
	mbuf_queued
;

342 
u32
 
	mbuf_com∂ëed
;

343 
u32
 
	mskb_queued
;

344 
u32
 
	mskb_suc˚ss
;

345 
u32
 
	mskb_suc˚ss_byãs
;

346 
u32
 
	mskb_Áûed
;

347 
u32
 
	mˇb_queued
;

348 
u32
 
	mqueue_°©s
[
IEEE80211_NUM_ACS
];

351 
	s©h_skbrx_°©s
 {

352 
u32
 
	mskb_Æloˇãd
;

353 
u32
 
	mskb_com∂ëed
;

354 
u32
 
	mskb_com∂ëed_byãs
;

355 
u32
 
	mskb_dr›≥d
;

358 
	s©h9k_debug
 {

359 
díåy
 *
	mdebugfs_phy
;

360 
©h_tx_°©s
 
	mtx_°©s
;

361 
©h_rx_°©s
 
	mrx_°©s
;

362 
©h_skbrx_°©s
 
	mskbrx_°©s
;

365 
©h9k_htc_gë_ë_°rögs
(
õì80211_hw
 *
hw
,

366 
õì80211_vif
 *
vif
,

367 
u32
 
s£t
, 
u8
 *
d©a
);

368 
©h9k_htc_gë_ë_s£t_cou¡
(
õì80211_hw
 *
hw
,

369 
õì80211_vif
 *
vif
, 
s£t
);

370 
©h9k_htc_gë_ë_°©s
(
õì80211_hw
 *
hw
,

371 
õì80211_vif
 *
vif
,

372 
ëhtoﬁ_°©s
 *
°©s
, 
u64
 *
d©a
);

375 
	#TX_STAT_INC
(
c
Ëdÿ{ } 0)

	)

376 
	#TX_STAT_ADD
(
c
, 
a
Ëdÿ{ } 0)

	)

377 
	#RX_STAT_INC
(
c
Ëdÿ{ } 0)

	)

378 
	#RX_STAT_ADD
(
c
, 
a
Ëdÿ{ } 0)

	)

379 
	#CAB_STAT_INC
 dÿ{ } 0)

	)

381 
	#TX_QSTAT_INC
(
c
Ëdÿ{ } 0)

	)

383 
ölöe
 
	$©h9k_htc_îr_°©_rx
(
©h9k_htc_¥iv
 *
¥iv
,

384 
©h_rx_°©us
 *
rs
)

386 
	}
}

390 
	#ATH_LED_PIN_DEF
 1

	)

391 
	#ATH_LED_PIN_9287
 10

	)

392 
	#ATH_LED_PIN_9271
 15

	)

393 
	#ATH_LED_PIN_7010
 12

	)

395 
	#BSTUCK_THRESHOLD
 10

	)

401 
	#DEFAULT_SWBA_RESPONSE
 40

	)

402 
	#MIN_SWBA_RESPONSE
 10

	)

404 
	shtc_bóc⁄
 {

406 
	mOK
,

407 
	mUPDATE
,

408 
	mCOMMIT


409 } 
	mupd©e¶Ÿ
;

411 
õì80211_vif
 *
	mb¶Ÿ
[
ATH9K_HTC_MAX_BCN_VIF
];

412 
u32
 
	mbmiss˙t
;

413 
u32
 
	mbóc⁄q
;

414 
	m¶Ÿtime
;

415 
	m¶Ÿupd©e
;

418 
	s©h_btc€x
 {

419 
u32
 
	mbt_¥i‹ôy_˙t
;

420 
	mbt_¥i‹ôy_time
;

421 
	mbt_°omp_ty≥
;

422 
u32
 
	mbtc€x_no_°omp
;

423 
u32
 
	mbtc€x_≥riod
;

424 
u32
 
	mbtsˇn_no_°omp
;

427 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


428 
©h9k_htc_öô_btc€x
(
©h9k_htc_¥iv
 *
¥iv
, *
¥odu˘
);

429 
©h9k_htc_°¨t_btc€x
(
©h9k_htc_¥iv
 *
¥iv
);

430 
©h9k_htc_°›_btc€x
(
©h9k_htc_¥iv
 *
¥iv
);

432 
ölöe
 
	$©h9k_htc_öô_btc€x
(
©h9k_htc_¥iv
 *
¥iv
, *
¥odu˘
)

434 
	}
}

435 
ölöe
 
	$©h9k_htc_°¨t_btc€x
(
©h9k_htc_¥iv
 *
¥iv
)

437 
	}
}

438 
ölöe
 
	$©h9k_htc_°›_btc€x
(
©h9k_htc_¥iv
 *
¥iv
)

440 
	}
}

443 
	#OP_BT_PRIORITY_DETECTED
 3

	)

444 
	#OP_BT_SCAN
 4

	)

445 
	#OP_TSF_RESET
 6

	)

447 
	ehtc_›_Êags
 {

448 
	mHTC_FWFLAG_NO_RMW
,

451 
	s©h9k_htc_¥iv
 {

452 
devi˚
 *
	mdev
;

453 
õì80211_hw
 *
	mhw
;

454 
©h_hw
 *
	mah
;

455 
htc_èrgë
 *
	mhtc
;

456 
wmi
 *
	mwmi
;

458 
u16
 
	mfw_vîsi⁄_maj‹
;

459 
u16
 
	mfw_vîsi⁄_mö‹
;

461 
htc_ídpoöt_id
 
	mwmi_cmd_ï
;

462 
htc_ídpoöt_id
 
	mbóc⁄_ï
;

463 
htc_ídpoöt_id
 
	mˇb_ï
;

464 
htc_ídpoöt_id
 
	mu≠sd_ï
;

465 
htc_ídpoöt_id
 
	mmgmt_ï
;

466 
htc_ídpoöt_id
 
	md©a_be_ï
;

467 
htc_ídpoöt_id
 
	md©a_bk_ï
;

468 
htc_ídpoöt_id
 
	md©a_vi_ï
;

469 
htc_ídpoöt_id
 
	md©a_vo_ï
;

471 
u8
 
	mvif_¶Ÿ
;

472 
u8
 
	mm⁄_vif_idx
;

473 
u8
 
	m°a_¶Ÿ
;

474 
u8
 
	mvif_°a_pos
[
ATH9K_HTC_MAX_VIF
];

475 
u8
 
	mnum_ibss_vif
;

476 
u8
 
	mnum_mbss_vif
;

477 
u8
 
	mnum_°a_vif
;

478 
u8
 
	mnum_°a_assoc_vif
;

479 
u8
 
	mnum_≠_vif
;

481 
u16
 
	mcuπxpow
;

482 
u16
 
	mtxpowlimô
;

483 
u16
 
	mnvifs
;

484 
u16
 
	mn°©i⁄s
;

485 
boﬁ
 
	mª¨m_™i
;

486 
boﬁ
 
	mªc⁄fig_bóc⁄
;

487 
	mrxfûãr
;

488 
	m›_Êags
;

489 
	mfw_Êags
;

491 
©h9k_hw_ˇl_d©a
 
	mˇld©a
;

492 
©h_•ec_sˇn_¥iv
 
	m•ec_¥iv
;

494 
•ölock_t
 
	mbóc⁄_lock
;

495 
©h_bóc⁄_c⁄fig
 
	mcur_bóc⁄_c⁄f
;

496 
htc_bóc⁄
 
	mbóc⁄
;

498 
©h9k_htc_rx
 
	mrx
;

499 
©h9k_htc_tx
 
	mtx
;

501 
èskÀt_°ru˘
 
	mswba_èskÀt
;

502 
èskÀt_°ru˘
 
	mrx_èskÀt
;

503 
dñayed_w‹k
 
	m™i_w‹k
;

504 
èskÀt_°ru˘
 
	mtx_Áûed_èskÀt
;

505 
w‹k_°ru˘
 
	mps_w‹k
;

506 
w‹k_°ru˘
 
	mÁèl_w‹k
;

508 
muãx
 
	mhtc_pm_lock
;

509 
	mps_u£cou¡
;

510 
boﬁ
 
	mps_íabÀd
;

511 
boﬁ
 
	mps_idÀ
;

513 #ifde‡
CPTCFG_MAC80211_LEDS


514 
Àd_brighäess
 
	mbrighäess
;

515 
boﬁ
 
	mÀd_ªgi°îed
;

516 
	mÀd_«me
[32];

517 
Àd_˛assdev
 
	mÀd_cdev
;

518 
w‹k_°ru˘
 
	mÀd_w‹k
;

521 
	mˇbq
;

522 
	mhwq_m≠
[
IEEE80211_NUM_ACS
];

524 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


525 
©h_btc€x
 
	mbtc€x
;

528 
dñayed_w‹k
 
	mc€x_≥riod_w‹k
;

529 
dñayed_w‹k
 
	mduty_cy˛e_w‹k
;

530 #ifde‡
CPTCFG_ATH9K_HTC_DEBUGFS


531 
©h9k_debug
 
	mdebug
;

533 
muãx
 
	mmuãx
;

534 
õì80211_vif
 *
	mcß_vif
;

537 
ölöe
 
	$©h_ªad_ˇchesize
(
©h_comm⁄
 *
comm⁄
, *
csz
)

539 
comm⁄
->
bus_›s
->
	`ªad_ˇchesize
(comm⁄, 
csz
);

540 
	}
}

542 
©h9k_htc_ª£t
(
©h9k_htc_¥iv
 *
¥iv
);

544 
©h9k_htc_assign_b¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
,

545 
õì80211_vif
 *
vif
);

546 
©h9k_htc_ªmove_b¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
,

547 
õì80211_vif
 *
vif
);

548 
©h9k_htc_£t_tsÁdju°
(
©h9k_htc_¥iv
 *
¥iv
,

549 
õì80211_vif
 *
vif
);

550 
©h9k_htc_bóc⁄q_c⁄fig
(
©h9k_htc_¥iv
 *
¥iv
);

551 
©h9k_htc_bóc⁄_c⁄fig
(
©h9k_htc_¥iv
 *
¥iv
,

552 
õì80211_vif
 *
vif
);

553 
©h9k_htc_bóc⁄_ªc⁄fig
(
©h9k_htc_¥iv
 *
¥iv
);

554 
©h9k_htc_swba
(
©h9k_htc_¥iv
 *
¥iv
,

555 
wmi_evít_swba
 *
swba
);

557 
©h9k_htc_rxï
(*
¥iv
, 
sk_buff
 *
skb
,

558 
htc_ídpoöt_id
 
ï_id
);

559 
©h9k_htc_txï
(*
¥iv
, 
sk_buff
 *
skb
, 
htc_ídpoöt_id
 
ï_id
,

560 
boﬁ
 
txok
);

561 
©h9k_htc_bóc⁄ï
(*
drv_¥iv
, 
sk_buff
 *
skb
,

562 
htc_ídpoöt_id
 
ï_id
, 
boﬁ
 
txok
);

564 
©h9k_htc_upd©e_ˇp_èrgë
(
©h9k_htc_¥iv
 *
¥iv
,

565 
u8
 
íabÀ_c€x
);

566 
©h9k_htc_™i_w‹k
(
w‹k_°ru˘
 *
w‹k
);

567 
©h9k_htc_°¨t_™i
(
©h9k_htc_¥iv
 *
¥iv
);

568 
©h9k_htc_°›_™i
(
©h9k_htc_¥iv
 *
¥iv
);

570 
©h9k_tx_öô
(
©h9k_htc_¥iv
 *
¥iv
);

571 
©h9k_htc_tx_°¨t
(
©h9k_htc_¥iv
 *
¥iv
,

572 
õì80211_°a
 *
°a
,

573 
sk_buff
 *
skb
, 
u8
 
¶Ÿ
, 
boﬁ
 
is_ˇb
);

574 
©h9k_tx_˛ónup
(
©h9k_htc_¥iv
 *
¥iv
);

575 
boﬁ
 
©h9k_htc_txq_£tup
(
©h9k_htc_¥iv
 *
¥iv
, 
subty≥
);

576 
©h9k_htc_ˇbq_£tup
(
©h9k_htc_¥iv
 *
¥iv
);

577 
gë_hw_qnum
(
u16
 
queue
, *
hwq_m≠
);

578 
©h_htc_txq_upd©e
(
©h9k_htc_¥iv
 *
¥iv
, 
qnum
,

579 
©h9k_tx_queue_öfo
 *
qöfo
);

580 
©h9k_htc_check_°›_queues
(
©h9k_htc_¥iv
 *
¥iv
);

581 
©h9k_htc_check_wake_queues
(
©h9k_htc_¥iv
 *
¥iv
);

582 
©h9k_htc_tx_gë_¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
);

583 
©h9k_htc_tx_˛ór_¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
, 
¶Ÿ
);

584 
©h9k_htc_tx_døö
(
©h9k_htc_¥iv
 *
¥iv
);

585 
©h9k_htc_tx°©us
(
©h9k_htc_¥iv
 *
¥iv
, *
wmi_evít
);

586 
©h9k_tx_Áûed_èskÀt
(
d©a
);

587 
©h9k_htc_tx_˛ónup_timî
(
d©a
);

588 
boﬁ
 
©h9k_htc_cß_is_föished
(
©h9k_htc_¥iv
 *
¥iv
);

590 
©h9k_rx_öô
(
©h9k_htc_¥iv
 *
¥iv
);

591 
©h9k_rx_˛ónup
(
©h9k_htc_¥iv
 *
¥iv
);

592 
©h9k_ho°_rx_öô
(
©h9k_htc_¥iv
 *
¥iv
);

593 
©h9k_rx_èskÀt
(
d©a
);

594 
u32
 
©h9k_htc_ˇl¸xfûãr
(
©h9k_htc_¥iv
 *
¥iv
);

596 
©h9k_htc_ps_wakeup
(
©h9k_htc_¥iv
 *
¥iv
);

597 
©h9k_htc_ps_ª°‹e
(
©h9k_htc_¥iv
 *
¥iv
);

598 
©h9k_ps_w‹k
(
w‹k_°ru˘
 *
w‹k
);

599 
boﬁ
 
©h9k_htc_£çowî
(
©h9k_htc_¥iv
 *
¥iv
,

600 
©h9k_powî_mode
 
mode
);

602 
©h9k_°¨t_rfkûl_pﬁl
(
©h9k_htc_¥iv
 *
¥iv
);

603 
©h9k_htc_rfkûl_pﬁl_°©e
(
õì80211_hw
 *
hw
);

605 
ba£_ìp_hódî
 *
©h9k_htc_gë_ì¥om_ba£
(
©h9k_htc_¥iv
 *
¥iv
);

607 #ifde‡
CPTCFG_MAC80211_LEDS


608 
©h9k_c⁄figuª_Àds
(
©h9k_htc_¥iv
 *
¥iv
);

609 
©h9k_öô_Àds
(
©h9k_htc_¥iv
 *
¥iv
);

610 
©h9k_deöô_Àds
(
©h9k_htc_¥iv
 *
¥iv
);

611 
©h9k_Àd_w‹k
(
w‹k_°ru˘
 *
w‹k
);

613 
ölöe
 
	$©h9k_c⁄figuª_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

615 
	}
}

617 
ölöe
 
	$©h9k_öô_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

619 
	}
}

621 
ölöe
 
	$©h9k_deöô_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

623 
	}
}

625 
ölöe
 
	$©h9k_Àd_w‹k
(
w‹k_°ru˘
 *
w‹k
)

627 
	}
}

630 
©h9k_htc_¥obe_devi˚
(
htc_èrgë
 *
htc_h™dÀ
, 
devi˚
 *
dev
,

631 
u16
 
devid
, *
¥odu˘
, 
u32
 
drv_öfo
);

632 
©h9k_htc_disc⁄√˘_devi˚
(
htc_èrgë
 *
htc_h™dÀ
, 
boﬁ
 
hŸu≈lug
);

633 #ifde‡
CONFIG_PM


634 
©h9k_htc_su•íd
(
htc_èrgë
 *
htc_h™dÀ
);

635 
©h9k_htc_ªsume
(
htc_èrgë
 *
htc_h™dÀ
);

637 #ifde‡
CPTCFG_ATH9K_HTC_DEBUGFS


638 
©h9k_htc_öô_debug
(
©h_hw
 *
ah
);

639 
©h9k_htc_deöô_debug
(
©h9k_htc_¥iv
 *
¥iv
);

641 
ölöe
 
	$©h9k_htc_öô_debug
(
©h_hw
 *
ah
Ë{  0; 
	}
};

642 
ölöe
 
	$©h9k_htc_deöô_debug
(
©h9k_htc_¥iv
 *
¥iv
)

644 
	}
}

	@htc_drv_beacon.c

17 
	~"htc.h
"

19 
	#FUDGE
 2

	)

21 
	$©h9k_htc_bóc⁄q_c⁄fig
(
©h9k_htc_¥iv
 *
¥iv
)

23 
©h_hw
 *
ah
 = 
¥iv
->ah;

24 
©h9k_tx_queue_öfo
 
qi
, 
qi_be
;

26 
	`mem£t
(&
qi
, 0, (
©h9k_tx_queue_öfo
));

27 
	`mem£t
(&
qi_be
, 0, (
©h9k_tx_queue_öfo
));

29 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
¥iv
->
bóc⁄
.
bóc⁄q
, &
qi
);

31 i‡(
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_AP
 ||

32 
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_MESH_POINT
) {

33 
qi
.
tqi_aifs
 = 1;

34 
qi
.
tqi_cwmö
 = 0;

35 
qi
.
tqi_cwmax
 = 0;

36 } i‡(
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_ADHOC
) {

37 
qnum
 = 
¥iv
->
hwq_m≠
[
IEEE80211_AC_BE
];

39 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
qnum
, &
qi_be
);

41 
qi
.
tqi_aifs
 = 
qi_be
.tqi_aifs;

48 i‡(
ah
->
¶Ÿtime
 =
ATH9K_SLOT_TIME_20
)

49 
qi
.
tqi_cwmö
 = 2*
qi_be
.tqi_cwmin;

51 
qi
.
tqi_cwmö
 = 4*
qi_be
.tqi_cwmin;

53 
qi
.
tqi_cwmax
 = 
qi_be
.tqi_cwmax;

57 i‡(!
	`©h9k_hw_£t_txq_¥›s
(
ah
, 
¥iv
->
bóc⁄
.
bóc⁄q
, &
qi
)) {

58 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

59 "U«bÀÅÿupd©êbóc⁄ queuê%u!\n", 
¥iv
->
bóc⁄
.
bóc⁄q
);

61 
	`©h9k_hw_ª£âxqueue
(
ah
, 
¥iv
->
bóc⁄
.
bóc⁄q
);

63 
	}
}

68 
	$©h9k_htc_bóc⁄_öô
(
©h9k_htc_¥iv
 *
¥iv
,

69 
©h_bóc⁄_c⁄fig
 *
c⁄f
,

70 
boﬁ
 
ª£t_tsf
)

72 
©h_hw
 *
ah
 = 
¥iv
->ah;

73 
ªt
 
	`__©åibuã__
 ((
unu£d
));

74 
__be32
 
htc_imask
 = 0;

75 
u8
 
cmd_r•
;

77 i‡(
c⁄f
->
ötvÆ
 >
	`TU_TO_USEC
(
DEFAULT_SWBA_RESPONSE
))

78 
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
 = 
DEFAULT_SWBA_RESPONSE
;

80 
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
 = 
MIN_SWBA_RESPONSE
;

82 
	`WMI_CMD
(
WMI_DISABLE_INTR_CMDID
);

83 i‡(
ª£t_tsf
)

84 
	`©h9k_hw_ª£t_tsf
(
ah
);

85 
	`©h9k_htc_bóc⁄q_c⁄fig
(
¥iv
);

86 
	`©h9k_hw_bóc⁄öô
(
ah
, 
c⁄f
->
√xâbâ
, c⁄f->
ötvÆ
);

87 
¥iv
->
bóc⁄
.
bmiss˙t
 = 0;

88 
htc_imask
 = 
	`˝u_to_be32
(
ah
->
imask
);

89 
	`WMI_CMD_BUF
(
WMI_ENABLE_INTR_CMDID
, &
htc_imask
);

90 
	}
}

92 
	$©h9k_htc_bóc⁄_c⁄fig_°a
(
©h9k_htc_¥iv
 *
¥iv
,

93 
©h_bóc⁄_c⁄fig
 *
bss_c⁄f
)

95 
©h9k_bóc⁄_°©e
 
bs
;

96 
©h9k_öt
 
imask
 = 0;

97 
__be32
 
htc_imask
 = 0;

98 
ªt
 
	`__©åibuã__
 ((
unu£d
));

99 
u8
 
cmd_r•
;

101 i‡(
	`©h9k_cmn_bóc⁄_c⁄fig_°a
(
¥iv
->
ah
, 
bss_c⁄f
, &
bs
Ë=-
EPERM
)

104 
	`WMI_CMD
(
WMI_DISABLE_INTR_CMDID
);

105 
	`©h9k_hw_£t_°a_bóc⁄_timîs
(
¥iv
->
ah
, &
bs
);

106 
imask
 |
ATH9K_INT_BMISS
;

107 
htc_imask
 = 
	`˝u_to_be32
(
imask
);

108 
	`WMI_CMD_BUF
(
WMI_ENABLE_INTR_CMDID
, &
htc_imask
);

109 
	}
}

111 
	$©h9k_htc_bóc⁄_c⁄fig_≠
(
©h9k_htc_¥iv
 *
¥iv
,

112 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

114 
©h_hw
 *
ah
 = 
¥iv
->ah;

115 
ah
->
imask
 = 0;

117 
	`©h9k_cmn_bóc⁄_c⁄fig_≠
(
ah
, 
c⁄f
, 
ATH9K_HTC_MAX_BCN_VIF
);

118 
	`©h9k_htc_bóc⁄_öô
(
¥iv
, 
c⁄f
, 
Ál£
);

119 
	}
}

121 
	$©h9k_htc_bóc⁄_c⁄fig_adhoc
(
©h9k_htc_¥iv
 *
¥iv
,

122 
©h_bóc⁄_c⁄fig
 *
c⁄f
)

124 
©h_hw
 *
ah
 = 
¥iv
->ah;

125 
ah
->
imask
 = 0;

127 
	`©h9k_cmn_bóc⁄_c⁄fig_adhoc
(
ah
, 
c⁄f
);

128 
	`©h9k_htc_bóc⁄_öô
(
¥iv
, 
c⁄f
, c⁄f->
ibss_¸ót‹
);

129 
	}
}

131 
	$©h9k_htc_bóc⁄ï
(*
drv_¥iv
, 
sk_buff
 *
skb
,

132 
htc_ídpoöt_id
 
ï_id
, 
boﬁ
 
txok
)

134 
	`dev_k‰ì_skb_™y
(
skb
);

135 
	}
}

137 
	$©h9k_htc_£nd_buf„ªd
(
©h9k_htc_¥iv
 *
¥iv
,

138 
¶Ÿ
)

140 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

141 
õì80211_vif
 *
vif
;

142 
sk_buff
 *
skb
;

143 
õì80211_hdr
 *
hdr
;

144 
∑dpos
, 
∑dsize
, 
ªt
, 
tx_¶Ÿ
;

146 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

148 
vif
 = 
¥iv
->
bóc⁄
.
b¶Ÿ
[
¶Ÿ
];

150 
skb
 = 
	`õì80211_gë_buf„ªd_bc
(
¥iv
->
hw
, 
vif
);

152 
skb
) {

153 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

155 
∑dpos
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

156 
∑dsize
 = 
∑dpos
 & 3;

157 i‡(
∑dsize
 && 
skb
->
Àn
 > 
∑dpos
) {

158 i‡(
	`skb_hódroom
(
skb
Ë< 
∑dsize
) {

159 
	`dev_k‰ì_skb_™y
(
skb
);

160 
√xt
;

162 
	`skb_push
(
skb
, 
∑dsize
);

163 
	`memmove
(
skb
->
d©a
, skb->d©®+ 
∑dsize
, 
∑dpos
);

166 
tx_¶Ÿ
 = 
	`©h9k_htc_tx_gë_¶Ÿ
(
¥iv
);

167 i‡(
tx_¶Ÿ
 < 0) {

168 
	`©h_dbg
(
comm⁄
, 
XMIT
, "No free CAB slot\n");

169 
	`dev_k‰ì_skb_™y
(
skb
);

170 
√xt
;

173 
ªt
 = 
	`©h9k_htc_tx_°¨t
(
¥iv
, 
NULL
, 
skb
, 
tx_¶Ÿ
, 
åue
);

174 i‡(
ªt
 != 0) {

175 
	`©h9k_htc_tx_˛ór_¶Ÿ
(
¥iv
, 
tx_¶Ÿ
);

176 
	`dev_k‰ì_skb_™y
(
skb
);

178 
	`©h_dbg
(
comm⁄
, 
XMIT
, "FailedÅo send CAB frame\n");

180 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

181 
¥iv
->
tx
.
queued_˙t
++;

182 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

184 
√xt
:

185 
skb
 = 
	`õì80211_gë_buf„ªd_bc
(
¥iv
->
hw
, 
vif
);

188 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

189 
	}
}

191 
	$©h9k_htc_£nd_bóc⁄
(
©h9k_htc_¥iv
 *
¥iv
,

192 
¶Ÿ
)

194 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

195 
õì80211_vif
 *
vif
;

196 
©h9k_htc_vif
 *
avp
;

197 
tx_bóc⁄_hódî
 
bóc⁄_hdr
;

198 
©h9k_htc_tx_˘l
 *
tx_˘l
;

199 
õì80211_tx_öfo
 *
öfo
;

200 
õì80211_mgmt
 *
mgmt
;

201 
sk_buff
 *
bóc⁄
;

202 
u8
 *
tx_fhdr
;

203 
ªt
;

205 
	`mem£t
(&
bóc⁄_hdr
, 0, (
tx_bóc⁄_hódî
));

207 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

209 
vif
 = 
¥iv
->
bóc⁄
.
b¶Ÿ
[
¶Ÿ
];

210 
avp
 = (
©h9k_htc_vif
 *)
vif
->
drv_¥iv
;

212 i‡(
	`u∆ikñy
(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
))) {

213 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

218 
bóc⁄
 = 
	`õì80211_bóc⁄_gë
(
¥iv
->
hw
, 
vif
);

219 i‡(!
bóc⁄
) {

220 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

228 
mgmt
 = (
õì80211_mgmt
 *)
bóc⁄
->
d©a
;

229 
mgmt
->
u
.
bóc⁄
.
time°amp
 = 
avp
->
tsÁdju°
;

231 
öfo
 = 
	`IEEE80211_SKB_CB
(
bóc⁄
);

232 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_ASSIGN_SEQ
) {

233 
õì80211_hdr
 *
hdr
 =

234 (
õì80211_hdr
 *Ë
bóc⁄
->
d©a
;

235 
avp
->
£q_no
 += 0x10;

236 
hdr
->
£q_˘æ
 &
	`˝u_to_À16
(
IEEE80211_SCTL_FRAG
);

237 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
avp
->
£q_no
);

240 
tx_˘l
 = 
	`HTC_SKB_CB
(
bóc⁄
);

241 
	`mem£t
(
tx_˘l
, 0, (*tx_ctl));

243 
tx_˘l
->
ty≥
 = 
ATH9K_HTC_BEACON
;

244 
tx_˘l
->
ïid
 = 
¥iv
->
bóc⁄_ï
;

246 
bóc⁄_hdr
.
vif_ödex
 = 
avp
->
ödex
;

247 
tx_fhdr
 = 
	`skb_push
(
bóc⁄
, (
bóc⁄_hdr
));

248 
	`mem˝y
(
tx_fhdr
, (
u8
 *Ë&
bóc⁄_hdr
, (beacon_hdr));

250 
ªt
 = 
	`htc_£nd
(
¥iv
->
htc
, 
bóc⁄
);

251 i‡(
ªt
 != 0) {

252 i‡(
ªt
 =-
ENOMEM
) {

253 
	`©h_dbg
(
comm⁄
, 
BSTUCK
,

256 
	`dev_k‰ì_skb_™y
(
bóc⁄
);

259 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

261 
	`©h9k_htc_cß_is_föished
(
¥iv
);

262 
	}
}

264 
	$©h9k_htc_choo£_b¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
,

265 
wmi_evít_swba
 *
swba
)

267 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

268 
u64
 
tsf
;

269 
u32
 
ts·u
;

270 
u16
 
ötvÆ
;

271 
¶Ÿ
;

273 
ötvÆ
 = 
¥iv
->
cur_bóc⁄_c⁄f
.
bóc⁄_öãrvÆ
;

275 
tsf
 = 
	`be64_to_˝u
(
swba
->tsf);

276 
ts·u
 = 
	`TSF_TO_TU
(
tsf
 >> 32,Åsf);

277 
¶Ÿ
 = ((
ts·u
 % 
ötvÆ
Ë* 
ATH9K_HTC_MAX_BCN_VIF
) / intval;

278 
¶Ÿ
 = 
ATH9K_HTC_MAX_BCN_VIF
 - slot - 1;

280 
	`©h_dbg
(
comm⁄
, 
BEACON
,

282 
¶Ÿ
, 
tsf
, 
ts·u
, 
ötvÆ
);

284  
¶Ÿ
;

285 
	}
}

287 
	$©h9k_htc_swba
(
©h9k_htc_¥iv
 *
¥iv
,

288 
wmi_evít_swba
 *
swba
)

290 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

291 
¶Ÿ
;

293 i‡(
swba
->
bóc⁄_≥ndög
 != 0) {

294 
¥iv
->
bóc⁄
.
bmiss˙t
++;

295 i‡(
¥iv
->
bóc⁄
.
bmiss˙t
 > 
BSTUCK_THRESHOLD
) {

296 
	`©h_dbg
(
comm⁄
, 
BSTUCK
, "Beacon stuck, HWÑeset\n");

297 
	`õì80211_queue_w‹k
(
¥iv
->
hw
,

298 &
¥iv
->
Áèl_w‹k
);

303 i‡(
¥iv
->
bóc⁄
.
bmiss˙t
) {

304 
	`©h_dbg
(
comm⁄
, 
BSTUCK
,

306 
¥iv
->
bóc⁄
.
bmiss˙t
);

307 
¥iv
->
bóc⁄
.
bmiss˙t
 = 0;

310 
¶Ÿ
 = 
	`©h9k_htc_choo£_b¶Ÿ
(
¥iv
, 
swba
);

311 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

312 i‡(
¥iv
->
bóc⁄
.
b¶Ÿ
[
¶Ÿ
] =
NULL
) {

313 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

316 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

318 
	`©h9k_htc_£nd_buf„ªd
(
¥iv
, 
¶Ÿ
);

319 
	`©h9k_htc_£nd_bóc⁄
(
¥iv
, 
¶Ÿ
);

320 
	}
}

322 
	$©h9k_htc_assign_b¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
,

323 
õì80211_vif
 *
vif
)

325 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

326 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*)
vif
->
drv_¥iv
;

327 
i
 = 0;

329 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

330 
i
 = 0; i < 
ATH9K_HTC_MAX_BCN_VIF
; i++) {

331 i‡(
¥iv
->
bóc⁄
.
b¶Ÿ
[
i
] =
NULL
) {

332 
avp
->
b¶Ÿ
 = 
i
;

337 
¥iv
->
bóc⁄
.
b¶Ÿ
[
avp
->b¶Ÿ] = 
vif
;

338 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

340 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Added interfaceát beacon slot: %d\n",

341 
avp
->
b¶Ÿ
);

342 
	}
}

344 
	$©h9k_htc_ªmove_b¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
,

345 
õì80211_vif
 *
vif
)

347 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

348 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*)
vif
->
drv_¥iv
;

350 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

351 
¥iv
->
bóc⁄
.
b¶Ÿ
[
avp
->b¶Ÿ] = 
NULL
;

352 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

354 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Removed interfaceát beacon slot: %d\n",

355 
avp
->
b¶Ÿ
);

356 
	}
}

362 
	$©h9k_htc_£t_tsÁdju°
(
©h9k_htc_¥iv
 *
¥iv
,

363 
õì80211_vif
 *
vif
)

365 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

366 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*)
vif
->
drv_¥iv
;

367 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
¥iv
->
cur_bóc⁄_c⁄f
;

368 
u64
 
tsÁdju°
;

370 i‡(
avp
->
b¶Ÿ
 == 0)

378 
tsÁdju°
 = 
cur_c⁄f
->
bóc⁄_öãrvÆ
 * 
avp
->
b¶Ÿ
 / 
ATH9K_HTC_MAX_BCN_VIF
;

379 
avp
->
tsÁdju°
 = 
	`˝u_to_À64
(
	`TU_TO_USEC
(tsfadjust));

381 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "tsfadjust is: %llu for bslot: %d\n",

382 ()
tsÁdju°
, 
avp
->
b¶Ÿ
);

383 
	}
}

385 
	$©h9k_htc_bóc⁄_ôî
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

387 
boﬁ
 *
bóc⁄_c⁄figuªd
 = (boﬁ *)
d©a
;

388 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*Ë
vif
->
drv_¥iv
;

390 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

391 
avp
->
bóc⁄_c⁄figuªd
)

392 *
bóc⁄_c⁄figuªd
 = 
åue
;

393 
	}
}

395 
boﬁ
 
	$©h9k_htc_check_bóc⁄_c⁄fig
(
©h9k_htc_¥iv
 *
¥iv
,

396 
õì80211_vif
 *
vif
)

398 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

399 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
¥iv
->
cur_bóc⁄_c⁄f
;

400 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
vif
->bss_conf;

401 
boﬁ
 
bóc⁄_c⁄figuªd
;

408 i‡((
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_AP
) &&

409 (
¥iv
->
num_≠_vif
 > 1) &&

410 (
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) &&

411 (
cur_c⁄f
->
bóc⁄_öãrvÆ
 !
bss_c⁄f
->
bóc⁄_öt
)) {

412 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

414  
Ál£
;

421 i‡(
¥iv
->
num_≠_vif
 &&

422 (
vif
->
ty≥
 !
NL80211_IFTYPE_AP
)) {

423 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

425  
Ál£
;

432 i‡((
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) &&

433 (
¥iv
->
num_°a_vif
 > 1) &&

434 (
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)) {

435 
bóc⁄_c⁄figuªd
 = 
Ál£
;

436 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

437 
¥iv
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

438 
©h9k_htc_bóc⁄_ôî
, &
bóc⁄_c⁄figuªd
);

440 i‡(
bóc⁄_c⁄figuªd
) {

441 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

443  
Ál£
;

447  
åue
;

448 
	}
}

450 
	$©h9k_htc_bóc⁄_c⁄fig
(
©h9k_htc_¥iv
 *
¥iv
,

451 
õì80211_vif
 *
vif
)

453 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

454 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
¥iv
->
cur_bóc⁄_c⁄f
;

455 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
vif
->bss_conf;

456 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*Ë
vif
->
drv_¥iv
;

458 i‡(!
	`©h9k_htc_check_bóc⁄_c⁄fig
(
¥iv
, 
vif
))

461 
cur_c⁄f
->
bóc⁄_öãrvÆ
 = 
bss_c⁄f
->
bóc⁄_öt
;

462 i‡(
cur_c⁄f
->
bóc⁄_öãrvÆ
 == 0)

463 
cur_c⁄f
->
bóc⁄_öãrvÆ
 = 100;

465 
cur_c⁄f
->
dtim_≥riod
 = 
bss_c⁄f
->dtim_period;

466 
cur_c⁄f
->
bmiss_timeout
 =

467 
ATH_DEFAULT_BMISS_LIMIT
 * 
cur_c⁄f
->
bóc⁄_öãrvÆ
;

469 
vif
->
ty≥
) {

470 
NL80211_IFTYPE_STATION
:

471 
	`©h9k_htc_bóc⁄_c⁄fig_°a
(
¥iv
, 
cur_c⁄f
);

472 
avp
->
bóc⁄_c⁄figuªd
 = 
åue
;

474 
NL80211_IFTYPE_ADHOC
:

475 
	`©h9k_htc_bóc⁄_c⁄fig_adhoc
(
¥iv
, 
cur_c⁄f
);

477 
NL80211_IFTYPE_MESH_POINT
:

478 
NL80211_IFTYPE_AP
:

479 
	`©h9k_htc_bóc⁄_c⁄fig_≠
(
¥iv
, 
cur_c⁄f
);

482 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Unsupported beaconing mode\n");

485 
	}
}

487 
	$©h9k_htc_bóc⁄_ªc⁄fig
(
©h9k_htc_¥iv
 *
¥iv
)

489 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

490 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
¥iv
->
cur_bóc⁄_c⁄f
;

492 
¥iv
->
ah
->
›mode
) {

493 
NL80211_IFTYPE_STATION
:

494 
	`©h9k_htc_bóc⁄_c⁄fig_°a
(
¥iv
, 
cur_c⁄f
);

496 
NL80211_IFTYPE_ADHOC
:

497 
	`©h9k_htc_bóc⁄_c⁄fig_adhoc
(
¥iv
, 
cur_c⁄f
);

499 
NL80211_IFTYPE_MESH_POINT
:

500 
NL80211_IFTYPE_AP
:

501 
	`©h9k_htc_bóc⁄_c⁄fig_≠
(
¥iv
, 
cur_c⁄f
);

504 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Unsupported beaconing mode\n");

507 
	}
}

509 
boﬁ
 
	$©h9k_htc_cß_is_föished
(
©h9k_htc_¥iv
 *
¥iv
)

511 
õì80211_vif
 *
vif
;

513 
vif
 = 
¥iv
->
cß_vif
;

514 i‡(!
vif
 || !vif->
cß_a˘ive
)

515  
Ál£
;

517 i‡(!
	`õì80211_cß_is_com∂ëe
(
vif
))

518  
Ál£
;

520 
	`õì80211_cß_föish
(
vif
);

522 
¥iv
->
cß_vif
 = 
NULL
;

523  
åue
;

524 
	}
}

	@htc_drv_debug.c

17 
	~"htc.h
"

19 
ssize_t
 
	$ªad_fûe_tgt_öt_°©s
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

20 
size_t
 
cou¡
, 
loff_t
 *
µos
)

22 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

23 
©h9k_htc_èrgë_öt_°©s
 
cmd_r•
;

24 
buf
[512];

25 
Àn
 = 0;

26 
ªt
 = 0;

28 
	`mem£t
(&
cmd_r•
, 0, (cmd_rsp));

30 
	`©h9k_htc_ps_wakeup
(
¥iv
);

32 
	`WMI_CMD
(
WMI_INT_STATS_CMDID
);

33 i‡(
ªt
) {

34 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

35  -
EINVAL
;

38 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

40 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

42 
	`be32_to_˝u
(
cmd_r•
.
rx
));

44 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

46 
	`be32_to_˝u
(
cmd_r•
.
rx‹n
));

48 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

50 
	`be32_to_˝u
(
cmd_r•
.
rxeﬁ
));

52 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

54 
	`be32_to_˝u
(
cmd_r•
.
txu∫
));

56 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

58 
	`be32_to_˝u
(
cmd_r•
.
txto
));

60 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

62 
	`be32_to_˝u
(
cmd_r•
.
c°
));

64 i‡(
Àn
 > (
buf
))

65 
Àn
 = (
buf
);

67  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

68 
	}
}

70 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tgt_öt_°©s
 = {

71 .
ªad
 = 
ªad_fûe_tgt_öt_°©s
,

72 .
	g›í
 = 
sim∂e_›í
,

73 .
	gow√r
 = 
THIS_MODULE
,

74 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

77 
ssize_t
 
	$ªad_fûe_tgt_tx_°©s
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

78 
size_t
 
cou¡
, 
loff_t
 *
µos
)

80 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

81 
©h9k_htc_èrgë_tx_°©s
 
cmd_r•
;

82 
buf
[512];

83 
Àn
 = 0;

84 
ªt
 = 0;

86 
	`mem£t
(&
cmd_r•
, 0, (cmd_rsp));

88 
	`©h9k_htc_ps_wakeup
(
¥iv
);

90 
	`WMI_CMD
(
WMI_TX_STATS_CMDID
);

91 i‡(
ªt
) {

92 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

93  -
EINVAL
;

96 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

98 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

100 
	`be32_to_˝u
(
cmd_r•
.
xªåõs
));

102 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

104 
	`be32_to_˝u
(
cmd_r•
.
fif€º
));

106 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

108 
	`be32_to_˝u
(
cmd_r•
.
fûãªd
));

110 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

112 
	`be32_to_˝u
(
cmd_r•
.
timî_exp
));

114 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

116 
	`be32_to_˝u
(
cmd_r•
.
sh‹åërõs
));

118 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

120 
	`be32_to_˝u
(
cmd_r•
.
l⁄gªåõs
));

122 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

124 
	`be32_to_˝u
(
cmd_r•
.
qnuŒ
));

126 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

128 
	`be32_to_˝u
(
cmd_r•
.
íˇp_Áû
));

130 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

132 
	`be32_to_˝u
(
cmd_r•
.
nobuf
));

134 i‡(
Àn
 > (
buf
))

135 
Àn
 = (
buf
);

137  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

138 
	}
}

140 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tgt_tx_°©s
 = {

141 .
ªad
 = 
ªad_fûe_tgt_tx_°©s
,

142 .
	g›í
 = 
sim∂e_›í
,

143 .
	gow√r
 = 
THIS_MODULE
,

144 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

147 
ssize_t
 
	$ªad_fûe_tgt_rx_°©s
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

148 
size_t
 
cou¡
, 
loff_t
 *
µos
)

150 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

151 
©h9k_htc_èrgë_rx_°©s
 
cmd_r•
;

152 
buf
[512];

153 
Àn
 = 0;

154 
ªt
 = 0;

156 
	`mem£t
(&
cmd_r•
, 0, (cmd_rsp));

158 
	`©h9k_htc_ps_wakeup
(
¥iv
);

160 
	`WMI_CMD
(
WMI_RX_STATS_CMDID
);

161 i‡(
ªt
) {

162 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

163  -
EINVAL
;

166 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

168 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

170 
	`be32_to_˝u
(
cmd_r•
.
nobuf
));

172 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

174 
	`be32_to_˝u
(
cmd_r•
.
ho°_£nd
));

176 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

178 
	`be32_to_˝u
(
cmd_r•
.
ho°_d⁄e
));

180 i‡(
Àn
 > (
buf
))

181 
Àn
 = (
buf
);

183  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

184 
	}
}

186 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tgt_rx_°©s
 = {

187 .
ªad
 = 
ªad_fûe_tgt_rx_°©s
,

188 .
	g›í
 = 
sim∂e_›í
,

189 .
	gow√r
 = 
THIS_MODULE
,

190 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

193 
ssize_t
 
	$ªad_fûe_xmô
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

194 
size_t
 
cou¡
, 
loff_t
 *
µos
)

196 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

197 
buf
[512];

198 
Àn
 = 0;

200 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

202 
¥iv
->
debug
.
tx_°©s
.
buf_queued
);

203 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

205 
¥iv
->
debug
.
tx_°©s
.
buf_com∂ëed
);

206 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

208 
¥iv
->
debug
.
tx_°©s
.
skb_queued
);

209 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

211 
¥iv
->
debug
.
tx_°©s
.
skb_suc˚ss
);

212 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

214 
¥iv
->
debug
.
tx_°©s
.
skb_Áûed
);

215 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

217 
¥iv
->
debug
.
tx_°©s
.
ˇb_queued
);

219 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

221 
¥iv
->
debug
.
tx_°©s
.
queue_°©s
[
IEEE80211_AC_BE
]);

222 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

224 
¥iv
->
debug
.
tx_°©s
.
queue_°©s
[
IEEE80211_AC_BK
]);

225 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

227 
¥iv
->
debug
.
tx_°©s
.
queue_°©s
[
IEEE80211_AC_VI
]);

228 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

230 
¥iv
->
debug
.
tx_°©s
.
queue_°©s
[
IEEE80211_AC_VO
]);

232 i‡(
Àn
 > (
buf
))

233 
Àn
 = (
buf
);

235  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

236 
	}
}

238 c⁄° 
fûe_›î©i⁄s
 
	gf›s_xmô
 = {

239 .
ªad
 = 
ªad_fûe_xmô
,

240 .
	g›í
 = 
sim∂e_›í
,

241 .
	gow√r
 = 
THIS_MODULE
,

242 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

245 
	$©h9k_htc_îr_°©_rx
(
©h9k_htc_¥iv
 *
¥iv
,

246 
©h_rx_°©us
 *
rs
)

248 
	`©h9k_cmn_debug_°©_rx
(&
¥iv
->
debug
.
rx_°©s
, 
rs
);

249 
	}
}

251 
ssize_t
 
	$ªad_fûe_skb_rx
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

252 
size_t
 
cou¡
, 
loff_t
 *
µos
)

254 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

255 *
buf
;

256 
Àn
 = 0, 
size
 = 1500;

257 
ssize_t
 
ªtvÆ
 = 0;

259 
buf
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

260 i‡(
buf
 =
NULL
)

261  -
ENOMEM
;

263 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

265 
¥iv
->
debug
.
skbrx_°©s
.
skb_Æloˇãd
);

266 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

268 
¥iv
->
debug
.
skbrx_°©s
.
skb_com∂ëed
);

269 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen,

271 
¥iv
->
debug
.
skbrx_°©s
.
skb_dr›≥d
);

273 i‡(
Àn
 > 
size
)

274 
Àn
 = 
size
;

276 
ªtvÆ
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

277 
	`k‰ì
(
buf
);

279  
ªtvÆ
;

280 
	}
}

282 c⁄° 
fûe_›î©i⁄s
 
	gf›s_skb_rx
 = {

283 .
ªad
 = 
ªad_fûe_skb_rx
,

284 .
	g›í
 = 
sim∂e_›í
,

285 .
	gow√r
 = 
THIS_MODULE
,

286 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

289 
ssize_t
 
	$ªad_fûe_¶Ÿ
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

290 
size_t
 
cou¡
, 
loff_t
 *
µos
)

292 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

293 
buf
[512];

294 
Àn
;

296 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

297 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

300 
MAX_TX_BUF_NUM
, 
¥iv
->
tx
.
tx_¶Ÿ
,

301 
	`bôm≠_weight
(
¥iv
->
tx
.
tx_¶Ÿ
, 
MAX_TX_BUF_NUM
));

302 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

303  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

304 
	}
}

306 c⁄° 
fûe_›î©i⁄s
 
	gf›s_¶Ÿ
 = {

307 .
ªad
 = 
ªad_fûe_¶Ÿ
,

308 .
	g›í
 = 
sim∂e_›í
,

309 .
	gow√r
 = 
THIS_MODULE
,

310 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

313 
ssize_t
 
	$ªad_fûe_queue
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

314 
size_t
 
cou¡
, 
loff_t
 *
µos
)

316 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

317 
buf
[512];

318 
Àn
 = 0;

320 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

321 "Mgmàídpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
mgmt_ï_queue
));

323 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

324 "CabÉndpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
ˇb_ï_queue
));

326 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

327 "D©®BEÉndpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
d©a_be_queue
));

329 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

330 "D©®BKÉndpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
d©a_bk_queue
));

332 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

333 "D©®VIÉndpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
d©a_vi_queue
));

335 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

336 "D©®VOÉndpoöt", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
d©a_vo_queue
));

338 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

339 "Faûed queue", 
	`skb_queue_Àn
(&
¥iv
->
tx
.
tx_Áûed
));

341 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

342 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "%20s : %10u\n",

343 "Queued cou¡", 
¥iv
->
tx
.
queued_˙t
);

344 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

346 i‡(
Àn
 > (
buf
))

347 
Àn
 = (
buf
);

349  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

351 
	}
}

353 c⁄° 
fûe_›î©i⁄s
 
	gf›s_queue
 = {

354 .
ªad
 = 
ªad_fûe_queue
,

355 .
	g›í
 = 
sim∂e_›í
,

356 .
	gow√r
 = 
THIS_MODULE
,

357 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

360 
ssize_t
 
	$ªad_fûe_debug
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

361 
size_t
 
cou¡
, 
loff_t
 *
µos
)

363 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

364 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

365 
buf
[32];

366 
Àn
;

368 
Àn
 = 
	`•rötf
(
buf
, "0x%08x\n", 
comm⁄
->
debug_mask
);

369  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

370 
	}
}

372 
ssize_t
 
	$wrôe_fûe_debug
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

373 
size_t
 
cou¡
, 
loff_t
 *
µos
)

375 
©h9k_htc_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

376 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

377 
mask
;

378 
buf
[32];

379 
ssize_t
 
Àn
;

381 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

382 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

383  -
EFAULT
;

385 
buf
[
Àn
] = '\0';

386 i‡(
	`k°πoul
(
buf
, 0, &
mask
))

387  -
EINVAL
;

389 
comm⁄
->
debug_mask
 = 
mask
;

390  
cou¡
;

391 
	}
}

393 c⁄° 
fûe_›î©i⁄s
 
	gf›s_debug
 = {

394 .
ªad
 = 
ªad_fûe_debug
,

395 .
	gwrôe
 = 
wrôe_fûe_debug
,

396 .
	g›í
 = 
sim∂e_›í
,

397 .
	gow√r
 = 
THIS_MODULE
,

398 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

402 
	#AMKSTR
(
nm
Ë#nm "_BE", #nm "_BK", #nm "_VI", #nm "_VO"

	)

403 c⁄° 
	g©h9k_htc_g°rögs_°©s
[][
ETH_GSTRING_LEN
] = {

409 
AMKSTR
(
d_tx_pkts
),

424 
	#ATH9K_HTC_SSTATS_LEN
 
	`ARRAY_SIZE
(
©h9k_htc_g°rögs_°©s
)

	)

426 
	$©h9k_htc_gë_ë_°rögs
(
õì80211_hw
 *
hw
,

427 
õì80211_vif
 *
vif
,

428 
u32
 
s£t
, 
u8
 *
d©a
)

430 i‡(
s£t
 =
ETH_SS_STATS
)

431 
	`mem˝y
(
d©a
, *
©h9k_htc_g°rögs_°©s
,

432 (
©h9k_htc_g°rögs_°©s
));

433 
	}
}

435 
	$©h9k_htc_gë_ë_s£t_cou¡
(
õì80211_hw
 *
hw
,

436 
õì80211_vif
 *
vif
, 
s£t
)

438 i‡(
s£t
 =
ETH_SS_STATS
)

439  
ATH9K_HTC_SSTATS_LEN
;

441 
	}
}

443 
	#STXBASE
 
¥iv
->
debug
.
tx_°©s


	)

444 
	#SRXBASE
 
¥iv
->
debug
.
rx_°©s


	)

445 
	#SKBTXBASE
 
¥iv
->
debug
.
tx_°©s


	)

446 
	#SKBRXBASE
 
¥iv
->
debug
.
skbrx_°©s


	)

447 
	#ASTXQ
(
a
) \

448 
d©a
[
i
++] = 
STXBASE
.
a
[
IEEE80211_AC_BE
]; \

449 
d©a
[
i
++] = 
STXBASE
.
a
[
IEEE80211_AC_BK
]; \

450 
d©a
[
i
++] = 
STXBASE
.
a
[
IEEE80211_AC_VI
]; \

451 
d©a
[
i
++] = 
STXBASE
.
a
[
IEEE80211_AC_VO
]

	)

453 
	$©h9k_htc_gë_ë_°©s
(
õì80211_hw
 *
hw
,

454 
õì80211_vif
 *
vif
,

455 
ëhtoﬁ_°©s
 *
°©s
, 
u64
 *
d©a
)

457 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

458 
i
 = 0;

460 
d©a
[
i
++] = 
SKBTXBASE
.
skb_suc˚ss
;

461 
d©a
[
i
++] = 
SKBTXBASE
.
skb_suc˚ss_byãs
;

462 
d©a
[
i
++] = 
SKBRXBASE
.
skb_com∂ëed
;

463 
d©a
[
i
++] = 
SKBRXBASE
.
skb_com∂ëed_byãs
;

465 
	`ASTXQ
(
queue_°©s
);

467 
d©a
[
i
++] = 
SRXBASE
.
¸c_îr
;

468 
d©a
[
i
++] = 
SRXBASE
.
de¸y±_¸c_îr
;

469 
d©a
[
i
++] = 
SRXBASE
.
phy_îr
;

470 
d©a
[
i
++] = 
SRXBASE
.
mic_îr
;

471 
d©a
[
i
++] = 
SRXBASE
.
¥e_dñim_¸c_îr
;

472 
d©a
[
i
++] = 
SRXBASE
.
po°_dñim_¸c_îr
;

473 
d©a
[
i
++] = 
SRXBASE
.
de¸y±_busy_îr
;

475 
d©a
[
i
++] = 
SRXBASE
.
phy_îr_°©s
[
ATH9K_PHYERR_RADAR
];

476 
d©a
[
i
++] = 
SRXBASE
.
phy_îr_°©s
[
ATH9K_PHYERR_OFDM_TIMING
];

477 
d©a
[
i
++] = 
SRXBASE
.
phy_îr_°©s
[
ATH9K_PHYERR_CCK_TIMING
];

479 
	`WARN_ON
(
i
 !
ATH9K_HTC_SSTATS_LEN
);

480 
	}
}

482 
	$©h9k_htc_deöô_debug
(
©h9k_htc_¥iv
 *
¥iv
)

484 
	`©h9k_cmn_•e˘øl_deöô_debug
(&
¥iv
->
•ec_¥iv
);

485 
	}
}

487 
	$©h9k_htc_öô_debug
(
©h_hw
 *
ah
)

489 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

490 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

492 
¥iv
->
debug
.
debugfs_phy
 = 
	`debugfs_¸óã_dú
(
KBUILD_MODNAME
,

493 
¥iv
->
hw
->
wùhy
->
debugfsdú
);

494 i‡(!
¥iv
->
debug
.
debugfs_phy
)

495  -
ENOMEM
;

497 
	`©h9k_cmn_•e˘øl_öô_debug
(&
¥iv
->
•ec_¥iv
,Öriv->
debug
.
debugfs_phy
);

499 
	`debugfs_¸óã_fûe
("tgt_öt_°©s", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

500 
¥iv
, &
f›s_tgt_öt_°©s
);

501 
	`debugfs_¸óã_fûe
("tgt_tx_°©s", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

502 
¥iv
, &
f›s_tgt_tx_°©s
);

503 
	`debugfs_¸óã_fûe
("tgt_rx_°©s", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

504 
¥iv
, &
f›s_tgt_rx_°©s
);

505 
	`debugfs_¸óã_fûe
("xmô", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

506 
¥iv
, &
f›s_xmô
);

507 
	`debugfs_¸óã_fûe
("skb_rx", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

508 
¥iv
, &
f›s_skb_rx
);

510 
	`©h9k_cmn_debug_ªcv
(
¥iv
->
debug
.
debugfs_phy
, &¥iv->debug.
rx_°©s
);

511 
	`©h9k_cmn_debug_phy_îr
(
¥iv
->
debug
.
debugfs_phy
, &¥iv->debug.
rx_°©s
);

513 
	`debugfs_¸óã_fûe
("¶Ÿ", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

514 
¥iv
, &
f›s_¶Ÿ
);

515 
	`debugfs_¸óã_fûe
("queue", 
S_IRUSR
, 
¥iv
->
debug
.
debugfs_phy
,

516 
¥iv
, &
f›s_queue
);

517 
	`debugfs_¸óã_fûe
("debug", 
S_IRUSR
 | 
S_IWUSR
, 
¥iv
->
debug
.
debugfs_phy
,

518 
¥iv
, &
f›s_debug
);

520 
	`©h9k_cmn_debug_ba£_ì¥om
(
¥iv
->
debug
.
debugfs_phy
,Öriv->
ah
);

521 
	`©h9k_cmn_debug_modÆ_ì¥om
(
¥iv
->
debug
.
debugfs_phy
,Öriv->
ah
);

524 
	}
}

	@htc_drv_gpio.c

17 
	~"htc.h
"

23 
	#ATH_HTC_BTCOEX_PRODUCT_ID
 "wb193"

	)

25 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


30 
	$©h_dëe˘_bt_¥i‹ôy
(
©h9k_htc_¥iv
 *
¥iv
)

32 
©h_btc€x
 *
btc€x
 = &
¥iv
->btcoex;

33 
©h_hw
 *
ah
 = 
¥iv
->ah;

35 i‡(
	`©h9k_hw_gpio_gë
(
ah
,áh->
btc€x_hw
.
bçri‹ôy_gpio
))

36 
btc€x
->
bt_¥i‹ôy_˙t
++;

38 i‡(
	`time_a·î
(
jiffõs
, 
btc€x
->
bt_¥i‹ôy_time
 +

39 
	`m£cs_to_jiffõs
(
ATH_BT_PRIORITY_TIME_THRESHOLD
))) {

40 
	`˛ór_bô
(
OP_BT_PRIORITY_DETECTED
, &
¥iv
->
›_Êags
);

41 
	`˛ór_bô
(
OP_BT_SCAN
, &
¥iv
->
›_Êags
);

43 i‡(
btc€x
->
bt_¥i‹ôy_˙t
 >
ATH_BT_CNT_SCAN_THRESHOLD
) {

44 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
,

46 
	`£t_bô
(
OP_BT_PRIORITY_DETECTED
, &
¥iv
->
›_Êags
);

47 
	`£t_bô
(
OP_BT_SCAN
, &
¥iv
->
›_Êags
);

48 } i‡(
btc€x
->
bt_¥i‹ôy_˙t
 >
ATH_BT_CNT_THRESHOLD
) {

49 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
,

51 
	`£t_bô
(
OP_BT_PRIORITY_DETECTED
, &
¥iv
->
›_Êags
);

54 
btc€x
->
bt_¥i‹ôy_˙t
 = 0;

55 
btc€x
->
bt_¥i‹ôy_time
 = 
jiffõs
;

57 
	}
}

64 
	$©h_btc€x_≥riod_w‹k
(
w‹k_°ru˘
 *
w‹k
)

66 
©h9k_htc_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, ath9k_htc_priv,

67 
c€x_≥riod_w‹k
.
w‹k
);

68 
©h_btc€x
 *
btc€x
 = &
¥iv
->btcoex;

69 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

70 
u32
 
timî_≥riod
;

71 
ªt
;

73 
	`©h_dëe˘_bt_¥i‹ôy
(
¥iv
);

75 
ªt
 = 
	`©h9k_htc_upd©e_ˇp_èrgë
(
¥iv
,

76 
	`ã°_bô
(
OP_BT_PRIORITY_DETECTED
, &
¥iv
->
›_Êags
));

77 i‡(
ªt
) {

78 
	`©h_îr
(
comm⁄
, "UnableÅo set BTCOEXÖarameters\n");

82 
	`©h9k_hw_btc€x_bt_°omp
(
¥iv
->
ah
, 
	`ã°_bô
(
OP_BT_SCAN
, &¥iv->
›_Êags
) ?

83 
ATH_BTCOEX_STOMP_ALL
 : 
btc€x
->
bt_°omp_ty≥
);

85 
	`©h9k_hw_btc€x_íabÀ
(
¥iv
->
ah
);

86 
timî_≥riod
 = 
	`ã°_bô
(
OP_BT_SCAN
, &
¥iv
->
›_Êags
) ?

87 
btc€x
->
btsˇn_no_°omp
 : btc€x->
btc€x_no_°omp
;

88 
	`õì80211_queue_dñayed_w‹k
(
¥iv
->
hw
, &¥iv->
duty_cy˛e_w‹k
,

89 
	`m£cs_to_jiffõs
(
timî_≥riod
));

90 
	`õì80211_queue_dñayed_w‹k
(
¥iv
->
hw
, &¥iv->
c€x_≥riod_w‹k
,

91 
	`m£cs_to_jiffõs
(
btc€x
->
btc€x_≥riod
));

92 
	}
}

98 
	$©h_btc€x_duty_cy˛e_w‹k
(
w‹k_°ru˘
 *
w‹k
)

100 
©h9k_htc_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, ath9k_htc_priv,

101 
duty_cy˛e_w‹k
.
w‹k
);

102 
©h_hw
 *
ah
 = 
¥iv
->ah;

103 
©h_btc€x
 *
btc€x
 = &
¥iv
->btcoex;

104 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

106 
	`©h_dbg
(
comm⁄
, 
BTCOEX
, "time slice work for btánd wlan\n");

108 i‡(
btc€x
->
bt_°omp_ty≥
 =
ATH_BTCOEX_STOMP_LOW
 ||

109 
	`ã°_bô
(
OP_BT_SCAN
, &
¥iv
->
›_Êags
))

110 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
ATH_BTCOEX_STOMP_NONE
);

111 i‡(
btc€x
->
bt_°omp_ty≥
 =
ATH_BTCOEX_STOMP_ALL
)

112 
	`©h9k_hw_btc€x_bt_°omp
(
ah
, 
ATH_BTCOEX_STOMP_LOW
);

114 
	`©h9k_hw_btc€x_íabÀ
(
¥iv
->
ah
);

115 
	}
}

117 
	$©h_htc_öô_btc€x_w‹k
(
©h9k_htc_¥iv
 *
¥iv
)

119 
©h_btc€x
 *
btc€x
 = &
¥iv
->btcoex;

121 
btc€x
->
btc€x_≥riod
 = 
ATH_BTCOEX_DEF_BT_PERIOD
;

122 
btc€x
->
btc€x_no_°omp
 = (100 - 
ATH_BTCOEX_DEF_DUTY_CYCLE
) *

123 
btc€x
->
btc€x_≥riod
 / 100;

124 
btc€x
->
btsˇn_no_°omp
 = (100 - 
ATH_BTCOEX_BTSCAN_DUTY_CYCLE
) *

125 
btc€x
->
btc€x_≥riod
 / 100;

126 
	`INIT_DELAYED_WORK
(&
¥iv
->
c€x_≥riod_w‹k
, 
©h_btc€x_≥riod_w‹k
);

127 
	`INIT_DELAYED_WORK
(&
¥iv
->
duty_cy˛e_w‹k
, 
©h_btc€x_duty_cy˛e_w‹k
);

128 
	}
}

134 
	$©h_htc_ªsume_btc€x_w‹k
(
©h9k_htc_¥iv
 *
¥iv
)

136 
©h_btc€x
 *
btc€x
 = &
¥iv
->btcoex;

137 
©h_hw
 *
ah
 = 
¥iv
->ah;

139 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BTCOEX
, "Starting btcoex work\n");

141 
btc€x
->
bt_¥i‹ôy_˙t
 = 0;

142 
btc€x
->
bt_¥i‹ôy_time
 = 
jiffõs
;

143 
	`˛ór_bô
(
OP_BT_PRIORITY_DETECTED
, &
¥iv
->
›_Êags
);

144 
	`˛ór_bô
(
OP_BT_SCAN
, &
¥iv
->
›_Êags
);

145 
	`õì80211_queue_dñayed_w‹k
(
¥iv
->
hw
, &¥iv->
c€x_≥riod_w‹k
, 0);

146 
	}
}

152 
	$©h_htc_ˇn˚l_btc€x_w‹k
(
©h9k_htc_¥iv
 *
¥iv
)

154 
	`ˇn˚l_dñayed_w‹k_sync
(&
¥iv
->
c€x_≥riod_w‹k
);

155 
	`ˇn˚l_dñayed_w‹k_sync
(&
¥iv
->
duty_cy˛e_w‹k
);

156 
	}
}

158 
	$©h9k_htc_°¨t_btc€x
(
©h9k_htc_¥iv
 *
¥iv
)

160 
©h_hw
 *
ah
 = 
¥iv
->ah;

162 i‡(
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë=
ATH_BTCOEX_CFG_3WIRE
) {

163 
	`©h9k_hw_btc€x_£t_weight
(
ah
, 
AR_BT_COEX_WGHT
,

164 
AR_STOMP_LOW_WLAN_WGHT
, 0);

165 
	`©h9k_hw_btc€x_íabÀ
(
ah
);

166 
	`©h_htc_ªsume_btc€x_w‹k
(
¥iv
);

168 
	}
}

170 
	$©h9k_htc_°›_btc€x
(
©h9k_htc_¥iv
 *
¥iv
)

172 
©h_hw
 *
ah
 = 
¥iv
->ah;

174 i‡(
ah
->
btc€x_hw
.
íabÀd
 &&

175 
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_NONE
) {

176 i‡(
ah
->
btc€x_hw
.
scheme
 =
ATH_BTCOEX_CFG_3WIRE
)

177 
	`©h_htc_ˇn˚l_btc€x_w‹k
(
¥iv
);

178 
	`©h9k_hw_btc€x_dißbÀ
(
ah
);

180 
	}
}

182 
	$©h9k_htc_öô_btc€x
(
©h9k_htc_¥iv
 *
¥iv
, *
¥odu˘
)

184 
©h_hw
 *
ah
 = 
¥iv
->ah;

185 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

186 
qnum
;

191 i‡(!
comm⁄
->
btc€x_íabÀd
) {

192 
ah
->
btc€x_hw
.
scheme
 = 
ATH_BTCOEX_CFG_NONE
;

196 i‡(
¥odu˘
 && 
	`°∫cmp
’rodu˘, 
ATH_HTC_BTCOEX_PRODUCT_ID
, 5) == 0) {

197 
ah
->
btc€x_hw
.
scheme
 = 
ATH_BTCOEX_CFG_3WIRE
;

200 
	`©h9k_hw_gë_btc€x_scheme
(
¥iv
->
ah
)) {

201 
ATH_BTCOEX_CFG_NONE
:

203 
ATH_BTCOEX_CFG_3WIRE
:

204 
¥iv
->
ah
->
btc€x_hw
.
bè˘ive_gpio
 = 7;

205 
¥iv
->
ah
->
btc€x_hw
.
bçri‹ôy_gpio
 = 6;

206 
¥iv
->
ah
->
btc€x_hw
.
wœ«˘ive_gpio
 = 8;

207 
¥iv
->
btc€x
.
bt_°omp_ty≥
 = 
ATH_BTCOEX_STOMP_LOW
;

208 
	`©h9k_hw_btc€x_öô_3wúe
(
¥iv
->
ah
);

209 
	`©h_htc_öô_btc€x_w‹k
(
¥iv
);

210 
qnum
 = 
¥iv
->
hwq_m≠
[
IEEE80211_AC_BE
];

211 
	`©h9k_hw_öô_btc€x_hw
(
¥iv
->
ah
, 
qnum
);

214 
	`WARN_ON
(1);

217 
	}
}

225 #ifde‡
CPTCFG_MAC80211_LEDS


226 
	$©h9k_Àd_w‹k
(
w‹k_°ru˘
 *
w‹k
)

228 
©h9k_htc_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
,

229 
©h9k_htc_¥iv
,

230 
Àd_w‹k
);

232 
	`©h9k_hw_£t_gpio
(
¥iv
->
ah
,Öriv->ah->
Àd_pö
,

233 (
¥iv
->
brighäess
 =
LED_OFF
));

234 
	}
}

236 
	$©h9k_Àd_brighäess
(
Àd_˛assdev
 *
Àd_cdev
,

237 
Àd_brighäess
 
brighäess
)

239 
©h9k_htc_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
Àd_cdev
,

240 
©h9k_htc_¥iv
,

241 
Àd_cdev
);

244 
¥iv
->
brighäess
 = brightness;

245 
	`õì80211_queue_w‹k
(
¥iv
->
hw
, &¥iv->
Àd_w‹k
);

246 
	}
}

248 
	$©h9k_deöô_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

250 i‡(!
¥iv
->
Àd_ªgi°îed
)

253 
	`©h9k_Àd_brighäess
(&
¥iv
->
Àd_cdev
, 
LED_OFF
);

254 
	`Àd_˛assdev_uƒegi°î
(&
¥iv
->
Àd_cdev
);

255 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
Àd_w‹k
);

256 
	}
}

259 
	$©h9k_c⁄figuª_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

262 
	`©h9k_hw_cfg_ouçut
(
¥iv
->
ah
,Öriv->ah->
Àd_pö
,

263 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

265 
	`©h9k_hw_£t_gpio
(
¥iv
->
ah
,Öriv->ah->
Àd_pö
, 1);

267 
	}
}

269 
	$©h9k_öô_Àds
(
©h9k_htc_¥iv
 *
¥iv
)

271 
ªt
;

273 i‡(
	`AR_SREV_9287
(
¥iv
->
ah
))

274 
¥iv
->
ah
->
Àd_pö
 = 
ATH_LED_PIN_9287
;

275 i‡(
	`AR_SREV_9271
(
¥iv
->
ah
))

276 
¥iv
->
ah
->
Àd_pö
 = 
ATH_LED_PIN_9271
;

277 i‡(
	`AR_DEVID_7010
(
¥iv
->
ah
))

278 
¥iv
->
ah
->
Àd_pö
 = 
ATH_LED_PIN_7010
;

280 
¥iv
->
ah
->
Àd_pö
 = 
ATH_LED_PIN_DEF
;

282 i‡(!
©h9k_htc_Àd_blök
)

283 
¥iv
->
Àd_cdev
.
deÁu…_åiggî
 =

284 
	`õì80211_gë_ødio_Àd_«me
(
¥iv
->
hw
);

286 
	`©h9k_c⁄figuª_Àds
(
¥iv
);

288 
	`¢¥ötf
(
¥iv
->
Àd_«me
, (priv->led_name),

289 "©h9k_htc-%s", 
	`wùhy_«me
(
¥iv
->
hw
->
wùhy
));

290 
¥iv
->
Àd_cdev
.
«me
 =Öriv->
Àd_«me
;

291 
¥iv
->
Àd_cdev
.
brighäess_£t
 = 
©h9k_Àd_brighäess
;

293 
ªt
 = 
	`Àd_˛assdev_ªgi°î
(
	`wùhy_dev
(
¥iv
->
hw
->
wùhy
), &¥iv->
Àd_cdev
);

294 i‡(
ªt
 < 0)

297 
	`INIT_WORK
(&
¥iv
->
Àd_w‹k
, 
©h9k_Àd_w‹k
);

298 
¥iv
->
Àd_ªgi°îed
 = 
åue
;

301 
	}
}

308 
boﬁ
 
	$©h_is_rfkûl_£t
(
©h9k_htc_¥iv
 *
¥iv
)

310 
boﬁ
 
is_blocked
;

312 
	`©h9k_htc_ps_wakeup
(
¥iv
);

313 
is_blocked
 = 
	`©h9k_hw_gpio_gë
(
¥iv
->
ah
,Öriv->ah->
rfkûl_gpio
) ==

314 
¥iv
->
ah
->
rfkûl_pﬁ¨ôy
;

315 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

317  
is_blocked
;

318 
	}
}

320 
	$©h9k_htc_rfkûl_pﬁl_°©e
(
õì80211_hw
 *
hw
)

322 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

323 
boﬁ
 
blocked
 = !!
	`©h_is_rfkûl_£t
(
¥iv
);

325 
	`wùhy_rfkûl_£t_hw_°©e
(
hw
->
wùhy
, 
blocked
);

326 
	}
}

328 
	$©h9k_°¨t_rfkûl_pﬁl
(
©h9k_htc_¥iv
 *
¥iv
)

330 i‡(
¥iv
->
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RFSILENT
)

331 
	`wùhy_rfkûl_°¨t_pﬁlög
(
¥iv
->
hw
->
wùhy
);

332 
	}
}

	@htc_drv_init.c

17 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

19 
	~"htc.h
"

21 
MODULE_AUTHOR
("Atheros Communications");

22 
MODULE_LICENSE
("Dual BSD/GPL");

23 
MODULE_DESCRIPTION
("Atheros driver 802.11n HTC based wireless devices");

25 
	g©h9k_debug
 = 
ATH_DBG_DEFAULT
;

26 
moduÀ_∑øm_«med
(
debug
, 
©h9k_debug
, 
uöt
, 0);

27 
MODULE_PARM_DESC
(
debug
, "Debugging mask");

29 
	ghtc_mod∑øm_nohw¸y±
;

30 
moduÀ_∑øm_«med
(
nohw¸y±
, 
htc_mod∑øm_nohw¸y±
, , 0444);

31 
MODULE_PARM_DESC
(
nohw¸y±
, "Disable hardwareÉncryption");

33 
	g©h9k_htc_btc€x_íabÀ
;

34 
moduÀ_∑øm_«med
(
btc€x_íabÀ
, 
©h9k_htc_btc€x_íabÀ
, , 0444);

35 
MODULE_PARM_DESC
(
btc€x_íabÀ
, "Enable wifi-BT coexistence");

37 
	g©h9k_ps_íabÀ
;

38 
moduÀ_∑øm_«med
(
ps_íabÀ
, 
©h9k_ps_íabÀ
, , 0444);

39 
MODULE_PARM_DESC
(
ps_íabÀ
, "Enable WLAN PowerSave");

41 
	ghtc_u£_dev_fw
 = 0;

42 
moduÀ_∑øm_«med
(
u£_dev_fw
, 
htc_u£_dev_fw
, , 0444);

43 
MODULE_PARM_DESC
(
u£_dev_fw
, "Use development FW version");

45 #ifde‡
CPTCFG_MAC80211_LEDS


46 
	g©h9k_htc_Àd_blök
 = 1;

47 
moduÀ_∑øm_«med
(
blök
, 
©h9k_htc_Àd_blök
, , 0444);

48 
MODULE_PARM_DESC
(
blök
, "Enable LED blink onáctivity");

50 c⁄° 
õì80211_çt_blök
 
	g©h9k_htc_çt_blök
[] = {

51 { .
throughput
 = 0 * 1024, .
	gblök_time
 = 334 },

52 { .
	gthroughput
 = 1 * 1024, .
	gblök_time
 = 260 },

53 { .
	gthroughput
 = 5 * 1024, .
	gblök_time
 = 220 },

54 { .
	gthroughput
 = 10 * 1024, .
	gblök_time
 = 190 },

55 { .
	gthroughput
 = 20 * 1024, .
	gblök_time
 = 170 },

56 { .
	gthroughput
 = 50 * 1024, .
	gblök_time
 = 150 },

57 { .
	gthroughput
 = 70 * 1024, .
	gblök_time
 = 130 },

58 { .
	gthroughput
 = 100 * 1024, .
	gblök_time
 = 110 },

59 { .
	gthroughput
 = 200 * 1024, .
	gblök_time
 = 80 },

60 { .
	gthroughput
 = 300 * 1024, .
	gblök_time
 = 50 },

64 
	$©h9k_htc_›_ps_wakeup
(
©h_comm⁄
 *
comm⁄
)

66 
	`©h9k_htc_ps_wakeup
((
©h9k_htc_¥iv
 *Ë
comm⁄
->
¥iv
);

67 
	}
}

69 
	$©h9k_htc_›_ps_ª°‹e
(
©h_comm⁄
 *
comm⁄
)

71 
	`©h9k_htc_ps_ª°‹e
((
©h9k_htc_¥iv
 *Ë
comm⁄
->
¥iv
);

72 
	}
}

74 
©h_ps_›s
 
	g©h9k_htc_ps_›s
 = {

75 .
wakeup
 = 
©h9k_htc_›_ps_wakeup
,

76 .
	gª°‹e
 = 
©h9k_htc_›_ps_ª°‹e
,

79 
	$©h9k_htc_waô_f‹_èrgë
(
©h9k_htc_¥iv
 *
¥iv
)

81 
time_À·
;

83 i‡(
	`©omic_ªad
(&
¥iv
->
htc
->
tgt_ªady
) > 0) {

84 
	`©omic_dec
(&
¥iv
->
htc
->
tgt_ªady
);

89 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
¥iv
->
htc
->
èrgë_waô
, 
HZ
);

90 i‡(!
time_À·
) {

91 
	`dev_îr
(
¥iv
->
dev
, "ath9k_htc: Target is unresponsive\n");

92  -
ETIMEDOUT
;

95 
	`©omic_dec
(&
¥iv
->
htc
->
tgt_ªady
);

98 
	}
}

100 
	$©h9k_deöô_¥iv
(
©h9k_htc_¥iv
 *
¥iv
)

102 
	`©h9k_hw_deöô
(
¥iv
->
ah
);

103 
	`k‰ì
(
¥iv
->
ah
);

104 
¥iv
->
ah
 = 
NULL
;

105 
	}
}

107 
	$©h9k_deöô_devi˚
(
©h9k_htc_¥iv
 *
¥iv
)

109 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

111 
	`wùhy_rfkûl_°›_pﬁlög
(
hw
->
wùhy
);

112 
	`©h9k_deöô_Àds
(
¥iv
);

113 
	`©h9k_htc_deöô_debug
(
¥iv
);

114 
	`õì80211_uƒegi°î_hw
(
hw
);

115 
	`©h9k_rx_˛ónup
(
¥iv
);

116 
	`©h9k_tx_˛ónup
(
¥iv
);

117 
	`©h9k_deöô_¥iv
(
¥iv
);

118 
	}
}

120 
ölöe
 
	$©h9k_htc_c⁄√˘_svc
(
©h9k_htc_¥iv
 *
¥iv
,

121 
u16
 
£rvi˚_id
,

122 (*
tx
) (*,

123 
sk_buff
 *,

124 
htc_ídpoöt_id
,

125 
boﬁ
 
txok
),

126 
htc_ídpoöt_id
 *
ï_id
)

128 
htc_£rvi˚_c⁄ƒeq
 
ªq
;

130 
	`mem£t
(&
ªq
, 0, (
htc_£rvi˚_c⁄ƒeq
));

132 
ªq
.
£rvi˚_id
 = service_id;

133 
ªq
.
ï_ˇŒbacks
.
¥iv
 =Öriv;

134 
ªq
.
ï_ˇŒbacks
.
rx
 = 
©h9k_htc_rxï
;

135 
ªq
.
ï_ˇŒbacks
.
tx
 =Åx;

137  
	`htc_c⁄√˘_£rvi˚
(
¥iv
->
htc
, &
ªq
, 
ï_id
);

138 
	}
}

140 
	$©h9k_öô_htc_£rvi˚s
(
©h9k_htc_¥iv
 *
¥iv
, 
u16
 
devid
,

141 
u32
 
drv_öfo
)

143 
ªt
;

146 
ªt
 = 
	`©h9k_wmi_c⁄√˘
(
¥iv
->
htc
,Öriv->
wmi
, &¥iv->
wmi_cmd_ï
);

147 i‡(
ªt
)

148 
îr
;

151 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_BEACON_SVC
, 
©h9k_htc_bóc⁄ï
,

152 &
¥iv
->
bóc⁄_ï
);

153 i‡(
ªt
)

154 
îr
;

157 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_CAB_SVC
, 
©h9k_htc_txï
,

158 &
¥iv
->
ˇb_ï
);

159 i‡(
ªt
)

160 
îr
;

164 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_UAPSD_SVC
, 
©h9k_htc_txï
,

165 &
¥iv
->
u≠sd_ï
);

166 i‡(
ªt
)

167 
îr
;

170 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_MGMT_SVC
, 
©h9k_htc_txï
,

171 &
¥iv
->
mgmt_ï
);

172 i‡(
ªt
)

173 
îr
;

176 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_DATA_BE_SVC
, 
©h9k_htc_txï
,

177 &
¥iv
->
d©a_be_ï
);

178 i‡(
ªt
)

179 
îr
;

182 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_DATA_BK_SVC
, 
©h9k_htc_txï
,

183 &
¥iv
->
d©a_bk_ï
);

184 i‡(
ªt
)

185 
îr
;

188 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_DATA_VI_SVC
, 
©h9k_htc_txï
,

189 &
¥iv
->
d©a_vi_ï
);

190 i‡(
ªt
)

191 
îr
;

194 
ªt
 = 
	`©h9k_htc_c⁄√˘_svc
(
¥iv
, 
WMI_DATA_VO_SVC
, 
©h9k_htc_txï
,

195 &
¥iv
->
d©a_vo_ï
);

196 i‡(
ªt
)

197 
îr
;

205 i‡(
	`IS_AR7010_DEVICE
(
drv_öfo
))

206 
¥iv
->
htc
->
¸edôs
 = 45;

208 
¥iv
->
htc
->
¸edôs
 = 33;

210 
ªt
 = 
	`htc_öô
(
¥iv
->
htc
);

211 i‡(
ªt
)

212 
îr
;

214 
	`dev_öfo
(
¥iv
->
dev
, "ath9k_htc: HTC initialized with %d credits\n",

215 
¥iv
->
htc
->
¸edôs
);

219 
îr
:

220 
	`dev_îr
(
¥iv
->
dev
, "ath9k_htc: UnableÅo initialize HTC services\n");

221  
ªt
;

222 
	}
}

224 
	$©h9k_ªg_nŸifõr
(
wùhy
 *wiphy,

225 
ªguœt‹y_ªque°
 *
ªque°
)

227 
õì80211_hw
 *
hw
 = 
	`wùhy_to_õì80211_hw
(
wùhy
);

228 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

230 
	`©h_ªg_nŸifõr_≠∂y
(
wùhy
, 
ªque°
,

231 
	`©h9k_hw_ªguœt‹y
(
¥iv
->
ah
));

232 
	}
}

234 
	$©h9k_ªgªad
(*
hw_¥iv
, 
u32
 
ªg_off£t
)

236 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

237 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

238 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

239 
__be32
 
vÆ
, 
ªg
 = 
	`˝u_to_be32
(
ªg_off£t
);

240 
r
;

242 
r
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_READ_CMDID
,

243 (
u8
 *Ë&
ªg
, (reg),

244 (
u8
 *Ë&
vÆ
, (val),

246 i‡(
	`u∆ikñy
(
r
)) {

247 
	`©h_dbg
(
comm⁄
, 
WMI
, "REGISTER READ FAILED: (0x%04x, %d)\n",

248 
ªg_off£t
, 
r
);

249  -
EIO
;

252  
	`be32_to_˝u
(
vÆ
);

253 
	}
}

255 
	$©h9k_mu…i_ªgªad
(*
hw_¥iv
, 
u32
 *
addr
,

256 
u32
 *
vÆ
, 
u16
 
cou¡
)

258 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

259 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

260 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

261 
__be32
 
tm∑ddr
[8];

262 
__be32
 
tmpvÆ
[8];

263 
i
, 
ªt
;

265 
i
 = 0; i < 
cou¡
; i++) {

266 
tm∑ddr
[
i
] = 
	`˝u_to_be32
(
addr
[i]);

269 
ªt
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_READ_CMDID
,

270 (
u8
 *)
tm∑ddr
 , (
u32
Ë* 
cou¡
,

271 (
u8
 *)
tmpvÆ
, (
u32
Ë* 
cou¡
,

273 i‡(
	`u∆ikñy
(
ªt
)) {

274 
	`©h_dbg
(
comm⁄
, 
WMI
,

275 "Mu…ùÀ REGISTER READ FAILED (cou¡: %d)\n", 
cou¡
);

278 
i
 = 0; i < 
cou¡
; i++) {

279 
vÆ
[
i
] = 
	`be32_to_˝u
(
tmpvÆ
[i]);

281 
	}
}

283 
	$©h9k_ªgwrôe_mu…i
(
©h_comm⁄
 *
comm⁄
)

285 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

286 
u32
 
r•_°©us
;

287 
r
;

289 
r
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_WRITE_CMDID
,

290 (
u8
 *Ë&
¥iv
->
wmi
->
mu…i_wrôe
,

291 (
ªgi°î_wrôe
Ë* 
¥iv
->
wmi
->
mu…i_wrôe_idx
,

292 (
u8
 *Ë&
r•_°©us
, (rsp_status),

294 i‡(
	`u∆ikñy
(
r
)) {

295 
	`©h_dbg
(
comm⁄
, 
WMI
,

297 
¥iv
->
wmi
->
mu…i_wrôe_idx
);

299 
¥iv
->
wmi
->
mu…i_wrôe_idx
 = 0;

300 
	}
}

302 
	$©h9k_ªgwrôe_sögÀ
(*
hw_¥iv
, 
u32
 
vÆ
, u32 
ªg_off£t
)

304 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

305 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

306 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

307 c⁄° 
__be32
 
buf
[2] = {

308 
	`˝u_to_be32
(
ªg_off£t
),

309 
	`˝u_to_be32
(
vÆ
),

311 
r
;

313 
r
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_WRITE_CMDID
,

314 (
u8
 *Ë&
buf
, (buf),

315 (
u8
 *Ë&
vÆ
, (val),

317 i‡(
	`u∆ikñy
(
r
)) {

318 
	`©h_dbg
(
comm⁄
, 
WMI
, "REGISTER WRITE FAILED:(0x%04x, %d)\n",

319 
ªg_off£t
, 
r
);

321 
	}
}

323 
	$©h9k_ªgwrôe_buf„r
(*
hw_¥iv
, 
u32
 
vÆ
, u32 
ªg_off£t
)

325 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

326 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

327 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

329 
	`muãx_lock
(&
¥iv
->
wmi
->
mu…i_wrôe_muãx
);

332 
¥iv
->
wmi
->
mu…i_wrôe
[¥iv->wmi->
mu…i_wrôe_idx
].
ªg
 =

333 
	`˝u_to_be32
(
ªg_off£t
);

334 
¥iv
->
wmi
->
mu…i_wrôe
[¥iv->wmi->
mu…i_wrôe_idx
].
vÆ
 =

335 
	`˝u_to_be32
(
vÆ
);

337 
¥iv
->
wmi
->
mu…i_wrôe_idx
++;

340 i‡(
¥iv
->
wmi
->
mu…i_wrôe_idx
 =
MAX_CMD_NUMBER
)

341 
	`©h9k_ªgwrôe_mu…i
(
comm⁄
);

343 
	`muãx_u∆ock
(&
¥iv
->
wmi
->
mu…i_wrôe_muãx
);

344 
	}
}

346 
	$©h9k_ªgwrôe
(*
hw_¥iv
, 
u32
 
vÆ
, u32 
ªg_off£t
)

348 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

349 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

350 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

352 i‡(
	`©omic_ªad
(&
¥iv
->
wmi
->
mwrôe_˙t
))

353 
	`©h9k_ªgwrôe_buf„r
(
hw_¥iv
, 
vÆ
, 
ªg_off£t
);

355 
	`©h9k_ªgwrôe_sögÀ
(
hw_¥iv
, 
vÆ
, 
ªg_off£t
);

356 
	}
}

358 
	$©h9k_íabÀ_ªgwrôe_buf„r
(*
hw_¥iv
)

360 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

361 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

362 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

364 
	`©omic_öc
(&
¥iv
->
wmi
->
mwrôe_˙t
);

365 
	}
}

367 
	$©h9k_ªgwrôe_Êush
(*
hw_¥iv
)

369 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

370 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

371 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

373 
	`©omic_dec
(&
¥iv
->
wmi
->
mwrôe_˙t
);

375 
	`muãx_lock
(&
¥iv
->
wmi
->
mu…i_wrôe_muãx
);

377 i‡(
¥iv
->
wmi
->
mu…i_wrôe_idx
)

378 
	`©h9k_ªgwrôe_mu…i
(
comm⁄
);

380 
	`muãx_u∆ock
(&
¥iv
->
wmi
->
mu…i_wrôe_muãx
);

381 
	}
}

383 
	$©h9k_ªg_rmw_buf„r
(*
hw_¥iv
,

384 
u32
 
ªg_off£t
, u32 
£t
, u32 
˛r
)

386 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

387 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

388 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

389 
u32
 
r•_°©us
;

390 
r
;

392 
	`muãx_lock
(&
¥iv
->
wmi
->
mu…i_rmw_muãx
);

395 
¥iv
->
wmi
->
mu…i_rmw
[¥iv->wmi->
mu…i_rmw_idx
].
ªg
 =

396 
	`˝u_to_be32
(
ªg_off£t
);

397 
¥iv
->
wmi
->
mu…i_rmw
[¥iv->wmi->
mu…i_rmw_idx
].
£t
 =

398 
	`˝u_to_be32
(
£t
);

399 
¥iv
->
wmi
->
mu…i_rmw
[¥iv->wmi->
mu…i_rmw_idx
].
˛r
 =

400 
	`˝u_to_be32
(
˛r
);

402 
¥iv
->
wmi
->
mu…i_rmw_idx
++;

405 i‡(
¥iv
->
wmi
->
mu…i_rmw_idx
 =
MAX_RMW_CMD_NUMBER
) {

406 
r
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_RMW_CMDID
,

407 (
u8
 *Ë&
¥iv
->
wmi
->
mu…i_rmw
,

408 (
ªgi°î_wrôe
Ë* 
¥iv
->
wmi
->
mu…i_rmw_idx
,

409 (
u8
 *Ë&
r•_°©us
, (rsp_status),

411 i‡(
	`u∆ikñy
(
r
)) {

412 
	`©h_dbg
(
comm⁄
, 
WMI
,

414 
¥iv
->
wmi
->
mu…i_rmw_idx
);

416 
¥iv
->
wmi
->
mu…i_rmw_idx
 = 0;

419 
	`muãx_u∆ock
(&
¥iv
->
wmi
->
mu…i_rmw_muãx
);

420 
	}
}

422 
	$©h9k_ªg_rmw_Êush
(*
hw_¥iv
)

424 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

425 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

426 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

427 
u32
 
r•_°©us
;

428 
r
;

430 i‡(
	`ã°_bô
(
HTC_FWFLAG_NO_RMW
, &
¥iv
->
fw_Êags
))

433 
	`©omic_dec
(&
¥iv
->
wmi
->
m_rmw_˙t
);

435 
	`muãx_lock
(&
¥iv
->
wmi
->
mu…i_rmw_muãx
);

437 i‡(
¥iv
->
wmi
->
mu…i_rmw_idx
) {

438 
r
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_RMW_CMDID
,

439 (
u8
 *Ë&
¥iv
->
wmi
->
mu…i_rmw
,

440 (
ªgi°î_rmw
Ë* 
¥iv
->
wmi
->
mu…i_rmw_idx
,

441 (
u8
 *Ë&
r•_°©us
, (rsp_status),

443 i‡(
	`u∆ikñy
(
r
)) {

444 
	`©h_dbg
(
comm⁄
, 
WMI
,

446 
¥iv
->
wmi
->
mu…i_rmw_idx
);

448 
¥iv
->
wmi
->
mu…i_rmw_idx
 = 0;

451 
	`muãx_u∆ock
(&
¥iv
->
wmi
->
mu…i_rmw_muãx
);

452 
	}
}

454 
	$©h9k_íabÀ_rmw_buf„r
(*
hw_¥iv
)

456 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

457 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

458 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

460 i‡(
	`ã°_bô
(
HTC_FWFLAG_NO_RMW
, &
¥iv
->
fw_Êags
))

463 
	`©omic_öc
(&
¥iv
->
wmi
->
m_rmw_˙t
);

464 
	}
}

466 
u32
 
	$©h9k_ªg_rmw_sögÀ
(*
hw_¥iv
,

467 
u32
 
ªg_off£t
, u32 
£t
, u32 
˛r
)

469 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

470 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

471 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

472 
ªgi°î_rmw
 
buf
, 
buf_ªt
;

473 
ªt
;

474 
u32
 
vÆ
 = 0;

476 
buf
.
ªg
 = 
	`˝u_to_be32
(
ªg_off£t
);

477 
buf
.
£t
 = 
	`˝u_to_be32
(set);

478 
buf
.
˛r
 = 
	`˝u_to_be32
(clr);

480 
ªt
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
WMI_REG_RMW_CMDID
,

481 (
u8
 *Ë&
buf
, (buf),

482 (
u8
 *Ë&
buf_ªt
, (buf_ret),

484 i‡(
	`u∆ikñy
(
ªt
)) {

485 
	`©h_dbg
(
comm⁄
, 
WMI
, "REGISTER RMW FAILED:(0x%04x, %d)\n",

486 
ªg_off£t
, 
ªt
);

488  
vÆ
;

489 
	}
}

491 
u32
 
	$©h9k_ªg_rmw
(*
hw_¥iv
, 
u32
 
ªg_off£t
, u32 
£t
, u32 
˛r
)

493 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

494 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

495 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
comm⁄
->priv;

497 i‡(
	`ã°_bô
(
HTC_FWFLAG_NO_RMW
, &
¥iv
->
fw_Êags
)) {

498 
u32
 
vÆ
;

500 
vÆ
 = 
	`REG_READ
(
ah
, 
ªg_off£t
);

501 
vÆ
 &~
˛r
;

502 
vÆ
 |
£t
;

503 
	`REG_WRITE
(
ah
, 
ªg_off£t
, 
vÆ
);

508 i‡(
	`©omic_ªad
(&
¥iv
->
wmi
->
m_rmw_˙t
))

509 
	`©h9k_ªg_rmw_buf„r
(
hw_¥iv
, 
ªg_off£t
, 
£t
, 
˛r
);

511 
	`©h9k_ªg_rmw_sögÀ
(
hw_¥iv
, 
ªg_off£t
, 
£t
, 
˛r
);

514 
	}
}

516 
	$©h_usb_ªad_ˇchesize
(
©h_comm⁄
 *
comm⁄
, *
csz
)

518 *
csz
 = 
L1_CACHE_BYTES
 >> 2;

519 
	}
}

521 
boﬁ
 
	$©h_usb_ì¥om_ªad
(
©h_comm⁄
 *
comm⁄
, 
u32
 
off
, 
u16
 *
d©a
)

523 
©h_hw
 *
ah
 = (©h_hw *Ë
comm⁄
->ah;

525 ()
	`REG_READ
(
ah
, 
AR5416_EEPROM_OFFSET
 + (
off
 << 
AR5416_EEPROM_S
));

527 i‡(!
	`©h9k_hw_waô
(
ah
,

528 
AR_EEPROM_STATUS_DATA
,

529 
AR_EEPROM_STATUS_DATA_BUSY
 |

530 
AR_EEPROM_STATUS_DATA_PROT_ACCESS
, 0,

531 
AH_WAIT_TIMEOUT
))

532  
Ál£
;

534 *
d©a
 = 
	`MS
(
	`REG_READ
(
ah
, 
AR_EEPROM_STATUS_DATA
),

535 
AR_EEPROM_STATUS_DATA_VAL
);

537  
åue
;

538 
	}
}

540 c⁄° 
©h_bus_›s
 
	g©h9k_usb_bus_›s
 = {

541 .
©h_bus_ty≥
 = 
ATH_USB
,

542 .
	gªad_ˇchesize
 = 
©h_usb_ªad_ˇchesize
,

543 .
	gì¥om_ªad
 = 
©h_usb_ì¥om_ªad
,

546 
	$©h9k_öô_queues
(
©h9k_htc_¥iv
 *
¥iv
)

548 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

549 
i
;

551 
i
 = 0; i < 
	`ARRAY_SIZE
(
¥iv
->
hwq_m≠
); i++)

552 
¥iv
->
hwq_m≠
[
i
] = -1;

554 
¥iv
->
bóc⁄
.
bóc⁄q
 = 
	`©h9k_hw_bóc⁄q_£tup
’riv->
ah
);

555 i‡(
¥iv
->
bóc⁄
.
bóc⁄q
 == -1) {

556 
	`©h_îr
(
comm⁄
, "UnableÅo setup BEACON xmit queue\n");

557 
îr
;

560 
¥iv
->
ˇbq
 = 
	`©h9k_htc_ˇbq_£tup
(priv);

561 i‡(
¥iv
->
ˇbq
 == -1) {

562 
	`©h_îr
(
comm⁄
, "UnableÅo setup CAB xmit queue\n");

563 
îr
;

566 i‡(!
	`©h9k_htc_txq_£tup
(
¥iv
, 
IEEE80211_AC_BE
)) {

567 
	`©h_îr
(
comm⁄
, "UnableÅo setup xmit queue for BEÅraffic\n");

568 
îr
;

571 i‡(!
	`©h9k_htc_txq_£tup
(
¥iv
, 
IEEE80211_AC_BK
)) {

572 
	`©h_îr
(
comm⁄
, "UnableÅo setup xmit queue for BKÅraffic\n");

573 
îr
;

575 i‡(!
	`©h9k_htc_txq_£tup
(
¥iv
, 
IEEE80211_AC_VI
)) {

576 
	`©h_îr
(
comm⁄
, "UnableÅo setup xmit queue for VIÅraffic\n");

577 
îr
;

579 i‡(!
	`©h9k_htc_txq_£tup
(
¥iv
, 
IEEE80211_AC_VO
)) {

580 
	`©h_îr
(
comm⁄
, "UnableÅo setup xmit queue for VOÅraffic\n");

581 
îr
;

586 
îr
:

587  -
EINVAL
;

588 
	}
}

590 
	$©h9k_öô_misc
(
©h9k_htc_¥iv
 *
¥iv
)

592 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

594 
	`mem˝y
(
comm⁄
->
bssidmask
, 
©h_bˇ°_mac
, 
ETH_ALEN
);

596 
comm⁄
->
œ°_rssi
 = 
ATH_RSSI_DUMMY_MARKER
;

597 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_STATION
;

599 
¥iv
->
•ec_¥iv
.
ah
 =Öriv->ah;

600 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
íabÀd
 = 0;

601 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
sh‹t_ª≥©
 = 
åue
;

602 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
cou¡
 = 8;

603 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
ídÀss
 = 
Ál£
;

604 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
≥riod
 = 0x12;

605 
¥iv
->
•ec_¥iv
.
•ec_c⁄fig
.
f·_≥riod
 = 0x02;

606 
	}
}

608 
	$©h9k_öô_¥iv
(
©h9k_htc_¥iv
 *
¥iv
,

609 
u16
 
devid
, *
¥odu˘
,

610 
u32
 
drv_öfo
)

612 
©h_hw
 *
ah
 = 
NULL
;

613 
©h_comm⁄
 *
comm⁄
;

614 
i
, 
ªt
 = 0, 
csz
 = 0;

616 
ah
 = 
	`kzÆloc
((
©h_hw
), 
GFP_KERNEL
);

617 i‡(!
ah
)

618  -
ENOMEM
;

620 
ah
->
dev
 = 
¥iv
->dev;

621 
ah
->
hw
 = 
¥iv
->hw;

622 
ah
->
hw_vîsi⁄
.
devid
 = devid;

623 
ah
->
hw_vîsi⁄
.
usbdev
 = 
drv_öfo
;

624 
ah
->
ah_Êags
 |
AH_USE_EEPROM
;

625 
ah
->
ªg_›s
.
ªad
 = 
©h9k_ªgªad
;

626 
ah
->
ªg_›s
.
mu…i_ªad
 = 
©h9k_mu…i_ªgªad
;

627 
ah
->
ªg_›s
.
wrôe
 = 
©h9k_ªgwrôe
;

628 
ah
->
ªg_›s
.
íabÀ_wrôe_buf„r
 = 
©h9k_íabÀ_ªgwrôe_buf„r
;

629 
ah
->
ªg_›s
.
wrôe_Êush
 = 
©h9k_ªgwrôe_Êush
;

630 
ah
->
ªg_›s
.
íabÀ_rmw_buf„r
 = 
©h9k_íabÀ_rmw_buf„r
;

631 
ah
->
ªg_›s
.
rmw_Êush
 = 
©h9k_ªg_rmw_Êush
;

632 
ah
->
ªg_›s
.
rmw
 = 
©h9k_ªg_rmw
;

633 
¥iv
->
ah
 =áh;

635 
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

636 
comm⁄
->
›s
 = &
ah
->
ªg_›s
;

637 
comm⁄
->
ps_›s
 = &
©h9k_htc_ps_›s
;

638 
comm⁄
->
bus_›s
 = &
©h9k_usb_bus_›s
;

639 
comm⁄
->
ah
 =áh;

640 
comm⁄
->
hw
 = 
¥iv
->hw;

641 
comm⁄
->
¥iv
 =Öriv;

642 
comm⁄
->
debug_mask
 = 
©h9k_debug
;

643 
comm⁄
->
btc€x_íabÀd
 = 
©h9k_htc_btc€x_íabÀ
 == 1;

644 
	`£t_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

646 
	`•ö_lock_öô
(&
¥iv
->
bóc⁄_lock
);

647 
	`•ö_lock_öô
(&
¥iv
->
tx
.
tx_lock
);

648 
	`muãx_öô
(&
¥iv
->
muãx
);

649 
	`muãx_öô
(&
¥iv
->
htc_pm_lock
);

650 
	`èskÀt_öô
(&
¥iv
->
rx_èskÀt
, 
©h9k_rx_èskÀt
,

651 ()
¥iv
);

652 
	`èskÀt_öô
(&
¥iv
->
tx_Áûed_èskÀt
, 
©h9k_tx_Áûed_èskÀt
,

653 ()
¥iv
);

654 
	`INIT_DELAYED_WORK
(&
¥iv
->
™i_w‹k
, 
©h9k_htc_™i_w‹k
);

655 
	`INIT_WORK
(&
¥iv
->
ps_w‹k
, 
©h9k_ps_w‹k
);

656 
	`INIT_WORK
(&
¥iv
->
Áèl_w‹k
, 
©h9k_Áèl_w‹k
);

657 
	`£tup_timî
(&
¥iv
->
tx
.
˛ónup_timî
, 
©h9k_htc_tx_˛ónup_timî
,

658 ()
¥iv
);

664 
	`©h_ªad_ˇchesize
(
comm⁄
, &
csz
);

665 
comm⁄
->
ˇchñsz
 = 
csz
 << 2;

667 
ªt
 = 
	`©h9k_hw_öô
(
ah
);

668 i‡(
ªt
) {

669 
	`©h_îr
(
comm⁄
,

671 
ªt
);

672 
îr_hw
;

675 
ªt
 = 
	`©h9k_öô_queues
(
¥iv
);

676 i‡(
ªt
)

677 
îr_queues
;

679 
i
 = 0; i < 
ATH9K_HTC_MAX_BCN_VIF
; i++)

680 
¥iv
->
bóc⁄
.
b¶Ÿ
[
i
] = 
NULL
;

681 
¥iv
->
bóc⁄
.
¶Ÿtime
 = 
ATH9K_SLOT_TIME_9
;

683 
	`©h9k_cmn_öô_ch™√ls_øãs
(
comm⁄
);

684 
	`©h9k_cmn_öô_¸y±o
(
ah
);

685 
	`©h9k_öô_misc
(
¥iv
);

686 
	`©h9k_htc_öô_btc€x
(
¥iv
, 
¥odu˘
);

690 
îr_queues
:

691 
	`©h9k_hw_deöô
(
ah
);

692 
îr_hw
:

694 
	`k‰ì
(
ah
);

695 
¥iv
->
ah
 = 
NULL
;

697  
ªt
;

698 
	}
}

700 c⁄° 
õì80211_iÁ˚_limô
 
	gif_limôs
[] = {

701 { .
max
 = 2, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
) |

702 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) },

703 { .
	gmax
 = 2, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_AP
) |

704 #ifde‡
CPTCFG_MAC80211_MESH


705 
BIT
(
NL80211_IFTYPE_MESH_POINT
) |

707 
BIT
(
NL80211_IFTYPE_P2P_GO
) },

710 c⁄° 
õì80211_iÁ˚_combö©i⁄
 
	gif_comb
 = {

711 .
limôs
 = 
if_limôs
,

712 .
	gn_limôs
 = 
ARRAY_SIZE
(
if_limôs
),

713 .
	gmax_öãrÁ˚s
 = 2,

714 .
	gnum_dif„ª¡_ch™√ls
 = 1,

717 
	$©h9k_£t_hw_ˇ∑b
(
©h9k_htc_¥iv
 *
¥iv
,

718 
õì80211_hw
 *
hw
)

720 
©h_hw
 *
ah
 = 
¥iv
->ah;

721 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

722 
ba£_ìp_hódî
 *
pBa£
;

724 
	`õì80211_hw_£t
(
hw
, 
HOST_BROADCAST_PS_BUFFERING
);

725 
	`õì80211_hw_£t
(
hw
, 
MFP_CAPABLE
);

726 
	`õì80211_hw_£t
(
hw
, 
REPORTS_TX_ACK_STATUS
);

727 
	`õì80211_hw_£t
(
hw
, 
PS_NULLFUNC_STACK
);

728 
	`õì80211_hw_£t
(
hw
, 
RX_INCLUDES_FCS
);

729 
	`õì80211_hw_£t
(
hw
, 
HAS_RATE_CONTROL
);

730 
	`õì80211_hw_£t
(
hw
, 
SPECTRUM_MGMT
);

731 
	`õì80211_hw_£t
(
hw
, 
SIGNAL_DBM
);

732 
	`õì80211_hw_£t
(
hw
, 
AMPDU_AGGREGATION
);

734 i‡(
©h9k_ps_íabÀ
)

735 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_PS
);

737 
hw
->
wùhy
->
öãrÁ˚_modes
 =

738 
	`BIT
(
NL80211_IFTYPE_STATION
) |

739 
	`BIT
(
NL80211_IFTYPE_ADHOC
) |

740 
	`BIT
(
NL80211_IFTYPE_AP
) |

741 
	`BIT
(
NL80211_IFTYPE_P2P_GO
) |

742 
	`BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

743 
	`BIT
(
NL80211_IFTYPE_MESH_POINT
) |

744 
	`BIT
(
NL80211_IFTYPE_OCB
);

746 
hw
->
wùhy
->
iÁ˚_combö©i⁄s
 = &
if_comb
;

747 
hw
->
wùhy
->
n_iÁ˚_combö©i⁄s
 = 1;

749 
hw
->
wùhy
->
Êags
 &~
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

751 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_IBSS_RSN
 |

752 
WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL
 |

753 
WIPHY_FLAG_HAS_CHANNEL_SWITCH
;

755 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_TDLS
;

757 
hw
->
queues
 = 4;

758 
hw
->
max_li°í_öãrvÆ
 = 1;

760 
hw
->
vif_d©a_size
 = (
©h9k_htc_vif
);

761 
hw
->
°a_d©a_size
 = (
©h9k_htc_°a
);

764 
hw
->
exåa_tx_hódroom
 = (
tx_‰ame_hdr
) +

765 (
htc_‰ame_hdr
) + 4;

767 i‡(
¥iv
->
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_2GHZ
)

768 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
] =

769 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
];

770 i‡(
¥iv
->
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_5GHZ
)

771 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_5GHZ
] =

772 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
];

774 
	`©h9k_cmn_ªlﬂd_chaömask
(
ah
);

776 
pBa£
 = 
	`©h9k_htc_gë_ì¥om_ba£
(
¥iv
);

777 i‡(
pBa£
) {

778 
hw
->
wùhy
->
avaûabÀ_™ã¬as_rx
 = 
pBa£
->
rxMask
;

779 
hw
->
wùhy
->
avaûabÀ_™ã¬as_tx
 = 
pBa£
->
txMask
;

782 
	`SET_IEEE80211_PERM_ADDR
(
hw
, 
comm⁄
->
maˇddr
);

783 
	}
}

785 
	$©h9k_öô_fúmw¨e_vîsi⁄
(
©h9k_htc_¥iv
 *
¥iv
)

787 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

788 
wmi_fw_vîsi⁄
 
cmd_r•
;

789 
ªt
;

791 
	`mem£t
(&
cmd_r•
, 0, (cmd_rsp));

793 
	`WMI_CMD
(
WMI_GET_FW_VERSION
);

794 i‡(
ªt
)

795  -
EINVAL
;

797 
¥iv
->
fw_vîsi⁄_maj‹
 = 
	`be16_to_˝u
(
cmd_r•
.
maj‹
);

798 
¥iv
->
fw_vîsi⁄_mö‹
 = 
	`be16_to_˝u
(
cmd_r•
.
mö‹
);

800 
	`¢¥ötf
(
hw
->
wùhy
->
fw_vîsi⁄
, (hw->wiphy->fw_version), "%d.%d",

801 
¥iv
->
fw_vîsi⁄_maj‹
,

802 
¥iv
->
fw_vîsi⁄_mö‹
);

804 
	`dev_öfo
(
¥iv
->
dev
, "ath9k_htc: FW Version: %d.%d\n",

805 
¥iv
->
fw_vîsi⁄_maj‹
,

806 
¥iv
->
fw_vîsi⁄_mö‹
);

812 i‡(
¥iv
->
fw_vîsi⁄_maj‹
 !
MAJOR_VERSION_REQ
 ||

813 
¥iv
->
fw_vîsi⁄_mö‹
 < 
MINOR_VERSION_REQ
) {

814 
	`dev_îr
(
¥iv
->
dev
, "ath9k_htc: Please upgradeÅo FW version %d.%d\n",

815 
MAJOR_VERSION_REQ
, 
MINOR_VERSION_REQ
);

816  -
EINVAL
;

819 i‡(
¥iv
->
fw_vîsi⁄_maj‹
 =1 &&Öriv->
fw_vîsi⁄_mö‹
 < 4)

820 
	`£t_bô
(
HTC_FWFLAG_NO_RMW
, &
¥iv
->
fw_Êags
);

822 
	`dev_öfo
(
¥iv
->
dev
, "FW RMW support: %s\n",

823 
	`ã°_bô
(
HTC_FWFLAG_NO_RMW
, &
¥iv
->
fw_Êags
) ? "Off" : "On");

826 
	}
}

828 
	$©h9k_öô_devi˚
(
©h9k_htc_¥iv
 *
¥iv
,

829 
u16
 
devid
, *
¥odu˘
, 
u32
 
drv_öfo
)

831 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

832 
©h_comm⁄
 *
comm⁄
;

833 
©h_hw
 *
ah
;

834 
îr‹
 = 0;

835 
©h_ªguœt‹y
 *
ªg
;

836 
hw_«me
[64];

839 
îr‹
 = 
	`©h9k_öô_¥iv
(
¥iv
, 
devid
, 
¥odu˘
, 
drv_öfo
);

840 i‡(
îr‹
 != 0)

841 
îr_öô
;

843 
ah
 = 
¥iv
->ah;

844 
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

845 
	`©h9k_£t_hw_ˇ∑b
(
¥iv
, 
hw
);

847 
îr‹
 = 
	`©h9k_öô_fúmw¨e_vîsi⁄
(
¥iv
);

848 i‡(
îr‹
 != 0)

849 
îr_fw
;

852 
îr‹
 = 
	`©h_ªgd_öô
(&
comm⁄
->
ªguœt‹y
, 
¥iv
->
hw
->
wùhy
,

853 
©h9k_ªg_nŸifõr
);

854 i‡(
îr‹
)

855 
îr_ªgd
;

857 
ªg
 = &
comm⁄
->
ªguœt‹y
;

860 
îr‹
 = 
	`©h9k_tx_öô
(
¥iv
);

861 i‡(
îr‹
 != 0)

862 
îr_tx
;

865 
îr‹
 = 
	`©h9k_rx_öô
(
¥iv
);

866 i‡(
îr‹
 != 0)

867 
îr_rx
;

869 
	`©h9k_hw_dißbÀ
(
¥iv
->
ah
);

870 #ifde‡
CPTCFG_MAC80211_LEDS


872 
¥iv
->
Àd_cdev
.
deÁu…_åiggî
 = 
	`õì80211_¸óã_çt_Àd_åiggî
’riv->
hw
,

873 
IEEE80211_TPT_LEDTRIG_FL_RADIO
, 
©h9k_htc_çt_blök
,

874 
	`ARRAY_SIZE
(
©h9k_htc_çt_blök
));

878 
îr‹
 = 
	`õì80211_ªgi°î_hw
(
hw
);

879 i‡(
îr‹
)

880 
îr_ªgi°î
;

883 i‡(!
	`©h_is_w‹ld_ªgd
(
ªg
)) {

884 
îr‹
 = 
	`ªguœt‹y_höt
(
hw
->
wùhy
, 
ªg
->
Æpha2
);

885 i‡(
îr‹
)

886 
îr_w‹ld
;

889 
îr‹
 = 
	`©h9k_htc_öô_debug
(
¥iv
->
ah
);

890 i‡(
îr‹
) {

891 
	`©h_îr
(
comm⁄
, "UnableÅo create debugfs files\n");

892 
îr_w‹ld
;

895 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

897 
¥iv
->
wmi_cmd_ï
,

898 
¥iv
->
bóc⁄_ï
,

899 
¥iv
->
ˇb_ï
,

900 
¥iv
->
u≠sd_ï
,

901 
¥iv
->
mgmt_ï
,

902 
¥iv
->
d©a_be_ï
,

903 
¥iv
->
d©a_bk_ï
,

904 
¥iv
->
d©a_vi_ï
,

905 
¥iv
->
d©a_vo_ï
);

907 
	`©h9k_hw_«me
(
¥iv
->
ah
, 
hw_«me
, (hw_name));

908 
	`wùhy_öfo
(
hw
->
wùhy
, "%s\n", 
hw_«me
);

910 
	`©h9k_öô_Àds
(
¥iv
);

911 
	`©h9k_°¨t_rfkûl_pﬁl
(
¥iv
);

915 
îr_w‹ld
:

916 
	`õì80211_uƒegi°î_hw
(
hw
);

917 
îr_ªgi°î
:

918 
	`©h9k_rx_˛ónup
(
¥iv
);

919 
îr_rx
:

920 
	`©h9k_tx_˛ónup
(
¥iv
);

921 
îr_tx
:

923 
îr_ªgd
:

925 
îr_fw
:

926 
	`©h9k_deöô_¥iv
(
¥iv
);

927 
îr_öô
:

928  
îr‹
;

929 
	}
}

931 
	$©h9k_htc_¥obe_devi˚
(
htc_èrgë
 *
htc_h™dÀ
, 
devi˚
 *
dev
,

932 
u16
 
devid
, *
¥odu˘
, 
u32
 
drv_öfo
)

934 
õì80211_hw
 *
hw
;

935 
©h9k_htc_¥iv
 *
¥iv
;

936 
ªt
;

938 
hw
 = 
	`õì80211_Æloc_hw
((
©h9k_htc_¥iv
), &
©h9k_htc_›s
);

939 i‡(!
hw
)

940  -
ENOMEM
;

942 
¥iv
 = 
hw
->priv;

943 
¥iv
->
hw
 = hw;

944 
¥iv
->
htc
 = 
htc_h™dÀ
;

945 
¥iv
->
dev
 = dev;

946 
htc_h™dÀ
->
drv_¥iv
 = 
¥iv
;

947 
	`SET_IEEE80211_DEV
(
hw
, 
¥iv
->
dev
);

949 
ªt
 = 
	`©h9k_htc_waô_f‹_èrgë
(
¥iv
);

950 i‡(
ªt
)

951 
îr_‰ì
;

953 
¥iv
->
wmi
 = 
	`©h9k_öô_wmi
(priv);

954 i‡(!
¥iv
->
wmi
) {

955 
ªt
 = -
EINVAL
;

956 
îr_‰ì
;

959 
ªt
 = 
	`©h9k_öô_htc_£rvi˚s
(
¥iv
, 
devid
, 
drv_öfo
);

960 i‡(
ªt
)

961 
îr_öô
;

963 
ªt
 = 
	`©h9k_öô_devi˚
(
¥iv
, 
devid
, 
¥odu˘
, 
drv_öfo
);

964 i‡(
ªt
)

965 
îr_öô
;

969 
îr_öô
:

970 
	`©h9k_deöô_wmi
(
¥iv
);

971 
îr_‰ì
:

972 
	`õì80211_‰ì_hw
(
hw
);

973  
ªt
;

974 
	}
}

976 
	$©h9k_htc_disc⁄√˘_devi˚
(
htc_èrgë
 *
htc_h™dÀ
, 
boﬁ
 
hŸu≈lug
)

978 i‡(
htc_h™dÀ
->
drv_¥iv
) {

981 i‡(
hŸu≈lug
)

982 
htc_h™dÀ
->
drv_¥iv
->
ah
->
ah_Êags
 |
AH_UNPLUGGED
;

984 
	`©h9k_deöô_devi˚
(
htc_h™dÀ
->
drv_¥iv
);

985 
	`©h9k_deöô_wmi
(
htc_h™dÀ
->
drv_¥iv
);

986 
	`õì80211_‰ì_hw
(
htc_h™dÀ
->
drv_¥iv
->
hw
);

988 
	}
}

990 #ifde‡
CONFIG_PM


992 
	$©h9k_htc_su•íd
(
htc_èrgë
 *
htc_h™dÀ
)

994 
	`©h9k_htc_£çowî
(
htc_h™dÀ
->
drv_¥iv
, 
ATH9K_PM_FULL_SLEEP
);

995 
	}
}

997 
	$©h9k_htc_ªsume
(
htc_èrgë
 *
htc_h™dÀ
)

999 
©h9k_htc_¥iv
 *
¥iv
 = 
htc_h™dÀ
->
drv_¥iv
;

1000 
ªt
;

1002 
ªt
 = 
	`©h9k_htc_waô_f‹_èrgë
(
¥iv
);

1003 i‡(
ªt
)

1004  
ªt
;

1006 
ªt
 = 
	`©h9k_öô_htc_£rvi˚s
(
¥iv
,Öriv->
ah
->
hw_vîsi⁄
.
devid
,

1007 
¥iv
->
ah
->
hw_vîsi⁄
.
usbdev
);

1008 
	`©h9k_c⁄figuª_Àds
(
¥iv
);

1010  
ªt
;

1011 
	}
}

1014 
__öô
 
	$©h9k_htc_öô
()

1016 i‡(
	`©h9k_hif_usb_öô
() < 0) {

1017 
	`¥_îr
("No USB devices found, driverÇot installed\n");

1018  -
ENODEV
;

1022 
	}
}

1023 
moduÀ_öô
(
©h9k_htc_öô
);

1025 
__exô
 
	$©h9k_htc_exô
()

1027 
	`©h9k_hif_usb_exô
();

1028 
	`¥_öfo
("Driver unloaded\n");

1029 
	}
}

1030 
moduÀ_exô
(
©h9k_htc_exô
);

	@htc_drv_main.c

17 
	~"htc.h
"

24 
htc_phymode
 
	$©h9k_htc_gë_curmode
(
©h9k_htc_¥iv
 *
¥iv
,

25 
©h9k_ch™√l
 *
ich™
)

27 i‡(
	`IS_CHAN_5GHZ
(
ich™
))

28  
HTC_MODE_11NA
;

30  
HTC_MODE_11NG
;

31 
	}
}

33 
boﬁ
 
	$©h9k_htc_£çowî
(
©h9k_htc_¥iv
 *
¥iv
,

34 
©h9k_powî_mode
 
mode
)

36 
boﬁ
 
ªt
;

38 
	`muãx_lock
(&
¥iv
->
htc_pm_lock
);

39 
ªt
 = 
	`©h9k_hw_£çowî
(
¥iv
->
ah
, 
mode
);

40 
	`muãx_u∆ock
(&
¥iv
->
htc_pm_lock
);

42  
ªt
;

43 
	}
}

45 
	$©h9k_htc_ps_wakeup
(
©h9k_htc_¥iv
 *
¥iv
)

47 
	`muãx_lock
(&
¥iv
->
htc_pm_lock
);

48 i‡(++
¥iv
->
ps_u£cou¡
 != 1)

49 
u∆ock
;

50 
	`©h9k_hw_£çowî
(
¥iv
->
ah
, 
ATH9K_PM_AWAKE
);

52 
u∆ock
:

53 
	`muãx_u∆ock
(&
¥iv
->
htc_pm_lock
);

54 
	}
}

56 
	$©h9k_htc_ps_ª°‹e
(
©h9k_htc_¥iv
 *
¥iv
)

58 
boﬁ
 
ª£t
;

60 
	`muãx_lock
(&
¥iv
->
htc_pm_lock
);

61 i‡(--
¥iv
->
ps_u£cou¡
 != 0)

62 
u∆ock
;

64 i‡(
¥iv
->
ps_idÀ
) {

65 
	`©h9k_hw_£åxab‹t
(
¥iv
->
ah
, 
åue
);

66 
	`©h9k_hw_°›dm¨ecv
(
¥iv
->
ah
, &
ª£t
);

67 
	`©h9k_hw_£çowî
(
¥iv
->
ah
, 
ATH9K_PM_FULL_SLEEP
);

68 } i‡(
¥iv
->
ps_íabÀd
) {

69 
	`©h9k_hw_£çowî
(
¥iv
->
ah
, 
ATH9K_PM_NETWORK_SLEEP
);

72 
u∆ock
:

73 
	`muãx_u∆ock
(&
¥iv
->
htc_pm_lock
);

74 
	}
}

76 
	$©h9k_ps_w‹k
(
w‹k_°ru˘
 *
w‹k
)

78 
©h9k_htc_¥iv
 *
¥iv
 =

79 
	`c⁄èöî_of
(
w‹k
, 
©h9k_htc_¥iv
,

80 
ps_w‹k
);

81 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_AWAKE
);

88 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_NETWORK_SLEEP
);

89 
	}
}

91 
	$©h9k_htc_vif_ôî
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

93 
©h9k_htc_¥iv
 *
¥iv
 = 
d©a
;

94 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
vif
->bss_conf;

96 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

97 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
) &&

98 
bss_c⁄f
->
íabÀ_bóc⁄
) {

99 
¥iv
->
ªc⁄fig_bóc⁄
 = 
åue
;

100 
¥iv
->
ª¨m_™i
 = 
åue
;

103 i‡(
bss_c⁄f
->
assoc
) {

104 
¥iv
->
ª¨m_™i
 = 
åue
;

105 
¥iv
->
ªc⁄fig_bóc⁄
 = 
åue
;

107 
	}
}

109 
	$©h9k_htc_vif_ªc⁄fig
(
©h9k_htc_¥iv
 *
¥iv
)

111 
¥iv
->
ª¨m_™i
 = 
Ál£
;

112 
¥iv
->
ªc⁄fig_bóc⁄
 = 
Ál£
;

114 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

115 
¥iv
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

116 
©h9k_htc_vif_ôî
, 
¥iv
);

117 i‡(
¥iv
->
ª¨m_™i
)

118 
	`©h9k_htc_°¨t_™i
(
¥iv
);

120 i‡(
¥iv
->
ªc⁄fig_bóc⁄
) {

121 
	`©h9k_htc_ps_wakeup
(
¥iv
);

122 
	`©h9k_htc_bóc⁄_ªc⁄fig
(
¥iv
);

123 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

125 
	}
}

127 
	$©h9k_htc_bssid_ôî
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

129 
©h9k_vif_ôî_d©a
 *
ôî_d©a
 = 
d©a
;

130 
i
;

132 i‡(
ôî_d©a
->
hw_maˇddr
 !
NULL
) {

133 
i
 = 0; i < 
ETH_ALEN
; i++)

134 
ôî_d©a
->
mask
[
i
] &~(ôî_d©a->
hw_maˇddr
[i] ^ 
mac
[i]);

136 
ôî_d©a
->
hw_maˇddr
 = 
mac
;

138 
	}
}

140 
	$©h9k_htc_£t_mac_bssid_mask
(
©h9k_htc_¥iv
 *
¥iv
,

141 
õì80211_vif
 *
vif
)

143 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

144 
©h9k_vif_ôî_d©a
 
ôî_d©a
;

151 
ôî_d©a
.
hw_maˇddr
 = 
NULL
;

152 
	`ëh_brﬂdˇ°_addr
(
ôî_d©a
.
mask
);

154 i‡(
vif
)

155 
	`©h9k_htc_bssid_ôî
(&
ôî_d©a
, 
vif
->
addr
, vif);

158 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

159 
¥iv
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

160 
©h9k_htc_bssid_ôî
, &
ôî_d©a
);

162 
	`mem˝y
(
comm⁄
->
bssidmask
, 
ôî_d©a
.
mask
, 
ETH_ALEN
);

164 i‡(
ôî_d©a
.
hw_maˇddr
)

165 
	`mem˝y
(
comm⁄
->
maˇddr
, 
ôî_d©a
.
hw_maˇddr
, 
ETH_ALEN
);

167 
	`©h_hw_£tbssidmask
(
comm⁄
);

168 
	}
}

170 
	$©h9k_htc_£t_›mode
(
©h9k_htc_¥iv
 *
¥iv
)

172 i‡(
¥iv
->
num_ibss_vif
)

173 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_ADHOC
;

174 i‡(
¥iv
->
num_≠_vif
)

175 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_AP
;

176 i‡(
¥iv
->
num_mbss_vif
)

177 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_MESH_POINT
;

179 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_STATION
;

181 
	`©h9k_hw_£t›mode
(
¥iv
->
ah
);

182 
	}
}

184 
	$©h9k_htc_ª£t
(
©h9k_htc_¥iv
 *
¥iv
)

186 
©h_hw
 *
ah
 = 
¥iv
->ah;

187 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

188 
õì80211_ch™√l
 *
ch™√l
 = 
¥iv
->
hw
->
c⁄f
.
ch™def
.
ch™
;

189 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
NULL
;

190 
htc_phymode
 
mode
;

191 
__be16
 
htc_mode
;

192 
u8
 
cmd_r•
;

193 
ªt
;

195 
	`muãx_lock
(&
¥iv
->
muãx
);

196 
	`©h9k_htc_ps_wakeup
(
¥iv
);

198 
	`©h9k_htc_°›_™i
(
¥iv
);

199 
	`õì80211_°›_queues
(
¥iv
->
hw
);

201 
	`dñ_timî_sync
(&
¥iv
->
tx
.
˛ónup_timî
);

202 
	`©h9k_htc_tx_døö
(
¥iv
);

204 
	`WMI_CMD
(
WMI_DISABLE_INTR_CMDID
);

205 
	`WMI_CMD
(
WMI_DRAIN_TXQ_ALL_CMDID
);

206 
	`WMI_CMD
(
WMI_STOP_RECV_CMDID
);

208 
	`©h9k_wmi_evít_døö
(
¥iv
);

210 
ˇld©a
 = &
¥iv
->caldata;

211 
ªt
 = 
	`©h9k_hw_ª£t
(
ah
,áh->
curch™
, 
ˇld©a
, 
Ál£
);

212 i‡(
ªt
) {

213 
	`©h_îr
(
comm⁄
,

215 
ch™√l
->
˚¡î_‰eq
, 
ªt
);

218 
	`©h9k_cmn_upd©e_txpow
(
ah
, 
¥iv
->
cuπxpow
,Öriv->
txpowlimô
,

219 &
¥iv
->
cuπxpow
);

221 
	`WMI_CMD
(
WMI_START_RECV_CMDID
);

222 
	`©h9k_ho°_rx_öô
(
¥iv
);

224 
mode
 = 
	`©h9k_htc_gë_curmode
(
¥iv
, 
ah
->
curch™
);

225 
htc_mode
 = 
	`˝u_to_be16
(
mode
);

226 
	`WMI_CMD_BUF
(
WMI_SET_MODE_CMDID
, &
htc_mode
);

228 
	`WMI_CMD
(
WMI_ENABLE_INTR_CMDID
);

229 
	`htc_°¨t
(
¥iv
->
htc
);

230 
	`©h9k_htc_vif_ªc⁄fig
(
¥iv
);

231 
	`õì80211_wake_queues
(
¥iv
->
hw
);

233 
	`mod_timî
(&
¥iv
->
tx
.
˛ónup_timî
,

234 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ATH9K_HTC_TX_CLEANUP_INTERVAL
));

236 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

237 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

238 
	}
}

240 
	$©h9k_htc_£t_ch™√l
(
©h9k_htc_¥iv
 *
¥iv
,

241 
õì80211_hw
 *
hw
,

242 
©h9k_ch™√l
 *
hch™
)

244 
©h_hw
 *
ah
 = 
¥iv
->ah;

245 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

246 
õì80211_c⁄f
 *
c⁄f
 = &
comm⁄
->
hw
->conf;

247 
boﬁ
 
Á°cc
;

248 
õì80211_ch™√l
 *
ch™√l
 = 
hw
->
c⁄f
.
ch™def
.
ch™
;

249 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
NULL
;

250 
htc_phymode
 
mode
;

251 
__be16
 
htc_mode
;

252 
u8
 
cmd_r•
;

253 
ªt
;

255 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
))

256  -
EIO
;

258 
Á°cc
 = !!(
hw
->
c⁄f
.
Êags
 & 
IEEE80211_CONF_OFFCHANNEL
);

260 
	`©h9k_htc_ps_wakeup
(
¥iv
);

262 
	`©h9k_htc_°›_™i
(
¥iv
);

263 
	`dñ_timî_sync
(&
¥iv
->
tx
.
˛ónup_timî
);

264 
	`©h9k_htc_tx_døö
(
¥iv
);

266 
	`WMI_CMD
(
WMI_DISABLE_INTR_CMDID
);

267 
	`WMI_CMD
(
WMI_DRAIN_TXQ_ALL_CMDID
);

268 
	`WMI_CMD
(
WMI_STOP_RECV_CMDID
);

270 
	`©h9k_wmi_evít_døö
(
¥iv
);

272 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

274 
¥iv
->
ah
->
curch™
->
ch™√l
,

275 
ch™√l
->
˚¡î_‰eq
, 
	`c⁄f_is_ht
(
c⁄f
), 
	`c⁄f_is_ht40
(conf),

276 
Á°cc
);

278 i‡(!
Á°cc
)

279 
ˇld©a
 = &
¥iv
->caldata;

281 
ªt
 = 
	`©h9k_hw_ª£t
(
ah
, 
hch™
, 
ˇld©a
, 
Á°cc
);

282 i‡(
ªt
) {

283 
	`©h_îr
(
comm⁄
,

285 
ch™√l
->
˚¡î_‰eq
, 
ªt
);

286 
îr
;

289 
	`©h9k_cmn_upd©e_txpow
(
ah
, 
¥iv
->
cuπxpow
,Öriv->
txpowlimô
,

290 &
¥iv
->
cuπxpow
);

292 
	`WMI_CMD
(
WMI_START_RECV_CMDID
);

293 i‡(
ªt
)

294 
îr
;

296 
	`©h9k_ho°_rx_öô
(
¥iv
);

298 
mode
 = 
	`©h9k_htc_gë_curmode
(
¥iv
, 
hch™
);

299 
htc_mode
 = 
	`˝u_to_be16
(
mode
);

300 
	`WMI_CMD_BUF
(
WMI_SET_MODE_CMDID
, &
htc_mode
);

301 i‡(
ªt
)

302 
îr
;

304 
	`WMI_CMD
(
WMI_ENABLE_INTR_CMDID
);

305 i‡(
ªt
)

306 
îr
;

308 
	`htc_°¨t
(
¥iv
->
htc
);

310 i‡(!
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
) &&

311 !(
hw
->
c⁄f
.
Êags
 & 
IEEE80211_CONF_OFFCHANNEL
))

312 
	`©h9k_htc_vif_ªc⁄fig
(
¥iv
);

314 
	`mod_timî
(&
¥iv
->
tx
.
˛ónup_timî
,

315 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ATH9K_HTC_TX_CLEANUP_INTERVAL
));

318 i‡(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
) &&

319 
¥iv
->
•ec_¥iv
.
•e˘øl_mode
 =
SPECTRAL_CHANSCAN
)

320 
	`©h9k_cmn_•e˘øl_sˇn_åiggî
(
comm⁄
, &
¥iv
->
•ec_¥iv
);

321 
îr
:

322 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

323  
ªt
;

324 
	}
}

333 
	$__©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
©h9k_htc_¥iv
 *
¥iv
)

335 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

336 
©h9k_htc_èrgë_vif
 
hvif
;

337 
ªt
 = 0;

338 
u8
 
cmd_r•
;

340 
	`mem£t
(&
hvif
, 0, (
©h9k_htc_èrgë_vif
));

341 
	`mem˝y
(&
hvif
.
myaddr
, 
comm⁄
->
maˇddr
, 
ETH_ALEN
);

342 
hvif
.
ödex
 = 
¥iv
->
m⁄_vif_idx
;

343 
	`WMI_CMD_BUF
(
WMI_VAP_REMOVE_CMDID
, &
hvif
);

344 i‡(
ªt
) {

345 
	`©h_îr
(
comm⁄
, "UnableÅoÑemove monitor interfaceát idx: %d\n",

346 
¥iv
->
m⁄_vif_idx
);

349 
¥iv
->
nvifs
--;

350 
¥iv
->
vif_¶Ÿ
 &~(1 <<Öriv->
m⁄_vif_idx
);

351 
	}
}

353 
	$©h9k_htc_add_m⁄ô‹_öãrÁ˚
(
©h9k_htc_¥iv
 *
¥iv
)

355 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

356 
©h9k_htc_èrgë_vif
 
hvif
;

357 
©h9k_htc_èrgë_°a
 
t°a
;

358 
ªt
 = 0, 
°a_idx
;

359 
u8
 
cmd_r•
;

361 i‡((
¥iv
->
nvifs
 >
ATH9K_HTC_MAX_VIF
) ||

362 (
¥iv
->
n°©i⁄s
 >
ATH9K_HTC_MAX_STA
)) {

363 
ªt
 = -
ENOBUFS
;

364 
îr_vif
;

367 
°a_idx
 = 
	`ffz
(
¥iv
->
°a_¶Ÿ
);

368 i‡((
°a_idx
 < 0Ë|| (°a_idx > 
ATH9K_HTC_MAX_STA
)) {

369 
ªt
 = -
ENOBUFS
;

370 
îr_vif
;

376 
	`mem£t
(&
hvif
, 0, (
©h9k_htc_èrgë_vif
));

377 
	`mem˝y
(&
hvif
.
myaddr
, 
comm⁄
->
maˇddr
, 
ETH_ALEN
);

379 
hvif
.
›mode
 = 
HTC_M_MONITOR
;

380 
hvif
.
ödex
 = 
	`ffz
(
¥iv
->
vif_¶Ÿ
);

382 
	`WMI_CMD_BUF
(
WMI_VAP_CREATE_CMDID
, &
hvif
);

383 i‡(
ªt
)

384 
îr_vif
;

390 
¥iv
->
m⁄_vif_idx
 = 
hvif
.
ödex
;

391 
¥iv
->
vif_¶Ÿ
 |(1 << 
hvif
.
ödex
);

397 i‡(!
¥iv
->
nvifs
)

398 
¥iv
->
ah
->
›mode
 = 
NL80211_IFTYPE_MONITOR
;

400 
¥iv
->
nvifs
++;

405 
	`mem£t
(&
t°a
, 0, (
©h9k_htc_èrgë_°a
));

407 
	`mem˝y
(&
t°a
.
maˇddr
, 
comm⁄
->maˇddr, 
ETH_ALEN
);

409 
t°a
.
is_vif_°a
 = 1;

410 
t°a
.
°a_ödex
 = 
°a_idx
;

411 
t°a
.
vif_ödex
 = 
hvif
.
ödex
;

412 
t°a
.
maxampdu
 = 
	`˝u_to_be16
(0xffff);

414 
	`WMI_CMD_BUF
(
WMI_NODE_CREATE_CMDID
, &
t°a
);

415 i‡(
ªt
) {

416 
	`©h_îr
(
comm⁄
, "UnableÅoádd stationÉntry for monitor mode\n");

417 
îr_°a
;

420 
¥iv
->
°a_¶Ÿ
 |(1 << 
°a_idx
);

421 
¥iv
->
n°©i⁄s
++;

422 
¥iv
->
vif_°a_pos
[¥iv->
m⁄_vif_idx
] = 
°a_idx
;

423 
¥iv
->
ah
->
is_m⁄ô‹ög
 = 
åue
;

425 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

427 
¥iv
->
m⁄_vif_idx
, 
°a_idx
);

431 
îr_°a
:

435 
	`__©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
¥iv
);

436 
îr_vif
:

437 
	`©h_dbg
(
comm⁄
, 
FATAL
, "UnableÅoáttachá monitor interface\n");

439  
ªt
;

440 
	}
}

442 
	$©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
©h9k_htc_¥iv
 *
¥iv
)

444 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

445 
ªt
 = 0;

446 
u8
 
cmd_r•
, 
°a_idx
;

448 
	`__©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
¥iv
);

450 
°a_idx
 = 
¥iv
->
vif_°a_pos
[¥iv->
m⁄_vif_idx
];

452 
	`WMI_CMD_BUF
(
WMI_NODE_REMOVE_CMDID
, &
°a_idx
);

453 i‡(
ªt
) {

454 
	`©h_îr
(
comm⁄
, "UnableÅoÑemove stationÉntry for monitor mode\n");

455  
ªt
;

458 
¥iv
->
°a_¶Ÿ
 &~(1 << 
°a_idx
);

459 
¥iv
->
n°©i⁄s
--;

460 
¥iv
->
ah
->
is_m⁄ô‹ög
 = 
Ál£
;

462 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

464 
¥iv
->
m⁄_vif_idx
, 
°a_idx
);

467 
	}
}

469 
	$©h9k_htc_add_°©i⁄
(
©h9k_htc_¥iv
 *
¥iv
,

470 
õì80211_vif
 *
vif
,

471 
õì80211_°a
 *
°a
)

473 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

474 
©h9k_htc_èrgë_°a
 
t°a
;

475 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*Ë
vif
->
drv_¥iv
;

476 
©h9k_htc_°a
 *
i°a
;

477 
ªt
, 
°a_idx
;

478 
u8
 
cmd_r•
;

479 
u16
 
maxampdu
;

481 i‡(
¥iv
->
n°©i⁄s
 >
ATH9K_HTC_MAX_STA
)

482  -
ENOBUFS
;

484 
°a_idx
 = 
	`ffz
(
¥iv
->
°a_¶Ÿ
);

485 i‡((
°a_idx
 < 0Ë|| (°a_idx > 
ATH9K_HTC_MAX_STA
))

486  -
ENOBUFS
;

488 
	`mem£t
(&
t°a
, 0, (
©h9k_htc_èrgë_°a
));

490 i‡(
°a
) {

491 
i°a
 = (
©h9k_htc_°a
 *Ë
°a
->
drv_¥iv
;

492 
	`mem˝y
(&
t°a
.
maˇddr
, 
°a
->
addr
, 
ETH_ALEN
);

493 
	`mem˝y
(&
t°a
.
bssid
, 
comm⁄
->
curbssid
, 
ETH_ALEN
);

494 
i°a
->
ödex
 = 
°a_idx
;

495 
t°a
.
is_vif_°a
 = 0;

496 
maxampdu
 = 1 << (
IEEE80211_HT_MAX_AMPDU_FACTOR
 +

497 
°a
->
ht_ˇp
.
ampdu_Á˘‹
);

498 
t°a
.
maxampdu
 = 
	`˝u_to_be16
(maxampdu);

500 
	`mem˝y
(&
t°a
.
maˇddr
, 
vif
->
addr
, 
ETH_ALEN
);

501 
t°a
.
is_vif_°a
 = 1;

502 
t°a
.
maxampdu
 = 
	`˝u_to_be16
(0xffff);

505 
t°a
.
°a_ödex
 = 
°a_idx
;

506 
t°a
.
vif_ödex
 = 
avp
->
ödex
;

508 
	`WMI_CMD_BUF
(
WMI_NODE_CREATE_CMDID
, &
t°a
);

509 i‡(
ªt
) {

510 i‡(
°a
)

511 
	`©h_îr
(
comm⁄
,

513 
°a
->
addr
);

514  
ªt
;

517 i‡(
°a
) {

518 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

520 
°a
->
addr
, 
t°a
.
°a_ödex
);

522 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

524 
avp
->
ödex
, 
t°a
.
°a_ödex
);

527 
¥iv
->
°a_¶Ÿ
 |(1 << 
°a_idx
);

528 
¥iv
->
n°©i⁄s
++;

529 i‡(!
°a
)

530 
¥iv
->
vif_°a_pos
[
avp
->
ödex
] = 
°a_idx
;

533 
	}
}

535 
	$©h9k_htc_ªmove_°©i⁄
(
©h9k_htc_¥iv
 *
¥iv
,

536 
õì80211_vif
 *
vif
,

537 
õì80211_°a
 *
°a
)

539 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

540 
©h9k_htc_vif
 *
avp
 = (©h9k_htc_vi‡*Ë
vif
->
drv_¥iv
;

541 
©h9k_htc_°a
 *
i°a
;

542 
ªt
;

543 
u8
 
cmd_r•
, 
°a_idx
;

545 i‡(
°a
) {

546 
i°a
 = (
©h9k_htc_°a
 *Ë
°a
->
drv_¥iv
;

547 
°a_idx
 = 
i°a
->
ödex
;

549 
°a_idx
 = 
¥iv
->
vif_°a_pos
[
avp
->
ödex
];

552 
	`WMI_CMD_BUF
(
WMI_NODE_REMOVE_CMDID
, &
°a_idx
);

553 i‡(
ªt
) {

554 i‡(
°a
)

555 
	`©h_îr
(
comm⁄
,

557 
°a
->
addr
);

558  
ªt
;

561 i‡(
°a
) {

562 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

564 
°a
->
addr
, 
°a_idx
);

566 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

568 
avp
->
ödex
, 
°a_idx
);

571 
¥iv
->
°a_¶Ÿ
 &~(1 << 
°a_idx
);

572 
¥iv
->
n°©i⁄s
--;

575 
	}
}

577 
	$©h9k_htc_upd©e_ˇp_èrgë
(
©h9k_htc_¥iv
 *
¥iv
,

578 
u8
 
íabÀ_c€x
)

580 
©h9k_htc_ˇp_èrgë
 
tˇp
;

581 
ªt
;

582 
u8
 
cmd_r•
;

584 
	`mem£t
(&
tˇp
, 0, (
©h9k_htc_ˇp_èrgë
));

586 
tˇp
.
ampdu_limô
 = 
	`˝u_to_be32
(0xffff);

587 
tˇp
.
ampdu_sub‰ames
 = 0xff;

588 
tˇp
.
íabÀ_c€x
 =Énable_coex;

589 
tˇp
.
tx_chaömask
 = 
¥iv
->
ah
->
ˇps
.tx_chainmask;

591 
	`WMI_CMD_BUF
(
WMI_TARGET_IC_UPDATE_CMDID
, &
tˇp
);

593  
ªt
;

594 
	}
}

596 
	$©h9k_htc_£tup_øã
(
©h9k_htc_¥iv
 *
¥iv
,

597 
õì80211_°a
 *
°a
,

598 
©h9k_htc_èrgë_øã
 *
å©e
)

600 
©h9k_htc_°a
 *
i°a
 = (©h9k_htc_°®*Ë
°a
->
drv_¥iv
;

601 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

602 
u32
 
ˇps
 = 0;

603 
i
, 
j
;

605 
sb™d
 = 
¥iv
->
hw
->
wùhy
->
b™ds
[¥iv->hw->
c⁄f
.
ch™def
.
ch™
->
b™d
];

607 
i
 = 0, 
j
 = 0; i < 
sb™d
->
n_bôøãs
; i++) {

608 i‡(
°a
->
suµ_øãs
[
sb™d
->
b™d
] & 
	`BIT
(
i
)) {

609 
å©e
->
øãs
.
Àgacy_øãs
.
rs_øãs
[
j
]

610 (
sb™d
->
bôøãs
[
i
].
bôøã
 * 2) / 10;

611 
j
++;

614 
å©e
->
øãs
.
Àgacy_øãs
.
rs_ƒ©es
 = 
j
;

616 i‡(
°a
->
ht_ˇp
.
ht_suµ‹ãd
) {

617 
i
 = 0, 
j
 = 0; i < 77; i++) {

618 i‡(
°a
->
ht_ˇp
.
mcs
.
rx_mask
[
i
/8] & (1<<(i%8)))

619 
å©e
->
øãs
.
ht_øãs
.
rs_øãs
[
j
++] = 
i
;

620 i‡(
j
 =
ATH_HTC_RATE_MAX
)

623 
å©e
->
øãs
.
ht_øãs
.
rs_ƒ©es
 = 
j
;

625 
ˇps
 = 
WLAN_RC_HT_FLAG
;

626 i‡(
°a
->
ht_ˇp
.
ˇp
 & 
IEEE80211_HT_CAP_RX_STBC
)

627 
ˇps
 |
ATH_RC_TX_STBC_FLAG
;

628 i‡(
°a
->
ht_ˇp
.
mcs
.
rx_mask
[1])

629 
ˇps
 |
WLAN_RC_DS_FLAG
;

630 i‡((
°a
->
ht_ˇp
.
ˇp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
) &&

631 (
	`c⁄f_is_ht40
(&
¥iv
->
hw
->
c⁄f
)))

632 
ˇps
 |
WLAN_RC_40_FLAG
;

633 i‡(
	`c⁄f_is_ht40
(&
¥iv
->
hw
->
c⁄f
) &&

634 (
°a
->
ht_ˇp
.
ˇp
 & 
IEEE80211_HT_CAP_SGI_40
))

635 
ˇps
 |
WLAN_RC_SGI_FLAG
;

636 i‡(
	`c⁄f_is_ht20
(&
¥iv
->
hw
->
c⁄f
) &&

637 (
°a
->
ht_ˇp
.
ˇp
 & 
IEEE80211_HT_CAP_SGI_20
))

638 
ˇps
 |
WLAN_RC_SGI_FLAG
;

641 
å©e
->
°a_ödex
 = 
i°a
->
ödex
;

642 
å©e
->
i¢ew
 = 1;

643 
å©e
->
ˇpÊags
 = 
	`˝u_to_be32
(
ˇps
);

644 
	}
}

646 
	$©h9k_htc_£nd_øã_cmd
(
©h9k_htc_¥iv
 *
¥iv
,

647 
©h9k_htc_èrgë_øã
 *
å©e
)

649 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

650 
ªt
;

651 
u8
 
cmd_r•
;

653 
	`WMI_CMD_BUF
(
WMI_RC_RATE_UPDATE_CMDID
, 
å©e
);

654 i‡(
ªt
) {

655 
	`©h_îr
(
comm⁄
,

659  
ªt
;

660 
	}
}

662 
	$©h9k_htc_öô_øã
(
©h9k_htc_¥iv
 *
¥iv
,

663 
õì80211_°a
 *
°a
)

665 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

666 
©h9k_htc_èrgë_øã
 
å©e
;

667 
ªt
;

669 
	`mem£t
(&
å©e
, 0, (
©h9k_htc_èrgë_øã
));

670 
	`©h9k_htc_£tup_øã
(
¥iv
, 
°a
, &
å©e
);

671 
ªt
 = 
	`©h9k_htc_£nd_øã_cmd
(
¥iv
, &
å©e
);

672 i‡(!
ªt
)

673 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

675 
°a
->
addr
, 
	`be32_to_˝u
(
å©e
.
ˇpÊags
));

676 
	}
}

678 
	$©h9k_htc_upd©e_øã
(
©h9k_htc_¥iv
 *
¥iv
,

679 
õì80211_vif
 *
vif
,

680 
õì80211_bss_c⁄f
 *
bss_c⁄f
)

682 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

683 
©h9k_htc_èrgë_øã
 
å©e
;

684 
õì80211_°a
 *
°a
;

685 
ªt
;

687 
	`mem£t
(&
å©e
, 0, (
©h9k_htc_èrgë_øã
));

689 
	`rcu_ªad_lock
();

690 
°a
 = 
	`õì80211_föd_°a
(
vif
, 
bss_c⁄f
->
bssid
);

691 i‡(!
°a
) {

692 
	`rcu_ªad_u∆ock
();

695 
	`©h9k_htc_£tup_øã
(
¥iv
, 
°a
, &
å©e
);

696 
	`rcu_ªad_u∆ock
();

698 
ªt
 = 
	`©h9k_htc_£nd_øã_cmd
(
¥iv
, &
å©e
);

699 i‡(!
ªt
)

700 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

702 
bss_c⁄f
->
bssid
, 
	`be32_to_˝u
(
å©e
.
ˇpÊags
));

703 
	}
}

705 
	$©h9k_htc_tx_aggr_›î
(
©h9k_htc_¥iv
 *
¥iv
,

706 
õì80211_vif
 *
vif
,

707 
õì80211_°a
 *
°a
,

708 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
,

709 
u16
 
tid
)

711 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

712 
©h9k_htc_èrgë_aggr
 
aggr
;

713 
©h9k_htc_°a
 *
i°a
;

714 
ªt
 = 0;

715 
u8
 
cmd_r•
;

717 i‡(
tid
 >
ATH9K_HTC_MAX_TID
)

718  -
EINVAL
;

720 
	`mem£t
(&
aggr
, 0, (
©h9k_htc_èrgë_aggr
));

721 
i°a
 = (
©h9k_htc_°a
 *Ë
°a
->
drv_¥iv
;

723 
aggr
.
°a_ödex
 = 
i°a
->
ödex
;

724 
aggr
.
tidno
 = 
tid
 & 0xf;

725 
aggr
.
aggr_íabÀ
 = (
a˘i⁄
 =
IEEE80211_AMPDU_TX_START
Ë? 
åue
 : 
Ál£
;

727 
	`WMI_CMD_BUF
(
WMI_TX_AGGR_ENABLE_CMDID
, &
aggr
);

728 i‡(
ªt
)

729 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

731 (
aggr
.
aggr_íabÀ
Ë? "°¨t" : "°›", 
°a
->
addr
, 
tid
);

733 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

735 (
aggr
.
aggr_íabÀ
) ? "Starting" : "Stopping",

736 
°a
->
addr
, 
tid
);

738 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

739 
i°a
->
tid_°©e
[
tid
] = (
aggr
.
aggr_íabÀ
 && !
ªt
Ë? 
AGGR_START
 : 
AGGR_STOP
;

740 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

742  
ªt
;

743 
	}
}

749 
	$©h9k_htc_°¨t_™i
(
©h9k_htc_¥iv
 *
¥iv
)

751 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

752 
time°amp
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

754 
comm⁄
->
™i
.
l⁄gˇl_timî
 = 
time°amp
;

755 
comm⁄
->
™i
.
sh‹tˇl_timî
 = 
time°amp
;

756 
comm⁄
->
™i
.
check™i_timî
 = 
time°amp
;

758 
	`£t_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
);

760 
	`õì80211_queue_dñayed_w‹k
(
comm⁄
->
hw
, &
¥iv
->
™i_w‹k
,

761 
	`m£cs_to_jiffõs
(
ATH_ANI_POLLINTERVAL
));

762 
	}
}

764 
	$©h9k_htc_°›_™i
(
©h9k_htc_¥iv
 *
¥iv
)

766 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

767 
	`ˇn˚l_dñayed_w‹k_sync
(&
¥iv
->
™i_w‹k
);

768 
	`˛ór_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
);

769 
	}
}

771 
	$©h9k_htc_™i_w‹k
(
w‹k_°ru˘
 *
w‹k
)

773 
©h9k_htc_¥iv
 *
¥iv
 =

774 
	`c⁄èöî_of
(
w‹k
, 
©h9k_htc_¥iv
, 
™i_w‹k
.work);

775 
©h_hw
 *
ah
 = 
¥iv
->ah;

776 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

777 
boﬁ
 
l⁄gˇl
 = 
Ál£
;

778 
boﬁ
 
sh‹tˇl
 = 
Ál£
;

779 
boﬁ
 
™iÊag
 = 
Ál£
;

780 
time°amp
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

781 
u32
 
ˇl_öãrvÆ
, 
sh‹t_ˇl_öãrvÆ
;

783 
sh‹t_ˇl_öãrvÆ
 = (
ah
->
›mode
 =
NL80211_IFTYPE_AP
) ?

784 
ATH_AP_SHORT_CALINTERVAL
 : 
ATH_STA_SHORT_CALINTERVAL
;

787 i‡(
ah
->
powî_mode
 !
ATH9K_PM_AWAKE
)

788 
£t_timî
;

791 i‡((
time°amp
 - 
comm⁄
->
™i
.
l⁄gˇl_timî
Ë>
ATH_LONG_CALINTERVAL
) {

792 
l⁄gˇl
 = 
åue
;

793 
	`©h_dbg
(
comm⁄
, 
ANI
, "l⁄gˇ»@%lu\n", 
jiffõs
);

794 
comm⁄
->
™i
.
l⁄gˇl_timî
 = 
time°amp
;

801 i‡(
comm⁄
->
™i
.
ˇld⁄e
 <= 0) {

802 i‡((
time°amp
 - 
comm⁄
->
™i
.
sh‹tˇl_timî
) >=

803 
sh‹t_ˇl_öãrvÆ
) {

804 
sh‹tˇl
 = 
åue
;

805 
	`©h_dbg
(
comm⁄
, 
ANI
, "sh‹tˇ»@%lu\n", 
jiffõs
);

806 
comm⁄
->
™i
.
sh‹tˇl_timî
 = 
time°amp
;

807 
comm⁄
->
™i
.
ª£tˇl_timî
 = 
time°amp
;

810 i‡((
time°amp
 - 
comm⁄
->
™i
.
ª£tˇl_timî
) >=

811 
ATH_RESTART_CALINTERVAL
) {

812 
comm⁄
->
™i
.
ˇld⁄e
 = 
	`©h9k_hw_ª£t_ˇlvÆid
(
ah
);

813 i‡(
comm⁄
->
™i
.
ˇld⁄e
)

814 
comm⁄
->
™i
.
ª£tˇl_timî
 = 
time°amp
;

819 i‡((
time°amp
 - 
comm⁄
->
™i
.
check™i_timî
Ë>
ATH_ANI_POLLINTERVAL
) {

820 
™iÊag
 = 
åue
;

821 
comm⁄
->
™i
.
check™i_timî
 = 
time°amp
;

825 i‡(
l⁄gˇl
 || 
sh‹tˇl
 || 
™iÊag
) {

827 
	`©h9k_htc_ps_wakeup
(
¥iv
);

830 i‡(
™iÊag
)

831 
	`©h9k_hw_™i_m⁄ô‹
(
ah
,áh->
curch™
);

834 i‡(
l⁄gˇl
 || 
sh‹tˇl
)

835 
comm⁄
->
™i
.
ˇld⁄e
 =

836 
	`©h9k_hw_ˇlibøã
(
ah
,áh->
curch™
,

837 
ah
->
rxchaömask
, 
l⁄gˇl
) > 0;

839 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

842 
£t_timî
:

848 
ˇl_öãrvÆ
 = 
ATH_LONG_CALINTERVAL
;

849 
ˇl_öãrvÆ
 = 
	`mö
(ˇl_öãrvÆ, (
u32
)
ATH_ANI_POLLINTERVAL
);

854 i‡(
comm⁄
->
™i
.
ˇld⁄e
 <= 0)

855 
ˇl_öãrvÆ
 = 
	`mö
(ˇl_öãrvÆ, (
u32
)
sh‹t_ˇl_öãrvÆ
);

857 
	`õì80211_queue_dñayed_w‹k
(
comm⁄
->
hw
, &
¥iv
->
™i_w‹k
,

858 
	`m£cs_to_jiffõs
(
ˇl_öãrvÆ
));

859 
	}
}

865 
	$©h9k_htc_tx
(
õì80211_hw
 *
hw
,

866 
õì80211_tx_c⁄åﬁ
 *
c⁄åﬁ
,

867 
sk_buff
 *
skb
)

869 
õì80211_hdr
 *
hdr
;

870 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

871 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

872 
∑dpos
, 
∑dsize
, 
ªt
, 
¶Ÿ
;

874 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

877 
∑dpos
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

878 
∑dsize
 = 
∑dpos
 & 3;

879 i‡(
∑dsize
 && 
skb
->
Àn
 > 
∑dpos
) {

880 i‡(
	`skb_hódroom
(
skb
Ë< 
∑dsize
) {

881 
	`©h_dbg
(
comm⁄
, 
XMIT
, "NoÑoom forÖadding\n");

882 
Áû_tx
;

884 
	`skb_push
(
skb
, 
∑dsize
);

885 
	`memmove
(
skb
->
d©a
, skb->d©®+ 
∑dsize
, 
∑dpos
);

888 
¶Ÿ
 = 
	`©h9k_htc_tx_gë_¶Ÿ
(
¥iv
);

889 i‡(
¶Ÿ
 < 0) {

890 
	`©h_dbg
(
comm⁄
, 
XMIT
, "No free TX slot\n");

891 
Áû_tx
;

894 
ªt
 = 
	`©h9k_htc_tx_°¨t
(
¥iv
, 
c⁄åﬁ
->
°a
, 
skb
, 
¶Ÿ
, 
Ál£
);

895 i‡(
ªt
 != 0) {

896 
	`©h_dbg
(
comm⁄
, 
XMIT
, "Tx failed\n");

897 
˛ór_¶Ÿ
;

900 
	`©h9k_htc_check_°›_queues
(
¥iv
);

904 
˛ór_¶Ÿ
:

905 
	`©h9k_htc_tx_˛ór_¶Ÿ
(
¥iv
, 
¶Ÿ
);

906 
Áû_tx
:

907 
	`dev_k‰ì_skb_™y
(
skb
);

908 
	}
}

910 
	$©h9k_htc_°¨t
(
õì80211_hw
 *
hw
)

912 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

913 
©h_hw
 *
ah
 = 
¥iv
->ah;

914 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

915 
õì80211_ch™√l
 *
curch™
 = 
hw
->
c⁄f
.
ch™def
.
ch™
;

916 
©h9k_ch™√l
 *
öô_ch™√l
;

917 
ªt
 = 0;

918 
htc_phymode
 
mode
;

919 
__be16
 
htc_mode
;

920 
u8
 
cmd_r•
;

922 
	`muãx_lock
(&
¥iv
->
muãx
);

924 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

926 
curch™
->
˚¡î_‰eq
);

929 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_AWAKE
);

930 
	`WMI_CMD
(
WMI_FLUSH_RECV_CMDID
);

933 
öô_ch™√l
 = 
	`©h9k_cmn_gë_ch™√l
(
hw
, 
ah
, &hw->
c⁄f
.
ch™def
);

935 
ªt
 = 
	`©h9k_hw_ª£t
(
ah
, 
öô_ch™√l
,áh->
ˇld©a
, 
Ál£
);

936 i‡(
ªt
) {

937 
	`©h_îr
(
comm⁄
,

939 
ªt
, 
curch™
->
˚¡î_‰eq
);

940 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

941  
ªt
;

944 
	`©h9k_cmn_upd©e_txpow
(
ah
, 
¥iv
->
cuπxpow
,Öriv->
txpowlimô
,

945 &
¥iv
->
cuπxpow
);

947 
mode
 = 
	`©h9k_htc_gë_curmode
(
¥iv
, 
öô_ch™√l
);

948 
htc_mode
 = 
	`˝u_to_be16
(
mode
);

949 
	`WMI_CMD_BUF
(
WMI_SET_MODE_CMDID
, &
htc_mode
);

950 
	`WMI_CMD
(
WMI_ATH_INIT_CMDID
);

951 
	`WMI_CMD
(
WMI_START_RECV_CMDID
);

953 
	`©h9k_ho°_rx_öô
(
¥iv
);

955 
ªt
 = 
	`©h9k_htc_upd©e_ˇp_èrgë
(
¥iv
, 0);

956 i‡(
ªt
)

957 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

960 
	`˛ór_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

961 
	`htc_°¨t
(
¥iv
->
htc
);

963 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

964 
¥iv
->
tx
.
Êags
 &~
ATH9K_HTC_OP_TX_QUEUES_STOP
;

965 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

967 
	`õì80211_wake_queues
(
hw
);

969 
	`mod_timî
(&
¥iv
->
tx
.
˛ónup_timî
,

970 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ATH9K_HTC_TX_CLEANUP_INTERVAL
));

972 
	`©h9k_htc_°¨t_btc€x
(
¥iv
);

974 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

976  
ªt
;

977 
	}
}

979 
	$©h9k_htc_°›
(
õì80211_hw
 *
hw
)

981 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

982 
©h_hw
 *
ah
 = 
¥iv
->ah;

983 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

984 
ªt
 
	`__©åibuã__
 ((
unu£d
));

985 
u8
 
cmd_r•
;

987 
	`muãx_lock
(&
¥iv
->
muãx
);

989 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

990 
	`©h_dbg
(
comm⁄
, 
ANY
, "DeviceÇotÖresent\n");

991 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

995 
	`©h9k_htc_ps_wakeup
(
¥iv
);

997 
	`WMI_CMD
(
WMI_DISABLE_INTR_CMDID
);

998 
	`WMI_CMD
(
WMI_DRAIN_TXQ_ALL_CMDID
);

999 
	`WMI_CMD
(
WMI_STOP_RECV_CMDID
);

1001 
	`èskÀt_kûl
(&
¥iv
->
rx_èskÀt
);

1003 
	`dñ_timî_sync
(&
¥iv
->
tx
.
˛ónup_timî
);

1004 
	`©h9k_htc_tx_døö
(
¥iv
);

1005 
	`©h9k_wmi_evít_døö
(
¥iv
);

1007 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1010 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
Áèl_w‹k
);

1011 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
ps_w‹k
);

1013 #ifde‡
CPTCFG_MAC80211_LEDS


1014 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
Àd_w‹k
);

1016 
	`©h9k_htc_°›_™i
(
¥iv
);

1018 
	`muãx_lock
(&
¥iv
->
muãx
);

1020 
	`©h9k_htc_°›_btc€x
(
¥iv
);

1023 i‡(
¥iv
->
ah
->
is_m⁄ô‹ög
)

1024 
	`©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
¥iv
);

1026 
	`©h9k_hw_phy_dißbÀ
(
ah
);

1027 
	`©h9k_hw_dißbÀ
(
ah
);

1028 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1029 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_FULL_SLEEP
);

1031 
	`£t_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

1033 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Driver halt\n");

1034 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1035 
	}
}

1037 
	$©h9k_htc_add_öãrÁ˚
(
õì80211_hw
 *
hw
,

1038 
õì80211_vif
 *
vif
)

1040 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1041 
©h9k_htc_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1042 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1043 
©h9k_htc_èrgë_vif
 
hvif
;

1044 
ªt
 = 0;

1045 
u8
 
cmd_r•
;

1047 
	`muãx_lock
(&
¥iv
->
muãx
);

1049 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1050 
	`mem£t
(&
hvif
, 0, (
©h9k_htc_èrgë_vif
));

1051 
	`mem˝y
(&
hvif
.
myaddr
, 
vif
->
addr
, 
ETH_ALEN
);

1053 
vif
->
ty≥
) {

1054 
NL80211_IFTYPE_STATION
:

1055 
hvif
.
›mode
 = 
HTC_M_STA
;

1057 
NL80211_IFTYPE_ADHOC
:

1058 
hvif
.
›mode
 = 
HTC_M_IBSS
;

1060 
NL80211_IFTYPE_AP
:

1061 
hvif
.
›mode
 = 
HTC_M_HOSTAP
;

1063 
NL80211_IFTYPE_MESH_POINT
:

1064 
hvif
.
›mode
 = 
HTC_M_WDS
;

1067 
	`©h_îr
(
comm⁄
,

1068 "I¡îÁ˚Åy≥ %dÇŸ yë suµ‹ãd\n", 
vif
->
ty≥
);

1069 
ªt
 = -
EOPNOTSUPP
;

1070 
out
;

1074 
avp
->
ödex
 = 
hvif
.ödex = 
	`ffz
(
¥iv
->
vif_¶Ÿ
);

1075 
hvif
.
π°hªshﬁd
 = 
	`˝u_to_be16
(2304);

1076 
	`WMI_CMD_BUF
(
WMI_VAP_CREATE_CMDID
, &
hvif
);

1077 i‡(
ªt
)

1078 
out
;

1084 
ªt
 = 
	`©h9k_htc_add_°©i⁄
(
¥iv
, 
vif
, 
NULL
);

1085 i‡(
ªt
) {

1086 
	`WMI_CMD_BUF
(
WMI_VAP_REMOVE_CMDID
, &
hvif
);

1087 
out
;

1090 
	`©h9k_htc_£t_mac_bssid_mask
(
¥iv
, 
vif
);

1092 
¥iv
->
vif_¶Ÿ
 |(1 << 
avp
->
ödex
);

1093 
¥iv
->
nvifs
++;

1095 
	`INC_VIF
(
¥iv
, 
vif
->
ty≥
);

1097 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) ||

1098 (
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
) ||

1099 (
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

1100 
	`©h9k_htc_assign_b¶Ÿ
(
¥iv
, 
vif
);

1102 
	`©h9k_htc_£t_›mode
(
¥iv
);

1104 i‡((
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_AP
) &&

1105 !
	`ã°_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
)) {

1106 
	`©h9k_hw_£t_tsÁdju°
(
¥iv
->
ah
, 
åue
);

1107 
	`©h9k_htc_°¨t_™i
(
¥iv
);

1110 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Attachá VIF ofÅype: %dát idx: %d\n",

1111 
vif
->
ty≥
, 
avp
->
ödex
);

1113 
out
:

1114 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1115 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1117  
ªt
;

1118 
	}
}

1120 
	$©h9k_htc_ªmove_öãrÁ˚
(
õì80211_hw
 *
hw
,

1121 
õì80211_vif
 *
vif
)

1123 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1124 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1125 
©h9k_htc_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1126 
©h9k_htc_èrgë_vif
 
hvif
;

1127 
ªt
 = 0;

1128 
u8
 
cmd_r•
;

1130 
	`muãx_lock
(&
¥iv
->
muãx
);

1131 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1133 
	`mem£t
(&
hvif
, 0, (
©h9k_htc_èrgë_vif
));

1134 
	`mem˝y
(&
hvif
.
myaddr
, 
vif
->
addr
, 
ETH_ALEN
);

1135 
hvif
.
ödex
 = 
avp
->index;

1136 
	`WMI_CMD_BUF
(
WMI_VAP_REMOVE_CMDID
, &
hvif
);

1137 i‡(
ªt
) {

1138 
	`©h_îr
(
comm⁄
, "UnableÅoÑemove interfaceát idx: %d\n",

1139 
avp
->
ödex
);

1141 
¥iv
->
nvifs
--;

1142 
¥iv
->
vif_¶Ÿ
 &~(1 << 
avp
->
ödex
);

1144 i‡(
¥iv
->
cß_vif
 =
vif
)

1145 
¥iv
->
cß_vif
 = 
NULL
;

1147 
	`©h9k_htc_ªmove_°©i⁄
(
¥iv
, 
vif
, 
NULL
);

1149 
	`DEC_VIF
(
¥iv
, 
vif
->
ty≥
);

1151 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) ||

1152 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
 ||

1153 (
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

1154 
	`©h9k_htc_ªmove_b¶Ÿ
(
¥iv
, 
vif
);

1156 
	`©h9k_htc_£t_›mode
(
¥iv
);

1158 
	`©h9k_htc_£t_mac_bssid_mask
(
¥iv
, 
vif
);

1163 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_AP
Ë&& (
¥iv
->
num_≠_vif
 == 0)) {

1164 
¥iv
->
ª¨m_™i
 = 
Ál£
;

1165 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

1166 
¥iv
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

1167 
©h9k_htc_vif_ôî
, 
¥iv
);

1168 i‡(!
¥iv
->
ª¨m_™i
)

1169 
	`©h9k_htc_°›_™i
(
¥iv
);

1172 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Dëach I¡îÁ˚áàidx: %d\n", 
avp
->
ödex
);

1174 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1175 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1176 
	}
}

1178 
	$©h9k_htc_c⁄fig
(
õì80211_hw
 *
hw
, 
u32
 
ch™ged
)

1180 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1181 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1182 
õì80211_c⁄f
 *
c⁄f
 = &
hw
->conf;

1183 
boﬁ
 
chù_ª£t
 = 
Ál£
;

1184 
ªt
 = 0;

1186 
	`muãx_lock
(&
¥iv
->
muãx
);

1187 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1189 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_IDLE
) {

1190 
	`muãx_lock
(&
¥iv
->
htc_pm_lock
);

1192 
¥iv
->
ps_idÀ
 = !!(
c⁄f
->
Êags
 & 
IEEE80211_CONF_IDLE
);

1193 i‡(!
¥iv
->
ps_idÀ
)

1194 
chù_ª£t
 = 
åue
;

1196 
	`muãx_u∆ock
(&
¥iv
->
htc_pm_lock
);

1203 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_MONITOR
) {

1204 i‡((
c⁄f
->
Êags
 & 
IEEE80211_CONF_MONITOR
) &&

1205 !
¥iv
->
ah
->
is_m⁄ô‹ög
)

1206 
	`©h9k_htc_add_m⁄ô‹_öãrÁ˚
(
¥iv
);

1207 i‡(
¥iv
->
ah
->
is_m⁄ô‹ög
)

1208 
	`©h9k_htc_ªmove_m⁄ô‹_öãrÁ˚
(
¥iv
);

1211 i‡((
ch™ged
 & 
IEEE80211_CONF_CHANGE_CHANNEL
Ë|| 
chù_ª£t
) {

1212 
õì80211_ch™√l
 *
curch™
 = 
hw
->
c⁄f
.
ch™def
.
ch™
;

1213 
pos
 = 
curch™
->
hw_vÆue
;

1215 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Set channel: %d MHz\n",

1216 
curch™
->
˚¡î_‰eq
);

1218 
	`©h9k_cmn_gë_ch™√l
(
hw
, 
¥iv
->
ah
, &hw->
c⁄f
.
ch™def
);

1219 i‡(
	`©h9k_htc_£t_ch™√l
(
¥iv
, 
hw
, &¥iv->
ah
->
ch™√ls
[
pos
]) < 0) {

1220 
	`©h_îr
(
comm⁄
, "UnableÅo set channel\n");

1221 
ªt
 = -
EINVAL
;

1222 
out
;

1227 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_PS
) {

1228 i‡(
c⁄f
->
Êags
 & 
IEEE80211_CONF_PS
) {

1229 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_NETWORK_SLEEP
);

1230 
¥iv
->
ps_íabÀd
 = 
åue
;

1232 
¥iv
->
ps_íabÀd
 = 
Ál£
;

1233 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
ps_w‹k
);

1234 
	`©h9k_htc_£çowî
(
¥iv
, 
ATH9K_PM_AWAKE
);

1238 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_POWER
) {

1239 
¥iv
->
txpowlimô
 = 2 * 
c⁄f
->
powî_Àvñ
;

1240 
	`©h9k_cmn_upd©e_txpow
(
¥iv
->
ah
,Öriv->
cuπxpow
,

1241 
¥iv
->
txpowlimô
, &¥iv->
cuπxpow
);

1244 
out
:

1245 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1246 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1247  
ªt
;

1248 
	}
}

1250 
	#SUPPORTED_FILTERS
 \

1251 (
FIF_ALLMULTI
 | \

1252 
FIF_CONTROL
 | \

1253 
FIF_PSPOLL
 | \

1254 
FIF_OTHER_BSS
 | \

1255 
FIF_BCN_PRBRESP_PROMISC
 | \

1256 
FIF_PROBE_REQ
 | \

1257 
FIF_FCSFAIL
)

	)

1259 
	$©h9k_htc_c⁄figuª_fûãr
(
õì80211_hw
 *
hw
,

1260 
ch™ged_Êags
,

1261 *
tŸÆ_Êags
,

1262 
u64
 
mu…iˇ°
)

1264 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1265 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1266 
u32
 
rfût
;

1268 
	`muãx_lock
(&
¥iv
->
muãx
);

1269 
ch™ged_Êags
 &
SUPPORTED_FILTERS
;

1270 *
tŸÆ_Êags
 &
SUPPORTED_FILTERS
;

1272 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

1273 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
¥iv
->
ah
), 
ANY
,

1275 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1278 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1280 
¥iv
->
rxfûãr
 = *
tŸÆ_Êags
;

1281 
rfût
 = 
	`©h9k_htc_ˇl¸xfûãr
(
¥iv
);

1282 
	`©h9k_hw_£åxfûãr
(
¥iv
->
ah
, 
rfût
);

1284 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
¥iv
->
ah
), 
CONFIG
, "Set HW RX filter: 0x%x\n",

1285 
rfût
);

1287 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1288 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1289 
	}
}

1291 
	$©h9k_htc_°a_rc_upd©e_w‹k
(
w‹k_°ru˘
 *
w‹k
)

1293 
©h9k_htc_°a
 *
i°a
 =

1294 
	`c⁄èöî_of
(
w‹k
, 
©h9k_htc_°a
, 
rc_upd©e_w‹k
);

1295 
õì80211_°a
 *
°a
 =

1296 
	`c⁄èöî_of
((*)
i°a
, 
õì80211_°a
, 
drv_¥iv
);

1297 
©h9k_htc_¥iv
 *
¥iv
 = 
i°a
->
htc_¥iv
;

1298 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1299 
©h9k_htc_èrgë_øã
 
å©e
;

1301 
	`muãx_lock
(&
¥iv
->
muãx
);

1302 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1304 
	`mem£t
(&
å©e
, 0, (
©h9k_htc_èrgë_øã
));

1305 
	`©h9k_htc_£tup_øã
(
¥iv
, 
°a
, &
å©e
);

1306 i‡(!
	`©h9k_htc_£nd_øã_cmd
(
¥iv
, &
å©e
))

1307 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1309 
°a
->
addr
, 
	`be32_to_˝u
(
å©e
.
ˇpÊags
));

1311 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1313 
°a
->
addr
);

1315 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1316 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1317 
	}
}

1319 
	$©h9k_htc_°a_add
(
õì80211_hw
 *
hw
,

1320 
õì80211_vif
 *
vif
,

1321 
õì80211_°a
 *
°a
)

1323 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1324 
©h9k_htc_°a
 *
i°a
 = (©h9k_htc_°®*Ë
°a
->
drv_¥iv
;

1325 
ªt
;

1327 
	`muãx_lock
(&
¥iv
->
muãx
);

1328 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1329 
ªt
 = 
	`©h9k_htc_add_°©i⁄
(
¥iv
, 
vif
, 
°a
);

1330 i‡(!
ªt
) {

1331 
	`INIT_WORK
(&
i°a
->
rc_upd©e_w‹k
, 
©h9k_htc_°a_rc_upd©e_w‹k
);

1332 
i°a
->
htc_¥iv
 = 
¥iv
;

1333 
	`©h9k_htc_öô_øã
(
¥iv
, 
°a
);

1335 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1336 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1338  
ªt
;

1339 
	}
}

1341 
	$©h9k_htc_°a_ªmove
(
õì80211_hw
 *
hw
,

1342 
õì80211_vif
 *
vif
,

1343 
õì80211_°a
 *
°a
)

1345 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1346 
©h9k_htc_°a
 *
i°a
 = (©h9k_htc_°®*Ë
°a
->
drv_¥iv
;

1347 
ªt
;

1349 
	`ˇn˚l_w‹k_sync
(&
i°a
->
rc_upd©e_w‹k
);

1351 
	`muãx_lock
(&
¥iv
->
muãx
);

1352 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1353 
	`htc_°a_døö
(
¥iv
->
htc
, 
i°a
->
ödex
);

1354 
ªt
 = 
	`©h9k_htc_ªmove_°©i⁄
(
¥iv
, 
vif
, 
°a
);

1355 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1356 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1358  
ªt
;

1359 
	}
}

1361 
	$©h9k_htc_°a_rc_upd©e
(
õì80211_hw
 *
hw
,

1362 
õì80211_vif
 *
vif
,

1363 
õì80211_°a
 *
°a
, 
u32
 
ch™ged
)

1365 
©h9k_htc_°a
 *
i°a
 = (©h9k_htc_°®*Ë
°a
->
drv_¥iv
;

1367 i‡(!(
ch™ged
 & 
IEEE80211_RC_SUPP_RATES_CHANGED
))

1370 
	`scheduÀ_w‹k
(&
i°a
->
rc_upd©e_w‹k
);

1371 
	}
}

1373 
	$©h9k_htc_c⁄f_tx
(
õì80211_hw
 *
hw
,

1374 
õì80211_vif
 *
vif
, 
u16
 
queue
,

1375 c⁄° 
õì80211_tx_queue_∑øms
 *
∑øms
)

1377 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1378 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1379 
©h9k_tx_queue_öfo
 
qi
;

1380 
ªt
 = 0, 
qnum
;

1382 i‡(
queue
 >
IEEE80211_NUM_ACS
)

1385 
	`muãx_lock
(&
¥iv
->
muãx
);

1386 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1388 
	`mem£t
(&
qi
, 0, (
©h9k_tx_queue_öfo
));

1390 
qi
.
tqi_aifs
 = 
∑øms
->
aifs
;

1391 
qi
.
tqi_cwmö
 = 
∑øms
->
cw_mö
;

1392 
qi
.
tqi_cwmax
 = 
∑øms
->
cw_max
;

1393 
qi
.
tqi_bur°Time
 = 
∑øms
->
tx›
 * 32;

1395 
qnum
 = 
	`gë_hw_qnum
(
queue
, 
¥iv
->
hwq_m≠
);

1397 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1399 
queue
, 
qnum
, 
∑øms
->
aifs
,Ö¨ams->
cw_mö
,

1400 
∑øms
->
cw_max
,Ö¨ams->
tx›
);

1402 
ªt
 = 
	`©h_htc_txq_upd©e
(
¥iv
, 
qnum
, &
qi
);

1403 i‡(
ªt
) {

1404 
	`©h_îr
(
comm⁄
, "TXQ Update failed\n");

1405 
out
;

1408 i‡((
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_ADHOC
) &&

1409 (
qnum
 =
¥iv
->
hwq_m≠
[
IEEE80211_AC_BE
]))

1410 
	`©h9k_htc_bóc⁄q_c⁄fig
(
¥iv
);

1411 
out
:

1412 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1413 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1415  
ªt
;

1416 
	}
}

1418 
	$©h9k_htc_£t_key
(
õì80211_hw
 *
hw
,

1419 
£t_key_cmd
 
cmd
,

1420 
õì80211_vif
 *
vif
,

1421 
õì80211_°a
 *
°a
,

1422 
õì80211_key_c⁄f
 *
key
)

1424 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1425 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1426 
ªt
 = 0;

1428 i‡(
htc_mod∑øm_nohw¸y±
)

1429  -
ENOSPC
;

1431 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 ||

1432 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
) &&

1433 (
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
 ||

1434 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
) &&

1435 !(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

1443  -
EOPNOTSUPP
;

1446 
	`muãx_lock
(&
¥iv
->
muãx
);

1447 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Set HW Key\n");

1448 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1450 
cmd
) {

1451 
SET_KEY
:

1452 
ªt
 = 
	`©h_key_c⁄fig
(
comm⁄
, 
vif
, 
°a
, 
key
);

1453 i‡(
ªt
 >= 0) {

1454 
key
->
hw_key_idx
 = 
ªt
;

1456 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_IV
;

1457 i‡(
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
)

1458 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_MMIC
;

1459 i‡(
¥iv
->
ah
->
sw_mgmt_¸y±o_tx
 &&

1460 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
)

1461 
key
->
Êags
 |
IEEE80211_KEY_FLAG_SW_MGMT_TX
;

1462 
ªt
 = 0;

1465 
DISABLE_KEY
:

1466 
	`©h_key_dñëe
(
comm⁄
, 
key
);

1469 
ªt
 = -
EINVAL
;

1472 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1473 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1475  
ªt
;

1476 
	}
}

1478 
	$©h9k_htc_£t_bssid
(
©h9k_htc_¥iv
 *
¥iv
)

1480 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1482 
	`©h9k_hw_wrôe_associd
(
¥iv
->
ah
);

1483 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "BSSID: %pMáid: 0x%x\n",

1484 
comm⁄
->
curbssid
, comm⁄->
cuøid
);

1485 
	}
}

1487 
	$©h9k_htc_bss_ôî
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

1489 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *)
d©a
;

1490 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1491 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
vif
->bss_conf;

1493 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
Ë&& 
bss_c⁄f
->
assoc
) {

1494 
comm⁄
->
cuøid
 = 
bss_c⁄f
->
aid
;

1495 
comm⁄
->
œ°_rssi
 = 
ATH_RSSI_DUMMY_MARKER
;

1496 
	`mem˝y
(
comm⁄
->
curbssid
, 
bss_c⁄f
->
bssid
, 
ETH_ALEN
);

1497 
	`£t_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
);

1499 
	}
}

1501 
	$©h9k_htc_choo£_£t_bssid
(
©h9k_htc_¥iv
 *
¥iv
)

1503 i‡(
¥iv
->
num_°a_assoc_vif
 == 1) {

1504 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

1505 
¥iv
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

1506 
©h9k_htc_bss_ôî
, 
¥iv
);

1507 
	`©h9k_htc_£t_bssid
(
¥iv
);

1509 
	}
}

1511 
	$©h9k_htc_bss_öfo_ch™ged
(
õì80211_hw
 *
hw
,

1512 
õì80211_vif
 *
vif
,

1513 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

1514 
u32
 
ch™ged
)

1516 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1517 
©h_hw
 *
ah
 = 
¥iv
->ah;

1518 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1519 
¶Ÿtime
;

1521 
	`muãx_lock
(&
¥iv
->
muãx
);

1522 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1524 i‡(
ch™ged
 & 
BSS_CHANGED_ASSOC
) {

1525 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "BSS Changed ASSOC %d\n",

1526 
bss_c⁄f
->
assoc
);

1528 
bss_c⁄f
->
assoc
 ?

1529 
¥iv
->
num_°a_assoc_vif
++ :Öriv->num_sta_assoc_vif--;

1531 i‡(!
bss_c⁄f
->
assoc
)

1532 
	`˛ór_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
);

1534 i‡(
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) {

1535 
	`©h9k_htc_choo£_£t_bssid
(
¥iv
);

1536 i‡(
bss_c⁄f
->
assoc
 && (
¥iv
->
num_°a_assoc_vif
 == 1))

1537 
	`©h9k_htc_°¨t_™i
(
¥iv
);

1538 i‡(
¥iv
->
num_°a_assoc_vif
 == 0)

1539 
	`©h9k_htc_°›_™i
(
¥iv
);

1543 i‡(
ch™ged
 & 
BSS_CHANGED_IBSS
) {

1544 i‡(
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_ADHOC
) {

1545 
comm⁄
->
cuøid
 = 
bss_c⁄f
->
aid
;

1546 
	`mem˝y
(
comm⁄
->
curbssid
, 
bss_c⁄f
->
bssid
, 
ETH_ALEN
);

1547 
	`©h9k_htc_£t_bssid
(
¥iv
);

1551 i‡((
ch™ged
 & 
BSS_CHANGED_BEACON_ENABLED
Ë&& 
bss_c⁄f
->
íabÀ_bóc⁄
) {

1552 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "BeaconÉnabled for BSS: %pM\n",

1553 
bss_c⁄f
->
bssid
);

1554 
	`©h9k_htc_£t_tsÁdju°
(
¥iv
, 
vif
);

1555 
¥iv
->
cur_bóc⁄_c⁄f
.
íabÀ_bóc⁄
 = 1;

1556 
	`©h9k_htc_bóc⁄_c⁄fig
(
¥iv
, 
vif
);

1559 i‡((
ch™ged
 & 
BSS_CHANGED_BEACON_ENABLED
Ë&& !
bss_c⁄f
->
íabÀ_bóc⁄
) {

1564 i‡((
¥iv
->
num_≠_vif
 +Öriv->
num_mbss_vif
 <= 1) ||

1565 
¥iv
->
num_ibss_vif
) {

1566 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1568 
bss_c⁄f
->
bssid
);

1569 
¥iv
->
cur_bóc⁄_c⁄f
.
íabÀ_bóc⁄
 = 0;

1570 
	`©h9k_htc_bóc⁄_c⁄fig
(
¥iv
, 
vif
);

1574 i‡(
ch™ged
 & 
BSS_CHANGED_BEACON_INT
) {

1578 i‡(
¥iv
->
nvifs
 == 1 &&

1579 ((
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_AP
 &&

1580 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 &&

1581 
¥iv
->
num_≠_vif
 == 1) ||

1582 (
¥iv
->
ah
->
›mode
 =
NL80211_IFTYPE_MESH_POINT
 &&

1583 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
 &&

1584 
¥iv
->
num_mbss_vif
 == 1))) {

1585 
	`£t_bô
(
OP_TSF_RESET
, &
¥iv
->
›_Êags
);

1587 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1589 
bss_c⁄f
->
bssid
);

1590 
	`©h9k_htc_bóc⁄_c⁄fig
(
¥iv
, 
vif
);

1593 i‡(
ch™ged
 & 
BSS_CHANGED_ERP_SLOT
) {

1594 i‡(
bss_c⁄f
->
u£_sh‹t_¶Ÿ
)

1595 
¶Ÿtime
 = 9;

1597 
¶Ÿtime
 = 20;

1598 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

1604 
¥iv
->
bóc⁄
.
¶Ÿtime
 = slottime;

1605 
¥iv
->
bóc⁄
.
upd©e¶Ÿ
 = 
UPDATE
;

1607 
ah
->
¶Ÿtime
 = slottime;

1608 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

1612 i‡(
ch™ged
 & 
BSS_CHANGED_HT
)

1613 
	`©h9k_htc_upd©e_øã
(
¥iv
, 
vif
, 
bss_c⁄f
);

1615 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1616 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1617 
	}
}

1619 
u64
 
	$©h9k_htc_gë_tsf
(
õì80211_hw
 *
hw
,

1620 
õì80211_vif
 *
vif
)

1622 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1623 
u64
 
tsf
;

1625 
	`muãx_lock
(&
¥iv
->
muãx
);

1626 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1627 
tsf
 = 
	`©h9k_hw_gëtsf64
(
¥iv
->
ah
);

1628 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1629 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1631  
tsf
;

1632 
	}
}

1634 
	$©h9k_htc_£t_tsf
(
õì80211_hw
 *
hw
,

1635 
õì80211_vif
 *
vif
, 
u64
 
tsf
)

1637 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1639 
	`muãx_lock
(&
¥iv
->
muãx
);

1640 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1641 
	`©h9k_hw_£âsf64
(
¥iv
->
ah
, 
tsf
);

1642 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1643 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1644 
	}
}

1646 
	$©h9k_htc_ª£t_tsf
(
õì80211_hw
 *
hw
,

1647 
õì80211_vif
 *
vif
)

1649 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1651 
	`muãx_lock
(&
¥iv
->
muãx
);

1652 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1653 
	`©h9k_hw_ª£t_tsf
(
¥iv
->
ah
);

1654 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1655 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1656 
	}
}

1658 
	$©h9k_htc_ampdu_a˘i⁄
(
õì80211_hw
 *
hw
,

1659 
õì80211_vif
 *
vif
,

1660 
õì80211_ampdu_∑øms
 *
∑øms
)

1662 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1663 
©h9k_htc_°a
 *
i°a
;

1664 
ªt
 = 0;

1665 
õì80211_°a
 *
°a
 = 
∑øms
->sta;

1666 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
 = 
∑øms
->action;

1667 
u16
 
tid
 = 
∑øms
->tid;

1669 
	`muãx_lock
(&
¥iv
->
muãx
);

1670 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1672 
a˘i⁄
) {

1673 
IEEE80211_AMPDU_RX_START
:

1675 
IEEE80211_AMPDU_RX_STOP
:

1677 
IEEE80211_AMPDU_TX_START
:

1678 
ªt
 = 
	`©h9k_htc_tx_aggr_›î
(
¥iv
, 
vif
, 
°a
, 
a˘i⁄
, 
tid
);

1679 i‡(!
ªt
)

1680 
	`õì80211_°¨t_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1682 
IEEE80211_AMPDU_TX_STOP_CONT
:

1683 
IEEE80211_AMPDU_TX_STOP_FLUSH
:

1684 
IEEE80211_AMPDU_TX_STOP_FLUSH_CONT
:

1685 
	`©h9k_htc_tx_aggr_›î
(
¥iv
, 
vif
, 
°a
, 
a˘i⁄
, 
tid
);

1686 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1688 
IEEE80211_AMPDU_TX_OPERATIONAL
:

1689 
i°a
 = (
©h9k_htc_°a
 *Ë
°a
->
drv_¥iv
;

1690 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

1691 
i°a
->
tid_°©e
[
tid
] = 
AGGR_OPERATIONAL
;

1692 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

1695 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
¥iv
->
ah
), "Unknown AMPDUáction\n");

1698 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1699 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1701  
ªt
;

1702 
	}
}

1704 
	$©h9k_htc_sw_sˇn_°¨t
(
õì80211_hw
 *
hw
,

1705 
õì80211_vif
 *
vif
,

1706 c⁄° 
u8
 *
mac_addr
)

1708 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1709 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1711 
	`muãx_lock
(&
¥iv
->
muãx
);

1712 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

1713 
	`£t_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

1714 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

1715 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
ps_w‹k
);

1716 
	`©h9k_htc_°›_™i
(
¥iv
);

1717 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1718 
	}
}

1720 
	$©h9k_htc_sw_sˇn_com∂ëe
(
õì80211_hw
 *
hw
,

1721 
õì80211_vif
 *
vif
)

1723 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1724 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1726 
	`muãx_lock
(&
¥iv
->
muãx
);

1727 
	`•ö_lock_bh
(&
¥iv
->
bóc⁄_lock
);

1728 
	`˛ór_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

1729 
	`•ö_u∆ock_bh
(&
¥iv
->
bóc⁄_lock
);

1730 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1731 
	`©h9k_htc_vif_ªc⁄fig
(
¥iv
);

1732 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1733 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1734 
	}
}

1736 
	$©h9k_htc_£t_πs_thªshﬁd
(
õì80211_hw
 *
hw
, 
u32
 
vÆue
)

1739 
	}
}

1741 
	$©h9k_htc_£t_covîage_˛ass
(
õì80211_hw
 *
hw
,

1742 
s16
 
covîage_˛ass
)

1744 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1746 
	`muãx_lock
(&
¥iv
->
muãx
);

1747 
	`©h9k_htc_ps_wakeup
(
¥iv
);

1748 
¥iv
->
ah
->
covîage_˛ass
 = coverage_class;

1749 
	`©h9k_hw_öô_globÆ_£âögs
(
¥iv
->
ah
);

1750 
	`©h9k_htc_ps_ª°‹e
(
¥iv
);

1751 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1752 
	}
}

1759 
	$©h9k_htc_£t_bôøã_mask
(
õì80211_hw
 *
hw
,

1760 
õì80211_vif
 *
vif
,

1761 c⁄° 
cfg80211_bôøã_mask
 *
mask
)

1763 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1764 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

1765 
©h9k_htc_èrgë_øã_mask
 
tmask
;

1766 
©h9k_htc_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1767 
ªt
 = 0;

1768 
u8
 
cmd_r•
;

1770 
	`mem£t
(&
tmask
, 0, (
©h9k_htc_èrgë_øã_mask
));

1772 
tmask
.
vif_ödex
 = 
avp
->
ödex
;

1773 
tmask
.
b™d
 = 
IEEE80211_BAND_2GHZ
;

1774 
tmask
.
mask
 = 
	`˝u_to_be32
(mask->
c⁄åﬁ
[
IEEE80211_BAND_2GHZ
].
Àgacy
);

1776 
	`WMI_CMD_BUF
(
WMI_BITRATE_MASK_CMDID
, &
tmask
);

1777 i‡(
ªt
) {

1778 
	`©h_îr
(
comm⁄
,

1780 "öãrÁ˚áàidx: %d\n", 
avp
->
ödex
);

1781 
out
;

1784 
tmask
.
b™d
 = 
IEEE80211_BAND_5GHZ
;

1785 
tmask
.
mask
 = 
	`˝u_to_be32
(mask->
c⁄åﬁ
[
IEEE80211_BAND_5GHZ
].
Àgacy
);

1787 
	`WMI_CMD_BUF
(
WMI_BITRATE_MASK_CMDID
, &
tmask
);

1788 i‡(
ªt
) {

1789 
	`©h_îr
(
comm⁄
,

1791 "öãrÁ˚áàidx: %d\n", 
avp
->
ödex
);

1792 
out
;

1795 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Set bitrate masks: 0x%x, 0x%x\n",

1796 
mask
->
c⁄åﬁ
[
IEEE80211_BAND_2GHZ
].
Àgacy
,

1797 
mask
->
c⁄åﬁ
[
IEEE80211_BAND_5GHZ
].
Àgacy
);

1798 
out
:

1799  
ªt
;

1800 
	}
}

1803 
	$©h9k_htc_gë_°©s
(
õì80211_hw
 *
hw
,

1804 
õì80211_low_Àvñ_°©s
 *
°©s
)

1806 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1807 
©h_hw
 *
ah
 = 
¥iv
->ah;

1808 
©h9k_mib_°©s
 *
mib_°©s
 = &
ah
->
ah_mibSèts
;

1810 
°©s
->
dŸ11ACKFaûuªCou¡
 = 
mib_°©s
->
ackrcv_bad
;

1811 
°©s
->
dŸ11RTSFaûuªCou¡
 = 
mib_°©s
->
πs_bad
;

1812 
°©s
->
dŸ11FCSEº‹Cou¡
 = 
mib_°©s
->
fcs_bad
;

1813 
°©s
->
dŸ11RTSSuc˚ssCou¡
 = 
mib_°©s
->
πs_good
;

1816 
	}
}

1818 
ba£_ìp_hódî
 *
	$©h9k_htc_gë_ì¥om_ba£
(
©h9k_htc_¥iv
 *
¥iv
)

1820 
ba£_ìp_hódî
 *
pBa£
 = 
NULL
;

1827 i‡(
	`AR_SREV_9271
(
¥iv
->
ah
))

1828 
pBa£
 = (
ba£_ìp_hódî
 *)

1829 &
¥iv
->
ah
->
ì¥om
.
m≠4k
.
ba£EïHódî
;

1830 i‡(
¥iv
->
ah
->
hw_vîsi⁄
.
usbdev
 =
AR9280_USB
)

1831 
pBa£
 = (
ba£_ìp_hódî
 *)

1832 &
¥iv
->
ah
->
ì¥om
.
def
.
ba£EïHódî
;

1833 i‡(
¥iv
->
ah
->
hw_vîsi⁄
.
usbdev
 =
AR9287_USB
)

1834 
pBa£
 = (
ba£_ìp_hódî
 *)

1835 &
¥iv
->
ah
->
ì¥om
.
m≠9287
.
ba£EïHódî
;

1836  
pBa£
;

1837 
	}
}

1840 
	$©h9k_htc_gë_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 *
tx_™t
,

1841 
u32
 *
rx_™t
)

1843 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1844 
ba£_ìp_hódî
 *
pBa£
 = 
	`©h9k_htc_gë_ì¥om_ba£
(
¥iv
);

1845 i‡(
pBa£
) {

1846 *
tx_™t
 = 
pBa£
->
txMask
;

1847 *
rx_™t
 = 
pBa£
->
rxMask
;

1849 *
tx_™t
 = 0;

1850 *
rx_™t
 = 0;

1853 
	}
}

1855 
	$©h9k_htc_ch™√l_swôch_bóc⁄
(
õì80211_hw
 *
hw
,

1856 
õì80211_vif
 *
vif
,

1857 
cfg80211_ch™_def
 *
ch™def
)

1859 
©h9k_htc_¥iv
 *
¥iv
 = 
hw
->priv;

1862 i‡(
	`WARN_ON
(
¥iv
->
cß_vif
))

1865 
¥iv
->
cß_vif
 = 
vif
;

1866 
	}
}

1868 
õì80211_›s
 
	g©h9k_htc_›s
 = {

1869 .
tx
 = 
©h9k_htc_tx
,

1870 .
	g°¨t
 = 
©h9k_htc_°¨t
,

1871 .
	g°›
 = 
©h9k_htc_°›
,

1872 .
	gadd_öãrÁ˚
 = 
©h9k_htc_add_öãrÁ˚
,

1873 .
	gªmove_öãrÁ˚
 = 
©h9k_htc_ªmove_öãrÁ˚
,

1874 .
	gc⁄fig
 = 
©h9k_htc_c⁄fig
,

1875 .
	gc⁄figuª_fûãr
 = 
©h9k_htc_c⁄figuª_fûãr
,

1876 .
	g°a_add
 = 
©h9k_htc_°a_add
,

1877 .
	g°a_ªmove
 = 
©h9k_htc_°a_ªmove
,

1878 .
	gc⁄f_tx
 = 
©h9k_htc_c⁄f_tx
,

1879 .
	g°a_rc_upd©e
 = 
©h9k_htc_°a_rc_upd©e
,

1880 .
	gbss_öfo_ch™ged
 = 
©h9k_htc_bss_öfo_ch™ged
,

1881 .
	g£t_key
 = 
©h9k_htc_£t_key
,

1882 .
	ggë_tsf
 = 
©h9k_htc_gë_tsf
,

1883 .
	g£t_tsf
 = 
©h9k_htc_£t_tsf
,

1884 .
	gª£t_tsf
 = 
©h9k_htc_ª£t_tsf
,

1885 .
	gampdu_a˘i⁄
 = 
©h9k_htc_ampdu_a˘i⁄
,

1886 .
	gsw_sˇn_°¨t
 = 
©h9k_htc_sw_sˇn_°¨t
,

1887 .
	gsw_sˇn_com∂ëe
 = 
©h9k_htc_sw_sˇn_com∂ëe
,

1888 .
	g£t_πs_thªshﬁd
 = 
©h9k_htc_£t_πs_thªshﬁd
,

1889 .
	grfkûl_pﬁl
 = 
©h9k_htc_rfkûl_pﬁl_°©e
,

1890 .
	g£t_covîage_˛ass
 = 
©h9k_htc_£t_covîage_˛ass
,

1891 .
	g£t_bôøã_mask
 = 
©h9k_htc_£t_bôøã_mask
,

1892 .
	ggë_°©s
 = 
©h9k_htc_gë_°©s
,

1893 .
	ggë_™ã¬a
 = 
©h9k_htc_gë_™ã¬a
,

1894 .
	gch™√l_swôch_bóc⁄
 = 
©h9k_htc_ch™√l_swôch_bóc⁄
,

1896 #ifde‡
CPTCFG_ATH9K_HTC_DEBUGFS


1897 .
	ggë_ë_s£t_cou¡
 = 
©h9k_htc_gë_ë_s£t_cou¡
,

1898 .
	ggë_ë_°©s
 = 
©h9k_htc_gë_ë_°©s
,

1899 .
	ggë_ë_°rögs
 = 
©h9k_htc_gë_ë_°rögs
,

	@htc_drv_txrx.c

17 
	~"htc.h
"

23 c⁄° 
	gsubty≥_txq_to_hwq
[] = {

24 [
IEEE80211_AC_BE
] = 
ATH_TXQ_AC_BE
,

25 [
IEEE80211_AC_BK
] = 
ATH_TXQ_AC_BK
,

26 [
IEEE80211_AC_VI
] = 
ATH_TXQ_AC_VI
,

27 [
IEEE80211_AC_VO
] = 
ATH_TXQ_AC_VO
,

30 
	#ATH9K_HTC_INIT_TXQ
(
subty≥
) do { \

31 
qi
.
tqi_subty≥
 = 
subty≥_txq_to_hwq
[
subty≥
]; \

32 
qi
.
tqi_aifs
 = 
ATH9K_TXQ_USEDEFAULT
; \

33 
qi
.
tqi_cwmö
 = 
ATH9K_TXQ_USEDEFAULT
; \

34 
qi
.
tqi_cwmax
 = 
ATH9K_TXQ_USEDEFAULT
; \

35 
qi
.
tqi_physCompBuf
 = 0; \

36 
qi
.
tqi_qÊags
 = 
TXQ_FLAG_TXEOLINT_ENABLE
 | \

37 
TXQ_FLAG_TXDESCINT_ENABLE
; \

38 } 0)

	)

40 
	$gë_hw_qnum
(
u16
 
queue
, *
hwq_m≠
)

42 
queue
) {

44  
hwq_m≠
[
IEEE80211_AC_VO
];

46  
hwq_m≠
[
IEEE80211_AC_VI
];

48  
hwq_m≠
[
IEEE80211_AC_BE
];

50  
hwq_m≠
[
IEEE80211_AC_BK
];

52  
hwq_m≠
[
IEEE80211_AC_BE
];

54 
	}
}

56 
	$©h9k_htc_check_°›_queues
(
©h9k_htc_¥iv
 *
¥iv
)

58 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

59 
¥iv
->
tx
.
queued_˙t
++;

60 i‡((
¥iv
->
tx
.
queued_˙t
 >
ATH9K_HTC_TX_THRESHOLD
) &&

61 !(
¥iv
->
tx
.
Êags
 & 
ATH9K_HTC_OP_TX_QUEUES_STOP
)) {

62 
¥iv
->
tx
.
Êags
 |
ATH9K_HTC_OP_TX_QUEUES_STOP
;

63 
	`õì80211_°›_queues
(
¥iv
->
hw
);

65 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

66 
	}
}

68 
	$©h9k_htc_check_wake_queues
(
©h9k_htc_¥iv
 *
¥iv
)

70 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

71 i‡((
¥iv
->
tx
.
queued_˙t
 < 
ATH9K_HTC_TX_THRESHOLD
) &&

72 (
¥iv
->
tx
.
Êags
 & 
ATH9K_HTC_OP_TX_QUEUES_STOP
)) {

73 
¥iv
->
tx
.
Êags
 &~
ATH9K_HTC_OP_TX_QUEUES_STOP
;

74 
	`õì80211_wake_queues
(
¥iv
->
hw
);

76 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

77 
	}
}

79 
	$©h9k_htc_tx_gë_¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
)

81 
¶Ÿ
;

83 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

84 
¶Ÿ
 = 
	`föd_fú°_zîo_bô
(
¥iv
->
tx
.
tx_¶Ÿ
, 
MAX_TX_BUF_NUM
);

85 i‡(
¶Ÿ
 >
MAX_TX_BUF_NUM
) {

86 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

87  -
ENOBUFS
;

89 
	`__£t_bô
(
¶Ÿ
, 
¥iv
->
tx
.
tx_¶Ÿ
);

90 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

92  
¶Ÿ
;

93 
	}
}

95 
	$©h9k_htc_tx_˛ór_¶Ÿ
(
©h9k_htc_¥iv
 *
¥iv
, 
¶Ÿ
)

97 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

98 
	`__˛ór_bô
(
¶Ÿ
, 
¥iv
->
tx
.
tx_¶Ÿ
);

99 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

100 
	}
}

102 
ölöe
 
htc_ídpoöt_id
 
	$gë_htc_ïid
(
©h9k_htc_¥iv
 *
¥iv
,

103 
u16
 
qnum
)

105 
htc_ídpoöt_id
 
ïid
;

107 
qnum
) {

109 
	`TX_QSTAT_INC
(
IEEE80211_AC_VO
);

110 
ïid
 = 
¥iv
->
d©a_vo_ï
;

113 
	`TX_QSTAT_INC
(
IEEE80211_AC_VI
);

114 
ïid
 = 
¥iv
->
d©a_vi_ï
;

117 
	`TX_QSTAT_INC
(
IEEE80211_AC_BE
);

118 
ïid
 = 
¥iv
->
d©a_be_ï
;

122 
	`TX_QSTAT_INC
(
IEEE80211_AC_BK
);

123 
ïid
 = 
¥iv
->
d©a_bk_ï
;

127  
ïid
;

128 
	}
}

130 
ölöe
 
sk_buff_hód
*

131 
	$gë_htc_ïid_queue
(
©h9k_htc_¥iv
 *
¥iv
, 
u8
 
ïid
)

133 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

134 
sk_buff_hód
 *
ïid_queue
 = 
NULL
;

136 i‡(
ïid
 =
¥iv
->
mgmt_ï
)

137 
ïid_queue
 = &
¥iv
->
tx
.
mgmt_ï_queue
;

138 i‡(
ïid
 =
¥iv
->
ˇb_ï
)

139 
ïid_queue
 = &
¥iv
->
tx
.
ˇb_ï_queue
;

140 i‡(
ïid
 =
¥iv
->
d©a_be_ï
)

141 
ïid_queue
 = &
¥iv
->
tx
.
d©a_be_queue
;

142 i‡(
ïid
 =
¥iv
->
d©a_bk_ï
)

143 
ïid_queue
 = &
¥iv
->
tx
.
d©a_bk_queue
;

144 i‡(
ïid
 =
¥iv
->
d©a_vi_ï
)

145 
ïid_queue
 = &
¥iv
->
tx
.
d©a_vi_queue
;

146 i‡(
ïid
 =
¥iv
->
d©a_vo_ï
)

147 
ïid_queue
 = &
¥iv
->
tx
.
d©a_vo_queue
;

149 
	`©h_îr
(
comm⁄
, "InvÆid EPID: %d\n", 
ïid
);

151  
ïid_queue
;

152 
	}
}

157 
ölöe
 
	$°rù_drv_hódî
(
©h9k_htc_¥iv
 *
¥iv
,

158 
sk_buff
 *
skb
)

160 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

161 
©h9k_htc_tx_˘l
 *
tx_˘l
;

162 
¶Ÿ
;

164 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

166 i‡(
tx_˘l
->
ïid
 =
¥iv
->
mgmt_ï
) {

167 
tx_mgmt_hdr
 *
tx_mhdr
 =

168 (
tx_mgmt_hdr
 *)
skb
->
d©a
;

169 
¶Ÿ
 = 
tx_mhdr
->
cookõ
;

170 
	`skb_puŒ
(
skb
, (
tx_mgmt_hdr
));

171 } i‡((
tx_˘l
->
ïid
 =
¥iv
->
d©a_bk_ï
) ||

172 (
tx_˘l
->
ïid
 =
¥iv
->
d©a_be_ï
) ||

173 (
tx_˘l
->
ïid
 =
¥iv
->
d©a_vi_ï
) ||

174 (
tx_˘l
->
ïid
 =
¥iv
->
d©a_vo_ï
) ||

175 (
tx_˘l
->
ïid
 =
¥iv
->
ˇb_ï
)) {

176 
tx_‰ame_hdr
 *
tx_fhdr
 =

177 (
tx_‰ame_hdr
 *)
skb
->
d©a
;

178 
¶Ÿ
 = 
tx_fhdr
->
cookõ
;

179 
	`skb_puŒ
(
skb
, (
tx_‰ame_hdr
));

181 
	`©h_îr
(
comm⁄
, "Unsuµ‹ãd EPID: %d\n", 
tx_˘l
->
ïid
);

182 
¶Ÿ
 = -
EINVAL
;

185  
¶Ÿ
;

186 
	}
}

188 
	$©h_htc_txq_upd©e
(
©h9k_htc_¥iv
 *
¥iv
, 
qnum
,

189 
©h9k_tx_queue_öfo
 *
qöfo
)

191 
©h_hw
 *
ah
 = 
¥iv
->ah;

192 
îr‹
 = 0;

193 
©h9k_tx_queue_öfo
 
qi
;

195 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
qnum
, &
qi
);

197 
qi
.
tqi_aifs
 = 
qöfo
->tqi_aifs;

198 
qi
.
tqi_cwmö
 = 
qöfo
->tqi_cwmin / 2;

199 
qi
.
tqi_cwmax
 = 
qöfo
->tqi_cwmax;

200 
qi
.
tqi_bur°Time
 = 
qöfo
->tqi_burstTime;

201 
qi
.
tqi_ªadyTime
 = 
qöfo
->tqi_readyTime;

203 i‡(!
	`©h9k_hw_£t_txq_¥›s
(
ah
, 
qnum
, &
qi
)) {

204 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

205 "U«bÀÅÿupd©êh¨dw¨êqueuê%u!\n", 
qnum
);

206 
îr‹
 = -
EIO
;

208 
	`©h9k_hw_ª£âxqueue
(
ah
, 
qnum
);

211  
îr‹
;

212 
	}
}

214 
	$©h9k_htc_tx_mgmt
(
©h9k_htc_¥iv
 *
¥iv
,

215 
©h9k_htc_vif
 *
avp
,

216 
sk_buff
 *
skb
,

217 
u8
 
°a_idx
, u8 
vif_idx
, u8 
¶Ÿ
)

219 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

220 
õì80211_mgmt
 *
mgmt
;

221 
õì80211_hdr
 *
hdr
;

222 
tx_mgmt_hdr
 
mgmt_hdr
;

223 
©h9k_htc_tx_˘l
 *
tx_˘l
;

224 
u8
 *
tx_fhdr
;

226 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

227 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

229 
	`mem£t
(
tx_˘l
, 0, (*tx_ctl));

230 
	`mem£t
(&
mgmt_hdr
, 0, (
tx_mgmt_hdr
));

236 i‡(
avp
 && 
	`u∆ikñy
(
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
))) {

237 
mgmt
 = (
õì80211_mgmt
 *)
skb
->
d©a
;

238 
mgmt
->
u
.
¥obe_ª•
.
time°amp
 = 
avp
->
tsÁdju°
;

241 
tx_˘l
->
ty≥
 = 
ATH9K_HTC_MGMT
;

243 
mgmt_hdr
.
node_idx
 = 
°a_idx
;

244 
mgmt_hdr
.
vif_idx
 = vif_idx;

245 
mgmt_hdr
.
tidno
 = 0;

246 
mgmt_hdr
.
Êags
 = 0;

247 
mgmt_hdr
.
cookõ
 = 
¶Ÿ
;

249 
mgmt_hdr
.
key_ty≥
 = 
	`©h9k_cmn_gë_hw_¸y±o_keyty≥
(
skb
);

250 i‡(
mgmt_hdr
.
key_ty≥
 =
ATH9K_KEY_TYPE_CLEAR
)

251 
mgmt_hdr
.
keyix
 = (
u8
Ë
ATH9K_TXKEYIX_INVALID
;

253 
mgmt_hdr
.
keyix
 = 
tx_öfo
->
c⁄åﬁ
.
hw_key
->
hw_key_idx
;

255 
tx_fhdr
 = 
	`skb_push
(
skb
, (
mgmt_hdr
));

256 
	`mem˝y
(
tx_fhdr
, (
u8
 *Ë&
mgmt_hdr
, (mgmt_hdr));

257 
tx_˘l
->
ïid
 = 
¥iv
->
mgmt_ï
;

258 
	}
}

260 
	$©h9k_htc_tx_d©a
(
©h9k_htc_¥iv
 *
¥iv
,

261 
õì80211_vif
 *
vif
,

262 
sk_buff
 *
skb
,

263 
u8
 
°a_idx
, u8 
vif_idx
, u8 
¶Ÿ
,

264 
boﬁ
 
is_ˇb
)

266 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

267 
õì80211_hdr
 *
hdr
;

268 
©h9k_htc_tx_˘l
 *
tx_˘l
;

269 
tx_‰ame_hdr
 
tx_hdr
;

270 
u32
 
Êags
 = 0;

271 
u8
 *
qc
, *
tx_fhdr
;

272 
u16
 
qnum
;

274 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

275 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

277 
	`mem£t
(
tx_˘l
, 0, (*tx_ctl));

278 
	`mem£t
(&
tx_hdr
, 0, (
tx_‰ame_hdr
));

280 
tx_hdr
.
node_idx
 = 
°a_idx
;

281 
tx_hdr
.
vif_idx
 = vif_idx;

282 
tx_hdr
.
cookõ
 = 
¶Ÿ
;

290 
tx_˘l
->
°a_idx
 = sta_idx;

292 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
) {

293 
tx_˘l
->
ty≥
 = 
ATH9K_HTC_AMPDU
;

294 
tx_hdr
.
d©a_ty≥
 = 
ATH9K_HTC_AMPDU
;

296 
tx_˘l
->
ty≥
 = 
ATH9K_HTC_NORMAL
;

297 
tx_hdr
.
d©a_ty≥
 = 
ATH9K_HTC_NORMAL
;

300 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

301 
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

302 
tx_hdr
.
tidno
 = 
qc
[0] & 
IEEE80211_QOS_CTL_TID_MASK
;

306 i‡(
¥iv
->
hw
->
wùhy
->
πs_thªshﬁd
 !(
u32
) -1)

307 i‡(
skb
->
Àn
 > 
¥iv
->
hw
->
wùhy
->
πs_thªshﬁd
)

308 
Êags
 |
ATH9K_HTC_TX_RTSCTS
;

311 i‡(!(
Êags
 & 
ATH9K_HTC_TX_RTSCTS
) &&

312 (
vif
 && vif->
bss_c⁄f
.
u£_˘s_¥Ÿ
))

313 
Êags
 |
ATH9K_HTC_TX_CTSONLY
;

315 
tx_hdr
.
Êags
 = 
	`˝u_to_be32
(flags);

316 
tx_hdr
.
key_ty≥
 = 
	`©h9k_cmn_gë_hw_¸y±o_keyty≥
(
skb
);

317 i‡(
tx_hdr
.
key_ty≥
 =
ATH9K_KEY_TYPE_CLEAR
)

318 
tx_hdr
.
keyix
 = (
u8
Ë
ATH9K_TXKEYIX_INVALID
;

320 
tx_hdr
.
keyix
 = 
tx_öfo
->
c⁄åﬁ
.
hw_key
->
hw_key_idx
;

322 
tx_fhdr
 = 
	`skb_push
(
skb
, (
tx_hdr
));

323 
	`mem˝y
(
tx_fhdr
, (
u8
 *Ë&
tx_hdr
, (tx_hdr));

325 i‡(
is_ˇb
) {

326 
CAB_STAT_INC
;

327 
tx_˘l
->
ïid
 = 
¥iv
->
ˇb_ï
;

331 
qnum
 = 
	`skb_gë_queue_m≠pög
(
skb
);

332 
tx_˘l
->
ïid
 = 
	`gë_htc_ïid
(
¥iv
, 
qnum
);

333 
	}
}

335 
	$©h9k_htc_tx_°¨t
(
©h9k_htc_¥iv
 *
¥iv
,

336 
õì80211_°a
 *
°a
,

337 
sk_buff
 *
skb
,

338 
u8
 
¶Ÿ
, 
boﬁ
 
is_ˇb
)

340 
õì80211_hdr
 *
hdr
;

341 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

342 
õì80211_vif
 *
vif
 = 
tx_öfo
->
c⁄åﬁ
.vif;

343 
©h9k_htc_°a
 *
i°a
;

344 
©h9k_htc_vif
 *
avp
 = 
NULL
;

345 
u8
 
°a_idx
, 
vif_idx
;

347 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

353 i‡(
vif
) {

354 
avp
 = (
©h9k_htc_vif
 *Ë
vif
->
drv_¥iv
;

355 
vif_idx
 = 
avp
->
ödex
;

357 i‡(!
¥iv
->
ah
->
is_m⁄ô‹ög
) {

358 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
¥iv
->
ah
), 
XMIT
,

360  -
EINVAL
;

363 
vif_idx
 = 
¥iv
->
m⁄_vif_idx
;

369 i‡(
°a
) {

370 
i°a
 = (
©h9k_htc_°a
 *Ë
°a
->
drv_¥iv
;

371 
°a_idx
 = 
i°a
->
ödex
;

373 
°a_idx
 = 
¥iv
->
vif_°a_pos
[
vif_idx
];

376 i‡(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

377 
	`©h9k_htc_tx_d©a
(
¥iv
, 
vif
, 
skb
,

378 
°a_idx
, 
vif_idx
, 
¶Ÿ
, 
is_ˇb
);

380 
	`©h9k_htc_tx_mgmt
(
¥iv
, 
avp
, 
skb
,

381 
°a_idx
, 
vif_idx
, 
¶Ÿ
);

384  
	`htc_£nd
(
¥iv
->
htc
, 
skb
);

385 
	}
}

387 
ölöe
 
boﬁ
 
	$__©h9k_htc_check_tx_aggr
(
©h9k_htc_¥iv
 *
¥iv
,

388 
©h9k_htc_°a
 *
i°a
, 
u8
 
tid
)

390 
boﬁ
 
ªt
 = 
Ál£
;

392 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

393 i‡((
tid
 < 
ATH9K_HTC_MAX_TID
Ë&& (
i°a
->
tid_°©e
[tid] =
AGGR_STOP
))

394 
ªt
 = 
åue
;

395 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

397  
ªt
;

398 
	}
}

400 
	$©h9k_htc_check_tx_aggr
(
©h9k_htc_¥iv
 *
¥iv
,

401 
õì80211_vif
 *
vif
,

402 
sk_buff
 *
skb
)

404 
õì80211_°a
 *
°a
;

405 
õì80211_hdr
 *
hdr
;

406 
__À16
 
fc
;

408 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

409 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

411 
	`rcu_ªad_lock
();

413 
°a
 = 
	`õì80211_föd_°a
(
vif
, 
hdr
->
addr1
);

414 i‡(!
°a
) {

415 
	`rcu_ªad_u∆ock
();

419 i‡(
°a
 && 
	`c⁄f_is_ht
(&
¥iv
->
hw
->
c⁄f
) &&

420 !(
skb
->
¥Ÿocﬁ
 =
	`˝u_to_be16
(
ETH_P_PAE
))) {

421 i‡(
	`õì80211_is_d©a_qos
(
fc
)) {

422 
u8
 *
qc
, 
tid
;

423 
©h9k_htc_°a
 *
i°a
;

425 
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

426 
tid
 = 
qc
[0] & 0xf;

427 
i°a
 = (
©h9k_htc_°a
 *)
°a
->
drv_¥iv
;

428 i‡(
	`__©h9k_htc_check_tx_aggr
(
¥iv
, 
i°a
, 
tid
)) {

429 
	`õì80211_°¨t_tx_ba_£ssi⁄
(
°a
, 
tid
, 0);

430 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

431 
i°a
->
tid_°©e
[
tid
] = 
AGGR_PROGRESS
;

432 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

437 
	`rcu_ªad_u∆ock
();

438 
	}
}

440 
	$©h9k_htc_tx_¥o˚ss
(
©h9k_htc_¥iv
 *
¥iv
,

441 
sk_buff
 *
skb
,

442 
__wmi_evít_tx°©us
 *
txs
)

444 
õì80211_vif
 *
vif
;

445 
©h9k_htc_tx_˘l
 *
tx_˘l
;

446 
õì80211_tx_öfo
 *
tx_öfo
;

447 
õì80211_tx_øã
 *
øã
;

448 
õì80211_c⁄f
 *
cur_c⁄f
 = &
¥iv
->
hw
->
c⁄f
;

449 
boﬁ
 
txok
;

450 
¶Ÿ
;

451 
hdæí
, 
∑dsize
;

453 
¶Ÿ
 = 
	`°rù_drv_hódî
(
¥iv
, 
skb
);

454 i‡(
¶Ÿ
 < 0) {

455 
	`dev_k‰ì_skb_™y
(
skb
);

459 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

460 
txok
 = 
tx_˘l
->txok;

461 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

462 
vif
 = 
tx_öfo
->
c⁄åﬁ
.vif;

463 
øã
 = &
tx_öfo
->
°©us
.
øãs
[0];

465 
	`mem£t
(&
tx_öfo
->
°©us
, 0, (tx_info->status));

471 i‡(!
txok
 || !
vif
 || !
txs
)

472 
£nd_mac80211
;

474 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_ACK
) {

475 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

476 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)

477 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU
;

480 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_FILT
)

481 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_TX_FILTERED
;

483 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_RTC_CTS
)

484 
øã
->
Êags
 |
IEEE80211_TX_RC_USE_RTS_CTS
;

486 
øã
->
cou¡
 = 1;

487 
øã
->
idx
 = 
	`MS
(
txs
->
ts_øã
, 
ATH9K_HTC_TXSTAT_RATE
);

489 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_MCS
) {

490 
øã
->
Êags
 |
IEEE80211_TX_RC_MCS
;

492 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_CW40
)

493 
øã
->
Êags
 |
IEEE80211_TX_RC_40_MHZ_WIDTH
;

494 i‡(
txs
->
ts_Êags
 & 
ATH9K_HTC_TXSTAT_SGI
)

495 
øã
->
Êags
 |
IEEE80211_TX_RC_SHORT_GI
;

497 i‡(
cur_c⁄f
->
ch™def
.
ch™
->
b™d
 =
IEEE80211_BAND_5GHZ
)

498 
øã
->
idx
 += 4;

501 
	`©h9k_htc_check_tx_aggr
(
¥iv
, 
vif
, 
skb
);

503 
£nd_mac80211
:

504 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

505 i‡(
	`WARN_ON
(--
¥iv
->
tx
.
queued_˙t
 < 0))

506 
¥iv
->
tx
.
queued_˙t
 = 0;

507 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

509 
	`©h9k_htc_tx_˛ór_¶Ÿ
(
¥iv
, 
¶Ÿ
);

512 
hdæí
 = 
	`õì80211_gë_hdæí_‰om_skb
(
skb
);

514 
∑dsize
 = 
hdæí
 & 3;

515 i‡(
∑dsize
 && 
skb
->
Àn
 > 
hdæí
 +Öadsize) {

516 
	`memmove
(
skb
->
d©a
 + 
∑dsize
, skb->d©a, 
hdæí
);

517 
	`skb_puŒ
(
skb
, 
∑dsize
);

521 
	`õì80211_tx_°©us
(
¥iv
->
hw
, 
skb
);

522 
	}
}

524 
ölöe
 
	$©h9k_htc_tx_døöq
(
©h9k_htc_¥iv
 *
¥iv
,

525 
sk_buff_hód
 *
queue
)

527 
sk_buff
 *
skb
;

529 (
skb
 = 
	`skb_dequeue
(
queue
)Ë!
NULL
) {

530 
	`©h9k_htc_tx_¥o˚ss
(
¥iv
, 
skb
, 
NULL
);

532 
	}
}

534 
	$©h9k_htc_tx_døö
(
©h9k_htc_¥iv
 *
¥iv
)

536 
©h9k_htc_tx_evít
 *
evít
, *
tmp
;

538 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

539 
¥iv
->
tx
.
Êags
 |
ATH9K_HTC_OP_TX_DRAIN
;

540 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

546 
	`htc_°›
(
¥iv
->
htc
);

547 
	`èskÀt_kûl
(&
¥iv
->
wmi
->
wmi_evít_èskÀt
);

548 
	`èskÀt_kûl
(&
¥iv
->
tx_Áûed_èskÀt
);

550 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
mgmt_ï_queue
);

551 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
ˇb_ï_queue
);

552 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
d©a_be_queue
);

553 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
d©a_bk_queue
);

554 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
d©a_vi_queue
);

555 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
d©a_vo_queue
);

556 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
tx_Áûed
);

561 
	`•ö_lock_bh
(&
¥iv
->
wmi
->
evít_lock
);

562 
	`li°_f‹_óch_íåy_ß„
(
evít
, 
tmp
, &
¥iv
->
wmi
->
≥ndög_tx_evíts
, 
li°
) {

563 
	`li°_dñ
(&
evít
->
li°
);

564 
	`k‰ì
(
evít
);

566 
	`•ö_u∆ock_bh
(&
¥iv
->
wmi
->
evít_lock
);

568 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

569 
¥iv
->
tx
.
Êags
 &~
ATH9K_HTC_OP_TX_DRAIN
;

570 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

571 
	}
}

573 
	$©h9k_tx_Áûed_èskÀt
(
d©a
)

575 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *)
d©a
;

577 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

578 i‡(
¥iv
->
tx
.
Êags
 & 
ATH9K_HTC_OP_TX_DRAIN
) {

579 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

582 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

584 
	`©h9k_htc_tx_døöq
(
¥iv
, &¥iv->
tx
.
tx_Áûed
);

585 
	}
}

587 
ölöe
 
boﬁ
 
	$check_cookõ
(
©h9k_htc_¥iv
 *
¥iv
,

588 
sk_buff
 *
skb
,

589 
u8
 
cookõ
, u8 
ïid
)

591 
u8
 
fcookõ
 = 0;

593 i‡(
ïid
 =
¥iv
->
mgmt_ï
) {

594 
tx_mgmt_hdr
 *
hdr
;

595 
hdr
 = (
tx_mgmt_hdr
 *Ë
skb
->
d©a
;

596 
fcookõ
 = 
hdr
->
cookõ
;

597 } i‡((
ïid
 =
¥iv
->
d©a_bk_ï
) ||

598 (
ïid
 =
¥iv
->
d©a_be_ï
) ||

599 (
ïid
 =
¥iv
->
d©a_vi_ï
) ||

600 (
ïid
 =
¥iv
->
d©a_vo_ï
) ||

601 (
ïid
 =
¥iv
->
ˇb_ï
)) {

602 
tx_‰ame_hdr
 *
hdr
;

603 
hdr
 = (
tx_‰ame_hdr
 *Ë
skb
->
d©a
;

604 
fcookõ
 = 
hdr
->
cookõ
;

607 i‡(
fcookõ
 =
cookõ
)

608  
åue
;

610  
Ál£
;

611 
	}
}

613 
sk_buff
* 
	$©h9k_htc_tx_gë_∑ckë
(
©h9k_htc_¥iv
 *
¥iv
,

614 
__wmi_evít_tx°©us
 *
txs
)

616 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

617 
sk_buff_hód
 *
ïid_queue
;

618 
sk_buff
 *
skb
, *
tmp
;

619 
Êags
;

620 
u8
 
ïid
 = 
	`MS
(
txs
->
ts_øã
, 
ATH9K_HTC_TXSTAT_EPID
);

622 
ïid_queue
 = 
	`gë_htc_ïid_queue
(
¥iv
, 
ïid
);

623 i‡(!
ïid_queue
)

624  
NULL
;

626 
	`•ö_lock_úqßve
(&
ïid_queue
->
lock
, 
Êags
);

627 
	`skb_queue_wÆk_ß„
(
ïid_queue
, 
skb
, 
tmp
) {

628 i‡(
	`check_cookõ
(
¥iv
, 
skb
, 
txs
->
cookõ
, 
ïid
)) {

629 
	`__skb_u∆ök
(
skb
, 
ïid_queue
);

630 
	`•ö_u∆ock_úqª°‹e
(&
ïid_queue
->
lock
, 
Êags
);

631  
skb
;

634 
	`•ö_u∆ock_úqª°‹e
(&
ïid_queue
->
lock
, 
Êags
);

636 
	`©h_dbg
(
comm⁄
, 
XMIT
, "No matchingÖacket for cookie: %d,Épid: %d\n",

637 
txs
->
cookõ
, 
ïid
);

639  
NULL
;

640 
	}
}

642 
	$©h9k_htc_tx°©us
(
©h9k_htc_¥iv
 *
¥iv
, *
wmi_evít
)

644 
wmi_evít_tx°©us
 *
txs
 = (wmi_evít_tx°©u†*)
wmi_evít
;

645 
__wmi_evít_tx°©us
 *
__txs
;

646 
sk_buff
 *
skb
;

647 
©h9k_htc_tx_evít
 *
tx_≥nd
;

648 
i
;

650 
i
 = 0; i < 
txs
->
˙t
; i++) {

651 
	`WARN_ON
(
txs
->
˙t
 > 
HTC_MAX_TX_STATUS
);

653 
__txs
 = &
txs
->
tx°©us
[
i
];

655 
skb
 = 
	`©h9k_htc_tx_gë_∑ckë
(
¥iv
, 
__txs
);

656 i‡(!
skb
) {

661 
tx_≥nd
 = 
	`kzÆloc
((
©h9k_htc_tx_evít
),

662 
GFP_ATOMIC
);

663 i‡(!
tx_≥nd
)

666 
	`mem˝y
(&
tx_≥nd
->
txs
, 
__txs
,

667 (
__wmi_evít_tx°©us
));

669 
	`•ö_lock
(&
¥iv
->
wmi
->
evít_lock
);

670 
	`li°_add_èû
(&
tx_≥nd
->
li°
,

671 &
¥iv
->
wmi
->
≥ndög_tx_evíts
);

672 
	`•ö_u∆ock
(&
¥iv
->
wmi
->
evít_lock
);

677 
	`©h9k_htc_tx_¥o˚ss
(
¥iv
, 
skb
, 
__txs
);

681 
	`©h9k_htc_check_wake_queues
(
¥iv
);

682 
	}
}

684 
	$©h9k_htc_txï
(*
drv_¥iv
, 
sk_buff
 *
skb
,

685 
htc_ídpoöt_id
 
ï_id
, 
boﬁ
 
txok
)

687 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
drv_¥iv
;

688 
©h9k_htc_tx_˘l
 *
tx_˘l
;

689 
sk_buff_hód
 *
ïid_queue
;

691 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

692 
tx_˘l
->
txok
 =Åxok;

693 
tx_˘l
->
time°amp
 = 
jiffõs
;

695 i‡(!
txok
) {

696 
	`skb_queue_èû
(&
¥iv
->
tx
.
tx_Áûed
, 
skb
);

697 
	`èskÀt_scheduÀ
(&
¥iv
->
tx_Áûed_èskÀt
);

701 
ïid_queue
 = 
	`gë_htc_ïid_queue
(
¥iv
, 
ï_id
);

702 i‡(!
ïid_queue
) {

703 
	`dev_k‰ì_skb_™y
(
skb
);

707 
	`skb_queue_èû
(
ïid_queue
, 
skb
);

708 
	}
}

710 
ölöe
 
boﬁ
 
	$check_∑ckë
(
©h9k_htc_¥iv
 *
¥iv
, 
sk_buff
 *
skb
)

712 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

713 
©h9k_htc_tx_˘l
 *
tx_˘l
;

715 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

717 i‡(
	`time_a·î
(
jiffõs
,

718 
tx_˘l
->
time°amp
 +

719 
	`m£cs_to_jiffõs
(
ATH9K_HTC_TX_TIMEOUT_INTERVAL
))) {

720 
	`©h_dbg
(
comm⁄
, 
XMIT
, "DroppingáÖacket dueÅo TXÅimeout\n");

721  
åue
;

724  
Ál£
;

725 
	}
}

727 
	$©h9k_htc_tx_˛ónup_queue
(
©h9k_htc_¥iv
 *
¥iv
,

728 
sk_buff_hód
 *
ïid_queue
)

730 
boﬁ
 
¥o˚ss
 = 
Ál£
;

731 
Êags
;

732 
sk_buff
 *
skb
, *
tmp
;

733 
sk_buff_hód
 
queue
;

735 
	`skb_queue_hód_öô
(&
queue
);

737 
	`•ö_lock_úqßve
(&
ïid_queue
->
lock
, 
Êags
);

738 
	`skb_queue_wÆk_ß„
(
ïid_queue
, 
skb
, 
tmp
) {

739 i‡(
	`check_∑ckë
(
¥iv
, 
skb
)) {

740 
	`__skb_u∆ök
(
skb
, 
ïid_queue
);

741 
	`__skb_queue_èû
(&
queue
, 
skb
);

742 
¥o˚ss
 = 
åue
;

745 
	`•ö_u∆ock_úqª°‹e
(&
ïid_queue
->
lock
, 
Êags
);

747 i‡(
¥o˚ss
) {

748 
	`skb_queue_wÆk_ß„
(&
queue
, 
skb
, 
tmp
) {

749 
	`__skb_u∆ök
(
skb
, &
queue
);

750 
	`©h9k_htc_tx_¥o˚ss
(
¥iv
, 
skb
, 
NULL
);

753 
	}
}

755 
	$©h9k_htc_tx_˛ónup_timî
(
d©a
)

757 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *Ë
d©a
;

758 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

759 
©h9k_htc_tx_evít
 *
evít
, *
tmp
;

760 
sk_buff
 *
skb
;

762 
	`•ö_lock
(&
¥iv
->
wmi
->
evít_lock
);

763 
	`li°_f‹_óch_íåy_ß„
(
evít
, 
tmp
, &
¥iv
->
wmi
->
≥ndög_tx_evíts
, 
li°
) {

765 
skb
 = 
	`©h9k_htc_tx_gë_∑ckë
(
¥iv
, &
evít
->
txs
);

766 i‡(
skb
) {

767 
	`©h_dbg
(
comm⁄
, 
XMIT
,

769 
evít
->
txs
.
cookõ
,

770 
	`MS
(
evít
->
txs
.
ts_øã
, 
ATH9K_HTC_TXSTAT_EPID
));

772 
	`©h9k_htc_tx_¥o˚ss
(
¥iv
, 
skb
, &
evít
->
txs
);

773 
	`li°_dñ
(&
evít
->
li°
);

774 
	`k‰ì
(
evít
);

778 i‡(++
evít
->
cou¡
 >
ATH9K_HTC_TX_TIMEOUT_COUNT
) {

779 
	`li°_dñ
(&
evít
->
li°
);

780 
	`k‰ì
(
evít
);

783 
	`•ö_u∆ock
(&
¥iv
->
wmi
->
evít_lock
);

788 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
mgmt_ï_queue
);

789 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
ˇb_ï_queue
);

790 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
d©a_be_queue
);

791 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
d©a_bk_queue
);

792 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
d©a_vi_queue
);

793 
	`©h9k_htc_tx_˛ónup_queue
(
¥iv
, &¥iv->
tx
.
d©a_vo_queue
);

796 
	`©h9k_htc_check_wake_queues
(
¥iv
);

798 
	`mod_timî
(&
¥iv
->
tx
.
˛ónup_timî
,

799 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ATH9K_HTC_TX_CLEANUP_INTERVAL
));

800 
	}
}

802 
	$©h9k_tx_öô
(
©h9k_htc_¥iv
 *
¥iv
)

804 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
mgmt_ï_queue
);

805 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
ˇb_ï_queue
);

806 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
d©a_be_queue
);

807 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
d©a_bk_queue
);

808 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
d©a_vi_queue
);

809 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
d©a_vo_queue
);

810 
	`skb_queue_hód_öô
(&
¥iv
->
tx
.
tx_Áûed
);

812 
	}
}

814 
	$©h9k_tx_˛ónup
(
©h9k_htc_¥iv
 *
¥iv
)

817 
	}
}

819 
boﬁ
 
	$©h9k_htc_txq_£tup
(
©h9k_htc_¥iv
 *
¥iv
, 
subty≥
)

821 
©h_hw
 *
ah
 = 
¥iv
->ah;

822 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

823 
©h9k_tx_queue_öfo
 
qi
;

824 
qnum
;

826 
	`mem£t
(&
qi
, 0, (qi));

827 
	`ATH9K_HTC_INIT_TXQ
(
subty≥
);

829 
qnum
 = 
	`©h9k_hw_£tu±xqueue
(
¥iv
->
ah
, 
ATH9K_TX_QUEUE_DATA
, &
qi
);

830 i‡(
qnum
 == -1)

831  
Ál£
;

833 i‡(
qnum
 >
	`ARRAY_SIZE
(
¥iv
->
hwq_m≠
)) {

834 
	`©h_îr
(
comm⁄
, "qnum %u out ofÑange, max %zu!\n",

835 
qnum
, 
	`ARRAY_SIZE
(
¥iv
->
hwq_m≠
));

836 
	`©h9k_hw_ªÀa£txqueue
(
ah
, 
qnum
);

837  
Ál£
;

840 
¥iv
->
hwq_m≠
[
subty≥
] = 
qnum
;

841  
åue
;

842 
	}
}

844 
	$©h9k_htc_ˇbq_£tup
(
©h9k_htc_¥iv
 *
¥iv
)

846 
©h9k_tx_queue_öfo
 
qi
;

848 
	`mem£t
(&
qi
, 0, (qi));

849 
	`ATH9K_HTC_INIT_TXQ
(0);

851  
	`©h9k_hw_£tu±xqueue
(
¥iv
->
ah
, 
ATH9K_TX_QUEUE_CAB
, &
qi
);

852 
	}
}

861 
u32
 
	$©h9k_htc_ˇl¸xfûãr
(
©h9k_htc_¥iv
 *
¥iv
)

863 
	#RX_FILTER_PRESERVE
 (
ATH9K_RX_FILTER_PHYERR
 | 
ATH9K_RX_FILTER_PHYRADAR
)

	)

865 
©h_hw
 *
ah
 = 
¥iv
->ah;

866 
u32
 
rfût
;

868 
rfût
 = (
	`©h9k_hw_gërxfûãr
(
ah
Ë& 
RX_FILTER_PRESERVE
)

869 | 
ATH9K_RX_FILTER_UCAST
 | 
ATH9K_RX_FILTER_BCAST


870 | 
ATH9K_RX_FILTER_MCAST
;

872 i‡(
¥iv
->
rxfûãr
 & 
FIF_PROBE_REQ
)

873 
rfût
 |
ATH9K_RX_FILTER_PROBEREQ
;

875 i‡(
ah
->
is_m⁄ô‹ög
)

876 
rfût
 |
ATH9K_RX_FILTER_PROM
;

878 i‡(
¥iv
->
rxfûãr
 & 
FIF_CONTROL
)

879 
rfût
 |
ATH9K_RX_FILTER_CONTROL
;

881 i‡((
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) &&

882 (
¥iv
->
nvifs
 <= 1) &&

883 !(
¥iv
->
rxfûãr
 & 
FIF_BCN_PRBRESP_PROMISC
))

884 
rfût
 |
ATH9K_RX_FILTER_MYBEACON
;

886 
rfût
 |
ATH9K_RX_FILTER_BEACON
;

888 i‡(
	`c⁄f_is_ht
(&
¥iv
->
hw
->
c⁄f
)) {

889 
rfût
 |
ATH9K_RX_FILTER_COMP_BAR
;

890 
rfût
 |
ATH9K_RX_FILTER_UNCOMP_BA_BAR
;

893 i‡(
¥iv
->
rxfûãr
 & 
FIF_PSPOLL
)

894 
rfût
 |
ATH9K_RX_FILTER_PSPOLL
;

896 i‡(
¥iv
->
nvifs
 > 1 ||Öriv->
rxfûãr
 & 
FIF_OTHER_BSS
)

897 
rfût
 |
ATH9K_RX_FILTER_MCAST_BCAST_ALL
;

899  
rfût
;

901 #unde‡
RX_FILTER_PRESERVE


902 
	}
}

907 
	$©h9k_htc_›mode_öô
(
©h9k_htc_¥iv
 *
¥iv
)

909 
©h_hw
 *
ah
 = 
¥iv
->ah;

910 
u32
 
rfût
, 
mfût
[2];

913 
rfût
 = 
	`©h9k_htc_ˇl¸xfûãr
(
¥iv
);

914 
	`©h9k_hw_£åxfûãr
(
ah
, 
rfût
);

917 
mfût
[0] = mfilt[1] = ~0;

918 
	`©h9k_hw_£tmˇ°fûãr
(
ah
, 
mfût
[0], mfilt[1]);

919 
	}
}

921 
	$©h9k_ho°_rx_öô
(
©h9k_htc_¥iv
 *
¥iv
)

923 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

924 
	`©h9k_hw_rxía
(
¥iv
->
ah
);

925 
	`©h9k_htc_›mode_öô
(
¥iv
);

926 
	`©h9k_hw_°¨çcuª˚ive
(
¥iv
->
ah
, 
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
));

927 
	}
}

929 
ölöe
 
	$c⁄vît_htc_Êag
(
©h_rx_°©us
 *
rx_°©s
,

930 
©h_htc_rx_°©us
 *
rx°©us
)

932 
rx_°©s
->
Êag
 = 0;

933 i‡(
rx°©us
->
rs_Êags
 & 
ATH9K_RX_2040
)

934 
rx_°©s
->
Êag
 |
RX_FLAG_40MHZ
;

935 i‡(
rx°©us
->
rs_Êags
 & 
ATH9K_RX_GI
)

936 
rx_°©s
->
Êag
 |
RX_FLAG_SHORT_GI
;

937 
	}
}

939 
	$rx_°©us_htc_to_©h
(
©h_rx_°©us
 *
rx_°©s
,

940 
©h_htc_rx_°©us
 *
rx°©us
)

942 
rx_°©s
->
rs_d©Æí
 = 
	`be16_to_˝u
(
rx°©us
->rs_datalen);

943 
rx_°©s
->
rs_°©us
 = 
rx°©us
->rs_status;

944 
rx_°©s
->
rs_phyîr
 = 
rx°©us
->rs_phyerr;

945 
rx_°©s
->
rs_rssi
 = 
rx°©us
->rs_rssi;

946 
rx_°©s
->
rs_keyix
 = 
rx°©us
->rs_keyix;

947 
rx_°©s
->
rs_øã
 = 
rx°©us
->rs_rate;

948 
rx_°©s
->
rs_™ã¬a
 = 
rx°©us
->rs_antenna;

949 
rx_°©s
->
rs_m‹e
 = 
rx°©us
->rs_more;

951 
	`mem˝y
(
rx_°©s
->
rs_rssi_˘l
, 
rx°©us
->rs_rssi_ctl,

952 (
rx_°©s
->
rs_rssi_˘l
));

953 
	`mem˝y
(
rx_°©s
->
rs_rssi_ext
, 
rx°©us
->rs_rssi_ext,

954 (
rx_°©s
->
rs_rssi_ext
));

956 
rx_°©s
->
rs_ißggr
 = 
rx°©us
->rs_isaggr;

957 
rx_°©s
->
rs_m‹óggr
 = 
rx°©us
->rs_moreaggr;

958 
rx_°©s
->
rs_num_dñims
 = 
rx°©us
->rs_num_delims;

959 
	`c⁄vît_htc_Êag
(
rx_°©s
, 
rx°©us
);

960 
	}
}

962 
boﬁ
 
	$©h9k_rx_¥ï¨e
(
©h9k_htc_¥iv
 *
¥iv
,

963 
©h9k_htc_rxbuf
 *
rxbuf
,

964 
õì80211_rx_°©us
 *
rx_°©us
)

967 
õì80211_hdr
 *
hdr
;

968 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

969 
sk_buff
 *
skb
 = 
rxbuf
->skb;

970 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

971 
©h_hw
 *
ah
 = 
comm⁄
->ah;

972 
©h_htc_rx_°©us
 *
rx°©us
;

973 
©h_rx_°©us
 
rx_°©s
;

974 
boﬁ
 
de¸y±_îr‹
 = 
Ál£
;

976 i‡(
skb
->
Àn
 < 
HTC_RX_FRAME_HEADER_SIZE
) {

977 
	`©h_îr
(
comm⁄
, "Corrupted RX frame, dropping (len: %d)\n",

978 
skb
->
Àn
);

979 
rx_√xt
;

982 
rx°©us
 = (
©h_htc_rx_°©us
 *)
skb
->
d©a
;

984 i‡(
	`be16_to_˝u
(
rx°©us
->
rs_d©Æí
) -

985 (
skb
->
Àn
 - 
HTC_RX_FRAME_HEADER_SIZE
) != 0) {

986 
	`©h_îr
(
comm⁄
,

988 
rx°©us
->
rs_d©Æí
, 
skb
->
Àn
);

989 
rx_√xt
;

994 
	`mem£t
(
rx_°©us
, 0, (
õì80211_rx_°©us
));

998 
	`rx_°©us_htc_to_©h
(&
rx_°©s
, 
rx°©us
);

999 
	`©h9k_htc_îr_°©_rx
(
¥iv
, &
rx_°©s
);

1000 
rx_°©us
->
ma˘ime
 = 
	`be64_to_˝u
(
rx°©us
->
rs_t°amp
);

1001 
	`skb_puŒ
(
skb
, 
HTC_RX_FRAME_HEADER_SIZE
);

1007 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1013 i‡(
rx_°©s
.
rs_°©us
 & 
ATH9K_RXERR_PHY
) {

1015 i‡(
	`©h_cmn_¥o˚ss_f·
(&
¥iv
->
•ec_¥iv
, 
hdr
,

1016 &
rx_°©s
, 
rx_°©us
->
ma˘ime
)) {

1019 
rx_√xt
;

1022 i‡(!
	`©h9k_cmn_rx_ac˚±
(
comm⁄
, 
hdr
, 
rx_°©us
, &
rx_°©s
,

1023 &
de¸y±_îr‹
, 
¥iv
->
rxfûãr
))

1024 
rx_√xt
;

1026 
	`©h9k_cmn_rx_skb_po°¥o˚ss
(
comm⁄
, 
skb
, &
rx_°©s
,

1027 
rx_°©us
, 
de¸y±_îr‹
);

1029 i‡(
	`©h9k_cmn_¥o˚ss_øã
(
comm⁄
, 
hw
, &
rx_°©s
, 
rx_°©us
))

1030 
rx_√xt
;

1032 
rx_°©s
.
is_mybóc⁄
 = 
	`©h_is_mybóc⁄
(
comm⁄
, 
hdr
);

1033 
	`©h9k_cmn_¥o˚ss_rssi
(
comm⁄
, 
hw
, &
rx_°©s
, 
rx_°©us
);

1035 
rx_°©us
->
b™d
 = 
ah
->
curch™
->
ch™
->band;

1036 
rx_°©us
->
‰eq
 = 
ah
->
curch™
->
ch™
->
˚¡î_‰eq
;

1037 
rx_°©us
->
™ã¬a
 = 
rx_°©s
.
rs_™ã¬a
;

1038 
rx_°©us
->
Êag
 |
RX_FLAG_MACTIME_END
;

1040  
åue
;

1041 
rx_√xt
:

1042  
Ál£
;

1043 
	}
}

1048 
	$©h9k_rx_èskÀt
(
d©a
)

1050 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *)
d©a
;

1051 
©h9k_htc_rxbuf
 *
rxbuf
 = 
NULL
, *
tmp_buf
 = NULL;

1052 
õì80211_rx_°©us
 
rx_°©us
;

1053 
sk_buff
 *
skb
;

1054 
Êags
;

1055 
õì80211_hdr
 *
hdr
;

1058 
	`•ö_lock_úqßve
(&
¥iv
->
rx
.
rxbuÊock
, 
Êags
);

1059 
	`li°_f‹_óch_íåy
(
tmp_buf
, &
¥iv
->
rx
.
rxbuf
, 
li°
) {

1060 i‡(
tmp_buf
->
ö_¥o˚ss
) {

1061 
rxbuf
 = 
tmp_buf
;

1066 i‡(
rxbuf
 =
NULL
) {

1067 
	`•ö_u∆ock_úqª°‹e
(&
¥iv
->
rx
.
rxbuÊock
, 
Êags
);

1071 i‡(!
rxbuf
->
skb
)

1072 
ªqueue
;

1074 i‡(!
	`©h9k_rx_¥ï¨e
(
¥iv
, 
rxbuf
, &
rx_°©us
)) {

1075 
	`dev_k‰ì_skb_™y
(
rxbuf
->
skb
);

1076 
ªqueue
;

1079 
	`mem˝y
(
	`IEEE80211_SKB_RXCB
(
rxbuf
->
skb
), &
rx_°©us
,

1080 (
õì80211_rx_°©us
));

1081 
skb
 = 
rxbuf
->skb;

1082 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

1084 i‡(
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
Ë&& 
¥iv
->
ps_íabÀd
)

1085 
	`õì80211_queue_w‹k
(
¥iv
->
hw
, &¥iv->
ps_w‹k
);

1087 
	`•ö_u∆ock_úqª°‹e
(&
¥iv
->
rx
.
rxbuÊock
, 
Êags
);

1089 
	`õì80211_rx
(
¥iv
->
hw
, 
skb
);

1091 
	`•ö_lock_úqßve
(&
¥iv
->
rx
.
rxbuÊock
, 
Êags
);

1092 
ªqueue
:

1093 
rxbuf
->
ö_¥o˚ss
 = 
Ál£
;

1094 
rxbuf
->
skb
 = 
NULL
;

1095 
	`li°_move_èû
(&
rxbuf
->
li°
, &
¥iv
->
rx
.rxbuf);

1096 
rxbuf
 = 
NULL
;

1097 
	`•ö_u∆ock_úqª°‹e
(&
¥iv
->
rx
.
rxbuÊock
, 
Êags
);

1100 
	}
}

1102 
	$©h9k_htc_rxï
(*
drv_¥iv
, 
sk_buff
 *
skb
,

1103 
htc_ídpoöt_id
 
ï_id
)

1105 
©h9k_htc_¥iv
 *
¥iv
 = (©h9k_htc_¥iv *)
drv_¥iv
;

1106 
©h_hw
 *
ah
 = 
¥iv
->ah;

1107 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1108 
©h9k_htc_rxbuf
 *
rxbuf
 = 
NULL
, *
tmp_buf
 = NULL;

1110 
	`•ö_lock
(&
¥iv
->
rx
.
rxbuÊock
);

1111 
	`li°_f‹_óch_íåy
(
tmp_buf
, &
¥iv
->
rx
.
rxbuf
, 
li°
) {

1112 i‡(!
tmp_buf
->
ö_¥o˚ss
) {

1113 
rxbuf
 = 
tmp_buf
;

1117 
	`•ö_u∆ock
(&
¥iv
->
rx
.
rxbuÊock
);

1119 i‡(
rxbuf
 =
NULL
) {

1120 
	`©h_dbg
(
comm⁄
, 
ANY
, "No free RX buffer\n");

1121 
îr
;

1124 
	`•ö_lock
(&
¥iv
->
rx
.
rxbuÊock
);

1125 
rxbuf
->
skb
 = skb;

1126 
rxbuf
->
ö_¥o˚ss
 = 
åue
;

1127 
	`•ö_u∆ock
(&
¥iv
->
rx
.
rxbuÊock
);

1129 
	`èskÀt_scheduÀ
(&
¥iv
->
rx_èskÀt
);

1131 
îr
:

1132 
	`dev_k‰ì_skb_™y
(
skb
);

1133 
	}
}

1137 
	$©h9k_rx_˛ónup
(
©h9k_htc_¥iv
 *
¥iv
)

1139 
©h9k_htc_rxbuf
 *
rxbuf
, *
tbuf
;

1141 
	`li°_f‹_óch_íåy_ß„
(
rxbuf
, 
tbuf
, &
¥iv
->
rx
.rxbuf, 
li°
) {

1142 
	`li°_dñ
(&
rxbuf
->
li°
);

1143 i‡(
rxbuf
->
skb
)

1144 
	`dev_k‰ì_skb_™y
(
rxbuf
->
skb
);

1145 
	`k‰ì
(
rxbuf
);

1147 
	}
}

1149 
	$©h9k_rx_öô
(
©h9k_htc_¥iv
 *
¥iv
)

1151 
i
 = 0;

1153 
	`INIT_LIST_HEAD
(&
¥iv
->
rx
.
rxbuf
);

1154 
	`•ö_lock_öô
(&
¥iv
->
rx
.
rxbuÊock
);

1156 
i
 = 0; i < 
ATH9K_HTC_RXBUF
; i++) {

1157 
©h9k_htc_rxbuf
 *
rxbuf
 =

1158 
	`kzÆloc
((
©h9k_htc_rxbuf
), 
GFP_KERNEL
);

1159 i‡(
rxbuf
 =
NULL
)

1160 
îr
;

1162 
	`li°_add_èû
(&
rxbuf
->
li°
, &
¥iv
->
rx
.rxbuf);

1167 
îr
:

1168 
	`©h9k_rx_˛ónup
(
¥iv
);

1169  -
ENOMEM
;

1170 
	}
}

	@htc_hst.c

17 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

19 
	~"htc.h
"

21 
	$htc_issue_£nd
(
htc_èrgë
 *
èrgë
, 
sk_buff
* 
skb
,

22 
u16
 
Àn
, 
u8
 
Êags
, u8 
ïid
)

25 
htc_‰ame_hdr
 *
hdr
;

26 
htc_ídpoöt
 *
ídpoöt
 = &
èrgë
->ídpoöt[
ïid
];

27 
°©us
;

29 
hdr
 = (
htc_‰ame_hdr
 *)

30 
	`skb_push
(
skb
, (
htc_‰ame_hdr
));

31 
hdr
->
ídpoöt_id
 = 
ïid
;

32 
hdr
->
Êags
 = flags;

33 
hdr
->
∑ylﬂd_Àn
 = 
	`˝u_to_be16
(
Àn
);

35 
°©us
 = 
èrgë
->
hif
->
	`£nd
—¨gë->
hif_dev
, 
ídpoöt
->
ul_pùeid
, 
skb
);

37  
°©us
;

38 
	}
}

40 
htc_ídpoöt
 *
	$gë_√xt_avaû_ï
(
htc_ídpoöt
 *
ídpoöt
)

42 
htc_ídpoöt_id
 
avaû_ïid
;

44 
avaû_ïid
 = (
ENDPOINT_MAX
 - 1);ávaû_ïid > 
ENDPOINT0
;ávail_epid--)

45 i‡(
ídpoöt
[
avaû_ïid
].
£rvi˚_id
 == 0)

46  &
ídpoöt
[
avaû_ïid
];

47  
NULL
;

48 
	}
}

50 
u8
 
	$£rvi˚_to_uÕùe
(
u16
 
£rvi˚_id
)

52 
£rvi˚_id
) {

53 
WMI_CONTROL_SVC
:

55 
WMI_BEACON_SVC
:

56 
WMI_CAB_SVC
:

57 
WMI_UAPSD_SVC
:

58 
WMI_MGMT_SVC
:

59 
WMI_DATA_VO_SVC
:

60 
WMI_DATA_VI_SVC
:

61 
WMI_DATA_BE_SVC
:

62 
WMI_DATA_BK_SVC
:

67 
	}
}

69 
u8
 
	$£rvi˚_to_dÕùe
(
u16
 
£rvi˚_id
)

71 
£rvi˚_id
) {

72 
WMI_CONTROL_SVC
:

74 
WMI_BEACON_SVC
:

75 
WMI_CAB_SVC
:

76 
WMI_UAPSD_SVC
:

77 
WMI_MGMT_SVC
:

78 
WMI_DATA_VO_SVC
:

79 
WMI_DATA_VI_SVC
:

80 
WMI_DATA_BE_SVC
:

81 
WMI_DATA_BK_SVC
:

86 
	}
}

88 
	$htc_¥o˚ss_èrgë_rdy
(
htc_èrgë
 *
èrgë
,

89 *
buf
)

91 
htc_ídpoöt
 *
ídpoöt
;

92 
htc_ªady_msg
 *htc_ªady_msg = (htc_ªady_msg *Ë
buf
;

94 
èrgë
->
¸edô_size
 = 
	`be16_to_˝u
(
htc_ªady_msg
->credit_size);

96 
ídpoöt
 = &
èrgë
->ídpoöt[
ENDPOINT0
];

97 
ídpoöt
->
£rvi˚_id
 = 
HTC_CTRL_RSVD_SVC
;

98 
ídpoöt
->
max_msgÀn
 = 
HTC_MAX_CONTROL_MESSAGE_LENGTH
;

99 
	`©omic_öc
(&
èrgë
->
tgt_ªady
);

100 
	`com∂ëe
(&
èrgë
->
èrgë_waô
);

101 
	}
}

103 
	$htc_¥o˚ss_c⁄n_r•
(
htc_èrgë
 *
èrgë
,

104 
htc_‰ame_hdr
 *
htc_hdr
)

106 
htc_c⁄n_svc_r•msg
 *
svc_r•msg
;

107 
htc_ídpoöt
 *
ídpoöt
, *
tmp_ídpoöt
 = 
NULL
;

108 
u16
 
£rvi˚_id
;

109 
u16
 
max_msgÀn
;

110 
htc_ídpoöt_id
 
ïid
, 
ãpid
;

112 
svc_r•msg
 = (
htc_c⁄n_svc_r•msg
 *)

113 ((*Ë
htc_hdr
 + (
htc_‰ame_hdr
));

115 i‡(
svc_r•msg
->
°©us
 =
HTC_SERVICE_SUCCESS
) {

116 
ïid
 = 
svc_r•msg
->
ídpoöt_id
;

117 
£rvi˚_id
 = 
	`be16_to_˝u
(
svc_r•msg
->service_id);

118 
max_msgÀn
 = 
	`be16_to_˝u
(
svc_r•msg
->
max_msg_Àn
);

119 
ídpoöt
 = &
èrgë
->ídpoöt[
ïid
];

121 
ãpid
 = (
ENDPOINT_MAX
 - 1);Åïid > 
ENDPOINT0
;Åepid--) {

122 
tmp_ídpoöt
 = &
èrgë
->
ídpoöt
[
ãpid
];

123 i‡(
tmp_ídpoöt
->
£rvi˚_id
 == service_id) {

124 
tmp_ídpoöt
->
£rvi˚_id
 = 0;

129 i‡(
ãpid
 =
ENDPOINT0
)

132 
ídpoöt
->
£rvi˚_id
 = service_id;

133 
ídpoöt
->
max_txqdïth
 = 
tmp_ídpoöt
->max_txqdepth;

134 
ídpoöt
->
ï_ˇŒbacks
 = 
tmp_ídpoöt
->ep_callbacks;

135 
ídpoöt
->
ul_pùeid
 = 
tmp_ídpoöt
->ul_pipeid;

136 
ídpoöt
->
dl_pùeid
 = 
tmp_ídpoöt
->dl_pipeid;

137 
ídpoöt
->
max_msgÀn
 = max_msglen;

138 
èrgë
->
c⁄n_r•_ïid
 = 
ïid
;

139 
	`com∂ëe
(&
èrgë
->
cmd_waô
);

141 
èrgë
->
c⁄n_r•_ïid
 = 
ENDPOINT_UNUSED
;

143 
	}
}

145 
	$htc_c⁄fig_pùe_¸edôs
(
htc_èrgë
 *
èrgë
)

147 
sk_buff
 *
skb
;

148 
htc_c⁄fig_pùe_msg
 *
˝_msg
;

149 
ªt
;

150 
time_À·
;

152 
skb
 = 
	`Æloc_skb
(50 + (
htc_‰ame_hdr
), 
GFP_ATOMIC
);

153 i‡(!
skb
) {

154 
	`dev_îr
(
èrgë
->
dev
, "failedÅoállocate send buffer\n");

155  -
ENOMEM
;

157 
	`skb_ª£rve
(
skb
, (
htc_‰ame_hdr
));

159 
˝_msg
 = (
htc_c⁄fig_pùe_msg
 *)

160 
	`skb_put
(
skb
, (
htc_c⁄fig_pùe_msg
));

162 
˝_msg
->
mesßge_id
 = 
	`˝u_to_be16
(
HTC_MSG_CONFIG_PIPE_ID
);

163 
˝_msg
->
pùe_id
 = 
USB_WLAN_TX_PIPE
;

164 
˝_msg
->
¸edôs
 = 
èrgë
->credits;

166 
èrgë
->
htc_Êags
 |
HTC_OP_CONFIG_PIPE_CREDITS
;

168 
ªt
 = 
	`htc_issue_£nd
(
èrgë
, 
skb
, skb->
Àn
, 0, 
ENDPOINT0
);

169 i‡(
ªt
)

170 
îr
;

172 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
èrgë
->
cmd_waô
, 
HZ
);

173 i‡(!
time_À·
) {

174 
	`dev_îr
(
èrgë
->
dev
, "HTC credit configÅimeout\n");

175  -
ETIMEDOUT
;

179 
îr
:

180 
	`k‰ì_skb
(
skb
);

181  -
EINVAL
;

182 
	}
}

184 
	$htc_£tup_com∂ëe
(
htc_èrgë
 *
èrgë
)

186 
sk_buff
 *
skb
;

187 
htc_comp_msg
 *
comp_msg
;

188 
ªt
 = 0;

189 
time_À·
;

191 
skb
 = 
	`Æloc_skb
(50 + (
htc_‰ame_hdr
), 
GFP_ATOMIC
);

192 i‡(!
skb
) {

193 
	`dev_îr
(
èrgë
->
dev
, "failedÅoállocate send buffer\n");

194  -
ENOMEM
;

196 
	`skb_ª£rve
(
skb
, (
htc_‰ame_hdr
));

198 
comp_msg
 = (
htc_comp_msg
 *)

199 
	`skb_put
(
skb
, (
htc_comp_msg
));

200 
comp_msg
->
msg_id
 = 
	`˝u_to_be16
(
HTC_MSG_SETUP_COMPLETE_ID
);

202 
èrgë
->
htc_Êags
 |
HTC_OP_START_WAIT
;

204 
ªt
 = 
	`htc_issue_£nd
(
èrgë
, 
skb
, skb->
Àn
, 0, 
ENDPOINT0
);

205 i‡(
ªt
)

206 
îr
;

208 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
èrgë
->
cmd_waô
, 
HZ
);

209 i‡(!
time_À·
) {

210 
	`dev_îr
(
èrgë
->
dev
, "HTC startÅimeout\n");

211  -
ETIMEDOUT
;

216 
îr
:

217 
	`k‰ì_skb
(
skb
);

218  -
EINVAL
;

219 
	}
}

223 
	$htc_öô
(
htc_èrgë
 *
èrgë
)

225 
ªt
;

227 
ªt
 = 
	`htc_c⁄fig_pùe_¸edôs
(
èrgë
);

228 i‡(
ªt
)

229  
ªt
;

231  
	`htc_£tup_com∂ëe
(
èrgë
);

232 
	}
}

234 
	$htc_c⁄√˘_£rvi˚
(
htc_èrgë
 *
èrgë
,

235 
htc_£rvi˚_c⁄ƒeq
 *
£rvi˚_c⁄ƒeq
,

236 
htc_ídpoöt_id
 *
c⁄n_r•_ïid
)

238 
sk_buff
 *
skb
;

239 
htc_ídpoöt
 *
ídpoöt
;

240 
htc_c⁄n_svc_msg
 *
c⁄n_msg
;

241 
ªt
;

242 
time_À·
;

245 
ídpoöt
 = 
	`gë_√xt_avaû_ï
(
èrgë
->endpoint);

246 i‡(!
ídpoöt
) {

247 
	`dev_îr
(
èrgë
->
dev
, "Endpoint isÇotávailable for"

248 "£rvi˚ %d\n", 
£rvi˚_c⁄ƒeq
->
£rvi˚_id
);

249  -
EINVAL
;

252 
ídpoöt
->
£rvi˚_id
 = 
£rvi˚_c⁄ƒeq
->service_id;

253 
ídpoöt
->
max_txqdïth
 = 
£rvi˚_c⁄ƒeq
->
max_£nd_qdïth
;

254 
ídpoöt
->
ul_pùeid
 = 
	`£rvi˚_to_uÕùe
(
£rvi˚_c⁄ƒeq
->
£rvi˚_id
);

255 
ídpoöt
->
dl_pùeid
 = 
	`£rvi˚_to_dÕùe
(
£rvi˚_c⁄ƒeq
->
£rvi˚_id
);

256 
ídpoöt
->
ï_ˇŒbacks
 = 
£rvi˚_c⁄ƒeq
->ep_callbacks;

258 
skb
 = 
	`Æloc_skb
((
htc_c⁄n_svc_msg
) +

259 (
htc_‰ame_hdr
), 
GFP_ATOMIC
);

260 i‡(!
skb
) {

261 
	`dev_îr
(
èrgë
->
dev
, "FailedÅoállocate bufÅo send"

263  -
ENOMEM
;

266 
	`skb_ª£rve
(
skb
, (
htc_‰ame_hdr
));

268 
c⁄n_msg
 = (
htc_c⁄n_svc_msg
 *)

269 
	`skb_put
(
skb
, (
htc_c⁄n_svc_msg
));

270 
c⁄n_msg
->
£rvi˚_id
 = 
	`˝u_to_be16
(
£rvi˚_c⁄ƒeq
->service_id);

271 
c⁄n_msg
->
msg_id
 = 
	`˝u_to_be16
(
HTC_MSG_CONNECT_SERVICE_ID
);

272 
c⁄n_msg
->
c⁄_Êags
 = 
	`˝u_to_be16
(
£rvi˚_c⁄ƒeq
->con_flags);

273 
c⁄n_msg
->
dl_pùeid
 = 
ídpoöt
->dl_pipeid;

274 
c⁄n_msg
->
ul_pùeid
 = 
ídpoöt
->ul_pipeid;

276 
ªt
 = 
	`htc_issue_£nd
(
èrgë
, 
skb
, skb->
Àn
, 0, 
ENDPOINT0
);

277 i‡(
ªt
)

278 
îr
;

280 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
èrgë
->
cmd_waô
, 
HZ
);

281 i‡(!
time_À·
) {

282 
	`dev_îr
(
èrgë
->
dev
, "Service connectionÅimeout for: %d\n",

283 
£rvi˚_c⁄ƒeq
->
£rvi˚_id
);

284  -
ETIMEDOUT
;

287 *
c⁄n_r•_ïid
 = 
èrgë
->conn_rsp_epid;

289 
îr
:

290 
	`k‰ì_skb
(
skb
);

291  
ªt
;

292 
	}
}

294 
	$htc_£nd
(
htc_èrgë
 *
èrgë
, 
sk_buff
 *
skb
)

296 
©h9k_htc_tx_˘l
 *
tx_˘l
;

298 
tx_˘l
 = 
	`HTC_SKB_CB
(
skb
);

299  
	`htc_issue_£nd
(
èrgë
, 
skb
, skb->
Àn
, 0, 
tx_˘l
->
ïid
);

300 
	}
}

302 
	$htc_£nd_ïid
(
htc_èrgë
 *
èrgë
, 
sk_buff
 *
skb
,

303 
htc_ídpoöt_id
 
ïid
)

305  
	`htc_issue_£nd
(
èrgë
, 
skb
, skb->
Àn
, 0, 
ïid
);

306 
	}
}

308 
	$htc_°›
(
htc_èrgë
 *
èrgë
)

310 
èrgë
->
hif
->
	`°›
—¨gë->
hif_dev
);

311 
	}
}

313 
	$htc_°¨t
(
htc_èrgë
 *
èrgë
)

315 
èrgë
->
hif
->
	`°¨t
—¨gë->
hif_dev
);

316 
	}
}

318 
	$htc_°a_døö
(
htc_èrgë
 *
èrgë
, 
u8
 
idx
)

320 
èrgë
->
hif
->
	`°a_døö
—¨gë->
hif_dev
, 
idx
);

321 
	}
}

323 
	$©h9k_htc_txcom∂ëi⁄_cb
(
htc_èrgë
 *
htc_h™dÀ
,

324 
sk_buff
 *
skb
, 
boﬁ
 
txok
)

326 
htc_ídpoöt
 *
ídpoöt
;

327 
htc_‰ame_hdr
 *
htc_hdr
 = 
NULL
;

329 i‡(
htc_h™dÀ
->
htc_Êags
 & 
HTC_OP_CONFIG_PIPE_CREDITS
) {

330 
	`com∂ëe
(&
htc_h™dÀ
->
cmd_waô
);

331 
htc_h™dÀ
->
htc_Êags
 &~
HTC_OP_CONFIG_PIPE_CREDITS
;

332 
ªt
;

335 i‡(
htc_h™dÀ
->
htc_Êags
 & 
HTC_OP_START_WAIT
) {

336 
	`com∂ëe
(&
htc_h™dÀ
->
cmd_waô
);

337 
htc_h™dÀ
->
htc_Êags
 &~
HTC_OP_START_WAIT
;

338 
ªt
;

341 i‡(
skb
) {

342 
htc_hdr
 = (
htc_‰ame_hdr
 *Ë
skb
->
d©a
;

343 
ídpoöt
 = &
htc_h™dÀ
->ídpoöt[
htc_hdr
->
ídpoöt_id
];

344 
	`skb_puŒ
(
skb
, (
htc_‰ame_hdr
));

346 i‡(
ídpoöt
->
ï_ˇŒbacks
.
tx
) {

347 
ídpoöt
->
ï_ˇŒbacks
.
	`tx
”ndpoöt->ï_ˇŒbacks.
¥iv
,

348 
skb
, 
htc_hdr
->
ídpoöt_id
,

349 
txok
);

351 
	`k‰ì_skb
(
skb
);

356 
ªt
:

357 
	`k‰ì_skb
(
skb
);

358 
	}
}

360 
	$©h9k_htc_fw_∑nic_ªp‹t
(
htc_èrgë
 *
htc_h™dÀ
,

361 
sk_buff
 *
skb
)

363 
uöt32_t
 *
∑âîn
 = (uöt32_à*)
skb
->
d©a
;

365 *
∑âîn
) {

368 
htc_∑nic_bad_vaddr
 *
htc_∑nic
;

369 
htc_∑nic
 = (
htc_∑nic_bad_vaddr
 *Ë
skb
->
d©a
;

370 
	`dev_îr
(
htc_h™dÀ
->
dev
, "ath: firmwareÖanic! "

372 
htc_∑nic
->
excˇu£
, htc_∑nic->
pc
,

373 
htc_∑nic
->
badvaddr
);

378 
htc_∑nic_bad_ïid
 *
htc_∑nic
;

379 
htc_∑nic
 = (
htc_∑nic_bad_ïid
 *Ë
skb
->
d©a
;

380 
	`dev_îr
(
htc_h™dÀ
->
dev
, "ath: firmwareÖanic! "

381 "badÉpid: 0x%08x\n", 
htc_∑nic
->
ïid
);

385 
	`dev_îr
(
htc_h™dÀ
->
dev
, "ath: uknownÖanicÖattern!\n");

388 
	}
}

397 
	$©h9k_htc_rx_msg
(
htc_èrgë
 *
htc_h™dÀ
,

398 
sk_buff
 *
skb
, 
u32
 
Àn
, 
u8
 
pùe_id
)

400 
htc_‰ame_hdr
 *
htc_hdr
;

401 
htc_ídpoöt_id
 
ïid
;

402 
htc_ídpoöt
 *
ídpoöt
;

403 
__be16
 *
msg_id
;

405 i‡(!
htc_h™dÀ
 || !
skb
)

408 
htc_hdr
 = (
htc_‰ame_hdr
 *Ë
skb
->
d©a
;

409 
ïid
 = 
htc_hdr
->
ídpoöt_id
;

411 i‡(
ïid
 == 0x99) {

412 
	`©h9k_htc_fw_∑nic_ªp‹t
(
htc_h™dÀ
, 
skb
);

413 
	`k‰ì_skb
(
skb
);

417 i‡(
ïid
 < 0 ||Épid >
ENDPOINT_MAX
) {

418 i‡(
pùe_id
 !
USB_REG_IN_PIPE
)

419 
	`dev_k‰ì_skb_™y
(
skb
);

421 
	`k‰ì_skb
(
skb
);

425 i‡(
ïid
 =
ENDPOINT0
) {

428 i‡(
htc_hdr
->
Êags
 & 
HTC_FLAGS_RECV_TRAILER
) {

429 i‡(
	`be32_to_˝u
(*(
__be32
 *Ë
skb
->
d©a
) == 0x00C60000)

431 
htc_hdr
 = (
htc_‰ame_hdr
 *)(
skb
->
d©a
 + 4);

435 
msg_id
 = (
__be16
 *Ë((*Ë
htc_hdr
 +

436 (
htc_‰ame_hdr
));

439 
	`be16_to_˝u
(*
msg_id
)) {

440 
HTC_MSG_READY_ID
:

441 
	`htc_¥o˚ss_èrgë_rdy
(
htc_h™dÀ
, 
htc_hdr
);

443 
HTC_MSG_CONNECT_SERVICE_RESPONSE_ID
:

444 
	`htc_¥o˚ss_c⁄n_r•
(
htc_h™dÀ
, 
htc_hdr
);

450 
	`k‰ì_skb
(
skb
);

453 i‡(
htc_hdr
->
Êags
 & 
HTC_FLAGS_RECV_TRAILER
)

454 
	`skb_åim
(
skb
, 
Àn
 - 
htc_hdr
->
c⁄åﬁ
[0]);

456 
	`skb_puŒ
(
skb
, (
htc_‰ame_hdr
));

458 
ídpoöt
 = &
htc_h™dÀ
->ídpoöt[
ïid
];

459 i‡(
ídpoöt
->
ï_ˇŒbacks
.
rx
)

460 
ídpoöt
->
ï_ˇŒbacks
.
	`rx
”ndpoöt->ï_ˇŒbacks.
¥iv
,

461 
skb
, 
ïid
);

463 
	}
}

465 
htc_èrgë
 *
	$©h9k_htc_hw_Æloc
(*
hif_h™dÀ
,

466 
©h9k_htc_hif
 *
hif
,

467 
devi˚
 *
dev
)

469 
htc_ídpoöt
 *
ídpoöt
;

470 
htc_èrgë
 *
èrgë
;

472 
èrgë
 = 
	`kzÆloc
((
htc_èrgë
), 
GFP_KERNEL
);

473 i‡(!
èrgë
)

474  
NULL
;

476 
	`öô_com∂ëi⁄
(&
èrgë
->
èrgë_waô
);

477 
	`öô_com∂ëi⁄
(&
èrgë
->
cmd_waô
);

479 
èrgë
->
hif
 = hif;

480 
èrgë
->
hif_dev
 = 
hif_h™dÀ
;

481 
èrgë
->
dev
 = dev;

484 
ídpoöt
 = &
èrgë
->ídpoöt[
ENDPOINT0
];

485 
ídpoöt
->
ul_pùeid
 = 
hif
->
c⁄åﬁ_ul_pùe
;

486 
ídpoöt
->
dl_pùeid
 = 
hif
->
c⁄åﬁ_dl_pùe
;

488 
	`©omic_£t
(&
èrgë
->
tgt_ªady
, 0);

490  
èrgë
;

491 
	}
}

493 
	$©h9k_htc_hw_‰ì
(
htc_èrgë
 *
htc
)

495 
	`k‰ì
(
htc
);

496 
	}
}

498 
	$©h9k_htc_hw_öô
(
htc_èrgë
 *
èrgë
,

499 
devi˚
 *
dev
, 
u16
 
devid
,

500 *
¥odu˘
, 
u32
 
drv_öfo
)

502 i‡(
	`©h9k_htc_¥obe_devi˚
(
èrgë
, 
dev
, 
devid
, 
¥odu˘
, 
drv_öfo
)) {

503 
	`¥_îr
("FailedÅo initializeÅhe device\n");

504  -
ENODEV
;

508 
	}
}

510 
	$©h9k_htc_hw_deöô
(
htc_èrgë
 *
èrgë
, 
boﬁ
 
hŸ_u≈lug
)

512 i‡(
èrgë
)

513 
	`©h9k_htc_disc⁄√˘_devi˚
(
èrgë
, 
hŸ_u≈lug
);

514 
	}
}

	@htc_hst.h

17 #i‚de‡
HTC_HST_H


18 
	#HTC_HST_H


	)

20 
	g©h9k_htc_¥iv
;

21 
	ghtc_èrgë
;

22 
	g©h9k_htc_tx_˘l
;

24 
	e©h9k_hif_å™•‹ts
 {

25 
	mATH9K_HIF_USB
,

28 
	s©h9k_htc_hif
 {

29 
li°_hód
 
	mli°
;

30 c⁄° 
©h9k_hif_å™•‹ts
 
	må™•‹t
;

31 c⁄° *
	m«me
;

33 
u8
 
	mc⁄åﬁ_dl_pùe
;

34 
u8
 
	mc⁄åﬁ_ul_pùe
;

36 (*
	m°¨t
Ë(*
	mhif_h™dÀ
);

37 (*
	m°›
Ë(*
	mhif_h™dÀ
);

38 (*
	m°a_døö
Ë(*
	mhif_h™dÀ
, 
u8
 
	midx
);

39 (*
	m£nd
Ë(*
	mhif_h™dÀ
, 
u8
 
	mpùe
, 
sk_buff
 *
	mbuf
);

42 
	ehtc_ídpoöt_id
 {

43 
	mENDPOINT_UNUSED
 = -1,

44 
	mENDPOINT0
 = 0,

45 
	mENDPOINT1
 = 1,

46 
	mENDPOINT2
 = 2,

47 
	mENDPOINT3
 = 3,

48 
	mENDPOINT4
 = 4,

49 
	mENDPOINT5
 = 5,

50 
	mENDPOINT6
 = 6,

51 
	mENDPOINT7
 = 7,

52 
	mENDPOINT8
 = 8,

53 
	mENDPOINT_MAX
 = 22

57 
	#HTC_FLAGS_RECV_TRAILER
 (1 << 1)

	)

59 
	shtc_‰ame_hdr
 {

60 
u8
 
	mídpoöt_id
;

61 
u8
 
	mÊags
;

62 
__be16
 
	m∑ylﬂd_Àn
;

63 
u8
 
	mc⁄åﬁ
[4];

64 } 
	g__∑cked
;

66 
	shtc_ªady_msg
 {

67 
__be16
 
	mmesßge_id
;

68 
__be16
 
	m¸edôs
;

69 
__be16
 
	m¸edô_size
;

70 
u8
 
	mmax_ídpoöts
;

71 
u8
 
	m∑d
;

72 } 
	g__∑cked
;

74 
	shtc_c⁄fig_pùe_msg
 {

75 
__be16
 
	mmesßge_id
;

76 
u8
 
	mpùe_id
;

77 
u8
 
	m¸edôs
;

78 } 
	g__∑cked
;

80 
	shtc_∑nic_bad_vaddr
 {

81 
__be32
 
	m∑âîn
;

82 
__be32
 
	mexcˇu£
;

83 
__be32
 
	mpc
;

84 
__be32
 
	mbadvaddr
;

85 } 
	g__∑cked
;

87 
	shtc_∑nic_bad_ïid
 {

88 
__be32
 
	m∑âîn
;

89 
__be32
 
	mïid
;

90 } 
	g__∑cked
;

92 
	shtc_ï_ˇŒbacks
 {

93 *
	m¥iv
;

94 (*
	mtx
Ë(*, 
	msk_buff
 *, 
	mhtc_ídpoöt_id
, 
boﬁ
 
	mtxok
);

95 (*
	mrx
Ë(*, 
	msk_buff
 *, 
	mhtc_ídpoöt_id
);

98 
	shtc_ídpoöt
 {

99 
u16
 
	m£rvi˚_id
;

101 
htc_ï_ˇŒbacks
 
	mï_ˇŒbacks
;

102 
u32
 
	mmax_txqdïth
;

103 
	mmax_msgÀn
;

105 
u8
 
	mul_pùeid
;

106 
u8
 
	mdl_pùeid
;

109 
	#HTC_MAX_CONTROL_MESSAGE_LENGTH
 255

	)

110 
	#HTC_CONTROL_BUFFER_SIZE
 \

111 (
HTC_MAX_CONTROL_MESSAGE_LENGTH
 + (
htc_‰ame_hdr
))

	)

113 
	#HTC_OP_START_WAIT
 
	`BIT
(0)

	)

114 
	#HTC_OP_CONFIG_PIPE_CREDITS
 
	`BIT
(1)

	)

116 
	shtc_èrgë
 {

117 *
	mhif_dev
;

118 
©h9k_htc_¥iv
 *
	mdrv_¥iv
;

119 
devi˚
 *
	mdev
;

120 
©h9k_htc_hif
 *
	mhif
;

121 
htc_ídpoöt
 
	mídpoöt
[
ENDPOINT_MAX
];

122 
com∂ëi⁄
 
	mèrgë_waô
;

123 
com∂ëi⁄
 
	mcmd_waô
;

124 
li°_hód
 
	mli°
;

125 
htc_ídpoöt_id
 
	mc⁄n_r•_ïid
;

126 
u16
 
	m¸edôs
;

127 
u16
 
	m¸edô_size
;

128 
u8
 
	mhtc_Êags
;

129 
©omic_t
 
	mtgt_ªady
;

132 
	ehtc_msg_id
 {

133 
	mHTC_MSG_READY_ID
 = 1,

134 
	mHTC_MSG_CONNECT_SERVICE_ID
,

135 
	mHTC_MSG_CONNECT_SERVICE_RESPONSE_ID
,

136 
	mHTC_MSG_SETUP_COMPLETE_ID
,

137 
	mHTC_MSG_CONFIG_PIPE_ID
,

138 
	mHTC_MSG_CONFIG_PIPE_RESPONSE_ID
,

141 
	shtc_£rvi˚_c⁄ƒeq
 {

142 
u16
 
	m£rvi˚_id
;

143 
u16
 
	mc⁄_Êags
;

144 
u32
 
	mmax_£nd_qdïth
;

145 
htc_ï_ˇŒbacks
 
	mï_ˇŒbacks
;

150 
	ehtc_£rvi˚_group_ids
{

151 
	mRSVD_SERVICE_GROUP
 = 0,

152 
	mWMI_SERVICE_GROUP
 = 1,

154 
	mHTC_SERVICE_GROUP_LAST
 = 255

157 
	#MAKE_SERVICE_ID
(
group
, 
ödex
) \

158 ()((()
group
 << 8Ë| ()(
ödex
))

	)

161 
	#HTC_CTRL_RSVD_SVC
 
	`MAKE_SERVICE_ID
(
RSVD_SERVICE_GROUP
, 1)

	)

162 
	#HTC_LOOPBACK_RSVD_SVC
 
	`MAKE_SERVICE_ID
(
RSVD_SERVICE_GROUP
, 2)

	)

164 
	#WMI_CONTROL_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 0)

	)

165 
	#WMI_BEACON_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 1)

	)

166 
	#WMI_CAB_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 2)

	)

167 
	#WMI_UAPSD_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 3)

	)

168 
	#WMI_MGMT_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 4)

	)

169 
	#WMI_DATA_VO_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 5)

	)

170 
	#WMI_DATA_VI_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 6)

	)

171 
	#WMI_DATA_BE_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 7)

	)

172 
	#WMI_DATA_BK_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 8)

	)

174 
	shtc_c⁄n_svc_msg
 {

175 
__be16
 
	mmsg_id
;

176 
__be16
 
	m£rvi˚_id
;

177 
__be16
 
	mc⁄_Êags
;

178 
u8
 
	mdl_pùeid
;

179 
u8
 
	mul_pùeid
;

180 
u8
 
	msvc_mëa_Àn
;

181 
u8
 
	m∑d
;

182 } 
	g__∑cked
;

185 
	#HTC_SERVICE_SUCCESS
 0

	)

186 
	#HTC_SERVICE_NOT_FOUND
 1

	)

187 
	#HTC_SERVICE_FAILED
 2

	)

188 
	#HTC_SERVICE_NO_RESOURCES
 3

	)

189 
	#HTC_SERVICE_NO_MORE_EP
 4

	)

191 
	shtc_c⁄n_svc_r•msg
 {

192 
__be16
 
	mmsg_id
;

193 
__be16
 
	m£rvi˚_id
;

194 
u8
 
	m°©us
;

195 
u8
 
	mídpoöt_id
;

196 
__be16
 
	mmax_msg_Àn
;

197 
u8
 
	msvc_mëa_Àn
;

198 
u8
 
	m∑d
;

199 } 
	g__∑cked
;

201 
	shtc_comp_msg
 {

202 
__be16
 
	mmsg_id
;

203 } 
	g__∑cked
;

205 
htc_öô
(
htc_èrgë
 *
èrgë
);

206 
htc_c⁄√˘_£rvi˚
(
htc_èrgë
 *
èrgë
,

207 
htc_£rvi˚_c⁄ƒeq
 *
£rvi˚_c⁄ƒeq
,

208 
htc_ídpoöt_id
 *
c⁄n_r•_eid
);

209 
htc_£nd
(
htc_èrgë
 *
èrgë
, 
sk_buff
 *
skb
);

210 
htc_£nd_ïid
(
htc_èrgë
 *
èrgë
, 
sk_buff
 *
skb
,

211 
htc_ídpoöt_id
 
ïid
);

212 
htc_°›
(
htc_èrgë
 *
èrgë
);

213 
htc_°¨t
(
htc_èrgë
 *
èrgë
);

214 
htc_°a_døö
(
htc_èrgë
 *
èrgë
, 
u8
 
idx
);

216 
©h9k_htc_rx_msg
(
htc_èrgë
 *
htc_h™dÀ
,

217 
sk_buff
 *
skb
, 
u32
 
Àn
, 
u8
 
pùe_id
);

218 
©h9k_htc_txcom∂ëi⁄_cb
(
htc_èrgë
 *
htc_h™dÀ
,

219 
sk_buff
 *
skb
, 
boﬁ
 
txok
);

221 
htc_èrgë
 *
©h9k_htc_hw_Æloc
(*
hif_h™dÀ
,

222 
©h9k_htc_hif
 *
hif
,

223 
devi˚
 *
dev
);

224 
©h9k_htc_hw_‰ì
(
htc_èrgë
 *
htc
);

225 
©h9k_htc_hw_öô
(
htc_èrgë
 *
èrgë
,

226 
devi˚
 *
dev
, 
u16
 
devid
, *
¥odu˘
,

227 
u32
 
drv_öfo
);

228 
©h9k_htc_hw_deöô
(
htc_èrgë
 *
èrgë
, 
boﬁ
 
hŸ_u≈lug
);

	@hw-ops.h

17 #i‚de‡
ATH9K_HW_OPS_H


18 
	#ATH9K_HW_OPS_H


	)

20 
	~"hw.h
"

24 
ölöe
 
	$©h9k_hw_c⁄figpcùowîßve
(
©h_hw
 *
ah
,

25 
boﬁ
 
powî_off
)

27 i‡(!
ah
->
a•m_íabÀd
)

30 
	`©h9k_hw_›s
(
ah
)->
	`c⁄fig_pci_powîßve
◊h, 
powî_off
);

31 
	}
}

33 
ölöe
 
	$©h9k_hw_rxía
(
©h_hw
 *
ah
)

35 
	`©h9k_hw_›s
(
ah
)->
	`rx_íabÀ
(ah);

36 
	}
}

38 
ölöe
 
	$©h9k_hw_£t_desc_lök
(
©h_hw
 *
ah
, *
ds
,

39 
u32
 
lök
)

41 
	`©h9k_hw_›s
(
ah
)->
	`£t_desc_lök
(
ds
, 
lök
);

42 
	}
}

44 
ölöe
 
	$©h9k_hw_ˇlibøã
(
©h_hw
 *
ah
,

45 
©h9k_ch™√l
 *
ch™
,

46 
u8
 
rxchaömask
, 
boﬁ
 
l⁄gˇl
)

48  
	`©h9k_hw_›s
(
ah
)->
	`ˇlibøã
◊h, 
ch™
, 
rxchaömask
, 
l⁄gˇl
);

49 
	}
}

51 
ölöe
 
boﬁ
 
	$©h9k_hw_gëi§
(
©h_hw
 *
ah
, 
©h9k_öt
 *
masked
,

52 
u32
 *
sync_ˇu£_p
)

54  
	`©h9k_hw_›s
(
ah
)->
	`gë_i§
◊h, 
masked
, 
sync_ˇu£_p
);

55 
	}
}

57 
ölöe
 
	$©h9k_hw_£t_txdesc
(
©h_hw
 *
ah
, *
ds
,

58 
©h_tx_öfo
 *
i
)

60  
	`©h9k_hw_›s
(
ah
)->
	`£t_txdesc
◊h, 
ds
, 
i
);

61 
	}
}

63 
ölöe
 
	$©h9k_hw_tx¥ocdesc
(
©h_hw
 *
ah
, *
ds
,

64 
©h_tx_°©us
 *
ts
)

66  
	`©h9k_hw_›s
(
ah
)->
	`¥oc_txdesc
◊h, 
ds
, 
ts
);

67 
	}
}

69 
ölöe
 
	$©h9k_hw_gë_duøti⁄
(
©h_hw
 *
ah
, c⁄° *
ds
,

70 
ödex
)

72  
	`©h9k_hw_›s
(
ah
)->
	`gë_duøti⁄
◊h, 
ds
, 
ödex
);

73 
	}
}

75 
ölöe
 
	$©h9k_hw_™tdiv_comb_c⁄f_gë
(
©h_hw
 *
ah
,

76 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

78 
	`©h9k_hw_›s
(
ah
)->
	`™tdiv_comb_c⁄f_gë
◊h, 
™tc⁄f
);

79 
	}
}

81 
ölöe
 
	$©h9k_hw_™tdiv_comb_c⁄f_£t
(
©h_hw
 *
ah
,

82 
©h_hw_™tcomb_c⁄f
 *
™tc⁄f
)

84 
	`©h9k_hw_›s
(
ah
)->
	`™tdiv_comb_c⁄f_£t
◊h, 
™tc⁄f
);

85 
	}
}

87 
ölöe
 
	$©h9k_hw_tx99_°¨t
(
©h_hw
 *
ah
, 
u32
 
qnum
)

89 
	`©h9k_hw_›s
(
ah
)->
	`tx99_°¨t
◊h, 
qnum
);

90 
	}
}

92 
ölöe
 
	$©h9k_hw_tx99_°›
(
©h_hw
 *
ah
)

94 
	`©h9k_hw_›s
(
ah
)->
	`tx99_°›
(ah);

95 
	}
}

97 
ölöe
 
	$©h9k_hw_tx99_£t_txpowî
(
©h_hw
 *
ah
, 
u8
 
powî
)

99 i‡(
	`©h9k_hw_›s
(
ah
)->
tx99_£t_txpowî
)

100 
	`©h9k_hw_›s
(
ah
)->
	`tx99_£t_txpowî
◊h, 
powî
);

101 
	}
}

103 
ölöe
 
	$©h9k_hw_gë_adc_íå›y
(
©h_hw
 *
ah
,

104 
u8
 *
buf
, 
size_t
 
Àn
)

106 
	`©h9k_hw_›s
(
ah
)->
	`gë_adc_íå›y
◊h, 
buf
, 
Àn
);

107 
	}
}

109 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


111 
ölöe
 
	$©h9k_hw_£t_bt_™t_divîsôy
(
©h_hw
 *
ah
, 
boﬁ
 
íabÀ
)

113 i‡(
	`©h9k_hw_›s
(
ah
)->
£t_bt_™t_divîsôy
)

114 
	`©h9k_hw_›s
(
ah
)->
	`£t_bt_™t_divîsôy
◊h, 
íabÀ
);

115 
	}
}

117 
ölöe
 
boﬁ
 
	$©h9k_hw_is_aic_íabÀd
(
©h_hw
 *
ah
)

119 i‡(
	`©h9k_hw_¥iv©e_›s
(
ah
)->
is_aic_íabÀd
)

120  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`is_aic_íabÀd
(ah);

122  
Ál£
;

123 
	}
}

129 
ölöe
 
	$©h9k_hw_öô_h™g_checks
(
©h_hw
 *
ah
)

131 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`öô_h™g_checks
(ah);

132 
	}
}

134 
ölöe
 
boﬁ
 
	$©h9k_hw_dëe˘_mac_h™g
(
©h_hw
 *
ah
)

136  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`dëe˘_mac_h™g
(ah);

137 
	}
}

139 
ölöe
 
boﬁ
 
	$©h9k_hw_dëe˘_bb_h™g
(
©h_hw
 *
ah
)

141  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`dëe˘_bb_h™g
(ah);

142 
	}
}

146 
ölöe
 
	$©h9k_hw_rf_£t_‰eq
(
©h_hw
 *
ah
,

147 
©h9k_ch™√l
 *
ch™
)

149  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`rf_£t_‰eq
◊h, 
ch™
);

150 
	}
}

152 
ölöe
 
	$©h9k_hw_•ur_môig©e_‰eq
(
©h_hw
 *
ah
,

153 
©h9k_ch™√l
 *
ch™
)

155 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`•ur_môig©e_‰eq
◊h, 
ch™
);

156 
	}
}

158 
ölöe
 
boﬁ
 
	$©h9k_hw_£t_rf_ªgs
(
©h_hw
 *
ah
,

159 
©h9k_ch™√l
 *
ch™
,

160 
u16
 
modesIndex
)

162 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
£t_rf_ªgs
)

163  
åue
;

165  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£t_rf_ªgs
◊h, 
ch™
, 
modesIndex
);

166 
	}
}

168 
ölöe
 
	$©h9k_hw_öô_bb
(
©h_hw
 *
ah
,

169 
©h9k_ch™√l
 *
ch™
)

171  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`öô_bb
◊h, 
ch™
);

172 
	}
}

174 
ölöe
 
	$©h9k_hw_£t_ch™√l_ªgs
(
©h_hw
 *
ah
,

175 
©h9k_ch™√l
 *
ch™
)

177  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£t_ch™√l_ªgs
◊h, 
ch™
);

178 
	}
}

180 
ölöe
 
	$©h9k_hw_¥o˚ss_öi
(
©h_hw
 *
ah
,

181 
©h9k_ch™√l
 *
ch™
)

183  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`¥o˚ss_öi
◊h, 
ch™
);

184 
	}
}

186 
ölöe
 
	$©h9k_ﬁc_öô
(
©h_hw
 *
ah
)

188 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
ﬁc_öô
)

191  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`ﬁc_öô
(ah);

192 
	}
}

194 
ölöe
 
	$©h9k_hw_£t_rfmode
(
©h_hw
 *
ah
,

195 
©h9k_ch™√l
 *
ch™
)

197  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£t_rfmode
◊h, 
ch™
);

198 
	}
}

200 
ölöe
 
	$©h9k_hw_m¨k_phy_öa˘ive
(
©h_hw
 *
ah
)

202  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`m¨k_phy_öa˘ive
(ah);

203 
	}
}

205 
ölöe
 
	$©h9k_hw_£t_dñè_¶›e
(
©h_hw
 *
ah
,

206 
©h9k_ch™√l
 *
ch™
)

208  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£t_dñè_¶›e
◊h, 
ch™
);

209 
	}
}

211 
ölöe
 
boﬁ
 
	$©h9k_hw_rfbus_ªq
(
©h_hw
 *
ah
)

213  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`rfbus_ªq
(ah);

214 
	}
}

216 
ölöe
 
	$©h9k_hw_rfbus_d⁄e
(
©h_hw
 *
ah
)

218  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`rfbus_d⁄e
(ah);

219 
	}
}

221 
ölöe
 
	$©h9k_hw_ª°‹e_chaömask
(
©h_hw
 *
ah
)

223 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
ª°‹e_chaömask
)

226  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`ª°‹e_chaömask
(ah);

227 
	}
}

229 
ölöe
 
boﬁ
 
	$©h9k_hw_™i_c⁄åﬁ
(
©h_hw
 *
ah
,

230 
©h9k_™i_cmd
 
cmd
, 
∑øm
)

232  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`™i_c⁄åﬁ
◊h, 
cmd
, 
∑øm
);

233 
	}
}

235 
ölöe
 
	$©h9k_hw_do_gënf
(
©h_hw
 *
ah
,

236 
öt16_t
 
nÁºay
[
NUM_NF_READINGS
])

238 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`do_gënf
◊h, 
nÁºay
);

239 
	}
}

241 
ölöe
 
boﬁ
 
	$©h9k_hw_öô_ˇl
(
©h_hw
 *
ah
,

242 
©h9k_ch™√l
 *
ch™
)

244  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`öô_ˇl
◊h, 
ch™
);

245 
	}
}

247 
ölöe
 
	$©h9k_hw_£tup_ˇlibøti⁄
(
©h_hw
 *
ah
,

248 
©h9k_ˇl_li°
 *
cuºCÆ
)

250 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£tup_ˇlibøti⁄
◊h, 
cuºCÆ
);

251 
	}
}

253 
ölöe
 
	$©h9k_hw_Á°_ch™_ch™ge
(
©h_hw
 *
ah
,

254 
©h9k_ch™√l
 *
ch™
,

255 
u8
 *
öi_ªlﬂded
)

257  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`Á°_ch™_ch™ge
◊h, 
ch™
,

258 
öi_ªlﬂded
);

259 
	}
}

261 
ölöe
 
	$©h9k_hw_£t_ød¨_∑øms
(
©h_hw
 *
ah
)

263 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
£t_ød¨_∑øms
)

266 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`£t_ød¨_∑øms
◊h, &ah->
ød¨_c⁄f
);

267 
	}
}

269 
ölöe
 
	$©h9k_hw_öô_ˇl_£âögs
(
©h_hw
 *
ah
)

271 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`öô_ˇl_£âögs
(ah);

272 
	}
}

274 
ölöe
 
u32
 
	$©h9k_hw_compuã_∂l_c⁄åﬁ
(
©h_hw
 *
ah
,

275 
©h9k_ch™√l
 *
ch™
)

277  
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`compuã_∂l_c⁄åﬁ
◊h, 
ch™
);

278 
	}
}

280 
ölöe
 
	$©h9k_hw_öô_mode_gaö_ªgs
(
©h_hw
 *
ah
)

282 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
öô_mode_gaö_ªgs
)

285 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`öô_mode_gaö_ªgs
(ah);

286 
	}
}

288 
ölöe
 
	$©h9k_hw_™i_ˇche_öi_ªgs
(
©h_hw
 *
ah
)

290 i‡(!
	`©h9k_hw_¥iv©e_›s
(
ah
)->
™i_ˇche_öi_ªgs
)

293 
	`©h9k_hw_¥iv©e_›s
(
ah
)->
	`™i_ˇche_öi_ªgs
(ah);

294 
	}
}

	@hw.c

17 
	~<löux/io.h
>

18 
	~<löux/¶ab.h
>

19 
	~<löux/moduÀ.h
>

20 
	~<löux/time.h
>

21 
	~<löux/bô›s.h
>

22 
	~<löux/ëhîdevi˚.h
>

23 
	~<löux/gpio.h
>

24 
	~<asm/u«lig√d.h
>

26 
	~"hw.h
"

27 
	~"hw-›s.h
"

28 
	~"¨9003_mac.h
"

29 
	~"¨9003_mci.h
"

30 
	~"¨9003_phy.h
"

31 
	~"©h9k.h
"

33 
boﬁ
 
©h9k_hw_£t_ª£t_ªg
(
©h_hw
 *
ah
, 
u32
 
ty≥
);

35 
MODULE_AUTHOR
("Atheros Communications");

36 
MODULE_DESCRIPTION
("Support for Atheros 802.11n wireless LAN cards.");

37 
MODULE_SUPPORTED_DEVICE
("Atheros 802.11n WLAN cards");

38 
MODULE_LICENSE
("Dual BSD/GPL");

40 
	$©h9k_hw_£t_˛ockøã
(
©h_hw
 *
ah
)

42 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

43 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

44 
˛ockøã
;

47 i‡(
	`AR_SREV_9287
(
ah
Ë&& 
	`AR_SREV_9287_13_OR_LATER
(ah))

48 
˛ockøã
 = 117;

49 i‡(!
ch™
)

50 
˛ockøã
 = 
ATH9K_CLOCK_RATE_CCK
;

51 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

52 
˛ockøã
 = 
ATH9K_CLOCK_RATE_2GHZ_OFDM
;

53 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_FASTCLOCK
)

54 
˛ockøã
 = 
ATH9K_CLOCK_FAST_RATE_5GHZ_OFDM
;

56 
˛ockøã
 = 
ATH9K_CLOCK_RATE_5GHZ_OFDM
;

58 i‡(
ch™
) {

59 i‡(
	`IS_CHAN_HT40
(
ch™
))

60 
˛ockøã
 *= 2;

61 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
))

62 
˛ockøã
 /= 2;

63 i‡(
	`IS_CHAN_QUARTER_RATE
(
ch™
))

64 
˛ockøã
 /= 4;

67 
comm⁄
->
˛ockøã
 = clockrate;

68 
	}
}

70 
u32
 
	$©h9k_hw_mac_to_˛ks
(
©h_hw
 *
ah
, 
u32
 
u£cs
)

72 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

74  
u£cs
 * 
comm⁄
->
˛ockøã
;

75 
	}
}

77 
boﬁ
 
	$©h9k_hw_waô
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
mask
, u32 
vÆ
, u32 
timeout
)

79 
i
;

81 
	`BUG_ON
(
timeout
 < 
AH_TIME_QUANTUM
);

83 
i
 = 0; i < (
timeout
 / 
AH_TIME_QUANTUM
); i++) {

84 i‡((
	`REG_READ
(
ah
, 
ªg
Ë& 
mask
Ë=
vÆ
)

85  
åue
;

87 
	`udñay
(
AH_TIME_QUANTUM
);

90 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
ANY
,

92 
timeout
, 
ªg
, 
	`REG_READ
(
ah
,Ñeg), 
mask
, 
vÆ
);

94  
Ál£
;

95 
	}
}

96 
EXPORT_SYMBOL
(
©h9k_hw_waô
);

98 
	$©h9k_hw_sy¡h_dñay
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

99 
hw_dñay
)

101 
hw_dñay
 /= 10;

103 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
))

104 
hw_dñay
 *= 2;

105 i‡(
	`IS_CHAN_QUARTER_RATE
(
ch™
))

106 
hw_dñay
 *= 4;

108 
	`udñay
(
hw_dñay
 + 
BASE_ACTIVATE_DELAY
);

109 
	}
}

111 
	$©h9k_hw_wrôe_¨øy
(
©h_hw
 *
ah
, c⁄° 
¨5416IniAºay
 *
¨øy
,

112 
cﬁumn
, *
wrôe˙t
)

114 
r
;

116 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

117 
r
 = 0;Ñ < 
¨øy
->
ü_rows
;Ñ++) {

118 
	`REG_WRITE
(
ah
, 
	`INI_RA
(
¨øy
, 
r
, 0),

119 
	`INI_RA
(
¨øy
, 
r
, 
cﬁumn
));

120 
	`DO_DELAY
(*
wrôe˙t
);

122 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

123 
	}
}

125 
	$©h9k_hw_ªad_¨øy
(
©h_hw
 *
ah
, 
u32
 
¨øy
[][2], 
size
)

127 
u32
 *
tmp_ªg_li°
, *
tmp_d©a
;

128 
i
;

130 
tmp_ªg_li°
 = 
	`kmÆloc
(
size
 * (
u32
), 
GFP_KERNEL
);

131 i‡(!
tmp_ªg_li°
) {

132 
	`dev_îr
(
ah
->
dev
, "%s:Åmp_ªg_li°:áŒo¯fûed\n", 
__func__
);

136 
tmp_d©a
 = 
	`kmÆloc
(
size
 * (
u32
), 
GFP_KERNEL
);

137 i‡(!
tmp_d©a
) {

138 
	`dev_îr
(
ah
->
dev
, "%†tmp_d©a:áŒo¯fûed\n", 
__func__
);

139 
îr‹_tmp_d©a
;

142 
i
 = 0; i < 
size
; i++)

143 
tmp_ªg_li°
[
i
] = 
¨øy
[i][0];

145 
	`REG_READ_MULTI
(
ah
, 
tmp_ªg_li°
, 
tmp_d©a
, 
size
);

147 
i
 = 0; i < 
size
; i++)

148 
¨øy
[
i
][1] = 
tmp_d©a
[i];

150 
	`k‰ì
(
tmp_d©a
);

151 
îr‹_tmp_d©a
:

152 
	`k‰ì
(
tmp_ªg_li°
);

153 
	}
}

155 
u32
 
	$©h9k_hw_ªvî£_bôs
(
u32
 
vÆ
, u32 
n
)

157 
u32
 
ªtvÆ
;

158 
i
;

160 
i
 = 0, 
ªtvÆ
 = 0; i < 
n
; i++) {

161 
ªtvÆ
 = (ªtvÆ << 1Ë| (
vÆ
 & 1);

162 
vÆ
 >>= 1;

164  
ªtvÆ
;

165 
	}
}

167 
u16
 
	$©h9k_hw_compuãtxtime
(
©h_hw
 *
ah
,

168 
u8
 
phy
, 
kbps
,

169 
u32
 
‰ameLí
, 
u16
 
øãix
,

170 
boﬁ
 
sh‹tPªambÀ
)

172 
u32
 
bôsPîSymbﬁ
, 
numBôs
, 
numSymbﬁs
, 
phyTime
, 
txTime
;

174 i‡(
kbps
 == 0)

177 
phy
) {

178 
WLAN_RC_PHY_CCK
:

179 
phyTime
 = 
CCK_PREAMBLE_BITS
 + 
CCK_PLCP_BITS
;

180 i‡(
sh‹tPªambÀ
)

181 
phyTime
 >>= 1;

182 
numBôs
 = 
‰ameLí
 << 3;

183 
txTime
 = 
CCK_SIFS_TIME
 + 
phyTime
 + ((
numBôs
 * 1000Ë/ 
kbps
);

185 
WLAN_RC_PHY_OFDM
:

186 i‡(
ah
->
curch™
 && 
	`IS_CHAN_QUARTER_RATE
(ah->curchan)) {

187 
bôsPîSymbﬁ
 = (
kbps
 * 
OFDM_SYMBOL_TIME_QUARTER
) / 1000;

188 
numBôs
 = 
OFDM_PLCP_BITS
 + (
‰ameLí
 << 3);

189 
numSymbﬁs
 = 
	`DIV_ROUND_UP
(
numBôs
, 
bôsPîSymbﬁ
);

190 
txTime
 = 
OFDM_SIFS_TIME_QUARTER


191 + 
OFDM_PREAMBLE_TIME_QUARTER


192 + (
numSymbﬁs
 * 
OFDM_SYMBOL_TIME_QUARTER
);

193 } i‡(
ah
->
curch™
 &&

194 
	`IS_CHAN_HALF_RATE
(
ah
->
curch™
)) {

195 
bôsPîSymbﬁ
 = (
kbps
 * 
OFDM_SYMBOL_TIME_HALF
) / 1000;

196 
numBôs
 = 
OFDM_PLCP_BITS
 + (
‰ameLí
 << 3);

197 
numSymbﬁs
 = 
	`DIV_ROUND_UP
(
numBôs
, 
bôsPîSymbﬁ
);

198 
txTime
 = 
OFDM_SIFS_TIME_HALF
 +

199 
OFDM_PREAMBLE_TIME_HALF


200 + (
numSymbﬁs
 * 
OFDM_SYMBOL_TIME_HALF
);

202 
bôsPîSymbﬁ
 = (
kbps
 * 
OFDM_SYMBOL_TIME
) / 1000;

203 
numBôs
 = 
OFDM_PLCP_BITS
 + (
‰ameLí
 << 3);

204 
numSymbﬁs
 = 
	`DIV_ROUND_UP
(
numBôs
, 
bôsPîSymbﬁ
);

205 
txTime
 = 
OFDM_SIFS_TIME
 + 
OFDM_PREAMBLE_TIME


206 + (
numSymbﬁs
 * 
OFDM_SYMBOL_TIME
);

210 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

211 "Unknow¿phy %u (øã ix %u)\n", 
phy
, 
øãix
);

212 
txTime
 = 0;

216  
txTime
;

217 
	}
}

218 
EXPORT_SYMBOL
(
©h9k_hw_compuãtxtime
);

220 
	$©h9k_hw_gë_ch™√l_˚¡îs
(
©h_hw
 *
ah
,

221 
©h9k_ch™√l
 *
ch™
,

222 
ch™_˚¡îs
 *
˚¡îs
)

224 
öt8_t
 
extoff
;

226 i‡(!
	`IS_CHAN_HT40
(
ch™
)) {

227 
˚¡îs
->
˘l_˚¡î
 = cíãrs->
ext_˚¡î
 =

228 
˚¡îs
->
sy¡h_˚¡î
 = 
ch™
->
ch™√l
;

232 i‡(
	`IS_CHAN_HT40PLUS
(
ch™
)) {

233 
˚¡îs
->
sy¡h_˚¡î
 =

234 
ch™
->
ch™√l
 + 
HT40_CHANNEL_CENTER_SHIFT
;

235 
extoff
 = 1;

237 
˚¡îs
->
sy¡h_˚¡î
 =

238 
ch™
->
ch™√l
 - 
HT40_CHANNEL_CENTER_SHIFT
;

239 
extoff
 = -1;

242 
˚¡îs
->
˘l_˚¡î
 =

243 
˚¡îs
->
sy¡h_˚¡î
 - (
extoff
 * 
HT40_CHANNEL_CENTER_SHIFT
);

245 
˚¡îs
->
ext_˚¡î
 =

246 
˚¡îs
->
sy¡h_˚¡î
 + (
extoff
 * 
HT40_CHANNEL_CENTER_SHIFT
);

247 
	}
}

249 
ölöe
 
	$©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
©h_hw
 *
ah
)

256 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_USB_CTRL1
, 
	`BIT
(20));

257 
	`REG_RMW
(
ah
, 
AR_PHY_USB_CTRL2
,

260 
	}
}

266 
	$©h9k_hw_ªad_ªvisi⁄s
(
©h_hw
 *
ah
)

268 
u32
 
vÆ
;

270 i‡(
ah
->
gë_mac_ªvisi⁄
)

271 
ah
->
hw_vîsi⁄
.
macRev
 =áh->
	`gë_mac_ªvisi⁄
();

273 
ah
->
hw_vîsi⁄
.
devid
) {

274 
AR5416_AR9100_DEVID
:

275 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9100
;

277 
AR9300_DEVID_AR9330
:

278 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9330
;

279 i‡(!
ah
->
gë_mac_ªvisi⁄
) {

280 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_SREV
);

281 
ah
->
hw_vîsi⁄
.
macRev
 = 
	`MS
(
vÆ
, 
AR_SREV_REVISION2
);

284 
AR9300_DEVID_AR9340
:

285 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9340
;

287 
AR9300_DEVID_QCA955X
:

288 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9550
;

290 
AR9300_DEVID_AR953X
:

291 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9531
;

293 
AR9300_DEVID_QCA956X
:

294 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
AR_SREV_VERSION_9561
;

298 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_SREV
Ë& 
AR_SREV_ID
;

300 i‡(
vÆ
 == 0xFF) {

301 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_SREV
);

302 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 =

303 (
vÆ
 & 
AR_SREV_VERSION2
Ë>> 
AR_SREV_TYPE2_S
;

304 
ah
->
hw_vîsi⁄
.
macRev
 = 
	`MS
(
vÆ
, 
AR_SREV_REVISION2
);

306 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah))

307 
ah
->
is_pcõx¥ess
 = 
åue
;

309 
ah
->
is_pcõx¥ess
 = (
vÆ
 &

310 
AR_SREV_TYPE2_HOST_MODE
) ? 0 : 1;

312 i‡(!
	`AR_SREV_9100
(
ah
))

313 
ah
->
hw_vîsi⁄
.
macVîsi⁄
 = 
	`MS
(
vÆ
, 
AR_SREV_VERSION
);

315 
ah
->
hw_vîsi⁄
.
macRev
 = 
vÆ
 & 
AR_SREV_REVISION
;

317 i‡(
ah
->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_5416_PCIE
)

318 
ah
->
is_pcõx¥ess
 = 
åue
;

320 
	}
}

326 
	$©h9k_hw_dißbÀpcõ
(
©h_hw
 *
ah
)

328 i‡(!
	`AR_SREV_5416
(
ah
))

331 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x9248fc00);

332 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x24924924);

333 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x28000029);

334 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x57160824);

335 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x25980579);

336 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x00000000);

337 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x1aaabe40);

338 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0xbe105554);

339 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES
, 0x000e1007);

341 
	`REG_WRITE
(
ah
, 
AR_PCIE_SERDES2
, 0x00000000);

342 
	}
}

345 
boﬁ
 
	$©h9k_hw_chù_ã°
(
©h_hw
 *
ah
)

347 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

348 
u32
 
ªgAddr
[2] = { 
AR_STA_ID0
 };

349 
u32
 
ªgHﬁd
[2];

350 c⁄° 
u32
 
∑âînD©a
[4] = {

353 
i
, 
j
, 
lo›_max
;

355 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

356 
lo›_max
 = 2;

357 
ªgAddr
[1] = 
AR_PHY_BASE
 + (8 << 2);

359 
lo›_max
 = 1;

361 
i
 = 0; i < 
lo›_max
; i++) {

362 
u32
 
addr
 = 
ªgAddr
[
i
];

363 
u32
 
wrD©a
, 
rdD©a
;

365 
ªgHﬁd
[
i
] = 
	`REG_READ
(
ah
, 
addr
);

366 
j
 = 0; j < 0x100; j++) {

367 
wrD©a
 = (
j
 << 16) | j;

368 
	`REG_WRITE
(
ah
, 
addr
, 
wrD©a
);

369 
rdD©a
 = 
	`REG_READ
(
ah
, 
addr
);

370 i‡(
rdD©a
 !
wrD©a
) {

371 
	`©h_îr
(
comm⁄
,

373 
addr
, 
wrD©a
, 
rdD©a
);

374  
Ál£
;

377 
j
 = 0; j < 4; j++) {

378 
wrD©a
 = 
∑âînD©a
[
j
];

379 
	`REG_WRITE
(
ah
, 
addr
, 
wrD©a
);

380 
rdD©a
 = 
	`REG_READ
(
ah
, 
addr
);

381 i‡(
wrD©a
 !
rdD©a
) {

382 
	`©h_îr
(
comm⁄
,

384 
addr
, 
wrD©a
, 
rdD©a
);

385  
Ál£
;

388 
	`REG_WRITE
(
ah
, 
ªgAddr
[
i
], 
ªgHﬁd
[i]);

390 
	`udñay
(100);

392  
åue
;

393 
	}
}

395 
	$©h9k_hw_öô_c⁄fig
(
©h_hw
 *
ah
)

397 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

399 
ah
->
c⁄fig
.
dma_bóc⁄_ª•⁄£_time
 = 1;

400 
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
 = 6;

401 
ah
->
c⁄fig
.
cwm_ign‹e_extcˇ
 = 
Ál£
;

402 
ah
->
c⁄fig
.
™Æog_shi·ªg
 = 1;

404 
ah
->
c⁄fig
.
rx_öå_môig©i⁄
 = 
åue
;

406 
ah
->
c⁄fig
.
rimt_œ°
 = 250;

407 
ah
->
c⁄fig
.
rimt_fú°
 = 500;

409 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah))

410 
ah
->
c⁄fig
.
∂l_pwrßve
 = 7;

428 i‡(
	`num_possibÀ_˝us
() > 1)

429 
ah
->
c⁄fig
.
£rülize_ªgmode
 = 
SER_REG_MODE_AUTO
;

431 i‡(
NR_CPUS
 > 1 && 
ah
->
c⁄fig
.
£rülize_ªgmode
 =
SER_REG_MODE_AUTO
) {

432 i‡(
ah
->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_5416_PCI
 ||

433 ((
	`AR_SREV_9160
(
ah
Ë|| 
	`AR_SREV_9280
◊hË|| 
	`AR_SREV_9287
(ah)) &&

434 !
ah
->
is_pcõx¥ess
)) {

435 
ah
->
c⁄fig
.
£rülize_ªgmode
 = 
SER_REG_MODE_ON
;

437 
ah
->
c⁄fig
.
£rülize_ªgmode
 = 
SER_REG_MODE_OFF
;

441 
	`©h_dbg
(
comm⁄
, 
RESET
, "serialize_regmode is %d\n",

442 
ah
->
c⁄fig
.
£rülize_ªgmode
);

444 i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
(ah))

445 
ah
->
c⁄fig
.
max_txåig_Àvñ
 = 
MAX_TX_FIFO_THRESHOLD
 >> 1;

447 
ah
->
c⁄fig
.
max_txåig_Àvñ
 = 
MAX_TX_FIFO_THRESHOLD
;

448 
	}
}

450 
	$©h9k_hw_öô_deÁu…s
(
©h_hw
 *
ah
)

452 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

454 
ªguœt‹y
->
cou¡ry_code
 = 
CTRY_DEFAULT
;

455 
ªguœt‹y
->
powî_limô
 = 
MAX_RATE_POWER
;

457 
ah
->
hw_vîsi⁄
.
magic
 = 
AR5416_MAGIC
;

458 
ah
->
hw_vîsi⁄
.
subvíd‹id
 = 0;

460 
ah
->
°a_id1_deÁu…s
 = 
AR_STA_ID1_CRPT_MIC_ENABLE
 |

461 
AR_STA_ID1_MCAST_KSRCH
;

462 i‡(
	`AR_SREV_9100
(
ah
))

463 
ah
->
°a_id1_deÁu…s
 |
AR_STA_ID1_AR9100_BA_FIX
;

465 
ah
->
¶Ÿtime
 = 
ATH9K_SLOT_TIME_9
;

466 
ah
->
globÆtxtimeout
 = (
u32
) -1;

467 
ah
->
powî_mode
 = 
ATH9K_PM_UNDEFINED
;

468 
ah
->
htc_ª£t_öô
 = 
åue
;

470 
ah
->
çc_íabÀd
 = 
Ál£
;

472 
ah
->
™i_fun˘i⁄
 = 
ATH9K_ANI_ALL
;

473 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

474 
ah
->
™i_fun˘i⁄
 &~
ATH9K_ANI_MRC_CCK
;

476 i‡(
	`AR_SREV_9285
(
ah
Ë|| 
	`AR_SREV_9271
(ah))

477 
ah
->
tx_åig_Àvñ
 = (
AR_FTRIG_256B
 >> 
AR_FTRIG_S
);

479 
ah
->
tx_åig_Àvñ
 = (
AR_FTRIG_512B
 >> 
AR_FTRIG_S
);

480 
	}
}

482 
	$©h9k_hw_öô_maˇddr
(
©h_hw
 *
ah
)

484 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

485 
u32
 
sum
;

486 
i
;

487 
u16
 
ìvÆ
;

488 c⁄° 
u32
 
EEP_MAC
[] = { 
EEP_MAC_LSW
, 
EEP_MAC_MID
, 
EEP_MAC_MSW
 };

490 
sum
 = 0;

491 
i
 = 0; i < 3; i++) {

492 
ìvÆ
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_MAC
[
i
]);

493 
sum
 +
ìvÆ
;

494 
comm⁄
->
maˇddr
[2 * 
i
] = 
ìvÆ
 >> 8;

495 
comm⁄
->
maˇddr
[2 * 
i
 + 1] = 
ìvÆ
 & 0xff;

497 i‡(!
	`is_vÆid_ëhî_addr
(
comm⁄
->
maˇddr
)) {

498 
	`©h_îr
(
comm⁄
,

500 
comm⁄
->
maˇddr
);

502 
	`øndom_ëhî_addr
(
comm⁄
->
maˇddr
);

503 
	`©h_îr
(
comm⁄
,

505 
comm⁄
->
maˇddr
);

509 
	}
}

511 
	$©h9k_hw_po°_öô
(
©h_hw
 *
ah
)

513 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

514 
ecode
;

516 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 !
ATH_USB
) {

517 i‡(!
	`©h9k_hw_chù_ã°
(
ah
))

518  -
ENODEV
;

521 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

522 
ecode
 = 
	`¨9002_hw_rf_˛aim
(
ah
);

523 i‡(
ecode
 != 0)

524  
ecode
;

527 
ecode
 = 
	`©h9k_hw_ì¥om_öô
(
ah
);

528 i‡(
ecode
 != 0)

529  
ecode
;

531 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
CONFIG
, "Eeprom VER: %d, REV: %d\n",

532 
ah
->
ìp_›s
->
	`gë_ì¥om_vî
(ah),

533 
ah
->
ìp_›s
->
	`gë_ì¥om_ªv
(ah));

535 
	`©h9k_hw_™i_öô
(
ah
);

541 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

542 
u16
 
ªgdmn
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_REG_0
);

543 i‡((
ªgdmn
 & 0xF0Ë=
CTL_FCC
) {

544 
ah
->
nf_2g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9300_FCC_2GHZ
;

545 
ah
->
nf_5g
.
max
 = 
AR_PHY_CCA_MAX_GOOD_VAL_9300_FCC_5GHZ
;

550 
	}
}

552 
	$©h9k_hw_©èch_›s
(
©h_hw
 *
ah
)

554 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

555  
	`¨9002_hw_©èch_›s
(
ah
);

557 
	`¨9003_hw_©èch_›s
(
ah
);

559 
	}
}

562 
	$__©h9k_hw_öô
(
©h_hw
 *
ah
)

564 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

565 
r
 = 0;

567 
	`©h9k_hw_ªad_ªvisi⁄s
(
ah
);

569 
ah
->
hw_vîsi⁄
.
macVîsi⁄
) {

570 
AR_SREV_VERSION_5416_PCI
:

571 
AR_SREV_VERSION_5416_PCIE
:

572 
AR_SREV_VERSION_9160
:

573 
AR_SREV_VERSION_9100
:

574 
AR_SREV_VERSION_9280
:

575 
AR_SREV_VERSION_9285
:

576 
AR_SREV_VERSION_9287
:

577 
AR_SREV_VERSION_9271
:

578 
AR_SREV_VERSION_9300
:

579 
AR_SREV_VERSION_9330
:

580 
AR_SREV_VERSION_9485
:

581 
AR_SREV_VERSION_9340
:

582 
AR_SREV_VERSION_9462
:

583 
AR_SREV_VERSION_9550
:

584 
AR_SREV_VERSION_9565
:

585 
AR_SREV_VERSION_9531
:

586 
AR_SREV_VERSION_9561
:

589 
	`©h_îr
(
comm⁄
,

591 
ah
->
hw_vîsi⁄
.
macVîsi⁄
,áh->hw_vîsi⁄.
macRev
);

592  -
EOPNOTSUPP
;

600 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

601 
ah
->
WARegVÆ
 = 
	`REG_READ
◊h, 
AR_WA
);

602 
ah
->
WARegVÆ
 |(
AR_WA_D3_L1_DISABLE
 |

603 
AR_WA_ASPM_TIMER_BASED_DISABLE
);

606 i‡(!
	`©h9k_hw_£t_ª£t_ªg
(
ah
, 
ATH9K_RESET_POWER_ON
)) {

607 
	`©h_îr
(
comm⁄
, "Couldn'tÑeset chip\n");

608  -
EIO
;

611 i‡(
	`AR_SREV_9565
(
ah
)) {

612 
ah
->
WARegVÆ
 |
AR_WA_BIT22
;

613 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

616 
	`©h9k_hw_öô_deÁu…s
(
ah
);

617 
	`©h9k_hw_öô_c⁄fig
(
ah
);

619 
r
 = 
	`©h9k_hw_©èch_›s
(
ah
);

620 i‡(
r
)

621  
r
;

623 i‡(!
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_AWAKE
)) {

624 
	`©h_îr
(
comm⁄
, "Couldn't wakeup chip\n");

625  -
EIO
;

628 i‡(
	`AR_SREV_9271
(
ah
Ë|| 
	`AR_SREV_9100
◊hË|| 
	`AR_SREV_9340
(ah) ||

629 
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9550
(ah))

630 
ah
->
is_pcõx¥ess
 = 
Ál£
;

632 
ah
->
hw_vîsi⁄
.
phyRev
 = 
	`REG_READ
◊h, 
AR_PHY_CHIP_ID
);

633 
	`©h9k_hw_öô_ˇl_£âögs
(
ah
);

635 i‡(!
ah
->
is_pcõx¥ess
)

636 
	`©h9k_hw_dißbÀpcõ
(
ah
);

638 
r
 = 
	`©h9k_hw_po°_öô
(
ah
);

639 i‡(
r
)

640  
r
;

642 
	`©h9k_hw_öô_mode_gaö_ªgs
(
ah
);

643 
r
 = 
	`©h9k_hw_fûl_ˇp_öfo
(
ah
);

644 i‡(
r
)

645  
r
;

647 
r
 = 
	`©h9k_hw_öô_maˇddr
(
ah
);

648 i‡(
r
) {

649 
	`©h_îr
(
comm⁄
, "FailedÅo initialize MACáddress\n");

650  
r
;

653 
	`©h9k_hw_öô_h™g_checks
(
ah
);

655 
comm⁄
->
°©e
 = 
ATH_HW_INITIALIZED
;

658 
	}
}

660 
	$©h9k_hw_öô
(
©h_hw
 *
ah
)

662 
ªt
;

663 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

666 
ah
->
hw_vîsi⁄
.
devid
) {

667 
AR9300_DEVID_INVALID
:

668 
AR5416_DEVID_PCI
:

669 
AR5416_DEVID_PCIE
:

670 
AR5416_AR9100_DEVID
:

671 
AR9160_DEVID_PCI
:

672 
AR9280_DEVID_PCI
:

673 
AR9280_DEVID_PCIE
:

674 
AR9285_DEVID_PCIE
:

675 
AR9287_DEVID_PCI
:

676 
AR9287_DEVID_PCIE
:

677 
AR2427_DEVID_PCIE
:

678 
AR9300_DEVID_PCIE
:

679 
AR9300_DEVID_AR9485_PCIE
:

680 
AR9300_DEVID_AR9330
:

681 
AR9300_DEVID_AR9340
:

682 
AR9300_DEVID_QCA955X
:

683 
AR9300_DEVID_AR9580
:

684 
AR9300_DEVID_AR9462
:

685 
AR9485_DEVID_AR1111
:

686 
AR9300_DEVID_AR9565
:

687 
AR9300_DEVID_AR953X
:

688 
AR9300_DEVID_QCA956X
:

691 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
)

693 
	`©h_îr
(
comm⁄
, "Hardware device ID 0x%04xÇot supported\n",

694 
ah
->
hw_vîsi⁄
.
devid
);

695  -
EOPNOTSUPP
;

698 
ªt
 = 
	`__©h9k_hw_öô
(
ah
);

699 i‡(
ªt
) {

700 
	`©h_îr
(
comm⁄
,

702 
ªt
);

703  
ªt
;

706 
	`©h_dy«ck_öô
(
ah
);

709 
	}
}

710 
EXPORT_SYMBOL
(
©h9k_hw_öô
);

712 
	$©h9k_hw_öô_qos
(
©h_hw
 *
ah
)

714 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

716 
	`REG_WRITE
(
ah
, 
AR_MIC_QOS_CONTROL
, 0x100aa);

717 
	`REG_WRITE
(
ah
, 
AR_MIC_QOS_SELECT
, 0x3210);

719 
	`REG_WRITE
(
ah
, 
AR_QOS_NO_ACK
,

720 
	`SM
(2, 
AR_QOS_NO_ACK_TWO_BIT
) |

721 
	`SM
(5, 
AR_QOS_NO_ACK_BIT_OFF
) |

722 
	`SM
(0, 
AR_QOS_NO_ACK_BYTE_OFF
));

724 
	`REG_WRITE
(
ah
, 
AR_TXOP_X
, 
AR_TXOP_X_VAL
);

725 
	`REG_WRITE
(
ah
, 
AR_TXOP_0_3
, 0xFFFFFFFF);

726 
	`REG_WRITE
(
ah
, 
AR_TXOP_4_7
, 0xFFFFFFFF);

727 
	`REG_WRITE
(
ah
, 
AR_TXOP_8_11
, 0xFFFFFFFF);

728 
	`REG_WRITE
(
ah
, 
AR_TXOP_12_15
, 0xFFFFFFFF);

730 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

731 
	}
}

733 
u32
 
	$¨9003_gë_∂l_sqsum_dvc
(
©h_hw
 *
ah
)

735 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

736 
i
 = 0;

738 
	`REG_CLR_BIT
(
ah
, 
PLL3
, 
PLL3_DO_MEAS_MASK
);

739 
	`udñay
(100);

740 
	`REG_SET_BIT
(
ah
, 
PLL3
, 
PLL3_DO_MEAS_MASK
);

742 (
	`REG_READ
(
ah
, 
PLL4
Ë& 
PLL4_MEAS_DONE
) == 0) {

744 
	`udñay
(100);

746 i‡(
	`WARN_ON_ONCE
(
i
 >= 100)) {

747 
	`©h_îr
(
comm⁄
, "PLL4 meaurementÇot done\n");

751 
i
++;

754  (
	`REG_READ
(
ah
, 
PLL3
Ë& 
SQSUM_DVC_MASK
) >> 3;

755 
	}
}

756 
EXPORT_SYMBOL
(
¨9003_gë_∂l_sqsum_dvc
);

758 
	$©h9k_hw_öô_∂l
(
©h_hw
 *
ah
,

759 
©h9k_ch™√l
 *
ch™
)

761 
u32
 
∂l
;

763 
∂l
 = 
	`©h9k_hw_compuã_∂l_c⁄åﬁ
(
ah
, 
ch™
);

765 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

767 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

768 
AR_CH0_BB_DPLL2_PLL_PWD
, 0x1);

769 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

770 
AR_CH0_DPLL2_KD
, 0x40);

771 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

772 
AR_CH0_DPLL2_KI
, 0x4);

774 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL1
,

775 
AR_CH0_BB_DPLL1_REFDIV
, 0x5);

776 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL1
,

777 
AR_CH0_BB_DPLL1_NINI
, 0x58);

778 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL1
,

779 
AR_CH0_BB_DPLL1_NFRAC
, 0x0);

781 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

782 
AR_CH0_BB_DPLL2_OUTDIV
, 0x1);

783 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

784 
AR_CH0_BB_DPLL2_LOCAL_PLL
, 0x1);

785 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

786 
AR_CH0_BB_DPLL2_EN_NEGTRIG
, 0x1);

789 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL3
,

790 
AR_CH0_BB_DPLL3_PHASE_SHIFT
, 0x6);

792 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
,

793 
AR_CH0_BB_DPLL2_PLL_PWD
, 0x0);

794 
	`udñay
(1000);

795 } i‡(
	`AR_SREV_9330
(
ah
)) {

796 
u32
 
ddr_d∂l2
, 
∂l_c⁄åﬁ2
, 
kd
;

798 i‡(
ah
->
is_˛k_25mhz
) {

799 
ddr_d∂l2
 = 0x18e82f01;

800 
∂l_c⁄åﬁ2
 = 0xe04a3d;

801 
kd
 = 0x1d;

803 
ddr_d∂l2
 = 0x19e82f01;

804 
∂l_c⁄åﬁ2
 = 0x886666;

805 
kd
 = 0x3d;

809 
	`REG_WRITE
(
ah
, 
AR_CH0_DDR_DPLL2
, 
ddr_d∂l2
);

812 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_DDR_DPLL3
,

813 
AR_CH0_DPLL3_PHASE_SHIFT
, 0x1);

815 
	`REG_WRITE
(
ah
, 
AR_RTC_PLL_CONTROL
,

816 
∂l
 | 
AR_RTC_9300_PLL_BYPASS
);

817 
	`udñay
(1000);

820 
	`REG_WRITE
(
ah
, 
AR_RTC_PLL_CONTROL2
, 
∂l_c⁄åﬁ2
);

823 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
, 
AR_CH0_DPLL2_KD
, 
kd
);

824 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL2
, 
AR_CH0_DPLL2_KI
, 0x06);

827 
	`REG_RMW_FIELD
(
ah
, 
AR_CH0_BB_DPLL3
,

828 
AR_CH0_BB_DPLL3_PHASE_SHIFT
, 0x1);

829 } i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9531
(ah) ||

830 
	`AR_SREV_9561
(
ah
)) {

831 
u32
 
ªgvÆ
, 
∂l2_divöt
, 
∂l2_div‰ac
, 
ªfdiv
;

833 
	`REG_WRITE
(
ah
, 
AR_RTC_PLL_CONTROL
,

834 
∂l
 | 
AR_RTC_9300_SOC_PLL_BYPASS
);

835 
	`udñay
(1000);

837 
	`REG_SET_BIT
(
ah
, 
AR_PHY_PLL_MODE
, 0x1 << 16);

838 
	`udñay
(100);

840 i‡(
ah
->
is_˛k_25mhz
) {

841 i‡(
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah)) {

842 
∂l2_divöt
 = 0x1c;

843 
∂l2_div‰ac
 = 0xa3d2;

844 
ªfdiv
 = 1;

846 
∂l2_divöt
 = 0x54;

847 
∂l2_div‰ac
 = 0x1eb85;

848 
ªfdiv
 = 3;

851 i‡(
	`AR_SREV_9340
(
ah
)) {

852 
∂l2_divöt
 = 88;

853 
∂l2_div‰ac
 = 0;

854 
ªfdiv
 = 5;

856 
∂l2_divöt
 = 0x11;

857 
∂l2_div‰ac
 = (
	`AR_SREV_9531
(
ah
) ||

858 
	`AR_SREV_9561
(
ah
)) ?

860 
ªfdiv
 = 1;

864 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_PLL_MODE
);

865 i‡(
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

866 
ªgvÆ
 |= (0x1 << 22);

868 
ªgvÆ
 |= (0x1 << 16);

869 
	`REG_WRITE
(
ah
, 
AR_PHY_PLL_MODE
, 
ªgvÆ
);

870 
	`udñay
(100);

872 
	`REG_WRITE
(
ah
, 
AR_PHY_PLL_CONTROL
, (
ªfdiv
 << 27) |

873 (
∂l2_divöt
 << 18Ë| 
∂l2_div‰ac
);

874 
	`udñay
(100);

876 
ªgvÆ
 = 
	`REG_READ
(
ah
, 
AR_PHY_PLL_MODE
);

877 i‡(
	`AR_SREV_9340
(
ah
))

878 
ªgvÆ
 = (regval & 0x80071fff) |

883 i‡(
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah)) {

884 
ªgvÆ
 = (regval & 0x01c00fff) |

890 i‡(
	`AR_SREV_9531
(
ah
))

891 
ªgvÆ
 |= (0x6 << 12);

893 
ªgvÆ
 = (regval & 0x80071fff) |

898 
	`REG_WRITE
(
ah
, 
AR_PHY_PLL_MODE
, 
ªgvÆ
);

900 i‡(
	`AR_SREV_9531
(
ah
Ë|| 
	`AR_SREV_9561
(ah))

901 
	`REG_WRITE
(
ah
, 
AR_PHY_PLL_MODE
,

902 
	`REG_READ
(
ah
, 
AR_PHY_PLL_MODE
) & 0xffbfffff);

904 
	`REG_WRITE
(
ah
, 
AR_PHY_PLL_MODE
,

905 
	`REG_READ
(
ah
, 
AR_PHY_PLL_MODE
) & 0xfffeffff);

907 
	`udñay
(1000);

910 i‡(
	`AR_SREV_9565
(
ah
))

911 
∂l
 |= 0x40000;

912 
	`REG_WRITE
(
ah
, 
AR_RTC_PLL_CONTROL
, 
∂l
);

914 i‡(
	`AR_SREV_9485
(
ah
Ë|| 
	`AR_SREV_9340
◊hË|| 
	`AR_SREV_9330
(ah) ||

915 
	`AR_SREV_9550
(
ah
))

916 
	`udñay
(1000);

919 i‡(
	`AR_SREV_9271
(
ah
)) {

920 
	`udñay
(500);

921 
	`REG_WRITE
(
ah
, 0x50040, 0x304);

924 
	`udñay
(
RTC_PLL_SETTLE_DELAY
);

926 
	`REG_WRITE
(
ah
, 
AR_RTC_SLEEP_CLK
, 
AR_RTC_FORCE_DERIVED_CLK
);

927 
	}
}

929 
	$©h9k_hw_öô_öãºu±_masks
(
©h_hw
 *
ah
,

930 
∆80211_i·y≥
 
›mode
)

932 
u32
 
sync_deÁu…
 = 
AR_INTR_SYNC_DEFAULT
;

933 
u32
 
imr_ªg
 = 
AR_IMR_TXERR
 |

934 
AR_IMR_TXURN
 |

935 
AR_IMR_RXERR
 |

936 
AR_IMR_RXORN
 |

937 
AR_IMR_BCNMISC
;

939 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9531
(ah) ||

940 
	`AR_SREV_9561
(
ah
))

941 
sync_deÁu…
 &~
AR_INTR_SYNC_HOST1_FATAL
;

943 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

944 
imr_ªg
 |
AR_IMR_RXOK_HP
;

945 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
)

946 
imr_ªg
 |
AR_IMR_RXINTM
 | 
AR_IMR_RXMINTR
;

948 
imr_ªg
 |
AR_IMR_RXOK_LP
;

951 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
)

952 
imr_ªg
 |
AR_IMR_RXINTM
 | 
AR_IMR_RXMINTR
;

954 
imr_ªg
 |
AR_IMR_RXOK
;

957 i‡(
ah
->
c⁄fig
.
tx_öå_môig©i⁄
)

958 
imr_ªg
 |
AR_IMR_TXINTM
 | 
AR_IMR_TXMINTR
;

960 
imr_ªg
 |
AR_IMR_TXOK
;

962 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

964 
	`REG_WRITE
(
ah
, 
AR_IMR
, 
imr_ªg
);

965 
ah
->
imrs2_ªg
 |
AR_IMR_S2_GTT
;

966 
	`REG_WRITE
(
ah
, 
AR_IMR_S2
,áh->
imrs2_ªg
);

968 i‡(!
	`AR_SREV_9100
(
ah
)) {

969 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_CAUSE
, 0xFFFFFFFF);

970 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_ENABLE
, 
sync_deÁu…
);

971 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_MASK
, 0);

974 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

976 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

977 
	`REG_WRITE
(
ah
, 
AR_INTR_PRIO_ASYNC_ENABLE
, 0);

978 
	`REG_WRITE
(
ah
, 
AR_INTR_PRIO_ASYNC_MASK
, 0);

979 
	`REG_WRITE
(
ah
, 
AR_INTR_PRIO_SYNC_ENABLE
, 0);

980 
	`REG_WRITE
(
ah
, 
AR_INTR_PRIO_SYNC_MASK
, 0);

982 
	}
}

984 
	$©h9k_hw_£t_sifs_time
(
©h_hw
 *
ah
, 
u32
 
us
)

986 
u32
 
vÆ
 = 
	`©h9k_hw_mac_to_˛ks
(
ah
, 
us
 - 2);

987 
vÆ
 = 
	`mö
(vÆ, (
u32
) 0xFFFF);

988 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_SIFS
, 
vÆ
);

989 
	}
}

991 
	$©h9k_hw_£t¶Ÿtime
(
©h_hw
 *
ah
, 
u32
 
us
)

993 
u32
 
vÆ
 = 
	`©h9k_hw_mac_to_˛ks
(
ah
, 
us
);

994 
vÆ
 = 
	`mö
(vÆ, (
u32
) 0xFFFF);

995 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_SLOT
, 
vÆ
);

996 
	}
}

998 
	$©h9k_hw_£t_ack_timeout
(
©h_hw
 *
ah
, 
u32
 
us
)

1000 
u32
 
vÆ
 = 
	`©h9k_hw_mac_to_˛ks
(
ah
, 
us
);

1001 
vÆ
 = 
	`mö
(vÆ, (
u32
Ë
	`MS
(0xFFFFFFFF, 
AR_TIME_OUT_ACK
));

1002 
	`REG_RMW_FIELD
(
ah
, 
AR_TIME_OUT
, 
AR_TIME_OUT_ACK
, 
vÆ
);

1003 
	}
}

1005 
	$©h9k_hw_£t_˘s_timeout
(
©h_hw
 *
ah
, 
u32
 
us
)

1007 
u32
 
vÆ
 = 
	`©h9k_hw_mac_to_˛ks
(
ah
, 
us
);

1008 
vÆ
 = 
	`mö
(vÆ, (
u32
Ë
	`MS
(0xFFFFFFFF, 
AR_TIME_OUT_CTS
));

1009 
	`REG_RMW_FIELD
(
ah
, 
AR_TIME_OUT
, 
AR_TIME_OUT_CTS
, 
vÆ
);

1010 
	}
}

1012 
boﬁ
 
	$©h9k_hw_£t_globÆ_txtimeout
(
©h_hw
 *
ah
, 
u32
 
tu
)

1014 i‡(
tu
 > 0xFFFF) {

1015 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
XMIT
, "bad globalÅxÅimeout %u\n",

1016 
tu
);

1017 
ah
->
globÆtxtimeout
 = (
u32
) -1;

1018  
Ál£
;

1020 
	`REG_RMW_FIELD
(
ah
, 
AR_GTXTO
, 
AR_GTXTO_TIMEOUT_LIMIT
, 
tu
);

1021 
ah
->
globÆtxtimeout
 = 
tu
;

1022  
åue
;

1024 
	}
}

1026 
	$©h9k_hw_öô_globÆ_£âögs
(
©h_hw
 *
ah
)

1028 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1029 c⁄° 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

1030 
acktimeout
, 
˘°imeout
, 
ack_off£t
 = 0;

1031 
¶Ÿtime
;

1032 
sif°ime
;

1033 
rx_œt
 = 0, 
tx_œt
 = 0, 
eifs
 = 0;

1034 
u32
 
ªg
;

1036 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
, "ah->misc_mode 0x%x\n",

1037 
ah
->
misc_mode
);

1039 i‡(!
ch™
)

1042 i‡(
ah
->
misc_mode
 != 0)

1043 
	`REG_SET_BIT
(
ah
, 
AR_PCU_MISC
,áh->
misc_mode
);

1045 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

1046 
rx_œt
 = 41;

1048 
rx_œt
 = 37;

1049 
tx_œt
 = 54;

1051 i‡(
	`IS_CHAN_5GHZ
(
ch™
))

1052 
sif°ime
 = 16;

1054 
sif°ime
 = 10;

1056 i‡(
	`IS_CHAN_HALF_RATE
(
ch™
)) {

1057 
eifs
 = 175;

1058 
rx_œt
 *= 2;

1059 
tx_œt
 *= 2;

1060 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

1061 
tx_œt
 += 11;

1063 
sif°ime
 = 32;

1064 
ack_off£t
 = 16;

1065 
¶Ÿtime
 = 13;

1066 } i‡(
	`IS_CHAN_QUARTER_RATE
(
ch™
)) {

1067 
eifs
 = 340;

1068 
rx_œt
 = (rx_lat * 4) - 1;

1069 
tx_œt
 *= 4;

1070 i‡(
	`IS_CHAN_A_FAST_CLOCK
(
ah
, 
ch™
))

1071 
tx_œt
 += 22;

1073 
sif°ime
 = 64;

1074 
ack_off£t
 = 32;

1075 
¶Ÿtime
 = 21;

1077 i‡(
	`AR_SREV_9287
(
ah
Ë&& 
	`AR_SREV_9287_13_OR_LATER
(ah)) {

1078 
eifs
 = 
AR_D_GBL_IFS_EIFS_ASYNC_FIFO
;

1079 
ªg
 = 
AR_USEC_ASYNC_FIFO
;

1081 
eifs
 = 
	`REG_READ
(
ah
, 
AR_D_GBL_IFS_EIFS
)/

1082 
comm⁄
->
˛ockøã
;

1083 
ªg
 = 
	`REG_READ
(
ah
, 
AR_USEC
);

1085 
rx_œt
 = 
	`MS
(
ªg
, 
AR_USEC_RX_LAT
);

1086 
tx_œt
 = 
	`MS
(
ªg
, 
AR_USEC_TX_LAT
);

1088 
¶Ÿtime
 = 
ah
->slottime;

1092 
¶Ÿtime
 +3 * 
ah
->
covîage_˛ass
;

1093 
acktimeout
 = 
¶Ÿtime
 + 
sif°ime
 + 
ack_off£t
;

1094 
˘°imeout
 = 
acktimeout
;

1103 i‡(
	`IS_CHAN_2GHZ
(
ch™
) &&

1104 !
	`IS_CHAN_HALF_RATE
(
ch™
Ë&& !
	`IS_CHAN_QUARTER_RATE
(chan)) {

1105 
acktimeout
 +64 - 
sif°ime
 - 
ah
->
¶Ÿtime
;

1106 
˘°imeout
 +48 - 
sif°ime
 - 
ah
->
¶Ÿtime
;

1109 i‡(
ah
->
dy«ck
.
íabÀd
) {

1110 
acktimeout
 = 
ah
->
dy«ck
.
ackto
;

1111 
˘°imeout
 = 
acktimeout
;

1112 
¶Ÿtime
 = (
acktimeout
 - 3) / 2;

1114 
ah
->
dy«ck
.
ackto
 = 
acktimeout
;

1117 
	`©h9k_hw_£t_sifs_time
(
ah
, 
sif°ime
);

1118 
	`©h9k_hw_£t¶Ÿtime
(
ah
, 
¶Ÿtime
);

1119 
	`©h9k_hw_£t_ack_timeout
(
ah
, 
acktimeout
);

1120 
	`©h9k_hw_£t_˘s_timeout
(
ah
, 
˘°imeout
);

1121 i‡(
ah
->
globÆtxtimeout
 !(
u32
) -1)

1122 
	`©h9k_hw_£t_globÆ_txtimeout
(
ah
,áh->
globÆtxtimeout
);

1124 
	`REG_WRITE
(
ah
, 
AR_D_GBL_IFS_EIFS
, 
	`©h9k_hw_mac_to_˛ks
◊h, 
eifs
));

1125 
	`REG_RMW
(
ah
, 
AR_USEC
,

1126 (
comm⁄
->
˛ockøã
 - 1) |

1127 
	`SM
(
rx_œt
, 
AR_USEC_RX_LAT
) |

1128 
	`SM
(
tx_œt
, 
AR_USEC_TX_LAT
),

1129 
AR_USEC_TX_LAT
 | 
AR_USEC_RX_LAT
 | 
AR_USEC_USEC
);

1131 
	}
}

1132 
EXPORT_SYMBOL
(
©h9k_hw_öô_globÆ_£âögs
);

1134 
	$©h9k_hw_deöô
(
©h_hw
 *
ah
)

1136 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1138 i‡(
comm⁄
->
°©e
 < 
ATH_HW_INITIALIZED
)

1141 
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_FULL_SLEEP
);

1142 
	}
}

1143 
EXPORT_SYMBOL
(
©h9k_hw_deöô
);

1149 
u32
 
	$©h9k_ªgd_gë_˘l
(
©h_ªguœt‹y
 *
ªg
, 
©h9k_ch™√l
 *
ch™
)

1151 
u32
 
˘l
 = 
	`©h_ªgd_gë_b™d_˘l
(
ªg
, 
ch™
->ch™->
b™d
);

1153 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

1154 
˘l
 |
CTL_11G
;

1156 
˘l
 |
CTL_11A
;

1158  
˘l
;

1159 
	}
}

1165 
ölöe
 
	$©h9k_hw_£t_dma
(
©h_hw
 *
ah
)

1167 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1168 
txbuf_size
;

1170 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1175 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1176 
	`REG_SET_BIT
(
ah
, 
AR_AHB_MODE
, 
AR_AHB_PREFETCH_RD_EN
);

1181 
	`REG_RMW
(
ah
, 
AR_TXCFG
, 
AR_TXCFG_DMASZ_128B
, 
AR_TXCFG_DMASZ_MASK
);

1183 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1190 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1191 
	`REG_RMW_FIELD
(
ah
, 
AR_TXCFG
, 
AR_FTRIG
,áh->
tx_åig_Àvñ
);

1193 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1198 
	`REG_RMW
(
ah
, 
AR_RXCFG
, 
AR_RXCFG_DMASZ_128B
, 
AR_RXCFG_DMASZ_MASK
);

1203 
	`REG_WRITE
(
ah
, 
AR_RXFIFO_CFG
, 0x200);

1205 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

1206 
	`REG_RMW_FIELD
(
ah
, 
AR_RXBP_THRESH
, 
AR_RXBP_THRESH_HP
, 0x1);

1207 
	`REG_RMW_FIELD
(
ah
, 
AR_RXBP_THRESH
, 
AR_RXBP_THRESH_LP
, 0x1);

1209 
	`©h9k_hw_£t_rx_bufsize
(
ah
, 
comm⁄
->
rx_bufsize
 -

1210 
ah
->
ˇps
.
rx_°©us_Àn
);

1217 i‡(
	`AR_SREV_9285
(
ah
)) {

1222 
txbuf_size
 = 
AR_9285_PCU_TXBUF_CTRL_USABLE_SIZE
;

1223 } i‡(
	`AR_SREV_9340_13_OR_LATER
(
ah
)) {

1225 
txbuf_size
 = 
AR_9340_PCU_TXBUF_CTRL_USABLE_SIZE
;

1227 
txbuf_size
 = 
AR_PCU_TXBUF_CTRL_USABLE_SIZE
;

1230 i‡(!
	`AR_SREV_9271
(
ah
))

1231 
	`REG_WRITE
(
ah
, 
AR_PCU_TXBUF_CTRL
, 
txbuf_size
);

1233 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1235 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1236 
	`©h9k_hw_ª£t_tx°©us_rög
(
ah
);

1237 
	}
}

1239 
	$©h9k_hw_£t_›î©ög_mode
(
©h_hw
 *
ah
, 
›mode
)

1241 
u32
 
mask
 = 
AR_STA_ID1_STA_AP
 | 
AR_STA_ID1_ADHOC
;

1242 
u32
 
£t
 = 
AR_STA_ID1_KSRCH_MODE
;

1244 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

1245 
›mode
) {

1246 
NL80211_IFTYPE_ADHOC
:

1247 i‡(!
	`AR_SREV_9340_13
(
ah
)) {

1248 
£t
 |
AR_STA_ID1_ADHOC
;

1249 
	`REG_SET_BIT
(
ah
, 
AR_CFG
, 
AR_CFG_AP_ADHOC_INDICATION
);

1253 
NL80211_IFTYPE_OCB
:

1254 
NL80211_IFTYPE_MESH_POINT
:

1255 
NL80211_IFTYPE_AP
:

1256 
£t
 |
AR_STA_ID1_STA_AP
;

1258 
NL80211_IFTYPE_STATION
:

1259 
	`REG_CLR_BIT
(
ah
, 
AR_CFG
, 
AR_CFG_AP_ADHOC_INDICATION
);

1262 i‡(!
ah
->
is_m⁄ô‹ög
)

1263 
£t
 = 0;

1266 
	`REG_RMW
(
ah
, 
AR_STA_ID1
, 
£t
, 
mask
);

1267 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

1268 
	}
}

1270 
	$©h9k_hw_gë_dñè_¶›e_vÆs
(
©h_hw
 *
ah
, 
u32
 
c€f_sˇÀd
,

1271 
u32
 *
c€f_m™tisß
, u32 *
c€f_exp⁄ít
)

1273 
u32
 
c€f_exp
, 
c€f_m™
;

1275 
c€f_exp
 = 31; coef_exp > 0; coef_exp--)

1276 i‡((
c€f_sˇÀd
 >> 
c€f_exp
) & 0x1)

1279 
c€f_exp
 = 14 - (c€f_ex∞- 
COEF_SCALE_S
);

1281 
c€f_m™
 = 
c€f_sˇÀd
 + (1 << (
COEF_SCALE_S
 - 
c€f_exp
 - 1));

1283 *
c€f_m™tisß
 = 
c€f_m™
 >> (
COEF_SCALE_S
 - 
c€f_exp
);

1284 *
c€f_exp⁄ít
 = 
c€f_exp
 - 16;

1285 
	}
}

1292 
boﬁ
 
	$©h9k_hw_¨9330_ª£t_w¨
(
©h_hw
 *
ah
, 
ty≥
)

1294 
i
, 
≈íd
 = 0;

1296 
i
 = 0; i < 
AR_NUM_QCU
; i++) {

1297 
≈íd
 = 
	`©h9k_hw_numtx≥ndög
(
ah
, 
i
);

1298 i‡(
≈íd
)

1302 i‡(
ah
->
exã∫Æ_ª£t
 &&

1303 (
≈íd
 || 
ty≥
 =
ATH9K_RESET_COLD
)) {

1304 
ª£t_îr
 = 0;

1306 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
,

1309 
ª£t_îr
 = 
ah
->
	`exã∫Æ_ª£t
();

1310 i‡(
ª£t_îr
) {

1311 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

1313 
ª£t_îr
);

1314  
Ál£
;

1317 
	`REG_WRITE
(
ah
, 
AR_RTC_RESET
, 1);

1320  
åue
;

1321 
	}
}

1323 
boﬁ
 
	$©h9k_hw_£t_ª£t
(
©h_hw
 *
ah
, 
ty≥
)

1325 
u32
 
r°_Êags
;

1326 
u32
 
tmpReg
;

1328 i‡(
	`AR_SREV_9100
(
ah
)) {

1329 
	`REG_RMW_FIELD
(
ah
, 
AR_RTC_DERIVED_CLK
,

1330 
AR_RTC_DERIVED_CLK_PERIOD
, 1);

1331 ()
	`REG_READ
(
ah
, 
AR_RTC_DERIVED_CLK
);

1334 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1336 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

1337 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

1338 
	`udñay
(10);

1341 
	`REG_WRITE
(
ah
, 
AR_RTC_FORCE_WAKE
, 
AR_RTC_FORCE_WAKE_EN
 |

1342 
AR_RTC_FORCE_WAKE_ON_INT
);

1344 i‡(
	`AR_SREV_9100
(
ah
)) {

1345 
r°_Êags
 = 
AR_RTC_RC_MAC_WARM
 | 
AR_RTC_RC_MAC_COLD
 |

1346 
AR_RTC_RC_COLD_RESET
 | 
AR_RTC_RC_WARM_RESET
;

1348 
tmpReg
 = 
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE
);

1349 i‡(
	`AR_SREV_9340
(
ah
))

1350 
tmpReg
 &
AR9340_INTR_SYNC_LOCAL_TIMEOUT
;

1352 
tmpReg
 &
AR_INTR_SYNC_LOCAL_TIMEOUT
 |

1353 
AR_INTR_SYNC_RADM_CPL_TIMEOUT
;

1355 i‡(
tmpReg
) {

1356 
u32
 
vÆ
;

1357 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_ENABLE
, 0);

1359 
vÆ
 = 
AR_RC_HOSTIF
;

1360 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1361 
vÆ
 |
AR_RC_AHB
;

1362 
	`REG_WRITE
(
ah
, 
AR_RC
, 
vÆ
);

1364 } i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1365 
	`REG_WRITE
(
ah
, 
AR_RC
, 
AR_RC_AHB
);

1367 
r°_Êags
 = 
AR_RTC_RC_MAC_WARM
;

1368 i‡(
ty≥
 =
ATH9K_RESET_COLD
)

1369 
r°_Êags
 |
AR_RTC_RC_MAC_COLD
;

1372 i‡(
	`AR_SREV_9330
(
ah
)) {

1373 i‡(!
	`©h9k_hw_¨9330_ª£t_w¨
(
ah
, 
ty≥
))

1374  
Ál£
;

1377 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

1378 
	`¨9003_mci_check_gpm_off£t
(
ah
);

1383 i‡(
	`AR_SREV_9300
(
ah
Ë|| 
	`AR_SREV_9580
(ah)) {

1384 
	`REG_SET_BIT
(
ah
, 
AR_CFG
, 
AR_CFG_HALT_REQ
);

1385 
	`©h9k_hw_waô
(
ah
, 
AR_CFG
, 
AR_CFG_HALT_ACK
, AR_CFG_HALT_ACK,

1386 20 * 
AH_WAIT_TIMEOUT
);

1387 
	`REG_CLR_BIT
(
ah
, 
AR_CFG
, 
AR_CFG_HALT_REQ
);

1390 
	`REG_WRITE
(
ah
, 
AR_RTC_RC
, 
r°_Êags
);

1392 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1394 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1395 
	`udñay
(50);

1396 i‡(
	`AR_SREV_9100
(
ah
))

1397 
	`mdñay
(10);

1399 
	`udñay
(100);

1401 
	`REG_WRITE
(
ah
, 
AR_RTC_RC
, 0);

1402 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_RTC_RC
, 
AR_RTC_RC_M
, 0, 
AH_WAIT_TIMEOUT
)) {

1403 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
, "RTC stuck in MACÑeset\n");

1404  
Ál£
;

1407 i‡(!
	`AR_SREV_9100
(
ah
))

1408 
	`REG_WRITE
(
ah
, 
AR_RC
, 0);

1410 i‡(
	`AR_SREV_9100
(
ah
))

1411 
	`udñay
(50);

1413 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah))

1414 
	`©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
ah
);

1416  
åue
;

1417 
	}
}

1419 
boﬁ
 
	$©h9k_hw_£t_ª£t_powî_⁄
(
©h_hw
 *
ah
)

1421 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1423 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

1424 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

1425 
	`udñay
(10);

1428 
	`REG_WRITE
(
ah
, 
AR_RTC_FORCE_WAKE
, 
AR_RTC_FORCE_WAKE_EN
 |

1429 
AR_RTC_FORCE_WAKE_ON_INT
);

1431 i‡(!
	`AR_SREV_9100
(
ah
Ë&& !
	`AR_SREV_9300_20_OR_LATER
(ah))

1432 
	`REG_WRITE
(
ah
, 
AR_RC
, 
AR_RC_AHB
);

1434 
	`REG_WRITE
(
ah
, 
AR_RTC_RESET
, 0);

1436 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1438 
	`udñay
(2);

1440 i‡(!
	`AR_SREV_9100
(
ah
Ë&& !
	`AR_SREV_9300_20_OR_LATER
(ah))

1441 
	`REG_WRITE
(
ah
, 
AR_RC
, 0);

1443 
	`REG_WRITE
(
ah
, 
AR_RTC_RESET
, 1);

1445 i‡(!
	`©h9k_hw_waô
(
ah
,

1446 
AR_RTC_STATUS
,

1447 
AR_RTC_STATUS_M
,

1448 
AR_RTC_STATUS_ON
,

1449 
AH_WAIT_TIMEOUT
)) {

1450 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
, "RTCÇot waking up\n");

1451  
Ál£
;

1454  
	`©h9k_hw_£t_ª£t
(
ah
, 
ATH9K_RESET_WARM
);

1455 
	}
}

1457 
boﬁ
 
	$©h9k_hw_£t_ª£t_ªg
(
©h_hw
 *
ah
, 
u32
 
ty≥
)

1459 
boﬁ
 
ªt
 = 
Ál£
;

1461 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

1462 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

1463 
	`udñay
(10);

1466 
	`REG_WRITE
(
ah
, 
AR_RTC_FORCE_WAKE
,

1467 
AR_RTC_FORCE_WAKE_EN
 | 
AR_RTC_FORCE_WAKE_ON_INT
);

1469 i‡(!
ah
->
ª£t_powî_⁄
)

1470 
ty≥
 = 
ATH9K_RESET_POWER_ON
;

1472 
ty≥
) {

1473 
ATH9K_RESET_POWER_ON
:

1474 
ªt
 = 
	`©h9k_hw_£t_ª£t_powî_⁄
(
ah
);

1475 i‡(
ªt
)

1476 
ah
->
ª£t_powî_⁄
 = 
åue
;

1478 
ATH9K_RESET_WARM
:

1479 
ATH9K_RESET_COLD
:

1480 
ªt
 = 
	`©h9k_hw_£t_ª£t
(
ah
, 
ty≥
);

1486  
ªt
;

1487 
	}
}

1489 
boﬁ
 
	$©h9k_hw_chù_ª£t
(
©h_hw
 *
ah
,

1490 
©h9k_ch™√l
 *
ch™
)

1492 
ª£t_ty≥
 = 
ATH9K_RESET_WARM
;

1494 i‡(
	`AR_SREV_9280
(
ah
)) {

1495 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OL_PWRCTRL
))

1496 
ª£t_ty≥
 = 
ATH9K_RESET_POWER_ON
;

1498 
ª£t_ty≥
 = 
ATH9K_RESET_COLD
;

1499 } i‡(
ah
->
chù_fuŒ¶ìp
 || 
	`REG_READ
◊h, 
AR_Q_TXE
) ||

1500 (
	`REG_READ
(
ah
, 
AR_CR
Ë& 
AR_CR_RXE
))

1501 
ª£t_ty≥
 = 
ATH9K_RESET_COLD
;

1503 i‡(!
	`©h9k_hw_£t_ª£t_ªg
(
ah
, 
ª£t_ty≥
))

1504  
Ál£
;

1506 i‡(!
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_AWAKE
))

1507  
Ál£
;

1509 
ah
->
chù_fuŒ¶ìp
 = 
Ál£
;

1511 i‡(
	`AR_SREV_9330
(
ah
))

1512 
	`¨9003_hw_öã∫Æ_ªguœt‹_≠∂y
(
ah
);

1513 
	`©h9k_hw_öô_∂l
(
ah
, 
ch™
);

1515 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah))

1516 
	`©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
ah
);

1518  
åue
;

1519 
	}
}

1521 
boﬁ
 
	$©h9k_hw_ch™√l_ch™ge
(
©h_hw
 *
ah
,

1522 
©h9k_ch™√l
 *
ch™
)

1524 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1525 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

1526 
boﬁ
 
b™d_swôch
 = 
Ál£
, 
mode_diff
 = false;

1527 
u8
 
öi_ªlﬂded
 = 0;

1528 
u32
 
qnum
;

1529 
r
;

1531 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_FCC_BAND_SWITCH
) {

1532 
u32
 
Êags_diff
 = 
ch™
->
ch™√lFœgs
 ^ 
ah
->
curch™
->channelFlags;

1533 
b™d_swôch
 = !!(
Êags_diff
 & 
CHANNEL_5GHZ
);

1534 
mode_diff
 = !!(
Êags_diff
 & ~
CHANNEL_HT
);

1537 
qnum
 = 0; qnum < 
AR_NUM_QCU
; qnum++) {

1538 i‡(
	`©h9k_hw_numtx≥ndög
(
ah
, 
qnum
)) {

1539 
	`©h_dbg
(
comm⁄
, 
QUEUE
,

1540 "Tønsmô føme†≥ndög o¿queuê%d\n", 
qnum
);

1541  
Ál£
;

1545 i‡(!
	`©h9k_hw_rfbus_ªq
(
ah
)) {

1546 
	`©h_îr
(
comm⁄
, "CouldÇot kill baseband RX\n");

1547  
Ál£
;

1550 i‡(
b™d_swôch
 || 
mode_diff
) {

1551 
	`©h9k_hw_m¨k_phy_öa˘ive
(
ah
);

1552 
	`udñay
(5);

1554 i‡(
b™d_swôch
)

1555 
	`©h9k_hw_öô_∂l
(
ah
, 
ch™
);

1557 i‡(
	`©h9k_hw_Á°_ch™_ch™ge
(
ah
, 
ch™
, &
öi_ªlﬂded
)) {

1558 
	`©h_îr
(
comm⁄
, "FailedÅo do fast channel change\n");

1559  
Ál£
;

1563 
	`©h9k_hw_£t_ch™√l_ªgs
(
ah
, 
ch™
);

1565 
r
 = 
	`©h9k_hw_rf_£t_‰eq
(
ah
, 
ch™
);

1566 i‡(
r
) {

1567 
	`©h_îr
(
comm⁄
, "FailedÅo set channel\n");

1568  
Ál£
;

1570 
	`©h9k_hw_£t_˛ockøã
(
ah
);

1571 
	`©h9k_hw_≠∂y_txpowî
(
ah
, 
ch™
, 
Ál£
);

1573 
	`©h9k_hw_£t_dñè_¶›e
(
ah
, 
ch™
);

1574 
	`©h9k_hw_•ur_môig©e_‰eq
(
ah
, 
ch™
);

1576 i‡(
b™d_swôch
 || 
öi_ªlﬂded
)

1577 
ah
->
ìp_›s
->
	`£t_bﬂrd_vÆues
◊h, 
ch™
);

1579 
	`©h9k_hw_öô_bb
(
ah
, 
ch™
);

1580 
	`©h9k_hw_rfbus_d⁄e
(
ah
);

1582 i‡(
b™d_swôch
 || 
öi_ªlﬂded
) {

1583 
ah
->
ah_Êags
 |
AH_FASTCC
;

1584 
	`©h9k_hw_öô_ˇl
(
ah
, 
ch™
);

1585 
ah
->
ah_Êags
 &~
AH_FASTCC
;

1588  
åue
;

1589 
	}
}

1591 
	$©h9k_hw_≠∂y_gpio_ovîride
(
©h_hw
 *
ah
)

1593 
u32
 
gpio_mask
 = 
ah
->gpio_mask;

1594 
i
;

1596 
i
 = 0; 
gpio_mask
; i++, gpio_mask >>= 1) {

1597 i‡(!(
gpio_mask
 & 1))

1600 
	`©h9k_hw_cfg_ouçut
(
ah
, 
i
, 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

1601 
	`©h9k_hw_£t_gpio
(
ah
, 
i
, !!◊h->
gpio_vÆ
 & 
	`BIT
(i)));

1603 
	}
}

1605 
	$©h9k_hw_check_«v
(
©h_hw
 *
ah
)

1607 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1608 
u32
 
vÆ
;

1610 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_NAV
);

1611 i‡(
vÆ
 != 0xdeadbeef && val > 0x7fff) {

1612 
	`©h_dbg
(
comm⁄
, 
BSTUCK
, "Abn‹mÆ NAV: 0x%x\n", 
vÆ
);

1613 
	`REG_WRITE
(
ah
, 
AR_NAV
, 0);

1615 
	}
}

1616 
EXPORT_SYMBOL
(
©h9k_hw_check_«v
);

1618 
boﬁ
 
	$©h9k_hw_check_Æive
(
©h_hw
 *
ah
)

1620 
cou¡
 = 50;

1621 
u32
 
ªg
, 
œ°_vÆ
;

1623 i‡(
	`AR_SREV_9300
(
ah
))

1624  !
	`©h9k_hw_dëe˘_mac_h™g
(
ah
);

1626 i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
))

1627  
åue
;

1629 
œ°_vÆ
 = 
	`REG_READ
(
ah
, 
AR_OBS_BUS_1
);

1631 
ªg
 = 
	`REG_READ
(
ah
, 
AR_OBS_BUS_1
);

1632 i‡(
ªg
 !
œ°_vÆ
)

1633  
åue
;

1635 
	`udñay
(1);

1636 
œ°_vÆ
 = 
ªg
;

1637 i‡((
ªg
 & 0x7E7FFFEF) == 0x00702400)

1640 
ªg
 & 0x7E000B00) {

1646  
åue
;

1648 } 
cou¡
-- > 0);

1650  
Ál£
;

1651 
	}
}

1652 
EXPORT_SYMBOL
(
©h9k_hw_check_Æive
);

1654 
	$©h9k_hw_öô_mÂ
(
©h_hw
 *
ah
)

1657 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

1660 
	`REG_RMW_FIELD
(
ah
, 
AR_AES_MUTE_MASK1
, 
AR_AES_MUTE_MASK1_FC_MGMT
,

1662 i‡(
	`AR_SREV_9271
(
ah
Ë|| 
	`AR_DEVID_7010
(ah))

1663 
ah
->
sw_mgmt_¸y±o_tx
 = 
åue
;

1665 
ah
->
sw_mgmt_¸y±o_tx
 = 
Ál£
;

1666 
ah
->
sw_mgmt_¸y±o_rx
 = 
Ál£
;

1667 } i‡(
	`AR_SREV_9160_10_OR_LATER
(
ah
)) {

1669 
	`REG_CLR_BIT
(
ah
, 
AR_PCU_MISC_MODE2
,

1670 
AR_PCU_MISC_MODE2_MGMT_CRYPTO_ENABLE
);

1671 
	`REG_SET_BIT
(
ah
, 
AR_PCU_MISC_MODE2
,

1672 
AR_PCU_MISC_MODE2_NO_CRYPTO_FOR_NON_DATA_PKT
);

1673 
ah
->
sw_mgmt_¸y±o_tx
 = 
åue
;

1674 
ah
->
sw_mgmt_¸y±o_rx
 = 
åue
;

1676 
ah
->
sw_mgmt_¸y±o_tx
 = 
åue
;

1677 
ah
->
sw_mgmt_¸y±o_rx
 = 
åue
;

1679 
	}
}

1681 
	$©h9k_hw_ª£t_›mode
(
©h_hw
 *
ah
,

1682 
u32
 
macSèId1
, u32 
ßveDefA¡í«
)

1684 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1686 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1688 
	`REG_RMW
(
ah
, 
AR_STA_ID1
, 
macSèId1


1689 | 
AR_STA_ID1_RTS_USE_DEF


1690 | 
ah
->
°a_id1_deÁu…s
,

1691 ~
AR_STA_ID1_SADH_MASK
);

1692 
	`©h_hw_£tbssidmask
(
comm⁄
);

1693 
	`REG_WRITE
(
ah
, 
AR_DEF_ANTENNA
, 
ßveDefA¡í«
);

1694 
	`©h9k_hw_wrôe_associd
(
ah
);

1695 
	`REG_WRITE
(
ah
, 
AR_ISR
, ~0);

1696 
	`REG_WRITE
(
ah
, 
AR_RSSI_THR
, 
INIT_RSSI_THR
);

1698 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1700 
	`©h9k_hw_£t_›î©ög_mode
(
ah
,áh->
›mode
);

1701 
	}
}

1703 
	$©h9k_hw_öô_queues
(
©h_hw
 *
ah
)

1705 
i
;

1707 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

1709 
i
 = 0; i < 
AR_NUM_DCU
; i++)

1710 
	`REG_WRITE
(
ah
, 
	`AR_DQCUMASK
(
i
), 1 << i);

1712 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

1714 
ah
->
öå_txqs
 = 0;

1715 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++)

1716 
	`©h9k_hw_ª£âxqueue
(
ah
, 
i
);

1717 
	}
}

1722 
	$©h9k_hw_öô_desc
(
©h_hw
 *
ah
)

1724 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1726 i‡(
	`AR_SREV_9100
(
ah
)) {

1727 
u32
 
mask
;

1728 
mask
 = 
	`REG_READ
(
ah
, 
AR_CFG
);

1729 i‡(
mask
 & (
AR_CFG_SWRB
 | 
AR_CFG_SWTB
 | 
AR_CFG_SWRG
)) {

1730 
	`©h_dbg
(
comm⁄
, 
RESET
, "CFG Byte Swap Set 0x%x\n",

1731 
mask
);

1733 
mask
 = 
INIT_CONFIG_STATUS
 | 
AR_CFG_SWRB
 | 
AR_CFG_SWTB
;

1734 
	`REG_WRITE
(
ah
, 
AR_CFG
, 
mask
);

1735 
	`©h_dbg
(
comm⁄
, 
RESET
, "Setting CFG 0x%x\n",

1736 
	`REG_READ
(
ah
, 
AR_CFG
));

1739 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_USB
) {

1741 i‡(
	`AR_SREV_9271
(
ah
))

1742 
	`REG_WRITE
(
ah
, 
AR_CFG
, 
AR_CFG_SWRB
 | 
AR_CFG_SWTB
);

1744 
	`REG_WRITE
(
ah
, 
AR_CFG
, 
AR_CFG_SWTD
 | 
AR_CFG_SWRD
);

1746 #ifde‡
__BIG_ENDIAN


1747 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah) ||

1748 
	`AR_SREV_9550
(
ah
Ë|| 
	`AR_SREV_9531
(ah) ||

1749 
	`AR_SREV_9561
(
ah
))

1750 
	`REG_RMW
(
ah
, 
AR_CFG
, 
AR_CFG_SWRB
 | 
AR_CFG_SWTB
, 0);

1752 
	`REG_WRITE
(
ah
, 
AR_CFG
, 
AR_CFG_SWTD
 | 
AR_CFG_SWRD
);

1755 
	}
}

1761 
	$©h9k_hw_do_Á°cc
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

1763 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1764 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

1765 
ªt
;

1767 i‡(
	`AR_SREV_9280
(
ah
Ë&& 
comm⁄
->
bus_›s
->
©h_bus_ty≥
 =
ATH_PCI
)

1768 
Áû
;

1770 i‡(
ah
->
chù_fuŒ¶ìp
)

1771 
Áû
;

1773 i‡(!
ah
->
curch™
)

1774 
Áû
;

1776 i‡(
ch™
->
ch™√l
 =
ah
->
curch™
->channel)

1777 
Áû
;

1779 i‡((
ah
->
curch™
->
ch™√lFœgs
 | 
ch™
->channelFlags) &

1780 (
CHANNEL_HALF
 | 
CHANNEL_QUARTER
))

1781 
Áû
;

1786 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_FCC_BAND_SWITCH
) &&

1787 ((
ch™
->
ch™√lFœgs
 ^ 
ah
->
curch™
->ch™√lFœgsË& ~
CHANNEL_HT
))

1788 
Áû
;

1790 i‡(!
	`©h9k_hw_check_Æive
(
ah
))

1791 
Áû
;

1797 i‡(
	`AR_SREV_9462
(
ah
Ë&& (ah->
ˇld©a
 &&

1798 (!
	`ã°_bô
(
TXIQCAL_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
) ||

1799 !
	`ã°_bô
(
TXCLCAL_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
) ||

1800 !
	`ã°_bô
(
RTT_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
))))

1801 
Áû
;

1803 
	`©h_dbg
(
comm⁄
, 
RESET
, "FastChannelChange for %d -> %d\n",

1804 
ah
->
curch™
->
ch™√l
, 
ch™
->channel);

1806 
ªt
 = 
	`©h9k_hw_ch™√l_ch™ge
(
ah
, 
ch™
);

1807 i‡(!
ªt
)

1808 
Áû
;

1810 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

1811 
	`¨9003_mci_2g5g_swôch
(
ah
, 
Ál£
);

1813 
	`©h9k_hw_lﬂdnf
(
ah
,áh->
curch™
);

1814 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
åue
);

1816 i‡(
	`AR_SREV_9271
(
ah
))

1817 
	`¨9002_hw_lﬂd_™i_ªg
(
ah
, 
ch™
);

1819 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah))

1820 
	`©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
ah
);

1823 
Áû
:

1824 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah))

1825 
	`©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
ah
);

1827  -
EINVAL
;

1828 
	}
}

1830 
u32
 
	$©h9k_hw_gë_tsf_off£t
(
time•ec
 *
œ°
, time•e¯*
cur
)

1832 
time•ec
 
ts
;

1833 
s64
 
u£c
;

1835 i‡(!
cur
) {

1836 
	`gëøwm⁄Ÿ⁄ic
(&
ts
);

1837 
cur
 = &
ts
;

1840 
u£c
 = 
cur
->
tv_£c
 * 1000000ULL + cur->
tv_n£c
 / 1000;

1841 
u£c
 -
œ°
->
tv_£c
 * 1000000ULL +Üa°->
tv_n£c
 / 1000;

1843  (
u32
Ë
u£c
;

1844 
	}
}

1845 
EXPORT_SYMBOL
(
©h9k_hw_gë_tsf_off£t
);

1847 
	$©h9k_hw_upd©e_düg
(
©h_hw
 *
ah
)

1849 i‡(
	`ã°_bô
(
ATH_DIAG_DISABLE_RX
, &
ah
->
düg
))

1850 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

1852 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_RX_DIS
);

1854 i‡(
	`ã°_bô
(
ATH_DIAG_DISABLE_TX
, &
ah
->
düg
))

1855 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_LOOP_BACK
);

1857 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_LOOP_BACK
);

1858 
	}
}

1859 
EXPORT_SYMBOL
(
©h9k_hw_upd©e_düg
);

1861 
	$©h9k_hw_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

1862 
©h9k_hw_ˇl_d©a
 *
ˇld©a
, 
boﬁ
 
Á°cc
)

1864 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1865 
u32
 
ßveLedSèã
;

1866 
u32
 
ßveDefA¡í«
;

1867 
u32
 
macSèId1
;

1868 
u64
 
tsf
 = 0;

1869 
s64
 
u£c
 = 0;

1870 
r
;

1871 
boﬁ
 
°¨t_mci_ª£t
 = 
Ál£
;

1872 
boﬁ
 
ßve_fuŒ¶ìp
 = 
ah
->
chù_fuŒ¶ìp
;

1874 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
)) {

1875 
°¨t_mci_ª£t
 = 
	`¨9003_mci_°¨t_ª£t
(
ah
, 
ch™
);

1876 i‡(
°¨t_mci_ª£t
)

1880 i‡(!
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_AWAKE
))

1881  -
EIO
;

1883 i‡(
ah
->
curch™
 && !ah->
chù_fuŒ¶ìp
)

1884 
	`©h9k_hw_gënf
(
ah
,áh->
curch™
);

1886 
ah
->
ˇld©a
 = caldata;

1887 i‡(
ˇld©a
 && (
ch™
->
ch™√l
 != caldata->channel ||

1888 
ch™
->
ch™√lFœgs
 !
ˇld©a
->channelFlags)) {

1890 
	`mem£t
(
ˇld©a
, 0, (*caldata));

1891 
	`©h9k_öô_nfˇl_hi°_buf„r
(
ah
, 
ch™
);

1892 } i‡(
ˇld©a
) {

1893 
	`˛ór_bô
(
PAPRD_PACKET_SENT
, &
ˇld©a
->
ˇl_Êags
);

1895 
ah
->
noi£
 = 
	`©h9k_hw_gëch™_noi£
◊h, 
ch™
, ch™->
noi£Êo‹
);

1897 i‡(
Á°cc
) {

1898 
r
 = 
	`©h9k_hw_do_Á°cc
(
ah
, 
ch™
);

1899 i‡(!
r
)

1900  
r
;

1903 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

1904 
	`¨9003_mci_°›_bt
(
ah
, 
ßve_fuŒ¶ìp
);

1906 
ßveDefA¡í«
 = 
	`REG_READ
(
ah
, 
AR_DEF_ANTENNA
);

1907 i‡(
ßveDefA¡í«
 == 0)

1908 
ßveDefA¡í«
 = 1;

1910 
macSèId1
 = 
	`REG_READ
(
ah
, 
AR_STA_ID1
Ë& 
AR_STA_ID1_BASE_RATE_11B
;

1913 
tsf
 = 
	`©h9k_hw_gëtsf64
(
ah
);

1914 
u£c
 = 
	`ktime_to_us
(
	`ktime_gë_øw
());

1916 
ßveLedSèã
 = 
	`REG_READ
(
ah
, 
AR_CFG_LED
) &

1917 (
AR_CFG_LED_ASSOC_CTL
 | 
AR_CFG_LED_MODE_SEL
 |

1918 
AR_CFG_LED_BLINK_THRESH_SEL
 | 
AR_CFG_LED_BLINK_SLOW
);

1920 
	`©h9k_hw_m¨k_phy_öa˘ive
(
ah
);

1922 
ah
->
∑¥d_èbÀ_wrôe_d⁄e
 = 
Ál£
;

1925 i‡(
	`AR_SREV_9271
(
ah
Ë&&áh->
htc_ª£t_öô
) {

1926 
	`REG_WRITE
(
ah
,

1927 
AR9271_RESET_POWER_DOWN_CONTROL
,

1928 
AR9271_RADIO_RF_RST
);

1929 
	`udñay
(50);

1932 i‡(!
	`©h9k_hw_chù_ª£t
(
ah
, 
ch™
)) {

1933 
	`©h_îr
(
comm⁄
, "ChipÑeset failed\n");

1934  -
EINVAL
;

1938 i‡(
	`AR_SREV_9271
(
ah
Ë&&áh->
htc_ª£t_öô
) {

1939 
ah
->
htc_ª£t_öô
 = 
Ál£
;

1940 
	`REG_WRITE
(
ah
,

1941 
AR9271_RESET_POWER_DOWN_CONTROL
,

1942 
AR9271_GATE_MAC_CTL
);

1943 
	`udñay
(50);

1947 
u£c
 = 
	`ktime_to_us
(
	`ktime_gë_øw
()) - usec;

1948 
	`©h9k_hw_£âsf64
(
ah
, 
tsf
 + 
u£c
);

1950 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

1951 
	`REG_SET_BIT
(
ah
, 
AR_GPIO_INPUT_EN_VAL
, 
AR_GPIO_JTAG_DISABLE
);

1953 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

1954 
	`¨9002_hw_íabÀ_async_fifo
(
ah
);

1956 
r
 = 
	`©h9k_hw_¥o˚ss_öi
(
ah
, 
ch™
);

1957 i‡(
r
)

1958  
r
;

1960 
	`©h9k_hw_£t_rfmode
(
ah
, 
ch™
);

1962 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

1963 
	`¨9003_mci_ª£t
(
ah
, 
Ál£
, 
	`IS_CHAN_2GHZ
(
ch™
), 
ßve_fuŒ¶ìp
);

1971 i‡(
	`AR_SREV_9100
(
ah
Ë&& (
	`©h9k_hw_gëtsf64
◊hË< 
tsf
)) {

1972 
tsf
 += 1500;

1973 
	`©h9k_hw_£âsf64
(
ah
, 
tsf
);

1976 
	`©h9k_hw_öô_mÂ
(
ah
);

1978 
	`©h9k_hw_£t_dñè_¶›e
(
ah
, 
ch™
);

1979 
	`©h9k_hw_•ur_môig©e_‰eq
(
ah
, 
ch™
);

1980 
ah
->
ìp_›s
->
	`£t_bﬂrd_vÆues
◊h, 
ch™
);

1982 
	`©h9k_hw_ª£t_›mode
(
ah
, 
macSèId1
, 
ßveDefA¡í«
);

1984 
r
 = 
	`©h9k_hw_rf_£t_‰eq
(
ah
, 
ch™
);

1985 i‡(
r
)

1986  
r
;

1988 
	`©h9k_hw_£t_˛ockøã
(
ah
);

1990 
	`©h9k_hw_öô_queues
(
ah
);

1991 
	`©h9k_hw_öô_öãºu±_masks
(
ah
,áh->
›mode
);

1992 
	`©h9k_hw_™i_ˇche_öi_ªgs
(
ah
);

1993 
	`©h9k_hw_öô_qos
(
ah
);

1995 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_RFSILENT
)

1996 
	`©h9k_hw_cfg_gpio_öput
(
ah
,áh->
rfkûl_gpio
);

1998 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

2000 i‡(
	`AR_SREV_9287
(
ah
Ë&& 
	`AR_SREV_9287_13_OR_LATER
(ah)) {

2001 
	`REG_SET_BIT
(
ah
, 
AR_MAC_PCU_LOGIC_ANALYZER
,

2002 
AR_MAC_PCU_LOGIC_ANALYZER_DISBUG20768
);

2003 
	`REG_RMW_FIELD
(
ah
, 
AR_AHB_MODE
, 
AR_AHB_CUSTOM_BURST_EN
,

2004 
AR_AHB_CUSTOM_BURST_ASYNC_FIFO_VAL
);

2005 
	`REG_SET_BIT
(
ah
, 
AR_PCU_MISC_MODE2
,

2006 
AR_PCU_MISC_MODE2_ENABLE_AGGWEP
);

2009 
	`REG_SET_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PRESERVE_SEQNUM
);

2011 
	`©h9k_hw_£t_dma
(
ah
);

2013 i‡(!
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2014 
	`REG_WRITE
(
ah
, 
AR_OBS
, 8);

2016 
	`ENABLE_REG_RMW_BUFFER
(
ah
);

2017 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
) {

2018 
	`REG_RMW_FIELD
(
ah
, 
AR_RIMT
, 
AR_RIMT_LAST
,áh->
c⁄fig
.
rimt_œ°
);

2019 
	`REG_RMW_FIELD
(
ah
, 
AR_RIMT
, 
AR_RIMT_FIRST
,áh->
c⁄fig
.
rimt_fú°
);

2022 i‡(
ah
->
c⁄fig
.
tx_öå_môig©i⁄
) {

2023 
	`REG_RMW_FIELD
(
ah
, 
AR_TIMT
, 
AR_TIMT_LAST
, 300);

2024 
	`REG_RMW_FIELD
(
ah
, 
AR_TIMT
, 
AR_TIMT_FIRST
, 750);

2026 
	`REG_RMW_BUFFER_FLUSH
(
ah
);

2028 
	`©h9k_hw_öô_bb
(
ah
, 
ch™
);

2030 i‡(
ˇld©a
) {

2031 
	`˛ór_bô
(
TXIQCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

2032 
	`˛ór_bô
(
TXCLCAL_DONE
, &
ˇld©a
->
ˇl_Êags
);

2034 i‡(!
	`©h9k_hw_öô_ˇl
(
ah
, 
ch™
))

2035  -
EIO
;

2037 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
Ë&& 
	`¨9003_mci_íd_ª£t
◊h, 
ch™
, 
ˇld©a
))

2038  -
EIO
;

2040 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

2042 
	`©h9k_hw_ª°‹e_chaömask
(
ah
);

2043 
	`REG_WRITE
(
ah
, 
AR_CFG_LED
, 
ßveLedSèã
 | 
AR_CFG_SCLK_32KHZ
);

2045 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

2047 
	`©h9k_hw_gí_timî_°¨t_tsf2
(
ah
);

2049 
	`©h9k_hw_öô_desc
(
ah
);

2051 i‡(
	`©h9k_hw_btc€x_is_íabÀd
(
ah
))

2052 
	`©h9k_hw_btc€x_íabÀ
(
ah
);

2054 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2055 
	`¨9003_mci_check_bt
(
ah
);

2057 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

2058 
	`©h9k_hw_lﬂdnf
(
ah
, 
ch™
);

2059 
	`©h9k_hw_°¨t_nfˇl
(
ah
, 
åue
);

2062 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2063 
	`¨9003_hw_bb_w©chdog_c⁄fig
(
ah
);

2065 i‡(
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_PHYRESTART_CLC_WAR
)

2066 
	`¨9003_hw_dißbÀ_phy_ª°¨t
(
ah
);

2068 
	`©h9k_hw_≠∂y_gpio_ovîride
(
ah
);

2069 
	`©h9k_hw_upd©e_düg
(
ah
);

2071 i‡(
	`AR_SREV_9565
(
ah
Ë&& 
comm⁄
->
bt_™t_divîsôy
)

2072 
	`REG_SET_BIT
(
ah
, 
AR_BTCOEX_WL_LNADIV
, 
AR_BTCOEX_WL_LNADIV_FORCE_ON
);

2074 i‡(
ah
->
hw
->
c⁄f
.
ød¨_íabÀd
) {

2076 
ah
->
ød¨_c⁄f
.
ext_ch™√l
 = 
	`IS_CHAN_HT40
(
ch™
);

2077 
	`©h9k_hw_£t_ød¨_∑øms
(
ah
);

2080 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9340
(ah))

2081 
	`©h9k_hw_dißbÀ_∂l_lock_dëe˘
(
ah
);

2084 
	}
}

2085 
EXPORT_SYMBOL
(
©h9k_hw_ª£t
);

2095 
	$©h9k_£t_powî_¶ìp
(
©h_hw
 *
ah
)

2097 
	`REG_SET_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PWR_SAV
);

2099 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

2100 
	`REG_CLR_BIT
(
ah
, 
AR_TIMER_MODE
, 0xff);

2101 
	`REG_CLR_BIT
(
ah
, 
AR_NDP2_TIMER_MODE
, 0xff);

2102 
	`REG_CLR_BIT
(
ah
, 
AR_SLP32_INC
, 0xfffff);

2104 
	`REG_WRITE
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_EN
, 0);

2105 
	`udñay
(100);

2112 
	`REG_CLR_BIT
(
ah
, 
AR_RTC_FORCE_WAKE
, 
AR_RTC_FORCE_WAKE_EN
);

2114 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2115 
	`udñay
(100);

2117 i‡(!
	`AR_SREV_9100
(
ah
Ë&& !
	`AR_SREV_9300_20_OR_LATER
(ah))

2118 
	`REG_WRITE
(
ah
, 
AR_RC
, 
AR_RC_AHB
 | 
AR_RC_HOSTIF
);

2121 i‡(!
	`AR_SREV_5416
(
ah
Ë&& !
	`AR_SREV_9271
(ah)) {

2122 
	`REG_CLR_BIT
(
ah
, 
AR_RTC_RESET
, 
AR_RTC_RESET_EN
);

2123 
	`udñay
(2);

2127 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2128 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
 & ~
AR_WA_D3_L1_DISABLE
);

2129 
	}
}

2136 
	$©h9k_£t_powî_√tw‹k_¶ìp
(
©h_hw
 *
ah
)

2138 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

2140 
	`REG_SET_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PWR_SAV
);

2142 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
)) {

2144 
	`REG_WRITE
(
ah
, 
AR_RTC_FORCE_WAKE
,

2145 
AR_RTC_FORCE_WAKE_ON_INT
);

2157 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2158 
	`REG_CLR_BIT
(
ah
, 
AR_MCI_INTERRUPT_RX_MSG_EN
,

2159 
AR_MCI_INTERRUPT_RX_HW_MSG_MASK
);

2164 
	`REG_CLR_BIT
(
ah
, 
AR_RTC_FORCE_WAKE
, 
AR_RTC_FORCE_WAKE_EN
);

2166 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2167 
	`udñay
(30);

2171 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2172 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
 & ~
AR_WA_D3_L1_DISABLE
);

2173 
	}
}

2175 
boﬁ
 
	$©h9k_hw_£t_powî_awake
(
©h_hw
 *
ah
)

2177 
u32
 
vÆ
;

2178 
i
;

2181 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

2182 
	`REG_WRITE
(
ah
, 
AR_WA
,áh->
WARegVÆ
);

2183 
	`udñay
(10);

2186 i‡((
	`REG_READ
(
ah
, 
AR_RTC_STATUS
) &

2187 
AR_RTC_STATUS_M
Ë=
AR_RTC_STATUS_SHUTDOWN
) {

2188 i‡(!
	`©h9k_hw_£t_ª£t_ªg
(
ah
, 
ATH9K_RESET_POWER_ON
)) {

2189  
Ál£
;

2191 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2192 
	`©h9k_hw_öô_∂l
(
ah
, 
NULL
);

2194 i‡(
	`AR_SREV_9100
(
ah
))

2195 
	`REG_SET_BIT
(
ah
, 
AR_RTC_RESET
,

2196 
AR_RTC_RESET_EN
);

2198 
	`REG_SET_BIT
(
ah
, 
AR_RTC_FORCE_WAKE
,

2199 
AR_RTC_FORCE_WAKE_EN
);

2200 i‡(
	`AR_SREV_9100
(
ah
))

2201 
	`mdñay
(10);

2203 
	`udñay
(50);

2205 
i
 = 
POWER_UP_TIME
 / 50; i > 0; i--) {

2206 
vÆ
 = 
	`REG_READ
(
ah
, 
AR_RTC_STATUS
Ë& 
AR_RTC_STATUS_M
;

2207 i‡(
vÆ
 =
AR_RTC_STATUS_ON
)

2209 
	`udñay
(50);

2210 
	`REG_SET_BIT
(
ah
, 
AR_RTC_FORCE_WAKE
,

2211 
AR_RTC_FORCE_WAKE_EN
);

2213 i‡(
i
 == 0) {

2214 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

2216 
POWER_UP_TIME
 / 20);

2217  
Ál£
;

2220 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2221 
	`¨9003_mci_£t_powî_awake
(
ah
);

2223 
	`REG_CLR_BIT
(
ah
, 
AR_STA_ID1
, 
AR_STA_ID1_PWR_SAV
);

2225  
åue
;

2226 
	}
}

2228 
boﬁ
 
	$©h9k_hw_£çowî
(
©h_hw
 *
ah
, 
©h9k_powî_mode
 
mode
)

2230 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2231 
°©us
 = 
åue
;

2232 c⁄° *
modes
[] = {

2239 i‡(
ah
->
powî_mode
 =
mode
)

2240  
°©us
;

2242 
	`©h_dbg
(
comm⁄
, 
RESET
, "%s -> %s\n",

2243 
modes
[
ah
->
powî_mode
], modes[
mode
]);

2245 
mode
) {

2246 
ATH9K_PM_AWAKE
:

2247 
°©us
 = 
	`©h9k_hw_£t_powî_awake
(
ah
);

2249 
ATH9K_PM_FULL_SLEEP
:

2250 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2251 
	`¨9003_mci_£t_fuŒ_¶ìp
(
ah
);

2253 
	`©h9k_£t_powî_¶ìp
(
ah
);

2254 
ah
->
chù_fuŒ¶ìp
 = 
åue
;

2256 
ATH9K_PM_NETWORK_SLEEP
:

2257 
	`©h9k_£t_powî_√tw‹k_¶ìp
(
ah
);

2260 
	`©h_îr
(
comm⁄
, "Unknow¿powî modê%u\n", 
mode
);

2261  
Ál£
;

2263 
ah
->
powî_mode
 = 
mode
;

2271 i‡(!(
ah
->
ah_Êags
 & 
AH_UNPLUGGED
))

2272 
	`ATH_DBG_WARN_ON_ONCE
(!
°©us
);

2274  
°©us
;

2275 
	}
}

2276 
EXPORT_SYMBOL
(
©h9k_hw_£çowî
);

2282 
	$©h9k_hw_bóc⁄öô
(
©h_hw
 *
ah
, 
u32
 
√xt_bóc⁄
, u32 
bóc⁄_≥riod
)

2284 
Êags
 = 0;

2286 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

2288 
ah
->
›mode
) {

2289 
NL80211_IFTYPE_ADHOC
:

2290 
	`REG_SET_BIT
(
ah
, 
AR_TXCFG
,

2291 
AR_TXCFG_ADHOC_BEACON_ATIM_TX_POLICY
);

2292 
NL80211_IFTYPE_MESH_POINT
:

2293 
NL80211_IFTYPE_AP
:

2294 
	`REG_WRITE
(
ah
, 
AR_NEXT_TBTT_TIMER
, 
√xt_bóc⁄
);

2295 
	`REG_WRITE
(
ah
, 
AR_NEXT_DMA_BEACON_ALERT
, 
√xt_bóc⁄
 -

2296 
	`TU_TO_USEC
(
ah
->
c⁄fig
.
dma_bóc⁄_ª•⁄£_time
));

2297 
	`REG_WRITE
(
ah
, 
AR_NEXT_SWBA
, 
√xt_bóc⁄
 -

2298 
	`TU_TO_USEC
(
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
));

2299 
Êags
 |=

2300 
AR_TBTT_TIMER_EN
 | 
AR_DBA_TIMER_EN
 | 
AR_SWBA_TIMER_EN
;

2303 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
BEACON
,

2304 "%s: unsuµ‹ãd opmode: %d\n", 
__func__
, 
ah
->
›mode
);

2309 
	`REG_WRITE
(
ah
, 
AR_BEACON_PERIOD
, 
bóc⁄_≥riod
);

2310 
	`REG_WRITE
(
ah
, 
AR_DMA_BEACON_PERIOD
, 
bóc⁄_≥riod
);

2311 
	`REG_WRITE
(
ah
, 
AR_SWBA_PERIOD
, 
bóc⁄_≥riod
);

2313 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

2315 
	`REG_SET_BIT
(
ah
, 
AR_TIMER_MODE
, 
Êags
);

2316 
	}
}

2317 
EXPORT_SYMBOL
(
©h9k_hw_bóc⁄öô
);

2319 
	$©h9k_hw_£t_°a_bóc⁄_timîs
(
©h_hw
 *
ah
,

2320 c⁄° 
©h9k_bóc⁄_°©e
 *
bs
)

2322 
u32
 
√xtTbâ
, 
bóc⁄ötvÆ
, 
dtim≥riod
, 
bóc⁄timeout
;

2323 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

2324 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2326 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

2328 
	`REG_WRITE
(
ah
, 
AR_NEXT_TBTT_TIMER
, 
bs
->
bs_√xâbâ
);

2329 
	`REG_WRITE
(
ah
, 
AR_BEACON_PERIOD
, 
bs
->
bs_ötvÆ
);

2330 
	`REG_WRITE
(
ah
, 
AR_DMA_BEACON_PERIOD
, 
bs
->
bs_ötvÆ
);

2332 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

2334 
	`REG_RMW_FIELD
(
ah
, 
AR_RSSI_THR
,

2335 
AR_RSSI_THR_BM_THR
, 
bs
->
bs_bmis°hªshﬁd
);

2337 
bóc⁄ötvÆ
 = 
bs
->
bs_ötvÆ
;

2339 i‡(
bs
->
bs_¶ìpduøti⁄
 > 
bóc⁄ötvÆ
)

2340 
bóc⁄ötvÆ
 = 
bs
->
bs_¶ìpduøti⁄
;

2342 
dtim≥riod
 = 
bs
->
bs_dtim≥riod
;

2343 i‡(
bs
->
bs_¶ìpduøti⁄
 > 
dtim≥riod
)

2344 
dtim≥riod
 = 
bs
->
bs_¶ìpduøti⁄
;

2346 i‡(
bóc⁄ötvÆ
 =
dtim≥riod
)

2347 
√xtTbâ
 = 
bs
->
bs_√xtdtim
;

2349 
√xtTbâ
 = 
bs
->
bs_√xâbâ
;

2351 
	`©h_dbg
(
comm⁄
, 
BEACON
, "√xàDTIM %u\n", 
bs
->
bs_√xtdtim
);

2352 
	`©h_dbg
(
comm⁄
, 
BEACON
, "√xàbóc⁄ %u\n", 
√xtTbâ
);

2353 
	`©h_dbg
(
comm⁄
, 
BEACON
, "bóc⁄Öîiod %u\n", 
bóc⁄ötvÆ
);

2354 
	`©h_dbg
(
comm⁄
, 
BEACON
, "DTIMÖîiod %u\n", 
dtim≥riod
);

2356 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

2358 
	`REG_WRITE
(
ah
, 
AR_NEXT_DTIM
, 
bs
->
bs_√xtdtim
 - 
SLEEP_SLOP
);

2359 
	`REG_WRITE
(
ah
, 
AR_NEXT_TIM
, 
√xtTbâ
 - 
SLEEP_SLOP
);

2361 
	`REG_WRITE
(
ah
, 
AR_SLEEP1
,

2362 
	`SM
((
CAB_TIMEOUT_VAL
 << 3), 
AR_SLEEP1_CAB_TIMEOUT
)

2363 | 
AR_SLEEP1_ASSUME_DTIM
);

2365 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
)

2366 
bóc⁄timeout
 = (
BEACON_TIMEOUT_VAL
 << 3);

2368 
bóc⁄timeout
 = 
MIN_BEACON_TIMEOUT_VAL
;

2370 
	`REG_WRITE
(
ah
, 
AR_SLEEP2
,

2371 
	`SM
(
bóc⁄timeout
, 
AR_SLEEP2_BEACON_TIMEOUT
));

2373 
	`REG_WRITE
(
ah
, 
AR_TIM_PERIOD
, 
bóc⁄ötvÆ
);

2374 
	`REG_WRITE
(
ah
, 
AR_DTIM_PERIOD
, 
dtim≥riod
);

2376 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

2378 
	`REG_SET_BIT
(
ah
, 
AR_TIMER_MODE
,

2379 
AR_TBTT_TIMER_EN
 | 
AR_TIM_TIMER_EN
 |

2380 
AR_DTIM_TIMER_EN
);

2383 
	`REG_WRITE
(
ah
, 
AR_TSFOOR_THRESHOLD
, 
bs
->
bs_tsfo‹_thªshﬁd
);

2384 
	}
}

2385 
EXPORT_SYMBOL
(
©h9k_hw_£t_°a_bóc⁄_timîs
);

2391 
u8
 
	$fixup_chaömask
(
u8
 
chù_chaömask
, u8 
ì¥om_chaömask
)

2393 
ì¥om_chaömask
 &
chù_chaömask
;

2394 i‡(
ì¥om_chaömask
)

2395  
ì¥om_chaömask
;

2397  
chù_chaömask
;

2398 
	}
}

2413 
boﬁ
 
	$©h9k_hw_dfs_ã°ed
(
©h_hw
 *
ah
)

2416 
ah
->
hw_vîsi⁄
.
macVîsi⁄
) {

2418 
AR_SREV_VERSION_9280
:

2420 
AR_SREV_VERSION_9580
:

2421  
åue
;

2423  
Ál£
;

2425 
	}
}

2427 
	$©h9k_hw_fûl_ˇp_öfo
(
©h_hw
 *
ah
)

2429 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

2430 
©h_ªguœt‹y
 *
ªguœt‹y
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

2431 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2433 
u16
 
ìvÆ
;

2434 
u8
 
™t_div_˘l1
, 
tx_chaömask
, 
rx_chaömask
;

2436 
ìvÆ
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_REG_0
);

2437 
ªguœt‹y
->
cuºít_rd
 = 
ìvÆ
;

2439 i‡(
ah
->
›mode
 !
NL80211_IFTYPE_AP
 &&

2440 
ah
->
hw_vîsi⁄
.
subvíd‹id
 =
AR_SUBVENDOR_ID_NEW_A
) {

2441 i‡(
ªguœt‹y
->
cuºít_rd
 == 0x64 ||

2442 
ªguœt‹y
->
cuºít_rd
 == 0x65)

2443 
ªguœt‹y
->
cuºít_rd
 += 5;

2444 i‡(
ªguœt‹y
->
cuºít_rd
 == 0x41)

2445 
ªguœt‹y
->
cuºít_rd
 = 0x43;

2446 
	`©h_dbg
(
comm⁄
, 
REGULATORY
, "regdomain mappedÅo 0x%x\n",

2447 
ªguœt‹y
->
cuºít_rd
);

2450 
ìvÆ
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_OP_MODE
);

2452 i‡(
ìvÆ
 & 
AR5416_OPFLAGS_11A
) {

2453 i‡(
ah
->
dißbÀ_5ghz
)

2454 
	`©h_w¨n
(
comm⁄
, "disabling 5GHz band\n");

2456 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_5GHZ
;

2459 i‡(
ìvÆ
 & 
AR5416_OPFLAGS_11G
) {

2460 i‡(
ah
->
dißbÀ_2ghz
)

2461 
	`©h_w¨n
(
comm⁄
, "disabling 2GHz band\n");

2463 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_2GHZ
;

2466 i‡((
pC≠
->
hw_ˇps
 & (
ATH9K_HW_CAP_2GHZ
 | 
ATH9K_HW_CAP_5GHZ
)) == 0) {

2467 
	`©h_îr
(
comm⁄
, "both bandsáre disabled\n");

2468  -
EINVAL
;

2471 i‡(
	`AR_SREV_9485
(
ah
) ||

2472 
	`AR_SREV_9285
(
ah
) ||

2473 
	`AR_SREV_9330
(
ah
) ||

2474 
	`AR_SREV_9565
(
ah
))

2475 
pC≠
->
chù_chaömask
 = 1;

2476 i‡(!
	`AR_SREV_9280_20_OR_LATER
(
ah
))

2477 
pC≠
->
chù_chaömask
 = 7;

2478 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
) ||

2479 
	`AR_SREV_9340
(
ah
) ||

2480 
	`AR_SREV_9462
(
ah
) ||

2481 
	`AR_SREV_9531
(
ah
))

2482 
pC≠
->
chù_chaömask
 = 3;

2484 
pC≠
->
chù_chaömask
 = 7;

2486 
pC≠
->
tx_chaömask
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_TX_MASK
);

2491 i‡((
ah
->
hw_vîsi⁄
.
devid
 =
AR5416_DEVID_PCI
) &&

2492 !(
ìvÆ
 & 
AR5416_OPFLAGS_11A
) &&

2493 !(
	`AR_SREV_9271
(
ah
)))

2495 
pC≠
->
rx_chaömask
 = 
	`©h9k_hw_gpio_gë
(
ah
, 0) ? 0x5 : 0x7;

2496 i‡(
	`AR_SREV_9100
(
ah
))

2497 
pC≠
->
rx_chaömask
 = 0x7;

2500 
pC≠
->
rx_chaömask
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_RX_MASK
);

2502 
pC≠
->
tx_chaömask
 = 
	`fixup_chaömask
’C≠->
chù_chaömask
,ÖCap->tx_chainmask);

2503 
pC≠
->
rx_chaömask
 = 
	`fixup_chaömask
’C≠->
chù_chaömask
,ÖCap->rx_chainmask);

2504 
ah
->
txchaömask
 = 
pC≠
->
tx_chaömask
;

2505 
ah
->
rxchaömask
 = 
pC≠
->
rx_chaömask
;

2507 
ah
->
misc_mode
 |
AR_PCU_MIC_NEW_LOC_ENA
;

2510 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2511 
ah
->
misc_mode
 |
AR_PCU_ALWAYS_PERFORM_KEYSEARCH
;

2513 
comm⁄
->
¸y±_ˇps
 |
ATH_CRYPT_CAP_CIPHER_AESCCM
;

2515 i‡(
ah
->
hw_vîsi⁄
.
devid
 !
AR2427_DEVID_PCIE
)

2516 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_HT
;

2518 
pC≠
->
hw_ˇps
 &~
ATH9K_HW_CAP_HT
;

2520 i‡(
	`AR_SREV_9271
(
ah
))

2521 
pC≠
->
num_gpio_pös
 = 
AR9271_NUM_GPIO
;

2522 i‡(
	`AR_DEVID_7010
(
ah
))

2523 
pC≠
->
num_gpio_pös
 = 
AR7010_NUM_GPIO
;

2524 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2525 
pC≠
->
num_gpio_pös
 = 
AR9300_NUM_GPIO
;

2526 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
))

2527 
pC≠
->
num_gpio_pös
 = 
AR9287_NUM_GPIO
;

2528 i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
))

2529 
pC≠
->
num_gpio_pös
 = 
AR9285_NUM_GPIO
;

2530 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

2531 
pC≠
->
num_gpio_pös
 = 
AR928X_NUM_GPIO
;

2533 
pC≠
->
num_gpio_pös
 = 
AR_NUM_GPIO
;

2535 i‡(
	`AR_SREV_9160_10_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9100
(ah))

2536 
pC≠
->
πs_aggr_limô
 = 
ATH_AMPDU_LIMIT_MAX
;

2538 
pC≠
->
πs_aggr_limô
 = (8 * 1024);

2540 #ifde‡
CPTCFG_ATH9K_RFKILL


2541 
ah
->
rfsûít
 =áh->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_RF_SILENT
);

2542 i‡(
ah
->
rfsûít
 & 
EEP_RFSILENT_ENABLED
) {

2543 
ah
->
rfkûl_gpio
 =

2544 
	`MS
(
ah
->
rfsûít
, 
EEP_RFSILENT_GPIO_SEL
);

2545 
ah
->
rfkûl_pﬁ¨ôy
 =

2546 
	`MS
(
ah
->
rfsûít
, 
EEP_RFSILENT_POLARITY
);

2548 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_RFSILENT
;

2551 i‡(
	`AR_SREV_9271
(
ah
Ë|| 
	`AR_SREV_9300_20_OR_LATER
(ah))

2552 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_AUTOSLEEP
;

2554 
pC≠
->
hw_ˇps
 &~
ATH9K_HW_CAP_AUTOSLEEP
;

2556 i‡(
	`AR_SREV_9280
(
ah
Ë|| 
	`AR_SREV_9285
(ah))

2557 
pC≠
->
hw_ˇps
 &~
ATH9K_HW_CAP_4KB_SPLITTRANS
;

2559 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_4KB_SPLITTRANS
;

2561 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

2562 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_EDMA
 | 
ATH9K_HW_CAP_FASTCLOCK
;

2563 i‡(!
	`AR_SREV_9330
(
ah
Ë&& !
	`AR_SREV_9485
(ah) &&

2564 !
	`AR_SREV_9561
(
ah
Ë&& !
	`AR_SREV_9565
(ah))

2565 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_LDPC
;

2567 
pC≠
->
rx_hp_qdïth
 = 
ATH9K_HW_RX_HP_QDEPTH
;

2568 
pC≠
->
rx_Õ_qdïth
 = 
ATH9K_HW_RX_LP_QDEPTH
;

2569 
pC≠
->
rx_°©us_Àn
 = (
¨9003_rxs
);

2570 
pC≠
->
tx_desc_Àn
 = (
¨9003_txc
);

2571 
pC≠
->
txs_Àn
 = (
¨9003_txs
);

2573 
pC≠
->
tx_desc_Àn
 = (
©h_desc
);

2574 i‡(
	`AR_SREV_9280_20
(
ah
))

2575 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_FASTCLOCK
;

2578 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2579 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_RAC_SUPPORTED
;

2581 i‡(
	`AR_SREV_9561
(
ah
))

2582 
ah
->
ít_mode
 = 0x3BDA000;

2583 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2584 
ah
->
ít_mode
 = 
	`REG_READ
◊h, 
AR_ENT_OTP
);

2586 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9271
(ah))

2587 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_SGI_20
;

2589 i‡(
	`AR_SREV_9285
(
ah
)) {

2590 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_MODAL_VER
) >= 3) {

2591 
™t_div_˘l1
 =

2592 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_ANT_DIV_CTL1
);

2593 i‡((
™t_div_˘l1
 & 0x1) && ((ant_div_ctl1 >> 3) & 0x1)) {

2594 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_ANT_DIV_COMB
;

2595 
	`©h_öfo
(
comm⁄
, "Enable LNA combining\n");

2600 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

2601 i‡(
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_CHAIN_MASK_REDUCE
))

2602 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_APM
;

2605 i‡(
	`AR_SREV_9330
(
ah
Ë|| 
	`AR_SREV_9485
◊hË|| 
	`AR_SREV_9565
(ah)) {

2606 
™t_div_˘l1
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_ANT_DIV_CTL1
);

2607 i‡((
™t_div_˘l1
 >> 0x6) == 0x3) {

2608 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_ANT_DIV_COMB
;

2609 
	`©h_öfo
(
comm⁄
, "Enable LNA combining\n");

2613 i‡(
	`©h9k_hw_dfs_ã°ed
(
ah
))

2614 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_DFS
;

2616 
tx_chaömask
 = 
pC≠
->tx_chainmask;

2617 
rx_chaömask
 = 
pC≠
->rx_chainmask;

2618 
tx_chaömask
 || 
rx_chaömask
) {

2619 i‡(
tx_chaömask
 & 
	`BIT
(0))

2620 
pC≠
->
max_txchaös
++;

2621 i‡(
rx_chaömask
 & 
	`BIT
(0))

2622 
pC≠
->
max_rxchaös
++;

2624 
tx_chaömask
 >>= 1;

2625 
rx_chaömask
 >>= 1;

2628 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

2629 i‡(!(
ah
->
ít_mode
 & 
AR_ENT_OTP_49GHZ_DISABLE
))

2630 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_MCI
;

2632 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
))

2633 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_RTT
;

2636 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
) &&

2637 
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
EEP_PAPRD
))

2638 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_PAPRD
;

2640 #ifde‡
CPTCFG_ATH9K_WOW


2641 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9565_11_OR_LATER
(ah))

2642 
ah
->
wow
.
max_∑âîns
 = 
MAX_NUM_PATTERN
;

2644 
ah
->
wow
.
max_∑âîns
 = 
MAX_NUM_PATTERN_LEGACY
;

2648 
	}
}

2654 
	$©h9k_hw_gpio_cfg_ouçut_mux
(
©h_hw
 *
ah
,

2655 
u32
 
gpio
, u32 
ty≥
)

2657 
addr
;

2658 
u32
 
gpio_shi·
, 
tmp
;

2660 i‡(
gpio
 > 11)

2661 
addr
 = 
AR_GPIO_OUTPUT_MUX3
;

2662 i‡(
gpio
 > 5)

2663 
addr
 = 
AR_GPIO_OUTPUT_MUX2
;

2665 
addr
 = 
AR_GPIO_OUTPUT_MUX1
;

2667 
gpio_shi·
 = (
gpio
 % 6) * 5;

2669 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)

2670 || (
addr
 !
AR_GPIO_OUTPUT_MUX1
)) {

2671 
	`REG_RMW
(
ah
, 
addr
, (
ty≥
 << 
gpio_shi·
),

2672 (0x1‡<< 
gpio_shi·
));

2674 
tmp
 = 
	`REG_READ
(
ah
, 
addr
);

2675 
tmp
 = ((tmp & 0x1F0) << 1) | (tmp & ~0x1F0);

2676 
tmp
 &~(0x1‡<< 
gpio_shi·
);

2677 
tmp
 |(
ty≥
 << 
gpio_shi·
);

2678 
	`REG_WRITE
(
ah
, 
addr
, 
tmp
);

2680 
	}
}

2682 
	$©h9k_hw_cfg_gpio_öput
(
©h_hw
 *
ah
, 
u32
 
gpio
)

2684 
u32
 
gpio_shi·
;

2686 
	`BUG_ON
(
gpio
 >
ah
->
ˇps
.
num_gpio_pös
);

2688 i‡(
	`AR_DEVID_7010
(
ah
)) {

2689 
gpio_shi·
 = 
gpio
;

2690 
	`REG_RMW
(
ah
, 
AR7010_GPIO_OE
,

2691 (
AR7010_GPIO_OE_AS_INPUT
 << 
gpio_shi·
),

2692 (
AR7010_GPIO_OE_MASK
 << 
gpio_shi·
));

2696 
gpio_shi·
 = 
gpio
 << 1;

2697 
	`REG_RMW
(
ah
,

2698 
AR_GPIO_OE_OUT
,

2699 (
AR_GPIO_OE_OUT_DRV_NO
 << 
gpio_shi·
),

2700 (
AR_GPIO_OE_OUT_DRV
 << 
gpio_shi·
));

2701 
	}
}

2702 
EXPORT_SYMBOL
(
©h9k_hw_cfg_gpio_öput
);

2704 
u32
 
	$©h9k_hw_gpio_gë
(
©h_hw
 *
ah
, 
u32
 
gpio
)

2706 
	#MS_REG_READ
(
x
, 
y
) \

2707 (
	`MS
(
	`REG_READ
(
ah
, 
AR_GPIO_IN_OUT
), 
x
##
_GPIO_IN_VAL
Ë& (
	`AR_GPIO_BIT
(
y
)))

	)

2709 i‡(
gpio
 >
ah
->
ˇps
.
num_gpio_pös
)

2712 i‡(
	`AR_DEVID_7010
(
ah
)) {

2713 
u32
 
vÆ
;

2714 
vÆ
 = 
	`REG_READ
(
ah
, 
AR7010_GPIO_IN
);

2715  (
	`MS
(
vÆ
, 
AR7010_GPIO_IN_VAL
Ë& 
	`AR_GPIO_BIT
(
gpio
)) == 0;

2716 } i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2717  (
	`MS
(
	`REG_READ
(
ah
, 
AR_GPIO_IN
), 
AR9300_GPIO_IN_VAL
) &

2718 
	`AR_GPIO_BIT
(
gpio
)) != 0;

2719 i‡(
	`AR_SREV_9271
(
ah
))

2720  
	`MS_REG_READ
(
AR9271
, 
gpio
) != 0;

2721 i‡(
	`AR_SREV_9287_11_OR_LATER
(
ah
))

2722  
	`MS_REG_READ
(
AR9287
, 
gpio
) != 0;

2723 i‡(
	`AR_SREV_9285_12_OR_LATER
(
ah
))

2724  
	`MS_REG_READ
(
AR9285
, 
gpio
) != 0;

2725 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

2726  
	`MS_REG_READ
(
AR928X
, 
gpio
) != 0;

2728  
	`MS_REG_READ
(
AR
, 
gpio
) != 0;

2729 
	}
}

2730 
EXPORT_SYMBOL
(
©h9k_hw_gpio_gë
);

2732 
	$©h9k_hw_cfg_ouçut
(
©h_hw
 *
ah
, 
u32
 
gpio
,

2733 
u32
 
ah_sig«l_ty≥
)

2735 
u32
 
gpio_shi·
;

2737 i‡(
	`AR_DEVID_7010
(
ah
)) {

2738 
gpio_shi·
 = 
gpio
;

2739 
	`REG_RMW
(
ah
, 
AR7010_GPIO_OE
,

2740 (
AR7010_GPIO_OE_AS_OUTPUT
 << 
gpio_shi·
),

2741 (
AR7010_GPIO_OE_MASK
 << 
gpio_shi·
));

2745 
	`©h9k_hw_gpio_cfg_ouçut_mux
(
ah
, 
gpio
, 
ah_sig«l_ty≥
);

2746 
gpio_shi·
 = 2 * 
gpio
;

2747 
	`REG_RMW
(
ah
,

2748 
AR_GPIO_OE_OUT
,

2749 (
AR_GPIO_OE_OUT_DRV_ALL
 << 
gpio_shi·
),

2750 (
AR_GPIO_OE_OUT_DRV
 << 
gpio_shi·
));

2751 
	}
}

2752 
EXPORT_SYMBOL
(
©h9k_hw_cfg_ouçut
);

2754 
	$©h9k_hw_£t_gpio
(
©h_hw
 *
ah
, 
u32
 
gpio
, u32 
vÆ
)

2756 i‡(
	`AR_DEVID_7010
(
ah
)) {

2757 
vÆ
 = val ? 0 : 1;

2758 
	`REG_RMW
(
ah
, 
AR7010_GPIO_OUT
, ((
vÆ
&1Ë<< 
gpio
),

2759 
	`AR_GPIO_BIT
(
gpio
));

2763 i‡(
	`AR_SREV_9271
(
ah
))

2764 
vÆ
 = ~val;

2766 i‡((1 << 
gpio
Ë& 
AR_GPIO_OE_OUT_MASK
)

2767 
	`REG_RMW
(
ah
, 
AR_GPIO_IN_OUT
, ((
vÆ
 & 1Ë<< 
gpio
),

2768 
	`AR_GPIO_BIT
(
gpio
));

2770 
	`gpio_£t_vÆue
(
gpio
, 
vÆ
 & 1);

2771 
	}
}

2772 
EXPORT_SYMBOL
(
©h9k_hw_£t_gpio
);

2774 
	$©h9k_hw_ªque°_gpio
(
©h_hw
 *
ah
, 
u32
 
gpio
, c⁄° *
œbñ
)

2776 i‡(
gpio
 >
ah
->
ˇps
.
num_gpio_pös
)

2779 
	`gpio_ªque°_⁄e
(
gpio
, 
GPIOF_DIR_OUT
 | 
GPIOF_INIT_LOW
, 
œbñ
);

2780 
	}
}

2781 
EXPORT_SYMBOL
(
©h9k_hw_ªque°_gpio
);

2783 
	$©h9k_hw_£è¡í«
(
©h_hw
 *
ah
, 
u32
 
™ã¬a
)

2785 
	`REG_WRITE
(
ah
, 
AR_DEF_ANTENNA
, (
™ã¬a
 & 0x7));

2786 
	}
}

2787 
EXPORT_SYMBOL
(
©h9k_hw_£è¡í«
);

2793 
u32
 
	$©h9k_hw_gërxfûãr
(
©h_hw
 *
ah
)

2795 
u32
 
bôs
 = 
	`REG_READ
(
ah
, 
AR_RX_FILTER
);

2796 
u32
 
phybôs
 = 
	`REG_READ
(
ah
, 
AR_PHY_ERR
);

2798 i‡(
phybôs
 & 
AR_PHY_ERR_RADAR
)

2799 
bôs
 |
ATH9K_RX_FILTER_PHYRADAR
;

2800 i‡(
phybôs
 & (
AR_PHY_ERR_OFDM_TIMING
 | 
AR_PHY_ERR_CCK_TIMING
))

2801 
bôs
 |
ATH9K_RX_FILTER_PHYERR
;

2803  
bôs
;

2804 
	}
}

2805 
EXPORT_SYMBOL
(
©h9k_hw_gërxfûãr
);

2807 
	$©h9k_hw_£åxfûãr
(
©h_hw
 *
ah
, 
u32
 
bôs
)

2809 
u32
 
phybôs
;

2811 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

2813 
	`REG_WRITE
(
ah
, 
AR_RX_FILTER
, 
bôs
);

2815 
phybôs
 = 0;

2816 i‡(
bôs
 & 
ATH9K_RX_FILTER_PHYRADAR
)

2817 
phybôs
 |
AR_PHY_ERR_RADAR
;

2818 i‡(
bôs
 & 
ATH9K_RX_FILTER_PHYERR
)

2819 
phybôs
 |
AR_PHY_ERR_OFDM_TIMING
 | 
AR_PHY_ERR_CCK_TIMING
;

2820 
	`REG_WRITE
(
ah
, 
AR_PHY_ERR
, 
phybôs
);

2822 i‡(
phybôs
)

2823 
	`REG_SET_BIT
(
ah
, 
AR_RXCFG
, 
AR_RXCFG_ZLFDMA
);

2825 
	`REG_CLR_BIT
(
ah
, 
AR_RXCFG
, 
AR_RXCFG_ZLFDMA
);

2827 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

2828 
	}
}

2829 
EXPORT_SYMBOL
(
©h9k_hw_£åxfûãr
);

2831 
boﬁ
 
	$©h9k_hw_phy_dißbÀ
(
©h_hw
 *
ah
)

2833 i‡(
	`©h9k_hw_mci_is_íabÀd
(
ah
))

2834 
	`¨9003_mci_bt_gaö_˘æ
(
ah
);

2836 i‡(!
	`©h9k_hw_£t_ª£t_ªg
(
ah
, 
ATH9K_RESET_WARM
))

2837  
Ál£
;

2839 
	`©h9k_hw_öô_∂l
(
ah
, 
NULL
);

2840 
ah
->
htc_ª£t_öô
 = 
åue
;

2841  
åue
;

2842 
	}
}

2843 
EXPORT_SYMBOL
(
©h9k_hw_phy_dißbÀ
);

2845 
boﬁ
 
	$©h9k_hw_dißbÀ
(
©h_hw
 *
ah
)

2847 i‡(!
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_AWAKE
))

2848  
Ál£
;

2850 i‡(!
	`©h9k_hw_£t_ª£t_ªg
(
ah
, 
ATH9K_RESET_COLD
))

2851  
Ál£
;

2853 
	`©h9k_hw_öô_∂l
(
ah
, 
NULL
);

2854  
åue
;

2855 
	}
}

2856 
EXPORT_SYMBOL
(
©h9k_hw_dißbÀ
);

2858 
	$gë_™ã¬a_gaö
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

2860 
ì¥om_∑øm
 
gaö_∑øm
;

2862 i‡(
	`IS_CHAN_2GHZ
(
ch™
))

2863 
gaö_∑øm
 = 
EEP_ANTENNA_GAIN_2G
;

2865 
gaö_∑øm
 = 
EEP_ANTENNA_GAIN_5G
;

2867  
ah
->
ìp_›s
->
	`gë_ì¥om
◊h, 
gaö_∑øm
);

2868 
	}
}

2870 
	$©h9k_hw_≠∂y_txpowî
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

2871 
boﬁ
 
ã°
)

2873 
©h_ªguœt‹y
 *
ªg
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

2874 
õì80211_ch™√l
 *
ch™√l
;

2875 
ch™_pwr
, 
√w_pwr
, 
max_gaö
;

2876 
™t_gaö
, 
™t_ªdu˘i⁄
 = 0;

2878 i‡(!
ch™
)

2881 
ch™√l
 = 
ch™
->chan;

2882 
ch™_pwr
 = 
	`mö_t
(, 
ch™√l
->
max_powî
 * 2, 
MAX_RATE_POWER
);

2883 
√w_pwr
 = 
	`mö_t
(, 
ch™_pwr
, 
ªg
->
powî_limô
);

2884 
max_gaö
 = 
ch™_pwr
 - 
√w_pwr
 + 
ch™√l
->
max_™ã¬a_gaö
 * 2;

2886 
™t_gaö
 = 
	`gë_™ã¬a_gaö
(
ah
, 
ch™
);

2887 i‡(
™t_gaö
 > 
max_gaö
)

2888 
™t_ªdu˘i⁄
 = 
™t_gaö
 - 
max_gaö
;

2890 
ah
->
ìp_›s
->
	`£t_txpowî
◊h, 
ch™
,

2891 
	`©h9k_ªgd_gë_˘l
(
ªg
, 
ch™
),

2892 
™t_ªdu˘i⁄
, 
√w_pwr
, 
ã°
);

2893 
	}
}

2895 
	$©h9k_hw_£t_txpowîlimô
(
©h_hw
 *
ah
, 
u32
 
limô
, 
boﬁ
 
ã°
)

2897 
©h_ªguœt‹y
 *
ªg
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

2898 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

2899 
õì80211_ch™√l
 *
ch™√l
 = 
ch™
->chan;

2901 
ªg
->
powî_limô
 = 
	`mö_t
(
u32
, 
limô
, 
MAX_RATE_POWER
);

2902 i‡(
ã°
)

2903 
ch™√l
->
max_powî
 = 
MAX_RATE_POWER
 / 2;

2905 
	`©h9k_hw_≠∂y_txpowî
(
ah
, 
ch™
, 
ã°
);

2907 i‡(
ã°
)

2908 
ch™√l
->
max_powî
 = 
	`DIV_ROUND_UP
(
ªg
->
max_powî_Àvñ
, 2);

2909 
	}
}

2910 
EXPORT_SYMBOL
(
©h9k_hw_£t_txpowîlimô
);

2912 
	$©h9k_hw_£t›mode
(
©h_hw
 *
ah
)

2914 
	`©h9k_hw_£t_›î©ög_mode
(
ah
,áh->
›mode
);

2915 
	}
}

2916 
EXPORT_SYMBOL
(
©h9k_hw_£t›mode
);

2918 
	$©h9k_hw_£tmˇ°fûãr
(
©h_hw
 *
ah
, 
u32
 
fûãr0
, u32 
fûãr1
)

2920 
	`REG_WRITE
(
ah
, 
AR_MCAST_FIL0
, 
fûãr0
);

2921 
	`REG_WRITE
(
ah
, 
AR_MCAST_FIL1
, 
fûãr1
);

2922 
	}
}

2923 
EXPORT_SYMBOL
(
©h9k_hw_£tmˇ°fûãr
);

2925 
	$©h9k_hw_wrôe_associd
(
©h_hw
 *
ah
)

2927 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2929 
	`REG_WRITE
(
ah
, 
AR_BSS_ID0
, 
	`gë_u«lig√d_À32
(
comm⁄
->
curbssid
));

2930 
	`REG_WRITE
(
ah
, 
AR_BSS_ID1
, 
	`gë_u«lig√d_À16
(
comm⁄
->
curbssid
 + 4) |

2931 ((
comm⁄
->
cuøid
 & 0x3fffË<< 
AR_BSS_ID1_AID_S
));

2932 
	}
}

2933 
EXPORT_SYMBOL
(
©h9k_hw_wrôe_associd
);

2935 
	#ATH9K_MAX_TSF_READ
 10

	)

2937 
u64
 
	$©h9k_hw_gëtsf64
(
©h_hw
 *
ah
)

2939 
u32
 
tsf_lowî
, 
tsf_uµî1
, 
tsf_uµî2
;

2940 
i
;

2942 
tsf_uµî1
 = 
	`REG_READ
(
ah
, 
AR_TSF_U32
);

2943 
i
 = 0; i < 
ATH9K_MAX_TSF_READ
; i++) {

2944 
tsf_lowî
 = 
	`REG_READ
(
ah
, 
AR_TSF_L32
);

2945 
tsf_uµî2
 = 
	`REG_READ
(
ah
, 
AR_TSF_U32
);

2946 i‡(
tsf_uµî2
 =
tsf_uµî1
)

2948 
tsf_uµî1
 = 
tsf_uµî2
;

2951 
	`WARN_ON
–
i
 =
ATH9K_MAX_TSF_READ
 );

2953  (((
u64
)
tsf_uµî1
 << 32Ë| 
tsf_lowî
);

2954 
	}
}

2955 
EXPORT_SYMBOL
(
©h9k_hw_gëtsf64
);

2957 
	$©h9k_hw_£âsf64
(
©h_hw
 *
ah
, 
u64
 
tsf64
)

2959 
	`REG_WRITE
(
ah
, 
AR_TSF_L32
, 
tsf64
 & 0xffffffff);

2960 
	`REG_WRITE
(
ah
, 
AR_TSF_U32
, (
tsf64
 >> 32) & 0xffffffff);

2961 
	}
}

2962 
EXPORT_SYMBOL
(
©h9k_hw_£âsf64
);

2964 
	$©h9k_hw_ª£t_tsf
(
©h_hw
 *
ah
)

2966 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_SLP32_MODE
, 
AR_SLP32_TSF_WRITE_STATUS
, 0,

2967 
AH_TSF_WRITE_TIMEOUT
))

2968 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
RESET
,

2971 
	`REG_WRITE
(
ah
, 
AR_RESET_TSF
, 
AR_RESET_TSF_ONCE
);

2972 
	}
}

2973 
EXPORT_SYMBOL
(
©h9k_hw_ª£t_tsf
);

2975 
	$©h9k_hw_£t_tsÁdju°
(
©h_hw
 *
ah
, 
boﬁ
 
£t
)

2977 i‡(
£t
)

2978 
ah
->
misc_mode
 |
AR_PCU_TX_ADD_TSF
;

2980 
ah
->
misc_mode
 &~
AR_PCU_TX_ADD_TSF
;

2981 
	}
}

2982 
EXPORT_SYMBOL
(
©h9k_hw_£t_tsÁdju°
);

2984 
	$©h9k_hw_£t11nmac2040
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
)

2986 
u32
 
macmode
;

2988 i‡(
	`IS_CHAN_HT40
(
ch™
Ë&& !
ah
->
c⁄fig
.
cwm_ign‹e_extcˇ
)

2989 
macmode
 = 
AR_2040_JOINED_RX_CLEAR
;

2991 
macmode
 = 0;

2993 
	`REG_WRITE
(
ah
, 
AR_2040_MODE
, 
macmode
);

2994 
	}
}

2998 c⁄° 
©h_gí_timî_c⁄figuøti⁄
 
	ggí_tmr_c⁄figuøti⁄
[] =

3000 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3001 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3002 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3003 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3004 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3005 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3006 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3007 {
AR_NEXT_NDP_TIMER
, 
AR_NDP_PERIOD
, 
AR_TIMER_MODE
, 0x0080},

3008 {
AR_NEXT_NDP2_TIMER
, 
AR_NDP2_PERIOD
, 
AR_NDP2_TIMER_MODE
, 0x0001},

3009 {
AR_NEXT_NDP2_TIMER
 + 1*4, 
AR_NDP2_PERIOD
 + 1*4,

3010 
AR_NDP2_TIMER_MODE
, 0x0002},

3011 {
AR_NEXT_NDP2_TIMER
 + 2*4, 
AR_NDP2_PERIOD
 + 2*4,

3012 
AR_NDP2_TIMER_MODE
, 0x0004},

3013 {
AR_NEXT_NDP2_TIMER
 + 3*4, 
AR_NDP2_PERIOD
 + 3*4,

3014 
AR_NDP2_TIMER_MODE
, 0x0008},

3015 {
AR_NEXT_NDP2_TIMER
 + 4*4, 
AR_NDP2_PERIOD
 + 4*4,

3016 
AR_NDP2_TIMER_MODE
, 0x0010},

3017 {
AR_NEXT_NDP2_TIMER
 + 5*4, 
AR_NDP2_PERIOD
 + 5*4,

3018 
AR_NDP2_TIMER_MODE
, 0x0020},

3019 {
AR_NEXT_NDP2_TIMER
 + 6*4, 
AR_NDP2_PERIOD
 + 6*4,

3020 
AR_NDP2_TIMER_MODE
, 0x0040},

3021 {
AR_NEXT_NDP2_TIMER
 + 7*4, 
AR_NDP2_PERIOD
 + 7*4,

3022 
AR_NDP2_TIMER_MODE
, 0x0080}

3027 
u32
 
	$©h9k_hw_gëtsf32
(
©h_hw
 *
ah
)

3029  
	`REG_READ
(
ah
, 
AR_TSF_L32
);

3030 
	}
}

3031 
EXPORT_SYMBOL
(
©h9k_hw_gëtsf32
);

3033 
	$©h9k_hw_gí_timî_°¨t_tsf2
(
©h_hw
 *
ah
)

3035 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3037 i‡(
timî_èbÀ
->
tsf2_íabÀd
) {

3038 
	`REG_SET_BIT
(
ah
, 
AR_DIRECT_CONNECT
, 
AR_DC_AP_STA_EN
);

3039 
	`REG_SET_BIT
(
ah
, 
AR_RESET_TSF
, 
AR_RESET_TSF2_ONCE
);

3041 
	}
}

3043 
©h_gí_timî
 *
	$©h_gí_timî_Æloc
(
©h_hw
 *
ah
,

3044 (*
åiggî
)(*),

3045 (*
ovîÊow
)(*),

3046 *
¨g
,

3047 
u8
 
timî_ödex
)

3049 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3050 
©h_gí_timî
 *
timî
;

3052 i‡((
timî_ödex
 < 
AR_FIRST_NDP_TIMER
) ||

3053 (
timî_ödex
 >
ATH_MAX_GEN_TIMER
))

3054  
NULL
;

3056 i‡((
timî_ödex
 > 
AR_FIRST_NDP_TIMER
) &&

3057 !
	`AR_SREV_9300_20_OR_LATER
(
ah
))

3058  
NULL
;

3060 
timî
 = 
	`kzÆloc
((
©h_gí_timî
), 
GFP_KERNEL
);

3061 i‡(
timî
 =
NULL
)

3062  
NULL
;

3065 
timî_èbÀ
->
timîs
[
timî_ödex
] = 
timî
;

3066 
timî
->
ödex
 = 
timî_ödex
;

3067 
timî
->
åiggî
 =Årigger;

3068 
timî
->
ovîÊow
 = overflow;

3069 
timî
->
¨g
 =árg;

3071 i‡((
timî_ödex
 > 
AR_FIRST_NDP_TIMER
Ë&& !
timî_èbÀ
->
tsf2_íabÀd
) {

3072 
timî_èbÀ
->
tsf2_íabÀd
 = 
åue
;

3073 
	`©h9k_hw_gí_timî_°¨t_tsf2
(
ah
);

3076  
timî
;

3077 
	}
}

3078 
EXPORT_SYMBOL
(
©h_gí_timî_Æloc
);

3080 
	$©h9k_hw_gí_timî_°¨t
(
©h_hw
 *
ah
,

3081 
©h_gí_timî
 *
timî
,

3082 
u32
 
timî_√xt
,

3083 
u32
 
timî_≥riod
)

3085 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3086 
u32
 
mask
 = 0;

3088 
timî_èbÀ
->
timî_mask
 |
	`BIT
(
timî
->
ödex
);

3093 
	`REG_WRITE
(
ah
, 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
√xt_addr
,

3094 
timî_√xt
);

3095 
	`REG_WRITE
(
ah
, 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
≥riod_addr
,

3096 
timî_≥riod
);

3097 
	`REG_SET_BIT
(
ah
, 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
mode_addr
,

3098 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
mode_mask
);

3100 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

3106 i‡((
timî
->
ödex
 < 
AR_GEN_TIMER_BANK_1_LEN
))

3107 
	`REG_CLR_BIT
(
ah
, 
AR_MAC_PCU_GEN_TIMER_TSF_SEL
,

3108 (1 << 
timî
->
ödex
));

3110 
	`REG_SET_BIT
(
ah
, 
AR_MAC_PCU_GEN_TIMER_TSF_SEL
,

3111 (1 << 
timî
->
ödex
));

3114 i‡(
timî
->
åiggî
)

3115 
mask
 |
	`SM
(
	`AR_GENTMR_BIT
(
timî
->
ödex
),

3116 
AR_IMR_S5_GENTIMER_TRIG
);

3117 i‡(
timî
->
ovîÊow
)

3118 
mask
 |
	`SM
(
	`AR_GENTMR_BIT
(
timî
->
ödex
),

3119 
AR_IMR_S5_GENTIMER_THRESH
);

3121 
	`REG_SET_BIT
(
ah
, 
AR_IMR_S5
, 
mask
);

3123 i‡((
ah
->
imask
 & 
ATH9K_INT_GENTIMER
) == 0) {

3124 
ah
->
imask
 |
ATH9K_INT_GENTIMER
;

3125 
	`©h9k_hw_£t_öãºu±s
(
ah
);

3127 
	}
}

3128 
EXPORT_SYMBOL
(
©h9k_hw_gí_timî_°¨t
);

3130 
	$©h9k_hw_gí_timî_°›
(
©h_hw
 *
ah
, 
©h_gí_timî
 *
timî
)

3132 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3135 
	`REG_CLR_BIT
(
ah
, 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
mode_addr
,

3136 
gí_tmr_c⁄figuøti⁄
[
timî
->
ödex
].
mode_mask
);

3138 i‡(
	`AR_SREV_9462
(
ah
Ë|| 
	`AR_SREV_9565
(ah)) {

3142 i‡((
timî
->
ödex
 >
AR_GEN_TIMER_BANK_1_LEN
)) {

3143 
	`REG_CLR_BIT
(
ah
, 
AR_MAC_PCU_GEN_TIMER_TSF_SEL
,

3144 (1 << 
timî
->
ödex
));

3149 
	`REG_CLR_BIT
(
ah
, 
AR_IMR_S5
,

3150 (
	`SM
(
	`AR_GENTMR_BIT
(
timî
->
ödex
), 
AR_IMR_S5_GENTIMER_THRESH
) |

3151 
	`SM
(
	`AR_GENTMR_BIT
(
timî
->
ödex
), 
AR_IMR_S5_GENTIMER_TRIG
)));

3153 
timî_èbÀ
->
timî_mask
 &~
	`BIT
(
timî
->
ödex
);

3155 i‡(
timî_èbÀ
->
timî_mask
 == 0) {

3156 
ah
->
imask
 &~
ATH9K_INT_GENTIMER
;

3157 
	`©h9k_hw_£t_öãºu±s
(
ah
);

3159 
	}
}

3160 
EXPORT_SYMBOL
(
©h9k_hw_gí_timî_°›
);

3162 
	$©h_gí_timî_‰ì
(
©h_hw
 *
ah
, 
©h_gí_timî
 *
timî
)

3164 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3167 
timî_èbÀ
->
timîs
[
timî
->
ödex
] = 
NULL
;

3168 
	`k‰ì
(
timî
);

3169 
	}
}

3170 
EXPORT_SYMBOL
(
©h_gí_timî_‰ì
);

3175 
	$©h_gí_timî_i§
(
©h_hw
 *
ah
)

3177 
©h_gí_timî_èbÀ
 *
timî_èbÀ
 = &
ah
->
hw_gí_timîs
;

3178 
©h_gí_timî
 *
timî
;

3179 
åiggî_mask
, 
thªsh_mask
;

3180 
ödex
;

3183 
åiggî_mask
 = 
ah
->
öå_gí_timî_åiggî
;

3184 
thªsh_mask
 = 
ah
->
öå_gí_timî_thªsh
;

3185 
åiggî_mask
 &
timî_èbÀ
->
timî_mask
;

3186 
thªsh_mask
 &
timî_èbÀ
->
timî_mask
;

3188 
	`f‹_óch_£t_bô
(
ödex
, &
thªsh_mask
, 
	`ARRAY_SIZE
(
timî_èbÀ
->
timîs
)) {

3189 
timî
 = 
timî_èbÀ
->
timîs
[
ödex
];

3190 i‡(!
timî
)

3192 i‡(!
timî
->
ovîÊow
)

3195 
åiggî_mask
 &~
	`BIT
(
ödex
);

3196 
timî
->
	`ovîÊow
—imî->
¨g
);

3199 
	`f‹_óch_£t_bô
(
ödex
, &
åiggî_mask
, 
	`ARRAY_SIZE
(
timî_èbÀ
->
timîs
)) {

3200 
timî
 = 
timî_èbÀ
->
timîs
[
ödex
];

3201 i‡(!
timî
)

3203 i‡(!
timî
->
åiggî
)

3205 
timî
->
	`åiggî
—imî->
¨g
);

3207 
	}
}

3208 
EXPORT_SYMBOL
(
©h_gí_timî_i§
);

3215 
u32
 
	mvîsi⁄
;

3216 c⁄° * 
	m«me
;

3217 } 
	g©h_mac_bb_«mes
[] = {

3219 { 
AR_SREV_VERSION_5416_PCI
, "5416" },

3220 { 
AR_SREV_VERSION_5416_PCIE
, "5418" },

3221 { 
AR_SREV_VERSION_9100
, "9100" },

3222 { 
AR_SREV_VERSION_9160
, "9160" },

3224 { 
AR_SREV_VERSION_9280
, "9280" },

3225 { 
AR_SREV_VERSION_9285
, "9285" },

3226 { 
AR_SREV_VERSION_9287
, "9287" },

3227 { 
AR_SREV_VERSION_9271
, "9271" },

3228 { 
AR_SREV_VERSION_9300
, "9300" },

3229 { 
AR_SREV_VERSION_9330
, "9330" },

3230 { 
AR_SREV_VERSION_9340
, "9340" },

3231 { 
AR_SREV_VERSION_9485
, "9485" },

3232 { 
AR_SREV_VERSION_9462
, "9462" },

3233 { 
AR_SREV_VERSION_9550
, "9550" },

3234 { 
AR_SREV_VERSION_9565
, "9565" },

3235 { 
AR_SREV_VERSION_9531
, "9531" },

3236 { 
AR_SREV_VERSION_9561
, "9561" },

3241 
u16
 
	mvîsi⁄
;

3242 c⁄° * 
	m«me
;

3243 } 
	g©h_rf_«mes
[] = {

3245 { 
AR_RAD5133_SREV_MAJOR
, "5133" },

3246 { 
AR_RAD5122_SREV_MAJOR
, "5122" },

3247 { 
AR_RAD2133_SREV_MAJOR
, "2133" },

3248 { 
AR_RAD2122_SREV_MAJOR
, "2122" }

3254 c⁄° *
	$©h9k_hw_mac_bb_«me
(
u32
 
mac_bb_vîsi⁄
)

3256 
i
;

3258 
i
=0; i<
	`ARRAY_SIZE
(
©h_mac_bb_«mes
); i++) {

3259 i‡(
©h_mac_bb_«mes
[
i
].
vîsi⁄
 =
mac_bb_vîsi⁄
) {

3260  
©h_mac_bb_«mes
[
i
].
«me
;

3265 
	}
}

3271 c⁄° *
	$©h9k_hw_rf_«me
(
u16
 
rf_vîsi⁄
)

3273 
i
;

3275 
i
=0; i<
	`ARRAY_SIZE
(
©h_rf_«mes
); i++) {

3276 i‡(
©h_rf_«mes
[
i
].
vîsi⁄
 =
rf_vîsi⁄
) {

3277  
©h_rf_«mes
[
i
].
«me
;

3282 
	}
}

3284 
	$©h9k_hw_«me
(
©h_hw
 *
ah
, *
hw_«me
, 
size_t
 
Àn
)

3286 
u£d
;

3289 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

3290 
u£d
 = 
	`s˙¥ötf
(
hw_«me
, 
Àn
,

3292 
	`©h9k_hw_mac_bb_«me
(
ah
->
hw_vîsi⁄
.
macVîsi⁄
),

3293 
ah
->
hw_vîsi⁄
.
macRev
);

3296 
u£d
 = 
	`s˙¥ötf
(
hw_«me
, 
Àn
,

3298 
	`©h9k_hw_mac_bb_«me
(
ah
->
hw_vîsi⁄
.
macVîsi⁄
),

3299 
ah
->
hw_vîsi⁄
.
macRev
,

3300 
	`©h9k_hw_rf_«me
((
ah
->
hw_vîsi⁄
.
™Æog5GhzRev


3301 & 
AR_RADIO_SREV_MAJOR
)),

3302 
ah
->
hw_vîsi⁄
.
phyRev
);

3305 
hw_«me
[
u£d
] = '\0';

3306 
	}
}

3307 
EXPORT_SYMBOL
(
©h9k_hw_«me
);

	@hw.h

17 #i‚de‡
HW_H


18 
	#HW_H


	)

20 
	~<löux/if_ëhî.h
>

21 
	~<löux/dñay.h
>

22 
	~<löux/io.h
>

23 
	~<löux/fúmw¨e.h
>

25 
	~"mac.h
"

26 
	~"™i.h
"

27 
	~"ì¥om.h
"

28 
	~"ˇlib.h
"

29 
	~"ªg.h
"

30 
	~"ªg_mci.h
"

31 
	~"phy.h
"

32 
	~"btc€x.h
"

33 
	~"dy«ck.h
"

35 
	~"../ªgd.h
"

37 
	#ATHEROS_VENDOR_ID
 0x168c

	)

39 
	#AR9300_DEVID_INVALID
 0xabcd

	)

40 
	#AR5416_DEVID_PCI
 0x0023

	)

41 
	#AR5416_DEVID_PCIE
 0x0024

	)

42 
	#AR9160_DEVID_PCI
 0x0027

	)

43 
	#AR9280_DEVID_PCI
 0x0029

	)

44 
	#AR9280_DEVID_PCIE
 0x002a

	)

45 
	#AR9285_DEVID_PCIE
 0x002b

	)

46 
	#AR2427_DEVID_PCIE
 0x002c

	)

47 
	#AR9287_DEVID_PCI
 0x002d

	)

48 
	#AR9287_DEVID_PCIE
 0x002e

	)

49 
	#AR9300_DEVID_PCIE
 0x0030

	)

50 
	#AR9300_DEVID_AR9340
 0x0031

	)

51 
	#AR9300_DEVID_AR9485_PCIE
 0x0032

	)

52 
	#AR9300_DEVID_AR9580
 0x0033

	)

53 
	#AR9300_DEVID_AR9462
 0x0034

	)

54 
	#AR9300_DEVID_AR9330
 0x0035

	)

55 
	#AR9300_DEVID_QCA955X
 0x0038

	)

56 
	#AR9485_DEVID_AR1111
 0x0037

	)

57 
	#AR9300_DEVID_AR9565
 0x0036

	)

58 
	#AR9300_DEVID_AR953X
 0x003d

	)

59 
	#AR9300_DEVID_QCA956X
 0x003f

	)

61 
	#AR5416_AR9100_DEVID
 0x000b

	)

63 
	#AR_SUBVENDOR_ID_NOG
 0x0e11

	)

64 
	#AR_SUBVENDOR_ID_NEW_A
 0x7065

	)

65 
	#AR5416_MAGIC
 0x19641014

	)

67 
	#AR9280_COEX2WIRE_SUBSYSID
 0x309b

	)

68 
	#AT9285_COEX3WIRE_SA_SUBSYSID
 0x30Ø

	)

69 
	#AT9285_COEX3WIRE_DA_SUBSYSID
 0x30ab

	)

71 
	#ATH_AMPDU_LIMIT_MAX
 (64 * 1024 - 1)

	)

73 
	#ATH_DEFAULT_NOISE_FLOOR
 -95

	)

75 
	#ATH9K_RSSI_BAD
 -128

	)

77 
	#ATH9K_NUM_CHANNELS
 38

	)

80 
	#REG_WRITE
(
_ah
, 
_ªg
, 
_vÆ
) \

81 (
_ah
)->
ªg_›s
.
	`wrôe
((_ah), (
_vÆ
), (
_ªg
))

	)

83 
	#REG_READ
(
_ah
, 
_ªg
) \

84 (
_ah
)->
ªg_›s
.
	`ªad
((_ah), (
_ªg
))

	)

86 
	#REG_READ_MULTI
(
_ah
, 
_addr
, 
_vÆ
, 
_˙t
) \

87 (
_ah
)->
ªg_›s
.
	`mu…i_ªad
((_ah), (
_addr
), (
_vÆ
), (
_˙t
))

	)

89 
	#REG_RMW
(
_ah
, 
_ªg
, 
_£t
, 
_˛r
) \

90 (
_ah
)->
ªg_›s
.
	`rmw
((_ah), (
_ªg
), (
_£t
), (
_˛r
))

	)

92 
	#ENABLE_REGWRITE_BUFFER
(
_ah
) \

94 i‡((
_ah
)->
ªg_›s
.
íabÀ_wrôe_buf„r
) \

95 (
_ah
)->
ªg_›s
.
	`íabÀ_wrôe_buf„r
((_ah)); \

96 } 0)

	)

98 
	#REGWRITE_BUFFER_FLUSH
(
_ah
) \

100 i‡((
_ah
)->
ªg_›s
.
wrôe_Êush
) \

101 (
_ah
)->
ªg_›s
.
	`wrôe_Êush
((_ah)); \

102 } 0)

	)

104 
	#ENABLE_REG_RMW_BUFFER
(
_ah
) \

106 i‡((
_ah
)->
ªg_›s
.
íabÀ_rmw_buf„r
) \

107 (
_ah
)->
ªg_›s
.
	`íabÀ_rmw_buf„r
((_ah)); \

108 } 0)

	)

110 
	#REG_RMW_BUFFER_FLUSH
(
_ah
) \

112 i‡((
_ah
)->
ªg_›s
.
rmw_Êush
) \

113 (
_ah
)->
ªg_›s
.
	`rmw_Êush
((_ah)); \

114 } 0)

	)

116 
	#PR_EEP
(
_s
, 
_vÆ
) \

118 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
size
 -Üen, "%20s : %10d\n",\

119 
_s
, (
_vÆ
)); \

120 } 0)

	)

122 
	#SM
(
_v
, 
_f
Ë(((_vË<< _f##
_S
Ë& _f)

	)

123 
	#MS
(
_v
, 
_f
Ë(((_vË& _fË>> _f##
_S
)

	)

124 
	#REG_RMW_FIELD
(
_a
, 
_r
, 
_f
, 
_v
) \

125 
	`REG_RMW
(
_a
, 
_r
, (((
_v
Ë<< 
_f
##
_S
Ë& _f), (_f))

	)

126 
	#REG_READ_FIELD
(
_a
, 
_r
, 
_f
) \

127 (((
	`REG_READ
(
_a
, 
_r
Ë& 
_f
Ë>> _f##
_S
))

	)

128 
	#REG_SET_BIT
(
_a
, 
_r
, 
_f
) \

129 
	`REG_RMW
(
_a
, 
_r
, (
_f
), 0)

	)

130 
	#REG_CLR_BIT
(
_a
, 
_r
, 
_f
) \

131 
	`REG_RMW
(
_a
, 
_r
, 0, (
_f
))

	)

133 
	#DO_DELAY
(
x
) do { \

134 i‡(((++(
x
) % 64) == 0) && \

135 (
	`©h9k_hw_comm⁄
(
ah
)->
bus_›s
->
©h_bus_ty≥
 \

136 !
ATH_USB
)) \

137 
	`udñay
(1); \

138 } 0)

	)

140 
	#REG_WRITE_ARRAY
(
öüºay
, 
cﬁumn
, 
ªgWr
) \

141 
	`©h9k_hw_wrôe_¨øy
(
ah
, 
öüºay
, 
cﬁumn
, &(
ªgWr
))

	)

142 
	#REG_READ_ARRAY
(
ah
, 
¨øy
, 
size
) \

143 
	`©h9k_hw_ªad_¨øy
(
ah
, 
¨øy
, 
size
)

	)

145 
	#AR_GPIO_OUTPUT_MUX_AS_OUTPUT
 0

	)

146 
	#AR_GPIO_OUTPUT_MUX_AS_PCIE_ATTENTION_LED
 1

	)

147 
	#AR_GPIO_OUTPUT_MUX_AS_PCIE_POWER_LED
 2

	)

148 
	#AR_GPIO_OUTPUT_MUX_AS_TX_FRAME
 3

	)

149 
	#AR_GPIO_OUTPUT_MUX_AS_RX_CLEAR_EXTERNAL
 4

	)

150 
	#AR_GPIO_OUTPUT_MUX_AS_MAC_NETWORK_LED
 5

	)

151 
	#AR_GPIO_OUTPUT_MUX_AS_MAC_POWER_LED
 6

	)

152 
	#AR_GPIO_OUTPUT_MUX_AS_MCI_WLAN_DATA
 0x16

	)

153 
	#AR_GPIO_OUTPUT_MUX_AS_MCI_WLAN_CLK
 0x17

	)

154 
	#AR_GPIO_OUTPUT_MUX_AS_MCI_BT_DATA
 0x18

	)

155 
	#AR_GPIO_OUTPUT_MUX_AS_MCI_BT_CLK
 0x19

	)

156 
	#AR_GPIO_OUTPUT_MUX_AS_WL_IN_TX
 0x14

	)

157 
	#AR_GPIO_OUTPUT_MUX_AS_WL_IN_RX
 0x13

	)

158 
	#AR_GPIO_OUTPUT_MUX_AS_BT_IN_TX
 9

	)

159 
	#AR_GPIO_OUTPUT_MUX_AS_BT_IN_RX
 8

	)

160 
	#AR_GPIO_OUTPUT_MUX_AS_RUCKUS_STROBE
 0x1d

	)

161 
	#AR_GPIO_OUTPUT_MUX_AS_RUCKUS_DATA
 0x1e

	)

163 
	#AR_GPIOD_MASK
 0x00001FFF

	)

164 
	#AR_GPIO_BIT
(
_gpio
Ë(1 << (_gpio))

	)

166 
	#BASE_ACTIVATE_DELAY
 100

	)

167 
	#RTC_PLL_SETTLE_DELAY
 (
	`AR_SREV_9340
(
ah
Ë? 1000 : 100)

	)

168 
	#COEF_SCALE_S
 24

	)

169 
	#HT40_CHANNEL_CENTER_SHIFT
 10

	)

171 
	#ATH9K_ANTENNA0_CHAINMASK
 0x1

	)

172 
	#ATH9K_ANTENNA1_CHAINMASK
 0x2

	)

174 
	#ATH9K_NUM_DMA_DEBUG_REGS
 8

	)

175 
	#ATH9K_NUM_QUEUES
 10

	)

177 
	#MAX_RATE_POWER
 63

	)

178 
	#AH_WAIT_TIMEOUT
 100000

	)

179 
	#AH_TSF_WRITE_TIMEOUT
 100

	)

180 
	#AH_TIME_QUANTUM
 10

	)

181 
	#AR_KEYTABLE_SIZE
 128

	)

182 
	#POWER_UP_TIME
 10000

	)

183 
	#SPUR_RSSI_THRESH
 40

	)

184 
	#UPPER_5G_SUB_BAND_START
 5700

	)

185 
	#MID_5G_SUB_BAND_START
 5400

	)

187 
	#CAB_TIMEOUT_VAL
 10

	)

188 
	#BEACON_TIMEOUT_VAL
 10

	)

189 
	#MIN_BEACON_TIMEOUT_VAL
 1

	)

190 
	#SLEEP_SLOP
 
	`TU_TO_USEC
(3)

	)

192 
	#INIT_CONFIG_STATUS
 0x00000000

	)

193 
	#INIT_RSSI_THR
 0x00000700

	)

194 
	#INIT_BCON_CNTRL_REG
 0x00000000

	)

196 
	#TU_TO_USEC
(
_tu
Ë((_tuË<< 10)

	)

198 
	#ATH9K_HW_RX_HP_QDEPTH
 16

	)

199 
	#ATH9K_HW_RX_LP_QDEPTH
 128

	)

201 
	#PAPRD_GAIN_TABLE_ENTRIES
 32

	)

202 
	#PAPRD_TABLE_SZ
 24

	)

203 
	#PAPRD_IDEAL_AGC2_PWR_RANGE
 0xe0

	)

210 
	#KAL_FRAME_LEN
 28

	)

211 
	#KAL_FRAME_TYPE
 0x2

	)

212 
	#KAL_FRAME_SUB_TYPE
 0x4

	)

213 
	#KAL_DURATION_ID
 0x3d

	)

214 
	#KAL_NUM_DATA_WORDS
 6

	)

215 
	#KAL_NUM_DESC_WORDS
 12

	)

216 
	#KAL_ANTENNA_MODE
 1

	)

217 
	#KAL_TO_DS
 1

	)

218 
	#KAL_DELAY
 4

	)

219 
	#KAL_TIMEOUT
 900

	)

221 
	#MAX_PATTERN_SIZE
 256

	)

222 
	#MAX_PATTERN_MASK_SIZE
 32

	)

223 
	#MAX_NUM_PATTERN
 16

	)

224 
	#MAX_NUM_PATTERN_LEGACY
 8

	)

225 
	#MAX_NUM_USER_PATTERN
 6

	)

232 
	#AH_WOW_USER_PATTERN_EN
 
	`BIT
(0)

	)

233 
	#AH_WOW_MAGIC_PATTERN_EN
 
	`BIT
(1)

	)

234 
	#AH_WOW_LINK_CHANGE
 
	`BIT
(2)

	)

235 
	#AH_WOW_BEACON_MISS
 
	`BIT
(3)

	)

237 
	e©h_hw_txq_subty≥
 {

238 
	mATH_TXQ_AC_BK
 = 0,

239 
	mATH_TXQ_AC_BE
 = 1,

240 
	mATH_TXQ_AC_VI
 = 2,

241 
	mATH_TXQ_AC_VO
 = 3,

244 
	e©h_öi_subsys
 {

245 
	mATH_INI_PRE
 = 0,

246 
	mATH_INI_CORE
,

247 
	mATH_INI_POST
,

248 
	mATH_INI_NUM_SPLIT
,

251 
	e©h9k_hw_ˇps
 {

252 
	mATH9K_HW_CAP_HT
 = 
BIT
(0),

253 
	mATH9K_HW_CAP_RFSILENT
 = 
BIT
(1),

254 
	mATH9K_HW_CAP_AUTOSLEEP
 = 
BIT
(2),

255 
	mATH9K_HW_CAP_4KB_SPLITTRANS
 = 
BIT
(3),

256 
	mATH9K_HW_CAP_EDMA
 = 
BIT
(4),

257 
	mATH9K_HW_CAP_RAC_SUPPORTED
 = 
BIT
(5),

258 
	mATH9K_HW_CAP_LDPC
 = 
BIT
(6),

259 
	mATH9K_HW_CAP_FASTCLOCK
 = 
BIT
(7),

260 
	mATH9K_HW_CAP_SGI_20
 = 
BIT
(8),

261 
	mATH9K_HW_CAP_ANT_DIV_COMB
 = 
BIT
(10),

262 
	mATH9K_HW_CAP_2GHZ
 = 
BIT
(11),

263 
	mATH9K_HW_CAP_5GHZ
 = 
BIT
(12),

264 
	mATH9K_HW_CAP_APM
 = 
BIT
(13),

265 #ifde‡
CPTCFG_ATH9K_PCOEM


266 
	mATH9K_HW_CAP_RTT
 = 
BIT
(14),

267 
	mATH9K_HW_CAP_MCI
 = 
BIT
(15),

268 
	mATH9K_HW_CAP_BT_ANT_DIV
 = 
BIT
(17),

270 
	mATH9K_HW_CAP_RTT
 = 0,

271 
	mATH9K_HW_CAP_MCI
 = 0,

272 
	mATH9K_HW_CAP_BT_ANT_DIV
 = 0,

274 
	mATH9K_HW_CAP_DFS
 = 
BIT
(18),

275 
	mATH9K_HW_CAP_PAPRD
 = 
BIT
(19),

276 
	mATH9K_HW_CAP_FCC_BAND_SWITCH
 = 
BIT
(20),

290 
	s©h9k_hw_wow
 {

291 
u32
 
	mwow_evít_mask
;

292 
u32
 
	mwow_evít_mask2
;

293 
u8
 
	mmax_∑âîns
;

296 
	s©h9k_hw_ˇ∑bûôõs
 {

297 
u32
 
	mhw_ˇps
;

298 
u16
 
	mπs_aggr_limô
;

299 
u8
 
	mtx_chaömask
;

300 
u8
 
	mrx_chaömask
;

301 
u8
 
	mchù_chaömask
;

302 
u8
 
	mmax_txchaös
;

303 
u8
 
	mmax_rxchaös
;

304 
u8
 
	mnum_gpio_pös
;

305 
u8
 
	mrx_hp_qdïth
;

306 
u8
 
	mrx_Õ_qdïth
;

307 
u8
 
	mrx_°©us_Àn
;

308 
u8
 
	mtx_desc_Àn
;

309 
u8
 
	mtxs_Àn
;

312 
	#AR_NO_SPUR
 0x8000

	)

313 
	#AR_BASE_FREQ_2GHZ
 2300

	)

314 
	#AR_BASE_FREQ_5GHZ
 4900

	)

315 
	#AR_SPUR_FEEQ_BOUND_HT40
 19

	)

316 
	#AR_SPUR_FEEQ_BOUND_HT20
 10

	)

318 
	e©h9k_hw_h™g_checks
 {

319 
	mHW_BB_WATCHDOG
 = 
BIT
(0),

320 
	mHW_PHYRESTART_CLC_WAR
 = 
BIT
(1),

321 
	mHW_BB_RIFS_HANG
 = 
BIT
(2),

322 
	mHW_BB_DFS_HANG
 = 
BIT
(3),

323 
	mHW_BB_RX_CLEAR_STUCK_HANG
 = 
BIT
(4),

324 
	mHW_MAC_HANG
 = 
BIT
(5),

327 
	#AR_PCIE_PLL_PWRSAVE_CONTROL
 
	`BIT
(0)

	)

328 
	#AR_PCIE_PLL_PWRSAVE_ON_D3
 
	`BIT
(1)

	)

329 
	#AR_PCIE_PLL_PWRSAVE_ON_D0
 
	`BIT
(2)

	)

330 
	#AR_PCIE_CDR_PWRSAVE_ON_D3
 
	`BIT
(3)

	)

331 
	#AR_PCIE_CDR_PWRSAVE_ON_D0
 
	`BIT
(4)

	)

333 
	s©h9k_›s_c⁄fig
 {

334 
	mdma_bóc⁄_ª•⁄£_time
;

335 
	msw_bóc⁄_ª•⁄£_time
;

336 
boﬁ
 
	mcwm_ign‹e_extcˇ
;

337 
u32
 
	mpcõ_w´n
;

338 
u8
 
	m™Æog_shi·ªg
;

339 
u32
 
	mofdm_åig_low
;

340 
u32
 
	mofdm_åig_high
;

341 
u32
 
	mcck_åig_high
;

342 
u32
 
	mcck_åig_low
;

343 
boﬁ
 
	míabÀ_∑¥d
;

344 
	m£rülize_ªgmode
;

345 
boﬁ
 
	mrx_öå_môig©i⁄
;

346 
boﬁ
 
	mtx_öå_môig©i⁄
;

347 
u8
 
	mmax_txåig_Àvñ
;

348 
u16
 
	m™i_pﬁl_öãrvÆ
;

349 
u16
 
	mhw_h™g_checks
;

350 
u16
 
	mrimt_fú°
;

351 
u16
 
	mrimt_œ°
;

354 
u32
 
	ma•m_l1_fix
;

355 
u32
 
	mx a_gpio
;

356 
u32
 
	m™t_˘æ_comm2g_swôch_íabÀ
;

357 
boﬁ
 
	mx©ãn_m¨gö_cfg
;

358 
boﬁ
 
	mÆt_mögaöidx
;

359 
u8
 
	m∂l_pwrßve
;

360 
boﬁ
 
	mtx_gaö_bufÁlo
;

361 
boﬁ
 
	mÀd_a˘ive_high
;

364 
	e©h9k_öt
 {

365 
	mATH9K_INT_RX
 = 0x00000001,

366 
	mATH9K_INT_RXDESC
 = 0x00000002,

367 
	mATH9K_INT_RXHP
 = 0x00000001,

368 
	mATH9K_INT_RXLP
 = 0x00000002,

369 
	mATH9K_INT_RXNOFRM
 = 0x00000008,

370 
	mATH9K_INT_RXEOL
 = 0x00000010,

371 
	mATH9K_INT_RXORN
 = 0x00000020,

372 
	mATH9K_INT_TX
 = 0x00000040,

373 
	mATH9K_INT_TXDESC
 = 0x00000080,

374 
	mATH9K_INT_TIM_TIMER
 = 0x00000100,

375 
	mATH9K_INT_MCI
 = 0x00000200,

376 
	mATH9K_INT_BB_WATCHDOG
 = 0x00000400,

377 
	mATH9K_INT_TXURN
 = 0x00000800,

378 
	mATH9K_INT_MIB
 = 0x00001000,

379 
	mATH9K_INT_RXPHY
 = 0x00004000,

380 
	mATH9K_INT_RXKCM
 = 0x00008000,

381 
	mATH9K_INT_SWBA
 = 0x00010000,

382 
	mATH9K_INT_BMISS
 = 0x00040000,

383 
	mATH9K_INT_BNR
 = 0x00100000,

384 
	mATH9K_INT_TIM
 = 0x00200000,

385 
	mATH9K_INT_DTIM
 = 0x00400000,

386 
	mATH9K_INT_DTIMSYNC
 = 0x00800000,

387 
	mATH9K_INT_GPIO
 = 0x01000000,

388 
	mATH9K_INT_CABEND
 = 0x02000000,

389 
	mATH9K_INT_TSFOOR
 = 0x04000000,

390 
	mATH9K_INT_GENTIMER
 = 0x08000000,

391 
	mATH9K_INT_CST
 = 0x10000000,

392 
	mATH9K_INT_GTT
 = 0x20000000,

393 
	mATH9K_INT_FATAL
 = 0x40000000,

394 
	mATH9K_INT_GLOBAL
 = 0x80000000,

395 
	mATH9K_INT_BMISC
 = 
ATH9K_INT_TIM
 |

396 
ATH9K_INT_DTIM
 |

397 
ATH9K_INT_DTIMSYNC
 |

398 
ATH9K_INT_TSFOOR
 |

399 
ATH9K_INT_CABEND
,

400 
	mATH9K_INT_COMMON
 = 
ATH9K_INT_RXNOFRM
 |

401 
ATH9K_INT_RXDESC
 |

402 
ATH9K_INT_RXEOL
 |

403 
ATH9K_INT_RXORN
 |

404 
ATH9K_INT_TXURN
 |

405 
ATH9K_INT_TXDESC
 |

406 
ATH9K_INT_MIB
 |

407 
ATH9K_INT_RXPHY
 |

408 
ATH9K_INT_RXKCM
 |

409 
ATH9K_INT_SWBA
 |

410 
ATH9K_INT_BMISS
 |

411 
ATH9K_INT_GPIO
,

412 
	mATH9K_INT_NOCARD
 = 0xffffffff

415 
	#MAX_RTT_TABLE_ENTRY
 6

	)

416 
	#MAX_IQCAL_MEASUREMENT
 8

	)

417 
	#MAX_CL_TAB_ENTRY
 16

	)

418 
	#CL_TAB_ENTRY
(
ªg_ba£
Ë‘eg_ba£ + (4 * 
j
))

	)

420 
	e©h9k_ˇl_Êags
 {

421 
	mRTT_DONE
,

422 
	mPAPRD_PACKET_SENT
,

423 
	mPAPRD_DONE
,

424 
	mNFCAL_PENDING
,

425 
	mNFCAL_INTF
,

426 
	mTXIQCAL_DONE
,

427 
	mTXCLCAL_DONE
,

428 
	mSW_PKDET_DONE
,

431 
	s©h9k_hw_ˇl_d©a
 {

432 
u16
 
	mch™√l
;

433 
u16
 
	mch™√lFœgs
;

434 
	mˇl_Êags
;

435 
öt32_t
 
	mCÆVÆid
;

436 
öt8_t
 
	miCoff
;

437 
öt8_t
 
	mqCoff
;

438 
u8
 
	mˇldac
[2];

439 
u16
 
	msmÆl_sig«l_gaö
[
AR9300_MAX_CHAINS
];

440 
u32
 
	m∑_èbÀ
[
AR9300_MAX_CHAINS
][
PAPRD_TABLE_SZ
];

441 
u32
 
	mnum_mósuªs
[
AR9300_MAX_CHAINS
];

442 
	mtx_c‹r_c€ff
[
MAX_IQCAL_MEASUREMENT
][
AR9300_MAX_CHAINS
];

443 
u32
 
	mtx_˛ˇl
[
AR9300_MAX_CHAINS
][
MAX_CL_TAB_ENTRY
];

444 
u32
 
	mπt_èbÀ
[
AR9300_MAX_CHAINS
][
MAX_RTT_TABLE_ENTRY
];

445 
©h9k_nfˇl_hi°
 
	mnfCÆHi°
[
NUM_NF_READINGS
];

448 
	s©h9k_ch™√l
 {

449 
õì80211_ch™√l
 *
	mch™
;

450 
u16
 
	mch™√l
;

451 
u16
 
	mch™√lFœgs
;

452 
s16
 
	mnoi£Êo‹
;

455 
	#CHANNEL_5GHZ
 
	`BIT
(0)

	)

456 
	#CHANNEL_HALF
 
	`BIT
(1)

	)

457 
	#CHANNEL_QUARTER
 
	`BIT
(2)

	)

458 
	#CHANNEL_HT
 
	`BIT
(3)

	)

459 
	#CHANNEL_HT40PLUS
 
	`BIT
(4)

	)

460 
	#CHANNEL_HT40MINUS
 
	`BIT
(5)

	)

462 
	#IS_CHAN_5GHZ
(
_c
Ë(!!((_c)->
ch™√lFœgs
 & 
CHANNEL_5GHZ
))

	)

463 
	#IS_CHAN_2GHZ
(
_c
Ë(!
	`IS_CHAN_5GHZ
(_c))

	)

465 
	#IS_CHAN_HALF_RATE
(
_c
Ë(!!((_c)->
ch™√lFœgs
 & 
CHANNEL_HALF
))

	)

466 
	#IS_CHAN_QUARTER_RATE
(
_c
Ë(!!((_c)->
ch™√lFœgs
 & 
CHANNEL_QUARTER
))

	)

467 
	#IS_CHAN_A_FAST_CLOCK
(
_ah
, 
_c
) \

468 (
	`IS_CHAN_5GHZ
(
_c
Ë&& ((
_ah
)->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_FASTCLOCK
))

	)

470 
	#IS_CHAN_HT
(
_c
Ë((_c)->
ch™√lFœgs
 & 
CHANNEL_HT
)

	)

472 
	#IS_CHAN_HT20
(
_c
Ë(
	`IS_CHAN_HT
(_cË&& !
	`IS_CHAN_HT40
(_c))

	)

474 
	#IS_CHAN_HT40
(
_c
) \

475 (!!((
_c
)->
ch™√lFœgs
 & (
CHANNEL_HT40PLUS
 | 
CHANNEL_HT40MINUS
)))

	)

477 
	#IS_CHAN_HT40PLUS
(
_c
Ë((_c)->
ch™√lFœgs
 & 
CHANNEL_HT40PLUS
)

	)

478 
	#IS_CHAN_HT40MINUS
(
_c
Ë((_c)->
ch™√lFœgs
 & 
CHANNEL_HT40MINUS
)

	)

480 
	e©h9k_powî_mode
 {

481 
	mATH9K_PM_AWAKE
 = 0,

482 
	mATH9K_PM_FULL_SLEEP
,

483 
	mATH9K_PM_NETWORK_SLEEP
,

484 
	mATH9K_PM_UNDEFINED


487 
	e£r_ªg_mode
 {

488 
	mSER_REG_MODE_OFF
 = 0,

489 
	mSER_REG_MODE_ON
 = 1,

490 
	mSER_REG_MODE_AUTO
 = 2,

493 
	e©h9k_rx_qty≥
 {

494 
	mATH9K_RX_QUEUE_HP
,

495 
	mATH9K_RX_QUEUE_LP
,

496 
	mATH9K_RX_QUEUE_MAX
,

499 
	s©h9k_bóc⁄_°©e
 {

500 
u32
 
	mbs_√xâbâ
;

501 
u32
 
	mbs_√xtdtim
;

502 
u32
 
	mbs_ötvÆ
;

503 
	#ATH9K_TSFOOR_THRESHOLD
 0x00004240

	)

504 
u32
 
	mbs_dtim≥riod
;

505 
u16
 
	mbs_bmis°hªshﬁd
;

506 
u32
 
	mbs_¶ìpduøti⁄
;

507 
u32
 
	mbs_tsfo‹_thªshﬁd
;

510 
	sch™_˚¡îs
 {

511 
u16
 
	msy¡h_˚¡î
;

512 
u16
 
	m˘l_˚¡î
;

513 
u16
 
	mext_˚¡î
;

517 
	mATH9K_RESET_POWER_ON
,

518 
	mATH9K_RESET_WARM
,

519 
	mATH9K_RESET_COLD
,

523 
	mATH_DIAG_DISABLE_RX
,

524 
	mATH_DIAG_DISABLE_TX
,

525 
	mATH_DIAG_TRIGGER_ERROR
,

528 
	s©h9k_hw_vîsi⁄
 {

529 
u32
 
	mmagic
;

530 
u16
 
	mdevid
;

531 
u16
 
	msubvíd‹id
;

532 
u32
 
	mmacVîsi⁄
;

533 
u16
 
	mmacRev
;

534 
u16
 
	mphyRev
;

535 
u16
 
	m™Æog5GhzRev
;

536 
u16
 
	m™Æog2GhzRev
;

537 
©h_usb_dev
 
	musbdev
;

542 
	#ATH_MAX_GEN_TIMER
 16

	)

544 
	#AR_GENTMR_BIT
(
_ödex
Ë(1 << (_ödex))

	)

546 
	s©h_gí_timî_c⁄figuøti⁄
 {

547 
u32
 
	m√xt_addr
;

548 
u32
 
	m≥riod_addr
;

549 
u32
 
	mmode_addr
;

550 
u32
 
	mmode_mask
;

553 
	s©h_gí_timî
 {

554 (*
	måiggî
)(*
	m¨g
);

555 (*
	movîÊow
)(*
	m¨g
);

556 *
	m¨g
;

557 
u8
 
	mödex
;

560 
	s©h_gí_timî_èbÀ
 {

561 
©h_gí_timî
 *
	mtimîs
[
ATH_MAX_GEN_TIMER
];

562 
u16
 
	mtimî_mask
;

563 
boﬁ
 
	mtsf2_íabÀd
;

566 
	s©h_hw_™tcomb_c⁄f
 {

567 
u8
 
	mmaö_ a_c⁄f
;

568 
u8
 
	mÆt_ a_c⁄f
;

569 
u8
 
	mÁ°_div_büs
;

570 
u8
 
	mmaö_gaötb
;

571 
u8
 
	mÆt_gaötb
;

572 
	m a1_ a2_dñè
;

573 
	m a1_ a2_swôch_dñè
;

574 
u8
 
	mdiv_group
;

597 
	s©h_hw_ød¨_c⁄f
 {

598 
	mpul£_öb™d
;

599 
	mpul£_öb™d_°ï
;

600 
	mpul£_height
;

601 
	mpul£_rssi
;

602 
	mpul£_maxÀn
;

604 
	mød¨_rssi
;

605 
	mød¨_öb™d
;

606 
	mfú_powî
;

608 
boﬁ
 
	mext_ch™√l
;

633 
	s©h_hw_¥iv©e_›s
 {

634 (*
	möô_h™g_checks
)(
©h_hw
 *
	mah
);

635 
boﬁ
 (*
dëe˘_mac_h™g
)(
©h_hw
 *
	mah
);

636 
boﬁ
 (*
dëe˘_bb_h™g
)(
©h_hw
 *
	mah
);

639 (*
	möô_ˇl_£âögs
)(
©h_hw
 *
	mah
);

640 
boﬁ
 (*
öô_ˇl
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
);

642 (*
	möô_mode_gaö_ªgs
)(
©h_hw
 *
	mah
);

643 (*
	m£tup_ˇlibøti⁄
)(
©h_hw
 *
	mah
,

644 
©h9k_ˇl_li°
 *
	mcuºCÆ
);

647 (*
	mrf_£t_‰eq
)(
©h_hw
 *
	mah
,

648 
©h9k_ch™√l
 *
	mch™
);

649 (*
	m•ur_môig©e_‰eq
)(
©h_hw
 *
	mah
,

650 
©h9k_ch™√l
 *
	mch™
);

651 
boﬁ
 (*
£t_rf_ªgs
)(
©h_hw
 *
	mah
,

652 
©h9k_ch™√l
 *
	mch™
,

653 
u16
 
	mmodesIndex
);

654 (*
	m£t_ch™√l_ªgs
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
);

655 (*
	möô_bb
)(
©h_hw
 *
	mah
,

656 
©h9k_ch™√l
 *
	mch™
);

657 (*
	m¥o˚ss_öi
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
);

658 (*
	mﬁc_öô
)(
©h_hw
 *
	mah
);

659 (*
	m£t_rfmode
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
);

660 (*
	mm¨k_phy_öa˘ive
)(
©h_hw
 *
	mah
);

661 (*
	m£t_dñè_¶›e
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
);

662 
boﬁ
 (*
rfbus_ªq
)(
©h_hw
 *
	mah
);

663 (*
	mrfbus_d⁄e
)(
©h_hw
 *
	mah
);

664 (*
	mª°‹e_chaömask
)(
©h_hw
 *
	mah
);

665 
u32
 (*
compuã_∂l_c⁄åﬁ
)(
©h_hw
 *
	mah
,

666 
©h9k_ch™√l
 *
	mch™
);

667 
boﬁ
 (*
™i_c⁄åﬁ
)(
©h_hw
 *
	mah
, 
©h9k_™i_cmd
 
	mcmd
,

668 
	m∑øm
);

669 (*
	mdo_gënf
)(
©h_hw
 *
	mah
, 
öt16_t
 
	mnÁºay
[
NUM_NF_READINGS
]);

670 (*
	m£t_ød¨_∑øms
)(
©h_hw
 *
	mah
,

671 
©h_hw_ød¨_c⁄f
 *
	mc⁄f
);

672 (*
	mÁ°_ch™_ch™ge
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
,

673 
u8
 *
	möi_ªlﬂded
);

676 (*
	m™i_ˇche_öi_ªgs
)(
©h_hw
 *
	mah
);

678 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


679 
boﬁ
 (*
is_aic_íabÀd
)(
©h_hw
 *
	mah
);

705 
	s©h_•ec_sˇn
 {

706 
boﬁ
 
	míabÀd
;

707 
boﬁ
 
	msh‹t_ª≥©
;

708 
boﬁ
 
	mídÀss
;

709 
u8
 
	mcou¡
;

710 
u8
 
	m≥riod
;

711 
u8
 
	mf·_≥riod
;

728 
	s©h_hw_›s
 {

729 (*
	mc⁄fig_pci_powîßve
)(
©h_hw
 *
	mah
,

730 
boﬁ
 
	mpowî_off
);

731 (*
	mrx_íabÀ
)(
©h_hw
 *
	mah
);

732 (*
	m£t_desc_lök
)(*
	mds
, 
u32
 
	mlök
);

733 (*
	mˇlibøã
)(
©h_hw
 *
	mah
, 
©h9k_ch™√l
 *
	mch™
,

734 
u8
 
	mrxchaömask
, 
boﬁ
 
	ml⁄gˇl
);

735 
boﬁ
 (*
gë_i§
)(
©h_hw
 *
	mah
, 
©h9k_öt
 *
	mmasked
,

736 
u32
 *
	msync_ˇu£_p
);

737 (*
	m£t_txdesc
)(
©h_hw
 *
	mah
, *
	mds
,

738 
©h_tx_öfo
 *
	mi
);

739 (*
	m¥oc_txdesc
)(
©h_hw
 *
	mah
, *
	mds
,

740 
©h_tx_°©us
 *
	mts
);

741 (*
	mgë_duøti⁄
)(
©h_hw
 *
	mah
, c⁄° *
	mds
, 
	mödex
);

742 (*
	m™tdiv_comb_c⁄f_gë
)(
©h_hw
 *
	mah
,

743 
©h_hw_™tcomb_c⁄f
 *
	m™tc⁄f
);

744 (*
	m™tdiv_comb_c⁄f_£t
)(
©h_hw
 *
	mah
,

745 
©h_hw_™tcomb_c⁄f
 *
	m™tc⁄f
);

746 (*
	mgë_adc_íå›y
)(
©h_hw
 *
	mah
, 
u8
 *
	mbuf
, 
size_t
 
	mÀn
);

747 (*
	m•e˘øl_sˇn_c⁄fig
)(
©h_hw
 *
	mah
,

748 
©h_•ec_sˇn
 *
	m∑øm
);

749 (*
	m•e˘øl_sˇn_åiggî
)(
©h_hw
 *
	mah
);

750 (*
	m•e˘øl_sˇn_waô
)(
©h_hw
 *
	mah
);

752 (*
	mtx99_°¨t
)(
©h_hw
 *
	mah
, 
u32
 
	mqnum
);

753 (*
	mtx99_°›
)(
©h_hw
 *
	mah
);

754 (*
	mtx99_£t_txpowî
)(
©h_hw
 *
	mah
, 
u8
 
	mpowî
);

756 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


757 (*
	m£t_bt_™t_divîsôy
)(
©h_hw
 *
	mhw
, 
boﬁ
 
	míabÀ
);

761 
	s©h_nf_limôs
 {

762 
s16
 
	mmax
;

763 
s16
 
	mmö
;

764 
s16
 
	mnomöÆ
;

767 
	e©h_ˇl_li°
 {

768 
	mTX_IQ_CAL
 = 
BIT
(0),

769 
	mTX_IQ_ON_AGC_CAL
 = 
BIT
(1),

770 
	mTX_CL_CAL
 = 
BIT
(2),

774 
	#AH_USE_EEPROM
 0x1

	)

775 
	#AH_UNPLUGGED
 0x2

	)

776 
	#AH_FASTCC
 0x4

	)

777 
	#AH_NO_EEP_SWAP
 0x8

	)

779 
	s©h_hw
 {

780 
©h_›s
 
	mªg_›s
;

782 
devi˚
 *
	mdev
;

783 
õì80211_hw
 *
	mhw
;

784 
©h_comm⁄
 
	mcomm⁄
;

785 
©h9k_hw_vîsi⁄
 
	mhw_vîsi⁄
;

786 
©h9k_›s_c⁄fig
 
	mc⁄fig
;

787 
©h9k_hw_ˇ∑bûôõs
 
	mˇps
;

788 
©h9k_ch™√l
 
	mch™√ls
[
ATH9K_NUM_CHANNELS
];

789 
©h9k_ch™√l
 *
	mcurch™
;

792 
¨5416_ì¥om_def
 
	mdef
;

793 
¨5416_ì¥om_4k
 
	mm≠4k
;

794 
¨9287_ì¥om
 
	mm≠9287
;

795 
¨9300_ì¥om
 
	m¨9300_ìp
;

796 } 
	mì¥om
;

797 c⁄° 
ì¥om_›s
 *
	mìp_›s
;

799 
boﬁ
 
	msw_mgmt_¸y±o_tx
;

800 
boﬁ
 
	msw_mgmt_¸y±o_rx
;

801 
boﬁ
 
	mis_pcõx¥ess
;

802 
boﬁ
 
	ma•m_íabÀd
;

803 
boﬁ
 
	mis_m⁄ô‹ög
;

804 
boﬁ
 
	m√ed_™_t›2_fixup
;

805 
u16
 
	mtx_åig_Àvñ
;

807 
u32
 
	mnf_ªgs
[6];

808 
©h_nf_limôs
 
	mnf_2g
;

809 
©h_nf_limôs
 
	mnf_5g
;

810 
u16
 
	mrfsûít
;

811 
u32
 
	mrfkûl_gpio
;

812 
u32
 
	mrfkûl_pﬁ¨ôy
;

813 
u32
 
	mah_Êags
;

815 
	mdüg
;

817 
boﬁ
 
	mª£t_powî_⁄
;

818 
boﬁ
 
	mhtc_ª£t_öô
;

820 
∆80211_i·y≥
 
	m›mode
;

821 
©h9k_powî_mode
 
	mpowî_mode
;

823 
s8
 
	mnoi£
;

824 
©h9k_hw_ˇl_d©a
 *
	mˇld©a
;

825 
©h9k_∑ˇl_öfo
 
	m∑ˇl_öfo
;

826 
¨5416Sèts
 
	m°©s
;

827 
©h9k_tx_queue_öfo
 
	mtxq
[
ATH9K_NUM_TX_QUEUES
];

829 
©h9k_öt
 
	mimask
;

830 
u32
 
	mimrs2_ªg
;

831 
u32
 
	mtxok_öãºu±_mask
;

832 
u32
 
	mtxîr_öãºu±_mask
;

833 
u32
 
	mtxdesc_öãºu±_mask
;

834 
u32
 
	mtxeﬁ_öãºu±_mask
;

835 
u32
 
	mtxu∫_öãºu±_mask
;

836 
©omic_t
 
	möå_ªf_˙t
;

837 
boﬁ
 
	mchù_fuŒ¶ìp
;

838 
u32
 
	mmodes_ödex
;

841 
u32
 
	msuµ_ˇls
;

842 
©h9k_ˇl_li°
 
	miq_ˇld©a
;

843 
©h9k_ˇl_li°
 
	madcgaö_ˇld©a
;

844 
©h9k_ˇl_li°
 
	madcdc_ˇld©a
;

845 
©h9k_ˇl_li°
 *
	mˇl_li°
;

846 
©h9k_ˇl_li°
 *
	mˇl_li°_œ°
;

847 
©h9k_ˇl_li°
 *
	mˇl_li°_cuº
;

848 
	#tŸÆPowîMósI
 
mós0
.
unsign


	)

849 
	#tŸÆPowîMósQ
 
mós1
.
unsign


	)

850 
	#tŸÆIqC‹rMós
 
mós2
.
sign


	)

851 
	#tŸÆAdcIOddPha£
 
mós0
.
unsign


	)

852 
	#tŸÆAdcIEvíPha£
 
mós1
.
unsign


	)

853 
	#tŸÆAdcQOddPha£
 
mós2
.
unsign


	)

854 
	#tŸÆAdcQEvíPha£
 
mós3
.
unsign


	)

855 
	#tŸÆAdcDcOff£tIOddPha£
 
mós0
.
sign


	)

856 
	#tŸÆAdcDcOff£tIEvíPha£
 
mós1
.
sign


	)

857 
	#tŸÆAdcDcOff£tQOddPha£
 
mós2
.
sign


	)

858 
	#tŸÆAdcDcOff£tQEvíPha£
 
mós3
.
sign


	)

860 
u32
 
	munsign
[
AR5416_MAX_CHAINS
];

861 
öt32_t
 
	msign
[
AR5416_MAX_CHAINS
];

862 } 
	mmós0
;

864 
u32
 
	munsign
[
AR5416_MAX_CHAINS
];

865 
öt32_t
 
	msign
[
AR5416_MAX_CHAINS
];

866 } 
	mmós1
;

868 
u32
 
	munsign
[
AR5416_MAX_CHAINS
];

869 
öt32_t
 
	msign
[
AR5416_MAX_CHAINS
];

870 } 
	mmós2
;

872 
u32
 
	munsign
[
AR5416_MAX_CHAINS
];

873 
öt32_t
 
	msign
[
AR5416_MAX_CHAINS
];

874 } 
	mmós3
;

875 
u16
 
	mˇl_ßm∂es
;

876 
u8
 
	míabÀd_ˇls
;

878 
u32
 
	m°a_id1_deÁu…s
;

879 
u32
 
	mmisc_mode
;

882 
©h_hw_¥iv©e_›s
 
	m¥iv©e_›s
;

884 
©h_hw_›s
 
	m›s
;

887 
u32
 *
	m™ÆogB™k6D©a
;

889 
	mcovîage_˛ass
;

890 
u32
 
	m¶Ÿtime
;

891 
u32
 
	mglobÆtxtimeout
;

894 
u32
 
	m™ùîiod
;

895 
©h9k_™i_cmd
 
	m™i_fun˘i⁄
;

896 
u32
 
	m™i_skù_cou¡
;

897 
¨5416AniSèã
 
	m™i
;

899 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


900 
©h_btc€x_hw
 
	mbtc€x_hw
;

903 
u32
 
	möå_txqs
;

904 
u8
 
	mtxchaömask
;

905 
u8
 
	mrxchaömask
;

907 
©h_hw_ød¨_c⁄f
 
	mød¨_c⁄f
;

909 
u32
 
	m‹igöÆGaö
[22];

910 
	möôPDADC
;

911 
	mPDADCdñè
;

912 
	mÀd_pö
;

913 
u32
 
	mgpio_mask
;

914 
u32
 
	mgpio_vÆ
;

916 
¨5416IniAºay
 
	möi_dfs
;

917 
¨5416IniAºay
 
	möiModes
;

918 
¨5416IniAºay
 
	möiComm⁄
;

919 
¨5416IniAºay
 
	möiBB_RfGaö
;

920 
¨5416IniAºay
 
	möiB™k6
;

921 
¨5416IniAºay
 
	möiAddac
;

922 
¨5416IniAºay
 
	möiPcõSîdes
;

923 
¨5416IniAºay
 
	möiPcõSîdesLowPowî
;

924 
¨5416IniAºay
 
	möiModesFa°Clock
;

925 
¨5416IniAºay
 
	möiAddôi⁄Æ
;

926 
¨5416IniAºay
 
	möiModesRxGaö
;

927 
¨5416IniAºay
 
	möi_modes_rx_gaö_bounds
;

928 
¨5416IniAºay
 
	möiModesTxGaö
;

929 
¨5416IniAºay
 
	möiCckfúN‹mÆ
;

930 
¨5416IniAºay
 
	möiCckfúJ≠™2484
;

931 
¨5416IniAºay
 
	möiModes_9271_ANI_ªg
;

932 
¨5416IniAºay
 
	möi_ødio_po°_sys2™t
;

933 
¨5416IniAºay
 
	möi_modes_rxgaö_x a
;

934 
¨5416IniAºay
 
	möi_modes_rxgaö_bb_c‹e
;

935 
¨5416IniAºay
 
	möi_modes_rxgaö_bb_po°ambÀ
;

937 
¨5416IniAºay
 
	möiMac
[
ATH_INI_NUM_SPLIT
];

938 
¨5416IniAºay
 
	möiBB
[
ATH_INI_NUM_SPLIT
];

939 
¨5416IniAºay
 
	möiRadio
[
ATH_INI_NUM_SPLIT
];

940 
¨5416IniAºay
 
	möiSOC
[
ATH_INI_NUM_SPLIT
];

942 
u32
 
	möå_gí_timî_åiggî
;

943 
u32
 
	möå_gí_timî_thªsh
;

944 
©h_gí_timî_èbÀ
 
	mhw_gí_timîs
;

946 
¨9003_txs
 *
	mts_rög
;

947 
u32
 
	mts_∑ddr_°¨t
;

948 
u32
 
	mts_∑ddr_íd
;

949 
u16
 
	mts_èû
;

950 
u16
 
	mts_size
;

952 
u32
 
	mbb_w©chdog_œ°_°©us
;

953 
u32
 
	mbb_w©chdog_timeout_ms
;

954 
u8
 
	mbb_h™g_rx_ofdm
;

956 
	m∑¥d_èrgë_powî
;

957 
	m∑¥d_åaöög_powî
;

958 
	m∑¥d_øãmask
;

959 
	m∑¥d_øãmask_ht40
;

960 
boﬁ
 
	m∑¥d_èbÀ_wrôe_d⁄e
;

961 
u32
 
	m∑¥d_gaö_èbÀ_íåõs
[
PAPRD_GAIN_TABLE_ENTRIES
];

962 
u8
 
	m∑¥d_gaö_èbÀ_ödex
[
PAPRD_GAIN_TABLE_ENTRIES
];

968 
u32
 
	mWARegVÆ
;

971 
u32
 
	mít_mode
;

973 #ifde‡
CPTCFG_ATH9K_WOW


974 
©h9k_hw_wow
 
	mwow
;

976 
boﬁ
 
	mis_˛k_25mhz
;

977 (*
	mgë_mac_ªvisi⁄
)();

978 (*
	mexã∫Æ_ª£t
)();

979 
boﬁ
 
	mdißbÀ_2ghz
;

980 
boﬁ
 
	mdißbÀ_5ghz
;

982 c⁄° 
fúmw¨e
 *
	mì¥om_blob
;

984 
©h_dy«ck
 
	mdy«ck
;

986 
boﬁ
 
	mçc_íabÀd
;

987 
u8
 
	mtx_powî
[
Ar5416R©eSize
];

988 
u8
 
	mtx_powî_°bc
[
Ar5416R©eSize
];

991 
	s©h_bus_›s
 {

992 
©h_bus_ty≥
 
	m©h_bus_ty≥
;

993 (*
	mªad_ˇchesize
)(
©h_comm⁄
 *
	mcomm⁄
, *
	mcsz
);

994 
boﬁ
 (*
ì¥om_ªad
)(
©h_comm⁄
 *
	mcomm⁄
, 
u32
 
	moff
, 
u16
 *
	md©a
);

995 (*
	mbt_c€x_¥ï
)(
©h_comm⁄
 *
	mcomm⁄
);

996 (*
	ma•m_öô
)(
©h_comm⁄
 *
	mcomm⁄
);

999 
ölöe
 
©h_comm⁄
 *
	$©h9k_hw_comm⁄
(
©h_hw
 *
ah
)

1001  &
ah
->
comm⁄
;

1002 
	}
}

1004 
ölöe
 
©h_ªguœt‹y
 *
	$©h9k_hw_ªguœt‹y
(
©h_hw
 *
ah
)

1006  &(
	`©h9k_hw_comm⁄
(
ah
)->
ªguœt‹y
);

1007 
	}
}

1009 
ölöe
 
©h_hw_¥iv©e_›s
 *
	$©h9k_hw_¥iv©e_›s
(
©h_hw
 *
ah
)

1011  &
ah
->
¥iv©e_›s
;

1012 
	}
}

1014 
ölöe
 
©h_hw_›s
 *
	$©h9k_hw_›s
(
©h_hw
 *
ah
)

1016  &
ah
->
›s
;

1017 
	}
}

1019 
ölöe
 
u8
 
	$gë_°ªams
(
mask
)

1021  !!(
mask
 & 
	`BIT
(0)) + !!(mask & BIT(1)) + !!(mask & BIT(2));

1022 
	}
}

1025 
©h9k_hw_deöô
(
©h_hw
 *
ah
);

1026 
©h9k_hw_öô
(
©h_hw
 *
ah
);

1027 
©h9k_hw_ª£t
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

1028 
©h9k_hw_ˇl_d©a
 *
ˇld©a
, 
boﬁ
 
Á°cc
);

1029 
©h9k_hw_fûl_ˇp_öfo
(
©h_hw
 *
ah
);

1030 
u32
 
©h9k_ªgd_gë_˘l
(
©h_ªguœt‹y
 *
ªg
, 
©h9k_ch™√l
 *
ch™
);

1033 
©h9k_hw_cfg_gpio_öput
(
©h_hw
 *
ah
, 
u32
 
gpio
);

1034 
u32
 
©h9k_hw_gpio_gë
(
©h_hw
 *
ah
, u32 
gpio
);

1035 
©h9k_hw_cfg_ouçut
(
©h_hw
 *
ah
, 
u32
 
gpio
,

1036 
u32
 
ah_sig«l_ty≥
);

1037 
©h9k_hw_£t_gpio
(
©h_hw
 *
ah
, 
u32
 
gpio
, u32 
vÆ
);

1038 
©h9k_hw_ªque°_gpio
(
©h_hw
 *
ah
, 
u32
 
gpio
, c⁄° *
œbñ
);

1039 
©h9k_hw_£è¡í«
(
©h_hw
 *
ah
, 
u32
 
™ã¬a
);

1042 
©h9k_hw_sy¡h_dñay
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

1043 
hw_dñay
);

1044 
boﬁ
 
©h9k_hw_waô
(
©h_hw
 *
ah
, 
u32
 
ªg
, u32 
mask
, u32 
vÆ
, u32 
timeout
);

1045 
©h9k_hw_wrôe_¨øy
(
©h_hw
 *
ah
, c⁄° 
¨5416IniAºay
 *
¨øy
,

1046 
cﬁumn
, *
wrôe˙t
);

1047 
©h9k_hw_ªad_¨øy
(
©h_hw
 *
ah
, 
u32
 
¨øy
[][2], 
size
);

1048 
u32
 
©h9k_hw_ªvî£_bôs
(u32 
vÆ
, u32 
n
);

1049 
u16
 
©h9k_hw_compuãtxtime
(
©h_hw
 *
ah
,

1050 
u8
 
phy
, 
kbps
,

1051 
u32
 
‰ameLí
, 
u16
 
øãix
, 
boﬁ
 
sh‹tPªambÀ
);

1052 
©h9k_hw_gë_ch™√l_˚¡îs
(
©h_hw
 *
ah
,

1053 
©h9k_ch™√l
 *
ch™
,

1054 
ch™_˚¡îs
 *
˚¡îs
);

1055 
u32
 
©h9k_hw_gërxfûãr
(
©h_hw
 *
ah
);

1056 
©h9k_hw_£åxfûãr
(
©h_hw
 *
ah
, 
u32
 
bôs
);

1057 
boﬁ
 
©h9k_hw_phy_dißbÀ
(
©h_hw
 *
ah
);

1058 
boﬁ
 
©h9k_hw_dißbÀ
(
©h_hw
 *
ah
);

1059 
©h9k_hw_£t_txpowîlimô
(
©h_hw
 *
ah
, 
u32
 
limô
, 
boﬁ
 
ã°
);

1060 
©h9k_hw_£t›mode
(
©h_hw
 *
ah
);

1061 
©h9k_hw_£tmˇ°fûãr
(
©h_hw
 *
ah
, 
u32
 
fûãr0
, u32 
fûãr1
);

1062 
©h9k_hw_wrôe_associd
(
©h_hw
 *
ah
);

1063 
u32
 
©h9k_hw_gëtsf32
(
©h_hw
 *
ah
);

1064 
u64
 
©h9k_hw_gëtsf64
(
©h_hw
 *
ah
);

1065 
©h9k_hw_£âsf64
(
©h_hw
 *
ah
, 
u64
 
tsf64
);

1066 
©h9k_hw_ª£t_tsf
(
©h_hw
 *
ah
);

1067 
u32
 
©h9k_hw_gë_tsf_off£t
(
time•ec
 *
œ°
, time•e¯*
cur
);

1068 
©h9k_hw_£t_tsÁdju°
(
©h_hw
 *
ah
, 
boﬁ
 
£t
);

1069 
©h9k_hw_öô_globÆ_£âögs
(
©h_hw
 *
ah
);

1070 
u32
 
¨9003_gë_∂l_sqsum_dvc
(
©h_hw
 *
ah
);

1071 
©h9k_hw_£t11nmac2040
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

1072 
©h9k_hw_bóc⁄öô
(
©h_hw
 *
ah
, 
u32
 
√xt_bóc⁄
, u32 
bóc⁄_≥riod
);

1073 
©h9k_hw_£t_°a_bóc⁄_timîs
(
©h_hw
 *
ah
,

1074 c⁄° 
©h9k_bóc⁄_°©e
 *
bs
);

1075 
©h9k_hw_check_«v
(
©h_hw
 *
ah
);

1076 
boﬁ
 
©h9k_hw_check_Æive
(
©h_hw
 *
ah
);

1078 
boﬁ
 
©h9k_hw_£çowî
(
©h_hw
 *
ah
, 
©h9k_powî_mode
 
mode
);

1079 
©h9k_hw_upd©e_düg
(
©h_hw
 *
ah
);

1082 
©h_gí_timî
 *
©h_gí_timî_Æloc
(
©h_hw
 *
ah
,

1083 (*
åiggî
)(*),

1084 (*
ovîÊow
)(*),

1085 *
¨g
,

1086 
u8
 
timî_ödex
);

1087 
	`©h9k_hw_gí_timî_°¨t
(
©h_hw
 *
ah
,

1088 
©h_gí_timî
 *
timî
,

1089 
u32
 
timî_√xt
,

1090 
u32
 
timî_≥riod
);

1091 
	`©h9k_hw_gí_timî_°¨t_tsf2
(
©h_hw
 *
ah
);

1092 
	`©h9k_hw_gí_timî_°›
(
©h_hw
 *
ah
, 
©h_gí_timî
 *
timî
);

1094 
	`©h_gí_timî_‰ì
(
©h_hw
 *
ah
, 
©h_gí_timî
 *
timî
);

1095 
	`©h_gí_timî_i§
(
©h_hw
 *
hw
);

1097 
	`©h9k_hw_«me
(
©h_hw
 *
ah
, *
hw_«me
, 
size_t
 
Àn
);

1100 
	`©h9k_hw_gë_dñè_¶›e_vÆs
(
©h_hw
 *
ah
, 
u32
 
c€f_sˇÀd
,

1101 
u32
 *
c€f_m™tisß
, u32 *
c€f_exp⁄ít
);

1102 
	`©h9k_hw_≠∂y_txpowî
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
,

1103 
boﬁ
 
ã°
);

1109 
	`¨9002_hw_rf_˛aim
(
©h_hw
 *
ah
);

1110 
	`¨9002_hw_íabÀ_async_fifo
(
©h_hw
 *
ah
);

1116 
boﬁ
 
	`¨9003_hw_bb_w©chdog_check
(
©h_hw
 *
ah
);

1117 
	`¨9003_hw_bb_w©chdog_c⁄fig
(
©h_hw
 *
ah
);

1118 
	`¨9003_hw_bb_w©chdog_ªad
(
©h_hw
 *
ah
);

1119 
	`¨9003_hw_bb_w©chdog_dbg_öfo
(
©h_hw
 *
ah
);

1120 
	`¨9003_hw_dißbÀ_phy_ª°¨t
(
©h_hw
 *
ah
);

1121 
	`¨9003_∑¥d_íabÀ
(
©h_hw
 *
ah
, 
boﬁ
 
vÆ
);

1122 
	`¨9003_∑¥d_p›uœã_sögÀ_èbÀ
(
©h_hw
 *
ah
,

1123 
©h9k_hw_ˇl_d©a
 *
ˇld©a
,

1124 
chaö
);

1125 
	`¨9003_∑¥d_¸óã_curve
(
©h_hw
 *
ah
,

1126 
©h9k_hw_ˇl_d©a
 *
ˇld©a
, 
chaö
);

1127 
	`¨9003_∑¥d_£tup_gaö_èbÀ
(
©h_hw
 *
ah
, 
chaö
);

1128 
	`¨9003_∑¥d_öô_èbÀ
(
©h_hw
 *
ah
);

1129 
boﬁ
 
	`¨9003_∑¥d_is_d⁄e
(
©h_hw
 *
ah
);

1130 
boﬁ
 
	`¨9003_is_∑¥d_íabÀd
(
©h_hw
 *
ah
);

1131 
	`¨9003_hw_£t_chaö_masks
(
©h_hw
 *
ah
, 
u8
 
rx
, u8 
tx
);

1132 
	`¨9003_hw_öô_øã_txpowî
(
©h_hw
 *
ah
, 
u8
 *
øã_¨øy
,

1133 
©h9k_ch™√l
 *
ch™
);

1134 
	`¨5008_hw_cmn_•ur_môig©e
(
©h_hw
 *
ah
,

1135 
©h9k_ch™√l
 *
ch™
, 
bö
);

1136 
	`¨5008_hw_öô_øã_txpowî
(
©h_hw
 *
ah
, 
öt16_t
 *
øã_¨øy
,

1137 
©h9k_ch™√l
 *
ch™
, 
ht40_dñè
);

1140 
	`¨5008_hw_©èch_phy_›s
(
©h_hw
 *
ah
);

1141 
	`¨9002_hw_©èch_phy_›s
(
©h_hw
 *
ah
);

1142 
	`¨9003_hw_©èch_phy_›s
(
©h_hw
 *
ah
);

1144 
	`¨9002_hw_©èch_ˇlib_›s
(
©h_hw
 *
ah
);

1145 
	`¨9003_hw_©èch_ˇlib_›s
(
©h_hw
 *
ah
);

1147 
	`¨9002_hw_©èch_›s
(
©h_hw
 *
ah
);

1148 
	`¨9003_hw_©èch_›s
(
©h_hw
 *
ah
);

1150 
	`¨9002_hw_lﬂd_™i_ªg
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

1152 
	`©h9k_™i_ª£t
(
©h_hw
 *
ah
, 
boﬁ
 
is_sˇ¬ög
);

1153 
	`©h9k_hw_™i_m⁄ô‹
(
©h_hw
 *
ah
, 
©h9k_ch™√l
 *
ch™
);

1155 
	`©h9k_hw_£t_ack_timeout
(
©h_hw
 *
ah
, 
u32
 
us
);

1156 
	`©h9k_hw_£t_˘s_timeout
(
©h_hw
 *
ah
, 
u32
 
us
);

1157 
	`©h9k_hw_£t¶Ÿtime
(
©h_hw
 *
ah
, 
u32
 
us
);

1159 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


1160 
	`¨9003_hw_©èch_aic_›s
(
©h_hw
 *
ah
);

1161 
ölöe
 
boﬁ
 
	$©h9k_hw_btc€x_is_íabÀd
(
©h_hw
 *
ah
)

1163  
ah
->
btc€x_hw
.
íabÀd
;

1164 
	}
}

1165 
ölöe
 
boﬁ
 
	$©h9k_hw_mci_is_íabÀd
(
©h_hw
 *
ah
)

1167  
ah
->
comm⁄
.
btc€x_íabÀd
 &&

1168 (
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
);

1170 
	}
}

1171 
©h9k_hw_btc€x_íabÀ
(
©h_hw
 *
ah
);

1172 
ölöe
 
©h_btc€x_scheme


1173 
	$©h9k_hw_gë_btc€x_scheme
(
©h_hw
 *
ah
)

1175  
ah
->
btc€x_hw
.
scheme
;

1176 
	}
}

1178 
ölöe
 
	$¨9003_hw_©èch_aic_›s
(
©h_hw
 *
ah
)

1180 
	}
}

1181 
ölöe
 
boﬁ
 
	$©h9k_hw_btc€x_is_íabÀd
(
©h_hw
 *
ah
)

1183  
Ál£
;

1184 
	}
}

1185 
ölöe
 
boﬁ
 
	$©h9k_hw_mci_is_íabÀd
(
©h_hw
 *
ah
)

1187  
Ál£
;

1188 
	}
}

1189 
ölöe
 
	$©h9k_hw_btc€x_íabÀ
(
©h_hw
 *
ah
)

1191 
	}
}

1192 
ölöe
 
©h_btc€x_scheme


1193 
	$©h9k_hw_gë_btc€x_scheme
(
©h_hw
 *
ah
)

1195  
ATH_BTCOEX_CFG_NONE
;

1196 
	}
}

1200 #ifde‡
CPTCFG_ATH9K_WOW


1201 
©h9k_hw_wow_≠∂y_∑âîn
(
©h_hw
 *
ah
, 
u8
 *
u£r_∑âîn
,

1202 
u8
 *
u£r_mask
, 
∑âîn_cou¡
,

1203 
∑âîn_Àn
);

1204 
u32
 
©h9k_hw_wow_wakeup
(
©h_hw
 *
ah
);

1205 
©h9k_hw_wow_íabÀ
(
©h_hw
 *
ah
, 
u32
 
∑âîn_íabÀ
);

1207 
ölöe
 
	$©h9k_hw_wow_≠∂y_∑âîn
(
©h_hw
 *
ah
,

1208 
u8
 *
u£r_∑âîn
,

1209 
u8
 *
u£r_mask
,

1210 
∑âîn_cou¡
,

1211 
∑âîn_Àn
)

1214 
	}
}

1215 
ölöe
 
u32
 
	$©h9k_hw_wow_wakeup
(
©h_hw
 *
ah
)

1218 
	}
}

1219 
ölöe
 
	$©h9k_hw_wow_íabÀ
(
©h_hw
 *
ah
, 
u32
 
∑âîn_íabÀ
)

1221 
	}
}

1224 
	#ATH9K_CLOCK_RATE_CCK
 22

	)

1225 
	#ATH9K_CLOCK_RATE_5GHZ_OFDM
 40

	)

1226 
	#ATH9K_CLOCK_RATE_2GHZ_OFDM
 44

	)

1227 
	#ATH9K_CLOCK_FAST_RATE_5GHZ_OFDM
 44

	)

	@init.c

17 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

19 
	~<löux/dma-m≠pög.h
>

20 
	~<löux/¶ab.h
>

21 
	~<löux/©h9k_∂©f‹m.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/ªœy.h
>

24 
	~<√t/õì80211_ødiŸ≠.h
>

26 
	~"©h9k.h
"

28 
	s©h9k_ì¥om_˘x
 {

29 
com∂ëi⁄
 
	mcom∂ëe
;

30 
©h_hw
 *
	mah
;

33 *
	gdev_öfo
 = "ath9k";

35 
MODULE_AUTHOR
("Atheros Communications");

36 
MODULE_DESCRIPTION
("Support for Atheros 802.11n wireless LAN cards.");

37 
MODULE_SUPPORTED_DEVICE
("Atheros 802.11n WLAN cards");

38 
MODULE_LICENSE
("Dual BSD/GPL");

40 
	g©h9k_debug
 = 
ATH_DBG_DEFAULT
;

41 
moduÀ_∑øm_«med
(
debug
, 
©h9k_debug
, 
uöt
, 0);

42 
MODULE_PARM_DESC
(
debug
, "Debugging mask");

44 
	g©h9k_mod∑øm_nohw¸y±
;

45 
moduÀ_∑øm_«med
(
nohw¸y±
, 
©h9k_mod∑øm_nohw¸y±
, , 0444);

46 
MODULE_PARM_DESC
(
nohw¸y±
, "Disable hardwareÉncryption");

48 
	g©h9k_Àd_blök
 = 1;

49 
moduÀ_∑øm_«med
(
blök
, 
©h9k_Àd_blök
, , 0444);

50 
MODULE_PARM_DESC
(
blök
, "Enable LED blink onáctivity");

52 
	g©h9k_btc€x_íabÀ
;

53 
moduÀ_∑øm_«med
(
btc€x_íabÀ
, 
©h9k_btc€x_íabÀ
, , 0444);

54 
MODULE_PARM_DESC
(
btc€x_íabÀ
, "Enable wifi-BT coexistence");

56 
	g©h9k_bt_™t_divîsôy
;

57 
moduÀ_∑øm_«med
(
bt_™t_divîsôy
, 
©h9k_bt_™t_divîsôy
, , 0444);

58 
MODULE_PARM_DESC
(
bt_™t_divîsôy
, "Enable WLAN/BT RXántenna diversity");

60 
	g©h9k_ps_íabÀ
;

61 
moduÀ_∑øm_«med
(
ps_íabÀ
, 
©h9k_ps_íabÀ
, , 0444);

62 
MODULE_PARM_DESC
(
ps_íabÀ
, "Enable WLAN PowerSave");

64 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


66 
	g©h9k_u£_ch™˘x
;

67 
moduÀ_∑øm_«med
(
u£_ch™˘x
, 
©h9k_u£_ch™˘x
, , 0444);

68 
MODULE_PARM_DESC
(
u£_ch™˘x
, "Enable channel context for concurrency");

72 
boﬁ
 
	gis_©h9k_u∆ﬂded
;

74 #ifde‡
CPTCFG_MAC80211_LEDS


75 c⁄° 
õì80211_çt_blök
 
	g©h9k_çt_blök
[] = {

76 { .
throughput
 = 0 * 1024, .
	gblök_time
 = 334 },

77 { .
	gthroughput
 = 1 * 1024, .
	gblök_time
 = 260 },

78 { .
	gthroughput
 = 5 * 1024, .
	gblök_time
 = 220 },

79 { .
	gthroughput
 = 10 * 1024, .
	gblök_time
 = 190 },

80 { .
	gthroughput
 = 20 * 1024, .
	gblök_time
 = 170 },

81 { .
	gthroughput
 = 50 * 1024, .
	gblök_time
 = 150 },

82 { .
	gthroughput
 = 70 * 1024, .
	gblök_time
 = 130 },

83 { .
	gthroughput
 = 100 * 1024, .
	gblök_time
 = 110 },

84 { .
	gthroughput
 = 200 * 1024, .
	gblök_time
 = 80 },

85 { .
	gthroughput
 = 300 * 1024, .
	gblök_time
 = 50 },

89 
©h9k_deöô_so·c
(
©h_so·c
 *
sc
);

91 
	$©h9k_›_ps_wakeup
(
©h_comm⁄
 *
comm⁄
)

93 
	`©h9k_ps_wakeup
((
©h_so·c
 *Ë
comm⁄
->
¥iv
);

94 
	}
}

96 
	$©h9k_›_ps_ª°‹e
(
©h_comm⁄
 *
comm⁄
)

98 
	`©h9k_ps_ª°‹e
((
©h_so·c
 *Ë
comm⁄
->
¥iv
);

99 
	}
}

101 
©h_ps_›s
 
	g©h9k_ps_›s
 = {

102 .
wakeup
 = 
©h9k_›_ps_wakeup
,

103 .
	gª°‹e
 = 
©h9k_›_ps_ª°‹e
,

112 
	$©h9k_iowrôe32
(*
hw_¥iv
, 
u32
 
vÆ
, u32 
ªg_off£t
)

114 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

115 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

116 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

118 i‡(
NR_CPUS
 > 1 && 
ah
->
c⁄fig
.
£rülize_ªgmode
 =
SER_REG_MODE_ON
) {

119 
Êags
;

120 
	`•ö_lock_úqßve
(&
sc
->
sc_£rül_rw
, 
Êags
);

121 
	`iowrôe32
(
vÆ
, 
sc
->
mem
 + 
ªg_off£t
);

122 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_£rül_rw
, 
Êags
);

124 
	`iowrôe32
(
vÆ
, 
sc
->
mem
 + 
ªg_off£t
);

125 
	}
}

127 
	$©h9k_i‹ód32
(*
hw_¥iv
, 
u32
 
ªg_off£t
)

129 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

130 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

131 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

132 
u32
 
vÆ
;

134 i‡(
NR_CPUS
 > 1 && 
ah
->
c⁄fig
.
£rülize_ªgmode
 =
SER_REG_MODE_ON
) {

135 
Êags
;

136 
	`•ö_lock_úqßve
(&
sc
->
sc_£rül_rw
, 
Êags
);

137 
vÆ
 = 
	`i‹ód32
(
sc
->
mem
 + 
ªg_off£t
);

138 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_£rül_rw
, 
Êags
);

140 
vÆ
 = 
	`i‹ód32
(
sc
->
mem
 + 
ªg_off£t
);

141  
vÆ
;

142 
	}
}

144 
	$©h9k_mu…i_i‹ód32
(*
hw_¥iv
, 
u32
 *
addr
,

145 
u32
 *
vÆ
, 
u16
 
cou¡
)

147 
i
;

149 
i
 = 0; i < 
cou¡
; i++)

150 
vÆ
[
i
] = 
	`©h9k_i‹ód32
(
hw_¥iv
, 
addr
[i]);

151 
	}
}

154 
	$__©h9k_ªg_rmw
(
©h_so·c
 *
sc
, 
u32
 
ªg_off£t
,

155 
u32
 
£t
, u32 
˛r
)

157 
u32
 
vÆ
;

159 
vÆ
 = 
	`i‹ód32
(
sc
->
mem
 + 
ªg_off£t
);

160 
vÆ
 &~
˛r
;

161 
vÆ
 |
£t
;

162 
	`iowrôe32
(
vÆ
, 
sc
->
mem
 + 
ªg_off£t
);

164  
vÆ
;

165 
	}
}

167 
	$©h9k_ªg_rmw
(*
hw_¥iv
, 
u32
 
ªg_off£t
, u32 
£t
, u32 
˛r
)

169 
©h_hw
 *
ah
 = (©h_hw *Ë
hw_¥iv
;

170 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

171 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

172 
	`unöôülized_v¨
(
Êags
);

173 
u32
 
vÆ
;

175 i‡(
NR_CPUS
 > 1 && 
ah
->
c⁄fig
.
£rülize_ªgmode
 =
SER_REG_MODE_ON
) {

176 
	`•ö_lock_úqßve
(&
sc
->
sc_£rül_rw
, 
Êags
);

177 
vÆ
 = 
	`__©h9k_ªg_rmw
(
sc
, 
ªg_off£t
, 
£t
, 
˛r
);

178 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_£rül_rw
, 
Êags
);

180 
vÆ
 = 
	`__©h9k_ªg_rmw
(
sc
, 
ªg_off£t
, 
£t
, 
˛r
);

182  
vÆ
;

183 
	}
}

189 
	$©h9k_ªg_nŸifõr
(
wùhy
 *wiphy,

190 
ªguœt‹y_ªque°
 *
ªque°
)

192 
õì80211_hw
 *
hw
 = 
	`wùhy_to_õì80211_hw
(
wùhy
);

193 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

194 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

195 
©h_ªguœt‹y
 *
ªg
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

197 
	`©h_ªg_nŸifõr_≠∂y
(
wùhy
, 
ªque°
, 
ªg
);

200 i‡(!
ah
->
curch™
)

203 
sc
->
cur_ch™
->
txpowî
 = 2 * 
ah
->
curch™
->
ch™
->
max_powî
;

204 
	`©h9k_ps_wakeup
(
sc
);

205 
	`©h9k_hw_£t_txpowîlimô
(
ah
, 
sc
->
cur_ch™
->
txpowî
, 
Ál£
);

206 
	`©h9k_cmn_upd©e_txpow
(
ah
, 
sc
->
cur_ch™
->
cur_txpowî
,

207 
sc
->
cur_ch™
->
txpowî
,

208 &
sc
->
cur_ch™
->
cur_txpowî
);

210 i‡(
sc
->
dfs_dëe˘‹
 !
NULL
)

211 
sc
->
dfs_dëe˘‹
->
	`£t_dfs_domaö
(sc->dfs_detector,

212 
ªque°
->
dfs_ªgi⁄
);

213 
	`©h9k_ps_ª°‹e
(
sc
);

214 
	}
}

221 
	$©h_descdma_£tup
(
©h_so·c
 *
sc
, 
©h_descdma
 *
dd
,

222 
li°_hód
 *
hód
, c⁄° *
«me
,

223 
nbuf
, 
ndesc
, 
boﬁ
 
is_tx
)

225 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

226 
u8
 *
ds
;

227 
i
, 
bsize
, 
desc_Àn
;

229 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "%s DMA: %u buffers %u desc/buf\n",

230 
«me
, 
nbuf
, 
ndesc
);

232 
	`INIT_LIST_HEAD
(
hód
);

234 i‡(
is_tx
)

235 
desc_Àn
 = 
sc
->
sc_ah
->
ˇps
.
tx_desc_Àn
;

237 
desc_Àn
 = (
©h_desc
);

240 i‡((
desc_Àn
 % 4) != 0) {

241 
	`©h_îr
(
comm⁄
, "ath_descÇot DWORDáligned\n");

242 
	`BUG_ON
((
desc_Àn
 % 4) != 0);

243  -
ENOMEM
;

246 
dd
->
dd_desc_Àn
 = 
desc_Àn
 * 
nbuf
 * 
ndesc
;

253 i‡(!(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_4KB_SPLITTRANS
)) {

254 
u32
 
ndesc_skù≥d
 =

255 
	`ATH_DESC_4KB_BOUND_NUM_SKIPPED
(
dd
->
dd_desc_Àn
);

256 
u32
 
dma_Àn
;

258 
ndesc_skù≥d
) {

259 
dma_Àn
 = 
ndesc_skù≥d
 * 
desc_Àn
;

260 
dd
->
dd_desc_Àn
 +
dma_Àn
;

262 
ndesc_skù≥d
 = 
	`ATH_DESC_4KB_BOUND_NUM_SKIPPED
(
dma_Àn
);

267 
dd
->
dd_desc
 = 
	`dmam_Æloc_cohîít
(
sc
->
dev
, dd->
dd_desc_Àn
,

268 &
dd
->
dd_desc_∑ddr
, 
GFP_KERNEL
);

269 i‡(!
dd
->
dd_desc
)

270  -
ENOMEM
;

272 
ds
 = (
u8
 *Ë
dd
->
dd_desc
;

273 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "%s DMA map: %p (%u) -> %llx (%u)\n",

274 
«me
, 
ds
, (
u32
Ë
dd
->
dd_desc_Àn
,

275 
	`ôo64
(
dd
->
dd_desc_∑ddr
), (
u32
Ëdd->
dd_desc_Àn
);

278 i‡(
is_tx
) {

279 
©h_buf
 *
bf
;

281 
bsize
 = (
©h_buf
Ë* 
nbuf
;

282 
bf
 = 
	`devm_kzÆloc
(
sc
->
dev
, 
bsize
, 
GFP_KERNEL
);

283 i‡(!
bf
)

284  -
ENOMEM
;

286 
i
 = 0; i < 
nbuf
; i++, 
bf
++, 
ds
 +(
desc_Àn
 * 
ndesc
)) {

287 
bf
->
bf_desc
 = 
ds
;

288 
bf
->
bf_daddr
 = 
	`DS2PHYS
(
dd
, 
ds
);

290 i‡(!(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 &

291 
ATH9K_HW_CAP_4KB_SPLITTRANS
)) {

297 
	`ATH_DESC_4KB_BOUND_CHECK
(
bf
->
bf_daddr
)) {

298 
	`BUG_ON
((
ˇddr_t
Ë
bf
->
bf_desc
 >=

299 ((
ˇddr_t
Ë
dd
->
dd_desc
 +

300 
dd
->
dd_desc_Àn
));

302 
ds
 +(
desc_Àn
 * 
ndesc
);

303 
bf
->
bf_desc
 = 
ds
;

304 
bf
->
bf_daddr
 = 
	`DS2PHYS
(
dd
, 
ds
);

307 
	`li°_add_èû
(&
bf
->
li°
, 
hód
);

310 
©h_rxbuf
 *
bf
;

312 
bsize
 = (
©h_rxbuf
Ë* 
nbuf
;

313 
bf
 = 
	`devm_kzÆloc
(
sc
->
dev
, 
bsize
, 
GFP_KERNEL
);

314 i‡(!
bf
)

315  -
ENOMEM
;

317 
i
 = 0; i < 
nbuf
; i++, 
bf
++, 
ds
 +(
desc_Àn
 * 
ndesc
)) {

318 
bf
->
bf_desc
 = 
ds
;

319 
bf
->
bf_daddr
 = 
	`DS2PHYS
(
dd
, 
ds
);

321 i‡(!(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 &

322 
ATH9K_HW_CAP_4KB_SPLITTRANS
)) {

328 
	`ATH_DESC_4KB_BOUND_CHECK
(
bf
->
bf_daddr
)) {

329 
	`BUG_ON
((
ˇddr_t
Ë
bf
->
bf_desc
 >=

330 ((
ˇddr_t
Ë
dd
->
dd_desc
 +

331 
dd
->
dd_desc_Àn
));

333 
ds
 +(
desc_Àn
 * 
ndesc
);

334 
bf
->
bf_desc
 = 
ds
;

335 
bf
->
bf_daddr
 = 
	`DS2PHYS
(
dd
, 
ds
);

338 
	`li°_add_èû
(&
bf
->
li°
, 
hód
);

342 
	}
}

344 
	$©h9k_öô_queues
(
©h_so·c
 *
sc
)

346 
i
 = 0;

348 
sc
->
bóc⁄
.
bóc⁄q
 = 
	`©h9k_hw_bóc⁄q_£tup
(sc->
sc_ah
);

349 
sc
->
bóc⁄
.
ˇbq
 = 
	`©h_txq_£tup
(sc, 
ATH9K_TX_QUEUE_CAB
, 0);

350 
	`©h_ˇbq_upd©e
(
sc
);

352 
sc
->
tx
.
u≠sdq
 = 
	`©h_txq_£tup
(sc, 
ATH9K_TX_QUEUE_UAPSD
, 0);

354 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

355 
sc
->
tx
.
txq_m≠
[
i
] = 
	`©h_txq_£tup
(sc, 
ATH9K_TX_QUEUE_DATA
, i);

356 
sc
->
tx
.
txq_m≠
[
i
]->
mac80211_qnum
 = i;

357 
sc
->
tx
.
txq_max_≥ndög
[
i
] = 
ATH_MAX_QDEPTH
;

360 
	}
}

362 
	$©h9k_öô_misc
(
©h_so·c
 *
sc
)

364 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

365 
i
 = 0;

367 
	`£tup_timî
(&
comm⁄
->
™i
.
timî
, 
©h_™i_ˇlibøã
, ()
sc
);

369 
comm⁄
->
œ°_rssi
 = 
ATH_RSSI_DUMMY_MARKER
;

370 
	`mem˝y
(
comm⁄
->
bssidmask
, 
©h_bˇ°_mac
, 
ETH_ALEN
);

371 
sc
->
bóc⁄
.
¶Ÿtime
 = 
ATH9K_SLOT_TIME_9
;

373 
i
 = 0; i < 
	`ARRAY_SIZE
(
sc
->
bóc⁄
.
b¶Ÿ
); i++)

374 
sc
->
bóc⁄
.
b¶Ÿ
[
i
] = 
NULL
;

376 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
)

377 
sc
->
™t_comb
.
cou¡
 = 
ATH_ANT_DIV_COMB_INIT_COUNT
;

379 
sc
->
•ec_¥iv
.
ah
 = sc->
sc_ah
;

380 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
íabÀd
 = 0;

381 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
sh‹t_ª≥©
 = 
åue
;

382 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
cou¡
 = 8;

383 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
ídÀss
 = 
Ál£
;

384 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
≥riod
 = 0xFF;

385 
sc
->
•ec_¥iv
.
•ec_c⁄fig
.
f·_≥riod
 = 0xF;

386 
	}
}

388 
	$©h9k_öô_pc€m_∂©f‹m
(
©h_so·c
 *
sc
)

390 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

391 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

392 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

394 i‡(!
	`IS_ENABLED
(
CPTCFG_ATH9K_PCOEM
))

397 i‡(
comm⁄
->
bus_›s
->
©h_bus_ty≥
 !
ATH_PCI
)

400 i‡(
sc
->
drivî_d©a
 & (
ATH9K_PCI_CUS198
 |

401 
ATH9K_PCI_CUS230
)) {

402 
ah
->
c⁄fig
.
x a_gpio
 = 9;

403 
ah
->
c⁄fig
.
x©ãn_m¨gö_cfg
 = 
åue
;

404 
ah
->
c⁄fig
.
Æt_mögaöidx
 = 
åue
;

405 
ah
->
c⁄fig
.
™t_˘æ_comm2g_swôch_íabÀ
 = 0x000BBB88;

406 
sc
->
™t_comb
.
low_rssi_thªsh
 = 20;

407 
sc
->
™t_comb
.
Á°_div_büs
 = 3;

409 
	`©h_öfo
(
comm⁄
, "SetÖarameters for %s\n",

410 (
sc
->
drivî_d©a
 & 
ATH9K_PCI_CUS198
) ?

414 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_CUS217
)

415 
	`©h_öfo
(
comm⁄
, "CUS217 card detected\n");

417 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_CUS252
)

418 
	`©h_öfo
(
comm⁄
, "CUS252 card detected\n");

420 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_AR9565_1ANT
)

421 
	`©h_öfo
(
comm⁄
, "WB335 1-ANT card detected\n");

423 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_AR9565_2ANT
)

424 
	`©h_öfo
(
comm⁄
, "WB335 2-ANT card detected\n");

426 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_KILLER
)

427 
	`©h_öfo
(
comm⁄
, "Killer Wireless card detected\n");

435 i‡(
sc
->
drivî_d©a
 & (
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_AR9565_2ANT
)) {

436 i‡(!(
sc
->
drivî_d©a
 & 
ATH9K_PCI_BT_ANT_DIV
))

437 
pC≠
->
hw_ˇps
 &~
ATH9K_HW_CAP_ANT_DIV_COMB
;

440 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_BT_ANT_DIV
) {

441 
pC≠
->
hw_ˇps
 |
ATH9K_HW_CAP_BT_ANT_DIV
;

442 
	`©h_öfo
(
comm⁄
, "Set BT/WLAN RX diversity capability\n");

445 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_D3_L1_WAR
) {

446 
ah
->
c⁄fig
.
pcõ_w´n
 = 0x0040473b;

447 
	`©h_öfo
(
comm⁄
, "Enable WAR for ASPM D3/L1\n");

455 
ah
->
c⁄fig
.
∂l_pwrßve
 = 1;

457 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_NO_PLL_PWRSAVE
) {

458 
ah
->
c⁄fig
.
∂l_pwrßve
 = 0;

459 
	`©h_öfo
(
comm⁄
, "Disable PLL PowerSave\n");

462 i‡(
sc
->
drivî_d©a
 & 
ATH9K_PCI_LED_ACT_HI
)

463 
ah
->
c⁄fig
.
Àd_a˘ive_high
 = 
åue
;

464 
	}
}

466 
	$©h9k_ì¥om_ªque°_cb
(c⁄° 
fúmw¨e
 *
ì¥om_blob
,

467 *
˘x
)

469 
©h9k_ì¥om_˘x
 *
ec
 = 
˘x
;

471 i‡(
ì¥om_blob
)

472 
ec
->
ah
->
ì¥om_blob
 =Éeprom_blob;

474 
	`com∂ëe
(&
ec
->
com∂ëe
);

475 
	}
}

477 
	$©h9k_ì¥om_ªque°
(
©h_so·c
 *
sc
, c⁄° *
«me
)

479 
©h9k_ì¥om_˘x
 
ec
;

480 
©h_hw
 *
ah
 =áh = 
sc
->
sc_ah
;

481 
îr
;

484 
	`öô_com∂ëi⁄
(&
ec
.
com∂ëe
);

485 
ec
.
ah
 = 
sc
->
sc_ah
;

487 
îr
 = 
	`ªque°_fúmw¨e_nowaô
(
THIS_MODULE
, 1, 
«me
, 
sc
->
dev
, 
GFP_KERNEL
,

488 &
ec
, 
©h9k_ì¥om_ªque°_cb
);

489 i‡(
îr
 < 0) {

490 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

492  
îr
;

495 
	`waô_f‹_com∂ëi⁄
(&
ec
.
com∂ëe
);

497 i‡(!
ah
->
ì¥om_blob
) {

498 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

499 "U«bÀÅÿlﬂd EEPROM fûê%s\n", 
«me
);

500  -
EINVAL
;

504 
	}
}

506 
	$©h9k_ì¥om_ªÀa£
(
©h_so·c
 *
sc
)

508 
	`ªÀa£_fúmw¨e
(
sc
->
sc_ah
->
ì¥om_blob
);

509 
	}
}

511 
	$©h9k_öô_soc_∂©f‹m
(
©h_so·c
 *
sc
)

513 
©h9k_∂©f‹m_d©a
 *
pd©a
 = 
sc
->
dev
->
∂©f‹m_d©a
;

514 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

515 
ªt
 = 0;

517 i‡(!
pd©a
)

520 i‡(
pd©a
->
ì¥om_«me
) {

521 
ªt
 = 
	`©h9k_ì¥om_ªque°
(
sc
, 
pd©a
->
ì¥om_«me
);

522 i‡(
ªt
)

523  
ªt
;

526 i‡(
pd©a
->
tx_gaö_bufÁlo
)

527 
ah
->
c⁄fig
.
tx_gaö_bufÁlo
 = 
åue
;

529  
ªt
;

530 
	}
}

532 
	$©h9k_öô_so·c
(
u16
 
devid
, 
©h_so·c
 *
sc
,

533 c⁄° 
©h_bus_›s
 *
bus_›s
)

535 
©h9k_∂©f‹m_d©a
 *
pd©a
 = 
sc
->
dev
->
∂©f‹m_d©a
;

536 
©h_hw
 *
ah
 = 
NULL
;

537 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
;

538 
©h_comm⁄
 *
comm⁄
;

539 
ªt
 = 0, 
i
;

540 
csz
 = 0;

542 
ah
 = 
	`devm_kzÆloc
(
sc
->
dev
, (
©h_hw
), 
GFP_KERNEL
);

543 i‡(!
ah
)

544  -
ENOMEM
;

546 
ah
->
dev
 = 
sc
->dev;

547 
ah
->
hw
 = 
sc
->hw;

548 
ah
->
hw_vîsi⁄
.
devid
 = devid;

549 
ah
->
ªg_›s
.
ªad
 = 
©h9k_i‹ód32
;

550 
ah
->
ªg_›s
.
mu…i_ªad
 = 
©h9k_mu…i_i‹ód32
;

551 
ah
->
ªg_›s
.
wrôe
 = 
©h9k_iowrôe32
;

552 
ah
->
ªg_›s
.
rmw
 = 
©h9k_ªg_rmw
;

553 
pC≠
 = &
ah
->
ˇps
;

555 
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

558 
	`£t_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

560 
sc
->
sc_ah
 = 
ah
;

561 
sc
->
dfs_dëe˘‹
 = 
	`dfs_∑âîn_dëe˘‹_öô
(
comm⁄
, 
NL80211_DFS_UNSET
);

562 
sc
->
tx99_powî
 = 
MAX_RATE_POWER
 + 1;

563 
	`öô_waôqueue_hód
(&
sc
->
tx_waô
);

564 
sc
->
cur_ch™
 = &sc->
ch™˘x
[0];

565 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

566 
sc
->
cur_ch™
->
hw_queue_ba£
 = 0;

568 i‡(!
pd©a
 ||Öd©a->
u£_ì¥om
) {

569 
ah
->
ah_Êags
 |
AH_USE_EEPROM
;

570 
sc
->
sc_ah
->
Àd_pö
 = -1;

572 
sc
->
sc_ah
->
gpio_mask
 = 
pd©a
->gpio_mask;

573 
sc
->
sc_ah
->
gpio_vÆ
 = 
pd©a
->gpio_val;

574 
sc
->
sc_ah
->
Àd_pö
 = 
pd©a
->led_pin;

575 
ah
->
is_˛k_25mhz
 = 
pd©a
->is_clk_25mhz;

576 
ah
->
gë_mac_ªvisi⁄
 = 
pd©a
->get_mac_revision;

577 
ah
->
exã∫Æ_ª£t
 = 
pd©a
->external_reset;

578 
ah
->
dißbÀ_2ghz
 = 
pd©a
->disable_2ghz;

579 
ah
->
dißbÀ_5ghz
 = 
pd©a
->disable_5ghz;

580 
ah
->
c⁄fig
.
Àd_a˘ive_high
 = 
pd©a
->led_active_high;

581 i‡(!
pd©a
->
ídün_check
)

582 
ah
->
ah_Êags
 |
AH_NO_EEP_SWAP
;

585 
comm⁄
->
›s
 = &
ah
->
ªg_›s
;

586 
comm⁄
->
bus_›s
 = bus_ops;

587 
comm⁄
->
ps_›s
 = &
©h9k_ps_›s
;

588 
comm⁄
->
ah
 =áh;

589 
comm⁄
->
hw
 = 
sc
->hw;

590 
comm⁄
->
¥iv
 = 
sc
;

591 
comm⁄
->
debug_mask
 = 
©h9k_debug
;

592 
comm⁄
->
btc€x_íabÀd
 = 
©h9k_btc€x_íabÀ
 == 1;

593 
comm⁄
->
dißbÀ_™i
 = 
Ál£
;

598 
	`©h9k_öô_pc€m_∂©f‹m
(
sc
);

600 
ªt
 = 
	`©h9k_öô_soc_∂©f‹m
(
sc
);

601 i‡(
ªt
)

602  
ªt
;

611 i‡(!
comm⁄
->
btc€x_íabÀd
 && 
©h9k_bt_™t_divîsôy
 &&

612 (
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_BT_ANT_DIV
))

613 
comm⁄
->
bt_™t_divîsôy
 = 1;

615 
	`•ö_lock_öô
(&
comm⁄
->
cc_lock
);

616 
	`•ö_lock_öô
(&
sc
->
sc_£rül_rw
);

617 
	`•ö_lock_öô
(&
sc
->
sc_pm_lock
);

618 
	`•ö_lock_öô
(&
sc
->
ch™_lock
);

619 
	`muãx_öô
(&
sc
->
muãx
);

620 
	`èskÀt_öô
(&
sc
->
öå_tq
, 
©h9k_èskÀt
, ()sc);

621 
	`èskÀt_öô
(&
sc
->
bc⁄_èskÀt
, 
©h9k_bóc⁄_èskÀt
,

622 ()
sc
);

624 
	`£tup_timî
(&
sc
->
¶ìp_timî
, 
©h_ps_fuŒ_¶ìp
, ()sc);

625 
	`INIT_WORK
(&
sc
->
hw_ª£t_w‹k
, 
©h_ª£t_w‹k
);

626 
	`INIT_WORK
(&
sc
->
∑¥d_w‹k
, 
©h_∑¥d_ˇlibøã
);

627 
	`INIT_DELAYED_WORK
(&
sc
->
hw_∂l_w‹k
, 
©h_hw_∂l_w‹k
);

629 
	`©h9k_öô_ch™√l_c⁄ãxt
(
sc
);

635 
	`©h_ªad_ˇchesize
(
comm⁄
, &
csz
);

636 
comm⁄
->
ˇchñsz
 = 
csz
 << 2;

639 
ªt
 = 
	`©h9k_hw_öô
(
ah
);

640 i‡(
ªt
)

641 
îr_hw
;

643 i‡(
pd©a
 &&Öd©a->
maˇddr
)

644 
	`mem˝y
(
comm⁄
->
maˇddr
, 
pd©a
->maˇddr, 
ETH_ALEN
);

646 
ªt
 = 
	`©h9k_öô_queues
(
sc
);

647 i‡(
ªt
)

648 
îr_queues
;

650 
ªt
 = 
	`©h9k_öô_btc€x
(
sc
);

651 i‡(
ªt
)

652 
îr_btc€x
;

654 
ªt
 = 
	`©h9k_cmn_öô_ch™√ls_øãs
(
comm⁄
);

655 i‡(
ªt
)

656 
îr_btc€x
;

658 
ªt
 = 
	`©h9k_öô_p2p
(
sc
);

659 i‡(
ªt
)

660 
îr_btc€x
;

662 
	`©h9k_cmn_öô_¸y±o
(
sc
->
sc_ah
);

663 
	`©h9k_öô_misc
(
sc
);

664 
	`©h_fûl_Àd_pö
(
sc
);

665 
	`©h_ch™˘x_öô
(
sc
);

666 
	`©h9k_offch™√l_öô
(
sc
);

668 i‡(
comm⁄
->
bus_›s
->
a•m_öô
)

669 
comm⁄
->
bus_›s
->
	`a•m_öô
(common);

673 
îr_btc€x
:

674 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++)

675 i‡(
	`ATH_TXQ_SETUP
(
sc
, 
i
))

676 
	`©h_tx_˛ónupq
(
sc
, &sc->
tx
.
txq
[
i
]);

677 
îr_queues
:

678 
	`©h9k_hw_deöô
(
ah
);

679 
îr_hw
:

680 
	`©h9k_ì¥om_ªÀa£
(
sc
);

681 
	`dev_k‰ì_skb_™y
(
sc
->
tx99_skb
);

682  
ªt
;

683 
	}
}

685 
	$©h9k_öô_b™d_txpowî
(
©h_so·c
 *
sc
, 
b™d
)

687 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

688 
õì80211_ch™√l
 *
ch™
;

689 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

690 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

691 
cfg80211_ch™_def
 
ch™def
;

692 
i
;

694 
sb™d
 = &
comm⁄
->
sb™ds
[
b™d
];

695 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

696 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

697 
ah
->
curch™
 = &ah->
ch™√ls
[
ch™
->
hw_vÆue
];

698 
	`cfg80211_ch™def_¸óã
(&
ch™def
, 
ch™
, 
NL80211_CHAN_HT20
);

699 
	`©h9k_cmn_gë_ch™√l
(
sc
->
hw
, 
ah
, &
ch™def
);

700 
	`©h9k_hw_£t_txpowîlimô
(
ah
, 
MAX_RATE_POWER
, 
åue
);

702 
	}
}

704 
	$©h9k_öô_txpowî_limôs
(
©h_so·c
 *
sc
)

706 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

707 
©h9k_ch™√l
 *
curch™
 = 
ah
->curchan;

709 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_2GHZ
)

710 
	`©h9k_öô_b™d_txpowî
(
sc
, 
IEEE80211_BAND_2GHZ
);

711 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_5GHZ
)

712 
	`©h9k_öô_b™d_txpowî
(
sc
, 
IEEE80211_BAND_5GHZ
);

714 i‡(
curch™
)

715 
ah
->
curch™
 = curchan;

716 
	}
}

718 c⁄° 
õì80211_iÁ˚_limô
 
	gif_limôs
[] = {

719 { .
max
 = 2048, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
) },

720 { .
	gmax
 = 8, .
	gty≥s
 =

721 #ifde‡
CPTCFG_MAC80211_MESH


722 
BIT
(
NL80211_IFTYPE_MESH_POINT
) |

724 
BIT
(
NL80211_IFTYPE_AP
) },

725 { .
	gmax
 = 1, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

726 
BIT
(
NL80211_IFTYPE_P2P_GO
) },

727 { .
	gmax
 = 1, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_ADHOC
) },

730 c⁄° 
õì80211_iÁ˚_limô
 
	gwds_limôs
[] = {

731 { .
max
 = 2048, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_WDS
) },

734 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


736 c⁄° 
õì80211_iÁ˚_limô
 
	gif_limôs_mu…i
[] = {

737 { .
max
 = 2, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
) |

738 
BIT
(
NL80211_IFTYPE_AP
) |

739 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

740 
BIT
(
NL80211_IFTYPE_P2P_GO
) },

741 { .
	gmax
 = 1, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_ADHOC
) },

742 { .
	gmax
 = 1, .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_DEVICE
) },

745 c⁄° 
õì80211_iÁ˚_combö©i⁄
 
	gif_comb_mu…i
[] = {

747 .
limôs
 = 
if_limôs_mu…i
,

748 .
	gn_limôs
 = 
ARRAY_SIZE
(
if_limôs_mu…i
),

749 .
	gmax_öãrÁ˚s
 = 3,

750 .
	gnum_dif„ª¡_ch™√ls
 = 2,

751 .
	gbóc⁄_öt_ö‰a_m©ch
 = 
åue
,

757 c⁄° 
õì80211_iÁ˚_combö©i⁄
 
	gif_comb
[] = {

759 .
limôs
 = 
if_limôs
,

760 .
	gn_limôs
 = 
ARRAY_SIZE
(
if_limôs
),

761 .
	gmax_öãrÁ˚s
 = 2048,

762 .
	gnum_dif„ª¡_ch™√ls
 = 1,

763 .
	gbóc⁄_öt_ö‰a_m©ch
 = 
åue
,

764 #ifde‡
CPTCFG_ATH9K_DFS_CERTIFIED


765 .
	gød¨_dëe˘_widths
 = 
BIT
(
NL80211_CHAN_WIDTH_20_NOHT
) |

766 
BIT
(
NL80211_CHAN_WIDTH_20
) |

767 
BIT
(
NL80211_CHAN_WIDTH_40
),

771 .
	glimôs
 = 
wds_limôs
,

772 .
	gn_limôs
 = 
ARRAY_SIZE
(
wds_limôs
),

773 .
	gmax_öãrÁ˚s
 = 2048,

774 .
	gnum_dif„ª¡_ch™√ls
 = 1,

775 .
	gbóc⁄_öt_ö‰a_m©ch
 = 
åue
,

779 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


780 
	$©h9k_£t_mcc_ˇ∑b
(
©h_so·c
 *
sc
, 
õì80211_hw
 *
hw
)

782 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

783 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

785 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

788 
	`õì80211_hw_£t
(
hw
, 
QUEUE_CONTROL
);

789 
hw
->
queues
 = 
ATH9K_NUM_TX_QUEUES
;

790 
hw
->
offch™√l_tx_hw_queue
 = hw->
queues
 - 1;

791 
hw
->
wùhy
->
öãrÁ˚_modes
 &~ 
	`BIT
(
NL80211_IFTYPE_WDS
);

792 
hw
->
wùhy
->
iÁ˚_combö©i⁄s
 = 
if_comb_mu…i
;

793 
hw
->
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(
if_comb_mu…i
);

794 
hw
->
wùhy
->
max_sˇn_ssids
 = 255;

795 
hw
->
wùhy
->
max_sˇn_õ_Àn
 = 
IEEE80211_MAX_DATA_LEN
;

796 
hw
->
wùhy
->
max_ªmaö_⁄_ch™√l_duøti⁄
 = 10000;

797 
hw
->
ch™˘x_d©a_size
 = (*);

798 
hw
->
exåa_bóc⁄_èûroom
 =

799 (
õì80211_p2p_nﬂ_©å
) + 9;

801 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "Use channel contexts\n");

802 
	}
}

805 
	$©h9k_£t_hw_ˇ∑b
(
©h_so·c
 *
sc
, 
õì80211_hw
 *
hw
)

807 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

808 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

810 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_HT_CCK_RATES
);

811 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_RC_TABLE
);

812 
	`õì80211_hw_£t
(
hw
, 
REPORTS_TX_ACK_STATUS
);

813 
	`õì80211_hw_£t
(
hw
, 
SPECTRUM_MGMT
);

814 
	`õì80211_hw_£t
(
hw
, 
PS_NULLFUNC_STACK
);

815 
	`õì80211_hw_£t
(
hw
, 
SIGNAL_DBM
);

816 
	`õì80211_hw_£t
(
hw
, 
RX_INCLUDES_FCS
);

817 
	`õì80211_hw_£t
(
hw
, 
HOST_BROADCAST_PS_BUFFERING
);

818 
	`õì80211_hw_£t
(
hw
, 
SUPPORT_FAST_XMIT
);

819 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_CLONED_SKBS
);

821 i‡(
©h9k_ps_íabÀ
)

822 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_PS
);

824 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_HT
) {

825 
	`õì80211_hw_£t
(
hw
, 
AMPDU_AGGREGATION
);

827 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

828 
hw
->
ødiŸ≠_mcs_dëaûs
 |=

829 
IEEE80211_RADIOTAP_MCS_HAVE_STBC
;

832 i‡(
	`AR_SREV_9160_10_OR_LATER
(
sc
->
sc_ah
Ë|| 
©h9k_mod∑øm_nohw¸y±
)

833 
	`õì80211_hw_£t
(
hw
, 
MFP_CAPABLE
);

835 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_ACTIVE_MONITOR
 |

836 
NL80211_FEATURE_AP_MODE_CHAN_WIDTH_CHANGE
 |

837 
NL80211_FEATURE_P2P_GO_CTWIN
;

839 i‡(!
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
)) {

840 
hw
->
wùhy
->
öãrÁ˚_modes
 =

841 
	`BIT
(
NL80211_IFTYPE_P2P_GO
) |

842 
	`BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

843 
	`BIT
(
NL80211_IFTYPE_AP
) |

844 
	`BIT
(
NL80211_IFTYPE_STATION
) |

845 
	`BIT
(
NL80211_IFTYPE_ADHOC
) |

846 
	`BIT
(
NL80211_IFTYPE_MESH_POINT
) |

847 
	`BIT
(
NL80211_IFTYPE_WDS
) |

848 
	`BIT
(
NL80211_IFTYPE_OCB
);

850 i‡(
	`©h9k_is_ch™˘x_íabÀd
())

851 
hw
->
wùhy
->
öãrÁ˚_modes
 |=

852 
	`BIT
(
NL80211_IFTYPE_P2P_DEVICE
);

854 
hw
->
wùhy
->
iÁ˚_combö©i⁄s
 = 
if_comb
;

855 
hw
->
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(
if_comb
);

858 
hw
->
wùhy
->
Êags
 &~
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

860 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_IBSS_RSN
;

861 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_TDLS
;

862 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL
;

863 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_5_10_MHZ
;

864 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_HAS_CHANNEL_SWITCH
;

865 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_AP_UAPSD
;

867 
hw
->
queues
 = 4;

868 
hw
->
max_øãs
 = 4;

869 
hw
->
max_li°í_öãrvÆ
 = 10;

870 
hw
->
max_øã_åõs
 = 10;

871 
hw
->
°a_d©a_size
 = (
©h_node
);

872 
hw
->
vif_d©a_size
 = (
©h_vif
);

873 
hw
->
exåa_tx_hódroom
 = 4;

875 
hw
->
wùhy
->
avaûabÀ_™ã¬as_rx
 = 
	`BIT
(
ah
->
ˇps
.
max_rxchaös
) - 1;

876 
hw
->
wùhy
->
avaûabÀ_™ã¬as_tx
 = 
	`BIT
(
ah
->
ˇps
.
max_txchaös
) - 1;

879 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
)

880 
hw
->
wùhy
->
avaûabÀ_™ã¬as_rx
 = 
	`BIT
(0) | BIT(1);

882 
sc
->
™t_rx
 = 
hw
->
wùhy
->
avaûabÀ_™ã¬as_rx
;

883 
sc
->
™t_tx
 = 
hw
->
wùhy
->
avaûabÀ_™ã¬as_tx
;

885 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_2GHZ
)

886 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
] =

887 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_2GHZ
];

888 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_5GHZ
)

889 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_5GHZ
] =

890 &
comm⁄
->
sb™ds
[
IEEE80211_BAND_5GHZ
];

892 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


893 
	`©h9k_£t_mcc_ˇ∑b
(
sc
, 
hw
);

895 
	`©h9k_öô_wow
(
hw
);

896 
	`©h9k_cmn_ªlﬂd_chaömask
(
ah
);

898 
	`SET_IEEE80211_PERM_ADDR
(
hw
, 
comm⁄
->
maˇddr
);

899 
	}
}

901 
	$©h_gë_öôül_íå›y
(
©h_so·c
 *
sc
)

903 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

904 
buf
[256];

907 
	`©h9k_hw_ª£t
(
ah
,áh->
curch™
, 
NULL
, 
Ál£
);

909 
	`©h9k_hw_gë_adc_íå›y
(
ah
, 
buf
, (buf));

910 
	`add_devi˚_øndom√ss
(
buf
, (buf));

911 
	}
}

913 
	$©h9k_öô_devi˚
(
u16
 
devid
, 
©h_so·c
 *
sc
,

914 c⁄° 
©h_bus_›s
 *
bus_›s
)

916 
õì80211_hw
 *
hw
 = 
sc
->hw;

917 
©h_comm⁄
 *
comm⁄
;

918 
©h_hw
 *
ah
;

919 
îr‹
 = 0;

920 
©h_ªguœt‹y
 *
ªg
;

923 
îr‹
 = 
	`©h9k_öô_so·c
(
devid
, 
sc
, 
bus_›s
);

924 i‡(
îr‹
)

925  
îr‹
;

927 
ah
 = 
sc
->
sc_ah
;

928 
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

929 
	`©h9k_£t_hw_ˇ∑b
(
sc
, 
hw
);

932 
îr‹
 = 
	`©h_ªgd_öô
(&
comm⁄
->
ªguœt‹y
, 
sc
->
hw
->
wùhy
,

933 
©h9k_ªg_nŸifõr
);

934 i‡(
îr‹
)

935 
deöô
;

937 
ªg
 = &
comm⁄
->
ªguœt‹y
;

940 
îr‹
 = 
	`©h_tx_öô
(
sc
, 
ATH_TXBUF
);

941 i‡(
îr‹
 != 0)

942 
deöô
;

945 
îr‹
 = 
	`©h_rx_öô
(
sc
, 
ATH_RXBUF
);

946 i‡(
îr‹
 != 0)

947 
deöô
;

949 
	`©h9k_öô_txpowî_limôs
(
sc
);

951 #ifde‡
CPTCFG_MAC80211_LEDS


953 
sc
->
Àd_deÁu…_åiggî
 = 
	`õì80211_¸óã_çt_Àd_åiggî
(sc->
hw
,

954 
IEEE80211_TPT_LEDTRIG_FL_RADIO
, 
©h9k_çt_blök
,

955 
	`ARRAY_SIZE
(
©h9k_çt_blök
));

958 
	`©h_gë_öôül_íå›y
(
sc
);

961 
îr‹
 = 
	`õì80211_ªgi°î_hw
(
hw
);

962 i‡(
îr‹
)

963 
rx_˛ónup
;

965 
îr‹
 = 
	`©h9k_öô_debug
(
ah
);

966 i‡(
îr‹
) {

967 
	`©h_îr
(
comm⁄
, "UnableÅo create debugfs files\n");

968 
uƒegi°î
;

972 i‡(!
	`©h_is_w‹ld_ªgd
(
ªg
)) {

973 
îr‹
 = 
	`ªguœt‹y_höt
(
hw
->
wùhy
, 
ªg
->
Æpha2
);

974 i‡(
îr‹
)

975 
debug_˛ónup
;

978 
	`©h_öô_Àds
(
sc
);

979 
	`©h_°¨t_rfkûl_pﬁl
(
sc
);

983 
debug_˛ónup
:

984 
	`©h9k_deöô_debug
(
sc
);

985 
uƒegi°î
:

986 
	`õì80211_uƒegi°î_hw
(
hw
);

987 
rx_˛ónup
:

988 
	`©h_rx_˛ónup
(
sc
);

989 
deöô
:

990 
	`©h9k_deöô_so·c
(
sc
);

991  
îr‹
;

992 
	}
}

998 
	$©h9k_deöô_so·c
(
©h_so·c
 *
sc
)

1000 
i
 = 0;

1002 
	`©h9k_deöô_p2p
(
sc
);

1003 
	`©h9k_deöô_btc€x
(
sc
);

1005 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++)

1006 i‡(
	`ATH_TXQ_SETUP
(
sc
, 
i
))

1007 
	`©h_tx_˛ónupq
(
sc
, &sc->
tx
.
txq
[
i
]);

1009 
	`dñ_timî_sync
(&
sc
->
¶ìp_timî
);

1010 
	`©h9k_hw_deöô
(
sc
->
sc_ah
);

1011 i‡(
sc
->
dfs_dëe˘‹
 !
NULL
)

1012 
sc
->
dfs_dëe˘‹
->
	`exô
(sc->dfs_detector);

1014 
	`©h9k_ì¥om_ªÀa£
(
sc
);

1015 
	}
}

1017 
	$©h9k_deöô_devi˚
(
©h_so·c
 *
sc
)

1019 
õì80211_hw
 *
hw
 = 
sc
->hw;

1021 
	`©h9k_ps_wakeup
(
sc
);

1023 
	`wùhy_rfkûl_°›_pﬁlög
(
sc
->
hw
->
wùhy
);

1024 
	`©h_deöô_Àds
(
sc
);

1026 
	`©h9k_ps_ª°‹e
(
sc
);

1028 
	`©h9k_deöô_debug
(
sc
);

1029 
	`©h9k_deöô_wow
(
hw
);

1030 
	`õì80211_uƒegi°î_hw
(
hw
);

1031 
	`©h_rx_˛ónup
(
sc
);

1032 
	`©h9k_deöô_so·c
(
sc
);

1033 
	}
}

1039 
__öô
 
	$©h9k_öô
()

1041 
îr‹
;

1043 
îr‹
 = 
	`©h_ahb_öô
();

1044 i‡(
îr‹
 < 0) {

1045 
îr‹
 = -
ENODEV
;

1046 
îr_out
;

1049 
îr‹
 = 
	`©h_pci_öô
();

1050 i‡(
îr‹
 < 0) {

1051 
	`¥_îr
("No PCI devices found, driverÇot installed\n");

1052 
îr‹
 = -
ENODEV
;

1053 
îr_ahb_exô
;

1058 
îr_ahb_exô
:

1059 
	`©h_ahb_exô
();

1060 
îr_out
:

1061  
îr‹
;

1062 
	}
}

1063 
moduÀ_öô
(
©h9k_öô
);

1065 
__exô
 
	$©h9k_exô
()

1067 
is_©h9k_u∆ﬂded
 = 
åue
;

1068 
	`©h_ahb_exô
();

1069 
	`©h_pci_exô
();

1070 
	`¥_öfo
("%s: Drivî u∆ﬂded\n", 
dev_öfo
);

1071 
	}
}

1072 
moduÀ_exô
(
©h9k_exô
);

	@link.c

17 
	~"©h9k.h
"

23 
	$©h_tx_com∂ëe_pﬁl_w‹k
(
w‹k_°ru˘
 *
w‹k
)

25 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ath_softc,

26 
tx_com∂ëe_w‹k
.
w‹k
);

27 
©h_txq
 *
txq
;

28 
i
;

29 
boﬁ
 
√edª£t
 = 
Ál£
;

32 i‡(
sc
->
tx99_°©e
) {

33 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
RESET
,

38 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

39 
txq
 = 
sc
->
tx
.
txq_m≠
[
i
];

41 
	`©h_txq_lock
(
sc
, 
txq
);

42 i‡(
txq
->
axq_dïth
) {

43 i‡(
txq
->
axq_tx_ö¥ogªss
) {

44 
√edª£t
 = 
åue
;

45 
	`©h_txq_u∆ock
(
sc
, 
txq
);

48 
txq
->
axq_tx_ö¥ogªss
 = 
åue
;

51 
	`©h_txq_u∆ock
(
sc
, 
txq
);

54 i‡(
√edª£t
) {

55 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
RESET
,

57 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_TX_HANG
);

61 
	`õì80211_queue_dñayed_w‹k
(
sc
->
hw
, &sc->
tx_com∂ëe_w‹k
,

62 
	`m£cs_to_jiffõs
(
ATH_TX_COMPLETE_POLL_INT
));

63 
	}
}

68 
boﬁ
 
	$©h_hw_check
(
©h_so·c
 *
sc
)

70 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

71 
©h_ª£t_ty≥
 
ty≥
;

72 
boﬁ
 
is_Æive
;

74 
	`©h9k_ps_wakeup
(
sc
);

76 
is_Æive
 = 
	`©h9k_hw_check_Æive
(
sc
->
sc_ah
);

78 i‡(!
is_Æive
) {

79 
	`©h_dbg
(
comm⁄
, 
RESET
,

81 
ty≥
 = 
RESET_TYPE_MAC_HANG
;

82 
	`©h9k_queue_ª£t
(
sc
, 
ty≥
);

85 
	`©h9k_ps_ª°‹e
(
sc
);

87  
is_Æive
;

88 
	}
}

93 
boﬁ
 
	$©h_hw_∂l_rx_h™g_check
(
©h_so·c
 *
sc
, 
u32
 
∂l_sqsum
)

95 
cou¡
;

96 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

98 i‡(
∂l_sqsum
 >= 0x40000) {

99 
cou¡
++;

100 i‡(
cou¡
 == 3) {

101 
	`©h_dbg
(
comm⁄
, 
RESET
, "PLL WAR,ÑesettingÅhe chip\n");

102 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_PLL_HANG
);

103 
cou¡
 = 0;

104  
åue
;

107 
cou¡
 = 0;

110  
Ál£
;

111 
	}
}

113 
	$©h_hw_∂l_w‹k
(
w‹k_°ru˘
 *
w‹k
)

115 
u32
 
∂l_sqsum
;

116 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ath_softc,

117 
hw_∂l_w‹k
.
w‹k
);

118 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

125 i‡(!
	`ã°_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
))

128 i‡(
sc
->
tx99_°©e
)

131 
	`©h9k_ps_wakeup
(
sc
);

132 
∂l_sqsum
 = 
	`¨9003_gë_∂l_sqsum_dvc
(
sc
->
sc_ah
);

133 
	`©h9k_ps_ª°‹e
(
sc
);

134 i‡(
	`©h_hw_∂l_rx_h™g_check
(
sc
, 
∂l_sqsum
))

137 
	`õì80211_queue_dñayed_w‹k
(
sc
->
hw
, &sc->
hw_∂l_w‹k
,

138 
	`m£cs_to_jiffõs
(
ATH_PLL_WORK_INTERVAL
));

139 
	}
}

144 
	$©h_∑¥d_a˘iv©e
(
©h_so·c
 *
sc
)

146 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

147 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

148 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

149 
chaö
;

151 i‡(!
ˇld©a
 || !
	`ã°_bô
(
PAPRD_DONE
, &ˇld©a->
ˇl_Êags
)) {

152 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "FailedÅoáctivate PAPRD\n");

156 
	`¨9003_∑¥d_íabÀ
(
ah
, 
Ál£
);

157 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

158 i‡(!(
ah
->
txchaömask
 & 
	`BIT
(
chaö
)))

161 
	`¨9003_∑¥d_p›uœã_sögÀ_èbÀ
(
ah
, 
ˇld©a
, 
chaö
);

164 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Activating PAPRD\n");

165 
	`¨9003_∑¥d_íabÀ
(
ah
, 
åue
);

166 
	}
}

168 
boﬁ
 
	$©h_∑¥d_£nd_‰ame
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
, 
chaö
)

170 
õì80211_hw
 *
hw
 = 
sc
->hw;

171 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

172 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

173 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

174 
©h_tx_c⁄åﬁ
 
tx˘l
;

175 
time_À·
;

177 
	`mem£t
(&
tx˘l
, 0, (txctl));

178 
tx˘l
.
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_BE
];

180 
	`mem£t
(
tx_öfo
, 0, (*tx_info));

181 
tx_öfo
->
b™d
 = 
sc
->
cur_ch™def
.
ch™
->band;

182 
tx_öfo
->
Êags
 |
IEEE80211_TX_CTL_NO_ACK
;

183 
tx_öfo
->
c⁄åﬁ
.
øãs
[0].
idx
 = 0;

184 
tx_öfo
->
c⁄åﬁ
.
øãs
[0].
cou¡
 = 1;

185 
tx_öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 = 
IEEE80211_TX_RC_MCS
;

186 
tx_öfo
->
c⁄åﬁ
.
øãs
[1].
idx
 = -1;

188 
	`öô_com∂ëi⁄
(&
sc
->
∑¥d_com∂ëe
);

189 
tx˘l
.
∑¥d
 = 
	`BIT
(
chaö
);

191 i‡(
	`©h_tx_°¨t
(
hw
, 
skb
, &
tx˘l
) != 0) {

192 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "PAPRD TX failed\n");

193 
	`dev_k‰ì_skb_™y
(
skb
);

194  
Ál£
;

197 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
sc
->
∑¥d_com∂ëe
,

198 
	`m£cs_to_jiffõs
(
ATH_PAPRD_TIMEOUT
));

200 i‡(!
time_À·
)

201 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

203 
chaö
);

205  !!
time_À·
;

206 
	}
}

208 
	$©h_∑¥d_ˇlibøã
(
w‹k_°ru˘
 *
w‹k
)

210 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ©h_so·c, 
∑¥d_w‹k
);

211 
õì80211_hw
 *
hw
 = 
sc
->hw;

212 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

213 
õì80211_hdr
 *
hdr
;

214 
sk_buff
 *
skb
 = 
NULL
;

215 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
ah
->caldata;

216 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

217 
·y≥
;

218 
chaö_ok
 = 0;

219 
chaö
;

220 
Àn
 = 1800;

221 
ªt
;

223 i‡(!
ˇld©a
 ||

224 !
	`ã°_bô
(
PAPRD_PACKET_SENT
, &
ˇld©a
->
ˇl_Êags
) ||

225 
	`ã°_bô
(
PAPRD_DONE
, &
ˇld©a
->
ˇl_Êags
)) {

226 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
, "Skipping PAPRD calibration\n");

230 
	`©h9k_ps_wakeup
(
sc
);

232 i‡(
	`¨9003_∑¥d_öô_èbÀ
(
ah
) < 0)

233 
Áû_∑¥d
;

235 
skb
 = 
	`Æloc_skb
(
Àn
, 
GFP_KERNEL
);

236 i‡(!
skb
)

237 
Áû_∑¥d
;

239 
	`skb_put
(
skb
, 
Àn
);

240 
	`mem£t
(
skb
->
d©a
, 0, 
Àn
);

241 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

242 
·y≥
 = 
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_NULLFUNC
;

243 
hdr
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
·y≥
);

244 
hdr
->
duøti⁄_id
 = 
	`˝u_to_À16
(10);

245 
	`mem˝y
(
hdr
->
addr1
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

246 
	`mem˝y
(
hdr
->
addr2
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

247 
	`mem˝y
(
hdr
->
addr3
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

249 
chaö
 = 0; chaö < 
AR9300_MAX_CHAINS
; chain++) {

250 i‡(!(
ah
->
txchaömask
 & 
	`BIT
(
chaö
)))

253 
chaö_ok
 = 0;

254 
	`¨9003_∑¥d_£tup_gaö_èbÀ
(
ah
, 
chaö
);

256 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

257 "Sídög PAPRDÅøöög fømê⁄ chaö %d\n", 
chaö
);

258 i‡(!
	`©h_∑¥d_£nd_‰ame
(
sc
, 
skb
, 
chaö
))

259 
Áû_∑¥d
;

261 i‡(!
	`¨9003_∑¥d_is_d⁄e
(
ah
)) {

262 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

263 "PAPRDÇŸ yë d⁄ê⁄ chaö %d\n", 
chaö
);

267 
ªt
 = 
	`¨9003_∑¥d_¸óã_curve
(
ah
, 
ˇld©a
, 
chaö
);

268 i‡(
ªt
 =-
EINPROGRESS
) {

269 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

271 
chaö
);

273 } i‡(
ªt
) {

274 
	`©h_dbg
(
comm⁄
, 
CALIBRATE
,

276 
chaö
);

280 
chaö_ok
 = 1;

282 
	`k‰ì_skb
(
skb
);

284 i‡(
chaö_ok
) {

285 
	`£t_bô
(
PAPRD_DONE
, &
ˇld©a
->
ˇl_Êags
);

286 
	`©h_∑¥d_a˘iv©e
(
sc
);

289 
Áû_∑¥d
:

290 
	`©h9k_ps_ª°‹e
(
sc
);

291 
	}
}

300 
	$©h_™i_ˇlibøã
(
d©a
)

302 
©h_so·c
 *
sc
 = (©h_so·¯*)
d©a
;

303 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

304 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

305 
boﬁ
 
l⁄gˇl
 = 
Ál£
;

306 
boﬁ
 
sh‹tˇl
 = 
Ál£
;

307 
boﬁ
 
™iÊag
 = 
Ál£
;

308 
time°amp
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

309 
u32
 
ˇl_öãrvÆ
, 
sh‹t_ˇl_öãrvÆ
, 
l⁄g_ˇl_öãrvÆ
;

310 
Êags
;

312 i‡(
ah
->
ˇld©a
 && 
	`ã°_bô
(
NFCAL_INTF
, &ah->ˇld©a->
ˇl_Êags
))

313 
l⁄g_ˇl_öãrvÆ
 = 
ATH_LONG_CALINTERVAL_INT
;

315 
l⁄g_ˇl_öãrvÆ
 = 
ATH_LONG_CALINTERVAL
;

317 
sh‹t_ˇl_öãrvÆ
 = (
ah
->
›mode
 =
NL80211_IFTYPE_AP
) ?

318 
ATH_AP_SHORT_CALINTERVAL
 : 
ATH_STA_SHORT_CALINTERVAL
;

321 i‡(
sc
->
sc_ah
->
powî_mode
 !
ATH9K_PM_AWAKE
) {

322 i‡(++
ah
->
™i_skù_cou¡
 >
ATH_ANI_MAX_SKIP_COUNT
) {

323 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

324 
sc
->
ps_Êags
 |
PS_WAIT_FOR_ANI
;

325 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

327 
£t_timî
;

329 
ah
->
™i_skù_cou¡
 = 0;

330 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

331 
sc
->
ps_Êags
 &~
PS_WAIT_FOR_ANI
;

332 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

334 
	`©h9k_ps_wakeup
(
sc
);

337 i‡((
time°amp
 - 
comm⁄
->
™i
.
l⁄gˇl_timî
Ë>
l⁄g_ˇl_öãrvÆ
) {

338 
l⁄gˇl
 = 
åue
;

339 
comm⁄
->
™i
.
l⁄gˇl_timî
 = 
time°amp
;

343 i‡(!
comm⁄
->
™i
.
ˇld⁄e
) {

344 i‡((
time°amp
 - 
comm⁄
->
™i
.
sh‹tˇl_timî
Ë>
sh‹t_ˇl_öãrvÆ
) {

345 
sh‹tˇl
 = 
åue
;

346 
comm⁄
->
™i
.
sh‹tˇl_timî
 = 
time°amp
;

347 
comm⁄
->
™i
.
ª£tˇl_timî
 = 
time°amp
;

350 i‡((
time°amp
 - 
comm⁄
->
™i
.
ª£tˇl_timî
) >=

351 
ATH_RESTART_CALINTERVAL
) {

352 
comm⁄
->
™i
.
ˇld⁄e
 = 
	`©h9k_hw_ª£t_ˇlvÆid
(
ah
);

353 i‡(
comm⁄
->
™i
.
ˇld⁄e
)

354 
comm⁄
->
™i
.
ª£tˇl_timî
 = 
time°amp
;

359 i‡((
time°amp
 - 
comm⁄
->
™i
.
check™i_timî
Ë>
ah
->
c⁄fig
.
™i_pﬁl_öãrvÆ
) {

360 
™iÊag
 = 
åue
;

361 
comm⁄
->
™i
.
check™i_timî
 = 
time°amp
;

365 i‡(
™iÊag
) {

366 
	`•ö_lock
(&
comm⁄
->
cc_lock
);

367 
	`©h9k_hw_™i_m⁄ô‹
(
ah
,áh->
curch™
);

368 
	`©h_upd©e_survey_°©s
(
sc
);

369 
	`•ö_u∆ock
(&
comm⁄
->
cc_lock
);

373 i‡(
l⁄gˇl
 || 
sh‹tˇl
) {

374 
ªt
 = 
	`©h9k_hw_ˇlibøã
(
ah
,áh->
curch™
,áh->
rxchaömask
,

375 
l⁄gˇl
);

376 i‡(
ªt
 < 0) {

377 
comm⁄
->
™i
.
ˇld⁄e
 = 0;

378 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_CALIBRATION
);

382 
comm⁄
->
™i
.
ˇld⁄e
 = 
ªt
;

385 
	`©h_dbg
(
comm⁄
, 
ANI
,

387 
jiffõs
,

388 
l⁄gˇl
 ? "l⁄g" : "", 
sh‹tˇl
 ? "short" : "",

389 
™iÊag
 ? "™i" : "", 
comm⁄
->
™i
.
ˇld⁄e
 ? "true" : "false");

391 
	`©h9k_ps_ª°‹e
(
sc
);

393 
£t_timî
:

399 
ˇl_öãrvÆ
 = 
ATH_LONG_CALINTERVAL
;

400 
ˇl_öãrvÆ
 = 
	`mö
(ˇl_öãrvÆ, (
u32
)
ah
->
c⁄fig
.
™i_pﬁl_öãrvÆ
);

401 i‡(!
comm⁄
->
™i
.
ˇld⁄e
)

402 
ˇl_öãrvÆ
 = 
	`mö
(ˇl_öãrvÆ, (
u32
)
sh‹t_ˇl_öãrvÆ
);

404 
	`mod_timî
(&
comm⁄
->
™i
.
timî
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ˇl_öãrvÆ
));

406 i‡(
	`¨9003_is_∑¥d_íabÀd
(
ah
Ë&&áh->
ˇld©a
) {

407 i‡(!
	`ã°_bô
(
PAPRD_DONE
, &
ah
->
ˇld©a
->
ˇl_Êags
)) {

408 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
∑¥d_w‹k
);

409 } i‡(!
ah
->
∑¥d_èbÀ_wrôe_d⁄e
) {

410 
	`©h9k_ps_wakeup
(
sc
);

411 
	`©h_∑¥d_a˘iv©e
(
sc
);

412 
	`©h9k_ps_ª°‹e
(
sc
);

415 
	}
}

417 
	$©h_°¨t_™i
(
©h_so·c
 *
sc
)

419 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

420 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

421 
time°amp
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

423 i‡(
comm⁄
->
dißbÀ_™i
 ||

424 !
	`ã°_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
) ||

425 
sc
->
cur_ch™
->
offch™√l
)

428 
comm⁄
->
™i
.
l⁄gˇl_timî
 = 
time°amp
;

429 
comm⁄
->
™i
.
sh‹tˇl_timî
 = 
time°amp
;

430 
comm⁄
->
™i
.
check™i_timî
 = 
time°amp
;

432 
	`©h_dbg
(
comm⁄
, 
ANI
, "Starting ANI\n");

433 
	`mod_timî
(&
comm⁄
->
™i
.
timî
,

434 
jiffõs
 + 
	`m£cs_to_jiffõs
((
u32
)
ah
->
c⁄fig
.
™i_pﬁl_öãrvÆ
));

435 
	}
}

437 
	$©h_°›_™i
(
©h_so·c
 *
sc
)

439 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

441 
	`©h_dbg
(
comm⁄
, 
ANI
, "Stopping ANI\n");

442 
	`dñ_timî_sync
(&
comm⁄
->
™i
.
timî
);

443 
	}
}

445 
	$©h_check_™i
(
©h_so·c
 *
sc
)

447 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

448 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

449 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

455 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_ADHOC
) {

456 i‡(!
cur_c⁄f
->
íabÀ_bóc⁄
)

457 
°›_™i
;

458 } i‡(
ah
->
›mode
 =
NL80211_IFTYPE_AP
) {

459 i‡(!
cur_c⁄f
->
íabÀ_bóc⁄
) {

464 i‡(!
	`ã°_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
))

465 
°›_™i
;

467 } i‡(
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) {

468 i‡(!
	`ã°_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
))

469 
°›_™i
;

472 i‡(!
	`ã°_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
)) {

473 
	`£t_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
);

474 
	`©h_°¨t_™i
(
sc
);

479 
°›_™i
:

480 
	`˛ór_bô
(
ATH_OP_ANI_RUN
, &
comm⁄
->
›_Êags
);

481 
	`©h_°›_™i
(
sc
);

482 
	}
}

484 
	$©h_upd©e_survey_nf
(
©h_so·c
 *
sc
, 
ch™√l
)

486 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

487 
©h9k_ch™√l
 *
ch™
 = &
ah
->
ch™√ls
[
ch™√l
];

488 
survey_öfo
 *
survey
 = &
sc
->survey[
ch™√l
];

490 i‡(
ch™
->
noi£Êo‹
) {

491 
survey
->
fûÀd
 |
SURVEY_INFO_NOISE_DBM
;

492 
survey
->
noi£
 = 
	`©h9k_hw_gëch™_noi£
(
ah
, 
ch™
,

493 
ch™
->
noi£Êo‹
);

495 
	}
}

502 
	$©h_upd©e_survey_°©s
(
©h_so·c
 *
sc
)

504 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

505 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

506 
pos
 = 
ah
->
curch™
 - &ah->
ch™√ls
[0];

507 
survey_öfo
 *
survey
 = &
sc
->survey[
pos
];

508 
©h_cy˛e_cou¡îs
 *
cc
 = &
comm⁄
->
cc_survey
;

509 
div
 = 
comm⁄
->
˛ockøã
 * 1000;

510 
ªt
 = 0;

512 i‡(!
ah
->
curch™
)

515 i‡(
ah
->
powî_mode
 =
ATH9K_PM_AWAKE
)

516 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

518 i‡(
cc
->
cy˛es
 > 0) {

519 
survey
->
fûÀd
 |
SURVEY_INFO_TIME
 |

520 
SURVEY_INFO_TIME_BUSY
 |

521 
SURVEY_INFO_TIME_RX
 |

522 
SURVEY_INFO_TIME_TX
;

523 
survey
->
time
 +
cc
->
cy˛es
 / 
div
;

524 
survey
->
time_busy
 +
cc
->
rx_busy
 / 
div
;

525 
survey
->
time_rx
 +
cc
->
rx_‰ame
 / 
div
;

526 
survey
->
time_tx
 +
cc
->
tx_‰ame
 / 
div
;

529 i‡(
cc
->
cy˛es
 < 
div
)

532 i‡(
cc
->
cy˛es
 > 0)

533 
ªt
 = 
cc
->
rx_busy
 * 100 / cc->
cy˛es
;

535 
	`mem£t
(
cc
, 0, (*cc));

537 
	`©h_upd©e_survey_nf
(
sc
, 
pos
);

539  
ªt
;

540 
	}
}

	@mac.c

17 
	~"hw.h
"

18 
	~"hw-›s.h
"

19 
	~<löux/exp‹t.h
>

21 
	$©h9k_hw_£t_txq_öãºu±s
(
©h_hw
 *
ah
,

22 
©h9k_tx_queue_öfo
 *
qi
)

24 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
INTERRUPT
,

26 
ah
->
txok_öãºu±_mask
,áh->
txîr_öãºu±_mask
,

27 
ah
->
txdesc_öãºu±_mask
,áh->
txeﬁ_öãºu±_mask
,

28 
ah
->
txu∫_öãºu±_mask
);

30 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

32 
	`REG_WRITE
(
ah
, 
AR_IMR_S0
,

33 
	`SM
(
ah
->
txok_öãºu±_mask
, 
AR_IMR_S0_QCU_TXOK
)

34 | 
	`SM
(
ah
->
txdesc_öãºu±_mask
, 
AR_IMR_S0_QCU_TXDESC
));

35 
	`REG_WRITE
(
ah
, 
AR_IMR_S1
,

36 
	`SM
(
ah
->
txîr_öãºu±_mask
, 
AR_IMR_S1_QCU_TXERR
)

37 | 
	`SM
(
ah
->
txeﬁ_öãºu±_mask
, 
AR_IMR_S1_QCU_TXEOL
));

39 
ah
->
imrs2_ªg
 &~
AR_IMR_S2_QCU_TXURN
;

40 
ah
->
imrs2_ªg
 |◊h->
txu∫_öãºu±_mask
 & 
AR_IMR_S2_QCU_TXURN
);

41 
	`REG_WRITE
(
ah
, 
AR_IMR_S2
,áh->
imrs2_ªg
);

43 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

44 
	}
}

46 
u32
 
	$©h9k_hw_gëtxbuf
(
©h_hw
 *
ah
, 
u32
 
q
)

48  
	`REG_READ
(
ah
, 
	`AR_QTXDP
(
q
));

49 
	}
}

50 
EXPORT_SYMBOL
(
©h9k_hw_gëtxbuf
);

52 
	$©h9k_hw_puâxbuf
(
©h_hw
 *
ah
, 
u32
 
q
, u32 
txdp
)

54 
	`REG_WRITE
(
ah
, 
	`AR_QTXDP
(
q
), 
txdp
);

55 
	}
}

56 
EXPORT_SYMBOL
(
©h9k_hw_puâxbuf
);

58 
	$©h9k_hw_tx°¨t
(
©h_hw
 *
ah
, 
u32
 
q
)

60 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
QUEUE
, "E«bÀ TXE o¿queue: %u\n", 
q
);

61 
	`REG_WRITE
(
ah
, 
AR_Q_TXE
, 1 << 
q
);

62 
	}
}

63 
EXPORT_SYMBOL
(
©h9k_hw_tx°¨t
);

65 
u32
 
	$©h9k_hw_numtx≥ndög
(
©h_hw
 *
ah
, 
u32
 
q
)

67 
u32
 
≈íd
;

69 
≈íd
 = 
	`REG_READ
(
ah
, 
	`AR_QSTS
(
q
)Ë& 
AR_Q_STS_PEND_FR_CNT
;

70 i‡(
≈íd
 == 0) {

72 i‡(
	`REG_READ
(
ah
, 
AR_Q_TXE
Ë& (1 << 
q
))

73 
≈íd
 = 1;

76  
≈íd
;

77 
	}
}

78 
EXPORT_SYMBOL
(
©h9k_hw_numtx≥ndög
);

105 
boﬁ
 
	$©h9k_hw_upd©ëxåigÀvñ
(
©h_hw
 *
ah
, 
boﬁ
 
bIncTrigLevñ
)

107 
u32
 
txcfg
, 
curLevñ
, 
√wLevñ
;

109 i‡(
ah
->
tx_åig_Àvñ
 >ah->
c⁄fig
.
max_txåig_Àvñ
)

110  
Ál£
;

112 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

114 
txcfg
 = 
	`REG_READ
(
ah
, 
AR_TXCFG
);

115 
curLevñ
 = 
	`MS
(
txcfg
, 
AR_FTRIG
);

116 
√wLevñ
 = 
curLevñ
;

117 i‡(
bIncTrigLevñ
) {

118 i‡(
curLevñ
 < 
ah
->
c⁄fig
.
max_txåig_Àvñ
)

119 
√wLevñ
++;

120 } i‡(
curLevñ
 > 
MIN_TX_FIFO_THRESHOLD
)

121 
√wLevñ
--;

122 i‡(
√wLevñ
 !
curLevñ
)

123 
	`REG_WRITE
(
ah
, 
AR_TXCFG
,

124 (
txcfg
 & ~
AR_FTRIG
Ë| 
	`SM
(
√wLevñ
, AR_FTRIG));

126 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

128 
ah
->
tx_åig_Àvñ
 = 
√wLevñ
;

130  
√wLevñ
 !
curLevñ
;

131 
	}
}

132 
EXPORT_SYMBOL
(
©h9k_hw_upd©ëxåigÀvñ
);

134 
	$©h9k_hw_ab‹t_tx_dma
(
©h_hw
 *
ah
)

136 
maxdñay
 = 1000;

137 
i
, 
q
;

139 i‡(
ah
->
curch™
) {

140 i‡(
	`IS_CHAN_HALF_RATE
(
ah
->
curch™
))

141 
maxdñay
 *= 2;

142 i‡(
	`IS_CHAN_QUARTER_RATE
(
ah
->
curch™
))

143 
maxdñay
 *= 4;

146 
	`REG_WRITE
(
ah
, 
AR_Q_TXD
, 
AR_Q_TXD_M
);

148 
	`REG_SET_BIT
(
ah
, 
AR_PCU_MISC
, 
AR_PCU_FORCE_QUIET_COLL
 | 
AR_PCU_CLEAR_VMF
);

149 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_FORCE_CH_IDLE_HIGH
);

150 
	`REG_SET_BIT
(
ah
, 
AR_D_GBL_IFS_MISC
, 
AR_D_GBL_IFS_MISC_IGNORE_BACKOFF
);

152 
q
 = 0; q < 
AR_NUM_QCU
; q++) {

153 
i
 = 0; i < 
maxdñay
; i++) {

154 i‡(
i
)

155 
	`udñay
(5);

157 i‡(!
	`©h9k_hw_numtx≥ndög
(
ah
, 
q
))

162 
	`REG_CLR_BIT
(
ah
, 
AR_PCU_MISC
, 
AR_PCU_FORCE_QUIET_COLL
 | 
AR_PCU_CLEAR_VMF
);

163 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
, 
AR_DIAG_FORCE_CH_IDLE_HIGH
);

164 
	`REG_CLR_BIT
(
ah
, 
AR_D_GBL_IFS_MISC
, 
AR_D_GBL_IFS_MISC_IGNORE_BACKOFF
);

166 
	`REG_WRITE
(
ah
, 
AR_Q_TXD
, 0);

167 
	}
}

168 
EXPORT_SYMBOL
(
©h9k_hw_ab‹t_tx_dma
);

170 
boﬁ
 
	$©h9k_hw_°›_dma_queue
(
©h_hw
 *
ah
, 
u32
 
q
)

172 
	#ATH9K_TX_STOP_DMA_TIMEOUT
 1000

	)

173 
	#ATH9K_TIME_QUANTUM
 100

	)

174 
waô_time
 = 
ATH9K_TX_STOP_DMA_TIMEOUT
 / 
ATH9K_TIME_QUANTUM
;

175 
waô
;

177 
	`REG_WRITE
(
ah
, 
AR_Q_TXD
, 1 << 
q
);

179 
waô
 = 
waô_time
; wait != 0; wait--) {

180 i‡(
waô
 !
waô_time
)

181 
	`udñay
(
ATH9K_TIME_QUANTUM
);

183 i‡(
	`©h9k_hw_numtx≥ndög
(
ah
, 
q
) == 0)

187 
	`REG_WRITE
(
ah
, 
AR_Q_TXD
, 0);

189  
waô
 != 0;

191 #unde‡
ATH9K_TX_STOP_DMA_TIMEOUT


192 #unde‡
ATH9K_TIME_QUANTUM


193 
	}
}

194 
EXPORT_SYMBOL
(
©h9k_hw_°›_dma_queue
);

196 
boﬁ
 
	$©h9k_hw_£t_txq_¥›s
(
©h_hw
 *
ah
, 
q
,

197 c⁄° 
©h9k_tx_queue_öfo
 *
qöfo
)

199 
u32
 
cw
;

200 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

201 
©h9k_tx_queue_öfo
 *
qi
;

203 
qi
 = &
ah
->
txq
[
q
];

204 i‡(
qi
->
tqi_ty≥
 =
ATH9K_TX_QUEUE_INACTIVE
) {

205 
	`©h_dbg
(
comm⁄
, 
QUEUE
,

206 "Së TXQÖr›îtõs, i«˘ivêqueue: %u\n", 
q
);

207  
Ál£
;

210 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Së queuê¥›îtõ†f‹: %u\n", 
q
);

212 
qi
->
tqi_vî
 = 
qöfo
->tqi_ver;

213 
qi
->
tqi_subty≥
 = 
qöfo
->tqi_subtype;

214 
qi
->
tqi_qÊags
 = 
qöfo
->tqi_qflags;

215 
qi
->
tqi_¥i‹ôy
 = 
qöfo
->tqi_priority;

216 i‡(
qöfo
->
tqi_aifs
 !
ATH9K_TXQ_USEDEFAULT
)

217 
qi
->
tqi_aifs
 = 
	`mö
(
qöfo
->tqi_aifs, 255U);

219 
qi
->
tqi_aifs
 = 
INIT_AIFS
;

220 i‡(
qöfo
->
tqi_cwmö
 !
ATH9K_TXQ_USEDEFAULT
) {

221 
cw
 = 
	`mö
(
qöfo
->
tqi_cwmö
, 1024U);

222 
qi
->
tqi_cwmö
 = 1;

223 
qi
->
tqi_cwmö
 < 
cw
)

224 
qi
->
tqi_cwmö
 = (qi->tqi_cwmin << 1) | 1;

226 
qi
->
tqi_cwmö
 = 
qöfo
->tqi_cwmin;

227 i‡(
qöfo
->
tqi_cwmax
 !
ATH9K_TXQ_USEDEFAULT
) {

228 
cw
 = 
	`mö
(
qöfo
->
tqi_cwmax
, 1024U);

229 
qi
->
tqi_cwmax
 = 1;

230 
qi
->
tqi_cwmax
 < 
cw
)

231 
qi
->
tqi_cwmax
 = (qi->tqi_cwmax << 1) | 1;

233 
qi
->
tqi_cwmax
 = 
INIT_CWMAX
;

235 i‡(
qöfo
->
tqi_shªåy
 != 0)

236 
qi
->
tqi_shªåy
 = 
	`mö
((
u32
Ë
qöfo
->tqi_shretry, 15U);

238 
qi
->
tqi_shªåy
 = 
INIT_SH_RETRY
;

239 i‡(
qöfo
->
tqi_lgªåy
 != 0)

240 
qi
->
tqi_lgªåy
 = 
	`mö
((
u32
Ë
qöfo
->tqi_lgretry, 15U);

242 
qi
->
tqi_lgªåy
 = 
INIT_LG_RETRY
;

243 
qi
->
tqi_cbrPîiod
 = 
qöfo
->tqi_cbrPeriod;

244 
qi
->
tqi_cbrOvîÊowLimô
 = 
qöfo
->tqi_cbrOverflowLimit;

245 
qi
->
tqi_bur°Time
 = 
qöfo
->tqi_burstTime;

246 
qi
->
tqi_ªadyTime
 = 
qöfo
->tqi_readyTime;

248 
qöfo
->
tqi_subty≥
) {

249 
ATH9K_WME_UPSD
:

250 i‡(
qi
->
tqi_ty≥
 =
ATH9K_TX_QUEUE_DATA
)

251 
qi
->
tqi_ötFœgs
 = 
ATH9K_TXQ_USE_LOCKOUT_BKOFF_DIS
;

257  
åue
;

258 
	}
}

259 
EXPORT_SYMBOL
(
©h9k_hw_£t_txq_¥›s
);

261 
boﬁ
 
	$©h9k_hw_gë_txq_¥›s
(
©h_hw
 *
ah
, 
q
,

262 
©h9k_tx_queue_öfo
 *
qöfo
)

264 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

265 
©h9k_tx_queue_öfo
 *
qi
;

267 
qi
 = &
ah
->
txq
[
q
];

268 i‡(
qi
->
tqi_ty≥
 =
ATH9K_TX_QUEUE_INACTIVE
) {

269 
	`©h_dbg
(
comm⁄
, 
QUEUE
,

270 "Gë TXQÖr›îtõs, i«˘ivêqueue: %u\n", 
q
);

271  
Ál£
;

274 
qöfo
->
tqi_qÊags
 = 
qi
->tqi_qflags;

275 
qöfo
->
tqi_vî
 = 
qi
->tqi_ver;

276 
qöfo
->
tqi_subty≥
 = 
qi
->tqi_subtype;

277 
qöfo
->
tqi_qÊags
 = 
qi
->tqi_qflags;

278 
qöfo
->
tqi_¥i‹ôy
 = 
qi
->tqi_priority;

279 
qöfo
->
tqi_aifs
 = 
qi
->tqi_aifs;

280 
qöfo
->
tqi_cwmö
 = 
qi
->tqi_cwmin;

281 
qöfo
->
tqi_cwmax
 = 
qi
->tqi_cwmax;

282 
qöfo
->
tqi_shªåy
 = 
qi
->tqi_shretry;

283 
qöfo
->
tqi_lgªåy
 = 
qi
->tqi_lgretry;

284 
qöfo
->
tqi_cbrPîiod
 = 
qi
->tqi_cbrPeriod;

285 
qöfo
->
tqi_cbrOvîÊowLimô
 = 
qi
->tqi_cbrOverflowLimit;

286 
qöfo
->
tqi_bur°Time
 = 
qi
->tqi_burstTime;

287 
qöfo
->
tqi_ªadyTime
 = 
qi
->tqi_readyTime;

289  
åue
;

290 
	}
}

291 
EXPORT_SYMBOL
(
©h9k_hw_gë_txq_¥›s
);

293 
	$©h9k_hw_£tu±xqueue
(
©h_hw
 *
ah
, 
©h9k_tx_queue
 
ty≥
,

294 c⁄° 
©h9k_tx_queue_öfo
 *
qöfo
)

296 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

297 
©h9k_tx_queue_öfo
 *
qi
;

298 
q
;

300 
ty≥
) {

301 
ATH9K_TX_QUEUE_BEACON
:

302 
q
 = 
ATH9K_NUM_TX_QUEUES
 - 1;

304 
ATH9K_TX_QUEUE_CAB
:

305 
q
 = 
ATH9K_NUM_TX_QUEUES
 - 2;

307 
ATH9K_TX_QUEUE_PSPOLL
:

308 
q
 = 1;

310 
ATH9K_TX_QUEUE_UAPSD
:

311 
q
 = 
ATH9K_NUM_TX_QUEUES
 - 3;

313 
ATH9K_TX_QUEUE_DATA
:

314 
q
 = 
qöfo
->
tqi_subty≥
;

317 
	`©h_îr
(
comm⁄
, "InvÆid TX queuêty≥: %u\n", 
ty≥
);

321 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Sëu∞TX queue: %u\n", 
q
);

323 
qi
 = &
ah
->
txq
[
q
];

324 i‡(
qi
->
tqi_ty≥
 !
ATH9K_TX_QUEUE_INACTIVE
) {

325 
	`©h_îr
(
comm⁄
, "TX queue: %uáÃódyá˘ive\n", 
q
);

328 
	`mem£t
(
qi
, 0, (
©h9k_tx_queue_öfo
));

329 
qi
->
tqi_ty≥
 = 
ty≥
;

330 
qi
->
tqi_physCompBuf
 = 
qöfo
->tqi_physCompBuf;

331 (Ë
	`©h9k_hw_£t_txq_¥›s
(
ah
, 
q
, 
qöfo
);

333  
q
;

334 
	}
}

335 
EXPORT_SYMBOL
(
©h9k_hw_£tu±xqueue
);

337 
	$©h9k_hw_˛ór_queue_öãºu±s
(
©h_hw
 *
ah
, 
u32
 
q
)

339 
ah
->
txok_öãºu±_mask
 &~(1 << 
q
);

340 
ah
->
txîr_öãºu±_mask
 &~(1 << 
q
);

341 
ah
->
txdesc_öãºu±_mask
 &~(1 << 
q
);

342 
ah
->
txeﬁ_öãºu±_mask
 &~(1 << 
q
);

343 
ah
->
txu∫_öãºu±_mask
 &~(1 << 
q
);

344 
	}
}

346 
boﬁ
 
	$©h9k_hw_ªÀa£txqueue
(
©h_hw
 *
ah
, 
u32
 
q
)

348 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

349 
©h9k_tx_queue_öfo
 *
qi
;

351 
qi
 = &
ah
->
txq
[
q
];

352 i‡(
qi
->
tqi_ty≥
 =
ATH9K_TX_QUEUE_INACTIVE
) {

353 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Rñó£ TXQ, i«˘ivêqueue: %u\n", 
q
);

354  
Ál£
;

357 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Rñó£ TX queue: %u\n", 
q
);

359 
qi
->
tqi_ty≥
 = 
ATH9K_TX_QUEUE_INACTIVE
;

360 
	`©h9k_hw_˛ór_queue_öãºu±s
(
ah
, 
q
);

361 
	`©h9k_hw_£t_txq_öãºu±s
(
ah
, 
qi
);

363  
åue
;

364 
	}
}

365 
EXPORT_SYMBOL
(
©h9k_hw_ªÀa£txqueue
);

367 
boﬁ
 
	$©h9k_hw_ª£âxqueue
(
©h_hw
 *
ah
, 
u32
 
q
)

369 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

370 
©h9k_tx_queue_öfo
 *
qi
;

371 
u32
 
cwMö
, 
ch™CwMö
, 
vÆue
;

373 
qi
 = &
ah
->
txq
[
q
];

374 i‡(
qi
->
tqi_ty≥
 =
ATH9K_TX_QUEUE_INACTIVE
) {

375 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Re£àTXQ, i«˘ivêqueue: %u\n", 
q
);

376  
åue
;

379 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "Re£àTX queue: %u\n", 
q
);

381 i‡(
qi
->
tqi_cwmö
 =
ATH9K_TXQ_USEDEFAULT
) {

382 
ch™CwMö
 = 
INIT_CWMIN
;

384 
cwMö
 = 1; cwMö < 
ch™CwMö
; cwMin = (cwMin << 1) | 1);

386 
cwMö
 = 
qi
->
tqi_cwmö
;

388 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

390 
	`REG_WRITE
(
ah
, 
	`AR_DLCL_IFS
(
q
),

391 
	`SM
(
cwMö
, 
AR_D_LCL_IFS_CWMIN
) |

392 
	`SM
(
qi
->
tqi_cwmax
, 
AR_D_LCL_IFS_CWMAX
) |

393 
	`SM
(
qi
->
tqi_aifs
, 
AR_D_LCL_IFS_AIFS
));

395 
	`REG_WRITE
(
ah
, 
	`AR_DRETRY_LIMIT
(
q
),

396 
	`SM
(
INIT_SSH_RETRY
, 
AR_D_RETRY_LIMIT_STA_SH
) |

397 
	`SM
(
INIT_SLG_RETRY
, 
AR_D_RETRY_LIMIT_STA_LG
) |

398 
	`SM
(
qi
->
tqi_shªåy
, 
AR_D_RETRY_LIMIT_FR_SH
));

400 
	`REG_WRITE
(
ah
, 
	`AR_QMISC
(
q
), 
AR_Q_MISC_DCU_EARLY_TERM_REQ
);

402 i‡(
	`AR_SREV_9340
(
ah
Ë&& !
	`AR_SREV_9340_13_OR_LATER
(ah))

403 
	`REG_WRITE
(
ah
, 
	`AR_DMISC
(
q
),

404 
AR_D_MISC_CW_BKOFF_EN
 | 
AR_D_MISC_FRAG_WAIT_EN
 | 0x1);

406 
	`REG_WRITE
(
ah
, 
	`AR_DMISC
(
q
),

407 
AR_D_MISC_CW_BKOFF_EN
 | 
AR_D_MISC_FRAG_WAIT_EN
 | 0x2);

409 i‡(
qi
->
tqi_cbrPîiod
) {

410 
	`REG_WRITE
(
ah
, 
	`AR_QCBRCFG
(
q
),

411 
	`SM
(
qi
->
tqi_cbrPîiod
, 
AR_Q_CBRCFG_INTERVAL
) |

412 
	`SM
(
qi
->
tqi_cbrOvîÊowLimô
, 
AR_Q_CBRCFG_OVF_THRESH
));

413 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
q
), 
AR_Q_MISC_FSP_CBR
 |

414 (
qi
->
tqi_cbrOvîÊowLimô
 ?

415 
AR_Q_MISC_CBR_EXP_CNTR_LIMIT_EN
 : 0));

417 i‡(
qi
->
tqi_ªadyTime
 && (qi->
tqi_ty≥
 !
ATH9K_TX_QUEUE_CAB
)) {

418 
	`REG_WRITE
(
ah
, 
	`AR_QRDYTIMECFG
(
q
),

419 
	`SM
(
qi
->
tqi_ªadyTime
, 
AR_Q_RDYTIMECFG_DURATION
) |

420 
AR_Q_RDYTIMECFG_EN
);

423 
	`REG_WRITE
(
ah
, 
	`AR_DCHNTIME
(
q
),

424 
	`SM
(
qi
->
tqi_bur°Time
, 
AR_D_CHNTIME_DUR
) |

425 (
qi
->
tqi_bur°Time
 ? 
AR_D_CHNTIME_EN
 : 0));

427 i‡(
qi
->
tqi_bur°Time


428 && (
qi
->
tqi_qÊags
 & 
TXQ_FLAG_RDYTIME_EXP_POLICY_ENABLE
))

429 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
q
), 
AR_Q_MISC_RDYTIME_EXP_POLICY
);

431 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_BACKOFF_DISABLE
)

432 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
), 
AR_D_MISC_POST_FR_BKOFF_DIS
);

434 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

436 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_FRAG_BURST_BACKOFF_ENABLE
)

437 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
), 
AR_D_MISC_FRAG_BKOFF_EN
);

439 
qi
->
tqi_ty≥
) {

440 
ATH9K_TX_QUEUE_BEACON
:

441 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

443 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
q
),

444 
AR_Q_MISC_FSP_DBA_GATED


445 | 
AR_Q_MISC_BEACON_USE


446 | 
AR_Q_MISC_CBR_INCR_DIS1
);

448 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
),

449 (
AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL
 <<

450 
AR_D_MISC_ARB_LOCKOUT_CNTRL_S
)

451 | 
AR_D_MISC_BEACON_USE


452 | 
AR_D_MISC_POST_FR_BKOFF_DIS
);

454 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

461 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
) &&

462 
ah
->
›mode
 !
NL80211_IFTYPE_ADHOC
) {

463 
	`REG_WRITE
(
ah
, 
	`AR_DLCL_IFS
(
q
), 
	`SM
(0, 
AR_D_LCL_IFS_CWMIN
)

464 | 
	`SM
(0, 
AR_D_LCL_IFS_CWMAX
)

465 | 
	`SM
(
qi
->
tqi_aifs
, 
AR_D_LCL_IFS_AIFS
));

468 
ATH9K_TX_QUEUE_CAB
:

469 
	`ENABLE_REGWRITE_BUFFER
(
ah
);

471 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
q
),

472 
AR_Q_MISC_FSP_DBA_GATED


473 | 
AR_Q_MISC_CBR_INCR_DIS1


474 | 
AR_Q_MISC_CBR_INCR_DIS0
);

475 
vÆue
 = (
qi
->
tqi_ªadyTime
 -

476 (
ah
->
c⁄fig
.
sw_bóc⁄_ª•⁄£_time
 -

477 
ah
->
c⁄fig
.
dma_bóc⁄_ª•⁄£_time
)) * 1024;

478 
	`REG_WRITE
(
ah
, 
	`AR_QRDYTIMECFG
(
q
),

479 
vÆue
 | 
AR_Q_RDYTIMECFG_EN
);

480 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
),

481 (
AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL
 <<

482 
AR_D_MISC_ARB_LOCKOUT_CNTRL_S
));

484 
	`REGWRITE_BUFFER_FLUSH
(
ah
);

487 
ATH9K_TX_QUEUE_PSPOLL
:

488 
	`REG_SET_BIT
(
ah
, 
	`AR_QMISC
(
q
), 
AR_Q_MISC_CBR_INCR_DIS1
);

490 
ATH9K_TX_QUEUE_UAPSD
:

491 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
), 
AR_D_MISC_POST_FR_BKOFF_DIS
);

497 i‡(
qi
->
tqi_ötFœgs
 & 
ATH9K_TXQ_USE_LOCKOUT_BKOFF_DIS
) {

498 
	`REG_SET_BIT
(
ah
, 
	`AR_DMISC
(
q
),

499 
	`SM
(
AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL
,

500 
AR_D_MISC_ARB_LOCKOUT_CNTRL
) |

501 
AR_D_MISC_POST_FR_BKOFF_DIS
);

504 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

505 
	`REG_WRITE
(
ah
, 
AR_Q_DESC_CRCCHK
, 
AR_Q_DESC_CRCCHK_EN
);

507 
	`©h9k_hw_˛ór_queue_öãºu±s
(
ah
, 
q
);

508 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_TXINT_ENABLE
) {

509 
ah
->
txok_öãºu±_mask
 |1 << 
q
;

510 
ah
->
txîr_öãºu±_mask
 |1 << 
q
;

512 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_TXDESCINT_ENABLE
)

513 
ah
->
txdesc_öãºu±_mask
 |1 << 
q
;

514 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_TXEOLINT_ENABLE
)

515 
ah
->
txeﬁ_öãºu±_mask
 |1 << 
q
;

516 i‡(
qi
->
tqi_qÊags
 & 
TXQ_FLAG_TXURNINT_ENABLE
)

517 
ah
->
txu∫_öãºu±_mask
 |1 << 
q
;

518 
	`©h9k_hw_£t_txq_öãºu±s
(
ah
, 
qi
);

520  
åue
;

521 
	}
}

522 
EXPORT_SYMBOL
(
©h9k_hw_ª£âxqueue
);

524 
	$©h9k_hw_rx¥ocdesc
(
©h_hw
 *
ah
, 
©h_desc
 *
ds
,

525 
©h_rx_°©us
 *
rs
)

527 
¨5416_desc
 
ads
;

528 
¨5416_desc
 *
ad•
 = 
	`AR5416DESC
(
ds
);

529 
u32
 
phyîr
;

531 i‡((
ad•
->
ds_rx°©us8
 & 
AR_RxD⁄e
) == 0)

532  -
EINPROGRESS
;

534 
ads
.
u
.
rx
 = 
ad•
->u.rx;

536 
rs
->
rs_°©us
 = 0;

537 
rs
->
rs_Êags
 = 0;

538 
rs
->
Êag
 = 0;

540 
rs
->
rs_d©Æí
 = 
ads
.
ds_rx°©us1
 & 
AR_D©aLí
;

541 
rs
->
rs_t°amp
 = 
ads
.
AR_RcvTime°amp
;

543 i‡(
ads
.
ds_rx°©us8
 & 
AR_Po°DñimCRCEº
) {

544 
rs
->
rs_rssi
 = 
ATH9K_RSSI_BAD
;

545 
rs
->
rs_rssi_˘l
[0] = 
ATH9K_RSSI_BAD
;

546 
rs
->
rs_rssi_˘l
[1] = 
ATH9K_RSSI_BAD
;

547 
rs
->
rs_rssi_˘l
[2] = 
ATH9K_RSSI_BAD
;

548 
rs
->
rs_rssi_ext
[0] = 
ATH9K_RSSI_BAD
;

549 
rs
->
rs_rssi_ext
[1] = 
ATH9K_RSSI_BAD
;

550 
rs
->
rs_rssi_ext
[2] = 
ATH9K_RSSI_BAD
;

552 
rs
->
rs_rssi
 = 
	`MS
(
ads
.
ds_rx°©us4
, 
AR_RxRSSIComböed
);

553 
rs
->
rs_rssi_˘l
[0] = 
	`MS
(
ads
.
ds_rx°©us0
,

554 
AR_RxRSSIA¡00
);

555 
rs
->
rs_rssi_˘l
[1] = 
	`MS
(
ads
.
ds_rx°©us0
,

556 
AR_RxRSSIA¡01
);

557 
rs
->
rs_rssi_˘l
[2] = 
	`MS
(
ads
.
ds_rx°©us0
,

558 
AR_RxRSSIA¡02
);

559 
rs
->
rs_rssi_ext
[0] = 
	`MS
(
ads
.
ds_rx°©us4
,

560 
AR_RxRSSIA¡10
);

561 
rs
->
rs_rssi_ext
[1] = 
	`MS
(
ads
.
ds_rx°©us4
,

562 
AR_RxRSSIA¡11
);

563 
rs
->
rs_rssi_ext
[2] = 
	`MS
(
ads
.
ds_rx°©us4
,

564 
AR_RxRSSIA¡12
);

566 i‡(
ads
.
ds_rx°©us8
 & 
AR_RxKeyIdxVÆid
)

567 
rs
->
rs_keyix
 = 
	`MS
(
ads
.
ds_rx°©us8
, 
AR_KeyIdx
);

569 
rs
->
rs_keyix
 = 
ATH9K_RXKEYIX_INVALID
;

571 
rs
->
rs_øã
 = 
	`MS
(
ads
.
ds_rx°©us0
, 
AR_RxR©e
);

572 
rs
->
rs_m‹e
 = (
ads
.
ds_rx°©us1
 & 
AR_RxM‹e
) ? 1 : 0;

574 
rs
->
rs_fú°aggr
 = (
ads
.
ds_rx°©us8
 & 
AR_RxFú°Aggr
) ? 1 : 0;

575 
rs
->
rs_ißggr
 = (
ads
.
ds_rx°©us8
 & 
AR_RxAggr
) ? 1 : 0;

576 
rs
->
rs_m‹óggr
 = (
ads
.
ds_rx°©us8
 & 
AR_RxM‹eAggr
) ? 1 : 0;

577 
rs
->
rs_™ã¬a
 = 
	`MS
(
ads
.
ds_rx°©us3
, 
AR_RxA¡í«
);

580 
rs
->
Êag
 |=

581 (
ads
.
ds_rx°©us3
 & 
AR_GI
Ë? 
RX_FLAG_SHORT_GI
 : 0;

582 
rs
->
Êag
 |=

583 (
ads
.
ds_rx°©us3
 & 
AR_2040
Ë? 
RX_FLAG_40MHZ
 : 0;

584 i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
))

585 
rs
->
Êag
 |=

586 (
ads
.
ds_rx°©us3
 & 
AR_STBC
) ?

588 (1 << 
RX_FLAG_STBC_SHIFT
) : 0;

590 i‡(
ads
.
ds_rx°©us8
 & 
AR_PªDñimCRCEº
)

591 
rs
->
rs_Êags
 |
ATH9K_RX_DELIM_CRC_PRE
;

592 i‡(
ads
.
ds_rx°©us8
 & 
AR_Po°DñimCRCEº
)

593 
rs
->
rs_Êags
 |
ATH9K_RX_DELIM_CRC_POST
;

594 i‡(
ads
.
ds_rx°©us8
 & 
AR_De¸y±BusyEº
)

595 
rs
->
rs_Êags
 |
ATH9K_RX_DECRYPT_BUSY
;

597 i‡((
ads
.
ds_rx°©us8
 & 
AR_RxFømeOK
) == 0) {

604 i‡(
ads
.
ds_rx°©us8
 & 
AR_PHYEº
) {

605 
rs
->
rs_°©us
 |
ATH9K_RXERR_PHY
;

606 
phyîr
 = 
	`MS
(
ads
.
ds_rx°©us8
, 
AR_PHYEºCode
);

607 
rs
->
rs_phyîr
 = 
phyîr
;

608 } i‡(
ads
.
ds_rx°©us8
 & 
AR_CRCEº
)

609 
rs
->
rs_°©us
 |
ATH9K_RXERR_CRC
;

610 i‡(
ads
.
ds_rx°©us8
 & 
AR_De¸y±CRCEº
)

611 
rs
->
rs_°©us
 |
ATH9K_RXERR_DECRYPT
;

612 i‡(
ads
.
ds_rx°©us8
 & 
AR_Mich´lEº
)

613 
rs
->
rs_°©us
 |
ATH9K_RXERR_MIC
;

615 i‡(
ads
.
ds_rx°©us8
 &

616 (
AR_CRCEº
 | 
AR_PHYEº
 | 
AR_De¸y±CRCEº
 | 
AR_Mich´lEº
))

617 
rs
->
rs_°©us
 |
ATH9K_RXERR_CORRUPT_DESC
;

620 i‡(
rs
->
rs_øã
 >= 0x90)

621 
rs
->
rs_°©us
 |
ATH9K_RXERR_CORRUPT_DESC
;

624 i‡(
ads
.
ds_rx°©us8
 & 
AR_KeyMiss
)

625 
rs
->
rs_°©us
 |
ATH9K_RXERR_KEYMISS
;

628 
	}
}

629 
EXPORT_SYMBOL
(
©h9k_hw_rx¥ocdesc
);

638 
boﬁ
 
	$©h9k_hw_£åxab‹t
(
©h_hw
 *
ah
, 
boﬁ
 
£t
)

640 
u32
 
ªg
;

642 i‡(
£t
) {

643 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
,

644 (
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
));

646 i‡(!
	`©h9k_hw_waô
(
ah
, 
AR_OBS_BUS_1
, 
AR_OBS_BUS_1_RX_STATE
,

647 0, 
AH_WAIT_TIMEOUT
)) {

648 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
,

649 (
AR_DIAG_RX_DIS
 |

650 
AR_DIAG_RX_ABORT
));

652 
ªg
 = 
	`REG_READ
(
ah
, 
AR_OBS_BUS_1
);

653 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
ah
),

655 
ªg
);

657  
Ál£
;

660 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
,

661 (
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
));

664  
åue
;

665 
	}
}

666 
EXPORT_SYMBOL
(
©h9k_hw_£åxab‹t
);

668 
	$©h9k_hw_puåxbuf
(
©h_hw
 *
ah
, 
u32
 
rxdp
)

670 
	`REG_WRITE
(
ah
, 
AR_RXDP
, 
rxdp
);

671 
	}
}

672 
EXPORT_SYMBOL
(
©h9k_hw_puåxbuf
);

674 
	$©h9k_hw_°¨çcuª˚ive
(
©h_hw
 *
ah
, 
boﬁ
 
is_sˇ¬ög
)

676 
	`©h9k_íabÀ_mib_cou¡îs
(
ah
);

678 
	`©h9k_™i_ª£t
(
ah
, 
is_sˇ¬ög
);

680 
	`REG_CLR_BIT
(
ah
, 
AR_DIAG_SW
,

681 
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
 | 
AR_DIAG_FORCE_RX_CLEAR
);

682 
	}
}

683 
EXPORT_SYMBOL
(
©h9k_hw_°¨çcuª˚ive
);

685 
	$©h9k_hw_ab‹çcuªcv
(
©h_hw
 *
ah
)

687 
	`REG_SET_BIT
(
ah
, 
AR_DIAG_SW
,

688 
AR_DIAG_RX_DIS
 | 
AR_DIAG_RX_ABORT
 | 
AR_DIAG_FORCE_RX_CLEAR
);

690 
	`©h9k_hw_dißbÀ_mib_cou¡îs
(
ah
);

691 
	}
}

692 
EXPORT_SYMBOL
(
©h9k_hw_ab‹çcuªcv
);

694 
boﬁ
 
	$©h9k_hw_°›dm¨ecv
(
©h_hw
 *
ah
, 
boﬁ
 *
ª£t
)

696 
	#AH_RX_STOP_DMA_TIMEOUT
 10000

	)

697 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

698 
u32
 
mac_°©us
 = 0, 
œ°_mac_°©us
 = 0;

699 
i
;

702 
	`REG_WRITE
(
ah
, 
AR_MACMISC
,

703 ((
AR_MACMISC_DMA_OBS_LINE_8
 << 
AR_MACMISC_DMA_OBS_S
) |

704 (
AR_MACMISC_MISC_OBS_BUS_1
 <<

705 
AR_MACMISC_MISC_OBS_BUS_MSB_S
)));

707 
	`REG_WRITE
(
ah
, 
AR_CR
, 
AR_CR_RXD
);

710 
i
 = 
AH_RX_STOP_DMA_TIMEOUT
 / 
AH_TIME_QUANTUM
; i != 0; i--) {

711 i‡((
	`REG_READ
(
ah
, 
AR_CR
Ë& 
AR_CR_RXE
) == 0)

714 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

715 
mac_°©us
 = 
	`REG_READ
(
ah
, 
AR_DMADBG_7
) & 0x7f0;

716 i‡(
mac_°©us
 =0x1c0 && mac_°©u†=
œ°_mac_°©us
) {

717 *
ª£t
 = 
åue
;

721 
œ°_mac_°©us
 = 
mac_°©us
;

724 
	`udñay
(
AH_TIME_QUANTUM
);

727 i‡(
i
 == 0) {

728 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
) &&

729 (
mac_°©us
 & 0x700) == 0) {

734 *
ª£t
 = 
åue
;

735  
åue
;

738 
	`©h_îr
(
comm⁄
,

740 
AH_RX_STOP_DMA_TIMEOUT
 / 1000,

741 
	`REG_READ
(
ah
, 
AR_CR
),

742 
	`REG_READ
(
ah
, 
AR_DIAG_SW
),

743 
	`REG_READ
(
ah
, 
AR_DMADBG_7
));

744  
Ál£
;

746  
åue
;

749 #unde‡
AH_RX_STOP_DMA_TIMEOUT


750 
	}
}

751 
EXPORT_SYMBOL
(
©h9k_hw_°›dm¨ecv
);

753 
	$©h9k_hw_bóc⁄q_£tup
(
©h_hw
 *
ah
)

755 
©h9k_tx_queue_öfo
 
qi
;

757 
	`mem£t
(&
qi
, 0, (qi));

758 
qi
.
tqi_aifs
 = 1;

759 
qi
.
tqi_cwmö
 = 0;

760 
qi
.
tqi_cwmax
 = 0;

762 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

763 
qi
.
tqi_qÊags
 = 
TXQ_FLAG_TXINT_ENABLE
;

765  
	`©h9k_hw_£tu±xqueue
(
ah
, 
ATH9K_TX_QUEUE_BEACON
, &
qi
);

766 
	}
}

767 
EXPORT_SYMBOL
(
©h9k_hw_bóc⁄q_£tup
);

769 
boﬁ
 
	$©h9k_hw_öå≥nd
(
©h_hw
 *
ah
)

771 
u32
 
ho°_i§
;

773 i‡(
	`AR_SREV_9100
(
ah
))

774  
åue
;

776 
ho°_i§
 = 
	`REG_READ
(
ah
, 
AR_INTR_ASYNC_CAUSE
);

778 i‡(((
ho°_i§
 & 
AR_INTR_MAC_IRQ
) ||

779 (
ho°_i§
 & 
AR_INTR_ASYNC_MASK_MCI
)) &&

780 (
ho°_i§
 !
AR_INTR_SPURIOUS
))

781  
åue
;

783 
ho°_i§
 = 
	`REG_READ
(
ah
, 
AR_INTR_SYNC_CAUSE
);

784 i‡((
ho°_i§
 & 
AR_INTR_SYNC_DEFAULT
)

785 && (
ho°_i§
 !
AR_INTR_SPURIOUS
))

786  
åue
;

788  
Ál£
;

789 
	}
}

790 
EXPORT_SYMBOL
(
©h9k_hw_öå≥nd
);

792 
	$©h9k_hw_kûl_öãºu±s
(
©h_hw
 *
ah
)

794 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

796 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "disable IER\n");

797 
	`REG_WRITE
(
ah
, 
AR_IER
, 
AR_IER_DISABLE
);

798 (Ë
	`REG_READ
(
ah
, 
AR_IER
);

799 i‡(!
	`AR_SREV_9100
(
ah
)) {

800 
	`REG_WRITE
(
ah
, 
AR_INTR_ASYNC_ENABLE
, 0);

801 (Ë
	`REG_READ
(
ah
, 
AR_INTR_ASYNC_ENABLE
);

803 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_ENABLE
, 0);

804 (Ë
	`REG_READ
(
ah
, 
AR_INTR_SYNC_ENABLE
);

806 
	}
}

807 
EXPORT_SYMBOL
(
©h9k_hw_kûl_öãºu±s
);

809 
	$©h9k_hw_dißbÀ_öãºu±s
(
©h_hw
 *
ah
)

811 i‡(!(
ah
->
imask
 & 
ATH9K_INT_GLOBAL
))

812 
	`©omic_£t
(&
ah
->
öå_ªf_˙t
, -1);

814 
	`©omic_dec
(&
ah
->
öå_ªf_˙t
);

816 
	`©h9k_hw_kûl_öãºu±s
(
ah
);

817 
	}
}

818 
EXPORT_SYMBOL
(
©h9k_hw_dißbÀ_öãºu±s
);

820 
	$©h9k_hw_íabÀ_öãºu±s
(
©h_hw
 *
ah
)

822 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

823 
u32
 
sync_deÁu…
 = 
AR_INTR_SYNC_DEFAULT
;

824 
u32
 
async_mask
;

826 i‡(!(
ah
->
imask
 & 
ATH9K_INT_GLOBAL
))

829 i‡(!
	`©omic_öc_™d_ã°
(&
ah
->
öå_ªf_˙t
)) {

830 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "DoÇotÉnable IERÑef count %d\n",

831 
	`©omic_ªad
(&
ah
->
öå_ªf_˙t
));

835 i‡(
	`AR_SREV_9340
(
ah
Ë|| 
	`AR_SREV_9550
◊hË|| 
	`AR_SREV_9531
(ah) ||

836 
	`AR_SREV_9561
(
ah
))

837 
sync_deÁu…
 &~
AR_INTR_SYNC_HOST1_FATAL
;

839 
async_mask
 = 
AR_INTR_MAC_IRQ
;

841 i‡(
ah
->
imask
 & 
ATH9K_INT_MCI
)

842 
async_mask
 |
AR_INTR_ASYNC_MASK_MCI
;

844 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "enable IER\n");

845 
	`REG_WRITE
(
ah
, 
AR_IER
, 
AR_IER_ENABLE
);

846 i‡(!
	`AR_SREV_9100
(
ah
)) {

847 
	`REG_WRITE
(
ah
, 
AR_INTR_ASYNC_ENABLE
, 
async_mask
);

848 
	`REG_WRITE
(
ah
, 
AR_INTR_ASYNC_MASK
, 
async_mask
);

850 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_ENABLE
, 
sync_deÁu…
);

851 
	`REG_WRITE
(
ah
, 
AR_INTR_SYNC_MASK
, 
sync_deÁu…
);

853 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "AR_IMR 0x%x IER 0x%x\n",

854 
	`REG_READ
(
ah
, 
AR_IMR
), REG_READ◊h, 
AR_IER
));

855 
	}
}

856 
EXPORT_SYMBOL
(
©h9k_hw_íabÀ_öãºu±s
);

858 
	$©h9k_hw_£t_öãºu±s
(
©h_hw
 *
ah
)

860 
©h9k_öt
 
öts
 = 
ah
->
imask
;

861 
u32
 
mask
, 
mask2
;

862 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

863 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

865 i‡(!(
öts
 & 
ATH9K_INT_GLOBAL
))

866 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

868 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "New i¡îru± mask 0x%x\n", 
öts
);

870 
mask
 = 
öts
 & 
ATH9K_INT_COMMON
;

871 
mask2
 = 0;

873 i‡(
öts
 & 
ATH9K_INT_TX
) {

874 i‡(
ah
->
c⁄fig
.
tx_öå_môig©i⁄
)

875 
mask
 |
AR_IMR_TXMINTR
 | 
AR_IMR_TXINTM
;

877 i‡(
ah
->
txok_öãºu±_mask
)

878 
mask
 |
AR_IMR_TXOK
;

879 i‡(
ah
->
txdesc_öãºu±_mask
)

880 
mask
 |
AR_IMR_TXDESC
;

882 i‡(
ah
->
txîr_öãºu±_mask
)

883 
mask
 |
AR_IMR_TXERR
;

884 i‡(
ah
->
txeﬁ_öãºu±_mask
)

885 
mask
 |
AR_IMR_TXEOL
;

887 i‡(
öts
 & 
ATH9K_INT_RX
) {

888 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

889 
mask
 |
AR_IMR_RXERR
 | 
AR_IMR_RXOK_HP
;

890 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
) {

891 
mask
 &~
AR_IMR_RXOK_LP
;

892 
mask
 |
AR_IMR_RXMINTR
 | 
AR_IMR_RXINTM
;

894 
mask
 |
AR_IMR_RXOK_LP
;

897 i‡(
ah
->
c⁄fig
.
rx_öå_môig©i⁄
)

898 
mask
 |
AR_IMR_RXMINTR
 | 
AR_IMR_RXINTM
;

900 
mask
 |
AR_IMR_RXOK
 | 
AR_IMR_RXDESC
;

902 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
))

903 
mask
 |
AR_IMR_GENTMR
;

906 i‡(
öts
 & 
ATH9K_INT_GENTIMER
)

907 
mask
 |
AR_IMR_GENTMR
;

909 i‡(
öts
 & (
ATH9K_INT_BMISC
)) {

910 
mask
 |
AR_IMR_BCNMISC
;

911 i‡(
öts
 & 
ATH9K_INT_TIM
)

912 
mask2
 |
AR_IMR_S2_TIM
;

913 i‡(
öts
 & 
ATH9K_INT_DTIM
)

914 
mask2
 |
AR_IMR_S2_DTIM
;

915 i‡(
öts
 & 
ATH9K_INT_DTIMSYNC
)

916 
mask2
 |
AR_IMR_S2_DTIMSYNC
;

917 i‡(
öts
 & 
ATH9K_INT_CABEND
)

918 
mask2
 |
AR_IMR_S2_CABEND
;

919 i‡(
öts
 & 
ATH9K_INT_TSFOOR
)

920 
mask2
 |
AR_IMR_S2_TSFOOR
;

923 i‡(
öts
 & (
ATH9K_INT_GTT
 | 
ATH9K_INT_CST
)) {

924 
mask
 |
AR_IMR_BCNMISC
;

925 i‡(
öts
 & 
ATH9K_INT_GTT
)

926 
mask2
 |
AR_IMR_S2_GTT
;

927 i‡(
öts
 & 
ATH9K_INT_CST
)

928 
mask2
 |
AR_IMR_S2_CST
;

931 i‡(
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_BB_WATCHDOG
) {

932 i‡(
öts
 & 
ATH9K_INT_BB_WATCHDOG
) {

933 
mask
 |
AR_IMR_BCNMISC
;

934 
mask2
 |
AR_IMR_S2_BB_WATCHDOG
;

938 
	`©h_dbg
(
comm⁄
, 
INTERRUPT
, "√w IMR 0x%x\n", 
mask
);

939 
	`REG_WRITE
(
ah
, 
AR_IMR
, 
mask
);

940 
ah
->
imrs2_ªg
 &~(
AR_IMR_S2_TIM
 |

941 
AR_IMR_S2_DTIM
 |

942 
AR_IMR_S2_DTIMSYNC
 |

943 
AR_IMR_S2_CABEND
 |

944 
AR_IMR_S2_CABTO
 |

945 
AR_IMR_S2_TSFOOR
 |

946 
AR_IMR_S2_GTT
 |

947 
AR_IMR_S2_CST
);

949 i‡(
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_BB_WATCHDOG
) {

950 i‡(
öts
 & 
ATH9K_INT_BB_WATCHDOG
)

951 
ah
->
imrs2_ªg
 &~
AR_IMR_S2_BB_WATCHDOG
;

954 
ah
->
imrs2_ªg
 |
mask2
;

955 
	`REG_WRITE
(
ah
, 
AR_IMR_S2
,áh->
imrs2_ªg
);

957 i‡(!(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
)) {

958 i‡(
öts
 & 
ATH9K_INT_TIM_TIMER
)

959 
	`REG_SET_BIT
(
ah
, 
AR_IMR_S5
, 
AR_IMR_S5_TIM_TIMER
);

961 
	`REG_CLR_BIT
(
ah
, 
AR_IMR_S5
, 
AR_IMR_S5_TIM_TIMER
);

965 
	}
}

966 
EXPORT_SYMBOL
(
©h9k_hw_£t_öãºu±s
);

968 
	#ATH9K_HW_MAX_DCU
 10

	)

969 
	#ATH9K_HW_SLICE_PER_DCU
 16

	)

970 
	#ATH9K_HW_BIT_IN_SLICE
 16

	)

971 
	$©h9k_hw_£t_tx_fûãr
(
©h_hw
 *
ah
, 
u8
 
de°idx
, 
boﬁ
 
£t
)

973 
dcu_idx
;

974 
u32
 
fûãr
;

976 
dcu_idx
 = 0; dcu_idx < 10; dcu_idx++) {

977 
fûãr
 = 
	`SM
(
£t
, 
AR_D_TXBLK_WRITE_COMMAND
);

978 
fûãr
 |
	`SM
(
dcu_idx
, 
AR_D_TXBLK_WRITE_DCU
);

979 
fûãr
 |
	`SM
((
de°idx
 / 
ATH9K_HW_SLICE_PER_DCU
),

980 
AR_D_TXBLK_WRITE_SLICE
);

981 
fûãr
 |
	`BIT
(
de°idx
 % 
ATH9K_HW_BIT_IN_SLICE
);

982 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
PS
,

984 
dcu_idx
, 
de°idx
, 
£t
, 
fûãr
);

985 
	`REG_WRITE
(
ah
, 
AR_D_TXBLK_BASE
, 
fûãr
);

987 
	}
}

988 
EXPORT_SYMBOL
(
©h9k_hw_£t_tx_fûãr
);

	@mac.h

17 #i‚de‡
MAC_H


18 
	#MAC_H


	)

20 
	#£t11nTrõs
(
_£rõs
, 
_ödex
) \

21 (
	`SM
((
_£rõs
)[
_ödex
].
Trõs
, 
AR_XmôD©aTrõs
##_ödex))

	)

23 
	#£t11nR©e
(
_£rõs
, 
_ödex
) \

24 (
	`SM
((
_£rõs
)[
_ödex
].
R©e
, 
AR_XmôR©e
##_ödex))

	)

26 
	#£t11nPktDurRTSCTS
(
_£rõs
, 
_ödex
) \

27 (
	`SM
((
_£rõs
)[
_ödex
].
PktDuøti⁄
, 
AR_PackëDur
##_index) | \

28 ((
_£rõs
)[
_ödex
].
R©eFœgs
 & 
ATH9K_RATESERIES_RTS_CTS
 ? \

29 
AR_RTSCTSQuÆ
##
_ödex
 : 0))

	)

31 
	#£t11nR©eFœgs
(
_£rõs
, 
_ödex
) \

32 (((
_£rõs
)[
_ödex
].
R©eFœgs
 & 
ATH9K_RATESERIES_2040
 ? \

33 
AR_2040_
##
_ödex
 : 0) \

34 |((
_£rõs
)[
_ödex
].
R©eFœgs
 & 
ATH9K_RATESERIES_HALFGI
 ? \

35 
AR_GI
##
_ödex
 : 0) \

36 |((
_£rõs
)[
_ödex
].
R©eFœgs
 & 
ATH9K_RATESERIES_STBC
 ? \

37 
AR_STBC
##
_ödex
 : 0) \

38 |
	`SM
((
_£rõs
)[
_ödex
].
ChSñ
, 
AR_ChaöSñ
##_ödex))

	)

40 
	#CCK_SIFS_TIME
 10

	)

41 
	#CCK_PREAMBLE_BITS
 144

	)

42 
	#CCK_PLCP_BITS
 48

	)

44 
	#OFDM_SIFS_TIME
 16

	)

45 
	#OFDM_PREAMBLE_TIME
 20

	)

46 
	#OFDM_PLCP_BITS
 22

	)

47 
	#OFDM_SYMBOL_TIME
 4

	)

49 
	#OFDM_SIFS_TIME_HALF
 32

	)

50 
	#OFDM_PREAMBLE_TIME_HALF
 40

	)

51 
	#OFDM_PLCP_BITS_HALF
 22

	)

52 
	#OFDM_SYMBOL_TIME_HALF
 8

	)

54 
	#OFDM_SIFS_TIME_QUARTER
 64

	)

55 
	#OFDM_PREAMBLE_TIME_QUARTER
 80

	)

56 
	#OFDM_PLCP_BITS_QUARTER
 22

	)

57 
	#OFDM_SYMBOL_TIME_QUARTER
 16

	)

59 
	#INIT_AIFS
 2

	)

60 
	#INIT_CWMIN
 15

	)

61 
	#INIT_CWMIN_11B
 31

	)

62 
	#INIT_CWMAX
 1023

	)

63 
	#INIT_SH_RETRY
 10

	)

64 
	#INIT_LG_RETRY
 10

	)

65 
	#INIT_SSH_RETRY
 32

	)

66 
	#INIT_SLG_RETRY
 32

	)

68 
	#ATH9K_SLOT_TIME_6
 6

	)

69 
	#ATH9K_SLOT_TIME_9
 9

	)

70 
	#ATH9K_SLOT_TIME_20
 20

	)

72 
	#ATH9K_TXERR_XRETRY
 0x01

	)

73 
	#ATH9K_TXERR_FILT
 0x02

	)

74 
	#ATH9K_TXERR_FIFO
 0x04

	)

75 
	#ATH9K_TXERR_XTXOP
 0x08

	)

76 
	#ATH9K_TXERR_TIMER_EXPIRED
 0x10

	)

77 
	#ATH9K_TX_ACKED
 0x20

	)

78 
	#ATH9K_TX_FLUSH
 0x40

	)

79 
	#ATH9K_TXERR_MASK
 \

80 (
ATH9K_TXERR_XRETRY
 | 
ATH9K_TXERR_FILT
 | 
ATH9K_TXERR_FIFO
 | \

81 
ATH9K_TXERR_XTXOP
 | 
ATH9K_TXERR_TIMER_EXPIRED
 | 
ATH9K_TX_FLUSH
)

	)

83 
	#ATH9K_TX_BA
 0x01

	)

84 
	#ATH9K_TX_PWRMGMT
 0x02

	)

85 
	#ATH9K_TX_DESC_CFG_ERR
 0x04

	)

86 
	#ATH9K_TX_DATA_UNDERRUN
 0x08

	)

87 
	#ATH9K_TX_DELIM_UNDERRUN
 0x10

	)

88 
	#ATH9K_TX_SW_FILTERED
 0x80

	)

91 
	#MIN_TX_FIFO_THRESHOLD
 0x1

	)

98 
	#MAX_TX_FIFO_THRESHOLD
 ((4096 / 64Ë- 1)

	)

100 
	s©h_tx_°©us
 {

101 
u32
 
	mts_t°amp
;

102 
u16
 
	mts_£qnum
;

103 
u8
 
	mts_°©us
;

104 
u8
 
	mts_øãödex
;

105 
öt8_t
 
	mts_rssi
;

106 
u8
 
	mts_sh‹åëry
;

107 
u8
 
	mts_l⁄gªåy
;

108 
u8
 
	mts_vútcﬁ
;

109 
u8
 
	mts_Êags
;

110 
öt8_t
 
	mts_rssi_˘l0
;

111 
öt8_t
 
	mts_rssi_˘l1
;

112 
öt8_t
 
	mts_rssi_˘l2
;

113 
öt8_t
 
	mts_rssi_ext0
;

114 
öt8_t
 
	mts_rssi_ext1
;

115 
öt8_t
 
	mts_rssi_ext2
;

116 
u8
 
	mqid
;

117 
u16
 
	mdesc_id
;

118 
u8
 
	mtid
;

119 
u32
 
	mba_low
;

120 
u32
 
	mba_high
;

121 
u32
 
	mevm0
;

122 
u32
 
	mevm1
;

123 
u32
 
	mevm2
;

124 
u32
 
	mduøti⁄
;

127 
	s©h_rx_°©us
 {

128 
u32
 
	mrs_t°amp
;

129 
u16
 
	mrs_d©Æí
;

130 
u8
 
	mrs_°©us
;

131 
u8
 
	mrs_phyîr
;

132 
öt8_t
 
	mrs_rssi
;

133 
u8
 
	mrs_keyix
;

134 
u8
 
	mrs_øã
;

135 
u8
 
	mrs_™ã¬a
;

136 
u8
 
	mrs_m‹e
;

137 
öt8_t
 
	mrs_rssi_˘l
[3];

138 
öt8_t
 
	mrs_rssi_ext
[3];

139 
u8
 
	mrs_ißggr
;

140 
u8
 
	mrs_fú°aggr
;

141 
u8
 
	mrs_m‹óggr
;

142 
u8
 
	mrs_num_dñims
;

143 
u8
 
	mrs_Êags
;

144 
boﬁ
 
	mis_mybóc⁄
;

145 
u32
 
	mevm0
;

146 
u32
 
	mevm1
;

147 
u32
 
	mevm2
;

148 
u32
 
	mevm3
;

149 
u32
 
	mevm4
;

150 
u32
 
	mÊag
;

153 
	s©h_htc_rx_°©us
 {

154 
__be64
 
	mrs_t°amp
;

155 
__be16
 
	mrs_d©Æí
;

156 
u8
 
	mrs_°©us
;

157 
u8
 
	mrs_phyîr
;

158 
öt8_t
 
	mrs_rssi
;

159 
öt8_t
 
	mrs_rssi_˘l
[3];

160 
öt8_t
 
	mrs_rssi_ext
[3];

161 
u8
 
	mrs_keyix
;

162 
u8
 
	mrs_øã
;

163 
u8
 
	mrs_™ã¬a
;

164 
u8
 
	mrs_m‹e
;

165 
u8
 
	mrs_ißggr
;

166 
u8
 
	mrs_m‹óggr
;

167 
u8
 
	mrs_num_dñims
;

168 
u8
 
	mrs_Êags
;

169 
u8
 
	mrs_dummy
;

171 
__be32
 
	mevm0
;

172 
__be32
 
	mevm1
;

173 
__be32
 
	mevm2
;

176 
	#ATH9K_RXERR_CRC
 0x01

	)

177 
	#ATH9K_RXERR_PHY
 0x02

	)

178 
	#ATH9K_RXERR_FIFO
 0x04

	)

179 
	#ATH9K_RXERR_DECRYPT
 0x08

	)

180 
	#ATH9K_RXERR_MIC
 0x10

	)

181 
	#ATH9K_RXERR_KEYMISS
 0x20

	)

182 
	#ATH9K_RXERR_CORRUPT_DESC
 0x40

	)

184 
	#ATH9K_RX_MORE
 0x01

	)

185 
	#ATH9K_RX_MORE_AGGR
 0x02

	)

186 
	#ATH9K_RX_GI
 0x04

	)

187 
	#ATH9K_RX_2040
 0x08

	)

188 
	#ATH9K_RX_DELIM_CRC_PRE
 0x10

	)

189 
	#ATH9K_RX_DELIM_CRC_POST
 0x20

	)

190 
	#ATH9K_RX_DECRYPT_BUSY
 0x40

	)

192 
	#ATH9K_RXKEYIX_INVALID
 ((
u8
)-1)

	)

193 
	#ATH9K_TXKEYIX_INVALID
 ((
u8
)-1)

	)

195 
	e©h9k_phyîr
 {

196 
	mATH9K_PHYERR_UNDERRUN
 = 0,

197 
	mATH9K_PHYERR_TIMING
 = 1,

198 
	mATH9K_PHYERR_PARITY
 = 2,

199 
	mATH9K_PHYERR_RATE
 = 3,

200 
	mATH9K_PHYERR_LENGTH
 = 4,

201 
	mATH9K_PHYERR_RADAR
 = 5,

202 
	mATH9K_PHYERR_SERVICE
 = 6,

203 
	mATH9K_PHYERR_TOR
 = 7,

205 
	mATH9K_PHYERR_OFDM_TIMING
 = 17,

206 
	mATH9K_PHYERR_OFDM_SIGNAL_PARITY
 = 18,

207 
	mATH9K_PHYERR_OFDM_RATE_ILLEGAL
 = 19,

208 
	mATH9K_PHYERR_OFDM_LENGTH_ILLEGAL
 = 20,

209 
	mATH9K_PHYERR_OFDM_POWER_DROP
 = 21,

210 
	mATH9K_PHYERR_OFDM_SERVICE
 = 22,

211 
	mATH9K_PHYERR_OFDM_RESTART
 = 23,

213 
	mATH9K_PHYERR_CCK_BLOCKER
 = 24,

214 
	mATH9K_PHYERR_CCK_TIMING
 = 25,

215 
	mATH9K_PHYERR_CCK_HEADER_CRC
 = 26,

216 
	mATH9K_PHYERR_CCK_RATE_ILLEGAL
 = 27,

217 
	mATH9K_PHYERR_CCK_LENGTH_ILLEGAL
 = 28,

218 
	mATH9K_PHYERR_CCK_POWER_DROP
 = 29,

219 
	mATH9K_PHYERR_CCK_SERVICE
 = 30,

220 
	mATH9K_PHYERR_CCK_RESTART
 = 31,

222 
	mATH9K_PHYERR_HT_CRC_ERROR
 = 32,

223 
	mATH9K_PHYERR_HT_LENGTH_ILLEGAL
 = 33,

224 
	mATH9K_PHYERR_HT_RATE_ILLEGAL
 = 34,

225 
	mATH9K_PHYERR_HT_ZLF
 = 35,

227 
	mATH9K_PHYERR_FALSE_RADAR_EXT
 = 36,

228 
	mATH9K_PHYERR_GREEN_FIELD
 = 37,

229 
	mATH9K_PHYERR_SPECTRAL
 = 38,

231 
	mATH9K_PHYERR_MAX
 = 39,

234 
	s©h_desc
 {

235 
u32
 
	mds_lök
;

236 
u32
 
	mds_d©a
;

237 
u32
 
	mds_˘l0
;

238 
u32
 
	mds_˘l1
;

239 
u32
 
	mds_hw
[20];

240 *
	mds_vd©a
;

241 } 
__∑cked
 
__Æig√d
(4);

243 
	#ATH9K_TXDESC_NOACK
 0x0002

	)

244 
	#ATH9K_TXDESC_RTSENA
 0x0004

	)

245 
	#ATH9K_TXDESC_CTSENA
 0x0008

	)

259 
	#ATH9K_TXDESC_INTREQ
 0x0010

	)

260 
	#ATH9K_TXDESC_VEOL
 0x0020

	)

261 
	#ATH9K_TXDESC_EXT_ONLY
 0x0040

	)

262 
	#ATH9K_TXDESC_EXT_AND_CTL
 0x0080

	)

263 
	#ATH9K_TXDESC_VMF
 0x0100

	)

264 
	#ATH9K_TXDESC_FRAG_IS_ON
 0x0200

	)

265 
	#ATH9K_TXDESC_LOWRXCHAIN
 0x0400

	)

266 
	#ATH9K_TXDESC_LDPC
 0x0800

	)

267 
	#ATH9K_TXDESC_CLRDMASK
 0x1000

	)

269 
	#ATH9K_TXDESC_PAPRD
 0x70000

	)

270 
	#ATH9K_TXDESC_PAPRD_S
 16

	)

272 
	#ATH9K_RXDESC_INTREQ
 0x0020

	)

274 
	s¨5416_desc
 {

275 
u32
 
	mds_lök
;

276 
u32
 
	mds_d©a
;

277 
u32
 
	mds_˘l0
;

278 
u32
 
	mds_˘l1
;

281 
u32
 
	m˘l2
;

282 
u32
 
	m˘l3
;

283 
u32
 
	m˘l4
;

284 
u32
 
	m˘l5
;

285 
u32
 
	m˘l6
;

286 
u32
 
	m˘l7
;

287 
u32
 
	m˘l8
;

288 
u32
 
	m˘l9
;

289 
u32
 
	m˘l10
;

290 
u32
 
	m˘l11
;

291 
u32
 
	m°©us0
;

292 
u32
 
	m°©us1
;

293 
u32
 
	m°©us2
;

294 
u32
 
	m°©us3
;

295 
u32
 
	m°©us4
;

296 
u32
 
	m°©us5
;

297 
u32
 
	m°©us6
;

298 
u32
 
	m°©us7
;

299 
u32
 
	m°©us8
;

300 
u32
 
	m°©us9
;

301 } 
	mtx
;

303 
u32
 
	m°©us0
;

304 
u32
 
	m°©us1
;

305 
u32
 
	m°©us2
;

306 
u32
 
	m°©us3
;

307 
u32
 
	m°©us4
;

308 
u32
 
	m°©us5
;

309 
u32
 
	m°©us6
;

310 
u32
 
	m°©us7
;

311 
u32
 
	m°©us8
;

312 } 
	mrx
;

313 } 
	mu
;

314 } 
__∑cked
 
__Æig√d
(4);

316 
	#AR5416DESC
(
_ds
Ë((
¨5416_desc
 *)(_ds))

	)

317 
	#AR5416DESC_CONST
(
_ds
Ë((c⁄° 
¨5416_desc
 *)(_ds))

	)

319 
	#ds_˘l2
 
u
.
tx
.
˘l2


	)

320 
	#ds_˘l3
 
u
.
tx
.
˘l3


	)

321 
	#ds_˘l4
 
u
.
tx
.
˘l4


	)

322 
	#ds_˘l5
 
u
.
tx
.
˘l5


	)

323 
	#ds_˘l6
 
u
.
tx
.
˘l6


	)

324 
	#ds_˘l7
 
u
.
tx
.
˘l7


	)

325 
	#ds_˘l8
 
u
.
tx
.
˘l8


	)

326 
	#ds_˘l9
 
u
.
tx
.
˘l9


	)

327 
	#ds_˘l10
 
u
.
tx
.
˘l10


	)

328 
	#ds_˘l11
 
u
.
tx
.
˘l11


	)

330 
	#ds_tx°©us0
 
u
.
tx
.
°©us0


	)

331 
	#ds_tx°©us1
 
u
.
tx
.
°©us1


	)

332 
	#ds_tx°©us2
 
u
.
tx
.
°©us2


	)

333 
	#ds_tx°©us3
 
u
.
tx
.
°©us3


	)

334 
	#ds_tx°©us4
 
u
.
tx
.
°©us4


	)

335 
	#ds_tx°©us5
 
u
.
tx
.
°©us5


	)

336 
	#ds_tx°©us6
 
u
.
tx
.
°©us6


	)

337 
	#ds_tx°©us7
 
u
.
tx
.
°©us7


	)

338 
	#ds_tx°©us8
 
u
.
tx
.
°©us8


	)

339 
	#ds_tx°©us9
 
u
.
tx
.
°©us9


	)

341 
	#ds_rx°©us0
 
u
.
rx
.
°©us0


	)

342 
	#ds_rx°©us1
 
u
.
rx
.
°©us1


	)

343 
	#ds_rx°©us2
 
u
.
rx
.
°©us2


	)

344 
	#ds_rx°©us3
 
u
.
rx
.
°©us3


	)

345 
	#ds_rx°©us4
 
u
.
rx
.
°©us4


	)

346 
	#ds_rx°©us5
 
u
.
rx
.
°©us5


	)

347 
	#ds_rx°©us6
 
u
.
rx
.
°©us6


	)

348 
	#ds_rx°©us7
 
u
.
rx
.
°©us7


	)

349 
	#ds_rx°©us8
 
u
.
rx
.
°©us8


	)

351 
	#AR_FømeLí
 0x00000fff

	)

352 
	#AR_VútM‹eFøg
 0x00001000

	)

353 
	#AR_TxCéRsvd00
 0x0000e000

	)

354 
	#AR_XmôPowî0
 0x003f0000

	)

355 
	#AR_XmôPowî0_S
 16

	)

356 
	#AR_XmôPowî1
 0x3f000000

	)

357 
	#AR_XmôPowî1_S
 24

	)

358 
	#AR_XmôPowî2
 0x3f000000

	)

359 
	#AR_XmôPowî2_S
 24

	)

360 
	#AR_XmôPowî3
 0x3f000000

	)

361 
	#AR_XmôPowî3_S
 24

	)

362 
	#AR_RTSE«bÀ
 0x00400000

	)

363 
	#AR_VEOL
 0x00800000

	)

364 
	#AR_CÃDe°Mask
 0x01000000

	)

365 
	#AR_TxCéRsvd01
 0x1e000000

	)

366 
	#AR_TxI¡rReq
 0x20000000

	)

367 
	#AR_De°IdxVÆid
 0x40000000

	)

368 
	#AR_CTSE«bÀ
 0x80000000

	)

370 
	#AR_TxM‹e
 0x00001000

	)

371 
	#AR_De°Idx
 0x000„000

	)

372 
	#AR_De°Idx_S
 13

	)

373 
	#AR_FømeTy≥
 0x00f00000

	)

374 
	#AR_FømeTy≥_S
 20

	)

375 
	#AR_NoAck
 0x01000000

	)

376 
	#AR_In£πTS
 0x02000000

	)

377 
	#AR_C‹ru±FCS
 0x04000000

	)

378 
	#AR_ExtO∆y
 0x08000000

	)

379 
	#AR_ExtAndCé
 0x10000000

	)

380 
	#AR_M‹eAggr
 0x20000000

	)

381 
	#AR_IsAggr
 0x40000000

	)

383 
	#AR_Bur°Dur
 0x00007fff

	)

384 
	#AR_Bur°Dur_S
 0

	)

385 
	#AR_DurUpd©eE«
 0x00008000

	)

386 
	#AR_XmôD©aTrõs0
 0x000f0000

	)

387 
	#AR_XmôD©aTrõs0_S
 16

	)

388 
	#AR_XmôD©aTrõs1
 0x00f00000

	)

389 
	#AR_XmôD©aTrõs1_S
 20

	)

390 
	#AR_XmôD©aTrõs2
 0x0f000000

	)

391 
	#AR_XmôD©aTrõs2_S
 24

	)

392 
	#AR_XmôD©aTrõs3
 0xf0000000

	)

393 
	#AR_XmôD©aTrõs3_S
 28

	)

395 
	#AR_XmôR©e0
 0x000000ff

	)

396 
	#AR_XmôR©e0_S
 0

	)

397 
	#AR_XmôR©e1
 0x0000ff00

	)

398 
	#AR_XmôR©e1_S
 8

	)

399 
	#AR_XmôR©e2
 0x00ff0000

	)

400 
	#AR_XmôR©e2_S
 16

	)

401 
	#AR_XmôR©e3
 0xff000000

	)

402 
	#AR_XmôR©e3_S
 24

	)

404 
	#AR_PackëDur0
 0x00007fff

	)

405 
	#AR_PackëDur0_S
 0

	)

406 
	#AR_RTSCTSQuÆ0
 0x00008000

	)

407 
	#AR_PackëDur1
 0x7fff0000

	)

408 
	#AR_PackëDur1_S
 16

	)

409 
	#AR_RTSCTSQuÆ1
 0x80000000

	)

411 
	#AR_PackëDur2
 0x00007fff

	)

412 
	#AR_PackëDur2_S
 0

	)

413 
	#AR_RTSCTSQuÆ2
 0x00008000

	)

414 
	#AR_PackëDur3
 0x7fff0000

	)

415 
	#AR_PackëDur3_S
 16

	)

416 
	#AR_RTSCTSQuÆ3
 0x80000000

	)

418 
	#AR_AggrLí
 0x0000ffff

	)

419 
	#AR_AggrLí_S
 0

	)

420 
	#AR_TxCéRsvd60
 0x00030000

	)

421 
	#AR_PadDñim
 0x03fc0000

	)

422 
	#AR_PadDñim_S
 18

	)

423 
	#AR_En¸Ty≥
 0x0c000000

	)

424 
	#AR_En¸Ty≥_S
 26

	)

425 
	#AR_TxCéRsvd61
 0xf0000000

	)

426 
	#AR_LDPC
 0x80000000

	)

428 
	#AR_2040_0
 0x00000001

	)

429 
	#AR_GI0
 0x00000002

	)

430 
	#AR_ChaöSñ0
 0x0000001c

	)

431 
	#AR_ChaöSñ0_S
 2

	)

432 
	#AR_2040_1
 0x00000020

	)

433 
	#AR_GI1
 0x00000040

	)

434 
	#AR_ChaöSñ1
 0x00000380

	)

435 
	#AR_ChaöSñ1_S
 7

	)

436 
	#AR_2040_2
 0x00000400

	)

437 
	#AR_GI2
 0x00000800

	)

438 
	#AR_ChaöSñ2
 0x00007000

	)

439 
	#AR_ChaöSñ2_S
 12

	)

440 
	#AR_2040_3
 0x00008000

	)

441 
	#AR_GI3
 0x00010000

	)

442 
	#AR_ChaöSñ3
 0x000e0000

	)

443 
	#AR_ChaöSñ3_S
 17

	)

444 
	#AR_RTSCTSR©e
 0x0ff00000

	)

445 
	#AR_RTSCTSR©e_S
 20

	)

446 
	#AR_STBC0
 0x10000000

	)

447 
	#AR_STBC1
 0x20000000

	)

448 
	#AR_STBC2
 0x40000000

	)

449 
	#AR_STBC3
 0x80000000

	)

451 
	#AR_TxRSSIA¡00
 0x000000ff

	)

452 
	#AR_TxRSSIA¡00_S
 0

	)

453 
	#AR_TxRSSIA¡01
 0x0000ff00

	)

454 
	#AR_TxRSSIA¡01_S
 8

	)

455 
	#AR_TxRSSIA¡02
 0x00ff0000

	)

456 
	#AR_TxRSSIA¡02_S
 16

	)

457 
	#AR_TxSètusRsvd00
 0x3f000000

	)

458 
	#AR_TxBaSètus
 0x40000000

	)

459 
	#AR_TxSètusRsvd01
 0x80000000

	)

466 
	#AR_FrmXmôOK
 0x00000001

	)

467 
	#AR_Ex˚ssiveRërõs
 0x00000002

	)

468 
	#AR_FIFOUndîrun
 0x00000004

	)

469 
	#AR_Fûãªd
 0x00000008

	)

470 
	#AR_RTSFaûC¡
 0x000000f0

	)

471 
	#AR_RTSFaûC¡_S
 4

	)

472 
	#AR_D©aFaûC¡
 0x00000f00

	)

473 
	#AR_D©aFaûC¡_S
 8

	)

474 
	#AR_VútRëryC¡
 0x0000f000

	)

475 
	#AR_VútRëryC¡_S
 12

	)

476 
	#AR_TxDñimUndîrun
 0x00010000

	)

477 
	#AR_TxD©aUndîrun
 0x00020000

	)

478 
	#AR_DescCfgEº
 0x00040000

	)

479 
	#AR_TxTimîExpúed
 0x00080000

	)

480 
	#AR_TxSètusRsvd10
 0xfff00000

	)

482 
	#AR_SídTime°amp
 
ds_tx°©us2


	)

483 
	#AR_BaBôm≠Low
 
ds_tx°©us3


	)

484 
	#AR_BaBôm≠High
 
ds_tx°©us4


	)

486 
	#AR_TxRSSIA¡10
 0x000000ff

	)

487 
	#AR_TxRSSIA¡10_S
 0

	)

488 
	#AR_TxRSSIA¡11
 0x0000ff00

	)

489 
	#AR_TxRSSIA¡11_S
 8

	)

490 
	#AR_TxRSSIA¡12
 0x00ff0000

	)

491 
	#AR_TxRSSIA¡12_S
 16

	)

492 
	#AR_TxRSSIComböed
 0xff000000

	)

493 
	#AR_TxRSSIComböed_S
 24

	)

495 
	#AR_TxTid
 0xf0000000

	)

496 
	#AR_TxTid_S
 28

	)

498 
	#AR_TxEVM0
 
ds_tx°©us5


	)

499 
	#AR_TxEVM1
 
ds_tx°©us6


	)

500 
	#AR_TxEVM2
 
ds_tx°©us7


	)

502 
	#AR_TxD⁄e
 0x00000001

	)

503 
	#AR_SeqNum
 0x00001f„

	)

504 
	#AR_SeqNum_S
 1

	)

505 
	#AR_TxSètusRsvd80
 0x0001e000

	)

506 
	#AR_TxOpEx˚eded
 0x00020000

	)

507 
	#AR_TxSètusRsvd81
 0x001c0000

	)

508 
	#AR_FöÆTxIdx
 0x00600000

	)

509 
	#AR_FöÆTxIdx_S
 21

	)

510 
	#AR_TxSètusRsvd82
 0x01800000

	)

511 
	#AR_PowîMgmt
 0x02000000

	)

512 
	#AR_TxSètusRsvd83
 0xfc000000

	)

514 
	#AR_RxCTLRsvd00
 0xffffffff

	)

516 
	#AR_RxCéRsvd00
 0x00001000

	)

517 
	#AR_RxI¡rReq
 0x00002000

	)

518 
	#AR_RxCéRsvd01
 0xffffc000

	)

520 
	#AR_RxRSSIA¡00
 0x000000ff

	)

521 
	#AR_RxRSSIA¡00_S
 0

	)

522 
	#AR_RxRSSIA¡01
 0x0000ff00

	)

523 
	#AR_RxRSSIA¡01_S
 8

	)

524 
	#AR_RxRSSIA¡02
 0x00ff0000

	)

525 
	#AR_RxRSSIA¡02_S
 16

	)

526 
	#AR_RxR©e
 0xff000000

	)

527 
	#AR_RxR©e_S
 24

	)

528 
	#AR_RxSètusRsvd00
 0xff000000

	)

530 
	#AR_D©aLí
 0x00000fff

	)

531 
	#AR_RxM‹e
 0x00001000

	)

532 
	#AR_NumDñim
 0x003fc000

	)

533 
	#AR_NumDñim_S
 14

	)

534 
	#AR_RxSètusRsvd10
 0xff800000

	)

536 
	#AR_RcvTime°amp
 
ds_rx°©us2


	)

538 
	#AR_GI
 0x00000001

	)

539 
	#AR_2040
 0x00000002

	)

540 
	#AR_P¨ÆÀl40
 0x00000004

	)

541 
	#AR_P¨ÆÀl40_S
 2

	)

542 
	#AR_STBC
 0x00000008

	)

543 
	#AR_RxSètusRsvd30
 0x000000f0

	)

544 
	#AR_RxA¡í«
 0xffffff00

	)

545 
	#AR_RxA¡í«_S
 8

	)

547 
	#AR_RxRSSIA¡10
 0x000000ff

	)

548 
	#AR_RxRSSIA¡10_S
 0

	)

549 
	#AR_RxRSSIA¡11
 0x0000ff00

	)

550 
	#AR_RxRSSIA¡11_S
 8

	)

551 
	#AR_RxRSSIA¡12
 0x00ff0000

	)

552 
	#AR_RxRSSIA¡12_S
 16

	)

553 
	#AR_RxRSSIComböed
 0xff000000

	)

554 
	#AR_RxRSSIComböed_S
 24

	)

556 
	#AR_RxEVM0
 
ds_rx°©us4


	)

557 
	#AR_RxEVM1
 
ds_rx°©us5


	)

558 
	#AR_RxEVM2
 
ds_rx°©us6


	)

560 
	#AR_RxD⁄e
 0x00000001

	)

561 
	#AR_RxFømeOK
 0x00000002

	)

562 
	#AR_CRCEº
 0x00000004

	)

563 
	#AR_De¸y±CRCEº
 0x00000008

	)

564 
	#AR_PHYEº
 0x00000010

	)

565 
	#AR_Mich´lEº
 0x00000020

	)

566 
	#AR_PªDñimCRCEº
 0x00000040

	)

567 
	#AR_RxSètusRsvd70
 0x00000080

	)

568 
	#AR_RxKeyIdxVÆid
 0x00000100

	)

569 
	#AR_KeyIdx
 0x0000„00

	)

570 
	#AR_KeyIdx_S
 9

	)

571 
	#AR_PHYEºCode
 0x0000ff00

	)

572 
	#AR_PHYEºCode_S
 8

	)

573 
	#AR_RxM‹eAggr
 0x00010000

	)

574 
	#AR_RxAggr
 0x00020000

	)

575 
	#AR_Po°DñimCRCEº
 0x00040000

	)

576 
	#AR_RxSètusRsvd71
 0x3ff80000

	)

577 
	#AR_RxFú°Aggr
 0x20000000

	)

578 
	#AR_De¸y±BusyEº
 0x40000000

	)

579 
	#AR_KeyMiss
 0x80000000

	)

581 
	e©h9k_tx_queue
 {

582 
	mATH9K_TX_QUEUE_INACTIVE
 = 0,

583 
	mATH9K_TX_QUEUE_DATA
,

584 
	mATH9K_TX_QUEUE_BEACON
,

585 
	mATH9K_TX_QUEUE_CAB
,

586 
	mATH9K_TX_QUEUE_UAPSD
,

587 
	mATH9K_TX_QUEUE_PSPOLL


590 
	#ATH9K_NUM_TX_QUEUES
 10

	)

593 
	#ATH9K_WME_UPSD
 4

	)

595 
	e©h9k_tx_queue_Êags
 {

596 
	mTXQ_FLAG_TXINT_ENABLE
 = 0x0001,

597 
	mTXQ_FLAG_TXDESCINT_ENABLE
 = 0x0002,

598 
	mTXQ_FLAG_TXEOLINT_ENABLE
 = 0x0004,

599 
	mTXQ_FLAG_TXURNINT_ENABLE
 = 0x0008,

600 
	mTXQ_FLAG_BACKOFF_DISABLE
 = 0x0010,

601 
	mTXQ_FLAG_COMPRESSION_ENABLE
 = 0x0020,

602 
	mTXQ_FLAG_RDYTIME_EXP_POLICY_ENABLE
 = 0x0040,

603 
	mTXQ_FLAG_FRAG_BURST_BACKOFF_ENABLE
 = 0x0080,

606 
	#ATH9K_TXQ_USEDEFAULT
 ((
u32
Ë-1)

	)

607 
	#ATH9K_TXQ_USE_LOCKOUT_BKOFF_DIS
 0x00000001

	)

609 
	#ATH9K_DECOMP_MASK_SIZE
 128

	)

611 
	e©h9k_pkt_ty≥
 {

612 
	mATH9K_PKT_TYPE_NORMAL
 = 0,

613 
	mATH9K_PKT_TYPE_ATIM
,

614 
	mATH9K_PKT_TYPE_PSPOLL
,

615 
	mATH9K_PKT_TYPE_BEACON
,

616 
	mATH9K_PKT_TYPE_PROBE_RESP
,

617 
	mATH9K_PKT_TYPE_CHIRP
,

618 
	mATH9K_PKT_TYPE_GRP_POLL
,

621 
	s©h9k_tx_queue_öfo
 {

622 
u32
 
	mtqi_vî
;

623 
©h9k_tx_queue
 
	mtqi_ty≥
;

624 
	mtqi_subty≥
;

625 
©h9k_tx_queue_Êags
 
	mtqi_qÊags
;

626 
u32
 
	mtqi_¥i‹ôy
;

627 
u32
 
	mtqi_aifs
;

628 
u32
 
	mtqi_cwmö
;

629 
u32
 
	mtqi_cwmax
;

630 
u16
 
	mtqi_shªåy
;

631 
u16
 
	mtqi_lgªåy
;

632 
u32
 
	mtqi_cbrPîiod
;

633 
u32
 
	mtqi_cbrOvîÊowLimô
;

634 
u32
 
	mtqi_bur°Time
;

635 
u32
 
	mtqi_ªadyTime
;

636 
u32
 
	mtqi_physCompBuf
;

637 
u32
 
	mtqi_ötFœgs
;

640 
	e©h9k_rx_fûãr
 {

641 
	mATH9K_RX_FILTER_UCAST
 = 0x00000001,

642 
	mATH9K_RX_FILTER_MCAST
 = 0x00000002,

643 
	mATH9K_RX_FILTER_BCAST
 = 0x00000004,

644 
	mATH9K_RX_FILTER_CONTROL
 = 0x00000008,

645 
	mATH9K_RX_FILTER_BEACON
 = 0x00000010,

646 
	mATH9K_RX_FILTER_PROM
 = 0x00000020,

647 
	mATH9K_RX_FILTER_PROBEREQ
 = 0x00000080,

648 
	mATH9K_RX_FILTER_PHYERR
 = 0x00000100,

649 
	mATH9K_RX_FILTER_MYBEACON
 = 0x00000200,

650 
	mATH9K_RX_FILTER_COMP_BAR
 = 0x00000400,

651 
	mATH9K_RX_FILTER_COMP_BA
 = 0x00000800,

652 
	mATH9K_RX_FILTER_UNCOMP_BA_BAR
 = 0x00001000,

653 
	mATH9K_RX_FILTER_PSPOLL
 = 0x00004000,

654 
	mATH9K_RX_FILTER_PHYRADAR
 = 0x00002000,

655 
	mATH9K_RX_FILTER_MCAST_BCAST_ALL
 = 0x00008000,

656 
	mATH9K_RX_FILTER_CONTROL_WRAPPER
 = 0x00080000,

657 
	mATH9K_RX_FILTER_4ADDRESS
 = 0x00100000,

660 
	#ATH9K_RATESERIES_RTS_CTS
 0x0001

	)

661 
	#ATH9K_RATESERIES_2040
 0x0002

	)

662 
	#ATH9K_RATESERIES_HALFGI
 0x0004

	)

663 
	#ATH9K_RATESERIES_STBC
 0x0008

	)

665 
	s©h9k_11n_øã_£rõs
 {

666 
u32
 
	mTrõs
;

667 
u32
 
	mR©e
;

668 
u32
 
	mPktDuøti⁄
;

669 
u32
 
	mChSñ
;

670 
u32
 
	mR©eFœgs
;

673 
	eaggr_ty≥
 {

674 
	mAGGR_BUF_NONE
,

675 
	mAGGR_BUF_FIRST
,

676 
	mAGGR_BUF_MIDDLE
,

677 
	mAGGR_BUF_LAST
,

680 
	e©h9k_key_ty≥
 {

681 
	mATH9K_KEY_TYPE_CLEAR
,

682 
	mATH9K_KEY_TYPE_WEP
,

683 
	mATH9K_KEY_TYPE_AES
,

684 
	mATH9K_KEY_TYPE_TKIP
,

687 
	s©h_tx_öfo
 {

688 
u8
 
	mqcu
;

690 
boﬁ
 
	mis_fú°
;

691 
boﬁ
 
	mis_œ°
;

693 
aggr_ty≥
 
	maggr
;

694 
u8
 
	mndñim
;

695 
u16
 
	maggr_Àn
;

697 
dma_addr_t
 
	mlök
;

698 
	mpkt_Àn
;

699 
u32
 
	mÊags
;

701 
dma_addr_t
 
	mbuf_addr
[4];

702 
	mbuf_Àn
[4];

704 
©h9k_11n_øã_£rõs
 
	møãs
[4];

705 
u8
 
	mπs˘s_øã
;

706 
boﬁ
 
	mdur_upd©e
;

708 
©h9k_pkt_ty≥
 
	mty≥
;

709 
©h9k_key_ty≥
 
	mkeyty≥
;

710 
u8
 
	mkeyix
;

711 
u8
 
	mtxpowî
[4];

714 
	g©h_hw
;

715 
	g©h9k_ch™√l
;

716 
	g©h9k_öt
;

718 
u32
 
©h9k_hw_gëtxbuf
(
©h_hw
 *
ah
, u32 
q
);

719 
©h9k_hw_puâxbuf
(
©h_hw
 *
ah
, 
u32
 
q
, u32 
txdp
);

720 
©h9k_hw_tx°¨t
(
©h_hw
 *
ah
, 
u32
 
q
);

721 
u32
 
©h9k_hw_numtx≥ndög
(
©h_hw
 *
ah
, u32 
q
);

722 
boﬁ
 
©h9k_hw_upd©ëxåigÀvñ
(
©h_hw
 *
ah
, boﬁ 
bIncTrigLevñ
);

723 
boﬁ
 
©h9k_hw_°›_dma_queue
(
©h_hw
 *
ah
, 
u32
 
q
);

724 
©h9k_hw_ab‹t_tx_dma
(
©h_hw
 *
ah
);

725 
boﬁ
 
©h9k_hw_£t_txq_¥›s
(
©h_hw
 *
ah
, 
q
,

726 c⁄° 
©h9k_tx_queue_öfo
 *
qöfo
);

727 
boﬁ
 
©h9k_hw_gë_txq_¥›s
(
©h_hw
 *
ah
, 
q
,

728 
©h9k_tx_queue_öfo
 *
qöfo
);

729 
©h9k_hw_£tu±xqueue
(
©h_hw
 *
ah
, 
©h9k_tx_queue
 
ty≥
,

730 c⁄° 
©h9k_tx_queue_öfo
 *
qöfo
);

731 
boﬁ
 
©h9k_hw_ªÀa£txqueue
(
©h_hw
 *
ah
, 
u32
 
q
);

732 
boﬁ
 
©h9k_hw_ª£âxqueue
(
©h_hw
 *
ah
, 
u32
 
q
);

733 
©h9k_hw_rx¥ocdesc
(
©h_hw
 *
ah
, 
©h_desc
 *
ds
,

734 
©h_rx_°©us
 *
rs
);

735 
©h9k_hw_£tu¥xdesc
(
©h_hw
 *
ah
, 
©h_desc
 *
ds
,

736 
u32
 
size
, u32 
Êags
);

737 
boﬁ
 
©h9k_hw_£åxab‹t
(
©h_hw
 *
ah
, boﬁ 
£t
);

738 
©h9k_hw_puåxbuf
(
©h_hw
 *
ah
, 
u32
 
rxdp
);

739 
©h9k_hw_°¨çcuª˚ive
(
©h_hw
 *
ah
, 
boﬁ
 
is_sˇ¬ög
);

740 
©h9k_hw_ab‹çcuªcv
(
©h_hw
 *
ah
);

741 
boﬁ
 
©h9k_hw_°›dm¨ecv
(
©h_hw
 *
ah
, boﬁ *
ª£t
);

742 
©h9k_hw_bóc⁄q_£tup
(
©h_hw
 *
ah
);

743 
©h9k_hw_£t_tx_fûãr
(
©h_hw
 *
ah
, 
u8
 
de°idx
, 
boﬁ
 
£t
);

746 
boﬁ
 
©h9k_hw_öå≥nd
(
©h_hw
 *
ah
);

747 
©h9k_hw_£t_öãºu±s
(
©h_hw
 *
ah
);

748 
©h9k_hw_íabÀ_öãºu±s
(
©h_hw
 *
ah
);

749 
©h9k_hw_dißbÀ_öãºu±s
(
©h_hw
 *
ah
);

750 
©h9k_hw_kûl_öãºu±s
(
©h_hw
 *
ah
);

752 
¨9002_hw_©èch_mac_›s
(
©h_hw
 *
ah
);

	@main.c

17 
	~<löux/∆80211.h
>

18 
	~<löux/dñay.h
>

19 
	~"©h9k.h
"

20 
	~"btc€x.h
"

22 
u8
 
	$©h9k_∑r£_mpdudísôy
(
u8
 
mpdudísôy
)

35 
mpdudísôy
) {

55 
	}
}

57 
boﬁ
 
	$©h9k_has_≥ndög_‰ames
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

58 
boﬁ
 
sw_≥ndög
)

60 
boﬁ
 
≥ndög
 = 
Ál£
;

62 
	`•ö_lock_bh
(&
txq
->
axq_lock
);

64 i‡(
txq
->
axq_dïth
) {

65 
≥ndög
 = 
åue
;

66 
out
;

69 i‡(!
sw_≥ndög
)

70 
out
;

72 i‡(
txq
->
mac80211_qnum
 >= 0) {

73 
li°_hód
 *
li°
;

75 
li°
 = &
sc
->
cur_ch™
->
acq
[
txq
->
mac80211_qnum
];

76 i‡(!
	`li°_em±y
(
li°
))

77 
≥ndög
 = 
åue
;

79 
out
:

80 
	`•ö_u∆ock_bh
(&
txq
->
axq_lock
);

81  
≥ndög
;

82 
	}
}

84 
boﬁ
 
	$©h9k_£çowî
(
©h_so·c
 *
sc
, 
©h9k_powî_mode
 
mode
)

86 
Êags
;

87 
boﬁ
 
ªt
;

89 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

90 
ªt
 = 
	`©h9k_hw_£çowî
(
sc
->
sc_ah
, 
mode
);

91 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

93  
ªt
;

94 
	}
}

96 
	$©h_ps_fuŒ_¶ìp
(
d©a
)

98 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
d©a
;

99 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

100 
boﬁ
 
ª£t
;

102 
	`•ö_lock
(&
comm⁄
->
cc_lock
);

103 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

104 
	`•ö_u∆ock
(&
comm⁄
->
cc_lock
);

106 
	`©h9k_hw_£åxab‹t
(
sc
->
sc_ah
, 1);

107 
	`©h9k_hw_°›dm¨ecv
(
sc
->
sc_ah
, &
ª£t
);

109 
	`©h9k_hw_£çowî
(
sc
->
sc_ah
, 
ATH9K_PM_FULL_SLEEP
);

110 
	}
}

112 
	$©h9k_ps_wakeup
(
©h_so·c
 *
sc
)

114 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

115 
Êags
;

116 
©h9k_powî_mode
 
powî_mode
;

118 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

119 i‡(++
sc
->
ps_u£cou¡
 != 1)

120 
u∆ock
;

122 
	`dñ_timî_sync
(&
sc
->
¶ìp_timî
);

123 
powî_mode
 = 
sc
->
sc_ah
->power_mode;

124 
	`©h9k_hw_£çowî
(
sc
->
sc_ah
, 
ATH9K_PM_AWAKE
);

131 i‡(
powî_mode
 !
ATH9K_PM_AWAKE
) {

132 
	`•ö_lock
(&
comm⁄
->
cc_lock
);

133 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

134 
	`mem£t
(&
comm⁄
->
cc_survey
, 0, (common->cc_survey));

135 
	`mem£t
(&
comm⁄
->
cc_™i
, 0, (common->cc_ani));

136 
	`•ö_u∆ock
(&
comm⁄
->
cc_lock
);

139 
u∆ock
:

140 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

141 
	}
}

143 
	$©h9k_ps_ª°‹e
(
©h_so·c
 *
sc
)

145 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

146 
©h9k_powî_mode
 
mode
;

147 
Êags
;

149 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

150 i‡(--
sc
->
ps_u£cou¡
 != 0)

151 
u∆ock
;

153 i‡(
sc
->
ps_idÀ
) {

154 
	`mod_timî
(&
sc
->
¶ìp_timî
, 
jiffõs
 + 
HZ
 / 10);

155 
u∆ock
;

158 i‡(
sc
->
ps_íabÀd
 &&

159 !(
sc
->
ps_Êags
 & (
PS_WAIT_FOR_BEACON
 |

160 
PS_WAIT_FOR_CAB
 |

161 
PS_WAIT_FOR_PSPOLL_DATA
 |

162 
PS_WAIT_FOR_TX_ACK
 |

163 
PS_WAIT_FOR_ANI
))) {

164 
mode
 = 
ATH9K_PM_NETWORK_SLEEP
;

165 i‡(
	`©h9k_hw_btc€x_is_íabÀd
(
sc
->
sc_ah
))

166 
	`©h9k_btc€x_°›_gí_timî
(
sc
);

168 
u∆ock
;

171 
	`•ö_lock
(&
comm⁄
->
cc_lock
);

172 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

173 
	`•ö_u∆ock
(&
comm⁄
->
cc_lock
);

175 
	`©h9k_hw_£çowî
(
sc
->
sc_ah
, 
mode
);

177 
u∆ock
:

178 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

179 
	}
}

181 
	$__©h_ˇn˚l_w‹k
(
©h_so·c
 *
sc
)

183 
	`ˇn˚l_w‹k_sync
(&
sc
->
∑¥d_w‹k
);

184 
	`ˇn˚l_dñayed_w‹k_sync
(&
sc
->
tx_com∂ëe_w‹k
);

185 
	`ˇn˚l_dñayed_w‹k_sync
(&
sc
->
hw_∂l_w‹k
);

187 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


188 i‡(
	`©h9k_hw_mci_is_íabÀd
(
sc
->
sc_ah
))

189 
	`ˇn˚l_w‹k_sync
(&
sc
->
mci_w‹k
);

191 
	}
}

193 
	$©h_ˇn˚l_w‹k
(
©h_so·c
 *
sc
)

195 
	`__©h_ˇn˚l_w‹k
(
sc
);

196 
	`ˇn˚l_w‹k_sync
(&
sc
->
hw_ª£t_w‹k
);

197 
	}
}

199 
	$©h_ª°¨t_w‹k
(
©h_so·c
 *
sc
)

201 
	`õì80211_queue_dñayed_w‹k
(
sc
->
hw
, &sc->
tx_com∂ëe_w‹k
, 0);

203 i‡(
	`AR_SREV_9340
(
sc
->
sc_ah
Ë|| 
	`AR_SREV_9330
(sc->sc_ah))

204 
	`õì80211_queue_dñayed_w‹k
(
sc
->
hw
, &sc->
hw_∂l_w‹k
,

205 
	`m£cs_to_jiffõs
(
ATH_PLL_WORK_INTERVAL
));

207 
	`©h_°¨t_™i
(
sc
);

208 
	}
}

210 
boﬁ
 
	$©h_¥ï¨e_ª£t
(
©h_so·c
 *
sc
)

212 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

213 
boﬁ
 
ªt
 = 
åue
;

215 
	`õì80211_°›_queues
(
sc
->
hw
);

216 
	`©h_°›_™i
(
sc
);

217 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

219 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

220 
ªt
 &
	`©h_°›ªcv
(
sc
);

221 
ªt
 &
	`©h_døö_Æl_txq
(
sc
);

223 
ªt
 &
	`©h_døö_Æl_txq
(
sc
);

224 
ªt
 &
	`©h_°›ªcv
(
sc
);

227  
ªt
;

228 
	}
}

230 
boﬁ
 
	$©h_com∂ëe_ª£t
(
©h_so·c
 *
sc
, 
boﬁ
 
°¨t
)

232 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

233 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

234 
Êags
;

236 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, sc->
cur_ch™
);

237 
	`©h_°¨åecv
(
sc
);

238 
	`©h9k_cmn_upd©e_txpow
(
ah
, 
sc
->
cur_ch™
->
cur_txpowî
,

239 
sc
->
cur_ch™
->
txpowî
,

240 &
sc
->
cur_ch™
->
cur_txpowî
);

241 
	`˛ór_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
);

243 i‡(!
sc
->
cur_ch™
->
offch™√l
 && 
°¨t
) {

245 i‡(
sc
->
cur_ch™
->
tsf_vÆ
) {

246 
u32
 
off£t
;

248 
off£t
 = 
	`©h9k_hw_gë_tsf_off£t
(&
sc
->
cur_ch™
->
tsf_ts
,

249 
NULL
);

250 
	`©h9k_hw_£âsf64
(
ah
, 
sc
->
cur_ch™
->
tsf_vÆ
 + 
off£t
);

254 i‡(!
	`ã°_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
))

255 
w‹k
;

257 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_STATION
 &&

258 
	`ã°_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
)) {

259 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

260 
sc
->
ps_Êags
 |
PS_BEACON_SYNC
 | 
PS_WAIT_FOR_BEACON
;

261 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

263 
	`©h9k_£t_bóc⁄
(
sc
);

265 
w‹k
:

266 
	`©h_ª°¨t_w‹k
(
sc
);

267 
	`©h_txq_scheduÀ_Æl
(
sc
);

270 
sc
->
gâ_˙t
 = 0;

272 
	`©h9k_hw_£t_öãºu±s
(
ah
);

273 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

274 
	`õì80211_wake_queues
(
sc
->
hw
);

275 
	`©h9k_p2p_ps_timî
(
sc
);

277  
åue
;

278 
	}
}

280 
	$©h_ª£t_öã∫Æ
(
©h_so·c
 *
sc
, 
©h9k_ch™√l
 *
hch™
)

282 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

283 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

284 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = 
NULL
;

285 
boﬁ
 
Á°cc
 = 
åue
;

286 
r
;

288 
	`__©h_ˇn˚l_w‹k
(
sc
);

290 
	`dißbÀ_úq
(
sc
->
úq
);

291 
	`èskÀt_dißbÀ
(&
sc
->
öå_tq
);

292 
	`èskÀt_dißbÀ
(&
sc
->
bc⁄_èskÀt
);

293 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

295 i‡(!
sc
->
cur_ch™
->
offch™√l
) {

296 
Á°cc
 = 
Ál£
;

297 
ˇld©a
 = &
sc
->
cur_ch™
->caldata;

300 i‡(!
hch™
) {

301 
Á°cc
 = 
Ál£
;

302 
hch™
 = 
ah
->
curch™
;

305 i‡(!
	`©h_¥ï¨e_ª£t
(
sc
))

306 
Á°cc
 = 
Ál£
;

308 i‡(
	`©h9k_is_ch™˘x_íabÀd
())

309 
Á°cc
 = 
Ál£
;

311 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

312 
sc
->
cur_ch™def
 = sc->
cur_ch™
->
ch™def
;

313 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

315 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "ResetÅo %u MHz, HT40: %d fastcc: %d\n",

316 
hch™
->
ch™√l
, 
	`IS_CHAN_HT40
(hch™), 
Á°cc
);

318 
r
 = 
	`©h9k_hw_ª£t
(
ah
, 
hch™
, 
ˇld©a
, 
Á°cc
);

319 i‡(
r
) {

320 
	`©h_îr
(
comm⁄
,

321 "U«bÀÅÿª£àch™√l,Ñe£à°©u†%d\n", 
r
);

323 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

324 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_BB_HANG
);

326 
out
;

329 i‡(
	`©h9k_hw_mci_is_íabÀd
(
sc
->
sc_ah
) &&

330 
sc
->
cur_ch™
->
offch™√l
)

331 
	`©h9k_mci_£t_txpowî
(
sc
, 
åue
, 
Ál£
);

333 i‡(!
	`©h_com∂ëe_ª£t
(
sc
, 
åue
))

334 
r
 = -
EIO
;

336 
out
:

337 
	`íabÀ_úq
(
sc
->
úq
);

338 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

339 
	`èskÀt_íabÀ
(&
sc
->
bc⁄_èskÀt
);

340 
	`èskÀt_íabÀ
(&
sc
->
öå_tq
);

342  
r
;

343 
	}
}

345 
	$©h_node_©èch
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
,

346 
õì80211_vif
 *
vif
)

348 
©h_node
 *
™
;

349 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

351 
™
->
sc
 = sc;

352 
™
->
°a
 = sta;

353 
™
->
vif
 = vif;

354 
	`mem£t
(&
™
->
key_idx
, 0, (an->key_idx));

356 
	`©h_tx_node_öô
(
sc
, 
™
);

358 
	`©h_dy«ck_node_öô
(
sc
->
sc_ah
, 
™
);

359 
	}
}

361 
	$©h_node_dëach
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
)

363 
©h_node
 *
™
 = (©h_nodê*)
°a
->
drv_¥iv
;

364 
	`©h_tx_node_˛ónup
(
sc
, 
™
);

366 
	`©h_dy«ck_node_deöô
(
sc
->
sc_ah
, 
™
);

367 
	}
}

369 
	$©h9k_èskÀt
(
d©a
)

371 
©h_so·c
 *
sc
 = (©h_so·¯*)
d©a
;

372 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

373 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

374 
©h_ª£t_ty≥
 
ty≥
;

375 
Êags
;

376 
u32
 
°©us
 = 
sc
->
öå°©us
;

377 
u32
 
rxmask
;

379 
	`©h9k_ps_wakeup
(
sc
);

380 
	`•ö_lock
(&
sc
->
sc_pcu_lock
);

382 i‡(
°©us
 & 
ATH9K_INT_FATAL
) {

383 
ty≥
 = 
RESET_TYPE_FATAL_INT
;

384 
	`©h9k_queue_ª£t
(
sc
, 
ty≥
);

390 
	`©omic_öc
(&
ah
->
öå_ªf_˙t
);

391 
	`©h_dbg
(
comm⁄
, 
RESET
, "FATAL: Skipping interrupts\n");

392 
out
;

395 i‡((
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_BB_WATCHDOG
) &&

396 (
°©us
 & 
ATH9K_INT_BB_WATCHDOG
)) {

397 
	`•ö_lock
(&
comm⁄
->
cc_lock
);

398 
	`©h_hw_cy˛e_cou¡îs_upd©e
(
comm⁄
);

399 
	`¨9003_hw_bb_w©chdog_dbg_öfo
(
ah
);

400 
	`•ö_u∆ock
(&
comm⁄
->
cc_lock
);

402 i‡(
	`¨9003_hw_bb_w©chdog_check
(
ah
)) {

403 
ty≥
 = 
RESET_TYPE_BB_WATCHDOG
;

404 
	`©h9k_queue_ª£t
(
sc
, 
ty≥
);

410 
	`©omic_öc
(&
ah
->
öå_ªf_˙t
);

411 
	`©h_dbg
(
comm⁄
, 
RESET
,

413 
out
;

417 i‡(
°©us
 & 
ATH9K_INT_GTT
) {

418 
sc
->
gâ_˙t
++;

420 i‡((
sc
->
gâ_˙t
 >
MAX_GTT_CNT
Ë&& !
	`©h9k_hw_check_Æive
(
ah
)) {

421 
ty≥
 = 
RESET_TYPE_TX_GTT
;

422 
	`©h9k_queue_ª£t
(
sc
, 
ty≥
);

423 
	`©omic_öc
(&
ah
->
öå_ªf_˙t
);

424 
	`©h_dbg
(
comm⁄
, 
RESET
,

426 
out
;

430 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

431 i‡((
°©us
 & 
ATH9K_INT_TSFOOR
Ë&& 
sc
->
ps_íabÀd
) {

436 
	`©h_dbg
(
comm⁄
, 
PS
, "TSFOOR - Sync withÇext Beacon\n");

437 
sc
->
ps_Êags
 |
PS_WAIT_FOR_BEACON
 | 
PS_BEACON_SYNC
;

439 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

441 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

442 
rxmask
 = (
ATH9K_INT_RXHP
 | 
ATH9K_INT_RXLP
 | 
ATH9K_INT_RXEOL
 |

443 
ATH9K_INT_RXORN
);

445 
rxmask
 = (
ATH9K_INT_RX
 | 
ATH9K_INT_RXEOL
 | 
ATH9K_INT_RXORN
);

447 i‡(
°©us
 & 
rxmask
) {

449 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) &&

450 (
°©us
 & 
ATH9K_INT_RXHP
))

451 
	`©h_rx_èskÀt
(
sc
, 0, 
åue
);

453 
	`©h_rx_èskÀt
(
sc
, 0, 
Ál£
);

456 i‡(
°©us
 & 
ATH9K_INT_TX
) {

457 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

464 
sc
->
gâ_˙t
 = 0;

466 
	`©h_tx_edma_èskÀt
(
sc
);

468 
	`©h_tx_èskÀt
(
sc
);

471 
	`wake_up
(&
sc
->
tx_waô
);

474 i‡(
°©us
 & 
ATH9K_INT_GENTIMER
)

475 
	`©h_gí_timî_i§
(
sc
->
sc_ah
);

477 
	`©h9k_btc€x_h™dÀ_öãºu±
(
sc
, 
°©us
);

480 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

481 
out
:

482 
	`•ö_u∆ock
(&
sc
->
sc_pcu_lock
);

483 
	`©h9k_ps_ª°‹e
(
sc
);

484 
	}
}

486 
úqªtu∫_t
 
	$©h_i§
(
úq
, *
dev
)

488 
	#SCHED_INTR
 ( \

489 
ATH9K_INT_FATAL
 | \

490 
ATH9K_INT_BB_WATCHDOG
 | \

491 
ATH9K_INT_RXORN
 | \

492 
ATH9K_INT_RXEOL
 | \

493 
ATH9K_INT_RX
 | \

494 
ATH9K_INT_RXLP
 | \

495 
ATH9K_INT_RXHP
 | \

496 
ATH9K_INT_TX
 | \

497 
ATH9K_INT_BMISS
 | \

498 
ATH9K_INT_CST
 | \

499 
ATH9K_INT_GTT
 | \

500 
ATH9K_INT_TSFOOR
 | \

501 
ATH9K_INT_GENTIMER
 | \

502 
ATH9K_INT_MCI
)

	)

504 
©h_so·c
 *
sc
 = 
dev
;

505 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

506 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

507 
©h9k_öt
 
°©us
;

508 
u32
 
sync_ˇu£
 = 0;

509 
boﬁ
 
sched
 = 
Ál£
;

516 i‡(!
ah
 || 
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
))

517  
IRQ_NONE
;

520 i‡(!
	`©h9k_hw_öå≥nd
(
ah
))

521  
IRQ_NONE
;

529 
	`©h9k_hw_gëi§
(
ah
, &
°©us
, &
sync_ˇu£
);

530 
	`©h9k_debug_sync_ˇu£
(
sc
, 
sync_ˇu£
);

531 
°©us
 &
ah
->
imask
;

533 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
))

534  
IRQ_HANDLED
;

536 i‡(
	`ã°_bô
(
ATH_DIAG_TRIGGER_ERROR
, &
ah
->
düg
)) {

537 
°©us
 |
ATH9K_INT_FATAL
;

538 
	`˛ór_bô
(
ATH_DIAG_TRIGGER_ERROR
, &
ah
->
düg
);

545 i‡(!
°©us
)

546  
IRQ_NONE
;

549 
sc
->
öå°©us
 = 
°©us
;

551 i‡(
°©us
 & 
SCHED_INTR
)

552 
sched
 = 
åue
;

558 i‡(
°©us
 & 
ATH9K_INT_FATAL
)

559 
chù_ª£t
;

561 i‡((
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_BB_WATCHDOG
) &&

562 (
°©us
 & 
ATH9K_INT_BB_WATCHDOG
))

563 
chù_ª£t
;

565 i‡(
°©us
 & 
ATH9K_INT_SWBA
)

566 
	`èskÀt_scheduÀ
(&
sc
->
bc⁄_èskÀt
);

568 i‡(
°©us
 & 
ATH9K_INT_TXURN
)

569 
	`©h9k_hw_upd©ëxåigÀvñ
(
ah
, 
åue
);

571 i‡(
°©us
 & 
ATH9K_INT_RXEOL
) {

572 
ah
->
imask
 &~(
ATH9K_INT_RXEOL
 | 
ATH9K_INT_RXORN
);

573 
	`©h9k_hw_£t_öãºu±s
(
ah
);

576 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
))

577 i‡(
°©us
 & 
ATH9K_INT_TIM_TIMER
) {

578 i‡(
	`ATH_DBG_WARN_ON_ONCE
(
sc
->
ps_idÀ
))

579 
chù_ª£t
;

582 
	`©h9k_£çowî
(
sc
, 
ATH9K_PM_AWAKE
);

583 
	`•ö_lock
(&
sc
->
sc_pm_lock
);

584 
	`©h9k_hw_£åxab‹t
(
sc
->
sc_ah
, 0);

585 
sc
->
ps_Êags
 |
PS_WAIT_FOR_BEACON
;

586 
	`•ö_u∆ock
(&
sc
->
sc_pm_lock
);

589 
chù_ª£t
:

591 
	`©h_debug_°©_öãºu±
(
sc
, 
°©us
);

593 i‡(
sched
) {

595 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

596 
	`èskÀt_scheduÀ
(&
sc
->
öå_tq
);

599  
IRQ_HANDLED
;

601 #unde‡
SCHED_INTR


602 
	}
}

608 
	$©h_ª£t
(
©h_so·c
 *
sc
, 
©h9k_ch™√l
 *
hch™
)

610 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

611 
r
;

613 
	`©h9k_hw_kûl_öãºu±s
(
sc
->
sc_ah
);

614 
	`£t_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
);

616 
	`©h9k_ps_wakeup
(
sc
);

617 
r
 = 
	`©h_ª£t_öã∫Æ
(
sc
, 
hch™
);

618 
	`©h9k_ps_ª°‹e
(
sc
);

620  
r
;

621 
	}
}

628 
	$©h9k_queue_ª£t
(
©h_so·c
 *
sc
, 
©h_ª£t_ty≥
 
ty≥
)

630 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

631 #ifde‡
CPTCFG_ATH9K_DEBUGFS


632 
	`RESET_STAT_INC
(
sc
, 
ty≥
);

634 
	`©h9k_hw_kûl_öãºu±s
(
sc
->
sc_ah
);

635 
	`£t_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
);

636 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
hw_ª£t_w‹k
);

637 
	}
}

639 
	$©h_ª£t_w‹k
(
w‹k_°ru˘
 *
w‹k
)

641 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ©h_so·c, 
hw_ª£t_w‹k
);

643 
	`©h9k_ps_wakeup
(
sc
);

644 
	`©h_ª£t_öã∫Æ
(
sc
, 
NULL
);

645 
	`©h9k_ps_ª°‹e
(
sc
);

646 
	}
}

652 
	$©h9k_°¨t
(
õì80211_hw
 *
hw
)

654 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

655 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

656 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

657 
õì80211_ch™√l
 *
curch™
 = 
sc
->
cur_ch™
->
ch™def
.
ch™
;

658 
©h_ch™˘x
 *
˘x
 = 
sc
->
cur_ch™
;

659 
©h9k_ch™√l
 *
öô_ch™√l
;

660 
r
;

662 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

664 
curch™
->
˚¡î_‰eq
);

666 
	`©h9k_ps_wakeup
(
sc
);

667 
	`muãx_lock
(&
sc
->
muãx
);

669 
öô_ch™√l
 = 
	`©h9k_cmn_gë_ch™√l
(
hw
, 
ah
, &
˘x
->
ch™def
);

670 
sc
->
cur_ch™def
 = 
hw
->
c⁄f
.
ch™def
;

673 
	`©h9k_hw_c⁄figpcùowîßve
(
ah
, 
Ál£
);

682 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

684 
	`©omic_£t
(&
ah
->
öå_ªf_˙t
, -1);

686 
r
 = 
	`©h9k_hw_ª£t
(
ah
, 
öô_ch™√l
,áh->
ˇld©a
, 
Ál£
);

687 i‡(
r
) {

688 
	`©h_îr
(
comm⁄
,

690 
r
, 
curch™
->
˚¡î_‰eq
);

691 
ah
->
ª£t_powî_⁄
 = 
Ál£
;

695 
ah
->
imask
 = 
ATH9K_INT_TX
 | 
ATH9K_INT_RXEOL
 |

696 
ATH9K_INT_RXORN
 | 
ATH9K_INT_FATAL
 |

697 
ATH9K_INT_GLOBAL
;

699 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

700 
ah
->
imask
 |
ATH9K_INT_RXHP
 |

701 
ATH9K_INT_RXLP
;

703 
ah
->
imask
 |
ATH9K_INT_RX
;

705 i‡(
ah
->
c⁄fig
.
hw_h™g_checks
 & 
HW_BB_WATCHDOG
)

706 
ah
->
imask
 |
ATH9K_INT_BB_WATCHDOG
;

712 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

713 
ah
->
imask
 |
ATH9K_INT_GTT
;

715 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_HT
)

716 
ah
->
imask
 |
ATH9K_INT_CST
;

718 
	`©h_mci_íabÀ
(
sc
);

720 
	`˛ór_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

721 
sc
->
sc_ah
->
is_m⁄ô‹ög
 = 
Ál£
;

723 i‡(!
	`©h_com∂ëe_ª£t
(
sc
, 
Ál£
))

724 
ah
->
ª£t_powî_⁄
 = 
Ál£
;

726 i‡(
ah
->
Àd_pö
 >= 0) {

727 
	`©h9k_hw_cfg_ouçut
(
ah
,áh->
Àd_pö
,

728 
AR_GPIO_OUTPUT_MUX_AS_OUTPUT
);

729 
	`©h9k_hw_£t_gpio
(
ah
,áh->
Àd_pö
,

730 (
ah
->
c⁄fig
.
Àd_a˘ive_high
) ? 1 : 0);

737 
	`©h9k_cmn_öô_¸y±o
(
sc
->
sc_ah
);

739 
	`©h9k_hw_ª£t_tsf
(
ah
);

741 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

743 
	`muãx_u∆ock
(&
sc
->
muãx
);

745 
	`©h9k_ps_ª°‹e
(
sc
);

747 
	`©h9k_∫g_°¨t
(
sc
);

750 
	}
}

752 
	$©h9k_tx
(
õì80211_hw
 *
hw
,

753 
õì80211_tx_c⁄åﬁ
 *
c⁄åﬁ
,

754 
sk_buff
 *
skb
)

756 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

757 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

758 
©h_tx_c⁄åﬁ
 
tx˘l
;

759 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*Ë
skb
->
d©a
;

760 
Êags
;

762 i‡(
sc
->
ps_íabÀd
) {

767 i‡(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) &&

768 !
	`õì80211_is_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
) &&

769 !
	`õì80211_has_pm
(
hdr
->
‰ame_c⁄åﬁ
)) {

770 
	`©h_dbg
(
comm⁄
, 
PS
,

772 
hdr
->
‰ame_c⁄åﬁ
 |
	`˝u_to_À16
(
IEEE80211_FCTL_PM
);

776 i‡(
	`u∆ikñy
(
sc
->
sc_ah
->
powî_mode
 =
ATH9K_PM_NETWORK_SLEEP
)) {

782 
	`©h9k_ps_wakeup
(
sc
);

783 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

784 i‡(!(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
))

785 
	`©h9k_hw_£åxab‹t
(
sc
->
sc_ah
, 0);

786 i‡(
	`õì80211_is_p•ﬁl
(
hdr
->
‰ame_c⁄åﬁ
)) {

787 
	`©h_dbg
(
comm⁄
, 
PS
,

789 
sc
->
ps_Êags
 |
PS_WAIT_FOR_PSPOLL_DATA
;

791 
	`©h_dbg
(
comm⁄
, 
PS
, "Wake upÅo complete TX\n");

792 
sc
->
ps_Êags
 |
PS_WAIT_FOR_TX_ACK
;

799 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

800 
	`©h9k_ps_ª°‹e
(
sc
);

807 i‡(
	`u∆ikñy
(
sc
->
sc_ah
->
powî_mode
 =
ATH9K_PM_FULL_SLEEP
)) {

808 
	`©h_îr
(
comm⁄
, "TX while HW is in FULL_SLEEP mode\n");

809 
exô
;

812 
	`mem£t
(&
tx˘l
, 0, (
©h_tx_c⁄åﬁ
));

813 
tx˘l
.
txq
 = 
sc
->
tx
.
txq_m≠
[
	`skb_gë_queue_m≠pög
(
skb
)];

814 
tx˘l
.
°a
 = 
c⁄åﬁ
->sta;

816 
	`©h_dbg
(
comm⁄
, 
XMIT
, "å™smôtögÖackë, skb: %p\n", 
skb
);

818 i‡(
	`©h_tx_°¨t
(
hw
, 
skb
, &
tx˘l
) != 0) {

819 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TX failed\n");

820 
	`TX_STAT_INC
(
tx˘l
.
txq
->
axq_qnum
, 
txÁûed
);

821 
exô
;

825 
exô
:

826 
	`õì80211_‰ì_txskb
(
hw
, 
skb
);

827 
	}
}

829 
	$©h9k_°›
(
õì80211_hw
 *
hw
)

831 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

832 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

833 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

834 
boﬁ
 
¥ev_idÀ
;

836 
	`©h9k_deöô_ch™√l_c⁄ãxt
(
sc
);

838 
	`©h9k_∫g_°›
(
sc
);

840 
	`muãx_lock
(&
sc
->
muãx
);

842 
	`©h_ˇn˚l_w‹k
(
sc
);

844 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

845 
	`©h_dbg
(
comm⁄
, 
ANY
, "DeviceÇotÖresent\n");

846 
	`muãx_u∆ock
(&
sc
->
muãx
);

851 
	`©h9k_ps_wakeup
(
sc
);

853 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

856 
ah
->
imask
 &~
ATH9K_INT_GLOBAL
;

860 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

862 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

866 
	`synchr⁄ize_úq
(
sc
->
úq
);

867 
	`èskÀt_kûl
(&
sc
->
öå_tq
);

868 
	`èskÀt_kûl
(&
sc
->
bc⁄_èskÀt
);

870 
¥ev_idÀ
 = 
sc
->
ps_idÀ
;

871 
sc
->
ps_idÀ
 = 
åue
;

873 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

875 i‡(
ah
->
Àd_pö
 >= 0) {

876 
	`©h9k_hw_£t_gpio
(
ah
,áh->
Àd_pö
,

877 (
ah
->
c⁄fig
.
Àd_a˘ive_high
) ? 0 : 1);

878 
	`©h9k_hw_cfg_gpio_öput
(
ah
,áh->
Àd_pö
);

881 
	`©h_¥ï¨e_ª£t
(
sc
);

883 i‡(
sc
->
rx
.
‰ag
) {

884 
	`dev_k‰ì_skb_™y
(
sc
->
rx
.
‰ag
);

885 
sc
->
rx
.
‰ag
 = 
NULL
;

888 i‡(!
ah
->
curch™
)

889 
ah
->
curch™
 = 
	`©h9k_cmn_gë_ch™√l
(
hw
,áh,

890 &
sc
->
cur_ch™
->
ch™def
);

892 
	`©h9k_hw_ª£t
(
ah
,áh->
curch™
,áh->
ˇld©a
, 
Ál£
);

894 
	`£t_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
);

896 
	`©h9k_hw_phy_dißbÀ
(
ah
);

898 
	`©h9k_hw_c⁄figpcùowîßve
(
ah
, 
åue
);

900 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

902 
	`©h9k_ps_ª°‹e
(
sc
);

904 
sc
->
ps_idÀ
 = 
¥ev_idÀ
;

906 
	`muãx_u∆ock
(&
sc
->
muãx
);

908 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Driver halt\n");

909 
	}
}

911 
boﬁ
 
	$©h9k_u£s_bóc⁄s
(
ty≥
)

913 
ty≥
) {

914 
NL80211_IFTYPE_AP
:

915 
NL80211_IFTYPE_ADHOC
:

916 
NL80211_IFTYPE_MESH_POINT
:

917  
åue
;

919  
Ál£
;

921 
	}
}

923 
	$©h9k_vif_ôî
(
©h9k_vif_ôî_d©a
 *
ôî_d©a
,

924 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

926 
©h_vif
 *
avp
 = (©h_vi‡*)
vif
->
drv_¥iv
;

927 
i
;

929 i‡(
ôî_d©a
->
has_hw_maˇddr
) {

930 
i
 = 0; i < 
ETH_ALEN
; i++)

931 
ôî_d©a
->
mask
[
i
] &=

932 ~(
ôî_d©a
->
hw_maˇddr
[
i
] ^ 
mac
[i]);

934 
	`mem˝y
(
ôî_d©a
->
hw_maˇddr
, 
mac
, 
ETH_ALEN
);

935 
ôî_d©a
->
has_hw_maˇddr
 = 
åue
;

938 i‡(!
vif
->
bss_c⁄f
.
u£_sh‹t_¶Ÿ
)

939 
ôî_d©a
->
¶Ÿtime
 = 
ATH9K_SLOT_TIME_20
;

941 
vif
->
ty≥
) {

942 
NL80211_IFTYPE_AP
:

943 
ôî_d©a
->
«ps
++;

945 
NL80211_IFTYPE_STATION
:

946 
ôî_d©a
->
n°©i⁄s
++;

947 i‡(
avp
->
assoc
 && !
ôî_d©a
->
¥im¨y_°a
)

948 
ôî_d©a
->
¥im¨y_°a
 = 
vif
;

950 
NL80211_IFTYPE_OCB
:

951 
ôî_d©a
->
nocbs
++;

953 
NL80211_IFTYPE_ADHOC
:

954 
ôî_d©a
->
«dhocs
++;

955 i‡(
vif
->
bss_c⁄f
.
íabÀ_bóc⁄
)

956 
ôî_d©a
->
bóc⁄s
 = 
åue
;

958 
NL80211_IFTYPE_MESH_POINT
:

959 
ôî_d©a
->
nmeshes
++;

960 i‡(
vif
->
bss_c⁄f
.
íabÀ_bóc⁄
)

961 
ôî_d©a
->
bóc⁄s
 = 
åue
;

963 
NL80211_IFTYPE_WDS
:

964 
ôî_d©a
->
nwds
++;

969 
	}
}

971 
	$©h9k_upd©e_bssid_mask
(
©h_so·c
 *
sc
,

972 
©h_ch™˘x
 *
˘x
,

973 
©h9k_vif_ôî_d©a
 *
ôî_d©a
)

975 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

976 
©h_vif
 *
avp
;

977 
i
;

979 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

982 
	`li°_f‹_óch_íåy
(
avp
, &
˘x
->
vifs
, 
li°
) {

983 i‡(
˘x
->
nvifs_assig√d
 != 1)

986 i‡(!
avp
->
vif
->
p2p
 || !
ôî_d©a
->
has_hw_maˇddr
)

989 
	`ëhî_addr_c›y
(
comm⁄
->
curbssid
, 
avp
->
bssid
);

992 
i
 = 0; i < 
ETH_ALEN
; i++)

993 
ôî_d©a
->
mask
[
i
] &=

994 ~(
ôî_d©a
->
hw_maˇddr
[
i
] ^

995 
sc
->
hw
->
wùhy
->
≥rm_addr
[
i
]);

997 
	}
}

1000 
	$©h9k_ˇlcuœã_ôî_d©a
(
©h_so·c
 *
sc
,

1001 
©h_ch™˘x
 *
˘x
,

1002 
©h9k_vif_ôî_d©a
 *
ôî_d©a
)

1004 
©h_vif
 *
avp
;

1010 
	`mem£t
(
ôî_d©a
, 0, (*iter_data));

1011 
	`ëh_brﬂdˇ°_addr
(
ôî_d©a
->
mask
);

1012 
ôî_d©a
->
¶Ÿtime
 = 
ATH9K_SLOT_TIME_9
;

1014 
	`li°_f‹_óch_íåy
(
avp
, &
˘x
->
vifs
, 
li°
)

1015 
	`©h9k_vif_ôî
(
ôî_d©a
, 
avp
->
vif
->
addr
,ávp->vif);

1017 
	`©h9k_upd©e_bssid_mask
(
sc
, 
˘x
, 
ôî_d©a
);

1018 
	}
}

1020 
	$©h9k_£t_assoc_°©e
(
©h_so·c
 *
sc
,

1021 
õì80211_vif
 *
vif
, 
boﬁ
 
ch™ged
)

1023 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1024 
©h_vif
 *
avp
 = (©h_vi‡*)
vif
->
drv_¥iv
;

1025 
Êags
;

1027 
	`£t_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
);

1029 
	`ëhî_addr_c›y
(
comm⁄
->
curbssid
, 
avp
->
bssid
);

1030 
comm⁄
->
cuøid
 = 
avp
->
aid
;

1031 
	`©h9k_hw_wrôe_associd
(
sc
->
sc_ah
);

1033 i‡(
ch™ged
) {

1034 
comm⁄
->
œ°_rssi
 = 
ATH_RSSI_DUMMY_MARKER
;

1035 
sc
->
sc_ah
->
°©s
.
avgbrssi
 = 
ATH_RSSI_DUMMY_MARKER
;

1037 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

1038 
sc
->
ps_Êags
 |
PS_BEACON_SYNC
 | 
PS_WAIT_FOR_BEACON
;

1039 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

1042 i‡(
	`©h9k_hw_mci_is_íabÀd
(
sc
->
sc_ah
))

1043 
	`©h9k_mci_upd©e_wœn_ch™√ls
(
sc
, 
Ál£
);

1045 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1047 
vif
->
addr
, 
comm⁄
->
curbssid
);

1048 
	}
}

1050 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


1051 
	$©h9k_£t_offch™√l_°©e
(
©h_so·c
 *
sc
)

1053 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1054 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1055 
õì80211_vif
 *
vif
 = 
NULL
;

1057 
	`©h9k_ps_wakeup
(
sc
);

1059 i‡(
sc
->
offch™√l
.
°©e
 < 
ATH_OFFCHANNEL_ROC_START
)

1060 
vif
 = 
sc
->
offch™√l
.
sˇn_vif
;

1062 
vif
 = 
sc
->
offch™√l
.
roc_vif
;

1064 i‡(
	`WARN_ON
(!
vif
))

1065 
exô
;

1067 
	`ëh_zîo_addr
(
comm⁄
->
curbssid
);

1068 
	`ëh_brﬂdˇ°_addr
(
comm⁄
->
bssidmask
);

1069 
	`mem˝y
(
comm⁄
->
maˇddr
, 
vif
->
addr
, 
ETH_ALEN
);

1070 
comm⁄
->
cuøid
 = 0;

1071 
ah
->
›mode
 = 
vif
->
ty≥
;

1072 
ah
->
imask
 &~
ATH9K_INT_SWBA
;

1073 
ah
->
imask
 &~
ATH9K_INT_TSFOOR
;

1074 
ah
->
¶Ÿtime
 = 
ATH9K_SLOT_TIME_9
;

1076 
	`©h_hw_£tbssidmask
(
comm⁄
);

1077 
	`©h9k_hw_£t›mode
(
ah
);

1078 
	`©h9k_hw_wrôe_associd
(
sc
->
sc_ah
);

1079 
	`©h9k_hw_£t_öãºu±s
(
ah
);

1080 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

1082 
exô
:

1083 
	`©h9k_ps_ª°‹e
(
sc
);

1084 
	}
}

1088 
	$©h9k_ˇlcuœã_summ¨y_°©e
(
©h_so·c
 *
sc
,

1089 
©h_ch™˘x
 *
˘x
)

1091 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1092 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1093 
©h9k_vif_ôî_d©a
 
ôî_d©a
;

1094 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
;

1096 
	`©h_ch™˘x_check_a˘ive
(
sc
, 
˘x
);

1098 i‡(
˘x
 !
sc
->
cur_ch™
)

1101 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


1102 i‡(
˘x
 =&
sc
->
offch™√l
.
ch™
)

1103  
	`©h9k_£t_offch™√l_°©e
(
sc
);

1106 
	`©h9k_ps_wakeup
(
sc
);

1107 
	`©h9k_ˇlcuœã_ôî_d©a
(
sc
, 
˘x
, &
ôî_d©a
);

1109 i‡(
ôî_d©a
.
has_hw_maˇddr
)

1110 
	`mem˝y
(
comm⁄
->
maˇddr
, 
ôî_d©a
.
hw_maˇddr
, 
ETH_ALEN
);

1112 
	`mem˝y
(
comm⁄
->
bssidmask
, 
ôî_d©a
.
mask
, 
ETH_ALEN
);

1113 
	`©h_hw_£tbssidmask
(
comm⁄
);

1115 i‡(
ôî_d©a
.
«ps
 > 0) {

1116 
cur_c⁄f
 = &
˘x
->
bóc⁄
;

1117 
	`©h9k_hw_£t_tsÁdju°
(
ah
, 
åue
);

1118 
ah
->
›mode
 = 
NL80211_IFTYPE_AP
;

1119 i‡(
cur_c⁄f
->
íabÀ_bóc⁄
)

1120 
ôî_d©a
.
bóc⁄s
 = 
åue
;

1122 
	`©h9k_hw_£t_tsÁdju°
(
ah
, 
Ál£
);

1124 i‡(
ôî_d©a
.
nmeshes
)

1125 
ah
->
›mode
 = 
NL80211_IFTYPE_MESH_POINT
;

1126 i‡(
ôî_d©a
.
nocbs
)

1127 
ah
->
›mode
 = 
NL80211_IFTYPE_OCB
;

1128 i‡(
ôî_d©a
.
nwds
)

1129 
ah
->
›mode
 = 
NL80211_IFTYPE_AP
;

1130 i‡(
ôî_d©a
.
«dhocs
)

1131 
ah
->
›mode
 = 
NL80211_IFTYPE_ADHOC
;

1133 
ah
->
›mode
 = 
NL80211_IFTYPE_STATION
;

1136 
	`©h9k_hw_£t›mode
(
ah
);

1138 
˘x
->
swôch_a·î_bóc⁄
 = 
Ál£
;

1139 i‡((
ôî_d©a
.
n°©i⁄s
 + iãr_d©a.
«dhocs
 + iãr_d©a.
nmeshes
) > 0)

1140 
ah
->
imask
 |
ATH9K_INT_TSFOOR
;

1142 
ah
->
imask
 &~
ATH9K_INT_TSFOOR
;

1143 i‡(
ôî_d©a
.
«ps
 =1 && iãr_d©a.
bóc⁄s
)

1144 
˘x
->
swôch_a·î_bóc⁄
 = 
åue
;

1147 
ah
->
imask
 &~
ATH9K_INT_SWBA
;

1148 i‡(
ah
->
›mode
 =
NL80211_IFTYPE_STATION
) {

1149 
boﬁ
 
ch™ged
 = (
ôî_d©a
.
¥im¨y_°a
 !
˘x
->primary_sta);

1151 i‡(
ôî_d©a
.
¥im¨y_°a
) {

1152 
ôî_d©a
.
bóc⁄s
 = 
åue
;

1153 
	`©h9k_£t_assoc_°©e
(
sc
, 
ôî_d©a
.
¥im¨y_°a
,

1154 
ch™ged
);

1155 
˘x
->
¥im¨y_°a
 = 
ôî_d©a
.primary_sta;

1157 
˘x
->
¥im¨y_°a
 = 
NULL
;

1158 
	`ëh_zîo_addr
(
comm⁄
->
curbssid
);

1159 
comm⁄
->
cuøid
 = 0;

1160 
	`©h9k_hw_wrôe_associd
(
sc
->
sc_ah
);

1161 i‡(
	`©h9k_hw_mci_is_íabÀd
(
sc
->
sc_ah
))

1162 
	`©h9k_mci_upd©e_wœn_ch™√ls
(
sc
, 
åue
);

1164 } i‡(
ôî_d©a
.
bóc⁄s
) {

1165 
ah
->
imask
 |
ATH9K_INT_SWBA
;

1167 
	`©h9k_hw_£t_öãºu±s
(
ah
);

1169 i‡(
ôî_d©a
.
bóc⁄s
)

1170 
	`£t_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

1172 
	`˛ór_bô
(
ATH_OP_BEACONS
, &
comm⁄
->
›_Êags
);

1174 i‡(
ah
->
¶Ÿtime
 !
ôî_d©a
.slottime) {

1175 
ah
->
¶Ÿtime
 = 
ôî_d©a
.slottime;

1176 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

1179 i‡(
ôî_d©a
.
¥im¨y_°a
)

1180 
	`£t_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
);

1182 
	`˛ór_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
);

1184 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1186 
comm⁄
->
maˇddr
, comm⁄->
curbssid
, comm⁄->
bssidmask
);

1188 
	`©h9k_ps_ª°‹e
(
sc
);

1189 
	}
}

1191 
	$©h9k_çc_vif_ôî
(*
d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

1193 *
powî
 = (*)
d©a
;

1195 i‡(*
powî
 < 
vif
->
bss_c⁄f
.
txpowî
)

1196 *
powî
 = 
vif
->
bss_c⁄f
.
txpowî
;

1197 
	}
}

1200 
	$©h9k_£t_txpowî
(
©h_so·c
 *
sc
, 
õì80211_vif
 *
vif
)

1202 
powî
;

1203 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1204 
©h_ªguœt‹y
 *
ªg
 = 
	`©h9k_hw_ªguœt‹y
(
ah
);

1206 
	`©h9k_ps_wakeup
(
sc
);

1207 i‡(
ah
->
çc_íabÀd
) {

1208 
powî
 = (
vif
Ë? vif->
bss_c⁄f
.
txpowî
 : -1;

1209 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

1210 
sc
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

1211 
©h9k_çc_vif_ôî
, &
powî
);

1212 i‡(
powî
 == -1)

1213 
powî
 = 
sc
->
hw
->
c⁄f
.
powî_Àvñ
;

1215 
powî
 = 
sc
->
hw
->
c⁄f
.
powî_Àvñ
;

1217 
sc
->
cur_ch™
->
txpowî
 = 2 * 
powî
;

1218 
	`©h9k_hw_£t_txpowîlimô
(
ah
, 
sc
->
cur_ch™
->
txpowî
, 
Ál£
);

1219 
sc
->
cur_ch™
->
cur_txpowî
 = 
ªg
->
max_powî_Àvñ
;

1220 
	`©h9k_ps_ª°‹e
(
sc
);

1221 
	}
}

1223 
	$©h9k_assign_hw_queues
(
õì80211_hw
 *
hw
,

1224 
õì80211_vif
 *
vif
)

1226 
i
;

1228 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

1231 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++)

1232 
vif
->
hw_queue
[
i
] = i;

1234 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1235 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
)

1236 
vif
->
ˇb_queue
 = 
hw
->
queues
 - 2;

1238 
vif
->
ˇb_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

1239 
	}
}

1241 
	$©h9k_add_öãrÁ˚
(
õì80211_hw
 *
hw
,

1242 
õì80211_vif
 *
vif
)

1244 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1245 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1246 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1247 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1248 
©h_node
 *
™
 = &
avp
->
mˇ°_node
;

1250 
	`muãx_lock
(&
sc
->
muãx
);

1252 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
)) {

1253 i‡(
sc
->
cur_ch™
->
nvifs
 >= 1) {

1254 
	`muãx_u∆ock
(&
sc
->
muãx
);

1255  -
EOPNOTSUPP
;

1257 
sc
->
tx99_vif
 = 
vif
;

1260 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Aâachá VIF o‡ty≥: %d\n", 
vif
->
ty≥
);

1261 
sc
->
cur_ch™
->
nvifs
++;

1263 i‡(
	`©h9k_u£s_bóc⁄s
(
vif
->
ty≥
))

1264 
	`©h9k_bóc⁄_assign_¶Ÿ
(
sc
, 
vif
);

1266 
avp
->
vif
 = vif;

1267 i‡(!
	`©h9k_is_ch™˘x_íabÀd
()) {

1268 
avp
->
ch™˘x
 = 
sc
->
cur_ch™
;

1269 
	`li°_add_èû
(&
avp
->
li°
, &avp->
ch™˘x
->
vifs
);

1272 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
avp
->
ch™˘x
);

1274 
	`©h9k_assign_hw_queues
(
hw
, 
vif
);

1276 
	`©h9k_£t_txpowî
(
sc
, 
vif
);

1278 
™
->
sc
 = sc;

1279 
™
->
°a
 = 
NULL
;

1280 
™
->
vif
 = vif;

1281 
™
->
no_ps_fûãr
 = 
åue
;

1282 
	`©h_tx_node_öô
(
sc
, 
™
);

1284 
	`muãx_u∆ock
(&
sc
->
muãx
);

1286 
	}
}

1288 
	$©h9k_ch™ge_öãrÁ˚
(
õì80211_hw
 *
hw
,

1289 
õì80211_vif
 *
vif
,

1290 
∆80211_i·y≥
 
√w_ty≥
,

1291 
boﬁ
 
p2p
)

1293 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1294 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1295 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1297 
	`muãx_lock
(&
sc
->
muãx
);

1299 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
)) {

1300 
	`muãx_u∆ock
(&
sc
->
muãx
);

1301  -
EOPNOTSUPP
;

1304 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Change Interface\n");

1306 i‡(
	`©h9k_u£s_bóc⁄s
(
vif
->
ty≥
))

1307 
	`©h9k_bóc⁄_ªmove_¶Ÿ
(
sc
, 
vif
);

1309 
vif
->
ty≥
 = 
√w_ty≥
;

1310 
vif
->
p2p
 =Ö2p;

1312 i‡(
	`©h9k_u£s_bóc⁄s
(
vif
->
ty≥
))

1313 
	`©h9k_bóc⁄_assign_¶Ÿ
(
sc
, 
vif
);

1315 
	`©h9k_assign_hw_queues
(
hw
, 
vif
);

1316 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
avp
->
ch™˘x
);

1318 
	`©h9k_£t_txpowî
(
sc
, 
vif
);

1320 
	`muãx_u∆ock
(&
sc
->
muãx
);

1322 
	}
}

1324 
	$©h9k_ªmove_öãrÁ˚
(
õì80211_hw
 *
hw
,

1325 
õì80211_vif
 *
vif
)

1327 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1328 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1329 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1331 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Detach Interface\n");

1333 
	`muãx_lock
(&
sc
->
muãx
);

1335 
	`©h9k_p2p_ªmove_vif
(
sc
, 
vif
);

1337 
sc
->
cur_ch™
->
nvifs
--;

1338 
sc
->
tx99_vif
 = 
NULL
;

1339 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

1340 
	`li°_dñ
(&
avp
->
li°
);

1342 i‡(
	`©h9k_u£s_bóc⁄s
(
vif
->
ty≥
))

1343 
	`©h9k_bóc⁄_ªmove_¶Ÿ
(
sc
, 
vif
);

1345 
	`©h_tx_node_˛ónup
(
sc
, &
avp
->
mˇ°_node
);

1347 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
avp
->
ch™˘x
);

1349 
	`©h9k_£t_txpowî
(
sc
, 
NULL
);

1351 
	`muãx_u∆ock
(&
sc
->
muãx
);

1352 
	}
}

1354 
	$©h9k_íabÀ_ps
(
©h_so·c
 *
sc
)

1356 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1357 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1359 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

1362 
sc
->
ps_íabÀd
 = 
åue
;

1363 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
)) {

1364 i‡((
ah
->
imask
 & 
ATH9K_INT_TIM_TIMER
) == 0) {

1365 
ah
->
imask
 |
ATH9K_INT_TIM_TIMER
;

1366 
	`©h9k_hw_£t_öãºu±s
(
ah
);

1368 
	`©h9k_hw_£åxab‹t
(
ah
, 1);

1370 
	`©h_dbg
(
comm⁄
, 
PS
, "PowerSaveÉnabled\n");

1371 
	}
}

1373 
	$©h9k_dißbÀ_ps
(
©h_so·c
 *
sc
)

1375 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1376 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1378 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

1381 
sc
->
ps_íabÀd
 = 
Ál£
;

1382 
	`©h9k_hw_£çowî
(
ah
, 
ATH9K_PM_AWAKE
);

1383 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
)) {

1384 
	`©h9k_hw_£åxab‹t
(
ah
, 0);

1385 
sc
->
ps_Êags
 &~(
PS_WAIT_FOR_BEACON
 |

1386 
PS_WAIT_FOR_CAB
 |

1387 
PS_WAIT_FOR_PSPOLL_DATA
 |

1388 
PS_WAIT_FOR_TX_ACK
);

1389 i‡(
ah
->
imask
 & 
ATH9K_INT_TIM_TIMER
) {

1390 
ah
->
imask
 &~
ATH9K_INT_TIM_TIMER
;

1391 
	`©h9k_hw_£t_öãºu±s
(
ah
);

1394 
	`©h_dbg
(
comm⁄
, 
PS
, "PowerSave disabled\n");

1395 
	}
}

1397 
	$©h9k_c⁄fig
(
õì80211_hw
 *
hw
, 
u32
 
ch™ged
)

1399 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1400 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1401 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1402 
õì80211_c⁄f
 *
c⁄f
 = &
hw
->conf;

1403 
©h_ch™˘x
 *
˘x
 = 
sc
->
cur_ch™
;

1405 
	`©h9k_ps_wakeup
(
sc
);

1406 
	`muãx_lock
(&
sc
->
muãx
);

1408 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_IDLE
) {

1409 
sc
->
ps_idÀ
 = !!(
c⁄f
->
Êags
 & 
IEEE80211_CONF_IDLE
);

1410 i‡(
sc
->
ps_idÀ
) {

1411 
	`©h_ˇn˚l_w‹k
(
sc
);

1412 
	`©h9k_°›_btc€x
(
sc
);

1414 
	`©h9k_°¨t_btc€x
(
sc
);

1419 
	`©h_ch™˘x_£t_ch™√l
(
sc
, 
˘x
, &˘x->
ch™def
);

1429 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_PS
) {

1430 
Êags
;

1431 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

1432 i‡(
c⁄f
->
Êags
 & 
IEEE80211_CONF_PS
)

1433 
	`©h9k_íabÀ_ps
(
sc
);

1435 
	`©h9k_dißbÀ_ps
(
sc
);

1436 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

1439 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_MONITOR
) {

1440 i‡(
c⁄f
->
Êags
 & 
IEEE80211_CONF_MONITOR
) {

1441 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Monitor mode isÉnabled\n");

1442 
sc
->
sc_ah
->
is_m⁄ô‹ög
 = 
åue
;

1444 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Monitor mode is disabled\n");

1445 
sc
->
sc_ah
->
is_m⁄ô‹ög
 = 
Ál£
;

1449 i‡(!
	`©h9k_is_ch™˘x_íabÀd
(Ë&& (
ch™ged
 & 
IEEE80211_CONF_CHANGE_CHANNEL
)) {

1450 
˘x
->
offch™√l
 = !!(
c⁄f
->
Êags
 & 
IEEE80211_CONF_OFFCHANNEL
);

1451 
	`©h_ch™˘x_£t_ch™√l
(
sc
, 
˘x
, &
hw
->
c⁄f
.
ch™def
);

1454 
	`muãx_u∆ock
(&
sc
->
muãx
);

1455 
	`©h9k_ps_ª°‹e
(
sc
);

1458 
	}
}

1460 
	#SUPPORTED_FILTERS
 \

1461 (
FIF_ALLMULTI
 | \

1462 
FIF_CONTROL
 | \

1463 
FIF_PSPOLL
 | \

1464 
FIF_OTHER_BSS
 | \

1465 
FIF_BCN_PRBRESP_PROMISC
 | \

1466 
FIF_PROBE_REQ
 | \

1467 
FIF_FCSFAIL
)

	)

1470 
	$©h9k_c⁄figuª_fûãr
(
õì80211_hw
 *
hw
,

1471 
ch™ged_Êags
,

1472 *
tŸÆ_Êags
,

1473 
u64
 
mu…iˇ°
)

1475 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1476 
©h_ch™˘x
 *
˘x
;

1477 
u32
 
rfût
;

1479 
ch™ged_Êags
 &
SUPPORTED_FILTERS
;

1480 *
tŸÆ_Êags
 &
SUPPORTED_FILTERS
;

1482 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

1483 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
)

1484 
˘x
->
rxfûãr
 = *
tŸÆ_Êags
;

1485 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


1486 
sc
->
offch™√l
.
ch™
.
rxfûãr
 = *
tŸÆ_Êags
;

1488 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1490 
	`©h9k_ps_wakeup
(
sc
);

1491 
rfût
 = 
	`©h_ˇl¸xfûãr
(
sc
);

1492 
	`©h9k_hw_£åxfûãr
(
sc
->
sc_ah
, 
rfût
);

1493 
	`©h9k_ps_ª°‹e
(
sc
);

1495 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
CONFIG
, "Set HW RX filter: 0x%x\n",

1496 
rfût
);

1497 
	}
}

1499 
	$©h9k_°a_add
(
õì80211_hw
 *
hw
,

1500 
õì80211_vif
 *
vif
,

1501 
õì80211_°a
 *
°a
)

1503 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1504 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1505 
©h_node
 *
™
 = (©h_nodê*Ë
°a
->
drv_¥iv
;

1506 
õì80211_key_c⁄f
 
ps_key
 = { };

1507 
key
;

1509 
	`©h_node_©èch
(
sc
, 
°a
, 
vif
);

1511 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 &&

1512 
vif
->
ty≥
 !
NL80211_IFTYPE_AP_VLAN
)

1515 
key
 = 
	`©h_key_c⁄fig
(
comm⁄
, 
vif
, 
°a
, &
ps_key
);

1516 i‡(
key
 > 0) {

1517 
™
->
ps_key
 = 
key
;

1518 
™
->
key_idx
[0] = 
key
;

1522 
	}
}

1524 
	$©h9k_dñ_ps_key
(
©h_so·c
 *
sc
,

1525 
õì80211_vif
 *
vif
,

1526 
õì80211_°a
 *
°a
)

1528 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1529 
©h_node
 *
™
 = (©h_nodê*Ë
°a
->
drv_¥iv
;

1530 
õì80211_key_c⁄f
 
ps_key
 = { .
hw_key_idx
 = 
™
->ps_key };

1532 i‡(!
™
->
ps_key
)

1535 
	`©h_key_dñëe
(
comm⁄
, &
ps_key
);

1536 
™
->
ps_key
 = 0;

1537 
™
->
key_idx
[0] = 0;

1538 
	}
}

1540 
	$©h9k_°a_ªmove
(
õì80211_hw
 *
hw
,

1541 
õì80211_vif
 *
vif
,

1542 
õì80211_°a
 *
°a
)

1544 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1546 
	`©h9k_dñ_ps_key
(
sc
, 
vif
, 
°a
);

1547 
	`©h_node_dëach
(
sc
, 
°a
);

1550 
	}
}

1552 
	$©h9k_°a_°©e
(
õì80211_hw
 *
hw
,

1553 
õì80211_vif
 *
vif
,

1554 
õì80211_°a
 *
°a
,

1555 
õì80211_°a_°©e
 
ﬁd_°©e
,

1556 
õì80211_°a_°©e
 
√w_°©e
)

1558 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1559 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1560 
ªt
 = 0;

1562 i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTH
 &&

1563 
√w_°©e
 =
IEEE80211_STA_ASSOC
) {

1564 
ªt
 = 
	`©h9k_°a_add
(
hw
, 
vif
, 
°a
);

1565 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1566 "Add sèti⁄: %pM\n", 
°a
->
addr
);

1567 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_ASSOC
 &&

1568 
√w_°©e
 =
IEEE80211_STA_AUTH
) {

1569 
ªt
 = 
	`©h9k_°a_ªmove
(
hw
, 
vif
, 
°a
);

1570 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1571 "Removê°©i⁄: %pM\n", 
°a
->
addr
);

1574 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

1575 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

1576 i‡(
ﬁd_°©e
 =
IEEE80211_STA_ASSOC
 &&

1577 
√w_°©e
 =
IEEE80211_STA_AUTHORIZED
)

1578 
	`©h_ch™˘x_evít
(
sc
, 
vif
,

1579 
ATH_CHANCTX_EVENT_AUTHORIZED
);

1583  
ªt
;

1584 
	}
}

1586 
	$©h9k_°a_£t_tx_fûãr
(
©h_hw
 *
ah
,

1587 
©h_node
 *
™
,

1588 
boﬁ
 
£t
)

1590 
i
;

1592 
i
 = 0; i < 
	`ARRAY_SIZE
(
™
->
key_idx
); i++) {

1593 i‡(!
™
->
key_idx
[
i
])

1595 
	`©h9k_hw_£t_tx_fûãr
(
ah
, 
™
->
key_idx
[
i
], 
£t
);

1597 
	}
}

1599 
	$©h9k_°a_nŸify
(
õì80211_hw
 *
hw
,

1600 
õì80211_vif
 *
vif
,

1601 
°a_nŸify_cmd
 
cmd
,

1602 
õì80211_°a
 *
°a
)

1604 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1605 
©h_node
 *
™
 = (©h_nodê*Ë
°a
->
drv_¥iv
;

1607 
cmd
) {

1608 
STA_NOTIFY_SLEEP
:

1609 
™
->
¶ìpög
 = 
åue
;

1610 
	`©h_tx_aggr_¶ìp
(
°a
, 
sc
, 
™
);

1611 
	`©h9k_°a_£t_tx_fûãr
(
sc
->
sc_ah
, 
™
, 
åue
);

1613 
STA_NOTIFY_AWAKE
:

1614 
	`©h9k_°a_£t_tx_fûãr
(
sc
->
sc_ah
, 
™
, 
Ál£
);

1615 
™
->
¶ìpög
 = 
Ál£
;

1616 
	`©h_tx_aggr_wakeup
(
sc
, 
™
);

1619 
	}
}

1621 
	$©h9k_c⁄f_tx
(
õì80211_hw
 *
hw
,

1622 
õì80211_vif
 *
vif
, 
u16
 
queue
,

1623 c⁄° 
õì80211_tx_queue_∑øms
 *
∑øms
)

1625 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1626 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1627 
©h_txq
 *
txq
;

1628 
©h9k_tx_queue_öfo
 
qi
;

1629 
ªt
 = 0;

1631 i‡(
queue
 >
IEEE80211_NUM_ACS
)

1634 
txq
 = 
sc
->
tx
.
txq_m≠
[
queue
];

1636 
	`©h9k_ps_wakeup
(
sc
);

1637 
	`muãx_lock
(&
sc
->
muãx
);

1639 
	`mem£t
(&
qi
, 0, (
©h9k_tx_queue_öfo
));

1641 
qi
.
tqi_aifs
 = 
∑øms
->
aifs
;

1642 
qi
.
tqi_cwmö
 = 
∑øms
->
cw_mö
;

1643 
qi
.
tqi_cwmax
 = 
∑øms
->
cw_max
;

1644 
qi
.
tqi_bur°Time
 = 
∑øms
->
tx›
 * 32;

1646 
	`©h_dbg
(
comm⁄
, 
CONFIG
,

1648 
queue
, 
txq
->
axq_qnum
, 
∑øms
->
aifs
,Ö¨ams->
cw_mö
,

1649 
∑øms
->
cw_max
,Ö¨ams->
tx›
);

1651 
	`©h_upd©e_max_aggr_‰amñí
(
sc
, 
queue
, 
qi
.
tqi_bur°Time
);

1652 
ªt
 = 
	`©h_txq_upd©e
(
sc
, 
txq
->
axq_qnum
, &
qi
);

1653 i‡(
ªt
)

1654 
	`©h_îr
(
comm⁄
, "TXQ Update failed\n");

1656 
	`muãx_u∆ock
(&
sc
->
muãx
);

1657 
	`©h9k_ps_ª°‹e
(
sc
);

1659  
ªt
;

1660 
	}
}

1662 
	$©h9k_£t_key
(
õì80211_hw
 *
hw
,

1663 
£t_key_cmd
 
cmd
,

1664 
õì80211_vif
 *
vif
,

1665 
õì80211_°a
 *
°a
,

1666 
õì80211_key_c⁄f
 *
key
)

1668 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1669 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1670 
©h_node
 *
™
 = 
NULL
;

1671 
ªt
 = 0, 
i
;

1673 i‡(
©h9k_mod∑øm_nohw¸y±
)

1674  -
ENOSPC
;

1676 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 ||

1677 
vif
->
ty≥
 =
NL80211_IFTYPE_MESH_POINT
) &&

1678 (
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
 ||

1679 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
) &&

1680 !(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

1688  -
EOPNOTSUPP
;

1691 
	`muãx_lock
(&
sc
->
muãx
);

1692 
	`©h9k_ps_wakeup
(
sc
);

1693 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "Së HW Key %d\n", 
cmd
);

1694 i‡(
°a
)

1695 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

1697 
cmd
) {

1698 
SET_KEY
:

1699 i‡(
°a
)

1700 
	`©h9k_dñ_ps_key
(
sc
, 
vif
, 
°a
);

1702 
key
->
hw_key_idx
 = 0;

1703 
ªt
 = 
	`©h_key_c⁄fig
(
comm⁄
, 
vif
, 
°a
, 
key
);

1704 i‡(
ªt
 >= 0) {

1705 
key
->
hw_key_idx
 = 
ªt
;

1707 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_IV
;

1708 i‡(
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
)

1709 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_MMIC
;

1710 i‡(
sc
->
sc_ah
->
sw_mgmt_¸y±o_tx
 &&

1711 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
)

1712 
key
->
Êags
 |
IEEE80211_KEY_FLAG_SW_MGMT_TX
;

1713 
ªt
 = 0;

1715 i‡(
™
 && 
key
->
hw_key_idx
) {

1716 
i
 = 0; i < 
	`ARRAY_SIZE
(
™
->
key_idx
); i++) {

1717 i‡(
™
->
key_idx
[
i
])

1719 
™
->
key_idx
[
i
] = 
key
->
hw_key_idx
;

1722 
	`WARN_ON
(
i
 =
	`ARRAY_SIZE
(
™
->
key_idx
));

1725 
DISABLE_KEY
:

1726 
	`©h_key_dñëe
(
comm⁄
, 
key
);

1727 i‡(
™
) {

1728 
i
 = 0; i < 
	`ARRAY_SIZE
(
™
->
key_idx
); i++) {

1729 i‡(
™
->
key_idx
[
i
] !
key
->
hw_key_idx
)

1731 
™
->
key_idx
[
i
] = 0;

1735 
key
->
hw_key_idx
 = 0;

1738 
ªt
 = -
EINVAL
;

1741 
	`©h9k_ps_ª°‹e
(
sc
);

1742 
	`muãx_u∆ock
(&
sc
->
muãx
);

1744  
ªt
;

1745 
	}
}

1747 
	$©h9k_bss_öfo_ch™ged
(
õì80211_hw
 *
hw
,

1748 
õì80211_vif
 *
vif
,

1749 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

1750 
u32
 
ch™ged
)

1752 
	#CHECK_ANI
 \

1753 (
BSS_CHANGED_ASSOC
 | \

1754 
BSS_CHANGED_IBSS
 | \

1755 
BSS_CHANGED_BEACON_ENABLED
)

	)

1757 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1758 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1759 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1760 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

1761 
¶Ÿtime
;

1763 
	`©h9k_ps_wakeup
(
sc
);

1764 
	`muãx_lock
(&
sc
->
muãx
);

1766 i‡(
ch™ged
 & 
BSS_CHANGED_ASSOC
) {

1767 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "BSSID %pM Changed ASSOC %d\n",

1768 
bss_c⁄f
->
bssid
, bss_c⁄f->
assoc
);

1770 
	`mem˝y
(
avp
->
bssid
, 
bss_c⁄f
->bssid, 
ETH_ALEN
);

1771 
avp
->
aid
 = 
bss_c⁄f
->aid;

1772 
avp
->
assoc
 = 
bss_c⁄f
->assoc;

1774 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
avp
->
ch™˘x
);

1777 i‡((
ch™ged
 & 
BSS_CHANGED_IBSS
) ||

1778 (
ch™ged
 & 
BSS_CHANGED_OCB
)) {

1779 
	`mem˝y
(
comm⁄
->
curbssid
, 
bss_c⁄f
->
bssid
, 
ETH_ALEN
);

1780 
comm⁄
->
cuøid
 = 
bss_c⁄f
->
aid
;

1781 
	`©h9k_hw_wrôe_associd
(
sc
->
sc_ah
);

1784 i‡((
ch™ged
 & 
BSS_CHANGED_BEACON_ENABLED
) ||

1785 (
ch™ged
 & 
BSS_CHANGED_BEACON_INT
) ||

1786 (
ch™ged
 & 
BSS_CHANGED_BEACON_INFO
)) {

1787 
	`©h9k_bóc⁄_c⁄fig
(
sc
, 
vif
, 
ch™ged
);

1788 i‡(
ch™ged
 & 
BSS_CHANGED_BEACON_ENABLED
)

1789 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
avp
->
ch™˘x
);

1792 i‡((
avp
->
ch™˘x
 =
sc
->
cur_ch™
) &&

1793 (
ch™ged
 & 
BSS_CHANGED_ERP_SLOT
)) {

1794 i‡(
bss_c⁄f
->
u£_sh‹t_¶Ÿ
)

1795 
¶Ÿtime
 = 9;

1797 
¶Ÿtime
 = 20;

1798 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

1804 
sc
->
bóc⁄
.
¶Ÿtime
 = slottime;

1805 
sc
->
bóc⁄
.
upd©e¶Ÿ
 = 
UPDATE
;

1807 
ah
->
¶Ÿtime
 = slottime;

1808 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

1812 i‡(
ch™ged
 & 
BSS_CHANGED_P2P_PS
)

1813 
	`©h9k_p2p_bss_öfo_ch™ged
(
sc
, 
vif
);

1815 i‡(
ch™ged
 & 
CHECK_ANI
)

1816 
	`©h_check_™i
(
sc
);

1818 i‡(
ch™ged
 & 
BSS_CHANGED_TXPOWER
) {

1819 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "vif %pMÖower %d dbmÖower_type %d\n",

1820 
vif
->
addr
, 
bss_c⁄f
->
txpowî
, bss_c⁄f->
txpowî_ty≥
);

1821 
	`©h9k_£t_txpowî
(
sc
, 
vif
);

1824 
	`muãx_u∆ock
(&
sc
->
muãx
);

1825 
	`©h9k_ps_ª°‹e
(
sc
);

1827 #unde‡
CHECK_ANI


1828 
	}
}

1830 
u64
 
	$©h9k_gë_tsf
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
)

1832 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1833 
u64
 
tsf
;

1835 
	`muãx_lock
(&
sc
->
muãx
);

1836 
	`©h9k_ps_wakeup
(
sc
);

1837 
tsf
 = 
	`©h9k_hw_gëtsf64
(
sc
->
sc_ah
);

1838 
	`©h9k_ps_ª°‹e
(
sc
);

1839 
	`muãx_u∆ock
(&
sc
->
muãx
);

1841  
tsf
;

1842 
	}
}

1844 
	$©h9k_£t_tsf
(
õì80211_hw
 *
hw
,

1845 
õì80211_vif
 *
vif
,

1846 
u64
 
tsf
)

1848 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1850 
	`muãx_lock
(&
sc
->
muãx
);

1851 
	`©h9k_ps_wakeup
(
sc
);

1852 
	`©h9k_hw_£âsf64
(
sc
->
sc_ah
, 
tsf
);

1853 
	`©h9k_ps_ª°‹e
(
sc
);

1854 
	`muãx_u∆ock
(&
sc
->
muãx
);

1855 
	}
}

1857 
	$©h9k_ª£t_tsf
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
)

1859 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1861 
	`muãx_lock
(&
sc
->
muãx
);

1863 
	`©h9k_ps_wakeup
(
sc
);

1864 
	`©h9k_hw_ª£t_tsf
(
sc
->
sc_ah
);

1865 
	`©h9k_ps_ª°‹e
(
sc
);

1867 
	`muãx_u∆ock
(&
sc
->
muãx
);

1868 
	}
}

1870 
	$©h9k_ampdu_a˘i⁄
(
õì80211_hw
 *
hw
,

1871 
õì80211_vif
 *
vif
,

1872 
õì80211_ampdu_∑øms
 *
∑øms
)

1874 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1875 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1876 
boﬁ
 
Êush
 = 
Ál£
;

1877 
ªt
 = 0;

1878 
õì80211_°a
 *
°a
 = 
∑øms
->sta;

1879 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
 = 
∑øms
->action;

1880 
u16
 
tid
 = 
∑øms
->tid;

1881 
u16
 *
s¢
 = &
∑øms
->ssn;

1883 
	`muãx_lock
(&
sc
->
muãx
);

1885 
a˘i⁄
) {

1886 
IEEE80211_AMPDU_RX_START
:

1888 
IEEE80211_AMPDU_RX_STOP
:

1890 
IEEE80211_AMPDU_TX_START
:

1891 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

1892 i‡(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
)) {

1893 
ªt
 = -
EBUSY
;

1897 
	`©h9k_ps_wakeup
(
sc
);

1898 
ªt
 = 
	`©h_tx_aggr_°¨t
(
sc
, 
°a
, 
tid
, 
s¢
);

1899 i‡(!
ªt
)

1900 
	`õì80211_°¨t_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1901 
	`©h9k_ps_ª°‹e
(
sc
);

1903 
IEEE80211_AMPDU_TX_STOP_FLUSH
:

1904 
IEEE80211_AMPDU_TX_STOP_FLUSH_CONT
:

1905 
Êush
 = 
åue
;

1906 
IEEE80211_AMPDU_TX_STOP_CONT
:

1907 
	`©h9k_ps_wakeup
(
sc
);

1908 
	`©h_tx_aggr_°›
(
sc
, 
°a
, 
tid
);

1909 i‡(!
Êush
)

1910 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1911 
	`©h9k_ps_ª°‹e
(
sc
);

1913 
IEEE80211_AMPDU_TX_OPERATIONAL
:

1914 
	`©h9k_ps_wakeup
(
sc
);

1915 
	`©h_tx_aggr_ªsume
(
sc
, 
°a
, 
tid
);

1916 
	`©h9k_ps_ª°‹e
(
sc
);

1919 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), "Unknown AMPDUáction\n");

1922 
	`muãx_u∆ock
(&
sc
->
muãx
);

1924  
ªt
;

1925 
	}
}

1927 
	$©h9k_gë_survey
(
õì80211_hw
 *
hw
, 
idx
,

1928 
survey_öfo
 *
survey
)

1930 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1931 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1932 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

1933 
õì80211_ch™√l
 *
ch™
;

1934 
pos
;

1936 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

1937  -
EOPNOTSUPP
;

1939 
	`•ö_lock_bh
(&
comm⁄
->
cc_lock
);

1940 i‡(
idx
 == 0)

1941 
	`©h_upd©e_survey_°©s
(
sc
);

1943 
sb™d
 = 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
];

1944 i‡(
sb™d
 && 
idx
 >sb™d->
n_ch™√ls
) {

1945 
idx
 -
sb™d
->
n_ch™√ls
;

1946 
sb™d
 = 
NULL
;

1949 i‡(!
sb™d
)

1950 
sb™d
 = 
hw
->
wùhy
->
b™ds
[
IEEE80211_BAND_5GHZ
];

1952 i‡(!
sb™d
 || 
idx
 >sb™d->
n_ch™√ls
) {

1953 
	`•ö_u∆ock_bh
(&
comm⁄
->
cc_lock
);

1954  -
ENOENT
;

1957 
ch™
 = &
sb™d
->
ch™√ls
[
idx
];

1958 
pos
 = 
ch™
->
hw_vÆue
;

1959 
	`mem˝y
(
survey
, &
sc
->survey[
pos
], (*survey));

1960 
survey
->
ch™√l
 = 
ch™
;

1961 
	`•ö_u∆ock_bh
(&
comm⁄
->
cc_lock
);

1964 
	}
}

1966 
	$©h9k_íabÀ_dy«ck
(
©h_so·c
 *
sc
)

1968 #ifde‡
CPTCFG_ATH9K_DYNACK


1969 
u32
 
rfût
;

1970 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1972 
	`©h_dy«ck_ª£t
(
ah
);

1974 
ah
->
dy«ck
.
íabÀd
 = 
åue
;

1975 
rfût
 = 
	`©h_ˇl¸xfûãr
(
sc
);

1976 
	`©h9k_hw_£åxfûãr
(
ah
, 
rfût
);

1978 
	}
}

1980 
	$©h9k_£t_covîage_˛ass
(
õì80211_hw
 *
hw
,

1981 
s16
 
covîage_˛ass
)

1983 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1984 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1986 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

1989 
	`muãx_lock
(&
sc
->
muãx
);

1991 i‡(
covîage_˛ass
 >= 0) {

1992 
ah
->
covîage_˛ass
 = coverage_class;

1993 i‡(
ah
->
dy«ck
.
íabÀd
) {

1994 
u32
 
rfût
;

1996 
ah
->
dy«ck
.
íabÀd
 = 
Ál£
;

1997 
rfût
 = 
	`©h_ˇl¸xfûãr
(
sc
);

1998 
	`©h9k_hw_£åxfûãr
(
ah
, 
rfût
);

2000 
	`©h9k_ps_wakeup
(
sc
);

2001 
	`©h9k_hw_öô_globÆ_£âögs
(
ah
);

2002 
	`©h9k_ps_ª°‹e
(
sc
);

2003 } i‡(!
ah
->
dy«ck
.
íabÀd
) {

2004 
	`©h9k_íabÀ_dy«ck
(
sc
);

2007 
	`muãx_u∆ock
(&
sc
->
muãx
);

2008 
	}
}

2010 
boﬁ
 
	$©h9k_has_tx_≥ndög
(
©h_so·c
 *
sc
,

2011 
boﬁ
 
sw_≥ndög
)

2013 
i
, 
≈íd
 = 0;

2015 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++) {

2016 i‡(!
	`ATH_TXQ_SETUP
(
sc
, 
i
))

2019 
≈íd
 = 
	`©h9k_has_≥ndög_‰ames
(
sc
, &sc->
tx
.
txq
[
i
],

2020 
sw_≥ndög
);

2021 i‡(
≈íd
)

2025  !!
≈íd
;

2026 
	}
}

2028 
	$©h9k_Êush
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2029 
u32
 
queues
, 
boﬁ
 
dr›
)

2031 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2032 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2034 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

2035 i‡(!
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
))

2036 
Êush
;

2048 
	`__©h9k_Êush
(
hw
, 
queues
, 
dr›
, 
åue
,Årue);

2051 
Êush
:

2052 
	`muãx_lock
(&
sc
->
muãx
);

2053 
	`__©h9k_Êush
(
hw
, 
queues
, 
dr›
, 
åue
, 
Ál£
);

2054 
	`muãx_u∆ock
(&
sc
->
muãx
);

2055 
	}
}

2057 
	$__©h9k_Êush
(
õì80211_hw
 *
hw
, 
u32
 
queues
, 
boﬁ
 
dr›
,

2058 
boﬁ
 
sw_≥ndög
, boﬁ 
timeout_ovîride
)

2060 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2061 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2062 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2063 
timeout
;

2064 
boﬁ
 
døö_txq
;

2066 
	`ˇn˚l_dñayed_w‹k_sync
(&
sc
->
tx_com∂ëe_w‹k
);

2068 i‡(
ah
->
ah_Êags
 & 
AH_UNPLUGGED
) {

2069 
	`©h_dbg
(
comm⁄
, 
ANY
, "Device has been unplugged!\n");

2073 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

2074 
	`©h_dbg
(
comm⁄
, 
ANY
, "DeviceÇotÖresent\n");

2078 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

2079 i‡(
timeout_ovîride
)

2080 
timeout
 = 
HZ
 / 5;

2082 
timeout
 = 
sc
->
cur_ch™
->
Êush_timeout
;

2083 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

2085 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2086 "FlushÅimeout: %d\n", 
	`jiffõs_to_m£cs
(
timeout
));

2088 i‡(
	`waô_evít_timeout
(
sc
->
tx_waô
, !
	`©h9k_has_tx_≥ndög
(sc, 
sw_≥ndög
),

2089 
timeout
) > 0)

2090 
dr›
 = 
Ál£
;

2092 i‡(
dr›
) {

2093 
	`©h9k_ps_wakeup
(
sc
);

2094 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

2095 
døö_txq
 = 
	`©h_døö_Æl_txq
(
sc
);

2096 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

2098 i‡(!
døö_txq
)

2099 
	`©h_ª£t
(
sc
, 
NULL
);

2101 
	`©h9k_ps_ª°‹e
(
sc
);

2104 
	`õì80211_queue_dñayed_w‹k
(
hw
, &
sc
->
tx_com∂ëe_w‹k
, 0);

2105 
	}
}

2107 
boﬁ
 
	$©h9k_tx_‰ames_≥ndög
(
õì80211_hw
 *
hw
)

2109 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2111  
	`©h9k_has_tx_≥ndög
(
sc
, 
åue
);

2112 
	}
}

2114 
	$©h9k_tx_œ°_bóc⁄
(
õì80211_hw
 *
hw
)

2116 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2117 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2118 
õì80211_vif
 *
vif
;

2119 
©h_vif
 *
avp
;

2120 
©h_buf
 *
bf
;

2121 
©h_tx_°©us
 
ts
;

2122 
boﬁ
 
edma
 = !!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
);

2123 
°©us
;

2125 
vif
 = 
sc
->
bóc⁄
.
b¶Ÿ
[0];

2126 i‡(!
vif
)

2129 i‡(!
vif
->
bss_c⁄f
.
íabÀ_bóc⁄
)

2132 
avp
 = (*)
vif
->
drv_¥iv
;

2134 i‡(!
sc
->
bóc⁄
.
tx_¥o˚s£d
 && !
edma
) {

2135 
	`èskÀt_dißbÀ
(&
sc
->
bc⁄_èskÀt
);

2137 
bf
 = 
avp
->
av_bcbuf
;

2138 i‡(!
bf
 || !bf->
bf_mpdu
)

2139 
skù
;

2141 
°©us
 = 
	`©h9k_hw_tx¥ocdesc
(
ah
, 
bf
->
bf_desc
, &
ts
);

2142 i‡(
°©us
 =-
EINPROGRESS
)

2143 
skù
;

2145 
sc
->
bóc⁄
.
tx_¥o˚s£d
 = 
åue
;

2146 
sc
->
bóc⁄
.
tx_œ°
 = !(
ts
.
ts_°©us
 & 
ATH9K_TXERR_MASK
);

2148 
skù
:

2149 
	`èskÀt_íabÀ
(&
sc
->
bc⁄_èskÀt
);

2152  
sc
->
bóc⁄
.
tx_œ°
;

2153 
	}
}

2155 
	$©h9k_gë_°©s
(
õì80211_hw
 *
hw
,

2156 
õì80211_low_Àvñ_°©s
 *
°©s
)

2158 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2159 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2160 
©h9k_mib_°©s
 *
mib_°©s
 = &
ah
->
ah_mibSèts
;

2162 
°©s
->
dŸ11ACKFaûuªCou¡
 = 
mib_°©s
->
ackrcv_bad
;

2163 
°©s
->
dŸ11RTSFaûuªCou¡
 = 
mib_°©s
->
πs_bad
;

2164 
°©s
->
dŸ11FCSEº‹Cou¡
 = 
mib_°©s
->
fcs_bad
;

2165 
°©s
->
dŸ11RTSSuc˚ssCou¡
 = 
mib_°©s
->
πs_good
;

2167 
	}
}

2169 
u32
 
	$fûl_chaömask
(
u32
 
ˇp
, u32 
√w
)

2171 
u32
 
fûÀd
 = 0;

2172 
i
;

2174 
i
 = 0; 
ˇp
 && 
√w
; i++, cap >>= 1) {

2175 i‡(!(
ˇp
 & 
	`BIT
(0)))

2178 i‡(
√w
 & 
	`BIT
(0))

2179 
fûÀd
 |
	`BIT
(
i
);

2181 
√w
 >>= 1;

2184  
fûÀd
;

2185 
	}
}

2187 
boﬁ
 
	$vÆid©e_™ã¬a_mask
(
©h_hw
 *
ah
, 
u32
 
vÆ
)

2189 i‡(
	`AR_SREV_9300_20_OR_LATER
(
ah
))

2190  
åue
;

2192 
vÆ
 & 0x7) {

2196  
åue
;

2198  (
ah
->
ˇps
.
rx_chaömask
 == 1);

2200  
Ál£
;

2202 
	}
}

2204 
	$©h9k_£t_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 
tx_™t
, u32 
rx_™t
)

2206 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2207 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2209 i‡(
ah
->
ˇps
.
rx_chaömask
 != 1)

2210 
rx_™t
 |
tx_™t
;

2212 i‡(!
	`vÆid©e_™ã¬a_mask
(
ah
, 
rx_™t
Ë|| !
tx_™t
)

2213  -
EINVAL
;

2215 
sc
->
™t_rx
 = 
rx_™t
;

2216 
sc
->
™t_tx
 = 
tx_™t
;

2218 i‡(
ah
->
ˇps
.
rx_chaömask
 == 1)

2222 i‡(
	`AR_SREV_9100
(
ah
))

2223 
ah
->
rxchaömask
 = 0x7;

2225 
ah
->
rxchaömask
 = 
	`fûl_chaömask
◊h->
ˇps
.
rx_chaömask
, 
rx_™t
);

2227 
ah
->
txchaömask
 = 
	`fûl_chaömask
◊h->
ˇps
.
tx_chaömask
, 
tx_™t
);

2228 
	`©h9k_cmn_ªlﬂd_chaömask
(
ah
);

2231 
	}
}

2233 
	$©h9k_gë_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 *
tx_™t
, u32 *
rx_™t
)

2235 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2237 *
tx_™t
 = 
sc
->
™t_tx
;

2238 *
rx_™t
 = 
sc
->
™t_rx
;

2240 
	}
}

2242 
	$©h9k_sw_sˇn_°¨t
(
õì80211_hw
 *
hw
,

2243 
õì80211_vif
 *
vif
,

2244 c⁄° 
u8
 *
mac_addr
)

2246 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2247 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2248 
	`£t_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

2249 
	}
}

2251 
	$©h9k_sw_sˇn_com∂ëe
(
õì80211_hw
 *
hw
,

2252 
õì80211_vif
 *
vif
)

2254 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2255 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2256 
	`˛ór_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

2257 
	}
}

2259 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


2261 
	$©h9k_ˇn˚l_≥ndög_offch™√l
(
©h_so·c
 *
sc
)

2263 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2265 i‡(
sc
->
offch™√l
.
roc_vif
) {

2266 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2267 "%s: Ab‹tög RoC\n", 
__func__
);

2269 
	`dñ_timî_sync
(&
sc
->
offch™√l
.
timî
);

2270 i‡(
sc
->
offch™√l
.
°©e
 >
ATH_OFFCHANNEL_ROC_START
)

2271 
	`©h_roc_com∂ëe
(
sc
, 
ATH_ROC_COMPLETE_ABORT
);

2274 i‡(
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
)) {

2275 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2276 "%s: Ab‹tög HW sˇn\n", 
__func__
);

2278 
	`dñ_timî_sync
(&
sc
->
offch™√l
.
timî
);

2279 
	`©h_sˇn_com∂ëe
(
sc
, 
åue
);

2281 
	}
}

2283 
	$©h9k_hw_sˇn
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2284 
õì80211_sˇn_ªque°
 *
hw_ªq
)

2286 
cfg80211_sˇn_ªque°
 *
ªq
 = &
hw_ªq
->req;

2287 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2288 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2289 
ªt
 = 0;

2291 
	`muãx_lock
(&
sc
->
muãx
);

2293 i‡(
	`WARN_ON
(
sc
->
offch™√l
.
sˇn_ªq
)) {

2294 
ªt
 = -
EBUSY
;

2295 
out
;

2298 
	`©h9k_ps_wakeup
(
sc
);

2299 
	`£t_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
);

2300 
sc
->
offch™√l
.
sˇn_vif
 = 
vif
;

2301 
sc
->
offch™√l
.
sˇn_ªq
 = 
ªq
;

2302 
sc
->
offch™√l
.
sˇn_idx
 = 0;

2304 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "HW scanÑequestÑeceived on vif: %pM\n",

2305 
vif
->
addr
);

2307 i‡(
sc
->
offch™√l
.
°©e
 =
ATH_OFFCHANNEL_IDLE
) {

2308 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "Starting HW scan\n");

2309 
	`©h_offch™√l_√xt
(
sc
);

2312 
out
:

2313 
	`muãx_u∆ock
(&
sc
->
muãx
);

2315  
ªt
;

2316 
	}
}

2318 
	$©h9k_ˇn˚l_hw_sˇn
(
õì80211_hw
 *
hw
,

2319 
õì80211_vif
 *
vif
)

2321 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2322 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2324 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "C™˚»HW sˇ¿⁄ vif: %pM\n", 
vif
->
addr
);

2326 
	`muãx_lock
(&
sc
->
muãx
);

2327 
	`dñ_timî_sync
(&
sc
->
offch™√l
.
timî
);

2328 
	`©h_sˇn_com∂ëe
(
sc
, 
åue
);

2329 
	`muãx_u∆ock
(&
sc
->
muãx
);

2330 
	}
}

2332 
	$©h9k_ªmaö_⁄_ch™√l
(
õì80211_hw
 *
hw
,

2333 
õì80211_vif
 *
vif
,

2334 
õì80211_ch™√l
 *
ch™
, 
duøti⁄
,

2335 
õì80211_roc_ty≥
 
ty≥
)

2337 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2338 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2339 
ªt
 = 0;

2341 
	`muãx_lock
(&
sc
->
muãx
);

2343 i‡(
	`WARN_ON
(
sc
->
offch™√l
.
roc_vif
)) {

2344 
ªt
 = -
EBUSY
;

2345 
out
;

2348 
	`©h9k_ps_wakeup
(
sc
);

2349 
sc
->
offch™√l
.
roc_vif
 = 
vif
;

2350 
sc
->
offch™√l
.
roc_ch™
 = 
ch™
;

2351 
sc
->
offch™√l
.
roc_duøti⁄
 = 
duøti⁄
;

2353 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2355 
vif
->
addr
, 
ty≥
, 
duøti⁄
);

2357 i‡(
sc
->
offch™√l
.
°©e
 =
ATH_OFFCHANNEL_IDLE
) {

2358 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "Starting RoCÖeriod\n");

2359 
	`©h_offch™√l_√xt
(
sc
);

2362 
out
:

2363 
	`muãx_u∆ock
(&
sc
->
muãx
);

2365  
ªt
;

2366 
	}
}

2368 
	$©h9k_ˇn˚l_ªmaö_⁄_ch™√l
(
õì80211_hw
 *
hw
)

2370 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2371 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2373 
	`muãx_lock
(&
sc
->
muãx
);

2375 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
, "Cancel RoC\n");

2376 
	`dñ_timî_sync
(&
sc
->
offch™√l
.
timî
);

2378 i‡(
sc
->
offch™√l
.
roc_vif
) {

2379 i‡(
sc
->
offch™√l
.
°©e
 >
ATH_OFFCHANNEL_ROC_START
)

2380 
	`©h_roc_com∂ëe
(
sc
, 
ATH_ROC_COMPLETE_CANCEL
);

2383 
	`muãx_u∆ock
(&
sc
->
muãx
);

2386 
	}
}

2388 
	$©h9k_add_ch™˘x
(
õì80211_hw
 *
hw
,

2389 
õì80211_ch™˘x_c⁄f
 *
c⁄f
)

2391 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2392 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2393 
©h_ch™˘x
 *
˘x
, **
±r
;

2394 
pos
;

2396 
	`muãx_lock
(&
sc
->
muãx
);

2398 
	`©h_f‹_óch_ch™˘x
(
sc
, 
˘x
) {

2399 i‡(
˘x
->
assig√d
)

2402 
±r
 = (*Ë
c⁄f
->
drv_¥iv
;

2403 *
±r
 = 
˘x
;

2404 
˘x
->
assig√d
 = 
åue
;

2405 
pos
 = 
˘x
 - &
sc
->
ch™˘x
[0];

2406 
˘x
->
hw_queue_ba£
 = 
pos
 * 
IEEE80211_NUM_ACS
;

2408 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2410 
c⁄f
->
def
.
ch™
->
˚¡î_‰eq
);

2412 
	`©h_ch™˘x_£t_ch™√l
(
sc
, 
˘x
, &
c⁄f
->
def
);

2414 
	`muãx_u∆ock
(&
sc
->
muãx
);

2418 
	`muãx_u∆ock
(&
sc
->
muãx
);

2419  -
ENOSPC
;

2420 
	}
}

2423 
	$©h9k_ªmove_ch™˘x
(
õì80211_hw
 *
hw
,

2424 
õì80211_ch™˘x_c⁄f
 *
c⁄f
)

2426 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2427 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2428 
©h_ch™˘x
 *
˘x
 = 
	`©h_ch™˘x_gë
(
c⁄f
);

2430 
	`muãx_lock
(&
sc
->
muãx
);

2432 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2434 
c⁄f
->
def
.
ch™
->
˚¡î_‰eq
);

2436 
˘x
->
assig√d
 = 
Ál£
;

2437 
˘x
->
hw_queue_ba£
 = 0;

2438 
	`©h_ch™˘x_evít
(
sc
, 
NULL
, 
ATH_CHANCTX_EVENT_UNASSIGN
);

2440 
	`muãx_u∆ock
(&
sc
->
muãx
);

2441 
	}
}

2443 
	$©h9k_ch™ge_ch™˘x
(
õì80211_hw
 *
hw
,

2444 
õì80211_ch™˘x_c⁄f
 *
c⁄f
,

2445 
u32
 
ch™ged
)

2447 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2448 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2449 
©h_ch™˘x
 *
˘x
 = 
	`©h_ch™˘x_gë
(
c⁄f
);

2451 
	`muãx_lock
(&
sc
->
muãx
);

2452 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2454 
c⁄f
->
def
.
ch™
->
˚¡î_‰eq
);

2455 
	`©h_ch™˘x_£t_ch™√l
(
sc
, 
˘x
, &
c⁄f
->
def
);

2456 
	`muãx_u∆ock
(&
sc
->
muãx
);

2457 
	}
}

2459 
	$©h9k_assign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

2460 
õì80211_vif
 *
vif
,

2461 
õì80211_ch™˘x_c⁄f
 *
c⁄f
)

2463 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2464 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2465 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

2466 
©h_ch™˘x
 *
˘x
 = 
	`©h_ch™˘x_gë
(
c⁄f
);

2467 
i
;

2469 
	`©h9k_ˇn˚l_≥ndög_offch™√l
(
sc
);

2471 
	`muãx_lock
(&
sc
->
muãx
);

2473 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2475 
vif
->
addr
, vif->
ty≥
, vif->
p2p
,

2476 
c⁄f
->
def
.
ch™
->
˚¡î_‰eq
);

2478 
avp
->
ch™˘x
 = 
˘x
;

2479 
˘x
->
nvifs_assig√d
++;

2480 
	`li°_add_èû
(&
avp
->
li°
, &
˘x
->
vifs
);

2481 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
˘x
);

2482 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++)

2483 
vif
->
hw_queue
[
i
] = 
˘x
->
hw_queue_ba£
 + i;

2485 
	`muãx_u∆ock
(&
sc
->
muãx
);

2488 
	}
}

2490 
	$©h9k_u«ssign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

2491 
õì80211_vif
 *
vif
,

2492 
õì80211_ch™˘x_c⁄f
 *
c⁄f
)

2494 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2495 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2496 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

2497 
©h_ch™˘x
 *
˘x
 = 
	`©h_ch™˘x_gë
(
c⁄f
);

2498 
ac
;

2500 
	`©h9k_ˇn˚l_≥ndög_offch™√l
(
sc
);

2502 
	`muãx_lock
(&
sc
->
muãx
);

2504 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2506 
vif
->
addr
, vif->
ty≥
, vif->
p2p
,

2507 
c⁄f
->
def
.
ch™
->
˚¡î_‰eq
);

2509 
avp
->
ch™˘x
 = 
NULL
;

2510 
˘x
->
nvifs_assig√d
--;

2511 
	`li°_dñ
(&
avp
->
li°
);

2512 
	`©h9k_ˇlcuœã_summ¨y_°©e
(
sc
, 
˘x
);

2513 
ac
 = 0;á¯< 
IEEE80211_NUM_ACS
;ác++)

2514 
vif
->
hw_queue
[
ac
] = 
IEEE80211_INVAL_HW_QUEUE
;

2516 
	`muãx_u∆ock
(&
sc
->
muãx
);

2517 
	}
}

2519 
	$©h9k_mgd_¥ï¨e_tx
(
õì80211_hw
 *
hw
,

2520 
õì80211_vif
 *
vif
)

2522 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2523 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2524 
©h_vif
 *
avp
 = (©h_vi‡*Ë
vif
->
drv_¥iv
;

2525 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
;

2526 
©h_ch™˘x
 *
go_˘x
;

2527 
timeout
;

2528 
boﬁ
 
ch™ged
 = 
Ál£
;

2529 
u32
 
bóc⁄_öt
;

2531 i‡(!
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
))

2534 i‡(!
avp
->
ch™˘x
)

2537 
	`muãx_lock
(&
sc
->
muãx
);

2539 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

2540 i‡(
sc
->
√xt_ch™
 || (sc->
cur_ch™
 !
avp
->
ch™˘x
))

2541 
ch™ged
 = 
åue
;

2542 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

2544 i‡(!
ch™ged
)

2545 
out
;

2547 
	`©h9k_ˇn˚l_≥ndög_offch™√l
(
sc
);

2549 
go_˘x
 = 
	`©h_is_go_ch™˘x_¥e£¡
(
sc
);

2551 i‡(
go_˘x
) {

2556 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

2557 
sc
->
sched
.
mgd_¥ï¨e_tx
 = 
åue
;

2558 
cur_c⁄f
 = &
go_˘x
->
bóc⁄
;

2559 
bóc⁄_öt
 = 
	`TU_TO_USEC
(
cur_c⁄f
->
bóc⁄_öãrvÆ
);

2560 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

2562 
timeout
 = 
	`u£cs_to_jiffõs
(
bóc⁄_öt
 * 2);

2563 
	`öô_com∂ëi⁄
(&
sc
->
go_bóc⁄
);

2565 
	`muãx_u∆ock
(&
sc
->
muãx
);

2567 i‡(
	`waô_f‹_com∂ëi⁄_timeout
(&
sc
->
go_bóc⁄
,

2568 
timeout
) == 0) {

2569 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2572 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

2573 
sc
->
sched
.
mgd_¥ï¨e_tx
 = 
Ál£
;

2574 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

2577 
	`muãx_lock
(&
sc
->
muãx
);

2580 
	`©h_dbg
(
comm⁄
, 
CHAN_CTX
,

2582 
__func__
, 
vif
->
addr
);

2584 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

2585 
sc
->
√xt_ch™
 = 
avp
->
ch™˘x
;

2586 
sc
->
sched
.
°©e
 = 
ATH_CHANCTX_STATE_FORCE_ACTIVE
;

2587 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

2589 
	`©h_ch™˘x_£t_√xt
(
sc
, 
åue
);

2590 
out
:

2591 
	`muãx_u∆ock
(&
sc
->
muãx
);

2592 
	}
}

2594 
	$©h9k_fûl_ch™˘x_›s
()

2596 i‡(!
	`©h9k_is_ch™˘x_íabÀd
())

2599 
©h9k_›s
.
hw_sˇn
 = 
©h9k_hw_sˇn
;

2600 
©h9k_›s
.
ˇn˚l_hw_sˇn
 = 
©h9k_ˇn˚l_hw_sˇn
;

2601 
©h9k_›s
.
ªmaö_⁄_ch™√l
 = 
©h9k_ªmaö_⁄_ch™√l
;

2602 
©h9k_›s
.
ˇn˚l_ªmaö_⁄_ch™√l
 = 
©h9k_ˇn˚l_ªmaö_⁄_ch™√l
;

2603 
©h9k_›s
.
add_ch™˘x
 = 
©h9k_add_ch™˘x
;

2604 
©h9k_›s
.
ªmove_ch™˘x
 = 
©h9k_ªmove_ch™˘x
;

2605 
©h9k_›s
.
ch™ge_ch™˘x
 = 
©h9k_ch™ge_ch™˘x
;

2606 
©h9k_›s
.
assign_vif_ch™˘x
 = 
©h9k_assign_vif_ch™˘x
;

2607 
©h9k_›s
.
u«ssign_vif_ch™˘x
 = 
©h9k_u«ssign_vif_ch™˘x
;

2608 
©h9k_›s
.
mgd_¥ï¨e_tx
 = 
©h9k_mgd_¥ï¨e_tx
;

2609 
	}
}

2613 
	$©h9k_gë_txpowî
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2614 *
dbm
)

2616 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2617 
©h_vif
 *
avp
 = (*)
vif
->
drv_¥iv
;

2619 
	`muãx_lock
(&
sc
->
muãx
);

2620 i‡(
avp
->
ch™˘x
)

2621 *
dbm
 = 
avp
->
ch™˘x
->
cur_txpowî
;

2623 *
dbm
 = 
sc
->
cur_ch™
->
cur_txpowî
;

2624 
	`muãx_u∆ock
(&
sc
->
muãx
);

2626 *
dbm
 /= 2;

2629 
	}
}

2631 
õì80211_›s
 
	g©h9k_›s
 = {

2632 .
tx
 = 
©h9k_tx
,

2633 .
	g°¨t
 = 
©h9k_°¨t
,

2634 .
	g°›
 = 
©h9k_°›
,

2635 .
	gadd_öãrÁ˚
 = 
©h9k_add_öãrÁ˚
,

2636 .
	gch™ge_öãrÁ˚
 = 
©h9k_ch™ge_öãrÁ˚
,

2637 .
	gªmove_öãrÁ˚
 = 
©h9k_ªmove_öãrÁ˚
,

2638 .
	gc⁄fig
 = 
©h9k_c⁄fig
,

2639 .
	gc⁄figuª_fûãr
 = 
©h9k_c⁄figuª_fûãr
,

2640 .
	g°a_°©e
 = 
©h9k_°a_°©e
,

2641 .
	g°a_nŸify
 = 
©h9k_°a_nŸify
,

2642 .
	gc⁄f_tx
 = 
©h9k_c⁄f_tx
,

2643 .
	gbss_öfo_ch™ged
 = 
©h9k_bss_öfo_ch™ged
,

2644 .
	g£t_key
 = 
©h9k_£t_key
,

2645 .
	ggë_tsf
 = 
©h9k_gë_tsf
,

2646 .
	g£t_tsf
 = 
©h9k_£t_tsf
,

2647 .
	gª£t_tsf
 = 
©h9k_ª£t_tsf
,

2648 .
	gampdu_a˘i⁄
 = 
©h9k_ampdu_a˘i⁄
,

2649 .
	ggë_survey
 = 
©h9k_gë_survey
,

2650 .
	grfkûl_pﬁl
 = 
©h9k_rfkûl_pﬁl_°©e
,

2651 .
	g£t_covîage_˛ass
 = 
©h9k_£t_covîage_˛ass
,

2652 .
	gÊush
 = 
©h9k_Êush
,

2653 .
	gtx_‰ames_≥ndög
 = 
©h9k_tx_‰ames_≥ndög
,

2654 .
	gtx_œ°_bóc⁄
 = 
©h9k_tx_œ°_bóc⁄
,

2655 .
	gªÀa£_buf„ªd_‰ames
 = 
©h9k_ªÀa£_buf„ªd_‰ames
,

2656 .
	ggë_°©s
 = 
©h9k_gë_°©s
,

2657 .
	g£t_™ã¬a
 = 
©h9k_£t_™ã¬a
,

2658 .
	ggë_™ã¬a
 = 
©h9k_gë_™ã¬a
,

2660 #ifde‡
CPTCFG_ATH9K_WOW


2661 .
	gsu•íd
 = 
©h9k_su•íd
,

2662 .
	gªsume
 = 
©h9k_ªsume
,

2663 .
	g£t_wakeup
 = 
©h9k_£t_wakeup
,

2666 #ifde‡
CPTCFG_ATH9K_DEBUGFS


2667 .
	ggë_ë_s£t_cou¡
 = 
©h9k_gë_ë_s£t_cou¡
,

2668 .
	ggë_ë_°©s
 = 
©h9k_gë_ë_°©s
,

2669 .
	ggë_ë_°rögs
 = 
©h9k_gë_ë_°rögs
,

2672 #i‡
deföed
(
CPTCFG_MAC80211_DEBUGFS
Ë&& deföed(
CPTCFG_ATH9K_STATION_STATISTICS
)

2673 .
	g°a_add_debugfs
 = 
©h9k_°a_add_debugfs
,

2675 .
	gsw_sˇn_°¨t
 = 
©h9k_sw_sˇn_°¨t
,

2676 .
	gsw_sˇn_com∂ëe
 = 
©h9k_sw_sˇn_com∂ëe
,

2677 .
	ggë_txpowî
 = 
©h9k_gë_txpowî
,

	@mci.c

17 
	~<löux/dma-m≠pög.h
>

18 
	~<löux/¶ab.h
>

20 
	~"©h9k.h
"

21 
	~"mci.h
"

23 c⁄° 
u8
 
	g©h_mci_duty_cy˛e
[] = { 55, 50, 60, 70, 80, 85, 90, 95, 98 };

25 
©h_mci_¥ofûe_öfo
*

26 
	$©h_mci_föd_¥ofûe
(
©h_mci_¥ofûe
 *
mci
,

27 
©h_mci_¥ofûe_öfo
 *
öfo
)

29 
©h_mci_¥ofûe_öfo
 *
íåy
;

31 i‡(
	`li°_em±y
(&
mci
->
öfo
))

32  
NULL
;

34 
	`li°_f‹_óch_íåy
(
íåy
, &
mci
->
öfo
, 
li°
) {

35 i‡(
íåy
->
c⁄n_h™dÀ
 =
öfo
->conn_handle)

36  
íåy
;

38  
NULL
;

39 
	}
}

41 
boﬁ
 
	$©h_mci_add_¥ofûe
(
©h_comm⁄
 *
comm⁄
,

42 
©h_mci_¥ofûe
 *
mci
,

43 
©h_mci_¥ofûe_öfo
 *
öfo
)

45 
©h_mci_¥ofûe_öfo
 *
íåy
;

46 
u8
 
voi˚_¥i‹ôy
[] = { 110, 110, 110, 112, 110, 110, 114, 116, 118 };

48 i‡((
mci
->
num_sco
 =
ATH_MCI_MAX_SCO_PROFILE
) &&

49 (
öfo
->
ty≥
 =
MCI_GPM_COEX_PROFILE_VOICE
))

50  
Ál£
;

52 i‡(((
	`NUM_PROF
(
mci
Ë- mci->
num_sco
Ë=
ATH_MCI_MAX_ACL_PROFILE
) &&

53 (
öfo
->
ty≥
 !
MCI_GPM_COEX_PROFILE_VOICE
))

54  
Ál£
;

56 
íåy
 = 
	`kzÆloc
((*íåy), 
GFP_ATOMIC
);

57 i‡(!
íåy
)

58  
Ál£
;

60 
	`mem˝y
(
íåy
, 
öfo
, 10);

61 
	`INC_PROF
(
mci
, 
öfo
);

62 
	`li°_add_èû
(&
íåy
->
li°
, &
mci
->
öfo
);

63 i‡(
öfo
->
ty≥
 =
MCI_GPM_COEX_PROFILE_VOICE
) {

64 i‡(
öfo
->
voi˚_ty≥
 < (
voi˚_¥i‹ôy
))

65 
mci
->
voi˚_¥i‹ôy
 = voi˚_¥i‹ôy[
öfo
->
voi˚_ty≥
];

67 
mci
->
voi˚_¥i‹ôy
 = 110;

70  
åue
;

71 
	}
}

73 
	$©h_mci_dñ_¥ofûe
(
©h_comm⁄
 *
comm⁄
,

74 
©h_mci_¥ofûe
 *
mci
,

75 
©h_mci_¥ofûe_öfo
 *
íåy
)

77 i‡(!
íåy
)

80 
	`DEC_PROF
(
mci
, 
íåy
);

81 
	`li°_dñ
(&
íåy
->
li°
);

82 
	`k‰ì
(
íåy
);

83 
	}
}

85 
	$©h_mci_Êush_¥ofûe
(
©h_mci_¥ofûe
 *
mci
)

87 
©h_mci_¥ofûe_öfo
 *
öfo
, *
töfo
;

89 
mci
->
aggr_limô
 = 0;

90 
mci
->
num_mgmt
 = 0;

92 i‡(
	`li°_em±y
(&
mci
->
öfo
))

95 
	`li°_f‹_óch_íåy_ß„
(
öfo
, 
töfo
, &
mci
->öfo, 
li°
) {

96 
	`li°_dñ
(&
öfo
->
li°
);

97 
	`DEC_PROF
(
mci
, 
öfo
);

98 
	`k‰ì
(
öfo
);

100 
	}
}

102 
	$©h_mci_adju°_aggr_limô
(
©h_btc€x
 *
btc€x
)

104 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

105 
u32
 
wœn_aútime
 = 
btc€x
->
btc€x_≥riod
 *

106 (100 - 
btc€x
->
duty_cy˛e
) / 100;

114 i‡((
wœn_aútime
 <= 4) &&

115 (!
mci
->
aggr_limô
 || (mci->aggr_limô > (2 * 
wœn_aútime
))))

116 
mci
->
aggr_limô
 = 2 * 
wœn_aútime
;

117 
	}
}

119 
	$©h_mci_upd©e_scheme
(
©h_so·c
 *
sc
)

121 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

122 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

123 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

124 
©h9k_hw_mci
 *
mci_hw
 = &
sc
->
sc_ah
->
btc€x_hw
.
mci
;

125 
©h_mci_¥ofûe_öfo
 *
öfo
;

126 
u32
 
num_¥ofûe
 = 
	`NUM_PROF
(
mci
);

128 i‡(
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_DISABLE_TUNING
)

129 
skù_tunög
;

131 
mci
->
aggr_limô
 = 0;

132 
btc€x
->
duty_cy˛e
 = 
©h_mci_duty_cy˛e
[
num_¥ofûe
];

133 
btc€x
->
btc€x_≥riod
 = 
ATH_MCI_DEF_BT_PERIOD
;

134 i‡(
	`NUM_PROF
(
mci
))

135 
btc€x
->
bt_°omp_ty≥
 = 
ATH_BTCOEX_STOMP_LOW
;

137 
btc€x
->
bt_°omp_ty≥
 = 
mci
->
num_mgmt
 ? 
ATH_BTCOEX_STOMP_ALL
 :

138 
ATH_BTCOEX_STOMP_LOW
;

140 i‡(
num_¥ofûe
 == 1) {

141 
öfo
 = 
	`li°_fú°_íåy
(&
mci
->info,

142 
©h_mci_¥ofûe_öfo
,

143 
li°
);

144 i‡(
mci
->
num_sco
) {

145 i‡(
öfo
->
T
 == 12)

146 
mci
->
aggr_limô
 = 8;

147 i‡(
öfo
->
T
 == 6) {

148 
mci
->
aggr_limô
 = 6;

149 
btc€x
->
duty_cy˛e
 = 30;

151 
mci
->
aggr_limô
 = 6;

152 
	`©h_dbg
(
comm⁄
, 
MCI
,

154 
mci
->
aggr_limô
);

155 } i‡(
mci
->
num_∑n
 || mci->
num_Ÿhî_a˛
) {

160 
btc€x
->
duty_cy˛e
 = 
	`AR_SREV_9565
(
sc
->
sc_ah
) ? 40 : 35;

161 
btc€x
->
btc€x_≥riod
 = 53;

162 
	`©h_dbg
(
comm⁄
, 
MCI
,

164 
btc€x
->
duty_cy˛e
, btc€x->
btc€x_≥riod
);

165 } i‡(
mci
->
num_hid
) {

166 
btc€x
->
duty_cy˛e
 = 30;

167 
mci
->
aggr_limô
 = 6;

168 
	`©h_dbg
(
comm⁄
, 
MCI
,

172 } i‡(
num_¥ofûe
 == 2) {

173 i‡(
mci
->
num_hid
 == 2)

174 
btc€x
->
duty_cy˛e
 = 30;

175 
mci
->
aggr_limô
 = 6;

176 
	`©h_dbg
(
comm⁄
, 
MCI
,

178 
btc€x
->
duty_cy˛e
);

179 } i‡(
num_¥ofûe
 >= 3) {

180 
mci
->
aggr_limô
 = 4;

181 
	`©h_dbg
(
comm⁄
, 
MCI
,

185 
skù_tunög
:

186 i‡(
	`IS_CHAN_2GHZ
(
sc
->
sc_ah
->
curch™
)) {

187 i‡(
	`IS_CHAN_HT
(
sc
->
sc_ah
->
curch™
))

188 
	`©h_mci_adju°_aggr_limô
(
btc€x
);

190 
btc€x
->
btc€x_≥riod
 >>= 1;

193 
	`©h9k_btc€x_timî_∑u£
(
sc
);

194 
	`©h9k_hw_btc€x_dißbÀ
(
sc
->
sc_ah
);

196 i‡(
	`IS_CHAN_5GHZ
(
sc
->
sc_ah
->
curch™
))

199 
btc€x
->
duty_cy˛e
 +(
mci
->
num_bdr
 ? 
ATH_MCI_BDR_DUTY_CYCLE
 : 0);

200 i‡(
btc€x
->
duty_cy˛e
 > 
ATH_MCI_MAX_DUTY_CYCLE
)

201 
btc€x
->
duty_cy˛e
 = 
ATH_MCI_MAX_DUTY_CYCLE
;

203 
btc€x
->
btc€x_no_°omp
 = btc€x->
btc€x_≥riod
 *

204 (100 - 
btc€x
->
duty_cy˛e
) / 100;

206 
	`©h9k_hw_btc€x_íabÀ
(
sc
->
sc_ah
);

207 
	`©h9k_btc€x_timî_ªsume
(
sc
);

208 
	}
}

210 
	$©h_mci_ˇl_msg
(
©h_so·c
 *
sc
, 
u8
 
›code
, u8 *
rx_∑ylﬂd
)

212 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

213 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

214 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

215 
u32
 
∑ylﬂd
[4] = {0, 0, 0, 0};

217 
›code
) {

218 
MCI_GPM_BT_CAL_REQ
:

219 i‡(
mci_hw
->
bt_°©e
 =
MCI_BT_AWAKE
) {

220 
mci_hw
->
bt_°©e
 = 
MCI_BT_CAL_START
;

221 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_MCI
);

223 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Sèã : %d\n", 
mci_hw
->
bt_°©e
);

225 
MCI_GPM_BT_CAL_GRANT
:

226 
	`MCI_GPM_SET_CAL_TYPE
(
∑ylﬂd
, 
MCI_GPM_WLAN_CAL_DONE
);

227 
	`¨9003_mci_£nd_mesßge
(
sc
->
sc_ah
, 
MCI_GPM
, 0, 
∑ylﬂd
,

228 16, 
Ál£
, 
åue
);

231 
	`©h_dbg
(
comm⁄
, 
MCI
, "Unknown GPM CAL message\n");

234 
	}
}

236 
	$©h9k_mci_w‹k
(
w‹k_°ru˘
 *
w‹k
)

238 
©h_so·c
 *
sc
 = 
	`c⁄èöî_of
(
w‹k
, ©h_so·c, 
mci_w‹k
);

240 
	`©h_mci_upd©e_scheme
(
sc
);

241 
	}
}

243 
	$©h_mci_upd©e_°omp_tx¥io
(
u8
 
cur_tx¥io
, u8 *
°omp_¥io
)

245 i‡(
cur_tx¥io
 < 
°omp_¥io
[
ATH_BTCOEX_STOMP_NONE
])

246 
°omp_¥io
[
ATH_BTCOEX_STOMP_NONE
] = 
cur_tx¥io
;

248 i‡(
cur_tx¥io
 > 
°omp_¥io
[
ATH_BTCOEX_STOMP_ALL
])

249 
°omp_¥io
[
ATH_BTCOEX_STOMP_ALL
] = 
cur_tx¥io
;

251 i‡((
cur_tx¥io
 > 
ATH_MCI_HI_PRIO
) &&

252 (
cur_tx¥io
 < 
°omp_¥io
[
ATH_BTCOEX_STOMP_LOW
]))

253 
°omp_¥io
[
ATH_BTCOEX_STOMP_LOW
] = 
cur_tx¥io
;

254 
	}
}

256 
	$©h_mci_£t_c⁄cur_tx¥io
(
©h_so·c
 *
sc
)

258 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

259 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

260 
u8
 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_MAX
];

262 
	`mem£t
(
°omp_tx¥io
, 0, (stomp_txprio));

263 i‡(
mci
->
num_mgmt
) {

264 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_ALL
] = 
ATH_MCI_INQUIRY_PRIO
;

265 i‡(!
mci
->
num_∑n
 && !mci->
num_Ÿhî_a˛
)

266 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_NONE
] =

267 
ATH_MCI_INQUIRY_PRIO
;

269 
u8
 
¥of_¥io
[] = { 50, 90, 94, 52 };

271 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_LOW
] =

272 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_NONE
] = 0xff;

274 i‡(
mci
->
num_sco
)

275 
	`©h_mci_upd©e_°omp_tx¥io
(
mci
->
voi˚_¥i‹ôy
,

276 
°omp_tx¥io
);

277 i‡(
mci
->
num_Ÿhî_a˛
)

278 
	`©h_mci_upd©e_°omp_tx¥io
(
¥of_¥io
[0], 
°omp_tx¥io
);

279 i‡(
mci
->
num_a2dp
)

280 
	`©h_mci_upd©e_°omp_tx¥io
(
¥of_¥io
[1], 
°omp_tx¥io
);

281 i‡(
mci
->
num_hid
)

282 
	`©h_mci_upd©e_°omp_tx¥io
(
¥of_¥io
[2], 
°omp_tx¥io
);

283 i‡(
mci
->
num_∑n
)

284 
	`©h_mci_upd©e_°omp_tx¥io
(
¥of_¥io
[3], 
°omp_tx¥io
);

286 i‡(
°omp_tx¥io
[
ATH_BTCOEX_STOMP_NONE
] == 0xff)

287 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_NONE
] = 0;

289 i‡(
°omp_tx¥io
[
ATH_BTCOEX_STOMP_LOW
] == 0xff)

290 
°omp_tx¥io
[
ATH_BTCOEX_STOMP_LOW
] = 0;

292 
	`©h9k_hw_btc€x_£t_c⁄cur_tx¥io
(
sc
->
sc_ah
, 
°omp_tx¥io
);

293 
	}
}

295 
u8
 
	$©h_mci_¥o˚ss_¥ofûe
(
©h_so·c
 *
sc
,

296 
©h_mci_¥ofûe_öfo
 *
öfo
)

298 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

299 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

300 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

301 
©h_mci_¥ofûe_öfo
 *
íåy
 = 
NULL
;

303 
íåy
 = 
	`©h_mci_föd_¥ofûe
(
mci
, 
öfo
);

304 i‡(
íåy
) {

313 i‡(
íåy
->
ty≥
 !
öfo
->type) {

314 
	`DEC_PROF
(
mci
, 
íåy
);

315 
	`INC_PROF
(
mci
, 
öfo
);

317 
	`mem˝y
(
íåy
, 
öfo
, 10);

320 i‡(
öfo
->
°¨t
) {

321 i‡(!
íåy
 && !
	`©h_mci_add_¥ofûe
(
comm⁄
, 
mci
, 
öfo
))

324 
	`©h_mci_dñ_¥ofûe
(
comm⁄
, 
mci
, 
íåy
);

326 
	`©h_mci_£t_c⁄cur_tx¥io
(
sc
);

328 
	}
}

330 
u8
 
	$©h_mci_¥o˚ss_°©us
(
©h_so·c
 *
sc
,

331 
©h_mci_¥ofûe_°©us
 *
°©us
)

333 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

334 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

335 
©h_mci_¥ofûe_öfo
 
öfo
;

336 
i
 = 0, 
ﬁd_num_mgmt
 = 
mci
->
num_mgmt
;

339 i‡(
°©us
->
is_lök
)

342 
öfo
.
c⁄n_h™dÀ
 = 
°©us
->conn_handle;

343 i‡(
	`©h_mci_föd_¥ofûe
(
mci
, &
öfo
))

346 i‡(
°©us
->
c⁄n_h™dÀ
 >
ATH_MCI_MAX_PROFILE
)

349 i‡(
°©us
->
is_¸ôiˇl
)

350 
	`__£t_bô
(
°©us
->
c⁄n_h™dÀ
, 
mci
->status);

352 
	`__˛ór_bô
(
°©us
->
c⁄n_h™dÀ
, 
mci
->status);

354 
mci
->
num_mgmt
 = 0;

356 i‡(
	`ã°_bô
(
i
, 
mci
->
°©us
))

357 
mci
->
num_mgmt
++;

358 } ++
i
 < 
ATH_MCI_MAX_PROFILE
);

360 
	`©h_mci_£t_c⁄cur_tx¥io
(
sc
);

361 i‡(
ﬁd_num_mgmt
 !
mci
->
num_mgmt
)

365 
	}
}

367 
	$©h_mci_msg
(
©h_so·c
 *
sc
, 
u8
 
›code
, u8 *
rx_∑ylﬂd
)

369 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

370 
©h_mci_¥ofûe_öfo
 
¥ofûe_öfo
;

371 
©h_mci_¥ofûe_°©us
 
¥ofûe_°©us
;

372 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

373 
u8
 
maj‹
, 
mö‹
, 
upd©e_scheme
 = 0;

374 
u32
 
£q_num
;

376 i‡(
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_NEED_FLUSH_BT_INFO
) &&

377 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_ENABLE
)) {

378 
	`©h_dbg
(
comm⁄
, 
MCI
, "(MCI) NeedÅo flush BTÖrofiles\n");

379 
	`©h_mci_Êush_¥ofûe
(&
sc
->
btc€x
.
mci
);

380 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_SEND_STATUS_QUERY
);

383 
›code
) {

384 
MCI_GPM_COEX_VERSION_QUERY
:

385 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_SEND_WLAN_COEX_VERSION
);

387 
MCI_GPM_COEX_VERSION_RESPONSE
:

388 
maj‹
 = *(
rx_∑ylﬂd
 + 
MCI_GPM_COEX_B_MAJOR_VERSION
);

389 
mö‹
 = *(
rx_∑ylﬂd
 + 
MCI_GPM_COEX_B_MINOR_VERSION
);

390 
	`¨9003_mci_£t_bt_vîsi⁄
(
ah
, 
maj‹
, 
mö‹
);

392 
MCI_GPM_COEX_STATUS_QUERY
:

393 
	`¨9003_mci_£nd_wœn_ch™√ls
(
ah
);

395 
MCI_GPM_COEX_BT_PROFILE_INFO
:

396 
	`mem˝y
(&
¥ofûe_öfo
,

397 (
rx_∑ylﬂd
 + 
MCI_GPM_COEX_B_PROFILE_TYPE
), 10);

399 i‡((
¥ofûe_öfo
.
ty≥
 =
MCI_GPM_COEX_PROFILE_UNKNOWN
) ||

400 (
¥ofûe_öfo
.
ty≥
 >
MCI_GPM_COEX_PROFILE_MAX
)) {

401 
	`©h_dbg
(
comm⁄
, 
MCI
,

403 
¥ofûe_öfo
.
ty≥
,

404 
¥ofûe_öfo
.
°¨t
);

408 
upd©e_scheme
 +
	`©h_mci_¥o˚ss_¥ofûe
(
sc
, &
¥ofûe_öfo
);

410 
MCI_GPM_COEX_BT_STATUS_UPDATE
:

411 
¥ofûe_°©us
.
is_lök
 = *(
rx_∑ylﬂd
 +

412 
MCI_GPM_COEX_B_STATUS_TYPE
);

413 
¥ofûe_°©us
.
c⁄n_h™dÀ
 = *(
rx_∑ylﬂd
 +

414 
MCI_GPM_COEX_B_STATUS_LINKID
);

415 
¥ofûe_°©us
.
is_¸ôiˇl
 = *(
rx_∑ylﬂd
 +

416 
MCI_GPM_COEX_B_STATUS_STATE
);

418 
£q_num
 = *((
u32
 *)(
rx_∑ylﬂd
 + 12));

419 
	`©h_dbg
(
comm⁄
, 
MCI
,

421 
¥ofûe_°©us
.
is_lök
,Örofûe_°©us.
c⁄n_h™dÀ
,

422 
¥ofûe_°©us
.
is_¸ôiˇl
, 
£q_num
);

424 
upd©e_scheme
 +
	`©h_mci_¥o˚ss_°©us
(
sc
, &
¥ofûe_°©us
);

427 
	`©h_dbg
(
comm⁄
, 
MCI
, "Unknow¿GPM COEX mesßgê0x%02x\n", 
›code
);

430 i‡(
upd©e_scheme
)

431 
	`õì80211_queue_w‹k
(
sc
->
hw
, &sc->
mci_w‹k
);

432 
	}
}

434 
	$©h_mci_£tup
(
©h_so·c
 *
sc
)

436 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

437 
©h_mci_c€x
 *
mci
 = &
sc
->
mci_c€x
;

438 
©h_mci_buf
 *
buf
 = &
mci
->
sched_buf
;

439 
ªt
;

441 
buf
->
bf_addr
 = 
	`dmam_Æloc_cohîít
(
sc
->
dev
,

442 
ATH_MCI_SCHED_BUF_SIZE
 + 
ATH_MCI_GPM_BUF_SIZE
,

443 &
buf
->
bf_∑ddr
, 
GFP_KERNEL
);

445 i‡(
buf
->
bf_addr
 =
NULL
) {

446 
	`©h_dbg
(
comm⁄
, 
FATAL
, "MCI bufferálloc failed\n");

447  -
ENOMEM
;

450 
	`mem£t
(
buf
->
bf_addr
, 
MCI_GPM_RSVD_PATTERN
,

451 
ATH_MCI_SCHED_BUF_SIZE
 + 
ATH_MCI_GPM_BUF_SIZE
);

453 
mci
->
sched_buf
.
bf_Àn
 = 
ATH_MCI_SCHED_BUF_SIZE
;

455 
mci
->
gpm_buf
.
bf_Àn
 = 
ATH_MCI_GPM_BUF_SIZE
;

456 
mci
->
gpm_buf
.
bf_addr
 = (
u8
 *)mci->
sched_buf
.bf_add∏+ mci->sched_buf.
bf_Àn
;

457 
mci
->
gpm_buf
.
bf_∑ddr
 = mci->
sched_buf
.bf_∑dd∏+ mci->sched_buf.
bf_Àn
;

459 
ªt
 = 
	`¨9003_mci_£tup
(
sc
->
sc_ah
, 
mci
->
gpm_buf
.
bf_∑ddr
,

460 
mci
->
gpm_buf
.
bf_addr
, (mci->gpm_buf.
bf_Àn
 >> 4),

461 
mci
->
sched_buf
.
bf_∑ddr
);

462 i‡(
ªt
) {

463 
	`©h_îr
(
comm⁄
, "FailedÅo initialize MCI\n");

464  
ªt
;

467 
	`INIT_WORK
(&
sc
->
mci_w‹k
, 
©h9k_mci_w‹k
);

468 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI Initialized\n");

471 
	}
}

473 
	$©h_mci_˛ónup
(
©h_so·c
 *
sc
)

475 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

476 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

478 
	`¨9003_mci_˛ónup
(
ah
);

480 
	`©h_dbg
(
comm⁄
, 
MCI
, "MCI De-Initialized\n");

481 
	}
}

483 
	$©h_mci_öå
(
©h_so·c
 *
sc
)

485 
©h_mci_c€x
 *
mci
 = &
sc
->
mci_c€x
;

486 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

487 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

488 
©h9k_hw_mci
 *
mci_hw
 = &
ah
->
btc€x_hw
.
mci
;

489 
u32
 
mci_öt
, 
mci_öt_rxmsg
;

490 
u32
 
off£t
, 
subty≥
, 
›code
;

491 
u32
 *
pgpm
;

492 
u32
 
m‹e_d©a
 = 
MCI_GPM_MORE
;

493 
boﬁ
 
skù_gpm
 = 
Ál£
;

495 
	`¨9003_mci_gë_öãºu±
(
sc
->
sc_ah
, &
mci_öt
, &
mci_öt_rxmsg
);

497 i‡(
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_ENABLE
) == 0) {

498 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_INIT_GPM_OFFSET
);

502 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
) {

503 
u32
 
∑ylﬂd
[4] = { 0xffffffff, 0xffffffff,

511 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_REMOTE_RESET
, 0,

512 
∑ylﬂd
, 16, 
åue
, 
Ál£
);

513 
	`¨9003_mci_£nd_mesßge
(
ah
, 
MCI_SYS_WAKING
, 0,

514 
NULL
, 0, 
åue
, 
Ál£
);

516 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
;

517 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_RESET_REQ_WAKE
);

522 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_SET_BT_AWAKE
);

525 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
) {

526 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
;

528 i‡((
mci_hw
->
bt_°©e
 =
MCI_BT_SLEEP
) &&

529 (
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_REMOTE_SLEEP
) !=

530 
MCI_BT_SLEEP
))

531 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_SET_BT_AWAKE
);

534 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
) {

535 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
;

537 i‡((
mci_hw
->
bt_°©e
 =
MCI_BT_AWAKE
) &&

538 (
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_REMOTE_SLEEP
) !=

539 
MCI_BT_AWAKE
))

540 
mci_hw
->
bt_°©e
 = 
MCI_BT_SLEEP
;

543 i‡((
mci_öt
 & 
AR_MCI_INTERRUPT_RX_INVALID_HDR
) ||

544 (
mci_öt
 & 
AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT
)) {

545 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_RECOVER_RX
);

546 
skù_gpm
 = 
åue
;

549 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_SCHD_INFO
) {

550 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_SCHD_INFO
;

551 
off£t
 = 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_LAST_SCHD_MSG_OFFSET
);

554 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_GPM
) {

555 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_GPM
;

557 
m‹e_d©a
 =
MCI_GPM_MORE
) {

558 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
))

561 
pgpm
 = 
mci
->
gpm_buf
.
bf_addr
;

562 
off£t
 = 
	`¨9003_mci_gë_√xt_gpm_off£t
(
ah
, &
m‹e_d©a
);

564 i‡(
off£t
 =
MCI_GPM_INVALID
)

567 
pgpm
 +(
off£t
 >> 2);

573 
subty≥
 = 
	`MCI_GPM_TYPE
(
pgpm
);

574 
›code
 = 
	`MCI_GPM_OPCODE
(
pgpm
);

576 i‡(
skù_gpm
)

577 
ªcy˛e
;

579 i‡(
	`MCI_GPM_IS_CAL_TYPE
(
subty≥
)) {

580 
	`©h_mci_ˇl_msg
(
sc
, 
subty≥
, (
u8
 *)
pgpm
);

582 
subty≥
) {

583 
MCI_GPM_COEX_AGENT
:

584 
	`©h_mci_msg
(
sc
, 
›code
, (
u8
 *)
pgpm
);

590 
ªcy˛e
:

591 
	`MCI_GPM_RECYCLE
(
pgpm
);

595 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_HW_MSG_MASK
) {

596 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_LNA_CONTROL
)

597 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_LNA_CONTROL
;

599 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_LNA_INFO
)

600 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_LNA_INFO
;

602 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_CONT_INFO
) {

603 
vÆue_dbm
 = 
	`MS
(
mci_hw
->
c⁄t_°©us
,

604 
AR_MCI_CONT_RSSI_POWER
);

606 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_CONT_INFO
;

608 
	`©h_dbg
(
comm⁄
, 
MCI
,

610 
	`MS
(
mci_hw
->
c⁄t_°©us
, 
AR_MCI_CONT_TXRX
) ?

612 
	`MS
(
mci_hw
->
c⁄t_°©us
, 
AR_MCI_CONT_PRIORITY
),

613 
vÆue_dbm
);

616 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_CONT_NACK
)

617 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_CONT_NACK
;

619 i‡(
mci_öt_rxmsg
 & 
AR_MCI_INTERRUPT_RX_MSG_CONT_RST
)

620 
mci_öt_rxmsg
 &~
AR_MCI_INTERRUPT_RX_MSG_CONT_RST
;

623 i‡((
mci_öt
 & 
AR_MCI_INTERRUPT_RX_INVALID_HDR
) ||

624 (
mci_öt
 & 
AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT
)) {

625 
mci_öt
 &~(
AR_MCI_INTERRUPT_RX_INVALID_HDR
 |

626 
AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT
);

627 
	`©h_mci_msg
(
sc
, 
MCI_GPM_COEX_NOOP
, 
NULL
);

629 
	}
}

631 
	$©h_mci_íabÀ
(
©h_so·c
 *
sc
)

633 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

635 i‡(!
comm⁄
->
btc€x_íabÀd
)

638 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_MCI
)

639 
sc
->
sc_ah
->
imask
 |
ATH9K_INT_MCI
;

640 
	}
}

642 
	$©h9k_mci_upd©e_wœn_ch™√ls
(
©h_so·c
 *
sc
, 
boﬁ
 
Ælow_Æl
)

644 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

645 
©h9k_hw_mci
 *
mci
 = &
ah
->
btc€x_hw
.mci;

646 
©h9k_ch™√l
 *
ch™
 = 
ah
->
curch™
;

647 
u32
 
ch™√lm≠
[] = {0x00000000, 0xffff0000, 0xffffffff, 0x7fffffff};

648 
i
;

649 
s16
 
ch™_°¨t
, 
ch™_íd
;

650 
u16
 
wœn_ch™
;

652 i‡(!
ch™
 || !
	`IS_CHAN_2GHZ
(chan))

655 i‡(
Ælow_Æl
)

656 
£nd_wœn_ch™
;

658 
wœn_ch™
 = 
ch™
->
ch™√l
 - 2402;

660 
ch™_°¨t
 = 
wœn_ch™
 - 10;

661 
ch™_íd
 = 
wœn_ch™
 + 10;

663 i‡(
	`IS_CHAN_HT40PLUS
(
ch™
))

664 
ch™_íd
 += 20;

665 i‡(
	`IS_CHAN_HT40MINUS
(
ch™
))

666 
ch™_°¨t
 -= 20;

669 
ch™_°¨t
 -= 7;

670 
ch™_íd
 += 7;

672 i‡(
ch™_°¨t
 <= 0)

673 
ch™_°¨t
 = 0;

674 i‡(
ch™_íd
 >
ATH_MCI_NUM_BT_CHANNELS
)

675 
ch™_íd
 = 
ATH_MCI_NUM_BT_CHANNELS
 - 1;

677 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
ah
), 
MCI
,

679 
wœn_ch™
, 
ch™_°¨t
, 
ch™_íd
);

681 
i
 = 
ch™_°¨t
; i < 
ch™_íd
; i++)

682 
	`MCI_GPM_CLR_CHANNEL_BIT
(&
ch™√lm≠
, 
i
);

684 
£nd_wœn_ch™
:

686 
i
 = 0; i < 4; i++)

687 
mci
->
wœn_ch™√ls
[
i
] = 
ch™√lm≠
[i];

688 
	`¨9003_mci_£nd_wœn_ch™√ls
(
ah
);

689 
	`¨9003_mci_°©e
(
ah
, 
MCI_STATE_SEND_VERSION_QUERY
);

690 
	}
}

692 
	$©h9k_mci_£t_txpowî
(
©h_so·c
 *
sc
, 
boﬁ
 
£tch™√l
,

693 
boﬁ
 
c⁄cur_tx
)

695 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

696 
©h9k_hw_mci
 *
mci_hw
 = &
sc
->
sc_ah
->
btc€x_hw
.
mci
;

697 
boﬁ
 
ﬁd_c⁄cur_tx
 = 
mci_hw
->
c⁄cur_tx
;

699 i‡(!(
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_CONCUR_TX
)) {

700 
mci_hw
->
c⁄cur_tx
 = 
Ál£
;

704 i‡(!
	`IS_CHAN_2GHZ
(
ah
->
curch™
))

707 i‡(
£tch™√l
) {

708 
©h9k_hw_ˇl_d©a
 *
ˇld©a
 = &
sc
->
cur_ch™
->caldata;

709 i‡(
	`IS_CHAN_HT40PLUS
(
ah
->
curch™
) &&

710 (
ah
->
curch™
->
ch™√l
 > 
ˇld©a
->channel) &&

711 (
ah
->
curch™
->
ch™√l
 <
ˇld©a
->channel + 20))

713 i‡(
	`IS_CHAN_HT40MINUS
(
ah
->
curch™
) &&

714 (
ah
->
curch™
->
ch™√l
 < 
ˇld©a
->channel) &&

715 (
ah
->
curch™
->
ch™√l
 >
ˇld©a
->channel - 20))

717 
mci_hw
->
c⁄cur_tx
 = 
Ál£
;

719 
mci_hw
->
c⁄cur_tx
 = concur_tx;

721 i‡(
ﬁd_c⁄cur_tx
 !
mci_hw
->
c⁄cur_tx
)

722 
	`©h9k_hw_£t_txpowîlimô
(
ah
, 
sc
->
cur_ch™
->
txpowî
, 
Ál£
);

723 
	}
}

725 
	$©h9k_mci_°omp_audio
(
©h_so·c
 *
sc
)

727 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

728 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

729 
©h_mci_¥ofûe
 *
mci
 = &
btc€x
->mci;

731 i‡(!
mci
->
num_sco
 && !mci->
num_a2dp
)

734 i‡(
ah
->
°©s
.
avgbrssi
 > 25) {

735 
btc€x
->
°omp_audio
 = 0;

739 
btc€x
->
°omp_audio
++;

740 
	}
}

741 
	$©h9k_mci_upd©e_rssi
(
©h_so·c
 *
sc
)

743 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

744 
©h_btc€x
 *
btc€x
 = &
sc
->btcoex;

745 
©h9k_hw_mci
 *
mci_hw
 = &
sc
->
sc_ah
->
btc€x_hw
.
mci
;

747 
	`©h9k_mci_°omp_audio
(
sc
);

749 i‡(!(
mci_hw
->
c⁄fig
 & 
ATH_MCI_CONFIG_CONCUR_TX
))

752 i‡(
ah
->
°©s
.
avgbrssi
 >= 40) {

753 i‡(
btc€x
->
rssi_cou¡
 < 0)

754 
btc€x
->
rssi_cou¡
 = 0;

755 i‡(++
btc€x
->
rssi_cou¡
 >
ATH_MCI_CONCUR_TX_SWITCH
) {

756 
btc€x
->
rssi_cou¡
 = 0;

757 
	`©h9k_mci_£t_txpowî
(
sc
, 
Ál£
, 
åue
);

760 i‡(
btc€x
->
rssi_cou¡
 > 0)

761 
btc€x
->
rssi_cou¡
 = 0;

762 i‡(--
btc€x
->
rssi_cou¡
 <-
ATH_MCI_CONCUR_TX_SWITCH
) {

763 
btc€x
->
rssi_cou¡
 = 0;

764 
	`©h9k_mci_£t_txpowî
(
sc
, 
Ál£
, false);

767 
	}
}

	@mci.h

17 #i‚de‡
MCI_H


18 
	#MCI_H


	)

20 
	~"¨9003_mci.h
"

22 
	#ATH_MCI_SCHED_BUF_SIZE
 (16 * 16Ë

	)

23 
	#ATH_MCI_GPM_MAX_ENTRY
 16

	)

24 
	#ATH_MCI_GPM_BUF_SIZE
 (
ATH_MCI_GPM_MAX_ENTRY
 * 16)

	)

25 
	#ATH_MCI_DEF_BT_PERIOD
 40

	)

26 
	#ATH_MCI_BDR_DUTY_CYCLE
 20

	)

27 
	#ATH_MCI_MAX_DUTY_CYCLE
 90

	)

29 
	#ATH_MCI_DEF_AGGR_LIMIT
 6

	)

30 
	#ATH_MCI_MAX_ACL_PROFILE
 7

	)

31 
	#ATH_MCI_MAX_SCO_PROFILE
 1

	)

32 
	#ATH_MCI_MAX_PROFILE
 (
ATH_MCI_MAX_ACL_PROFILE
 +\

33 
ATH_MCI_MAX_SCO_PROFILE
)

	)

35 
	#ATH_MCI_INQUIRY_PRIO
 62

	)

36 
	#ATH_MCI_HI_PRIO
 60

	)

37 
	#ATH_MCI_NUM_BT_CHANNELS
 79

	)

38 
	#ATH_MCI_CONCUR_TX_SWITCH
 5

	)

40 
	#MCI_GPM_SET_CHANNEL_BIT
(
_p_gpm
, 
_bt_ch™
) \

42 i‡(
_bt_ch™
 < 
ATH_MCI_NUM_BT_CHANNELS
) { \

43 *(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_CHANNEL_MAP
 + \

44 (
_bt_ch™
 / 8)) |= (1 << (_bt_chan & 7)); \

46 } 0)

	)

48 
	#MCI_GPM_CLR_CHANNEL_BIT
(
_p_gpm
, 
_bt_ch™
) \

50 i‡(
_bt_ch™
 < 
ATH_MCI_NUM_BT_CHANNELS
) { \

51 *(((
u8
 *)(
_p_gpm
)Ë+ 
MCI_GPM_COEX_B_CHANNEL_MAP
 + \

52 (
_bt_ch™
 / 8)) &= ~(1 << (_bt_chan & 7));\

54 } 0)

	)

56 
	#INC_PROF
(
_mci
, 
_öfo
) do { \

57 
_öfo
->
ty≥
) { \

58 
MCI_GPM_COEX_PROFILE_RFCOMM
:\

59 
_mci
->
num_Ÿhî_a˛
++; \

61 
MCI_GPM_COEX_PROFILE_A2DP
: \

62 
_mci
->
num_a2dp
++; \

63 i‡(!
_öfo
->
edr
) \

64 
_mci
->
num_bdr
++; \

66 
MCI_GPM_COEX_PROFILE_HID
: \

67 
_mci
->
num_hid
++; \

69 
MCI_GPM_COEX_PROFILE_BNEP
: \

70 
_mci
->
num_∑n
++; \

72 
MCI_GPM_COEX_PROFILE_VOICE
: \

73 
MCI_GPM_COEX_PROFILE_A2DPVO
:\

74 
_mci
->
num_sco
++; \

79 } 0)

	)

81 
	#DEC_PROF
(
_mci
, 
_öfo
) do { \

82 
_öfo
->
ty≥
) { \

83 
MCI_GPM_COEX_PROFILE_RFCOMM
:\

84 
_mci
->
num_Ÿhî_a˛
--; \

86 
MCI_GPM_COEX_PROFILE_A2DP
: \

87 
_mci
->
num_a2dp
--; \

88 i‡(!
_öfo
->
edr
) \

89 
_mci
->
num_bdr
--; \

91 
MCI_GPM_COEX_PROFILE_HID
: \

92 
_mci
->
num_hid
--; \

94 
MCI_GPM_COEX_PROFILE_BNEP
: \

95 
_mci
->
num_∑n
--; \

97 
MCI_GPM_COEX_PROFILE_VOICE
: \

98 
MCI_GPM_COEX_PROFILE_A2DPVO
:\

99 
_mci
->
num_sco
--; \

104 } 0)

	)

106 
	#NUM_PROF
(
_mci
Ë(_mci->
num_Ÿhî_a˛
 + _mci->
num_a2dp
 + \

107 
_mci
->
num_hid
 + _mci->
num_∑n
 + _mci->
num_sco
)

	)

109 
	s©h_mci_¥ofûe_öfo
 {

110 
u8
 
	mty≥
;

111 
u8
 
	mc⁄n_h™dÀ
;

112 
boﬁ
 
	m°¨t
;

113 
boﬁ
 
	mma°î
;

114 
boﬁ
 
	medr
;

115 
u8
 
	mvoi˚_ty≥
;

116 
u16
 
	mT
;

117 
u8
 
	mW
;

118 
u8
 
	mA
;

119 
li°_hód
 
	mli°
;

122 
	s©h_mci_¥ofûe_°©us
 {

123 
boﬁ
 
	mis_¸ôiˇl
;

124 
boﬁ
 
	mis_lök
;

125 
u8
 
	mc⁄n_h™dÀ
;

128 
	s©h_mci_¥ofûe
 {

129 
li°_hód
 
	möfo
;

130 
DECLARE_BITMAP
(
°©us
, 
ATH_MCI_MAX_PROFILE
);

131 
u16
 
	maggr_limô
;

132 
u8
 
	mnum_mgmt
;

133 
u8
 
	mnum_sco
;

134 
u8
 
	mnum_a2dp
;

135 
u8
 
	mnum_hid
;

136 
u8
 
	mnum_∑n
;

137 
u8
 
	mnum_Ÿhî_a˛
;

138 
u8
 
	mnum_bdr
;

139 
u8
 
	mvoi˚_¥i‹ôy
;

142 
	s©h_mci_buf
 {

143 *
	mbf_addr
;

144 
dma_addr_t
 
	mbf_∑ddr
;

145 
u32
 
	mbf_Àn
;

148 
	s©h_mci_c€x
 {

149 
©h_mci_buf
 
	msched_buf
;

150 
©h_mci_buf
 
	mgpm_buf
;

153 
©h_mci_Êush_¥ofûe
(
©h_mci_¥ofûe
 *
mci
);

154 
©h_mci_£tup
(
©h_so·c
 *
sc
);

155 
©h_mci_˛ónup
(
©h_so·c
 *
sc
);

156 
©h_mci_öå
(
©h_so·c
 *
sc
);

157 
©h9k_mci_upd©e_rssi
(
©h_so·c
 *
sc
);

159 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


160 
©h_mci_íabÀ
(
©h_so·c
 *
sc
);

161 
©h9k_mci_upd©e_wœn_ch™√ls
(
©h_so·c
 *
sc
, 
boﬁ
 
Ælow_Æl
);

162 
©h9k_mci_£t_txpowî
(
©h_so·c
 *
sc
, 
boﬁ
 
£tch™√l
,

163 
boﬁ
 
c⁄cur_tx
);

165 
ölöe
 
	$©h_mci_íabÀ
(
©h_so·c
 *
sc
)

167 
	}
}

168 
ölöe
 
	$©h9k_mci_upd©e_wœn_ch™√ls
(
©h_so·c
 *
sc
,

169 
boﬁ
 
Ælow_Æl
)

171 
	}
}

172 
ölöe
 
	$©h9k_mci_£t_txpowî
(
©h_so·c
 *
sc
, 
boﬁ
 
£tch™√l
,

173 
boﬁ
 
c⁄cur_tx
)

175 
	}
}

	@pci.c

17 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

19 
	~<löux/∆80211.h
>

20 
	~<löux/pci.h
>

21 
	~<löux/pci-a•m.h
>

22 
	~<löux/©h9k_∂©f‹m.h
>

23 
	~<löux/moduÀ.h
>

24 
	~"©h9k.h
"

26 c⁄° 
pci_devi˚_id
 
	g©h_pci_id_èbÀ
[] = {

27 { 
PCI_VDEVICE
(
ATHEROS
, 0x0023) },

28 { 
PCI_VDEVICE
(
ATHEROS
, 0x0024) },

29 { 
PCI_VDEVICE
(
ATHEROS
, 0x0027) },

30 { 
PCI_VDEVICE
(
ATHEROS
, 0x0029) },

31 { 
PCI_VDEVICE
(
ATHEROS
, 0x002A) },

33 #ifde‡
CPTCFG_ATH9K_PCOEM


34 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

36 
PCI_VENDOR_ID_AZWAVE
,

38 .
drivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

39 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

41 
PCI_VENDOR_ID_FOXCONN
,

43 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

44 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

48 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

49 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

53 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

54 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

56 
PCI_VENDOR_ID_QMI
,

58 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

59 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

63 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

64 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

68 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

69 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

73 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

74 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

78 .
	gdrivî_d©a
 = 
ATH9K_PCI_D3_L1_WAR
 },

81 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

83 
PCI_VENDOR_ID_AZWAVE
,

85 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

88 { 
PCI_VDEVICE
(
ATHEROS
, 0x002B) },

89 { 
PCI_VDEVICE
(
ATHEROS
, 0x002C) },

90 { 
PCI_VDEVICE
(
ATHEROS
, 0x002D) },

91 { 
PCI_VDEVICE
(
ATHEROS
, 0x002E) },

94 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

98 .
	gdrivî_d©a
 = 
ATH9K_PCI_KILLER
 },

99 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

103 .
	gdrivî_d©a
 = 
ATH9K_PCI_KILLER
 },

105 { 
PCI_VDEVICE
(
ATHEROS
, 0x0030) },

107 #ifde‡
CPTCFG_ATH9K_PCOEM


109 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

111 
PCI_VENDOR_ID_AZWAVE
,

113 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS198
 | 
ATH9K_PCI_BT_ANT_DIV
 },

114 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

116 
PCI_VENDOR_ID_AZWAVE
,

118 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS198
 | 
ATH9K_PCI_BT_ANT_DIV
 },

119 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

121 
PCI_VENDOR_ID_AZWAVE
,

123 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS198
 | 
ATH9K_PCI_BT_ANT_DIV
 },

124 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

126 
PCI_VENDOR_ID_AZWAVE
,

128 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS198
 | 
ATH9K_PCI_BT_ANT_DIV
 },

131 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

133 
PCI_VENDOR_ID_AZWAVE
,

135 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS230
 | 
ATH9K_PCI_BT_ANT_DIV
 },

136 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

138 
PCI_VENDOR_ID_FOXCONN
,

140 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS230
 | 
ATH9K_PCI_BT_ANT_DIV
 },

143 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

145 
PCI_VENDOR_ID_ATHEROS
,

147 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

148 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

150 
PCI_VENDOR_ID_ATHEROS
,

152 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

153 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

157 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

158 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

162 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

163 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

165 
PCI_VENDOR_ID_SAMSUNG
,

167 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

168 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

170 
PCI_VENDOR_ID_SAMSUNG
,

172 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

173 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

175 
PCI_VENDOR_ID_SAMSUNG
,

177 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

178 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

180 
PCI_VENDOR_ID_SAMSUNG
,

182 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

183 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

185 
PCI_VENDOR_ID_SAMSUNG
,

187 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

188 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

190 
PCI_VENDOR_ID_SAMSUNG
,

192 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

193 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

195 
PCI_VENDOR_ID_SAMSUNG
,

197 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

198 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

200 
PCI_VENDOR_ID_SAMSUNG
,

202 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

203 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

205 
PCI_VENDOR_ID_LENOVO
,

207 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

208 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

210 
PCI_VENDOR_ID_LENOVO
,

212 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

215 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

217 
PCI_VENDOR_ID_AZWAVE
,

219 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

220 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

222 
PCI_VENDOR_ID_AZWAVE
,

224 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

225 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

229 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

230 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

234 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

235 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

239 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

240 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

242 
PCI_VENDOR_ID_FOXCONN
,

244 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

245 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

247 
PCI_VENDOR_ID_FOXCONN
,

249 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

250 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

254 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

255 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

259 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

260 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

264 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

265 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

267 
PCI_VENDOR_ID_AZWAVE
,

269 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

270 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

272 
PCI_VENDOR_ID_AZWAVE
,

274 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

275 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

277 
PCI_VENDOR_ID_AZWAVE
,

279 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

280 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

282 
PCI_VENDOR_ID_AZWAVE
,

284 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

285 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

289 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

290 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

294 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

295 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

297 
PCI_VENDOR_ID_ASUSTEK
,

299 .
	gdrivî_d©a
 = 
ATH9K_PCI_NO_PLL_PWRSAVE
 },

302 { 
PCI_VDEVICE
(
ATHEROS
, 0x0032) },

303 { 
PCI_VDEVICE
(
ATHEROS
, 0x0033) },

305 #ifde‡
CPTCFG_ATH9K_PCOEM


307 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

309 
PCI_VENDOR_ID_AZWAVE
,

311 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS217
 },

312 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

316 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS217
 },

319 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

321 
PCI_VENDOR_ID_ATHEROS
,

323 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

324 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

326 
PCI_VENDOR_ID_LENOVO
,

328 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

329 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

331 
PCI_VENDOR_ID_ATTANSIC
,

333 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

334 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

336 
PCI_VENDOR_ID_AZWAVE
,

338 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

339 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

341 
PCI_VENDOR_ID_ASUSTEK
,

343 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

344 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

348 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

349 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

353 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

354 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

356 
PCI_VENDOR_ID_HP
,

358 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

359 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

363 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

364 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

368 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

369 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

373 .
	gdrivî_d©a
 = 
ATH9K_PCI_WOW
 },

376 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

380 .
	gdrivî_d©a
 = 
ATH9K_PCI_KILLER
 },

382 { 
PCI_VDEVICE
(
ATHEROS
, 0x0034) },

383 { 
PCI_VDEVICE
(
ATHEROS
, 0x0037) },

386 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

388 
PCI_VENDOR_ID_ATHEROS
,

390 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS252
 |

391 
ATH9K_PCI_AR9565_2ANT
 |

392 
ATH9K_PCI_BT_ANT_DIV
 },

393 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

395 
PCI_VENDOR_ID_AZWAVE
,

397 .
	gdrivî_d©a
 = 
ATH9K_PCI_CUS252
 |

398 
ATH9K_PCI_AR9565_2ANT
 |

399 
ATH9K_PCI_BT_ANT_DIV
 },

402 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

404 
PCI_VENDOR_ID_FOXCONN
,

406 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

407 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

411 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

412 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

416 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

417 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

421 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

422 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

426 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

427 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

431 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

432 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

436 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

437 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

441 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

442 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

446 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

447 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

451 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

452 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

456 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

457 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

459 
PCI_VENDOR_ID_AZWAVE
,

461 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

462 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

464 
PCI_VENDOR_ID_AZWAVE
,

466 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 },

469 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

471 
PCI_VENDOR_ID_ATHEROS
,

473 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

474 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

476 
PCI_VENDOR_ID_ATHEROS
,

478 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

479 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

481 
PCI_VENDOR_ID_ATHEROS
,

483 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

484 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

486 
PCI_VENDOR_ID_FOXCONN
,

488 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

489 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

493 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

494 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

498 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

499 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

503 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

504 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

508 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

509 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

513 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

514 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

518 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

519 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

521 
PCI_VENDOR_ID_AZWAVE
,

523 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

524 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

526 
PCI_VENDOR_ID_AZWAVE
,

528 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

529 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

531 
PCI_VENDOR_ID_HP
,

533 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

534 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

536 
PCI_VENDOR_ID_HP
,

538 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

539 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

541 
PCI_VENDOR_ID_HP
,

543 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

544 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

546 
PCI_VENDOR_ID_DELL
,

548 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_1ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

551 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

553 
PCI_VENDOR_ID_SAMSUNG
,

555 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

556 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

558 
PCI_VENDOR_ID_SAMSUNG
,

560 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

561 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

563 
PCI_VENDOR_ID_SAMSUNG
,

565 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

566 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

568 
PCI_VENDOR_ID_SAMSUNG
,

570 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

571 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

573 
PCI_VENDOR_ID_SAMSUNG
,

575 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

576 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

578 
PCI_VENDOR_ID_SAMSUNG
,

580 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

581 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

583 
PCI_VENDOR_ID_SAMSUNG
,

585 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

586 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

588 
PCI_VENDOR_ID_ATHEROS
,

590 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

591 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

593 
PCI_VENDOR_ID_ATHEROS
,

595 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

596 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

600 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

601 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

605 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

606 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

610 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

611 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

615 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

616 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

620 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

621 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

625 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

626 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

630 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

631 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

635 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

636 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

638 
PCI_VENDOR_ID_AZWAVE
,

640 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

641 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

643 
PCI_VENDOR_ID_AZWAVE
,

645 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

646 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

648 
PCI_VENDOR_ID_AZWAVE
,

650 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

651 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

653 
PCI_VENDOR_ID_AZWAVE
,

655 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

656 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

658 
PCI_VENDOR_ID_AZWAVE
,

660 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

661 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

663 
PCI_VENDOR_ID_AZWAVE
,

665 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

666 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

670 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

671 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

675 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

676 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

680 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

681 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

685 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

686 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

690 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

691 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

695 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

696 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

700 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

701 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

703 
PCI_VENDOR_ID_FOXCONN
,

705 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

706 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

708 
PCI_VENDOR_ID_FOXCONN
,

710 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

711 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

713 
PCI_VENDOR_ID_FOXCONN
,

715 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

716 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

718 
PCI_VENDOR_ID_FOXCONN
,

720 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

721 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

723 
PCI_VENDOR_ID_FOXCONN
,

725 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

726 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

728 
PCI_VENDOR_ID_LENOVO
,

730 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

731 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

733 
PCI_VENDOR_ID_LENOVO
,

735 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

736 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

738 
PCI_VENDOR_ID_ASUSTEK
,

740 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 | 
ATH9K_PCI_BT_ANT_DIV
 },

741 { 
PCI_DEVICE_SUB
(
PCI_VENDOR_ID_ATHEROS
,

743 
PCI_VENDOR_ID_DELL
,

745 .
	gdrivî_d©a
 = 
ATH9K_PCI_AR9565_2ANT
 |

746 
ATH9K_PCI_BT_ANT_DIV
 |

747 
ATH9K_PCI_LED_ACT_HI
},

750 { 
PCI_VDEVICE
(
ATHEROS
, 0x0036),

751 .
	gdrivî_d©a
 = 
ATH9K_PCI_BT_ANT_DIV
 },

754 { 
PCI_VDEVICE
(
ATHEROS
, 0xabcd) },

760 
	$©h_pci_ªad_ˇchesize
(
©h_comm⁄
 *
comm⁄
, *
csz
)

762 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

763 
u8
 
u8tmp
;

765 
	`pci_ªad_c⁄fig_byã
(
	`to_pci_dev
(
sc
->
dev
), 
PCI_CACHE_LINE_SIZE
, &
u8tmp
);

766 *
csz
 = ()
u8tmp
;

774 i‡(*
csz
 == 0)

775 *
csz
 = 
DEFAULT_CACHELINE
 >> 2;

776 
	}
}

778 
boﬁ
 
	$©h_pci_ì¥om_ªad
(
©h_comm⁄
 *
comm⁄
, 
u32
 
off
, 
u16
 *
d©a
)

780 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

781 
©h9k_∂©f‹m_d©a
 *
pd©a
 = 
sc
->
dev
->
∂©f‹m_d©a
;

783 i‡(
pd©a
 && !pd©a->
u£_ì¥om
) {

784 i‡(
off
 >(
	`ARRAY_SIZE
(
pd©a
->
ì¥om_d©a
))) {

785 
	`©h_îr
(
comm⁄
,

787 
__func__
, 
off
);

790 *
d©a
 = 
pd©a
->
ì¥om_d©a
[
off
];

792 
©h_hw
 *
ah
 = (©h_hw *Ë
comm⁄
->ah;

794 
comm⁄
->
›s
->
	`ªad
(
ah
, 
AR5416_EEPROM_OFFSET
 +

795 (
off
 << 
AR5416_EEPROM_S
));

797 i‡(!
	`©h9k_hw_waô
(
ah
,

798 
AR_EEPROM_STATUS_DATA
,

799 
AR_EEPROM_STATUS_DATA_BUSY
 |

800 
AR_EEPROM_STATUS_DATA_PROT_ACCESS
, 0,

801 
AH_WAIT_TIMEOUT
)) {

802  
Ál£
;

805 *
d©a
 = 
	`MS
(
comm⁄
->
›s
->
	`ªad
(
ah
, 
AR_EEPROM_STATUS_DATA
),

806 
AR_EEPROM_STATUS_DATA_VAL
);

809  
åue
;

810 
	}
}

813 
	$©h_pci_a•m_öô
(
©h_comm⁄
 *
comm⁄
)

815 
©h_so·c
 *
sc
 = (©h_so·¯*Ë
comm⁄
->
¥iv
;

816 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

817 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
sc
->
dev
);

818 
pci_dev
 *
∑ª¡
;

819 
u16
 
a•m
;

821 i‡(!
ah
->
is_pcõx¥ess
)

824 
∑ª¡
 = 
pdev
->
bus
->
£lf
;

825 i‡(!
∑ª¡
)

828 i‡((
	`©h9k_hw_gë_btc€x_scheme
(
ah
Ë!
ATH_BTCOEX_CFG_NONE
) &&

829 (
	`AR_SREV_9285
(
ah
))) {

831 
	`pcõ_ˇ∑bûôy_˛ór_w‹d
(
pdev
, 
PCI_EXP_LNKCTL
,

832 
PCI_EXP_LNKCTL_ASPM_L0S
 | 
PCI_EXP_LNKCTL_ASPM_L1
);

838 
	`pcõ_ˇ∑bûôy_˛ór_w‹d
(
∑ª¡
, 
PCI_EXP_LNKCTL
,

839 
PCI_EXP_LNKCTL_ASPM_L0S
 | 
PCI_EXP_LNKCTL_ASPM_L1
);

841 
	`©h_öfo
(
comm⁄
, "Disabling ASPM since BTCOEX isÉnabled\n");

858 i‡(
	`AR_SREV_9462
(
ah
))

859 
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 0x70c, &
ah
->
c⁄fig
.
a•m_l1_fix
);

861 
	`pcõ_ˇ∑bûôy_ªad_w‹d
(
∑ª¡
, 
PCI_EXP_LNKCTL
, &
a•m
);

862 i‡(
a•m
 & (
PCI_EXP_LNKCTL_ASPM_L0S
 | 
PCI_EXP_LNKCTL_ASPM_L1
)) {

863 
ah
->
a•m_íabÀd
 = 
åue
;

865 
	`©h9k_hw_c⁄figpcùowîßve
(
ah
, 
Ál£
);

866 
	`©h_öfo
(
comm⁄
, "ASPMÉ«bÀd: 0x%x\n", 
a•m
);

868 
	}
}

870 c⁄° 
©h_bus_›s
 
	g©h_pci_bus_›s
 = {

871 .
©h_bus_ty≥
 = 
ATH_PCI
,

872 .
	gªad_ˇchesize
 = 
©h_pci_ªad_ˇchesize
,

873 .
	gì¥om_ªad
 = 
©h_pci_ì¥om_ªad
,

874 .
	ga•m_öô
 = 
©h_pci_a•m_öô
,

877 
	$©h_pci_¥obe
(
pci_dev
 *
pdev
, c⁄° 
pci_devi˚_id
 *
id
)

879 
©h_so·c
 *
sc
;

880 
õì80211_hw
 *
hw
;

881 
u8
 
csz
;

882 
u32
 
vÆ
;

883 
ªt
 = 0;

884 
hw_«me
[64];

886 i‡(
	`pcim_íabÀ_devi˚
(
pdev
))

887  -
EIO
;

889 
ªt
 = 
	`pci_£t_dma_mask
(
pdev
, 
	`DMA_BIT_MASK
(32));

890 i‡(
ªt
) {

891 
	`¥_îr
("32-bit DMAÇotávailable\n");

892  
ªt
;

895 
ªt
 = 
	`pci_£t_c⁄si°ít_dma_mask
(
pdev
, 
	`DMA_BIT_MASK
(32));

896 i‡(
ªt
) {

897 
	`¥_îr
("32-bit DMA consistent DMAÉnable failed\n");

898  
ªt
;

905 
	`pci_ªad_c⁄fig_byã
(
pdev
, 
PCI_CACHE_LINE_SIZE
, &
csz
);

906 i‡(
csz
 == 0) {

914 
csz
 = 
L1_CACHE_BYTES
 / (
u32
);

915 
	`pci_wrôe_c⁄fig_byã
(
pdev
, 
PCI_CACHE_LINE_SIZE
, 
csz
);

922 
	`pci_wrôe_c⁄fig_byã
(
pdev
, 
PCI_LATENCY_TIMER
, 0xa8);

924 
	`pci_£t_ma°î
(
pdev
);

930 
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 0x40, &
vÆ
);

931 i‡((
vÆ
 & 0x0000ff00) != 0)

932 
	`pci_wrôe_c⁄fig_dw‹d
(
pdev
, 0x40, 
vÆ
 & 0xffff00ff);

934 
ªt
 = 
	`pcim_iom≠_ªgi⁄s
(
pdev
, 
	`BIT
(0), "ath9k");

935 i‡(
ªt
) {

936 
	`dev_îr
(&
pdev
->
dev
, "PCI memoryÑegionÑeserveÉrror\n");

937  -
ENODEV
;

940 
	`©h9k_fûl_ch™˘x_›s
();

941 
hw
 = 
	`õì80211_Æloc_hw
((
©h_so·c
), &
©h9k_›s
);

942 i‡(!
hw
) {

943 
	`dev_îr
(&
pdev
->
dev
, "No memory for ieee80211_hw\n");

944  -
ENOMEM
;

947 
	`SET_IEEE80211_DEV
(
hw
, &
pdev
->
dev
);

948 
	`pci_£t_drvd©a
(
pdev
, 
hw
);

950 
sc
 = 
hw
->
¥iv
;

951 
sc
->
hw
 = hw;

952 
sc
->
dev
 = &
pdev
->dev;

953 
sc
->
mem
 = 
	`pcim_iom≠_èbÀ
(
pdev
)[0];

954 
sc
->
drivî_d©a
 = 
id
->driver_data;

956 
ªt
 = 
	`ªque°_úq
(
pdev
->
úq
, 
©h_i§
, 
IRQF_SHARED
, "©h9k", 
sc
);

957 i‡(
ªt
) {

958 
	`dev_îr
(&
pdev
->
dev
, "request_irq failed\n");

959 
îr_úq
;

962 
sc
->
úq
 = 
pdev
->irq;

964 
ªt
 = 
	`©h9k_öô_devi˚
(
id
->
devi˚
, 
sc
, &
©h_pci_bus_›s
);

965 i‡(
ªt
) {

966 
	`dev_îr
(&
pdev
->
dev
, "FailedÅo initialize device\n");

967 
îr_öô
;

970 
	`©h9k_hw_«me
(
sc
->
sc_ah
, 
hw_«me
, (hw_name));

971 
	`wùhy_öfo
(
hw
->
wùhy
, "%s mem=0x%lx, irq=%d\n",

972 
hw_«me
, ()
sc
->
mem
, 
pdev
->
úq
);

976 
îr_öô
:

977 
	`‰ì_úq
(
sc
->
úq
, sc);

978 
îr_úq
:

979 
	`õì80211_‰ì_hw
(
hw
);

980  
ªt
;

981 
	}
}

983 
	$©h_pci_ªmove
(
pci_dev
 *
pdev
)

985 
õì80211_hw
 *
hw
 = 
	`pci_gë_drvd©a
(
pdev
);

986 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

988 i‡(!
is_©h9k_u∆ﬂded
)

989 
sc
->
sc_ah
->
ah_Êags
 |
AH_UNPLUGGED
;

990 
	`©h9k_deöô_devi˚
(
sc
);

991 
	`‰ì_úq
(
sc
->
úq
, sc);

992 
	`õì80211_‰ì_hw
(
sc
->
hw
);

993 
	}
}

995 #ifde‡
CONFIG_PM_SLEEP


997 
	$©h_pci_su•íd
(
devi˚
 *device)

999 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
devi˚
);

1000 
õì80211_hw
 *
hw
 = 
	`pci_gë_drvd©a
(
pdev
);

1001 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1002 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1004 i‡(
	`ã°_bô
(
ATH_OP_WOW_ENABLED
, &
comm⁄
->
›_Êags
)) {

1005 
	`dev_öfo
(&
pdev
->
dev
, "WOW isÉnabled, bypassing PCI suspend\n");

1013 
	`©h9k_°›_btc€x
(
sc
);

1014 
	`©h9k_hw_dißbÀ
(
sc
->
sc_ah
);

1015 
	`dñ_timî_sync
(&
sc
->
¶ìp_timî
);

1016 
	`©h9k_hw_£çowî
(
sc
->
sc_ah
, 
ATH9K_PM_FULL_SLEEP
);

1019 
	}
}

1021 
	$©h_pci_ªsume
(
devi˚
 *device)

1023 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
devi˚
);

1024 
õì80211_hw
 *
hw
 = 
	`pci_gë_drvd©a
(
pdev
);

1025 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1026 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1027 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1028 
u32
 
vÆ
;

1035 
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 0x40, &
vÆ
);

1036 i‡((
vÆ
 & 0x0000ff00) != 0)

1037 
	`pci_wrôe_c⁄fig_dw‹d
(
pdev
, 0x40, 
vÆ
 & 0xffff00ff);

1039 
	`©h_pci_a•m_öô
(
comm⁄
);

1040 
ah
->
ª£t_powî_⁄
 = 
Ál£
;

1043 
	}
}

1045 
SIMPLE_DEV_PM_OPS
(
©h9k_pm_›s
, 
©h_pci_su•íd
, 
©h_pci_ªsume
);

1047 
	#ATH9K_PM_OPS
 (&
©h9k_pm_›s
)

	)

1051 
	#ATH9K_PM_OPS
 
NULL


	)

1056 
MODULE_DEVICE_TABLE
(
pci
, 
©h_pci_id_èbÀ
);

1058 
pci_drivî
 
	g©h_pci_drivî
 = {

1059 .
«me
 = "ath9k",

1060 .
	gid_èbÀ
 = 
©h_pci_id_èbÀ
,

1061 .
	g¥obe
 = 
©h_pci_¥obe
,

1062 .
	gªmove
 = 
©h_pci_ªmove
,

1063 .
	gdrivî
.
	gpm
 = 
ATH9K_PM_OPS
,

1066 
	$©h_pci_öô
()

1068  
	`pci_ªgi°î_drivî
(&
©h_pci_drivî
);

1069 
	}
}

1071 
	$©h_pci_exô
()

1073 
	`pci_uƒegi°î_drivî
(&
©h_pci_drivî
);

1074 
	}
}

	@phy.h

17 #i‚de‡
PHY_H


18 
	#PHY_H


	)

20 
	#CHANSEL_DIV
 15

	)

21 
	#CHANSEL_2G
(
_‰eq
Ë(((_‰eqË* 0x10000Ë/ 
CHANSEL_DIV
)

	)

22 
	#CHANSEL_5G
(
_‰eq
Ë(((_‰eqË* 0x8000Ë/ 
CHANSEL_DIV
)

	)

24 
	#AR_PHY_BASE
 0x9800

	)

25 
	#AR_PHY
(
_n
Ë(
AR_PHY_BASE
 + ((_n)<<2))

	)

27 
	#AR_PHY_TX_PWRCTRL_TX_GAIN_TAB_MAX
 0x0007E000

	)

28 
	#AR_PHY_TX_PWRCTRL_TX_GAIN_TAB_MAX_S
 13

	)

29 
	#AR_PHY_TX_GAIN_CLC
 0x0000001E

	)

30 
	#AR_PHY_TX_GAIN_CLC_S
 1

	)

31 
	#AR_PHY_TX_GAIN
 0x0007F000

	)

32 
	#AR_PHY_TX_GAIN_S
 12

	)

34 
	#AR_PHY_CLC_TBL1
 0xa35c

	)

35 
	#AR_PHY_CLC_I0
 0x07ff0000

	)

36 
	#AR_PHY_CLC_I0_S
 16

	)

37 
	#AR_PHY_CLC_Q0
 0x0000ffd0

	)

38 
	#AR_PHY_CLC_Q0_S
 5

	)

40 
	#ANTSWAP_AB
 0x0001

	)

41 
	#REDUCE_CHAIN_0
 0x00000050

	)

42 
	#REDUCE_CHAIN_1
 0x00000051

	)

43 
	#AR_PHY_CHIP_ID
 0x9818

	)

45 
	#AR_PHY_TIMING11_SPUR_FREQ_SD
 0x3FF00000

	)

46 
	#AR_PHY_TIMING11_SPUR_FREQ_SD_S
 20

	)

48 
	#AR_PHY_PLL_CONTROL
 0x16180

	)

49 
	#AR_PHY_PLL_MODE
 0x16184

	)

51 
	#AR_PHY_USB_CTRL1
 0x16c84

	)

52 
	#AR_PHY_USB_CTRL2
 0x16c88

	)

54 
	e©h9k_™t_div_comb_ a_c⁄f
 {

55 
	mATH_ANT_DIV_COMB_LNA1_MINUS_LNA2
,

56 
	mATH_ANT_DIV_COMB_LNA2
,

57 
	mATH_ANT_DIV_COMB_LNA1
,

58 
	mATH_ANT_DIV_COMB_LNA1_PLUS_LNA2
,

	@recv.c

17 
	~<löux/dma-m≠pög.h
>

18 
	~"©h9k.h
"

19 
	~"¨9003_mac.h
"

21 
	#SKB_CB_ATHBUF
(
__skb
Ë(*((
©h_rxbuf
 **)__skb->
cb
))

	)

23 
ölöe
 
boﬁ
 
	$©h9k_check_auto_¶ìp
(
©h_so·c
 *
sc
)

25  
sc
->
ps_íabÀd
 &&

26 (
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_AUTOSLEEP
);

27 
	}
}

37 
	$©h_rx_buf_lök
(
©h_so·c
 *
sc
, 
©h_rxbuf
 *
bf
,

38 
boﬁ
 
Êush
)

40 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

41 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

42 
©h_desc
 *
ds
;

43 
sk_buff
 *
skb
;

45 
ds
 = 
bf
->
bf_desc
;

46 
ds
->
ds_lök
 = 0;

47 
ds
->
ds_d©a
 = 
bf
->
bf_buf_addr
;

50 
skb
 = 
bf
->
bf_mpdu
;

51 
	`BUG_ON
(
skb
 =
NULL
);

52 
ds
->
ds_vd©a
 = 
skb
->
d©a
;

59 
	`©h9k_hw_£tu¥xdesc
(
ah
, 
ds
,

60 
comm⁄
->
rx_bufsize
,

63 i‡(
sc
->
rx
.
rxlök
)

64 *
sc
->
rx
.
rxlök
 = 
bf
->
bf_daddr
;

65 i‡(!
Êush
)

66 
	`©h9k_hw_puåxbuf
(
ah
, 
bf
->
bf_daddr
);

68 
sc
->
rx
.
rxlök
 = &
ds
->
ds_lök
;

69 
	}
}

71 
	$©h_rx_buf_ªlök
(
©h_so·c
 *
sc
, 
©h_rxbuf
 *
bf
,

72 
boﬁ
 
Êush
)

74 i‡(
sc
->
rx
.
buf_hﬁd
)

75 
	`©h_rx_buf_lök
(
sc
, sc->
rx
.
buf_hﬁd
, 
Êush
);

77 
sc
->
rx
.
buf_hﬁd
 = 
bf
;

78 
	}
}

80 
	$©h_£tdeÁ¡í«
(
©h_so·c
 *
sc
, 
u32
 
™ã¬a
)

83 
	`©h9k_hw_£è¡í«
(
sc
->
sc_ah
, 
™ã¬a
);

84 
sc
->
rx
.
deÁ¡
 = 
™ã¬a
;

85 
sc
->
rx
.
rxŸhî™t
 = 0;

86 
	}
}

88 
	$©h_›mode_öô
(
©h_so·c
 *
sc
)

90 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

91 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

93 
u32
 
rfût
, 
mfût
[2];

96 
rfût
 = 
	`©h_ˇl¸xfûãr
(
sc
);

97 
	`©h9k_hw_£åxfûãr
(
ah
, 
rfût
);

100 
	`©h_hw_£tbssidmask
(
comm⁄
);

103 
	`©h9k_hw_£t›mode
(
ah
);

106 
mfût
[0] = mfilt[1] = ~0;

107 
	`©h9k_hw_£tmˇ°fûãr
(
ah
, 
mfût
[0], mfilt[1]);

108 
	}
}

110 
boﬁ
 
	$©h_rx_edma_buf_lök
(
©h_so·c
 *
sc
,

111 
©h9k_rx_qty≥
 
qty≥
)

113 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

114 
©h_rx_edma
 *
rx_edma
;

115 
sk_buff
 *
skb
;

116 
©h_rxbuf
 *
bf
;

118 
rx_edma
 = &
sc
->
rx
.rx_edma[
qty≥
];

119 i‡(
	`skb_queue_Àn
(&
rx_edma
->
rx_fifo
Ë>rx_edma->
rx_fifo_hwsize
)

120  
Ál£
;

122 
bf
 = 
	`li°_fú°_íåy
(&
sc
->
rx
.
rxbuf
, 
©h_rxbuf
, 
li°
);

123 
	`li°_dñ_öô
(&
bf
->
li°
);

125 
skb
 = 
bf
->
bf_mpdu
;

127 
	`mem£t
(
skb
->
d©a
, 0, 
ah
->
ˇps
.
rx_°©us_Àn
);

128 
	`dma_sync_sögÀ_f‹_devi˚
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

129 
ah
->
ˇps
.
rx_°©us_Àn
, 
DMA_TO_DEVICE
);

131 
	`SKB_CB_ATHBUF
(
skb
Ë
bf
;

132 
	`©h9k_hw_addrxbuf_edma
(
ah
, 
bf
->
bf_buf_addr
, 
qty≥
);

133 
	`__skb_queue_èû
(&
rx_edma
->
rx_fifo
, 
skb
);

135  
åue
;

136 
	}
}

138 
	$©h_rx_addbuf„r_edma
(
©h_so·c
 *
sc
,

139 
©h9k_rx_qty≥
 
qty≥
)

141 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

142 
©h_rxbuf
 *
bf
, *
tbf
;

144 i‡(
	`li°_em±y
(&
sc
->
rx
.
rxbuf
)) {

145 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "No freeÑx bufávailable\n");

149 
	`li°_f‹_óch_íåy_ß„
(
bf
, 
tbf
, &
sc
->
rx
.
rxbuf
, 
li°
)

150 i‡(!
	`©h_rx_edma_buf_lök
(
sc
, 
qty≥
))

153 
	}
}

155 
	$©h_rx_ªmove_buf„r
(
©h_so·c
 *
sc
,

156 
©h9k_rx_qty≥
 
qty≥
)

158 
©h_rxbuf
 *
bf
;

159 
©h_rx_edma
 *
rx_edma
;

160 
sk_buff
 *
skb
;

162 
rx_edma
 = &
sc
->
rx
.rx_edma[
qty≥
];

164 (
skb
 = 
	`__skb_dequeue
(&
rx_edma
->
rx_fifo
)Ë!
NULL
) {

165 
bf
 = 
	`SKB_CB_ATHBUF
(
skb
);

166 
	`BUG_ON
(!
bf
);

167 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
);

169 
	}
}

171 
	$©h_rx_edma_˛ónup
(
©h_so·c
 *
sc
)

173 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

174 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

175 
©h_rxbuf
 *
bf
;

177 
	`©h_rx_ªmove_buf„r
(
sc
, 
ATH9K_RX_QUEUE_LP
);

178 
	`©h_rx_ªmove_buf„r
(
sc
, 
ATH9K_RX_QUEUE_HP
);

180 
	`li°_f‹_óch_íåy
(
bf
, &
sc
->
rx
.
rxbuf
, 
li°
) {

181 i‡(
bf
->
bf_mpdu
) {

182 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

183 
comm⁄
->
rx_bufsize
,

184 
DMA_BIDIRECTIONAL
);

185 
	`dev_k‰ì_skb_™y
(
bf
->
bf_mpdu
);

186 
bf
->
bf_buf_addr
 = 0;

187 
bf
->
bf_mpdu
 = 
NULL
;

190 
	}
}

192 
	$©h_rx_edma_öô_queue
(
©h_rx_edma
 *
rx_edma
, 
size
)

194 
	`__skb_queue_hód_öô
(&
rx_edma
->
rx_fifo
);

195 
rx_edma
->
rx_fifo_hwsize
 = 
size
;

196 
	}
}

198 
	$©h_rx_edma_öô
(
©h_so·c
 *
sc
, 
nbufs
)

200 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

201 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

202 
sk_buff
 *
skb
;

203 
©h_rxbuf
 *
bf
;

204 
îr‹
 = 0, 
i
;

205 
u32
 
size
;

207 
	`©h9k_hw_£t_rx_bufsize
(
ah
, 
comm⁄
->
rx_bufsize
 -

208 
ah
->
ˇps
.
rx_°©us_Àn
);

210 
	`©h_rx_edma_öô_queue
(&
sc
->
rx
.
rx_edma
[
ATH9K_RX_QUEUE_LP
],

211 
ah
->
ˇps
.
rx_Õ_qdïth
);

212 
	`©h_rx_edma_öô_queue
(&
sc
->
rx
.
rx_edma
[
ATH9K_RX_QUEUE_HP
],

213 
ah
->
ˇps
.
rx_hp_qdïth
);

215 
size
 = (
©h_rxbuf
Ë* 
nbufs
;

216 
bf
 = 
	`devm_kzÆloc
(
sc
->
dev
, 
size
, 
GFP_KERNEL
);

217 i‡(!
bf
)

218  -
ENOMEM
;

220 
	`INIT_LIST_HEAD
(&
sc
->
rx
.
rxbuf
);

222 
i
 = 0; i < 
nbufs
; i++, 
bf
++) {

223 
skb
 = 
	`©h_rxbuf_Æloc
(
comm⁄
, comm⁄->
rx_bufsize
, 
GFP_KERNEL
);

224 i‡(!
skb
) {

225 
îr‹
 = -
ENOMEM
;

226 
rx_öô_Áû
;

229 
	`mem£t
(
skb
->
d©a
, 0, 
comm⁄
->
rx_bufsize
);

230 
bf
->
bf_mpdu
 = 
skb
;

232 
bf
->
bf_buf_addr
 = 
	`dma_m≠_sögÀ
(
sc
->
dev
, 
skb
->
d©a
,

233 
comm⁄
->
rx_bufsize
,

234 
DMA_BIDIRECTIONAL
);

235 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
sc
->
dev
,

236 
bf
->
bf_buf_addr
))) {

237 
	`dev_k‰ì_skb_™y
(
skb
);

238 
bf
->
bf_mpdu
 = 
NULL
;

239 
bf
->
bf_buf_addr
 = 0;

240 
	`©h_îr
(
comm⁄
,

242 
îr‹
 = -
ENOMEM
;

243 
rx_öô_Áû
;

246 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
);

251 
rx_öô_Áû
:

252 
	`©h_rx_edma_˛ónup
(
sc
);

253  
îr‹
;

254 
	}
}

256 
	$©h_edma_°¨t_ªcv
(
©h_so·c
 *
sc
)

258 
	`©h9k_hw_rxía
(
sc
->
sc_ah
);

259 
	`©h_rx_addbuf„r_edma
(
sc
, 
ATH9K_RX_QUEUE_HP
);

260 
	`©h_rx_addbuf„r_edma
(
sc
, 
ATH9K_RX_QUEUE_LP
);

261 
	`©h_›mode_öô
(
sc
);

262 
	`©h9k_hw_°¨çcuª˚ive
(
sc
->
sc_ah
, sc->
cur_ch™
->
offch™√l
);

263 
	}
}

265 
	$©h_edma_°›_ªcv
(
©h_so·c
 *
sc
)

267 
	`©h_rx_ªmove_buf„r
(
sc
, 
ATH9K_RX_QUEUE_HP
);

268 
	`©h_rx_ªmove_buf„r
(
sc
, 
ATH9K_RX_QUEUE_LP
);

269 
	}
}

271 
	$©h_rx_öô
(
©h_so·c
 *
sc
, 
nbufs
)

273 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

274 
sk_buff
 *
skb
;

275 
©h_rxbuf
 *
bf
;

276 
îr‹
 = 0;

278 
	`•ö_lock_öô
(&
sc
->
sc_pcu_lock
);

280 
comm⁄
->
rx_bufsize
 = 
IEEE80211_MAX_MPDU_LEN
 / 2 +

281 
sc
->
sc_ah
->
ˇps
.
rx_°©us_Àn
;

283 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

284  
	`©h_rx_edma_öô
(
sc
, 
nbufs
);

286 
	`©h_dbg
(
comm⁄
, 
CONFIG
, "cachelsz %uÑxbufsize %u\n",

287 
comm⁄
->
ˇchñsz
, comm⁄->
rx_bufsize
);

291 
îr‹
 = 
	`©h_descdma_£tup
(
sc
, &sc->
rx
.
rxdma
, &sc->rx.
rxbuf
,

292 "rx", 
nbufs
, 1, 0);

293 i‡(
îr‹
 != 0) {

294 
	`©h_îr
(
comm⁄
,

296 
îr‹
);

297 
îr
;

300 
	`li°_f‹_óch_íåy
(
bf
, &
sc
->
rx
.
rxbuf
, 
li°
) {

301 
skb
 = 
	`©h_rxbuf_Æloc
(
comm⁄
, comm⁄->
rx_bufsize
,

302 
GFP_KERNEL
);

303 i‡(
skb
 =
NULL
) {

304 
îr‹
 = -
ENOMEM
;

305 
îr
;

308 
bf
->
bf_mpdu
 = 
skb
;

309 
bf
->
bf_buf_addr
 = 
	`dma_m≠_sögÀ
(
sc
->
dev
, 
skb
->
d©a
,

310 
comm⁄
->
rx_bufsize
,

311 
DMA_FROM_DEVICE
);

312 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
sc
->
dev
,

313 
bf
->
bf_buf_addr
))) {

314 
	`dev_k‰ì_skb_™y
(
skb
);

315 
bf
->
bf_mpdu
 = 
NULL
;

316 
bf
->
bf_buf_addr
 = 0;

317 
	`©h_îr
(
comm⁄
,

319 
îr‹
 = -
ENOMEM
;

320 
îr
;

323 
sc
->
rx
.
rxlök
 = 
NULL
;

324 
îr
:

325 i‡(
îr‹
)

326 
	`©h_rx_˛ónup
(
sc
);

328  
îr‹
;

329 
	}
}

331 
	$©h_rx_˛ónup
(
©h_so·c
 *
sc
)

333 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

334 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

335 
sk_buff
 *
skb
;

336 
©h_rxbuf
 *
bf
;

338 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

339 
	`©h_rx_edma_˛ónup
(
sc
);

343 
	`li°_f‹_óch_íåy
(
bf
, &
sc
->
rx
.
rxbuf
, 
li°
) {

344 
skb
 = 
bf
->
bf_mpdu
;

345 i‡(
skb
) {

346 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

347 
comm⁄
->
rx_bufsize
,

348 
DMA_FROM_DEVICE
);

349 
	`dev_k‰ì_skb
(
skb
);

350 
bf
->
bf_buf_addr
 = 0;

351 
bf
->
bf_mpdu
 = 
NULL
;

354 
	}
}

375 
u32
 
	$©h_ˇl¸xfûãr
(
©h_so·c
 *
sc
)

377 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

378 
u32
 
rfût
;

380 i‡(
	`c⁄fig_íabÀd
(
CPTCFG_ATH9K_TX99
))

383 
rfût
 = 
ATH9K_RX_FILTER_UCAST
 | 
ATH9K_RX_FILTER_BCAST


384 | 
ATH9K_RX_FILTER_MCAST
;

387 i‡(
sc
->
hw
->
c⁄f
.
ød¨_íabÀd
)

388 
rfût
 |
ATH9K_RX_FILTER_PHYRADAR
 | 
ATH9K_RX_FILTER_PHYERR
;

390 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

392 i‡(
sc
->
cur_ch™
->
rxfûãr
 & 
FIF_PROBE_REQ
)

393 
rfût
 |
ATH9K_RX_FILTER_PROBEREQ
;

395 i‡(
sc
->
sc_ah
->
is_m⁄ô‹ög
)

396 
rfût
 |
ATH9K_RX_FILTER_PROM
;

398 i‡((
sc
->
cur_ch™
->
rxfûãr
 & 
FIF_CONTROL
) ||

399 
sc
->
sc_ah
->
dy«ck
.
íabÀd
)

400 
rfût
 |
ATH9K_RX_FILTER_CONTROL
;

402 i‡((
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_STATION
) &&

403 (
sc
->
cur_ch™
->
nvifs
 <= 1) &&

404 !(
sc
->
cur_ch™
->
rxfûãr
 & 
FIF_BCN_PRBRESP_PROMISC
))

405 
rfût
 |
ATH9K_RX_FILTER_MYBEACON
;

406 i‡(
sc
->
sc_ah
->
›mode
 !
NL80211_IFTYPE_OCB
)

407 
rfût
 |
ATH9K_RX_FILTER_BEACON
;

409 i‡((
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_AP
) ||

410 (
sc
->
cur_ch™
->
rxfûãr
 & 
FIF_PSPOLL
))

411 
rfût
 |
ATH9K_RX_FILTER_PSPOLL
;

413 i‡(
sc
->
cur_ch™def
.
width
 !
NL80211_CHAN_WIDTH_20_NOHT
)

414 
rfût
 |
ATH9K_RX_FILTER_COMP_BAR
;

416 i‡(
sc
->
cur_ch™
->
nvifs
 > 1 || (sc->cur_ch™->
rxfûãr
 & 
FIF_OTHER_BSS
)) {

418 i‡(
sc
->
sc_ah
->
hw_vîsi⁄
.
macVîsi⁄
 <
AR_SREV_VERSION_9160
)

419 
rfût
 |
ATH9K_RX_FILTER_PROM
;

420 
rfût
 |
ATH9K_RX_FILTER_MCAST_BCAST_ALL
;

423 i‡(
	`AR_SREV_9550
(
sc
->
sc_ah
Ë|| 
	`AR_SREV_9531
(sc->sc_ah) ||

424 
	`AR_SREV_9561
(
sc
->
sc_ah
))

425 
rfût
 |
ATH9K_RX_FILTER_4ADDRESS
;

427 i‡(
	`AR_SREV_9462
(
sc
->
sc_ah
Ë|| 
	`AR_SREV_9565
(sc->sc_ah))

428 
rfût
 |
ATH9K_RX_FILTER_CONTROL_WRAPPER
;

430 i‡(
	`©h9k_is_ch™˘x_íabÀd
() &&

431 
	`ã°_bô
(
ATH_OP_SCANNING
, &
comm⁄
->
›_Êags
))

432 
rfût
 |
ATH9K_RX_FILTER_BEACON
;

434 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

436  
rfût
;

438 
	}
}

440 
	$©h_°¨åecv
(
©h_so·c
 *
sc
)

442 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

443 
©h_rxbuf
 *
bf
, *
tbf
;

445 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

446 
	`©h_edma_°¨t_ªcv
(
sc
);

450 i‡(
	`li°_em±y
(&
sc
->
rx
.
rxbuf
))

451 
°¨t_ªcv
;

453 
sc
->
rx
.
buf_hﬁd
 = 
NULL
;

454 
sc
->
rx
.
rxlök
 = 
NULL
;

455 
	`li°_f‹_óch_íåy_ß„
(
bf
, 
tbf
, &
sc
->
rx
.
rxbuf
, 
li°
) {

456 
	`©h_rx_buf_lök
(
sc
, 
bf
, 
Ál£
);

460 i‡(
	`li°_em±y
(&
sc
->
rx
.
rxbuf
))

461 
°¨t_ªcv
;

463 
bf
 = 
	`li°_fú°_íåy
(&
sc
->
rx
.
rxbuf
, 
©h_rxbuf
, 
li°
);

464 
	`©h9k_hw_puåxbuf
(
ah
, 
bf
->
bf_daddr
);

465 
	`©h9k_hw_rxía
(
ah
);

467 
°¨t_ªcv
:

468 
	`©h_›mode_öô
(
sc
);

469 
	`©h9k_hw_°¨çcuª˚ive
(
ah
, 
sc
->
cur_ch™
->
offch™√l
);

470 
	}
}

472 
	$©h_Êushªcv
(
©h_so·c
 *
sc
)

474 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

475 
	`©h_rx_èskÀt
(
sc
, 1, 
åue
);

476 
	`©h_rx_èskÀt
(
sc
, 1, 
Ál£
);

477 
	}
}

479 
boﬁ
 
	$©h_°›ªcv
(
©h_so·c
 *
sc
)

481 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

482 
boﬁ
 
°›≥d
, 
ª£t
 = 
Ál£
;

484 
	`©h9k_hw_ab‹çcuªcv
(
ah
);

485 
	`©h9k_hw_£åxfûãr
(
ah
, 0);

486 
°›≥d
 = 
	`©h9k_hw_°›dm¨ecv
(
ah
, &
ª£t
);

488 
	`©h_Êushªcv
(
sc
);

490 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

491 
	`©h_edma_°›_ªcv
(
sc
);

493 
sc
->
rx
.
rxlök
 = 
NULL
;

495 i‡(!(
ah
->
ah_Êags
 & 
AH_UNPLUGGED
) &&

496 
	`u∆ikñy
(!
°›≥d
)) {

497 
	`©h_dbg
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
RESET
,

499 
	`RESET_STAT_INC
(
sc
, 
RESET_RX_DMA_ERROR
);

501  
°›≥d
 && !
ª£t
;

502 
	}
}

504 
boﬁ
 
	$©h_bóc⁄_dtim_≥ndög_ˇb
(
sk_buff
 *
skb
)

507 
õì80211_mgmt
 *
mgmt
;

508 
u8
 *
pos
, *
íd
, 
id
, 
ñí
;

509 
õì80211_tim_õ
 *
tim
;

511 
mgmt
 = (
õì80211_mgmt
 *)
skb
->
d©a
;

512 
pos
 = 
mgmt
->
u
.
bóc⁄
.
v¨übÀ
;

513 
íd
 = 
skb
->
d©a
 + skb->
Àn
;

515 
pos
 + 2 < 
íd
) {

516 
id
 = *
pos
++;

517 
ñí
 = *
pos
++;

518 i‡(
pos
 + 
ñí
 > 
íd
)

521 i‡(
id
 =
WLAN_EID_TIM
) {

522 i‡(
ñí
 < (*
tim
))

524 
tim
 = (
õì80211_tim_õ
 *Ë
pos
;

525 i‡(
tim
->
dtim_cou¡
 != 0)

527  
tim
->
bôm≠_˘æ
 & 0x01;

530 
pos
 +
ñí
;

533  
Ál£
;

534 
	}
}

536 
	$©h_rx_ps_bóc⁄
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
)

538 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

539 
boﬁ
 
skù_bóc⁄
 = 
Ál£
;

541 i‡(
skb
->
Àn
 < 24 + 8 + 2 + 2)

544 
sc
->
ps_Êags
 &~
PS_WAIT_FOR_BEACON
;

546 i‡(
sc
->
ps_Êags
 & 
PS_BEACON_SYNC
) {

547 
sc
->
ps_Êags
 &~
PS_BEACON_SYNC
;

548 
	`©h_dbg
(
comm⁄
, 
PS
,

551 #ifde‡
CPTCFG_ATH9K_CHANNEL_CONTEXT


552 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

553 i‡(
sc
->
cur_ch™
 =&sc->
offch™√l
.
ch™
)

554 
skù_bóc⁄
 = 
åue
;

558 i‡(!
skù_bóc⁄
 &&

559 !(
	`WARN_ON_ONCE
(
sc
->
cur_ch™
->
bóc⁄
.
bóc⁄_öãrvÆ
 == 0)))

560 
	`©h9k_£t_bóc⁄
(
sc
);

562 
	`©h9k_p2p_bóc⁄_sync
(
sc
);

565 i‡(
	`©h_bóc⁄_dtim_≥ndög_ˇb
(
skb
)) {

573 
	`©h_dbg
(
comm⁄
, 
PS
,

575 
sc
->
ps_Êags
 |
PS_WAIT_FOR_CAB
 | 
PS_WAIT_FOR_BEACON
;

579 i‡(
sc
->
ps_Êags
 & 
PS_WAIT_FOR_CAB
) {

585 
sc
->
ps_Êags
 &~
PS_WAIT_FOR_CAB
;

586 
	`©h_dbg
(
comm⁄
, 
PS
, "PS wait for CAB framesÅimed out\n");

588 
	}
}

590 
	$©h_rx_ps
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
, 
boﬁ
 
mybóc⁄
)

592 
õì80211_hdr
 *
hdr
;

593 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

595 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

598 i‡(((
sc
->
ps_Êags
 & 
PS_WAIT_FOR_BEACON
Ë|| 
	`©h9k_check_auto_¶ìp
(sc))

599 && 
mybóc⁄
) {

600 
	`©h_rx_ps_bóc⁄
(
sc
, 
skb
);

601 } i‡((
sc
->
ps_Êags
 & 
PS_WAIT_FOR_CAB
) &&

602 (
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

603 
	`õì80211_is_a˘i⁄
(
hdr
->
‰ame_c⁄åﬁ
)) &&

604 
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

605 !
	`õì80211_has_m‹ed©a
(
hdr
->
‰ame_c⁄åﬁ
)) {

610 
sc
->
ps_Êags
 &~(
PS_WAIT_FOR_CAB
 | 
PS_WAIT_FOR_BEACON
);

611 
	`©h_dbg
(
comm⁄
, 
PS
,

613 } i‡((
sc
->
ps_Êags
 & 
PS_WAIT_FOR_PSPOLL_DATA
) &&

614 !
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

615 !
	`õì80211_has_m‹e‰ags
(
hdr
->
‰ame_c⁄åﬁ
)) {

616 
sc
->
ps_Êags
 &~
PS_WAIT_FOR_PSPOLL_DATA
;

617 
	`©h_dbg
(
comm⁄
, 
PS
,

619 
sc
->
ps_Êags
 & (
PS_WAIT_FOR_BEACON
 |

620 
PS_WAIT_FOR_CAB
 |

621 
PS_WAIT_FOR_PSPOLL_DATA
 |

622 
PS_WAIT_FOR_TX_ACK
));

624 
	}
}

626 
boﬁ
 
	$©h_edma_gë_buf„rs
(
©h_so·c
 *
sc
,

627 
©h9k_rx_qty≥
 
qty≥
,

628 
©h_rx_°©us
 *
rs
,

629 
©h_rxbuf
 **
de°
)

631 
©h_rx_edma
 *
rx_edma
 = &
sc
->
rx
.rx_edma[
qty≥
];

632 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

633 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

634 
sk_buff
 *
skb
;

635 
©h_rxbuf
 *
bf
;

636 
ªt
;

638 
skb
 = 
	`skb_≥ek
(&
rx_edma
->
rx_fifo
);

639 i‡(!
skb
)

640  
Ál£
;

642 
bf
 = 
	`SKB_CB_ATHBUF
(
skb
);

643 
	`BUG_ON
(!
bf
);

645 
	`dma_sync_sögÀ_f‹_˝u
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

646 
comm⁄
->
rx_bufsize
, 
DMA_FROM_DEVICE
);

648 
ªt
 = 
	`©h9k_hw_¥o˚ss_rxdesc_edma
(
ah
, 
rs
, 
skb
->
d©a
);

649 i‡(
ªt
 =-
EINPROGRESS
) {

651 
	`dma_sync_sögÀ_f‹_devi˚
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

652 
comm⁄
->
rx_bufsize
, 
DMA_FROM_DEVICE
);

653  
Ál£
;

656 
	`__skb_u∆ök
(
skb
, &
rx_edma
->
rx_fifo
);

657 i‡(
ªt
 =-
EINVAL
) {

659 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
);

660 
	`©h_rx_edma_buf_lök
(
sc
, 
qty≥
);

662 
skb
 = 
	`skb_≥ek
(&
rx_edma
->
rx_fifo
);

663 i‡(
skb
) {

664 
bf
 = 
	`SKB_CB_ATHBUF
(
skb
);

665 
	`BUG_ON
(!
bf
);

667 
	`__skb_u∆ök
(
skb
, &
rx_edma
->
rx_fifo
);

668 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
);

669 
	`©h_rx_edma_buf_lök
(
sc
, 
qty≥
);

672 
bf
 = 
NULL
;

675 *
de°
 = 
bf
;

676  
åue
;

677 
	}
}

679 
©h_rxbuf
 *
	$©h_edma_gë_√xt_rx_buf
(
©h_so·c
 *
sc
,

680 
©h_rx_°©us
 *
rs
,

681 
©h9k_rx_qty≥
 
qty≥
)

683 
©h_rxbuf
 *
bf
 = 
NULL
;

685 
	`©h_edma_gë_buf„rs
(
sc
, 
qty≥
, 
rs
, &
bf
)) {

686 i‡(!
bf
)

689  
bf
;

691  
NULL
;

692 
	}
}

694 
©h_rxbuf
 *
	$©h_gë_√xt_rx_buf
(
©h_so·c
 *
sc
,

695 
©h_rx_°©us
 *
rs
)

697 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

698 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

699 
©h_desc
 *
ds
;

700 
©h_rxbuf
 *
bf
;

701 
ªt
;

703 i‡(
	`li°_em±y
(&
sc
->
rx
.
rxbuf
)) {

704 
sc
->
rx
.
rxlök
 = 
NULL
;

705  
NULL
;

708 
bf
 = 
	`li°_fú°_íåy
(&
sc
->
rx
.
rxbuf
, 
©h_rxbuf
, 
li°
);

709 i‡(
bf
 =
sc
->
rx
.
buf_hﬁd
)

710  
NULL
;

712 
ds
 = 
bf
->
bf_desc
;

725 
ªt
 = 
	`©h9k_hw_rx¥ocdesc
(
ah
, 
ds
, 
rs
);

726 i‡(
ªt
 =-
EINPROGRESS
) {

727 
©h_rx_°©us
 
ås
;

728 
©h_rxbuf
 *
tbf
;

729 
©h_desc
 *
tds
;

731 
	`mem£t
(&
ås
, 0, (trs));

732 i‡(
	`li°_is_œ°
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
)) {

733 
sc
->
rx
.
rxlök
 = 
NULL
;

734  
NULL
;

737 
tbf
 = 
	`li°_íåy
(
bf
->
li°
.
√xt
, 
©h_rxbuf
,Üist);

750 
tds
 = 
tbf
->
bf_desc
;

751 
ªt
 = 
	`©h9k_hw_rx¥ocdesc
(
ah
, 
tds
, &
ås
);

752 i‡(
ªt
 =-
EINPROGRESS
)

753  
NULL
;

759 
ªt
 = 
	`©h9k_hw_rx¥ocdesc
(
ah
, 
ds
, 
rs
);

760 i‡(
ªt
 =-
EINPROGRESS
) {

765 
rs
->
rs_d©Æí
 = 0;

766 
rs
->
rs_m‹e
 = 
åue
;

770 
	`li°_dñ
(&
bf
->
li°
);

771 i‡(!
bf
->
bf_mpdu
)

772  
bf
;

779 
	`dma_sync_sögÀ_f‹_˝u
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

780 
comm⁄
->
rx_bufsize
,

781 
DMA_FROM_DEVICE
);

783  
bf
;

784 
	}
}

786 
	$©h9k_¥o˚ss_tsf
(
©h_rx_°©us
 *
rs
,

787 
õì80211_rx_°©us
 *
rxs
,

788 
u64
 
tsf
)

790 
u32
 
tsf_lowî
 = 
tsf
 & 0xffffffff;

792 
rxs
->
ma˘ime
 = (
tsf
 & ~0xffffffffULLË| 
rs
->
rs_t°amp
;

793 i‡(
rs
->
rs_t°amp
 > 
tsf_lowî
 &&

794 
	`u∆ikñy
(
rs
->
rs_t°amp
 - 
tsf_lowî
 > 0x10000000))

795 
rxs
->
ma˘ime
 -= 0x100000000ULL;

797 i‡(
rs
->
rs_t°amp
 < 
tsf_lowî
 &&

798 
	`u∆ikñy
(
tsf_lowî
 - 
rs
->
rs_t°amp
 > 0x10000000))

799 
rxs
->
ma˘ime
 += 0x100000000ULL;

800 
	}
}

807 
	$©h9k_rx_skb_¥ïro˚ss
(
©h_so·c
 *
sc
,

808 
sk_buff
 *
skb
,

809 
©h_rx_°©us
 *
rx_°©s
,

810 
õì80211_rx_°©us
 *
rx_°©us
,

811 
boﬁ
 *
de¸y±_îr‹
, 
u64
 
tsf
)

813 
õì80211_hw
 *
hw
 = 
sc
->hw;

814 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

815 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

816 
õì80211_hdr
 *
hdr
;

817 
boﬁ
 
disˇrd_cuºít
 = 
sc
->
rx
.
disˇrd_√xt
;

823 i‡(
disˇrd_cuºít
)

824 
c‹ru±
;

826 
sc
->
rx
.
disˇrd_√xt
 = 
Ál£
;

831 i‡(!
rx_°©s
->
rs_d©Æí
) {

832 
	`RX_STAT_INC
(
rx_Àn_îr
);

833 
c‹ru±
;

841 i‡(
rx_°©s
->
rs_d©Æí
 > (
comm⁄
->
rx_bufsize
 - 
ah
->
ˇps
.
rx_°©us_Àn
)) {

842 
	`RX_STAT_INC
(
rx_Àn_îr
);

843 
c‹ru±
;

847 i‡(
rx_°©s
->
rs_m‹e
)

857 i‡(
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_CORRUPT_DESC
)

858 
c‹ru±
;

860 
hdr
 = (
õì80211_hdr
 *Ë(
skb
->
d©a
 + 
ah
->
ˇps
.
rx_°©us_Àn
);

862 
	`©h9k_¥o˚ss_tsf
(
rx_°©s
, 
rx_°©us
, 
tsf
);

863 
	`©h_debug_°©_rx
(
sc
, 
rx_°©s
);

869 i‡(
rx_°©s
->
rs_°©us
 & 
ATH9K_RXERR_PHY
) {

870 
	`©h9k_dfs_¥o˚ss_phyîr
(
sc
, 
hdr
, 
rx_°©s
, 
rx_°©us
->
ma˘ime
);

871 i‡(
	`©h_cmn_¥o˚ss_f·
(&
sc
->
•ec_¥iv
, 
hdr
, 
rx_°©s
, 
rx_°©us
->
ma˘ime
))

872 
	`RX_STAT_INC
(
rx_•e˘øl
);

874  -
EINVAL
;

881 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

882 i‡(!
	`©h9k_cmn_rx_ac˚±
(
comm⁄
, 
hdr
, 
rx_°©us
, 
rx_°©s
, 
de¸y±_îr‹
,

883 
sc
->
cur_ch™
->
rxfûãr
)) {

884 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

885  -
EINVAL
;

887 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

889 i‡(
	`©h_is_mybóc⁄
(
comm⁄
, 
hdr
)) {

890 
	`RX_STAT_INC
(
rx_bóc⁄s
);

891 
rx_°©s
->
is_mybóc⁄
 = 
åue
;

897 i‡(
	`WARN_ON
(!
ah
->
curch™
))

898  -
EINVAL
;

900 i‡(
	`©h9k_cmn_¥o˚ss_øã
(
comm⁄
, 
hw
, 
rx_°©s
, 
rx_°©us
)) {

905 
	`©h_dbg
(
comm⁄
, 
ANY
, "unsupported hw bitrate detected 0x%02x using 1 Mbit\n",

906 
rx_°©s
->
rs_øã
);

907 
	`RX_STAT_INC
(
rx_øã_îr
);

908  -
EINVAL
;

911 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

912 i‡(
rx_°©s
->
is_mybóc⁄
)

913 
	`©h_ch™˘x_bóc⁄_ªcv_ev
(
sc
,

914 
ATH_CHANCTX_EVENT_BEACON_RECEIVED
);

917 
	`©h9k_cmn_¥o˚ss_rssi
(
comm⁄
, 
hw
, 
rx_°©s
, 
rx_°©us
);

919 
rx_°©us
->
b™d
 = 
ah
->
curch™
->
ch™
->band;

920 
rx_°©us
->
‰eq
 = 
ah
->
curch™
->
ch™
->
˚¡î_‰eq
;

921 
rx_°©us
->
™ã¬a
 = 
rx_°©s
->
rs_™ã¬a
;

922 
rx_°©us
->
Êag
 |
RX_FLAG_MACTIME_END
;

924 #ifde‡
CPTCFG_ATH9K_BTCOEX_SUPPORT


925 i‡(
	`õì80211_is_d©a_¥e£¡
(
hdr
->
‰ame_c⁄åﬁ
) &&

926 !
	`õì80211_is_qos_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
))

927 
sc
->
rx
.
num_pkts
++;

932 
c‹ru±
:

933 
sc
->
rx
.
disˇrd_√xt
 = 
rx_°©s
->
rs_m‹e
;

934  -
EINVAL
;

935 
	}
}

947 
	$©h9k_™ã¬a_check
(
©h_so·c
 *
sc
,

948 
©h_rx_°©us
 *
rs
)

950 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

951 
©h9k_hw_ˇ∑bûôõs
 *
pC≠
 = &
ah
->
ˇps
;

952 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

954 i‡(!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_ANT_DIV_COMB
))

961 i‡(
sc
->
rx
.
deÁ¡
 !
rs
->
rs_™ã¬a
) {

962 i‡(++
sc
->
rx
.
rxŸhî™t
 >= 3)

963 
	`©h_£tdeÁ¡í«
(
sc
, 
rs
->
rs_™ã¬a
);

965 
sc
->
rx
.
rxŸhî™t
 = 0;

968 i‡(
pC≠
->
hw_ˇps
 & 
ATH9K_HW_CAP_BT_ANT_DIV
) {

969 i‡(
comm⁄
->
bt_™t_divîsôy
)

970 
	`©h_™t_comb_sˇn
(
sc
, 
rs
);

972 
	`©h_™t_comb_sˇn
(
sc
, 
rs
);

974 
	}
}

976 
	$©h9k_≠∂y_ampdu_dëaûs
(
©h_so·c
 *
sc
,

977 
©h_rx_°©us
 *
rs
, 
õì80211_rx_°©us
 *
rxs
)

979 i‡(
rs
->
rs_ißggr
) {

980 
rxs
->
Êag
 |
RX_FLAG_AMPDU_DETAILS
 | 
RX_FLAG_AMPDU_LAST_KNOWN
;

982 
rxs
->
ampdu_ª„ªn˚
 = 
sc
->
rx
.
ampdu_ªf
;

984 i‡(!
rs
->
rs_m‹óggr
) {

985 
rxs
->
Êag
 |
RX_FLAG_AMPDU_IS_LAST
;

986 
sc
->
rx
.
ampdu_ªf
++;

989 i‡(
rs
->
rs_Êags
 & 
ATH9K_RX_DELIM_CRC_PRE
)

990 
rxs
->
Êag
 |
RX_FLAG_AMPDU_DELIM_CRC_ERROR
;

992 
	}
}

994 
	$©h_rx_èskÀt
(
©h_so·c
 *
sc
, 
Êush
, 
boﬁ
 
hp
)

996 
©h_rxbuf
 *
bf
;

997 
sk_buff
 *
skb
 = 
NULL
, *
ªqueue_skb
, *
hdr_skb
;

998 
õì80211_rx_°©us
 *
rxs
;

999 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1000 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1001 
õì80211_hw
 *
hw
 = 
sc
->hw;

1002 
ªtvÆ
;

1003 
©h_rx_°©us
 
rs
;

1004 
©h9k_rx_qty≥
 
qty≥
;

1005 
boﬁ
 
edma
 = !!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
);

1006 
dma_ty≥
;

1007 
u64
 
tsf
 = 0;

1008 
Êags
;

1009 
dma_addr_t
 
√w_buf_addr
;

1010 
budgë
 = 512;

1011 
õì80211_hdr
 *
hdr
;

1013 i‡(
edma
)

1014 
dma_ty≥
 = 
DMA_BIDIRECTIONAL
;

1016 
dma_ty≥
 = 
DMA_FROM_DEVICE
;

1018 
qty≥
 = 
hp
 ? 
ATH9K_RX_QUEUE_HP
 : 
ATH9K_RX_QUEUE_LP
;

1020 
tsf
 = 
	`©h9k_hw_gëtsf64
(
ah
);

1023 
boﬁ
 
de¸y±_îr‹
 = 
Ál£
;

1025 
	`mem£t
(&
rs
, 0, (rs));

1026 i‡(
edma
)

1027 
bf
 = 
	`©h_edma_gë_√xt_rx_buf
(
sc
, &
rs
, 
qty≥
);

1029 
bf
 = 
	`©h_gë_√xt_rx_buf
(
sc
, &
rs
);

1031 i‡(!
bf
)

1034 
skb
 = 
bf
->
bf_mpdu
;

1035 i‡(!
skb
)

1042 i‡(
sc
->
rx
.
‰ag
)

1043 
hdr_skb
 = 
sc
->
rx
.
‰ag
;

1045 
hdr_skb
 = 
skb
;

1047 
rxs
 = 
	`IEEE80211_SKB_RXCB
(
hdr_skb
);

1048 
	`mem£t
(
rxs
, 0, (
õì80211_rx_°©us
));

1050 
ªtvÆ
 = 
	`©h9k_rx_skb_¥ïro˚ss
(
sc
, 
hdr_skb
, &
rs
, 
rxs
,

1051 &
de¸y±_îr‹
, 
tsf
);

1052 i‡(
ªtvÆ
)

1053 
ªqueue_dr›_‰ag
;

1057 
ªqueue_skb
 = 
	`©h_rxbuf_Æloc
(
comm⁄
, comm⁄->
rx_bufsize
, 
GFP_ATOMIC
);

1063 i‡(!
ªqueue_skb
) {

1064 
	`RX_STAT_INC
(
rx_oom_îr
);

1065 
ªqueue_dr›_‰ag
;

1069 
√w_buf_addr
 = 
	`dma_m≠_sögÀ
(
sc
->
dev
, 
ªqueue_skb
->
d©a
,

1070 
comm⁄
->
rx_bufsize
, 
dma_ty≥
);

1071 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
sc
->
dev
, 
√w_buf_addr
))) {

1072 
	`dev_k‰ì_skb_™y
(
ªqueue_skb
);

1073 
ªqueue_dr›_‰ag
;

1077 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

1078 
comm⁄
->
rx_bufsize
, 
dma_ty≥
);

1080 
bf
->
bf_mpdu
 = 
ªqueue_skb
;

1081 
bf
->
bf_buf_addr
 = 
√w_buf_addr
;

1083 
	`skb_put
(
skb
, 
rs
.
rs_d©Æí
 + 
ah
->
ˇps
.
rx_°©us_Àn
);

1084 i‡(
ah
->
ˇps
.
rx_°©us_Àn
)

1085 
	`skb_puŒ
(
skb
, 
ah
->
ˇps
.
rx_°©us_Àn
);

1087 i‡(!
rs
.
rs_m‹e
)

1088 
	`©h9k_cmn_rx_skb_po°¥o˚ss
(
comm⁄
, 
hdr_skb
, &
rs
,

1089 
rxs
, 
de¸y±_îr‹
);

1091 i‡(
rs
.
rs_m‹e
) {

1092 
	`RX_STAT_INC
(
rx_‰ags
);

1098 i‡(
sc
->
rx
.
‰ag
) {

1100 
	`dev_k‰ì_skb_™y
(
sc
->
rx
.
‰ag
);

1101 
	`dev_k‰ì_skb_™y
(
skb
);

1102 
	`RX_STAT_INC
(
rx_too_m™y_‰ags_îr
);

1103 
skb
 = 
NULL
;

1105 
sc
->
rx
.
‰ag
 = 
skb
;

1106 
ªqueue
;

1109 i‡(
sc
->
rx
.
‰ag
) {

1110 
•a˚
 = 
skb
->
Àn
 - 
	`skb_èûroom
(
hdr_skb
);

1112 i‡(
	`pskb_ex∑nd_hód
(
hdr_skb
, 0, 
•a˚
, 
GFP_ATOMIC
) < 0) {

1113 
	`dev_k‰ì_skb
(
skb
);

1114 
	`RX_STAT_INC
(
rx_oom_îr
);

1115 
ªqueue_dr›_‰ag
;

1118 
sc
->
rx
.
‰ag
 = 
NULL
;

1120 
	`skb_c›y_‰om_löór_d©a
(
skb
, 
	`skb_put
(
hdr_skb
, skb->
Àn
),

1121 
skb
->
Àn
);

1122 
	`dev_k‰ì_skb_™y
(
skb
);

1123 
skb
 = 
hdr_skb
;

1126 i‡(
rxs
->
Êag
 & 
RX_FLAG_MMIC_STRIPPED
)

1127 
	`skb_åim
(
skb
, skb->
Àn
 - 8);

1129 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

1130 i‡((
sc
->
ps_Êags
 & (
PS_WAIT_FOR_BEACON
 |

1131 
PS_WAIT_FOR_CAB
 |

1132 
PS_WAIT_FOR_PSPOLL_DATA
)) ||

1133 
	`©h9k_check_auto_¶ìp
(
sc
))

1134 
	`©h_rx_ps
(
sc
, 
skb
, 
rs
.
is_mybóc⁄
);

1135 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

1137 
	`©h9k_™ã¬a_check
(
sc
, &
rs
);

1138 
	`©h9k_≠∂y_ampdu_dëaûs
(
sc
, &
rs
, 
rxs
);

1139 
	`©h_debug_øã_°©s
(
sc
, &
rs
, 
skb
);

1141 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1142 i‡(
	`õì80211_is_ack
(
hdr
->
‰ame_c⁄åﬁ
))

1143 
	`©h_dy«ck_ßm∂e_ack_ts
(
sc
->
sc_ah
, 
skb
, 
rs
.
rs_t°amp
);

1145 
	`õì80211_rx
(
hw
, 
skb
);

1147 
ªqueue_dr›_‰ag
:

1148 i‡(
sc
->
rx
.
‰ag
) {

1149 
	`dev_k‰ì_skb_™y
(
sc
->
rx
.
‰ag
);

1150 
sc
->
rx
.
‰ag
 = 
NULL
;

1152 
ªqueue
:

1153 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
rx
.
rxbuf
);

1155 i‡(!
edma
) {

1156 
	`©h_rx_buf_ªlök
(
sc
, 
bf
, 
Êush
);

1157 i‡(!
Êush
)

1158 
	`©h9k_hw_rxía
(
ah
);

1159 } i‡(!
Êush
) {

1160 
	`©h_rx_edma_buf_lök
(
sc
, 
qty≥
);

1163 i‡(!
budgë
--)

1167 i‡(!(
ah
->
imask
 & 
ATH9K_INT_RXEOL
)) {

1168 
ah
->
imask
 |(
ATH9K_INT_RXEOL
 | 
ATH9K_INT_RXORN
);

1169 
	`©h9k_hw_£t_öãºu±s
(
ah
);

1173 
	}
}

	@reg.h

17 #i‚de‡
REG_H


18 
	#REG_H


	)

20 
	~"../ªg.h
"

22 
	#AR_CR
 0x0008

	)

23 
	#AR_CR_RXE
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x0000000¯: 0x00000004)

	)

24 
	#AR_CR_RXD
 0x00000020

	)

25 
	#AR_CR_SWI
 0x00000040

	)

27 
	#AR_RXDP
 0x000C

	)

29 
	#AR_CFG
 0x0014

	)

30 
	#AR_CFG_SWTD
 0x00000001

	)

31 
	#AR_CFG_SWTB
 0x00000002

	)

32 
	#AR_CFG_SWRD
 0x00000004

	)

33 
	#AR_CFG_SWRB
 0x00000008

	)

34 
	#AR_CFG_SWRG
 0x00000010

	)

35 
	#AR_CFG_AP_ADHOC_INDICATION
 0x00000020

	)

36 
	#AR_CFG_PHOK
 0x00000100

	)

37 
	#AR_CFG_EEBS
 0x00000200

	)

38 
	#AR_CFG_CLK_GATE_DIS
 0x00000400

	)

39 
	#AR_CFG_HALT_REQ
 0x00000800

	)

40 
	#AR_CFG_HALT_ACK
 0x00001000

	)

41 
	#AR_CFG_PCI_MASTER_REQ_Q_THRESH
 0x00060000

	)

42 
	#AR_CFG_PCI_MASTER_REQ_Q_THRESH_S
 17

	)

44 
	#AR_RXBP_THRESH
 0x0018

	)

45 
	#AR_RXBP_THRESH_HP
 0x0000000f

	)

46 
	#AR_RXBP_THRESH_HP_S
 0

	)

47 
	#AR_RXBP_THRESH_LP
 0x00003f00

	)

48 
	#AR_RXBP_THRESH_LP_S
 8

	)

50 
	#AR_MIRT
 0x0020

	)

51 
	#AR_MIRT_VAL
 0x0000ffff

	)

52 
	#AR_MIRT_VAL_S
 16

	)

54 
	#AR_IER
 0x0024

	)

55 
	#AR_IER_ENABLE
 0x00000001

	)

56 
	#AR_IER_DISABLE
 0x00000000

	)

58 
	#AR_TIMT
 0x0028

	)

59 
	#AR_TIMT_LAST
 0x0000ffff

	)

60 
	#AR_TIMT_LAST_S
 0

	)

61 
	#AR_TIMT_FIRST
 0xffff0000

	)

62 
	#AR_TIMT_FIRST_S
 16

	)

64 
	#AR_RIMT
 0x002C

	)

65 
	#AR_RIMT_LAST
 0x0000ffff

	)

66 
	#AR_RIMT_LAST_S
 0

	)

67 
	#AR_RIMT_FIRST
 0xffff0000

	)

68 
	#AR_RIMT_FIRST_S
 16

	)

70 
	#AR_DMASIZE_4B
 0x00000000

	)

71 
	#AR_DMASIZE_8B
 0x00000001

	)

72 
	#AR_DMASIZE_16B
 0x00000002

	)

73 
	#AR_DMASIZE_32B
 0x00000003

	)

74 
	#AR_DMASIZE_64B
 0x00000004

	)

75 
	#AR_DMASIZE_128B
 0x00000005

	)

76 
	#AR_DMASIZE_256B
 0x00000006

	)

77 
	#AR_DMASIZE_512B
 0x00000007

	)

79 
	#AR_TXCFG
 0x0030

	)

80 
	#AR_TXCFG_DMASZ_MASK
 0x00000007

	)

81 
	#AR_TXCFG_DMASZ_4B
 0

	)

82 
	#AR_TXCFG_DMASZ_8B
 1

	)

83 
	#AR_TXCFG_DMASZ_16B
 2

	)

84 
	#AR_TXCFG_DMASZ_32B
 3

	)

85 
	#AR_TXCFG_DMASZ_64B
 4

	)

86 
	#AR_TXCFG_DMASZ_128B
 5

	)

87 
	#AR_TXCFG_DMASZ_256B
 6

	)

88 
	#AR_TXCFG_DMASZ_512B
 7

	)

89 
	#AR_FTRIG
 0x000003F0

	)

90 
	#AR_FTRIG_S
 4

	)

91 
	#AR_FTRIG_IMMED
 0x00000000

	)

92 
	#AR_FTRIG_64B
 0x00000010

	)

93 
	#AR_FTRIG_128B
 0x00000020

	)

94 
	#AR_FTRIG_192B
 0x00000030

	)

95 
	#AR_FTRIG_256B
 0x00000040

	)

96 
	#AR_FTRIG_512B
 0x00000080

	)

97 
	#AR_TXCFG_ADHOC_BEACON_ATIM_TX_POLICY
 0x00000800

	)

99 
	#AR_RXCFG
 0x0034

	)

100 
	#AR_RXCFG_CHIRP
 0x00000008

	)

101 
	#AR_RXCFG_ZLFDMA
 0x00000010

	)

102 
	#AR_RXCFG_DMASZ_MASK
 0x00000007

	)

103 
	#AR_RXCFG_DMASZ_4B
 0

	)

104 
	#AR_RXCFG_DMASZ_8B
 1

	)

105 
	#AR_RXCFG_DMASZ_16B
 2

	)

106 
	#AR_RXCFG_DMASZ_32B
 3

	)

107 
	#AR_RXCFG_DMASZ_64B
 4

	)

108 
	#AR_RXCFG_DMASZ_128B
 5

	)

109 
	#AR_RXCFG_DMASZ_256B
 6

	)

110 
	#AR_RXCFG_DMASZ_512B
 7

	)

112 
	#AR_TOPS
 0x0044

	)

113 
	#AR_TOPS_MASK
 0x0000FFFF

	)

115 
	#AR_RXNPTO
 0x0048

	)

116 
	#AR_RXNPTO_MASK
 0x000003FF

	)

118 
	#AR_TXNPTO
 0x004C

	)

119 
	#AR_TXNPTO_MASK
 0x000003FF

	)

120 
	#AR_TXNPTO_QCU_MASK
 0x000FFC00

	)

122 
	#AR_RPGTO
 0x0050

	)

123 
	#AR_RPGTO_MASK
 0x000003FF

	)

125 
	#AR_RPCNT
 0x0054

	)

126 
	#AR_RPCNT_MASK
 0x0000001F

	)

128 
	#AR_MACMISC
 0x0058

	)

129 
	#AR_MACMISC_PCI_EXT_FORCE
 0x00000010

	)

130 
	#AR_MACMISC_DMA_OBS
 0x000001E0

	)

131 
	#AR_MACMISC_DMA_OBS_S
 5

	)

132 
	#AR_MACMISC_DMA_OBS_LINE_0
 0

	)

133 
	#AR_MACMISC_DMA_OBS_LINE_1
 1

	)

134 
	#AR_MACMISC_DMA_OBS_LINE_2
 2

	)

135 
	#AR_MACMISC_DMA_OBS_LINE_3
 3

	)

136 
	#AR_MACMISC_DMA_OBS_LINE_4
 4

	)

137 
	#AR_MACMISC_DMA_OBS_LINE_5
 5

	)

138 
	#AR_MACMISC_DMA_OBS_LINE_6
 6

	)

139 
	#AR_MACMISC_DMA_OBS_LINE_7
 7

	)

140 
	#AR_MACMISC_DMA_OBS_LINE_8
 8

	)

141 
	#AR_MACMISC_MISC_OBS
 0x00000E00

	)

142 
	#AR_MACMISC_MISC_OBS_S
 9

	)

143 
	#AR_MACMISC_MISC_OBS_BUS_LSB
 0x00007000

	)

144 
	#AR_MACMISC_MISC_OBS_BUS_LSB_S
 12

	)

145 
	#AR_MACMISC_MISC_OBS_BUS_MSB
 0x00038000

	)

146 
	#AR_MACMISC_MISC_OBS_BUS_MSB_S
 15

	)

147 
	#AR_MACMISC_MISC_OBS_BUS_1
 1

	)

149 
	#AR_DATABUF_SIZE
 0x0060

	)

150 
	#AR_DATABUF_SIZE_MASK
 0x00000FFF

	)

152 
	#AR_GTXTO
 0x0064

	)

153 
	#AR_GTXTO_TIMEOUT_COUNTER
 0x0000FFFF

	)

154 
	#AR_GTXTO_TIMEOUT_LIMIT
 0xFFFF0000

	)

155 
	#AR_GTXTO_TIMEOUT_LIMIT_S
 16

	)

157 
	#AR_GTTM
 0x0068

	)

158 
	#AR_GTTM_USEC
 0x00000001

	)

159 
	#AR_GTTM_IGNORE_IDLE
 0x00000002

	)

160 
	#AR_GTTM_RESET_IDLE
 0x00000004

	)

161 
	#AR_GTTM_CST_USEC
 0x00000008

	)

163 
	#AR_CST
 0x006C

	)

164 
	#AR_CST_TIMEOUT_COUNTER
 0x0000FFFF

	)

165 
	#AR_CST_TIMEOUT_LIMIT
 0xFFFF0000

	)

166 
	#AR_CST_TIMEOUT_LIMIT_S
 16

	)

168 
	#AR_HP_RXDP
 0x0074

	)

169 
	#AR_LP_RXDP
 0x0078

	)

171 
	#AR_ISR
 0x0080

	)

172 
	#AR_ISR_RXOK
 0x00000001

	)

173 
	#AR_ISR_RXDESC
 0x00000002

	)

174 
	#AR_ISR_HP_RXOK
 0x00000001

	)

175 
	#AR_ISR_LP_RXOK
 0x00000002

	)

176 
	#AR_ISR_RXERR
 0x00000004

	)

177 
	#AR_ISR_RXNOPKT
 0x00000008

	)

178 
	#AR_ISR_RXEOL
 0x00000010

	)

179 
	#AR_ISR_RXORN
 0x00000020

	)

180 
	#AR_ISR_TXOK
 0x00000040

	)

181 
	#AR_ISR_TXDESC
 0x00000080

	)

182 
	#AR_ISR_TXERR
 0x00000100

	)

183 
	#AR_ISR_TXNOPKT
 0x00000200

	)

184 
	#AR_ISR_TXEOL
 0x00000400

	)

185 
	#AR_ISR_TXURN
 0x00000800

	)

186 
	#AR_ISR_MIB
 0x00001000

	)

187 
	#AR_ISR_SWI
 0x00002000

	)

188 
	#AR_ISR_RXPHY
 0x00004000

	)

189 
	#AR_ISR_RXKCM
 0x00008000

	)

190 
	#AR_ISR_SWBA
 0x00010000

	)

191 
	#AR_ISR_BRSSI
 0x00020000

	)

192 
	#AR_ISR_BMISS
 0x00040000

	)

193 
	#AR_ISR_BNR
 0x00100000

	)

194 
	#AR_ISR_RXCHIRP
 0x00200000

	)

195 
	#AR_ISR_BCNMISC
 0x00800000

	)

196 
	#AR_ISR_TIM
 0x00800000

	)

197 
	#AR_ISR_QCBROVF
 0x02000000

	)

198 
	#AR_ISR_QCBRURN
 0x04000000

	)

199 
	#AR_ISR_QTRIG
 0x08000000

	)

200 
	#AR_ISR_GENTMR
 0x10000000

	)

202 
	#AR_ISR_TXMINTR
 0x00080000

	)

203 
	#AR_ISR_RXMINTR
 0x01000000

	)

204 
	#AR_ISR_TXINTM
 0x40000000

	)

205 
	#AR_ISR_RXINTM
 0x80000000

	)

207 
	#AR_ISR_S0
 0x0084

	)

208 
	#AR_ISR_S0_QCU_TXOK
 0x000003FF

	)

209 
	#AR_ISR_S0_QCU_TXOK_S
 0

	)

210 
	#AR_ISR_S0_QCU_TXDESC
 0x03FF0000

	)

211 
	#AR_ISR_S0_QCU_TXDESC_S
 16

	)

213 
	#AR_ISR_S1
 0x0088

	)

214 
	#AR_ISR_S1_QCU_TXERR
 0x000003FF

	)

215 
	#AR_ISR_S1_QCU_TXERR_S
 0

	)

216 
	#AR_ISR_S1_QCU_TXEOL
 0x03FF0000

	)

217 
	#AR_ISR_S1_QCU_TXEOL_S
 16

	)

219 
	#AR_ISR_S2
 0x008c

	)

220 
	#AR_ISR_S2_QCU_TXURN
 0x000003FF

	)

221 
	#AR_ISR_S2_BB_WATCHDOG
 0x00010000

	)

222 
	#AR_ISR_S2_CST
 0x00400000

	)

223 
	#AR_ISR_S2_GTT
 0x00800000

	)

224 
	#AR_ISR_S2_TIM
 0x01000000

	)

225 
	#AR_ISR_S2_CABEND
 0x02000000

	)

226 
	#AR_ISR_S2_DTIMSYNC
 0x04000000

	)

227 
	#AR_ISR_S2_BCNTO
 0x08000000

	)

228 
	#AR_ISR_S2_CABTO
 0x10000000

	)

229 
	#AR_ISR_S2_DTIM
 0x20000000

	)

230 
	#AR_ISR_S2_TSFOOR
 0x40000000

	)

231 
	#AR_ISR_S2_TBTT_TIME
 0x80000000

	)

233 
	#AR_ISR_S3
 0x0090

	)

234 
	#AR_ISR_S3_QCU_QCBROVF
 0x000003FF

	)

235 
	#AR_ISR_S3_QCU_QCBRURN
 0x03FF0000

	)

237 
	#AR_ISR_S4
 0x0094

	)

238 
	#AR_ISR_S4_QCU_QTRIG
 0x000003FF

	)

239 
	#AR_ISR_S4_RESV0
 0xFFFFFC00

	)

241 
	#AR_ISR_S5
 0x0098

	)

242 
	#AR_ISR_S5_TIMER_TRIG
 0x000000FF

	)

243 
	#AR_ISR_S5_TIMER_THRESH
 0x0007FE00

	)

244 
	#AR_ISR_S5_TIM_TIMER
 0x00000010

	)

245 
	#AR_ISR_S5_DTIM_TIMER
 0x00000020

	)

246 
	#AR_IMR_S5
 0x00b8

	)

247 
	#AR_IMR_S5_TIM_TIMER
 0x00000010

	)

248 
	#AR_IMR_S5_DTIM_TIMER
 0x00000020

	)

249 
	#AR_ISR_S5_GENTIMER_TRIG
 0x0000FF80

	)

250 
	#AR_ISR_S5_GENTIMER_TRIG_S
 0

	)

251 
	#AR_ISR_S5_GENTIMER_THRESH
 0xFF800000

	)

252 
	#AR_ISR_S5_GENTIMER_THRESH_S
 16

	)

253 
	#AR_IMR_S5_GENTIMER_TRIG
 0x0000FF80

	)

254 
	#AR_IMR_S5_GENTIMER_TRIG_S
 0

	)

255 
	#AR_IMR_S5_GENTIMER_THRESH
 0xFF800000

	)

256 
	#AR_IMR_S5_GENTIMER_THRESH_S
 16

	)

258 
	#AR_IMR
 0x00a0

	)

259 
	#AR_IMR_RXOK
 0x00000001

	)

260 
	#AR_IMR_RXDESC
 0x00000002

	)

261 
	#AR_IMR_RXOK_HP
 0x00000001

	)

262 
	#AR_IMR_RXOK_LP
 0x00000002

	)

263 
	#AR_IMR_RXERR
 0x00000004

	)

264 
	#AR_IMR_RXNOPKT
 0x00000008

	)

265 
	#AR_IMR_RXEOL
 0x00000010

	)

266 
	#AR_IMR_RXORN
 0x00000020

	)

267 
	#AR_IMR_TXOK
 0x00000040

	)

268 
	#AR_IMR_TXDESC
 0x00000080

	)

269 
	#AR_IMR_TXERR
 0x00000100

	)

270 
	#AR_IMR_TXNOPKT
 0x00000200

	)

271 
	#AR_IMR_TXEOL
 0x00000400

	)

272 
	#AR_IMR_TXURN
 0x00000800

	)

273 
	#AR_IMR_MIB
 0x00001000

	)

274 
	#AR_IMR_SWI
 0x00002000

	)

275 
	#AR_IMR_RXPHY
 0x00004000

	)

276 
	#AR_IMR_RXKCM
 0x00008000

	)

277 
	#AR_IMR_SWBA
 0x00010000

	)

278 
	#AR_IMR_BRSSI
 0x00020000

	)

279 
	#AR_IMR_BMISS
 0x00040000

	)

280 
	#AR_IMR_BNR
 0x00100000

	)

281 
	#AR_IMR_RXCHIRP
 0x00200000

	)

282 
	#AR_IMR_BCNMISC
 0x00800000

	)

283 
	#AR_IMR_TIM
 0x00800000

	)

284 
	#AR_IMR_QCBROVF
 0x02000000

	)

285 
	#AR_IMR_QCBRURN
 0x04000000

	)

286 
	#AR_IMR_QTRIG
 0x08000000

	)

287 
	#AR_IMR_GENTMR
 0x10000000

	)

289 
	#AR_IMR_TXMINTR
 0x00080000

	)

290 
	#AR_IMR_RXMINTR
 0x01000000

	)

291 
	#AR_IMR_TXINTM
 0x40000000

	)

292 
	#AR_IMR_RXINTM
 0x80000000

	)

294 
	#AR_IMR_S0
 0x00a4

	)

295 
	#AR_IMR_S0_QCU_TXOK
 0x000003FF

	)

296 
	#AR_IMR_S0_QCU_TXOK_S
 0

	)

297 
	#AR_IMR_S0_QCU_TXDESC
 0x03FF0000

	)

298 
	#AR_IMR_S0_QCU_TXDESC_S
 16

	)

300 
	#AR_IMR_S1
 0x00a8

	)

301 
	#AR_IMR_S1_QCU_TXERR
 0x000003FF

	)

302 
	#AR_IMR_S1_QCU_TXERR_S
 0

	)

303 
	#AR_IMR_S1_QCU_TXEOL
 0x03FF0000

	)

304 
	#AR_IMR_S1_QCU_TXEOL_S
 16

	)

306 
	#AR_IMR_S2
 0x00ac

	)

307 
	#AR_IMR_S2_QCU_TXURN
 0x000003FF

	)

308 
	#AR_IMR_S2_QCU_TXURN_S
 0

	)

309 
	#AR_IMR_S2_BB_WATCHDOG
 0x00010000

	)

310 
	#AR_IMR_S2_CST
 0x00400000

	)

311 
	#AR_IMR_S2_GTT
 0x00800000

	)

312 
	#AR_IMR_S2_TIM
 0x01000000

	)

313 
	#AR_IMR_S2_CABEND
 0x02000000

	)

314 
	#AR_IMR_S2_DTIMSYNC
 0x04000000

	)

315 
	#AR_IMR_S2_BCNTO
 0x08000000

	)

316 
	#AR_IMR_S2_CABTO
 0x10000000

	)

317 
	#AR_IMR_S2_DTIM
 0x20000000

	)

318 
	#AR_IMR_S2_TSFOOR
 0x40000000

	)

320 
	#AR_IMR_S3
 0x00b0

	)

321 
	#AR_IMR_S3_QCU_QCBROVF
 0x000003FF

	)

322 
	#AR_IMR_S3_QCU_QCBRURN
 0x03FF0000

	)

323 
	#AR_IMR_S3_QCU_QCBRURN_S
 16

	)

325 
	#AR_IMR_S4
 0x00b4

	)

326 
	#AR_IMR_S4_QCU_QTRIG
 0x000003FF

	)

327 
	#AR_IMR_S4_RESV0
 0xFFFFFC00

	)

329 
	#AR_IMR_S5
 0x00b8

	)

330 
	#AR_IMR_S5_TIMER_TRIG
 0x000000FF

	)

331 
	#AR_IMR_S5_TIMER_THRESH
 0x0000FF00

	)

334 
	#AR_ISR_RAC
 0x00c0

	)

335 
	#AR_ISR_S0_S
 0x00c4

	)

336 
	#AR_ISR_S0_QCU_TXOK
 0x000003FF

	)

337 
	#AR_ISR_S0_QCU_TXOK_S
 0

	)

338 
	#AR_ISR_S0_QCU_TXDESC
 0x03FF0000

	)

339 
	#AR_ISR_S0_QCU_TXDESC_S
 16

	)

341 
	#AR_ISR_S1_S
 0x00c8

	)

342 
	#AR_ISR_S1_QCU_TXERR
 0x000003FF

	)

343 
	#AR_ISR_S1_QCU_TXERR_S
 0

	)

344 
	#AR_ISR_S1_QCU_TXEOL
 0x03FF0000

	)

345 
	#AR_ISR_S1_QCU_TXEOL_S
 16

	)

347 
	#AR_ISR_S2_S
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x00d0 : 0x00cc)

	)

348 
	#AR_ISR_S3_S
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x00d4 : 0x00d0)

	)

349 
	#AR_ISR_S4_S
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x00d8 : 0x00d4)

	)

350 
	#AR_ISR_S5_S
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x00d¯: 0x00d8)

	)

351 
	#AR_DMADBG_0
 0x00e0

	)

352 
	#AR_DMADBG_1
 0x00e4

	)

353 
	#AR_DMADBG_2
 0x00e8

	)

354 
	#AR_DMADBG_3
 0x00ec

	)

355 
	#AR_DMADBG_4
 0x00f0

	)

356 
	#AR_DMADBG_5
 0x00f4

	)

357 
	#AR_DMADBG_6
 0x00f8

	)

358 
	#AR_DMADBG_7
 0x00fc

	)

360 
	#AR_NUM_QCU
 10

	)

361 
	#AR_QCU_0
 0x0001

	)

362 
	#AR_QCU_1
 0x0002

	)

363 
	#AR_QCU_2
 0x0004

	)

364 
	#AR_QCU_3
 0x0008

	)

365 
	#AR_QCU_4
 0x0010

	)

366 
	#AR_QCU_5
 0x0020

	)

367 
	#AR_QCU_6
 0x0040

	)

368 
	#AR_QCU_7
 0x0080

	)

369 
	#AR_QCU_8
 0x0100

	)

370 
	#AR_QCU_9
 0x0200

	)

372 
	#AR_Q0_TXDP
 0x0800

	)

373 
	#AR_Q1_TXDP
 0x0804

	)

374 
	#AR_Q2_TXDP
 0x0808

	)

375 
	#AR_Q3_TXDP
 0x080c

	)

376 
	#AR_Q4_TXDP
 0x0810

	)

377 
	#AR_Q5_TXDP
 0x0814

	)

378 
	#AR_Q6_TXDP
 0x0818

	)

379 
	#AR_Q7_TXDP
 0x081c

	)

380 
	#AR_Q8_TXDP
 0x0820

	)

381 
	#AR_Q9_TXDP
 0x0824

	)

382 
	#AR_QTXDP
(
_i
Ë(
AR_Q0_TXDP
 + ((_i)<<2))

	)

384 
	#AR_Q_STATUS_RING_START
 0x830

	)

385 
	#AR_Q_STATUS_RING_END
 0x834

	)

387 
	#AR_Q_TXE
 0x0840

	)

388 
	#AR_Q_TXE_M
 0x000003FF

	)

390 
	#AR_Q_TXD
 0x0880

	)

391 
	#AR_Q_TXD_M
 0x000003FF

	)

393 
	#AR_Q0_CBRCFG
 0x08c0

	)

394 
	#AR_Q1_CBRCFG
 0x08c4

	)

395 
	#AR_Q2_CBRCFG
 0x08c8

	)

396 
	#AR_Q3_CBRCFG
 0x08cc

	)

397 
	#AR_Q4_CBRCFG
 0x08d0

	)

398 
	#AR_Q5_CBRCFG
 0x08d4

	)

399 
	#AR_Q6_CBRCFG
 0x08d8

	)

400 
	#AR_Q7_CBRCFG
 0x08dc

	)

401 
	#AR_Q8_CBRCFG
 0x08e0

	)

402 
	#AR_Q9_CBRCFG
 0x08e4

	)

403 
	#AR_QCBRCFG
(
_i
Ë(
AR_Q0_CBRCFG
 + ((_i)<<2))

	)

404 
	#AR_Q_CBRCFG_INTERVAL
 0x00FFFFFF

	)

405 
	#AR_Q_CBRCFG_INTERVAL_S
 0

	)

406 
	#AR_Q_CBRCFG_OVF_THRESH
 0xFF000000

	)

407 
	#AR_Q_CBRCFG_OVF_THRESH_S
 24

	)

409 
	#AR_Q0_RDYTIMECFG
 0x0900

	)

410 
	#AR_Q1_RDYTIMECFG
 0x0904

	)

411 
	#AR_Q2_RDYTIMECFG
 0x0908

	)

412 
	#AR_Q3_RDYTIMECFG
 0x090c

	)

413 
	#AR_Q4_RDYTIMECFG
 0x0910

	)

414 
	#AR_Q5_RDYTIMECFG
 0x0914

	)

415 
	#AR_Q6_RDYTIMECFG
 0x0918

	)

416 
	#AR_Q7_RDYTIMECFG
 0x091c

	)

417 
	#AR_Q8_RDYTIMECFG
 0x0920

	)

418 
	#AR_Q9_RDYTIMECFG
 0x0924

	)

419 
	#AR_QRDYTIMECFG
(
_i
Ë(
AR_Q0_RDYTIMECFG
 + ((_i)<<2))

	)

420 
	#AR_Q_RDYTIMECFG_DURATION
 0x00FFFFFF

	)

421 
	#AR_Q_RDYTIMECFG_DURATION_S
 0

	)

422 
	#AR_Q_RDYTIMECFG_EN
 0x01000000

	)

424 
	#AR_Q_ONESHOTARM_SC
 0x0940

	)

425 
	#AR_Q_ONESHOTARM_SC_M
 0x000003FF

	)

426 
	#AR_Q_ONESHOTARM_SC_RESV0
 0xFFFFFC00

	)

428 
	#AR_Q_ONESHOTARM_CC
 0x0980

	)

429 
	#AR_Q_ONESHOTARM_CC_M
 0x000003FF

	)

430 
	#AR_Q_ONESHOTARM_CC_RESV0
 0xFFFFFC00

	)

432 
	#AR_Q0_MISC
 0x09c0

	)

433 
	#AR_Q1_MISC
 0x09c4

	)

434 
	#AR_Q2_MISC
 0x09c8

	)

435 
	#AR_Q3_MISC
 0x09cc

	)

436 
	#AR_Q4_MISC
 0x09d0

	)

437 
	#AR_Q5_MISC
 0x09d4

	)

438 
	#AR_Q6_MISC
 0x09d8

	)

439 
	#AR_Q7_MISC
 0x09dc

	)

440 
	#AR_Q8_MISC
 0x09e0

	)

441 
	#AR_Q9_MISC
 0x09e4

	)

442 
	#AR_QMISC
(
_i
Ë(
AR_Q0_MISC
 + ((_i)<<2))

	)

443 
	#AR_Q_MISC_FSP
 0x0000000F

	)

444 
	#AR_Q_MISC_FSP_ASAP
 0

	)

445 
	#AR_Q_MISC_FSP_CBR
 1

	)

446 
	#AR_Q_MISC_FSP_DBA_GATED
 2

	)

447 
	#AR_Q_MISC_FSP_TIM_GATED
 3

	)

448 
	#AR_Q_MISC_FSP_BEACON_SENT_GATED
 4

	)

449 
	#AR_Q_MISC_FSP_BEACON_RCVD_GATED
 5

	)

450 
	#AR_Q_MISC_ONE_SHOT_EN
 0x00000010

	)

451 
	#AR_Q_MISC_CBR_INCR_DIS1
 0x00000020

	)

452 
	#AR_Q_MISC_CBR_INCR_DIS0
 0x00000040

	)

453 
	#AR_Q_MISC_BEACON_USE
 0x00000080

	)

454 
	#AR_Q_MISC_CBR_EXP_CNTR_LIMIT_EN
 0x00000100

	)

455 
	#AR_Q_MISC_RDYTIME_EXP_POLICY
 0x00000200

	)

456 
	#AR_Q_MISC_RESET_CBR_EXP_CTR
 0x00000400

	)

457 
	#AR_Q_MISC_DCU_EARLY_TERM_REQ
 0x00000800

	)

458 
	#AR_Q_MISC_RESV0
 0xFFFFF000

	)

460 
	#AR_Q0_STS
 0x0a00

	)

461 
	#AR_Q1_STS
 0x0a04

	)

462 
	#AR_Q2_STS
 0x0a08

	)

463 
	#AR_Q3_STS
 0x0a0c

	)

464 
	#AR_Q4_STS
 0x0a10

	)

465 
	#AR_Q5_STS
 0x0a14

	)

466 
	#AR_Q6_STS
 0x0a18

	)

467 
	#AR_Q7_STS
 0x0a1c

	)

468 
	#AR_Q8_STS
 0x0a20

	)

469 
	#AR_Q9_STS
 0x0a24

	)

470 
	#AR_QSTS
(
_i
Ë(
AR_Q0_STS
 + ((_i)<<2))

	)

471 
	#AR_Q_STS_PEND_FR_CNT
 0x00000003

	)

472 
	#AR_Q_STS_RESV0
 0x000000FC

	)

473 
	#AR_Q_STS_CBR_EXP_CNT
 0x0000FF00

	)

474 
	#AR_Q_STS_RESV1
 0xFFFF0000

	)

476 
	#AR_Q_RDYTIMESHDN
 0x0a40

	)

477 
	#AR_Q_RDYTIMESHDN_M
 0x000003FF

	)

480 
	#AR_Q_DESC_CRCCHK
 0xa44

	)

482 
	#AR_Q_DESC_CRCCHK_EN
 1

	)

484 
	#AR_NUM_DCU
 10

	)

485 
	#AR_DCU_0
 0x0001

	)

486 
	#AR_DCU_1
 0x0002

	)

487 
	#AR_DCU_2
 0x0004

	)

488 
	#AR_DCU_3
 0x0008

	)

489 
	#AR_DCU_4
 0x0010

	)

490 
	#AR_DCU_5
 0x0020

	)

491 
	#AR_DCU_6
 0x0040

	)

492 
	#AR_DCU_7
 0x0080

	)

493 
	#AR_DCU_8
 0x0100

	)

494 
	#AR_DCU_9
 0x0200

	)

496 
	#AR_D0_QCUMASK
 0x1000

	)

497 
	#AR_D1_QCUMASK
 0x1004

	)

498 
	#AR_D2_QCUMASK
 0x1008

	)

499 
	#AR_D3_QCUMASK
 0x100c

	)

500 
	#AR_D4_QCUMASK
 0x1010

	)

501 
	#AR_D5_QCUMASK
 0x1014

	)

502 
	#AR_D6_QCUMASK
 0x1018

	)

503 
	#AR_D7_QCUMASK
 0x101c

	)

504 
	#AR_D8_QCUMASK
 0x1020

	)

505 
	#AR_D9_QCUMASK
 0x1024

	)

506 
	#AR_DQCUMASK
(
_i
Ë(
AR_D0_QCUMASK
 + ((_i)<<2))

	)

507 
	#AR_D_QCUMASK
 0x000003FF

	)

508 
	#AR_D_QCUMASK_RESV0
 0xFFFFFC00

	)

510 
	#AR_D0_LCL_IFS
 0x1040

	)

511 
	#AR_D1_LCL_IFS
 0x1044

	)

512 
	#AR_D2_LCL_IFS
 0x1048

	)

513 
	#AR_D3_LCL_IFS
 0x104c

	)

514 
	#AR_D4_LCL_IFS
 0x1050

	)

515 
	#AR_D5_LCL_IFS
 0x1054

	)

516 
	#AR_D6_LCL_IFS
 0x1058

	)

517 
	#AR_D7_LCL_IFS
 0x105c

	)

518 
	#AR_D8_LCL_IFS
 0x1060

	)

519 
	#AR_D9_LCL_IFS
 0x1064

	)

520 
	#AR_DLCL_IFS
(
_i
Ë(
AR_D0_LCL_IFS
 + ((_i)<<2))

	)

521 
	#AR_D_LCL_IFS_CWMIN
 0x000003FF

	)

522 
	#AR_D_LCL_IFS_CWMIN_S
 0

	)

523 
	#AR_D_LCL_IFS_CWMAX
 0x000FFC00

	)

524 
	#AR_D_LCL_IFS_CWMAX_S
 10

	)

525 
	#AR_D_LCL_IFS_AIFS
 0x0FF00000

	)

526 
	#AR_D_LCL_IFS_AIFS_S
 20

	)

528 
	#AR_D_LCL_IFS_RESV0
 0xF0000000

	)

530 
	#AR_D0_RETRY_LIMIT
 0x1080

	)

531 
	#AR_D1_RETRY_LIMIT
 0x1084

	)

532 
	#AR_D2_RETRY_LIMIT
 0x1088

	)

533 
	#AR_D3_RETRY_LIMIT
 0x108c

	)

534 
	#AR_D4_RETRY_LIMIT
 0x1090

	)

535 
	#AR_D5_RETRY_LIMIT
 0x1094

	)

536 
	#AR_D6_RETRY_LIMIT
 0x1098

	)

537 
	#AR_D7_RETRY_LIMIT
 0x109c

	)

538 
	#AR_D8_RETRY_LIMIT
 0x10a0

	)

539 
	#AR_D9_RETRY_LIMIT
 0x10a4

	)

540 
	#AR_DRETRY_LIMIT
(
_i
Ë(
AR_D0_RETRY_LIMIT
 + ((_i)<<2))

	)

541 
	#AR_D_RETRY_LIMIT_FR_SH
 0x0000000F

	)

542 
	#AR_D_RETRY_LIMIT_FR_SH_S
 0

	)

543 
	#AR_D_RETRY_LIMIT_STA_SH
 0x00003F00

	)

544 
	#AR_D_RETRY_LIMIT_STA_SH_S
 8

	)

545 
	#AR_D_RETRY_LIMIT_STA_LG
 0x000FC000

	)

546 
	#AR_D_RETRY_LIMIT_STA_LG_S
 14

	)

547 
	#AR_D_RETRY_LIMIT_RESV0
 0xFFF00000

	)

549 
	#AR_D0_CHNTIME
 0x10c0

	)

550 
	#AR_D1_CHNTIME
 0x10c4

	)

551 
	#AR_D2_CHNTIME
 0x10c8

	)

552 
	#AR_D3_CHNTIME
 0x10cc

	)

553 
	#AR_D4_CHNTIME
 0x10d0

	)

554 
	#AR_D5_CHNTIME
 0x10d4

	)

555 
	#AR_D6_CHNTIME
 0x10d8

	)

556 
	#AR_D7_CHNTIME
 0x10dc

	)

557 
	#AR_D8_CHNTIME
 0x10e0

	)

558 
	#AR_D9_CHNTIME
 0x10e4

	)

559 
	#AR_DCHNTIME
(
_i
Ë(
AR_D0_CHNTIME
 + ((_i)<<2))

	)

560 
	#AR_D_CHNTIME_DUR
 0x000FFFFF

	)

561 
	#AR_D_CHNTIME_DUR_S
 0

	)

562 
	#AR_D_CHNTIME_EN
 0x00100000

	)

563 
	#AR_D_CHNTIME_RESV0
 0xFFE00000

	)

565 
	#AR_D0_MISC
 0x1100

	)

566 
	#AR_D1_MISC
 0x1104

	)

567 
	#AR_D2_MISC
 0x1108

	)

568 
	#AR_D3_MISC
 0x110c

	)

569 
	#AR_D4_MISC
 0x1110

	)

570 
	#AR_D5_MISC
 0x1114

	)

571 
	#AR_D6_MISC
 0x1118

	)

572 
	#AR_D7_MISC
 0x111c

	)

573 
	#AR_D8_MISC
 0x1120

	)

574 
	#AR_D9_MISC
 0x1124

	)

575 
	#AR_DMISC
(
_i
Ë(
AR_D0_MISC
 + ((_i)<<2))

	)

576 
	#AR_D_MISC_BKOFF_THRESH
 0x0000003F

	)

577 
	#AR_D_MISC_RETRY_CNT_RESET_EN
 0x00000040

	)

578 
	#AR_D_MISC_CW_RESET_EN
 0x00000080

	)

579 
	#AR_D_MISC_FRAG_WAIT_EN
 0x00000100

	)

580 
	#AR_D_MISC_FRAG_BKOFF_EN
 0x00000200

	)

581 
	#AR_D_MISC_CW_BKOFF_EN
 0x00001000

	)

582 
	#AR_D_MISC_VIR_COL_HANDLING
 0x0000C000

	)

583 
	#AR_D_MISC_VIR_COL_HANDLING_S
 14

	)

584 
	#AR_D_MISC_VIR_COL_HANDLING_DEFAULT
 0

	)

585 
	#AR_D_MISC_VIR_COL_HANDLING_IGNORE
 1

	)

586 
	#AR_D_MISC_BEACON_USE
 0x00010000

	)

587 
	#AR_D_MISC_ARB_LOCKOUT_CNTRL
 0x00060000

	)

588 
	#AR_D_MISC_ARB_LOCKOUT_CNTRL_S
 17

	)

589 
	#AR_D_MISC_ARB_LOCKOUT_CNTRL_NONE
 0

	)

590 
	#AR_D_MISC_ARB_LOCKOUT_CNTRL_INTRA_FR
 1

	)

591 
	#AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL
 2

	)

592 
	#AR_D_MISC_ARB_LOCKOUT_IGNORE
 0x00080000

	)

593 
	#AR_D_MISC_SEQ_NUM_INCR_DIS
 0x00100000

	)

594 
	#AR_D_MISC_POST_FR_BKOFF_DIS
 0x00200000

	)

595 
	#AR_D_MISC_VIT_COL_CW_BKOFF_EN
 0x00400000

	)

596 
	#AR_D_MISC_BLOWN_IFS_RETRY_EN
 0x00800000

	)

597 
	#AR_D_MISC_RESV0
 0xFF000000

	)

599 
	#AR_D_SEQNUM
 0x1140

	)

601 
	#AR_D_GBL_IFS_SIFS
 0x1030

	)

602 
	#AR_D_GBL_IFS_SIFS_M
 0x0000FFFF

	)

603 
	#AR_D_GBL_IFS_SIFS_RESV0
 0xFFFFFFFF

	)

605 
	#AR_D_TXBLK_BASE
 0x1038

	)

606 
	#AR_D_TXBLK_WRITE_BITMASK
 0x0000FFFF

	)

607 
	#AR_D_TXBLK_WRITE_BITMASK_S
 0

	)

608 
	#AR_D_TXBLK_WRITE_SLICE
 0x000F0000

	)

609 
	#AR_D_TXBLK_WRITE_SLICE_S
 16

	)

610 
	#AR_D_TXBLK_WRITE_DCU
 0x00F00000

	)

611 
	#AR_D_TXBLK_WRITE_DCU_S
 20

	)

612 
	#AR_D_TXBLK_WRITE_COMMAND
 0x0F000000

	)

613 
	#AR_D_TXBLK_WRITE_COMMAND_S
 24

	)

615 
	#AR_D_GBL_IFS_SLOT
 0x1070

	)

616 
	#AR_D_GBL_IFS_SLOT_M
 0x0000FFFF

	)

617 
	#AR_D_GBL_IFS_SLOT_RESV0
 0xFFFF0000

	)

619 
	#AR_D_GBL_IFS_EIFS
 0x10b0

	)

620 
	#AR_D_GBL_IFS_EIFS_M
 0x0000FFFF

	)

621 
	#AR_D_GBL_IFS_EIFS_RESV0
 0xFFFF0000

	)

622 
	#AR_D_GBL_IFS_EIFS_ASYNC_FIFO
 363

	)

624 
	#AR_D_GBL_IFS_MISC
 0x10f0

	)

625 
	#AR_D_GBL_IFS_MISC_LFSR_SLICE_SEL
 0x00000007

	)

626 
	#AR_D_GBL_IFS_MISC_TURBO_MODE
 0x00000008

	)

627 
	#AR_D_GBL_IFS_MISC_USEC_DURATION
 0x000FFC00

	)

628 
	#AR_D_GBL_IFS_MISC_DCU_ARBITER_DLY
 0x00300000

	)

629 
	#AR_D_GBL_IFS_MISC_RANDOM_LFSR_SLICE_DIS
 0x01000000

	)

630 
	#AR_D_GBL_IFS_MISC_SLOT_XMIT_WIND_LEN
 0x06000000

	)

631 
	#AR_D_GBL_IFS_MISC_FORCE_XMIT_SLOT_BOUND
 0x08000000

	)

632 
	#AR_D_GBL_IFS_MISC_IGNORE_BACKOFF
 0x10000000

	)

634 
	#AR_D_FPCTL
 0x1230

	)

635 
	#AR_D_FPCTL_DCU
 0x0000000F

	)

636 
	#AR_D_FPCTL_DCU_S
 0

	)

637 
	#AR_D_FPCTL_PREFETCH_EN
 0x00000010

	)

638 
	#AR_D_FPCTL_BURST_PREFETCH
 0x00007FE0

	)

639 
	#AR_D_FPCTL_BURST_PREFETCH_S
 5

	)

641 
	#AR_D_TXPSE
 0x1270

	)

642 
	#AR_D_TXPSE_CTRL
 0x000003FF

	)

643 
	#AR_D_TXPSE_RESV0
 0x0000FC00

	)

644 
	#AR_D_TXPSE_STATUS
 0x00010000

	)

645 
	#AR_D_TXPSE_RESV1
 0xFFFE0000

	)

647 
	#AR_D_TXSLOTMASK
 0x12f0

	)

648 
	#AR_D_TXSLOTMASK_NUM
 0x0000000F

	)

650 
	#AR_CFG_LED
 0x1f04

	)

651 
	#AR_CFG_SCLK_RATE_IND
 0x00000003

	)

652 
	#AR_CFG_SCLK_RATE_IND_S
 0

	)

653 
	#AR_CFG_SCLK_32MHZ
 0x00000000

	)

654 
	#AR_CFG_SCLK_4MHZ
 0x00000001

	)

655 
	#AR_CFG_SCLK_1MHZ
 0x00000002

	)

656 
	#AR_CFG_SCLK_32KHZ
 0x00000003

	)

657 
	#AR_CFG_LED_BLINK_SLOW
 0x00000008

	)

658 
	#AR_CFG_LED_BLINK_THRESH_SEL
 0x00000070

	)

659 
	#AR_CFG_LED_MODE_SEL
 0x00000380

	)

660 
	#AR_CFG_LED_MODE_SEL_S
 7

	)

661 
	#AR_CFG_LED_POWER
 0x00000280

	)

662 
	#AR_CFG_LED_POWER_S
 7

	)

663 
	#AR_CFG_LED_NETWORK
 0x00000300

	)

664 
	#AR_CFG_LED_NETWORK_S
 7

	)

665 
	#AR_CFG_LED_MODE_PROP
 0x0

	)

666 
	#AR_CFG_LED_MODE_RPROP
 0x1

	)

667 
	#AR_CFG_LED_MODE_SPLIT
 0x2

	)

668 
	#AR_CFG_LED_MODE_RAND
 0x3

	)

669 
	#AR_CFG_LED_MODE_POWER_OFF
 0x4

	)

670 
	#AR_CFG_LED_MODE_POWER_ON
 0x5

	)

671 
	#AR_CFG_LED_MODE_NETWORK_OFF
 0x4

	)

672 
	#AR_CFG_LED_MODE_NETWORK_ON
 0x6

	)

673 
	#AR_CFG_LED_ASSOC_CTL
 0x00000c00

	)

674 
	#AR_CFG_LED_ASSOC_CTL_S
 10

	)

675 
	#AR_CFG_LED_ASSOC_NONE
 0x0

	)

676 
	#AR_CFG_LED_ASSOC_ACTIVE
 0x1

	)

677 
	#AR_CFG_LED_ASSOC_PENDING
 0x2

	)

679 
	#AR_CFG_LED_BLINK_SLOW
 0x00000008

	)

680 
	#AR_CFG_LED_BLINK_SLOW_S
 3

	)

682 
	#AR_CFG_LED_BLINK_THRESH_SEL
 0x00000070

	)

683 
	#AR_CFG_LED_BLINK_THRESH_SEL_S
 4

	)

685 
	#AR_MAC_SLEEP
 0x1f00

	)

686 
	#AR_MAC_SLEEP_MAC_AWAKE
 0x00000000

	)

687 
	#AR_MAC_SLEEP_MAC_ASLEEP
 0x00000001

	)

689 
	#AR_RC
 0x4000

	)

690 
	#AR_RC_AHB
 0x00000001

	)

691 
	#AR_RC_APB
 0x00000002

	)

692 
	#AR_RC_HOSTIF
 0x00000100

	)

694 
	#AR_WA
 (
	`AR_SREV_9340
(
ah
Ë? 0x40c4 : 0x4004)

	)

695 
	#AR_WA_BIT6
 (1 << 6)

	)

696 
	#AR_WA_BIT7
 (1 << 7)

	)

697 
	#AR_WA_BIT23
 (1 << 23)

	)

698 
	#AR_WA_D3_L1_DISABLE
 (1 << 14)

	)

699 
	#AR_WA_UNTIE_RESET_EN
 (1 << 15Ë

	)

701 
	#AR_WA_D3_TO_L1_DISABLE_REAL
 (1 << 16)

	)

702 
	#AR_WA_ASPM_TIMER_BASED_DISABLE
 (1 << 17)

	)

703 
	#AR_WA_RESET_EN
 (1 << 18Ë

	)

705 
	#AR_WA_ANALOG_SHIFT
 (1 << 20)

	)

706 
	#AR_WA_POR_SHORT
 (1 << 21Ë

	)

707 
	#AR_WA_BIT22
 (1 << 22)

	)

708 
	#AR9285_WA_DEFAULT
 0x004a050b

	)

709 
	#AR9280_WA_DEFAULT
 0x0040073b

	)

710 
	#AR_WA_DEFAULT
 0x0000073f

	)

713 
	#AR_PM_STATE
 0x4008

	)

714 
	#AR_PM_STATE_PME_D3COLD_VAUX
 0x00100000

	)

716 
	#AR_HOST_TIMEOUT
 (
	`AR_SREV_9340
(
ah
Ë? 0x4008 : 0x4018)

	)

717 
	#AR_HOST_TIMEOUT_APB_CNTR
 0x0000FFFF

	)

718 
	#AR_HOST_TIMEOUT_APB_CNTR_S
 0

	)

719 
	#AR_HOST_TIMEOUT_LCL_CNTR
 0xFFFF0000

	)

720 
	#AR_HOST_TIMEOUT_LCL_CNTR_S
 16

	)

722 
	#AR_EEPROM
 0x401c

	)

723 
	#AR_EEPROM_ABSENT
 0x00000100

	)

724 
	#AR_EEPROM_CORRUPT
 0x00000200

	)

725 
	#AR_EEPROM_PROT_MASK
 0x03FFFC00

	)

726 
	#AR_EEPROM_PROT_MASK_S
 10

	)

728 
	#EEPROM_PROTECT_RP_0_31
 0x0001

	)

729 
	#EEPROM_PROTECT_WP_0_31
 0x0002

	)

730 
	#EEPROM_PROTECT_RP_32_63
 0x0004

	)

731 
	#EEPROM_PROTECT_WP_32_63
 0x0008

	)

732 
	#EEPROM_PROTECT_RP_64_127
 0x0010

	)

733 
	#EEPROM_PROTECT_WP_64_127
 0x0020

	)

734 
	#EEPROM_PROTECT_RP_128_191
 0x0040

	)

735 
	#EEPROM_PROTECT_WP_128_191
 0x0080

	)

736 
	#EEPROM_PROTECT_RP_192_255
 0x0100

	)

737 
	#EEPROM_PROTECT_WP_192_255
 0x0200

	)

738 
	#EEPROM_PROTECT_RP_256_511
 0x0400

	)

739 
	#EEPROM_PROTECT_WP_256_511
 0x0800

	)

740 
	#EEPROM_PROTECT_RP_512_1023
 0x1000

	)

741 
	#EEPROM_PROTECT_WP_512_1023
 0x2000

	)

742 
	#EEPROM_PROTECT_RP_1024_2047
 0x4000

	)

743 
	#EEPROM_PROTECT_WP_1024_2047
 0x8000

	)

745 
	#AR_SREV
 \

746 ((
	`AR_SREV_9100
(
ah
)Ë? 0x0600 : (
	`AR_SREV_9340
(ah) \

747 ? 0x400¯: 0x4020))

	)

749 
	#AR_SREV_ID
 \

750 ((
	`AR_SREV_9100
(
ah
)Ë? 0x00000FFF : 0x000000FF)

	)

751 
	#AR_SREV_VERSION
 0x000000F0

	)

752 
	#AR_SREV_VERSION_S
 4

	)

753 
	#AR_SREV_REVISION
 0x00000007

	)

755 
	#AR_SREV_ID2
 0xFFFFFFFF

	)

756 
	#AR_SREV_VERSION2
 0xFFFC0000

	)

757 
	#AR_SREV_VERSION2_S
 18

	)

758 
	#AR_SREV_TYPE2
 0x0003F000

	)

759 
	#AR_SREV_TYPE2_S
 12

	)

760 
	#AR_SREV_TYPE2_CHAIN
 0x00001000

	)

761 
	#AR_SREV_TYPE2_HOST_MODE
 0x00002000

	)

762 
	#AR_SREV_REVISION2
 0x00000F00

	)

763 
	#AR_SREV_REVISION2_S
 8

	)

765 
	#AR_SREV_VERSION_5416_PCI
 0xD

	)

766 
	#AR_SREV_VERSION_5416_PCIE
 0xC

	)

767 
	#AR_SREV_REVISION_5416_10
 0

	)

768 
	#AR_SREV_REVISION_5416_20
 1

	)

769 
	#AR_SREV_REVISION_5416_22
 2

	)

770 
	#AR_SREV_VERSION_9100
 0x14

	)

771 
	#AR_SREV_VERSION_9160
 0x40

	)

772 
	#AR_SREV_REVISION_9160_10
 0

	)

773 
	#AR_SREV_REVISION_9160_11
 1

	)

774 
	#AR_SREV_VERSION_9280
 0x80

	)

775 
	#AR_SREV_REVISION_9280_10
 0

	)

776 
	#AR_SREV_REVISION_9280_20
 1

	)

777 
	#AR_SREV_REVISION_9280_21
 2

	)

778 
	#AR_SREV_VERSION_9285
 0xC0

	)

779 
	#AR_SREV_REVISION_9285_10
 0

	)

780 
	#AR_SREV_REVISION_9285_11
 1

	)

781 
	#AR_SREV_REVISION_9285_12
 2

	)

782 
	#AR_SREV_VERSION_9287
 0x180

	)

783 
	#AR_SREV_REVISION_9287_10
 0

	)

784 
	#AR_SREV_REVISION_9287_11
 1

	)

785 
	#AR_SREV_REVISION_9287_12
 2

	)

786 
	#AR_SREV_REVISION_9287_13
 3

	)

787 
	#AR_SREV_VERSION_9271
 0x140

	)

788 
	#AR_SREV_REVISION_9271_10
 0

	)

789 
	#AR_SREV_REVISION_9271_11
 1

	)

790 
	#AR_SREV_VERSION_9300
 0x1c0

	)

791 
	#AR_SREV_REVISION_9300_20
 2

	)

792 
	#AR_SREV_REVISION_9300_22
 3

	)

793 
	#AR_SREV_VERSION_9330
 0x200

	)

794 
	#AR_SREV_REVISION_9330_10
 0

	)

795 
	#AR_SREV_REVISION_9330_11
 1

	)

796 
	#AR_SREV_REVISION_9330_12
 2

	)

797 
	#AR_SREV_VERSION_9485
 0x240

	)

798 
	#AR_SREV_REVISION_9485_10
 0

	)

799 
	#AR_SREV_REVISION_9485_11
 1

	)

800 
	#AR_SREV_VERSION_9340
 0x300

	)

801 
	#AR_SREV_REVISION_9340_10
 0

	)

802 
	#AR_SREV_REVISION_9340_11
 1

	)

803 
	#AR_SREV_REVISION_9340_12
 2

	)

804 
	#AR_SREV_REVISION_9340_13
 3

	)

805 
	#AR_SREV_VERSION_9580
 0x1C0

	)

806 
	#AR_SREV_REVISION_9580_10
 4

	)

807 
	#AR_SREV_VERSION_9462
 0x280

	)

808 
	#AR_SREV_REVISION_9462_20
 2

	)

809 
	#AR_SREV_REVISION_9462_21
 3

	)

810 
	#AR_SREV_VERSION_9565
 0x2C0

	)

811 
	#AR_SREV_REVISION_9565_10
 0

	)

812 
	#AR_SREV_REVISION_9565_101
 1

	)

813 
	#AR_SREV_REVISION_9565_11
 2

	)

814 
	#AR_SREV_VERSION_9550
 0x400

	)

815 
	#AR_SREV_VERSION_9531
 0x500

	)

816 
	#AR_SREV_REVISION_9531_10
 0

	)

817 
	#AR_SREV_REVISION_9531_11
 1

	)

818 
	#AR_SREV_REVISION_9531_20
 2

	)

819 
	#AR_SREV_VERSION_9561
 0x600

	)

821 
	#AR_SREV_5416
(
_ah
) \

822 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_5416_PCI
) || \

823 ((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_5416_PCIE
))

	)

824 
	#AR_SREV_5416_22_OR_LATER
(
_ah
) \

825 (((
	`AR_SREV_5416
(
_ah
)) && \

826 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_5416_22
)) || \

827 ((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9100
))

	)

829 
	#AR_SREV_9100
(
ah
) \

830 ((
ah
->
hw_vîsi⁄
.
macVîsi⁄
Ë=
AR_SREV_VERSION_9100
)

	)

831 
	#AR_SREV_9100_OR_LATER
(
_ah
) \

832 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9100
))

	)

834 
	#AR_SREV_9160
(
_ah
) \

835 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9160
))

	)

836 
	#AR_SREV_9160_10_OR_LATER
(
_ah
) \

837 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9160
))

	)

838 
	#AR_SREV_9160_11
(
_ah
) \

839 (
	`AR_SREV_9160
(
_ah
) && \

840 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9160_11
))

	)

841 
	#AR_SREV_9280
(
_ah
) \

842 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9280
))

	)

843 
	#AR_SREV_9280_20_OR_LATER
(
_ah
) \

844 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9280
))

	)

845 
	#AR_SREV_9280_20
(
_ah
) \

846 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9280
))

	)

848 
	#AR_SREV_9285
(
_ah
) \

849 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9285
))

	)

850 
	#AR_SREV_9285_12_OR_LATER
(
_ah
) \

851 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9285
))

	)

853 
	#AR_SREV_9287
(
_ah
) \

854 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9287
))

	)

855 
	#AR_SREV_9287_11_OR_LATER
(
_ah
) \

856 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9287
))

	)

857 
	#AR_SREV_9287_11
(
_ah
) \

858 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9287
) && \

859 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9287_11
))

	)

860 
	#AR_SREV_9287_12
(
_ah
) \

861 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9287
) && \

862 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9287_12
))

	)

863 
	#AR_SREV_9287_12_OR_LATER
(
_ah
) \

864 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 > 
AR_SREV_VERSION_9287
) || \

865 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9287
) && \

866 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9287_12
)))

	)

867 
	#AR_SREV_9287_13_OR_LATER
(
_ah
) \

868 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 > 
AR_SREV_VERSION_9287
) || \

869 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9287
) && \

870 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9287_13
)))

	)

872 
	#AR_SREV_9271
(
_ah
) \

873 (((
_ah
))->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9271
)

	)

874 
	#AR_SREV_9271_10
(
_ah
) \

875 (
	`AR_SREV_9271
(
_ah
) && \

876 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9271_10
))

	)

877 
	#AR_SREV_9271_11
(
_ah
) \

878 (
	`AR_SREV_9271
(
_ah
) && \

879 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9271_11
))

	)

881 
	#AR_SREV_9300
(
_ah
) \

882 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9300
))

	)

883 
	#AR_SREV_9300_20_OR_LATER
(
_ah
) \

884 ((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9300
)

	)

885 
	#AR_SREV_9300_22
(
_ah
) \

886 (
	`AR_SREV_9300
(
ah
) && \

887 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9300_22
))

	)

889 
	#AR_SREV_9330
(
_ah
) \

890 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9330
))

	)

891 
	#AR_SREV_9330_11
(
_ah
) \

892 (
	`AR_SREV_9330
((
_ah
)) && \

893 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9330_11
))

	)

894 
	#AR_SREV_9330_12
(
_ah
) \

895 (
	`AR_SREV_9330
((
_ah
)) && \

896 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9330_12
))

	)

898 #ifde‡
CPTCFG_ATH9K_PCOEM


899 
	#AR_SREV_9462
(
_ah
) \

900 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9462
))

	)

901 
	#AR_SREV_9485
(
_ah
) \

902 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9485
))

	)

903 
	#AR_SREV_9565
(
_ah
) \

904 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9565
))

	)

905 
	#AR_SREV_9003_PCOEM
(
_ah
) \

906 (
	`AR_SREV_9462
(
_ah
Ë|| 
	`AR_SREV_9485
(_ahË|| 
	`AR_SREV_9565
(_ah))

	)

908 
	#AR_SREV_9462
(
_ah
Ë0

	)

909 
	#AR_SREV_9485
(
_ah
Ë0

	)

910 
	#AR_SREV_9565
(
_ah
Ë0

	)

911 
	#AR_SREV_9003_PCOEM
(
_ah
Ë0

	)

914 
	#AR_SREV_9485_11_OR_LATER
(
_ah
) \

915 (
	`AR_SREV_9485
(
_ah
) && \

916 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9485_11
))

	)

917 
	#AR_SREV_9485_OR_LATER
(
_ah
) \

918 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9485
))

	)

920 
	#AR_SREV_9340
(
_ah
) \

921 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9340
))

	)

923 
	#AR_SREV_9340_13
(
_ah
) \

924 (
	`AR_SREV_9340
((
_ah
)) && \

925 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9340_13
))

	)

927 
	#AR_SREV_9340_13_OR_LATER
(
_ah
) \

928 (
	`AR_SREV_9340
((
_ah
)) && \

929 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9340_13
))

	)

931 
	#AR_SREV_9285E_20
(
_ah
) \

932 (
	`AR_SREV_9285_12_OR_LATER
(
_ah
) && \

933 ((
	`REG_READ
(
_ah
, 
AR_AN_SYNTH9
Ë& 0x7Ë=0x1))

	)

935 
	#AR_SREV_9462_20
(
_ah
) \

936 (
	`AR_SREV_9462
(
_ah
) && \

937 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9462_20
))

	)

938 
	#AR_SREV_9462_21
(
_ah
) \

939 (
	`AR_SREV_9462
(
_ah
) && \

940 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9462_21
))

	)

941 
	#AR_SREV_9462_20_OR_LATER
(
_ah
) \

942 (
	`AR_SREV_9462
(
_ah
) && \

943 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9462_20
))

	)

944 
	#AR_SREV_9462_21_OR_LATER
(
_ah
) \

945 (
	`AR_SREV_9462
(
_ah
) && \

946 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9462_21
))

	)

948 
	#AR_SREV_9565_10
(
_ah
) \

949 (
	`AR_SREV_9565
(
_ah
) && \

950 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9565_10
))

	)

951 
	#AR_SREV_9565_101
(
_ah
) \

952 (
	`AR_SREV_9565
(
_ah
) && \

953 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9565_101
))

	)

954 
	#AR_SREV_9565_11
(
_ah
) \

955 (
	`AR_SREV_9565
(
_ah
) && \

956 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9565_11
))

	)

957 
	#AR_SREV_9565_11_OR_LATER
(
_ah
) \

958 (
	`AR_SREV_9565
(
_ah
) && \

959 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9565_11
))

	)

961 
	#AR_SREV_9550
(
_ah
) \

962 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9550
))

	)

963 
	#AR_SREV_9550_OR_LATER
(
_ah
) \

964 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 >
AR_SREV_VERSION_9550
))

	)

966 
	#AR_SREV_9580
(
_ah
) \

967 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9580
) && \

968 ((
_ah
)->
hw_vîsi⁄
.
macRev
 >
AR_SREV_REVISION_9580_10
))

	)

969 
	#AR_SREV_9580_10
(
_ah
) \

970 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9580
) && \

971 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9580_10
))

	)

973 
	#AR_SREV_9531
(
_ah
) \

974 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9531
))

	)

975 
	#AR_SREV_9531_10
(
_ah
) \

976 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9531
) && \

977 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9531_10
))

	)

978 
	#AR_SREV_9531_11
(
_ah
) \

979 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9531
) && \

980 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9531_11
))

	)

981 
	#AR_SREV_9531_20
(
_ah
) \

982 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9531
) && \

983 ((
_ah
)->
hw_vîsi⁄
.
macRev
 =
AR_SREV_REVISION_9531_20
))

	)

985 
	#AR_SREV_9561
(
_ah
) \

986 (((
_ah
)->
hw_vîsi⁄
.
macVîsi⁄
 =
AR_SREV_VERSION_9561
))

	)

989 
	#AR_SREV_9580_10_OR_LATER
(
_ah
) \

990 (
	`AR_SREV_9580
(
_ah
))

	)

992 
	e©h_usb_dev
 {

993 
	mAR9280_USB
 = 1,

994 
	mAR9287_USB
 = 2,

995 
	mSTORAGE_DEVICE
 = 3,

998 
	#AR_DEVID_7010
(
_ah
) \

999 (((
_ah
)->
hw_vîsi⁄
.
usbdev
 =
AR9280_USB
) || \

1000 ((
_ah
)->
hw_vîsi⁄
.
usbdev
 =
AR9287_USB
))

	)

1002 
	#AR_RADIO_SREV_MAJOR
 0xf0

	)

1003 
	#AR_RAD5133_SREV_MAJOR
 0xc0

	)

1004 
	#AR_RAD2133_SREV_MAJOR
 0xd0

	)

1005 
	#AR_RAD5122_SREV_MAJOR
 0xe0

	)

1006 
	#AR_RAD2122_SREV_MAJOR
 0xf0

	)

1008 
	#AR_AHB_MODE
 0x4024

	)

1009 
	#AR_AHB_EXACT_WR_EN
 0x00000000

	)

1010 
	#AR_AHB_BUF_WR_EN
 0x00000001

	)

1011 
	#AR_AHB_EXACT_RD_EN
 0x00000000

	)

1012 
	#AR_AHB_CACHELINE_RD_EN
 0x00000002

	)

1013 
	#AR_AHB_PREFETCH_RD_EN
 0x00000004

	)

1014 
	#AR_AHB_PAGE_SIZE_1K
 0x00000000

	)

1015 
	#AR_AHB_PAGE_SIZE_2K
 0x00000008

	)

1016 
	#AR_AHB_PAGE_SIZE_4K
 0x00000010

	)

1017 
	#AR_AHB_CUSTOM_BURST_EN
 0x000000C0

	)

1018 
	#AR_AHB_CUSTOM_BURST_EN_S
 6

	)

1019 
	#AR_AHB_CUSTOM_BURST_ASYNC_FIFO_VAL
 3

	)

1021 
	#AR_INTR_RTC_IRQ
 0x00000001

	)

1022 
	#AR_INTR_MAC_IRQ
 0x00000002

	)

1023 
	#AR_INTR_EEP_PROT_ACCESS
 0x00000004

	)

1024 
	#AR_INTR_MAC_AWAKE
 0x00020000

	)

1025 
	#AR_INTR_MAC_ASLEEP
 0x00040000

	)

1026 
	#AR_INTR_SPURIOUS
 0xFFFFFFFF

	)

1029 
	#AR_INTR_SYNC_CAUSE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4010 : 0x4028)

	)

1030 
	#AR_INTR_SYNC_CAUSE_CLR
 (
	`AR_SREV_9340
(
ah
Ë? 0x4010 : 0x4028)

	)

1033 
	#AR_INTR_SYNC_ENABLE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4014 : 0x402c)

	)

1034 
	#AR_INTR_SYNC_ENABLE_GPIO
 0xFFFC0000

	)

1035 
	#AR_INTR_SYNC_ENABLE_GPIO_S
 18

	)

1038 
	mAR_INTR_SYNC_RTC_IRQ
 = 0x00000001,

1039 
	mAR_INTR_SYNC_MAC_IRQ
 = 0x00000002,

1040 
	mAR_INTR_SYNC_EEPROM_ILLEGAL_ACCESS
 = 0x00000004,

1041 
	mAR_INTR_SYNC_APB_TIMEOUT
 = 0x00000008,

1042 
	mAR_INTR_SYNC_PCI_MODE_CONFLICT
 = 0x00000010,

1043 
	mAR_INTR_SYNC_HOST1_FATAL
 = 0x00000020,

1044 
	mAR_INTR_SYNC_HOST1_PERR
 = 0x00000040,

1045 
	mAR_INTR_SYNC_TRCV_FIFO_PERR
 = 0x00000080,

1046 
	mAR_INTR_SYNC_RADM_CPL_EP
 = 0x00000100,

1047 
	mAR_INTR_SYNC_RADM_CPL_DLLP_ABORT
 = 0x00000200,

1048 
	mAR_INTR_SYNC_RADM_CPL_TLP_ABORT
 = 0x00000400,

1049 
	mAR_INTR_SYNC_RADM_CPL_ECRC_ERR
 = 0x00000800,

1050 
	mAR_INTR_SYNC_RADM_CPL_TIMEOUT
 = 0x00001000,

1051 
	mAR_INTR_SYNC_LOCAL_TIMEOUT
 = 0x00002000,

1052 
	mAR_INTR_SYNC_PM_ACCESS
 = 0x00004000,

1053 
	mAR_INTR_SYNC_MAC_AWAKE
 = 0x00008000,

1054 
	mAR_INTR_SYNC_MAC_ASLEEP
 = 0x00010000,

1055 
	mAR_INTR_SYNC_MAC_SLEEP_ACCESS
 = 0x00020000,

1056 
	mAR_INTR_SYNC_ALL
 = 0x0003FFFF,

1059 
	mAR_INTR_SYNC_DEFAULT
 = (
AR_INTR_SYNC_HOST1_FATAL
 |

1060 
AR_INTR_SYNC_HOST1_PERR
 |

1061 
AR_INTR_SYNC_RADM_CPL_EP
 |

1062 
AR_INTR_SYNC_RADM_CPL_DLLP_ABORT
 |

1063 
AR_INTR_SYNC_RADM_CPL_TLP_ABORT
 |

1064 
AR_INTR_SYNC_RADM_CPL_ECRC_ERR
 |

1065 
AR_INTR_SYNC_RADM_CPL_TIMEOUT
 |

1066 
AR_INTR_SYNC_LOCAL_TIMEOUT
 |

1067 
AR_INTR_SYNC_MAC_SLEEP_ACCESS
),

1069 
	mAR9340_INTR_SYNC_LOCAL_TIMEOUT
 = 0x00000010,

1071 
	mAR_INTR_SYNC_SPURIOUS
 = 0xFFFFFFFF,

1075 
	#AR_INTR_ASYNC_MASK
 (
	`AR_SREV_9340
(
ah
Ë? 0x4018 : 0x4030)

	)

1076 
	#AR_INTR_ASYNC_MASK_GPIO
 0xFFFC0000

	)

1077 
	#AR_INTR_ASYNC_MASK_GPIO_S
 18

	)

1078 
	#AR_INTR_ASYNC_MASK_MCI
 0x00000080

	)

1079 
	#AR_INTR_ASYNC_MASK_MCI_S
 7

	)

1081 
	#AR_INTR_SYNC_MASK
 (
	`AR_SREV_9340
(
ah
Ë? 0x401¯: 0x4034)

	)

1082 
	#AR_INTR_SYNC_MASK_GPIO
 0xFFFC0000

	)

1083 
	#AR_INTR_SYNC_MASK_GPIO_S
 18

	)

1085 
	#AR_INTR_ASYNC_CAUSE_CLR
 (
	`AR_SREV_9340
(
ah
Ë? 0x4020 : 0x4038)

	)

1086 
	#AR_INTR_ASYNC_CAUSE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4020 : 0x4038)

	)

1087 
	#AR_INTR_ASYNC_CAUSE_MCI
 0x00000080

	)

1088 
	#AR_INTR_ASYNC_USED
 (
AR_INTR_MAC_IRQ
 | \

1089 
AR_INTR_ASYNC_CAUSE_MCI
)

	)

1092 
	#AR_INTR_ASYNC_ENABLE_MCI
 0x00000080

	)

1093 
	#AR_INTR_ASYNC_ENABLE_MCI_S
 7

	)

1096 
	#AR_INTR_ASYNC_ENABLE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4024 : 0x403c)

	)

1097 
	#AR_INTR_ASYNC_ENABLE_GPIO
 0xFFFC0000

	)

1098 
	#AR_INTR_ASYNC_ENABLE_GPIO_S
 18

	)

1100 
	#AR_PCIE_SERDES
 0x4040

	)

1101 
	#AR_PCIE_SERDES2
 0x4044

	)

1102 
	#AR_PCIE_PM_CTRL
 (
	`AR_SREV_9340
(
ah
Ë? 0x4004 : 0x4014)

	)

1103 
	#AR_PCIE_PM_CTRL_ENA
 0x00080000

	)

1105 
	#AR_PCIE_PHY_REG3
 0x18c08

	)

1107 
	#AR_NUM_GPIO
 14

	)

1108 
	#AR928X_NUM_GPIO
 10

	)

1109 
	#AR9285_NUM_GPIO
 12

	)

1110 
	#AR9287_NUM_GPIO
 11

	)

1111 
	#AR9271_NUM_GPIO
 16

	)

1112 
	#AR9300_NUM_GPIO
 17

	)

1113 
	#AR7010_NUM_GPIO
 16

	)

1115 
	#AR_GPIO_IN_OUT
 (
	`AR_SREV_9340
(
ah
Ë? 0x4028 : 0x4048)

	)

1116 
	#AR_GPIO_IN_VAL
 0x0FFFC000

	)

1117 
	#AR_GPIO_IN_VAL_S
 14

	)

1118 
	#AR928X_GPIO_IN_VAL
 0x000FFC00

	)

1119 
	#AR928X_GPIO_IN_VAL_S
 10

	)

1120 
	#AR9285_GPIO_IN_VAL
 0x00FFF000

	)

1121 
	#AR9285_GPIO_IN_VAL_S
 12

	)

1122 
	#AR9287_GPIO_IN_VAL
 0x003FF800

	)

1123 
	#AR9287_GPIO_IN_VAL_S
 11

	)

1124 
	#AR9271_GPIO_IN_VAL
 0xFFFF0000

	)

1125 
	#AR9271_GPIO_IN_VAL_S
 16

	)

1126 
	#AR7010_GPIO_IN_VAL
 0x0000FFFF

	)

1127 
	#AR7010_GPIO_IN_VAL_S
 0

	)

1129 
	#AR_GPIO_IN
 (
	`AR_SREV_9340
(
ah
Ë? 0x402¯: 0x404c)

	)

1130 
	#AR9300_GPIO_IN_VAL
 0x0001FFFF

	)

1131 
	#AR9300_GPIO_IN_VAL_S
 0

	)

1133 
	#AR_GPIO_OE_OUT
 (
	`AR_SREV_9340
(
ah
) ? 0x4030 : \

1134 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4050 : 0x404c))

	)

1135 
	#AR_GPIO_OE_OUT_MASK
 (
	`AR_SREV_9550_OR_LATER
(
ah
) ? \

1136 0x0000000F : 0xFFFFFFFF)

	)

1137 
	#AR_GPIO_OE_OUT_DRV
 0x3

	)

1138 
	#AR_GPIO_OE_OUT_DRV_NO
 0x0

	)

1139 
	#AR_GPIO_OE_OUT_DRV_LOW
 0x1

	)

1140 
	#AR_GPIO_OE_OUT_DRV_HI
 0x2

	)

1141 
	#AR_GPIO_OE_OUT_DRV_ALL
 0x3

	)

1143 
	#AR7010_GPIO_OE
 0x52000

	)

1144 
	#AR7010_GPIO_OE_MASK
 0x1

	)

1145 
	#AR7010_GPIO_OE_AS_OUTPUT
 0x0

	)

1146 
	#AR7010_GPIO_OE_AS_INPUT
 0x1

	)

1147 
	#AR7010_GPIO_IN
 0x52004

	)

1148 
	#AR7010_GPIO_OUT
 0x52008

	)

1149 
	#AR7010_GPIO_SET
 0x5200C

	)

1150 
	#AR7010_GPIO_CLEAR
 0x52010

	)

1151 
	#AR7010_GPIO_INT
 0x52014

	)

1152 
	#AR7010_GPIO_INT_TYPE
 0x52018

	)

1153 
	#AR7010_GPIO_INT_POLARITY
 0x5201C

	)

1154 
	#AR7010_GPIO_PENDING
 0x52020

	)

1155 
	#AR7010_GPIO_INT_MASK
 0x52024

	)

1156 
	#AR7010_GPIO_FUNCTION
 0x52028

	)

1158 
	#AR_GPIO_INTR_POL
 (
	`AR_SREV_9340
(
ah
) ? 0x4038 : \

1159 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4058 : 0x4050))

	)

1160 
	#AR_GPIO_INTR_POL_VAL
 0x0001FFFF

	)

1161 
	#AR_GPIO_INTR_POL_VAL_S
 0

	)

1163 
	#AR_GPIO_INPUT_EN_VAL
 (
	`AR_SREV_9340
(
ah
) ? 0x403c : \

1164 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x405¯: 0x4054))

	)

1165 
	#AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_DEF
 0x00000004

	)

1166 
	#AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_S
 2

	)

1167 
	#AR_GPIO_INPUT_EN_VAL_BT_FREQUENCY_DEF
 0x00000008

	)

1168 
	#AR_GPIO_INPUT_EN_VAL_BT_FREQUENCY_S
 3

	)

1169 
	#AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_DEF
 0x00000010

	)

1170 
	#AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_S
 4

	)

1171 
	#AR_GPIO_INPUT_EN_VAL_RFSILENT_DEF
 0x00000080

	)

1172 
	#AR_GPIO_INPUT_EN_VAL_RFSILENT_DEF_S
 7

	)

1173 
	#AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_BB
 0x00000400

	)

1174 
	#AR_GPIO_INPUT_EN_VAL_BT_PRIORITY_BB_S
 10

	)

1175 
	#AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_BB
 0x00001000

	)

1176 
	#AR_GPIO_INPUT_EN_VAL_BT_ACTIVE_BB_S
 12

	)

1177 
	#AR_GPIO_INPUT_EN_VAL_RFSILENT_BB
 0x00008000

	)

1178 
	#AR_GPIO_INPUT_EN_VAL_RFSILENT_BB_S
 15

	)

1179 
	#AR_GPIO_RTC_RESET_OVERRIDE_ENABLE
 0x00010000

	)

1180 
	#AR_GPIO_JTAG_DISABLE
 0x00020000

	)

1182 
	#AR_GPIO_INPUT_MUX1
 (
	`AR_SREV_9340
(
ah
) ? 0x4040 : \

1183 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4060 : 0x4058))

	)

1184 
	#AR_GPIO_INPUT_MUX1_BT_ACTIVE
 0x000f0000

	)

1185 
	#AR_GPIO_INPUT_MUX1_BT_ACTIVE_S
 16

	)

1186 
	#AR_GPIO_INPUT_MUX1_BT_PRIORITY
 0x00000f00

	)

1187 
	#AR_GPIO_INPUT_MUX1_BT_PRIORITY_S
 8

	)

1189 
	#AR_GPIO_INPUT_MUX2
 (
	`AR_SREV_9340
(
ah
) ? 0x4044 : \

1190 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4064 : 0x405c))

	)

1191 
	#AR_GPIO_INPUT_MUX2_CLK25
 0x0000000f

	)

1192 
	#AR_GPIO_INPUT_MUX2_CLK25_S
 0

	)

1193 
	#AR_GPIO_INPUT_MUX2_RFSILENT
 0x000000f0

	)

1194 
	#AR_GPIO_INPUT_MUX2_RFSILENT_S
 4

	)

1195 
	#AR_GPIO_INPUT_MUX2_RTC_RESET
 0x00000f00

	)

1196 
	#AR_GPIO_INPUT_MUX2_RTC_RESET_S
 8

	)

1198 
	#AR_GPIO_OUTPUT_MUX1
 (
	`AR_SREV_9340
(
ah
) ? 0x4048 : \

1199 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4068 : 0x4060))

	)

1200 
	#AR_GPIO_OUTPUT_MUX2
 (
	`AR_SREV_9340
(
ah
) ? 0x404c : \

1201 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x406¯: 0x4064))

	)

1202 
	#AR_GPIO_OUTPUT_MUX3
 (
	`AR_SREV_9340
(
ah
) ? 0x4050 : \

1203 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4070 : 0x4068))

	)

1205 
	#AR_INPUT_STATE
 (
	`AR_SREV_9340
(
ah
) ? 0x4054 : \

1206 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4074 : 0x406c))

	)

1208 
	#AR_EEPROM_STATUS_DATA
 (
	`AR_SREV_9340
(
ah
) ? 0x40c8 : \

1209 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4084 : 0x407c))

	)

1210 
	#AR_EEPROM_STATUS_DATA_VAL
 0x0000ffff

	)

1211 
	#AR_EEPROM_STATUS_DATA_VAL_S
 0

	)

1212 
	#AR_EEPROM_STATUS_DATA_BUSY
 0x00010000

	)

1213 
	#AR_EEPROM_STATUS_DATA_BUSY_ACCESS
 0x00020000

	)

1214 
	#AR_EEPROM_STATUS_DATA_PROT_ACCESS
 0x00040000

	)

1215 
	#AR_EEPROM_STATUS_DATA_ABSENT_ACCESS
 0x00080000

	)

1217 
	#AR_OBS
 (
	`AR_SREV_9340
(
ah
) ? 0x405c : \

1218 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4088 : 0x4080))

	)

1220 
	#AR_GPIO_PDPU
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x4090 : 0x4088)

	)

1222 
	#AR_PCIE_MSI
 (
	`AR_SREV_9340
(
ah
) ? 0x40d8 : \

1223 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 0x40a4 : 0x4094))

	)

1224 
	#AR_PCIE_MSI_ENABLE
 0x00000001

	)

1226 
	#AR_INTR_PRIO_SYNC_ENABLE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4088 : 0x40c4)

	)

1227 
	#AR_INTR_PRIO_ASYNC_MASK
 (
	`AR_SREV_9340
(
ah
Ë? 0x408¯: 0x40c8)

	)

1228 
	#AR_INTR_PRIO_SYNC_MASK
 (
	`AR_SREV_9340
(
ah
Ë? 0x4090 : 0x40cc)

	)

1229 
	#AR_INTR_PRIO_ASYNC_ENABLE
 (
	`AR_SREV_9340
(
ah
Ë? 0x4094 : 0x40d4)

	)

1230 
	#AR_ENT_OTP
 0x40d8

	)

1231 
	#AR_ENT_OTP_CHAIN2_DISABLE
 0x00020000

	)

1232 
	#AR_ENT_OTP_49GHZ_DISABLE
 0x00100000

	)

1233 
	#AR_ENT_OTP_MIN_PKT_SIZE_DISABLE
 0x00800000

	)

1235 
	#AR_CH0_BB_DPLL1
 0x16180

	)

1236 
	#AR_CH0_BB_DPLL1_REFDIV
 0xF8000000

	)

1237 
	#AR_CH0_BB_DPLL1_REFDIV_S
 27

	)

1238 
	#AR_CH0_BB_DPLL1_NINI
 0x07FC0000

	)

1239 
	#AR_CH0_BB_DPLL1_NINI_S
 18

	)

1240 
	#AR_CH0_BB_DPLL1_NFRAC
 0x0003FFFF

	)

1241 
	#AR_CH0_BB_DPLL1_NFRAC_S
 0

	)

1243 
	#AR_CH0_BB_DPLL2
 0x16184

	)

1244 
	#AR_CH0_BB_DPLL2_LOCAL_PLL
 0x40000000

	)

1245 
	#AR_CH0_BB_DPLL2_LOCAL_PLL_S
 30

	)

1246 
	#AR_CH0_DPLL2_KI
 0x3C000000

	)

1247 
	#AR_CH0_DPLL2_KI_S
 26

	)

1248 
	#AR_CH0_DPLL2_KD
 0x03F80000

	)

1249 
	#AR_CH0_DPLL2_KD_S
 19

	)

1250 
	#AR_CH0_BB_DPLL2_EN_NEGTRIG
 0x00040000

	)

1251 
	#AR_CH0_BB_DPLL2_EN_NEGTRIG_S
 18

	)

1252 
	#AR_CH0_BB_DPLL2_PLL_PWD
 0x00010000

	)

1253 
	#AR_CH0_BB_DPLL2_PLL_PWD_S
 16

	)

1254 
	#AR_CH0_BB_DPLL2_OUTDIV
 0x0000E000

	)

1255 
	#AR_CH0_BB_DPLL2_OUTDIV_S
 13

	)

1257 
	#AR_CH0_BB_DPLL3
 0x16188

	)

1258 
	#AR_CH0_BB_DPLL3_PHASE_SHIFT
 0x3F800000

	)

1259 
	#AR_CH0_BB_DPLL3_PHASE_SHIFT_S
 23

	)

1261 
	#AR_CH0_DDR_DPLL2
 0x16244

	)

1262 
	#AR_CH0_DDR_DPLL3
 0x16248

	)

1263 
	#AR_CH0_DPLL3_PHASE_SHIFT
 0x3F800000

	)

1264 
	#AR_CH0_DPLL3_PHASE_SHIFT_S
 23

	)

1265 
	#AR_PHY_CCA_NOM_VAL_2GHZ
 -118

	)

1267 
	#AR_RTC_9300_SOC_PLL_DIV_INT
 0x0000003f

	)

1268 
	#AR_RTC_9300_SOC_PLL_DIV_INT_S
 0

	)

1269 
	#AR_RTC_9300_SOC_PLL_DIV_FRAC
 0x000fffc0

	)

1270 
	#AR_RTC_9300_SOC_PLL_DIV_FRAC_S
 6

	)

1271 
	#AR_RTC_9300_SOC_PLL_REFDIV
 0x01f00000

	)

1272 
	#AR_RTC_9300_SOC_PLL_REFDIV_S
 20

	)

1273 
	#AR_RTC_9300_SOC_PLL_CLKSEL
 0x06000000

	)

1274 
	#AR_RTC_9300_SOC_PLL_CLKSEL_S
 25

	)

1275 
	#AR_RTC_9300_SOC_PLL_BYPASS
 0x08000000

	)

1277 
	#AR_RTC_9300_PLL_DIV
 0x000003ff

	)

1278 
	#AR_RTC_9300_PLL_DIV_S
 0

	)

1279 
	#AR_RTC_9300_PLL_REFDIV
 0x00003C00

	)

1280 
	#AR_RTC_9300_PLL_REFDIV_S
 10

	)

1281 
	#AR_RTC_9300_PLL_CLKSEL
 0x0000C000

	)

1282 
	#AR_RTC_9300_PLL_CLKSEL_S
 14

	)

1283 
	#AR_RTC_9300_PLL_BYPASS
 0x00010000

	)

1285 
	#AR_RTC_9160_PLL_DIV
 0x000003ff

	)

1286 
	#AR_RTC_9160_PLL_DIV_S
 0

	)

1287 
	#AR_RTC_9160_PLL_REFDIV
 0x00003C00

	)

1288 
	#AR_RTC_9160_PLL_REFDIV_S
 10

	)

1289 
	#AR_RTC_9160_PLL_CLKSEL
 0x0000C000

	)

1290 
	#AR_RTC_9160_PLL_CLKSEL_S
 14

	)

1292 
	#AR_RTC_BASE
 0x00020000

	)

1293 
	#AR_RTC_RC
 \

1294 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0000Ë: 0x7000)

	)

1295 
	#AR_RTC_RC_M
 0x00000003

	)

1296 
	#AR_RTC_RC_MAC_WARM
 0x00000001

	)

1297 
	#AR_RTC_RC_MAC_COLD
 0x00000002

	)

1298 
	#AR_RTC_RC_COLD_RESET
 0x00000004

	)

1299 
	#AR_RTC_RC_WARM_RESET
 0x00000008

	)

1302 
	#AR_RTC_XTAL_CONTROL
 0x7004

	)

1305 
	#AR_RTC_REG_CONTROL0
 0x7008

	)

1308 
	#AR_RTC_REG_CONTROL1
 0x700c

	)

1309 
	#AR_RTC_REG_CONTROL1_SWREG_PROGRAM
 0x00000001

	)

1311 
	#AR_RTC_PLL_CONTROL
 \

1312 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0014Ë: 0x7014)

	)

1314 
	#AR_RTC_PLL_CONTROL2
 0x703c

	)

1316 
	#AR_RTC_PLL_DIV
 0x0000001f

	)

1317 
	#AR_RTC_PLL_DIV_S
 0

	)

1318 
	#AR_RTC_PLL_DIV2
 0x00000020

	)

1319 
	#AR_RTC_PLL_REFDIV_5
 0x000000c0

	)

1320 
	#AR_RTC_PLL_CLKSEL
 0x00000300

	)

1321 
	#AR_RTC_PLL_CLKSEL_S
 8

	)

1322 
	#AR_RTC_PLL_BYPASS
 0x00010000

	)

1323 
	#AR_RTC_PLL_NOPWD
 0x00040000

	)

1324 
	#AR_RTC_PLL_NOPWD_S
 18

	)

1326 
	#PLL3
 0x16188

	)

1327 
	#PLL3_DO_MEAS_MASK
 0x40000000

	)

1328 
	#PLL4
 0x1618c

	)

1329 
	#PLL4_MEAS_DONE
 0x8

	)

1330 
	#SQSUM_DVC_MASK
 0x007ffff8

	)

1332 
	#AR_RTC_RESET
 \

1333 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0040Ë: 0x7040)

	)

1334 
	#AR_RTC_RESET_EN
 (0x00000001)

	)

1336 
	#AR_RTC_STATUS
 \

1337 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0044Ë: 0x7044)

	)

1339 
	#AR_RTC_STATUS_M
 \

1340 ((
	`AR_SREV_9100
(
ah
)Ë? 0x0000003‡: 0x0000000f)

	)

1342 
	#AR_RTC_PM_STATUS_M
 0x0000000f

	)

1344 
	#AR_RTC_STATUS_SHUTDOWN
 0x00000001

	)

1345 
	#AR_RTC_STATUS_ON
 0x00000002

	)

1346 
	#AR_RTC_STATUS_SLEEP
 0x00000004

	)

1347 
	#AR_RTC_STATUS_WAKEUP
 0x00000008

	)

1349 
	#AR_RTC_SLEEP_CLK
 \

1350 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0048Ë: 0x7048)

	)

1351 
	#AR_RTC_FORCE_DERIVED_CLK
 0x2

	)

1352 
	#AR_RTC_FORCE_SWREG_PRD
 0x00000004

	)

1354 
	#AR_RTC_FORCE_WAKE
 \

1355 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x004cË: 0x704c)

	)

1356 
	#AR_RTC_FORCE_WAKE_EN
 0x00000001

	)

1357 
	#AR_RTC_FORCE_WAKE_ON_INT
 0x00000002

	)

1360 
	#AR_RTC_INTR_CAUSE
 \

1361 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0050Ë: 0x7050)

	)

1363 
	#AR_RTC_INTR_ENABLE
 \

1364 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0054Ë: 0x7054)

	)

1366 
	#AR_RTC_INTR_MASK
 \

1367 ((
	`AR_SREV_9100
(
ah
)Ë? (
AR_RTC_BASE
 + 0x0058Ë: 0x7058)

	)

1369 
	#AR_RTC_KEEP_AWAKE
 0x7034

	)

1373 
	#AR_RTC_DERIVED_CLK
 \

1374 (
	`AR_SREV_9100
(
ah
Ë? (
AR_RTC_BASE
 + 0x0038Ë: 0x7038)

	)

1375 
	#AR_RTC_DERIVED_CLK_PERIOD
 0x0000ff„

	)

1376 
	#AR_RTC_DERIVED_CLK_PERIOD_S
 1

	)

1378 
	#AR_SEQ_MASK
 0x8060

	)

1380 
	#AR_AN_RF2G1_CH0
 0x7810

	)

1381 
	#AR_AN_RF2G1_CH0_OB
 0x03800000

	)

1382 
	#AR_AN_RF2G1_CH0_OB_S
 23

	)

1383 
	#AR_AN_RF2G1_CH0_DB
 0x1C000000

	)

1384 
	#AR_AN_RF2G1_CH0_DB_S
 26

	)

1386 
	#AR_AN_RF5G1_CH0
 0x7818

	)

1387 
	#AR_AN_RF5G1_CH0_OB5
 0x00070000

	)

1388 
	#AR_AN_RF5G1_CH0_OB5_S
 16

	)

1389 
	#AR_AN_RF5G1_CH0_DB5
 0x00380000

	)

1390 
	#AR_AN_RF5G1_CH0_DB5_S
 19

	)

1392 
	#AR_AN_RF2G1_CH1
 0x7834

	)

1393 
	#AR_AN_RF2G1_CH1_OB
 0x03800000

	)

1394 
	#AR_AN_RF2G1_CH1_OB_S
 23

	)

1395 
	#AR_AN_RF2G1_CH1_DB
 0x1C000000

	)

1396 
	#AR_AN_RF2G1_CH1_DB_S
 26

	)

1398 
	#AR_AN_RF5G1_CH1
 0x783C

	)

1399 
	#AR_AN_RF5G1_CH1_OB5
 0x00070000

	)

1400 
	#AR_AN_RF5G1_CH1_OB5_S
 16

	)

1401 
	#AR_AN_RF5G1_CH1_DB5
 0x00380000

	)

1402 
	#AR_AN_RF5G1_CH1_DB5_S
 19

	)

1404 
	#AR_AN_TOP1
 0x7890

	)

1405 
	#AR_AN_TOP1_DACIPMODE
 0x00040000

	)

1406 
	#AR_AN_TOP1_DACIPMODE_S
 18

	)

1408 
	#AR_AN_TOP2
 0x7894

	)

1409 
	#AR_AN_TOP2_XPABIAS_LVL
 0xC0000000

	)

1410 
	#AR_AN_TOP2_XPABIAS_LVL_S
 30

	)

1411 
	#AR_AN_TOP2_LOCALBIAS
 0x00200000

	)

1412 
	#AR_AN_TOP2_LOCALBIAS_S
 21

	)

1413 
	#AR_AN_TOP2_PWDCLKIND
 0x00400000

	)

1414 
	#AR_AN_TOP2_PWDCLKIND_S
 22

	)

1416 
	#AR_AN_SYNTH9
 0x7868

	)

1417 
	#AR_AN_SYNTH9_REFDIVA
 0xf8000000

	)

1418 
	#AR_AN_SYNTH9_REFDIVA_S
 27

	)

1420 
	#AR9285_AN_RF2G1
 0x7820

	)

1421 
	#AR9285_AN_RF2G1_ENPACAL
 0x00000800

	)

1422 
	#AR9285_AN_RF2G1_ENPACAL_S
 11

	)

1423 
	#AR9285_AN_RF2G1_PDPADRV1
 0x02000000

	)

1424 
	#AR9285_AN_RF2G1_PDPADRV1_S
 25

	)

1425 
	#AR9285_AN_RF2G1_PDPADRV2
 0x01000000

	)

1426 
	#AR9285_AN_RF2G1_PDPADRV2_S
 24

	)

1427 
	#AR9285_AN_RF2G1_PDPAOUT
 0x00800000

	)

1428 
	#AR9285_AN_RF2G1_PDPAOUT_S
 23

	)

1431 
	#AR9285_AN_RF2G2
 0x7824

	)

1432 
	#AR9285_AN_RF2G2_OFFCAL
 0x00001000

	)

1433 
	#AR9285_AN_RF2G2_OFFCAL_S
 12

	)

1435 
	#AR9285_AN_RF2G3
 0x7828

	)

1436 
	#AR9285_AN_RF2G3_PDVCCOMP
 0x02000000

	)

1437 
	#AR9285_AN_RF2G3_PDVCCOMP_S
 25

	)

1438 
	#AR9285_AN_RF2G3_OB_0
 0x00E00000

	)

1439 
	#AR9285_AN_RF2G3_OB_0_S
 21

	)

1440 
	#AR9285_AN_RF2G3_OB_1
 0x001C0000

	)

1441 
	#AR9285_AN_RF2G3_OB_1_S
 18

	)

1442 
	#AR9285_AN_RF2G3_OB_2
 0x00038000

	)

1443 
	#AR9285_AN_RF2G3_OB_2_S
 15

	)

1444 
	#AR9285_AN_RF2G3_OB_3
 0x00007000

	)

1445 
	#AR9285_AN_RF2G3_OB_3_S
 12

	)

1446 
	#AR9285_AN_RF2G3_OB_4
 0x00000E00

	)

1447 
	#AR9285_AN_RF2G3_OB_4_S
 9

	)

1449 
	#AR9285_AN_RF2G3_DB1_0
 0x000001C0

	)

1450 
	#AR9285_AN_RF2G3_DB1_0_S
 6

	)

1451 
	#AR9285_AN_RF2G3_DB1_1
 0x00000038

	)

1452 
	#AR9285_AN_RF2G3_DB1_1_S
 3

	)

1453 
	#AR9285_AN_RF2G3_DB1_2
 0x00000007

	)

1454 
	#AR9285_AN_RF2G3_DB1_2_S
 0

	)

1455 
	#AR9285_AN_RF2G4
 0x782C

	)

1456 
	#AR9285_AN_RF2G4_DB1_3
 0xE0000000

	)

1457 
	#AR9285_AN_RF2G4_DB1_3_S
 29

	)

1458 
	#AR9285_AN_RF2G4_DB1_4
 0x1C000000

	)

1459 
	#AR9285_AN_RF2G4_DB1_4_S
 26

	)

1461 
	#AR9285_AN_RF2G4_DB2_0
 0x03800000

	)

1462 
	#AR9285_AN_RF2G4_DB2_0_S
 23

	)

1463 
	#AR9285_AN_RF2G4_DB2_1
 0x00700000

	)

1464 
	#AR9285_AN_RF2G4_DB2_1_S
 20

	)

1465 
	#AR9285_AN_RF2G4_DB2_2
 0x000E0000

	)

1466 
	#AR9285_AN_RF2G4_DB2_2_S
 17

	)

1467 
	#AR9285_AN_RF2G4_DB2_3
 0x0001C000

	)

1468 
	#AR9285_AN_RF2G4_DB2_3_S
 14

	)

1469 
	#AR9285_AN_RF2G4_DB2_4
 0x00003800

	)

1470 
	#AR9285_AN_RF2G4_DB2_4_S
 11

	)

1472 
	#AR9285_RF2G5
 0x7830

	)

1473 
	#AR9285_RF2G5_IC50TX
 0xfffff8ff

	)

1474 
	#AR9285_RF2G5_IC50TX_SET
 0x00000400

	)

1475 
	#AR9285_RF2G5_IC50TX_XE_SET
 0x00000500

	)

1476 
	#AR9285_RF2G5_IC50TX_CLEAR
 0x00000700

	)

1477 
	#AR9285_RF2G5_IC50TX_CLEAR_S
 8

	)

1480 
	#AR9271_AN_RF2G3_OB_cck
 0x001C0000

	)

1481 
	#AR9271_AN_RF2G3_OB_cck_S
 18

	)

1482 
	#AR9271_AN_RF2G3_OB_psk
 0x00038000

	)

1483 
	#AR9271_AN_RF2G3_OB_psk_S
 15

	)

1484 
	#AR9271_AN_RF2G3_OB_qam
 0x00007000

	)

1485 
	#AR9271_AN_RF2G3_OB_qam_S
 12

	)

1487 
	#AR9271_AN_RF2G3_DB_1
 0x00E00000

	)

1488 
	#AR9271_AN_RF2G3_DB_1_S
 21

	)

1490 
	#AR9271_AN_RF2G3_CCOMP
 0xFFF

	)

1491 
	#AR9271_AN_RF2G3_CCOMP_S
 0

	)

1493 
	#AR9271_AN_RF2G4_DB_2
 0xE0000000

	)

1494 
	#AR9271_AN_RF2G4_DB_2_S
 29

	)

1496 
	#AR9285_AN_RF2G6
 0x7834

	)

1497 
	#AR9285_AN_RF2G6_CCOMP
 0x00007800

	)

1498 
	#AR9285_AN_RF2G6_CCOMP_S
 11

	)

1499 
	#AR9285_AN_RF2G6_OFFS
 0x03f00000

	)

1500 
	#AR9285_AN_RF2G6_OFFS_S
 20

	)

1502 
	#AR9271_AN_RF2G6_OFFS
 0x07f00000

	)

1503 
	#AR9271_AN_RF2G6_OFFS_S
 20

	)

1505 
	#AR9285_AN_RF2G7
 0x7838

	)

1506 
	#AR9285_AN_RF2G7_PWDDB
 0x00000002

	)

1507 
	#AR9285_AN_RF2G7_PWDDB_S
 1

	)

1508 
	#AR9285_AN_RF2G7_PADRVGN2TAB0
 0xE0000000

	)

1509 
	#AR9285_AN_RF2G7_PADRVGN2TAB0_S
 29

	)

1511 
	#AR9285_AN_RF2G8
 0x783C

	)

1512 
	#AR9285_AN_RF2G8_PADRVGN2TAB0
 0x0001C000

	)

1513 
	#AR9285_AN_RF2G8_PADRVGN2TAB0_S
 14

	)

1516 
	#AR9285_AN_RF2G9
 0x7840

	)

1517 
	#AR9285_AN_RXTXBB1
 0x7854

	)

1518 
	#AR9285_AN_RXTXBB1_PDRXTXBB1
 0x00000020

	)

1519 
	#AR9285_AN_RXTXBB1_PDRXTXBB1_S
 5

	)

1520 
	#AR9285_AN_RXTXBB1_PDV2I
 0x00000080

	)

1521 
	#AR9285_AN_RXTXBB1_PDV2I_S
 7

	)

1522 
	#AR9285_AN_RXTXBB1_PDDACIF
 0x00000100

	)

1523 
	#AR9285_AN_RXTXBB1_PDDACIF_S
 8

	)

1524 
	#AR9285_AN_RXTXBB1_SPARE9
 0x00000001

	)

1525 
	#AR9285_AN_RXTXBB1_SPARE9_S
 0

	)

1527 
	#AR9285_AN_TOP2
 0x7868

	)

1529 
	#AR9285_AN_TOP3
 0x786c

	)

1530 
	#AR9285_AN_TOP3_XPABIAS_LVL
 0x0000000C

	)

1531 
	#AR9285_AN_TOP3_XPABIAS_LVL_S
 2

	)

1532 
	#AR9285_AN_TOP3_PWDDAC
 0x00800000

	)

1533 
	#AR9285_AN_TOP3_PWDDAC_S
 23

	)

1535 
	#AR9285_AN_TOP4
 0x7870

	)

1536 
	#AR9285_AN_TOP4_DEFAULT
 0x10142c00

	)

1538 
	#AR9287_AN_RF2G3_CH0
 0x7808

	)

1539 
	#AR9287_AN_RF2G3_CH1
 0x785c

	)

1540 
	#AR9287_AN_RF2G3_DB1
 0xE0000000

	)

1541 
	#AR9287_AN_RF2G3_DB1_S
 29

	)

1542 
	#AR9287_AN_RF2G3_DB2
 0x1C000000

	)

1543 
	#AR9287_AN_RF2G3_DB2_S
 26

	)

1544 
	#AR9287_AN_RF2G3_OB_CCK
 0x03800000

	)

1545 
	#AR9287_AN_RF2G3_OB_CCK_S
 23

	)

1546 
	#AR9287_AN_RF2G3_OB_PSK
 0x00700000

	)

1547 
	#AR9287_AN_RF2G3_OB_PSK_S
 20

	)

1548 
	#AR9287_AN_RF2G3_OB_QAM
 0x000E0000

	)

1549 
	#AR9287_AN_RF2G3_OB_QAM_S
 17

	)

1550 
	#AR9287_AN_RF2G3_OB_PAL_OFF
 0x0001C000

	)

1551 
	#AR9287_AN_RF2G3_OB_PAL_OFF_S
 14

	)

1553 
	#AR9287_AN_TXPC0
 0x7898

	)

1554 
	#AR9287_AN_TXPC0_TXPCMODE
 0x0000C000

	)

1555 
	#AR9287_AN_TXPC0_TXPCMODE_S
 14

	)

1556 
	#AR9287_AN_TXPC0_TXPCMODE_NORMAL
 0

	)

1557 
	#AR9287_AN_TXPC0_TXPCMODE_TEST
 1

	)

1558 
	#AR9287_AN_TXPC0_TXPCMODE_TEMPSENSE
 2

	)

1559 
	#AR9287_AN_TXPC0_TXPCMODE_ATBTEST
 3

	)

1561 
	#AR9287_AN_TOP2
 0x78b4

	)

1562 
	#AR9287_AN_TOP2_XPABIAS_LVL
 0xC0000000

	)

1563 
	#AR9287_AN_TOP2_XPABIAS_LVL_S
 30

	)

1566 
	#AR9271_RESET_POWER_DOWN_CONTROL
 0x50044

	)

1567 
	#AR9271_RADIO_RF_RST
 0x20

	)

1568 
	#AR9271_GATE_MAC_CTL
 0x4000

	)

1570 
	#AR_STA_ID1_STA_AP
 0x00010000

	)

1571 
	#AR_STA_ID1_ADHOC
 0x00020000

	)

1572 
	#AR_STA_ID1_PWR_SAV
 0x00040000

	)

1573 
	#AR_STA_ID1_KSRCHDIS
 0x00080000

	)

1574 
	#AR_STA_ID1_PCF
 0x00100000

	)

1575 
	#AR_STA_ID1_USE_DEFANT
 0x00200000

	)

1576 
	#AR_STA_ID1_DEFANT_UPDATE
 0x00400000

	)

1577 
	#AR_STA_ID1_AR9100_BA_FIX
 0x00400000

	)

1578 
	#AR_STA_ID1_RTS_USE_DEF
 0x00800000

	)

1579 
	#AR_STA_ID1_ACKCTS_6MB
 0x01000000

	)

1580 
	#AR_STA_ID1_BASE_RATE_11B
 0x02000000

	)

1581 
	#AR_STA_ID1_SECTOR_SELF_GEN
 0x04000000

	)

1582 
	#AR_STA_ID1_CRPT_MIC_ENABLE
 0x08000000

	)

1583 
	#AR_STA_ID1_KSRCH_MODE
 0x10000000

	)

1584 
	#AR_STA_ID1_PRESERVE_SEQNUM
 0x20000000

	)

1585 
	#AR_STA_ID1_CBCIV_ENDIAN
 0x40000000

	)

1586 
	#AR_STA_ID1_MCAST_KSRCH
 0x80000000

	)

1588 
	#AR_BSS_ID0
 0x8008

	)

1589 
	#AR_BSS_ID1
 0x800C

	)

1590 
	#AR_BSS_ID1_U16
 0x0000FFFF

	)

1591 
	#AR_BSS_ID1_AID
 0x07FF0000

	)

1592 
	#AR_BSS_ID1_AID_S
 16

	)

1594 
	#AR_BCN_RSSI_AVE
 0x8010

	)

1595 
	#AR_BCN_RSSI_AVE_MASK
 0x00000FFF

	)

1597 
	#AR_TIME_OUT
 0x8014

	)

1598 
	#AR_TIME_OUT_ACK
 0x00003FFF

	)

1599 
	#AR_TIME_OUT_ACK_S
 0

	)

1600 
	#AR_TIME_OUT_CTS
 0x3FFF0000

	)

1601 
	#AR_TIME_OUT_CTS_S
 16

	)

1603 
	#AR_RSSI_THR
 0x8018

	)

1604 
	#AR_RSSI_THR_MASK
 0x000000FF

	)

1605 
	#AR_RSSI_THR_BM_THR
 0x0000FF00

	)

1606 
	#AR_RSSI_THR_BM_THR_S
 8

	)

1607 
	#AR_RSSI_BCN_WEIGHT
 0x1F000000

	)

1608 
	#AR_RSSI_BCN_WEIGHT_S
 24

	)

1609 
	#AR_RSSI_BCN_RSSI_RST
 0x20000000

	)

1611 
	#AR_USEC
 0x801c

	)

1612 
	#AR_USEC_USEC
 0x0000007F

	)

1613 
	#AR_USEC_TX_LAT
 0x007FC000

	)

1614 
	#AR_USEC_TX_LAT_S
 14

	)

1615 
	#AR_USEC_RX_LAT
 0x1F800000

	)

1616 
	#AR_USEC_RX_LAT_S
 23

	)

1617 
	#AR_USEC_ASYNC_FIFO
 0x12E00074

	)

1619 
	#AR_RESET_TSF
 0x8020

	)

1620 
	#AR_RESET_TSF_ONCE
 0x01000000

	)

1621 
	#AR_RESET_TSF2_ONCE
 0x02000000

	)

1623 
	#AR_MAX_CFP_DUR
 0x8038

	)

1624 
	#AR_CFP_VAL
 0x0000FFFF

	)

1626 
	#AR_RX_FILTER
 0x803C

	)

1628 
	#AR_MCAST_FIL0
 0x8040

	)

1629 
	#AR_MCAST_FIL1
 0x8044

	)

1640 
	#AR_DIAG_SW
 0x8048

	)

1641 
	#AR_DIAG_CACHE_ACK
 0x00000001

	)

1642 
	#AR_DIAG_ACK_DIS
 0x00000002

	)

1643 
	#AR_DIAG_CTS_DIS
 0x00000004

	)

1644 
	#AR_DIAG_ENCRYPT_DIS
 0x00000008

	)

1645 
	#AR_DIAG_DECRYPT_DIS
 0x00000010

	)

1646 
	#AR_DIAG_RX_DIS
 0x00000020

	)

1647 
	#AR_DIAG_LOOP_BACK
 0x00000040

	)

1648 
	#AR_DIAG_CORR_FCS
 0x00000080

	)

1649 
	#AR_DIAG_CHAN_INFO
 0x00000100

	)

1650 
	#AR_DIAG_SCRAM_SEED
 0x0001FE00

	)

1651 
	#AR_DIAG_SCRAM_SEED_S
 8

	)

1652 
	#AR_DIAG_FRAME_NV0
 0x00020000

	)

1653 
	#AR_DIAG_OBS_PT_SEL1
 0x000C0000

	)

1654 
	#AR_DIAG_OBS_PT_SEL1_S
 18

	)

1655 
	#AR_DIAG_OBS_PT_SEL2
 0x08000000

	)

1656 
	#AR_DIAG_OBS_PT_SEL2_S
 27

	)

1657 
	#AR_DIAG_FORCE_RX_CLEAR
 0x00100000

	)

1658 
	#AR_DIAG_IGNORE_VIRT_CS
 0x00200000

	)

1659 
	#AR_DIAG_FORCE_CH_IDLE_HIGH
 0x00400000

	)

1660 
	#AR_DIAG_EIFS_CTRL_ENA
 0x00800000

	)

1661 
	#AR_DIAG_DUAL_CHAIN_INFO
 0x01000000

	)

1662 
	#AR_DIAG_RX_ABORT
 0x02000000

	)

1663 
	#AR_DIAG_SATURATE_CYCLE_CNT
 0x04000000

	)

1664 
	#AR_DIAG_OBS_PT_SEL2
 0x08000000

	)

1665 
	#AR_DIAG_RX_CLEAR_CTL_LOW
 0x10000000

	)

1666 
	#AR_DIAG_RX_CLEAR_EXT_LOW
 0x20000000

	)

1668 
	#AR_TSF_L32
 0x804c

	)

1669 
	#AR_TSF_U32
 0x8050

	)

1671 
	#AR_TST_ADDAC
 0x8054

	)

1672 
	#AR_DEF_ANTENNA
 0x8058

	)

1674 
	#AR_AES_MUTE_MASK0
 0x805c

	)

1675 
	#AR_AES_MUTE_MASK0_FC
 0x0000FFFF

	)

1676 
	#AR_AES_MUTE_MASK0_QOS
 0xFFFF0000

	)

1677 
	#AR_AES_MUTE_MASK0_QOS_S
 16

	)

1679 
	#AR_AES_MUTE_MASK1
 0x8060

	)

1680 
	#AR_AES_MUTE_MASK1_SEQ
 0x0000FFFF

	)

1681 
	#AR_AES_MUTE_MASK1_FC_MGMT
 0xFFFF0000

	)

1682 
	#AR_AES_MUTE_MASK1_FC_MGMT_S
 16

	)

1684 
	#AR_GATED_CLKS
 0x8064

	)

1685 
	#AR_GATED_CLKS_TX
 0x00000002

	)

1686 
	#AR_GATED_CLKS_RX
 0x00000004

	)

1687 
	#AR_GATED_CLKS_REG
 0x00000008

	)

1689 
	#AR_OBS_BUS_CTRL
 0x8068

	)

1690 
	#AR_OBS_BUS_SEL_1
 0x00040000

	)

1691 
	#AR_OBS_BUS_SEL_2
 0x00080000

	)

1692 
	#AR_OBS_BUS_SEL_3
 0x000C0000

	)

1693 
	#AR_OBS_BUS_SEL_4
 0x08040000

	)

1694 
	#AR_OBS_BUS_SEL_5
 0x08080000

	)

1696 
	#AR_OBS_BUS_1
 0x806c

	)

1697 
	#AR_OBS_BUS_1_PCU
 0x00000001

	)

1698 
	#AR_OBS_BUS_1_RX_END
 0x00000002

	)

1699 
	#AR_OBS_BUS_1_RX_WEP
 0x00000004

	)

1700 
	#AR_OBS_BUS_1_RX_BEACON
 0x00000008

	)

1701 
	#AR_OBS_BUS_1_RX_FILTER
 0x00000010

	)

1702 
	#AR_OBS_BUS_1_TX_HCF
 0x00000020

	)

1703 
	#AR_OBS_BUS_1_QUIET_TIME
 0x00000040

	)

1704 
	#AR_OBS_BUS_1_CHAN_IDLE
 0x00000080

	)

1705 
	#AR_OBS_BUS_1_TX_HOLD
 0x00000100

	)

1706 
	#AR_OBS_BUS_1_TX_FRAME
 0x00000200

	)

1707 
	#AR_OBS_BUS_1_RX_FRAME
 0x00000400

	)

1708 
	#AR_OBS_BUS_1_RX_CLEAR
 0x00000800

	)

1709 
	#AR_OBS_BUS_1_WEP_STATE
 0x0003F000

	)

1710 
	#AR_OBS_BUS_1_WEP_STATE_S
 12

	)

1711 
	#AR_OBS_BUS_1_RX_STATE
 0x01F00000

	)

1712 
	#AR_OBS_BUS_1_RX_STATE_S
 20

	)

1713 
	#AR_OBS_BUS_1_TX_STATE
 0x7E000000

	)

1714 
	#AR_OBS_BUS_1_TX_STATE_S
 25

	)

1716 
	#AR_LAST_TSTP
 0x8080

	)

1717 
	#AR_NAV
 0x8084

	)

1718 
	#AR_RTS_OK
 0x8088

	)

1719 
	#AR_RTS_FAIL
 0x808c

	)

1720 
	#AR_ACK_FAIL
 0x8090

	)

1721 
	#AR_FCS_FAIL
 0x8094

	)

1722 
	#AR_BEACON_CNT
 0x8098

	)

1724 
	#AR_SLEEP1
 0x80d4

	)

1725 
	#AR_SLEEP1_ASSUME_DTIM
 0x00080000

	)

1726 
	#AR_SLEEP1_CAB_TIMEOUT
 0xFFE00000

	)

1727 
	#AR_SLEEP1_CAB_TIMEOUT_S
 21

	)

1729 
	#AR_SLEEP2
 0x80d8

	)

1730 
	#AR_SLEEP2_BEACON_TIMEOUT
 0xFFE00000

	)

1731 
	#AR_SLEEP2_BEACON_TIMEOUT_S
 21

	)

1733 
	#AR_TPC
 0x80e8

	)

1734 
	#AR_TPC_ACK
 0x0000003f

	)

1735 
	#AR_TPC_ACK_S
 0

	)

1736 
	#AR_TPC_CTS
 0x00003f00

	)

1737 
	#AR_TPC_CTS_S
 8

	)

1738 
	#AR_TPC_CHIRP
 0x003f0000

	)

1739 
	#AR_TPC_CHIRP_S
 16

	)

1740 
	#AR_TPC_RPT
 0x3f000000

	)

1741 
	#AR_TPC_RPT_S
 24

	)

1743 
	#AR_QUIET1
 0x80fc

	)

1744 
	#AR_QUIET1_NEXT_QUIET_S
 0

	)

1745 
	#AR_QUIET1_NEXT_QUIET_M
 0x0000ffff

	)

1746 
	#AR_QUIET1_QUIET_ENABLE
 0x00010000

	)

1747 
	#AR_QUIET1_QUIET_ACK_CTS_ENABLE
 0x00020000

	)

1748 
	#AR_QUIET1_QUIET_ACK_CTS_ENABLE_S
 17

	)

1749 
	#AR_QUIET2
 0x8100

	)

1750 
	#AR_QUIET2_QUIET_PERIOD_S
 0

	)

1751 
	#AR_QUIET2_QUIET_PERIOD_M
 0x0000ffff

	)

1752 
	#AR_QUIET2_QUIET_DUR_S
 16

	)

1753 
	#AR_QUIET2_QUIET_DUR
 0xffff0000

	)

1755 
	#AR_TSF_PARM
 0x8104

	)

1756 
	#AR_TSF_INCREMENT_M
 0x000000ff

	)

1757 
	#AR_TSF_INCREMENT_S
 0x00

	)

1759 
	#AR_QOS_NO_ACK
 0x8108

	)

1760 
	#AR_QOS_NO_ACK_TWO_BIT
 0x0000000f

	)

1761 
	#AR_QOS_NO_ACK_TWO_BIT_S
 0

	)

1762 
	#AR_QOS_NO_ACK_BIT_OFF
 0x00000070

	)

1763 
	#AR_QOS_NO_ACK_BIT_OFF_S
 4

	)

1764 
	#AR_QOS_NO_ACK_BYTE_OFF
 0x00000180

	)

1765 
	#AR_QOS_NO_ACK_BYTE_OFF_S
 7

	)

1767 
	#AR_PHY_ERR
 0x810c

	)

1769 
	#AR_PHY_ERR_DCHIRP
 0x00000008

	)

1770 
	#AR_PHY_ERR_RADAR
 0x00000020

	)

1771 
	#AR_PHY_ERR_OFDM_TIMING
 0x00020000

	)

1772 
	#AR_PHY_ERR_CCK_TIMING
 0x02000000

	)

1774 
	#AR_RXFIFO_CFG
 0x8114

	)

1777 
	#AR_MIC_QOS_CONTROL
 0x8118

	)

1778 
	#AR_MIC_QOS_SELECT
 0x811c

	)

1780 
	#AR_PCU_MISC
 0x8120

	)

1781 
	#AR_PCU_FORCE_BSSID_MATCH
 0x00000001

	)

1782 
	#AR_PCU_MIC_NEW_LOC_ENA
 0x00000004

	)

1783 
	#AR_PCU_TX_ADD_TSF
 0x00000008

	)

1784 
	#AR_PCU_CCK_SIFS_MODE
 0x00000010

	)

1785 
	#AR_PCU_RX_ANT_UPDT
 0x00000800

	)

1786 
	#AR_PCU_TXOP_TBTT_LIMIT_ENA
 0x00001000

	)

1787 
	#AR_PCU_MISS_BCN_IN_SLEEP
 0x00004000

	)

1788 
	#AR_PCU_BUG_12306_FIX_ENA
 0x00020000

	)

1789 
	#AR_PCU_FORCE_QUIET_COLL
 0x00040000

	)

1790 
	#AR_PCU_TBTT_PROTECT
 0x00200000

	)

1791 
	#AR_PCU_CLEAR_VMF
 0x01000000

	)

1792 
	#AR_PCU_CLEAR_BA_VALID
 0x04000000

	)

1793 
	#AR_PCU_ALWAYS_PERFORM_KEYSEARCH
 0x10000000

	)

1795 
	#AR_PCU_BT_ANT_PREVENT_RX
 0x00100000

	)

1796 
	#AR_PCU_BT_ANT_PREVENT_RX_S
 20

	)

1798 
	#AR_FILT_OFDM
 0x8124

	)

1799 
	#AR_FILT_OFDM_COUNT
 0x00FFFFFF

	)

1801 
	#AR_FILT_CCK
 0x8128

	)

1802 
	#AR_FILT_CCK_COUNT
 0x00FFFFFF

	)

1804 
	#AR_PHY_ERR_1
 0x812c

	)

1805 
	#AR_PHY_ERR_1_COUNT
 0x00FFFFFF

	)

1806 
	#AR_PHY_ERR_MASK_1
 0x8130

	)

1808 
	#AR_PHY_ERR_2
 0x8134

	)

1809 
	#AR_PHY_ERR_2_COUNT
 0x00FFFFFF

	)

1810 
	#AR_PHY_ERR_MASK_2
 0x8138

	)

1812 
	#AR_PHY_COUNTMAX
 (3 << 22)

	)

1813 
	#AR_MIBCNT_INTRMASK
 (3 << 22)

	)

1815 
	#AR_TSFOOR_THRESHOLD
 0x813c

	)

1816 
	#AR_TSFOOR_THRESHOLD_VAL
 0x0000FFFF

	)

1818 
	#AR_PHY_ERR_EIFS_MASK
 0x8144

	)

1820 
	#AR_PHY_ERR_3
 0x8168

	)

1821 
	#AR_PHY_ERR_3_COUNT
 0x00FFFFFF

	)

1822 
	#AR_PHY_ERR_MASK_3
 0x816c

	)

1824 
	#AR_BT_COEX_MODE
 0x8170

	)

1825 
	#AR_BT_TIME_EXTEND
 0x000000ff

	)

1826 
	#AR_BT_TIME_EXTEND_S
 0

	)

1827 
	#AR_BT_TXSTATE_EXTEND
 0x00000100

	)

1828 
	#AR_BT_TXSTATE_EXTEND_S
 8

	)

1829 
	#AR_BT_TX_FRAME_EXTEND
 0x00000200

	)

1830 
	#AR_BT_TX_FRAME_EXTEND_S
 9

	)

1831 
	#AR_BT_MODE
 0x00000c00

	)

1832 
	#AR_BT_MODE_S
 10

	)

1833 
	#AR_BT_QUIET
 0x00001000

	)

1834 
	#AR_BT_QUIET_S
 12

	)

1835 
	#AR_BT_QCU_THRESH
 0x0001e000

	)

1836 
	#AR_BT_QCU_THRESH_S
 13

	)

1837 
	#AR_BT_RX_CLEAR_POLARITY
 0x00020000

	)

1838 
	#AR_BT_RX_CLEAR_POLARITY_S
 17

	)

1839 
	#AR_BT_PRIORITY_TIME
 0x00fc0000

	)

1840 
	#AR_BT_PRIORITY_TIME_S
 18

	)

1841 
	#AR_BT_FIRST_SLOT_TIME
 0xff000000

	)

1842 
	#AR_BT_FIRST_SLOT_TIME_S
 24

	)

1844 
	#AR_BT_COEX_WEIGHT
 0x8174

	)

1845 
	#AR_BT_COEX_WGHT
 0xff55

	)

1846 
	#AR_STOMP_ALL_WLAN_WGHT
 0xfcfc

	)

1847 
	#AR_STOMP_LOW_WLAN_WGHT
 0xa8a8

	)

1848 
	#AR_STOMP_NONE_WLAN_WGHT
 0x0000

	)

1849 
	#AR_BTCOEX_BT_WGHT
 0x0000ffff

	)

1850 
	#AR_BTCOEX_BT_WGHT_S
 0

	)

1851 
	#AR_BTCOEX_WL_WGHT
 0xffff0000

	)

1852 
	#AR_BTCOEX_WL_WGHT_S
 16

	)

1854 
	#AR_BT_COEX_WL_WEIGHTS0
 0x8174

	)

1855 
	#AR_BT_COEX_WL_WEIGHTS1
 0x81c4

	)

1856 
	#AR_MCI_COEX_WL_WEIGHTS
(
_i
Ë(0x18b0 + (_ò<< 2))

	)

1857 
	#AR_BT_COEX_BT_WEIGHTS
(
_i
Ë(0x83a¯+ (_ò<< 2))

	)

1859 
	#AR9300_BT_WGHT
 0xcccc4444

	)

1861 
	#AR_BT_COEX_MODE2
 0x817c

	)

1862 
	#AR_BT_BCN_MISS_THRESH
 0x000000ff

	)

1863 
	#AR_BT_BCN_MISS_THRESH_S
 0

	)

1864 
	#AR_BT_BCN_MISS_CNT
 0x0000ff00

	)

1865 
	#AR_BT_BCN_MISS_CNT_S
 8

	)

1866 
	#AR_BT_HOLD_RX_CLEAR
 0x00010000

	)

1867 
	#AR_BT_HOLD_RX_CLEAR_S
 16

	)

1868 
	#AR_BT_DISABLE_BT_ANT
 0x00100000

	)

1869 
	#AR_BT_DISABLE_BT_ANT_S
 20

	)

1871 
	#AR_TXSIFS
 0x81d0

	)

1872 
	#AR_TXSIFS_TIME
 0x000000FF

	)

1873 
	#AR_TXSIFS_TX_LATENCY
 0x00000F00

	)

1874 
	#AR_TXSIFS_TX_LATENCY_S
 8

	)

1875 
	#AR_TXSIFS_ACK_SHIFT
 0x00007000

	)

1876 
	#AR_TXSIFS_ACK_SHIFT_S
 12

	)

1878 
	#AR_TXOP_X
 0x81ec

	)

1879 
	#AR_TXOP_X_VAL
 0x000000FF

	)

1882 
	#AR_TXOP_0_3
 0x81f0

	)

1883 
	#AR_TXOP_4_7
 0x81f4

	)

1884 
	#AR_TXOP_8_11
 0x81f8

	)

1885 
	#AR_TXOP_12_15
 0x81fc

	)

1887 
	#AR_NEXT_NDP2_TIMER
 0x8180

	)

1888 
	#AR_GEN_TIMER_BANK_1_LEN
 8

	)

1889 
	#AR_FIRST_NDP_TIMER
 7

	)

1890 
	#AR_NDP2_PERIOD
 0x81a0

	)

1891 
	#AR_NDP2_TIMER_MODE
 0x81c0

	)

1892 
	#AR_GEN_TIMERS2_MODE_ENABLE_MASK
 0x000000FF

	)

1894 
	#AR_GEN_TIMERS
(
_i
Ë(0x8200 + ((_iË<< 2))

	)

1895 
	#AR_NEXT_TBTT_TIMER
 
	`AR_GEN_TIMERS
(0)

	)

1896 
	#AR_NEXT_DMA_BEACON_ALERT
 
	`AR_GEN_TIMERS
(1)

	)

1897 
	#AR_NEXT_SWBA
 
	`AR_GEN_TIMERS
(2)

	)

1898 
	#AR_NEXT_CFP
 
	`AR_GEN_TIMERS
(2)

	)

1899 
	#AR_NEXT_HCF
 
	`AR_GEN_TIMERS
(3)

	)

1900 
	#AR_NEXT_TIM
 
	`AR_GEN_TIMERS
(4)

	)

1901 
	#AR_NEXT_DTIM
 
	`AR_GEN_TIMERS
(5)

	)

1902 
	#AR_NEXT_QUIET_TIMER
 
	`AR_GEN_TIMERS
(6)

	)

1903 
	#AR_NEXT_NDP_TIMER
 
	`AR_GEN_TIMERS
(7)

	)

1905 
	#AR_BEACON_PERIOD
 
	`AR_GEN_TIMERS
(8)

	)

1906 
	#AR_DMA_BEACON_PERIOD
 
	`AR_GEN_TIMERS
(9)

	)

1907 
	#AR_SWBA_PERIOD
 
	`AR_GEN_TIMERS
(10)

	)

1908 
	#AR_HCF_PERIOD
 
	`AR_GEN_TIMERS
(11)

	)

1909 
	#AR_TIM_PERIOD
 
	`AR_GEN_TIMERS
(12)

	)

1910 
	#AR_DTIM_PERIOD
 
	`AR_GEN_TIMERS
(13)

	)

1911 
	#AR_QUIET_PERIOD
 
	`AR_GEN_TIMERS
(14)

	)

1912 
	#AR_NDP_PERIOD
 
	`AR_GEN_TIMERS
(15)

	)

1914 
	#AR_TIMER_MODE
 0x8240

	)

1915 
	#AR_TBTT_TIMER_EN
 0x00000001

	)

1916 
	#AR_DBA_TIMER_EN
 0x00000002

	)

1917 
	#AR_SWBA_TIMER_EN
 0x00000004

	)

1918 
	#AR_HCF_TIMER_EN
 0x00000008

	)

1919 
	#AR_TIM_TIMER_EN
 0x00000010

	)

1920 
	#AR_DTIM_TIMER_EN
 0x00000020

	)

1921 
	#AR_QUIET_TIMER_EN
 0x00000040

	)

1922 
	#AR_NDP_TIMER_EN
 0x00000080

	)

1923 
	#AR_TIMER_OVERFLOW_INDEX
 0x00000700

	)

1924 
	#AR_TIMER_OVERFLOW_INDEX_S
 8

	)

1925 
	#AR_TIMER_THRESH
 0xFFFFF000

	)

1926 
	#AR_TIMER_THRESH_S
 12

	)

1928 
	#AR_SLP32_MODE
 0x8244

	)

1929 
	#AR_SLP32_HALF_CLK_LATENCY
 0x000FFFFF

	)

1930 
	#AR_SLP32_ENA
 0x00100000

	)

1931 
	#AR_SLP32_TSF_WRITE_STATUS
 0x00200000

	)

1933 
	#AR_SLP32_WAKE
 0x8248

	)

1934 
	#AR_SLP32_WAKE_XTL_TIME
 0x0000FFFF

	)

1936 
	#AR_SLP32_INC
 0x824c

	)

1937 
	#AR_SLP32_TST_INC
 0x000FFFFF

	)

1939 
	#AR_SLP_CNT
 0x8250

	)

1940 
	#AR_SLP_CYCLE_CNT
 0x8254

	)

1942 
	#AR_SLP_MIB_CTRL
 0x8258

	)

1943 
	#AR_SLP_MIB_CLEAR
 0x00000001

	)

1944 
	#AR_SLP_MIB_PENDING
 0x00000002

	)

1946 
	#AR_MAC_PCU_LOGIC_ANALYZER
 0x8264

	)

1947 
	#AR_MAC_PCU_LOGIC_ANALYZER_DISBUG20768
 0x20000000

	)

1950 
	#AR_2040_MODE
 0x8318

	)

1951 
	#AR_2040_JOINED_RX_CLEAR
 0x00000001

	)

1954 
	#AR_EXTRCCNT
 0x8328

	)

1956 
	#AR_SELFGEN_MASK
 0x832c

	)

1958 
	#AR_PCU_TXBUF_CTRL
 0x8340

	)

1959 
	#AR_PCU_TXBUF_CTRL_SIZE_MASK
 0x7FF

	)

1960 
	#AR_PCU_TXBUF_CTRL_USABLE_SIZE
 0x700

	)

1961 
	#AR_9285_PCU_TXBUF_CTRL_USABLE_SIZE
 0x380

	)

1962 
	#AR_9340_PCU_TXBUF_CTRL_USABLE_SIZE
 0x500

	)

1964 
	#AR_PCU_MISC_MODE2
 0x8344

	)

1965 
	#AR_PCU_MISC_MODE2_MGMT_CRYPTO_ENABLE
 0x00000002

	)

1966 
	#AR_PCU_MISC_MODE2_NO_CRYPTO_FOR_NON_DATA_PKT
 0x00000004

	)

1968 
	#AR_PCU_MISC_MODE2_RESERVED
 0x00000038

	)

1969 
	#AR_PCU_MISC_MODE2_ADHOC_MCAST_KEYID_ENABLE
 0x00000040

	)

1970 
	#AR_PCU_MISC_MODE2_CFP_IGNORE
 0x00000080

	)

1971 
	#AR_PCU_MISC_MODE2_MGMT_QOS
 0x0000FF00

	)

1972 
	#AR_PCU_MISC_MODE2_MGMT_QOS_S
 8

	)

1973 
	#AR_PCU_MISC_MODE2_ENABLE_LOAD_NAV_BEACON_DURATION
 0x00010000

	)

1974 
	#AR_PCU_MISC_MODE2_ENABLE_AGGWEP
 0x00020000

	)

1975 
	#AR_PCU_MISC_MODE2_HWWAR1
 0x00100000

	)

1976 
	#AR_PCU_MISC_MODE2_HWWAR2
 0x02000000

	)

1977 
	#AR_PCU_MISC_MODE2_RESERVED2
 0xFFFE0000

	)

1979 
	#AR_PCU_MISC_MODE3
 0x83d0

	)

1981 
	#AR_MAC_PCU_ASYNC_FIFO_REG3
 0x8358

	)

1982 
	#AR_MAC_PCU_ASYNC_FIFO_REG3_DATAPATH_SEL
 0x00000400

	)

1983 
	#AR_MAC_PCU_ASYNC_FIFO_REG3_SOFT_RESET
 0x80000000

	)

1984 
	#AR_MAC_PCU_GEN_TIMER_TSF_SEL
 0x83d8

	)

1986 
	#AR_DIRECT_CONNECT
 0x83a0

	)

1987 
	#AR_DC_AP_STA_EN
 0x00000001

	)

1988 
	#AR_DC_TSF2_ENABLE
 0x00000001

	)

1990 
	#AR_AES_MUTE_MASK0
 0x805c

	)

1991 
	#AR_AES_MUTE_MASK0_FC
 0x0000FFFF

	)

1992 
	#AR_AES_MUTE_MASK0_QOS
 0xFFFF0000

	)

1993 
	#AR_AES_MUTE_MASK0_QOS_S
 16

	)

1995 
	#AR_AES_MUTE_MASK1
 0x8060

	)

1996 
	#AR_AES_MUTE_MASK1_SEQ
 0x0000FFFF

	)

1997 
	#AR_AES_MUTE_MASK1_SEQ_S
 0

	)

1998 
	#AR_AES_MUTE_MASK1_FC_MGMT
 0xFFFF0000

	)

1999 
	#AR_AES_MUTE_MASK1_FC_MGMT_S
 16

	)

2001 
	#AR_RATE_DURATION_0
 0x8700

	)

2002 
	#AR_RATE_DURATION_31
 0x87CC

	)

2003 
	#AR_RATE_DURATION_32
 0x8780

	)

2004 
	#AR_RATE_DURATION
(
_n
Ë(
AR_RATE_DURATION_0
 + ((_n)<<2))

	)

2008 
	#AR_PMCTRL_AUX_PWR_DET
 0x10000000

	)

2009 
	#AR_PMCTRL_D3COLD_VAUX
 0x00800000

	)

2010 
	#AR_PMCTRL_HOST_PME_EN
 0x00400000

	)

2012 
	#AR_PMCTRL_WOW_PME_CLR
 0x00200000

	)

2013 
	#AR_PMCTRL_PWR_STATE_MASK
 0x0f000000

	)

2014 
	#AR_PMCTRL_PWR_STATE_D1D3
 0x0f000000

	)

2015 
	#AR_PMCTRL_PWR_STATE_D1D3_REAL
 0x0f000000

	)

2016 
	#AR_PMCTRL_PWR_STATE_D0
 0x08000000

	)

2017 
	#AR_PMCTRL_PWR_PM_CTRL_ENA
 0x00008000

	)

2019 
	#AR_WOW_BEACON_TIMO_MAX
 0xffffffff

	)

2021 
	#AR9271_CORE_CLOCK
 117

	)

2022 
	#AR9271_TARGET_BAUD_RATE
 19200

	)

2024 
	#AR_AGG_WEP_ENABLE_FIX
 0x00000008

	)

2025 
	#AR_ADHOC_MCAST_KEYID_ENABLE
 0x00000040

	)

2031 
	#AR_AGG_WEP_ENABLE
 0x00020000

	)

2037 
	#AR9300_SM_BASE
 0xa200

	)

2038 
	#AR9002_PHY_AGC_CONTROL
 0x9860

	)

2039 
	#AR9003_PHY_AGC_CONTROL
 
AR9300_SM_BASE
 + 0xc4

	)

2040 
	#AR_PHY_AGC_CONTROL
 (
	`AR_SREV_9300_20_OR_LATER
(
ah
Ë? 
AR9003_PHY_AGC_CONTROL
 : 
AR9002_PHY_AGC_CONTROL
)

	)

2041 
	#AR_PHY_AGC_CONTROL_CAL
 0x00000001

	)

2042 
	#AR_PHY_AGC_CONTROL_NF
 0x00000002

	)

2043 
	#AR_PHY_AGC_CONTROL_OFFSET_CAL
 0x00000800

	)

2044 
	#AR_PHY_AGC_CONTROL_ENABLE_NF
 0x00008000

	)

2045 
	#AR_PHY_AGC_CONTROL_FLTR_CAL
 0x00010000

	)

2046 
	#AR_PHY_AGC_CONTROL_NO_UPDATE_NF
 0x00020000

	)

2047 
	#AR_PHY_AGC_CONTROL_EXT_NF_PWR_MEAS
 0x00040000

	)

2048 
	#AR_PHY_AGC_CONTROL_CLC_SUCCESS
 0x00080000

	)

2049 
	#AR_PHY_AGC_CONTROL_PKDET_CAL
 0x00100000

	)

2050 
	#AR_PHY_AGC_CONTROL_YCOK_MAX
 0x000003c0

	)

2051 
	#AR_PHY_AGC_CONTROL_YCOK_MAX_S
 6

	)

	@reg_aic.h

17 #i‚de‡
REG_AIC_H


18 
	#REG_AIC_H


	)

20 
	#AR_SM_BASE
 0xa200

	)

21 
	#AR_SM1_BASE
 0xb200

	)

22 
	#AR_AGC_BASE
 0x9e00

	)

24 
	#AR_PHY_AIC_CTRL_0_B0
 (
AR_SM_BASE
 + 0x4b0)

	)

25 
	#AR_PHY_AIC_CTRL_1_B0
 (
AR_SM_BASE
 + 0x4b4)

	)

26 
	#AR_PHY_AIC_CTRL_2_B0
 (
AR_SM_BASE
 + 0x4b8)

	)

27 
	#AR_PHY_AIC_CTRL_3_B0
 (
AR_SM_BASE
 + 0x4bc)

	)

28 
	#AR_PHY_AIC_CTRL_4_B0
 (
AR_SM_BASE
 + 0x4c0)

	)

30 
	#AR_PHY_AIC_STAT_0_B0
 (
AR_SM_BASE
 + 0x4c4)

	)

31 
	#AR_PHY_AIC_STAT_1_B0
 (
AR_SM_BASE
 + 0x4c8)

	)

32 
	#AR_PHY_AIC_STAT_2_B0
 (
AR_SM_BASE
 + 0x4cc)

	)

34 
	#AR_PHY_AIC_CTRL_0_B1
 (
AR_SM1_BASE
 + 0x4b0)

	)

35 
	#AR_PHY_AIC_CTRL_1_B1
 (
AR_SM1_BASE
 + 0x4b4)

	)

36 
	#AR_PHY_AIC_CTRL_4_B1
 (
AR_SM1_BASE
 + 0x4c0)

	)

38 
	#AR_PHY_AIC_STAT_0_B1
 (
AR_SM1_BASE
 + 0x4c4)

	)

39 
	#AR_PHY_AIC_STAT_1_B1
 (
AR_SM1_BASE
 + 0x4c8)

	)

40 
	#AR_PHY_AIC_STAT_2_B1
 (
AR_SM1_BASE
 + 0x4cc)

	)

42 
	#AR_PHY_AIC_SRAM_ADDR_B0
 (
AR_SM_BASE
 + 0x5f0)

	)

43 
	#AR_PHY_AIC_SRAM_DATA_B0
 (
AR_SM_BASE
 + 0x5f4)

	)

45 
	#AR_PHY_AIC_SRAM_ADDR_B1
 (
AR_SM1_BASE
 + 0x5f0)

	)

46 
	#AR_PHY_AIC_SRAM_DATA_B1
 (
AR_SM1_BASE
 + 0x5f4)

	)

48 
	#AR_PHY_BT_COEX_4
 (
AR_AGC_BASE
 + 0x60)

	)

49 
	#AR_PHY_BT_COEX_5
 (
AR_AGC_BASE
 + 0x64)

	)

52 
	#AR_PHY_AIC_MON_ENABLE
 0x80000000

	)

53 
	#AR_PHY_AIC_MON_ENABLE_S
 31

	)

54 
	#AR_PHY_AIC_CAL_MAX_HOP_COUNT
 0x7F000000

	)

55 
	#AR_PHY_AIC_CAL_MAX_HOP_COUNT_S
 24

	)

56 
	#AR_PHY_AIC_CAL_MIN_VALID_COUNT
 0x00FE0000

	)

57 
	#AR_PHY_AIC_CAL_MIN_VALID_COUNT_S
 17

	)

58 
	#AR_PHY_AIC_F_WLAN
 0x0001FC00

	)

59 
	#AR_PHY_AIC_F_WLAN_S
 10

	)

60 
	#AR_PHY_AIC_CAL_CH_VALID_RESET
 0x00000200

	)

61 
	#AR_PHY_AIC_CAL_CH_VALID_RESET_S
 9

	)

62 
	#AR_PHY_AIC_CAL_ENABLE
 0x00000100

	)

63 
	#AR_PHY_AIC_CAL_ENABLE_S
 8

	)

64 
	#AR_PHY_AIC_BTTX_PWR_THR
 0x000000FE

	)

65 
	#AR_PHY_AIC_BTTX_PWR_THR_S
 1

	)

66 
	#AR_PHY_AIC_ENABLE
 0x00000001

	)

67 
	#AR_PHY_AIC_ENABLE_S
 0

	)

68 
	#AR_PHY_AIC_CAL_BT_REF_DELAY
 0x00F00000

	)

69 
	#AR_PHY_AIC_CAL_BT_REF_DELAY_S
 20

	)

70 
	#AR_PHY_AIC_BT_IDLE_CFG
 0x00080000

	)

71 
	#AR_PHY_AIC_BT_IDLE_CFG_S
 19

	)

72 
	#AR_PHY_AIC_STDBY_COND
 0x00060000

	)

73 
	#AR_PHY_AIC_STDBY_COND_S
 17

	)

74 
	#AR_PHY_AIC_STDBY_ROT_ATT_DB
 0x0001F800

	)

75 
	#AR_PHY_AIC_STDBY_ROT_ATT_DB_S
 11

	)

76 
	#AR_PHY_AIC_STDBY_COM_ATT_DB
 0x00000700

	)

77 
	#AR_PHY_AIC_STDBY_COM_ATT_DB_S
 8

	)

78 
	#AR_PHY_AIC_RSSI_MAX
 0x000000F0

	)

79 
	#AR_PHY_AIC_RSSI_MAX_S
 4

	)

80 
	#AR_PHY_AIC_RSSI_MIN
 0x0000000F

	)

81 
	#AR_PHY_AIC_RSSI_MIN_S
 0

	)

82 
	#AR_PHY_AIC_RADIO_DELAY
 0x7F000000

	)

83 
	#AR_PHY_AIC_RADIO_DELAY_S
 24

	)

84 
	#AR_PHY_AIC_CAL_STEP_SIZE_CORR
 0x00F00000

	)

85 
	#AR_PHY_AIC_CAL_STEP_SIZE_CORR_S
 20

	)

86 
	#AR_PHY_AIC_CAL_ROT_IDX_CORR
 0x000F8000

	)

87 
	#AR_PHY_AIC_CAL_ROT_IDX_CORR_S
 15

	)

88 
	#AR_PHY_AIC_CAL_CONV_CHECK_FACTOR
 0x00006000

	)

89 
	#AR_PHY_AIC_CAL_CONV_CHECK_FACTOR_S
 13

	)

90 
	#AR_PHY_AIC_ROT_IDX_COUNT_MAX
 0x00001C00

	)

91 
	#AR_PHY_AIC_ROT_IDX_COUNT_MAX_S
 10

	)

92 
	#AR_PHY_AIC_CAL_SYNTH_TOGGLE
 0x00000200

	)

93 
	#AR_PHY_AIC_CAL_SYNTH_TOGGLE_S
 9

	)

94 
	#AR_PHY_AIC_CAL_SYNTH_AFTER_BTRX
 0x00000100

	)

95 
	#AR_PHY_AIC_CAL_SYNTH_AFTER_BTRX_S
 8

	)

96 
	#AR_PHY_AIC_CAL_SYNTH_SETTLING
 0x000000FF

	)

97 
	#AR_PHY_AIC_CAL_SYNTH_SETTLING_S
 0

	)

98 
	#AR_PHY_AIC_MON_MAX_HOP_COUNT
 0x07F00000

	)

99 
	#AR_PHY_AIC_MON_MAX_HOP_COUNT_S
 20

	)

100 
	#AR_PHY_AIC_MON_MIN_STALE_COUNT
 0x000FE000

	)

101 
	#AR_PHY_AIC_MON_MIN_STALE_COUNT_S
 13

	)

102 
	#AR_PHY_AIC_MON_PWR_EST_LONG
 0x00001000

	)

103 
	#AR_PHY_AIC_MON_PWR_EST_LONG_S
 12

	)

104 
	#AR_PHY_AIC_MON_PD_TALLY_SCALING
 0x00000C00

	)

105 
	#AR_PHY_AIC_MON_PD_TALLY_SCALING_S
 10

	)

106 
	#AR_PHY_AIC_MON_PERF_THR
 0x000003E0

	)

107 
	#AR_PHY_AIC_MON_PERF_THR_S
 5

	)

108 
	#AR_PHY_AIC_CAL_TARGET_MAG_SETTING
 0x00000018

	)

109 
	#AR_PHY_AIC_CAL_TARGET_MAG_SETTING_S
 3

	)

110 
	#AR_PHY_AIC_CAL_PERF_CHECK_FACTOR
 0x00000006

	)

111 
	#AR_PHY_AIC_CAL_PERF_CHECK_FACTOR_S
 1

	)

112 
	#AR_PHY_AIC_CAL_PWR_EST_LONG
 0x00000001

	)

113 
	#AR_PHY_AIC_CAL_PWR_EST_LONG_S
 0

	)

114 
	#AR_PHY_AIC_MON_DONE
 0x80000000

	)

115 
	#AR_PHY_AIC_MON_DONE_S
 31

	)

116 
	#AR_PHY_AIC_MON_ACTIVE
 0x40000000

	)

117 
	#AR_PHY_AIC_MON_ACTIVE_S
 30

	)

118 
	#AR_PHY_AIC_MEAS_COUNT
 0x3F000000

	)

119 
	#AR_PHY_AIC_MEAS_COUNT_S
 24

	)

120 
	#AR_PHY_AIC_CAL_ANT_ISO_EST
 0x00FC0000

	)

121 
	#AR_PHY_AIC_CAL_ANT_ISO_EST_S
 18

	)

122 
	#AR_PHY_AIC_CAL_HOP_COUNT
 0x0003F800

	)

123 
	#AR_PHY_AIC_CAL_HOP_COUNT_S
 11

	)

124 
	#AR_PHY_AIC_CAL_VALID_COUNT
 0x000007F0

	)

125 
	#AR_PHY_AIC_CAL_VALID_COUNT_S
 4

	)

126 
	#AR_PHY_AIC_CAL_BT_TOO_WEAK_ERR
 0x00000008

	)

127 
	#AR_PHY_AIC_CAL_BT_TOO_WEAK_ERR_S
 3

	)

128 
	#AR_PHY_AIC_CAL_BT_TOO_STRONG_ERR
 0x00000004

	)

129 
	#AR_PHY_AIC_CAL_BT_TOO_STRONG_ERR_S
 2

	)

130 
	#AR_PHY_AIC_CAL_DONE
 0x00000002

	)

131 
	#AR_PHY_AIC_CAL_DONE_S
 1

	)

132 
	#AR_PHY_AIC_CAL_ACTIVE
 0x00000001

	)

133 
	#AR_PHY_AIC_CAL_ACTIVE_S
 0

	)

135 
	#AR_PHY_AIC_MEAS_MAG_MIN
 0xFFC00000

	)

136 
	#AR_PHY_AIC_MEAS_MAG_MIN_S
 22

	)

137 
	#AR_PHY_AIC_MON_STALE_COUNT
 0x003F8000

	)

138 
	#AR_PHY_AIC_MON_STALE_COUNT_S
 15

	)

139 
	#AR_PHY_AIC_MON_HOP_COUNT
 0x00007F00

	)

140 
	#AR_PHY_AIC_MON_HOP_COUNT_S
 8

	)

141 
	#AR_PHY_AIC_CAL_AIC_SM
 0x000000F8

	)

142 
	#AR_PHY_AIC_CAL_AIC_SM_S
 3

	)

143 
	#AR_PHY_AIC_SM
 0x00000007

	)

144 
	#AR_PHY_AIC_SM_S
 0

	)

145 
	#AR_PHY_AIC_SRAM_VALID
 0x00000001

	)

146 
	#AR_PHY_AIC_SRAM_VALID_S
 0

	)

147 
	#AR_PHY_AIC_SRAM_ROT_QUAD_ATT_DB
 0x0000007E

	)

148 
	#AR_PHY_AIC_SRAM_ROT_QUAD_ATT_DB_S
 1

	)

149 
	#AR_PHY_AIC_SRAM_VGA_QUAD_SIGN
 0x00000080

	)

150 
	#AR_PHY_AIC_SRAM_VGA_QUAD_SIGN_S
 7

	)

151 
	#AR_PHY_AIC_SRAM_ROT_DIR_ATT_DB
 0x00003F00

	)

152 
	#AR_PHY_AIC_SRAM_ROT_DIR_ATT_DB_S
 8

	)

153 
	#AR_PHY_AIC_SRAM_VGA_DIR_SIGN
 0x00004000

	)

154 
	#AR_PHY_AIC_SRAM_VGA_DIR_SIGN_S
 14

	)

155 
	#AR_PHY_AIC_SRAM_COM_ATT_6DB
 0x00038000

	)

156 
	#AR_PHY_AIC_SRAM_COM_ATT_6DB_S
 15

	)

157 
	#AR_PHY_AIC_CAL_ROT_ATT_DB_EST_ISO
 0x0000E000

	)

158 
	#AR_PHY_AIC_CAL_ROT_ATT_DB_EST_ISO_S
 13

	)

159 
	#AR_PHY_AIC_CAL_COM_ATT_DB_EST_ISO
 0x00001E00

	)

160 
	#AR_PHY_AIC_CAL_COM_ATT_DB_EST_ISO_S
 9

	)

161 
	#AR_PHY_AIC_CAL_ISO_EST_INIT_SETTING
 0x000001F8

	)

162 
	#AR_PHY_AIC_CAL_ISO_EST_INIT_SETTING_S
 3

	)

163 
	#AR_PHY_AIC_CAL_COM_ATT_DB_BACKOFF
 0x00000006

	)

164 
	#AR_PHY_AIC_CAL_COM_ATT_DB_BACKOFF_S
 1

	)

165 
	#AR_PHY_AIC_CAL_COM_ATT_DB_FIXED
 0x00000001

	)

166 
	#AR_PHY_AIC_CAL_COM_ATT_DB_FIXED_S
 0

	)

	@reg_mci.h

17 #i‚de‡
REG_MCI_H


18 
	#REG_MCI_H


	)

20 
	#AR_MCI_COMMAND0
 0x1800

	)

21 
	#AR_MCI_COMMAND0_HEADER
 0xFF

	)

22 
	#AR_MCI_COMMAND0_HEADER_S
 0

	)

23 
	#AR_MCI_COMMAND0_LEN
 0x1f00

	)

24 
	#AR_MCI_COMMAND0_LEN_S
 8

	)

25 
	#AR_MCI_COMMAND0_DISABLE_TIMESTAMP
 0x2000

	)

26 
	#AR_MCI_COMMAND0_DISABLE_TIMESTAMP_S
 13

	)

28 
	#AR_MCI_COMMAND1
 0x1804

	)

30 
	#AR_MCI_COMMAND2
 0x1808

	)

31 
	#AR_MCI_COMMAND2_RESET_TX
 0x01

	)

32 
	#AR_MCI_COMMAND2_RESET_TX_S
 0

	)

33 
	#AR_MCI_COMMAND2_RESET_RX
 0x02

	)

34 
	#AR_MCI_COMMAND2_RESET_RX_S
 1

	)

35 
	#AR_MCI_COMMAND2_RESET_RX_NUM_CYCLES
 0x3FC

	)

36 
	#AR_MCI_COMMAND2_RESET_RX_NUM_CYCLES_S
 2

	)

37 
	#AR_MCI_COMMAND2_RESET_REQ_WAKEUP
 0x400

	)

38 
	#AR_MCI_COMMAND2_RESET_REQ_WAKEUP_S
 10

	)

40 
	#AR_MCI_RX_CTRL
 0x180c

	)

42 
	#AR_MCI_TX_CTRL
 0x1810

	)

49 
	#AR_MCI_TX_CTRL_CLK_DIV
 0x03

	)

50 
	#AR_MCI_TX_CTRL_CLK_DIV_S
 0

	)

51 
	#AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE
 0x04

	)

52 
	#AR_MCI_TX_CTRL_DISABLE_LNA_UPDATE_S
 2

	)

53 
	#AR_MCI_TX_CTRL_GAIN_UPDATE_FREQ
 0xFFFFF8

	)

54 
	#AR_MCI_TX_CTRL_GAIN_UPDATE_FREQ_S
 3

	)

55 
	#AR_MCI_TX_CTRL_GAIN_UPDATE_NUM
 0xF000000

	)

56 
	#AR_MCI_TX_CTRL_GAIN_UPDATE_NUM_S
 24

	)

58 
	#AR_MCI_MSG_ATTRIBUTES_TABLE
 0x1814

	)

59 
	#AR_MCI_MSG_ATTRIBUTES_TABLE_CHECKSUM
 0xFFFF

	)

60 
	#AR_MCI_MSG_ATTRIBUTES_TABLE_CHECKSUM_S
 0

	)

61 
	#AR_MCI_MSG_ATTRIBUTES_TABLE_INVALID_HDR
 0xFFFF0000

	)

62 
	#AR_MCI_MSG_ATTRIBUTES_TABLE_INVALID_HDR_S
 16

	)

64 
	#AR_MCI_SCHD_TABLE_0
 0x1818

	)

65 
	#AR_MCI_SCHD_TABLE_1
 0x181c

	)

66 
	#AR_MCI_GPM_0
 0x1820

	)

67 
	#AR_MCI_GPM_1
 0x1824

	)

68 
	#AR_MCI_GPM_WRITE_PTR
 0xFFFF0000

	)

69 
	#AR_MCI_GPM_WRITE_PTR_S
 16

	)

70 
	#AR_MCI_GPM_BUF_LEN
 0x0000FFFF

	)

71 
	#AR_MCI_GPM_BUF_LEN_S
 0

	)

73 
	#AR_MCI_INTERRUPT_RAW
 0x1828

	)

75 
	#AR_MCI_INTERRUPT_EN
 0x182c

	)

76 
	#AR_MCI_INTERRUPT_SW_MSG_DONE
 0x00000001

	)

77 
	#AR_MCI_INTERRUPT_SW_MSG_DONE_S
 0

	)

78 
	#AR_MCI_INTERRUPT_CPU_INT_MSG
 0x00000002

	)

79 
	#AR_MCI_INTERRUPT_CPU_INT_MSG_S
 1

	)

80 
	#AR_MCI_INTERRUPT_RX_CKSUM_FAIL
 0x00000004

	)

81 
	#AR_MCI_INTERRUPT_RX_CKSUM_FAIL_S
 2

	)

82 
	#AR_MCI_INTERRUPT_RX_INVALID_HDR
 0x00000008

	)

83 
	#AR_MCI_INTERRUPT_RX_INVALID_HDR_S
 3

	)

84 
	#AR_MCI_INTERRUPT_RX_HW_MSG_FAIL
 0x00000010

	)

85 
	#AR_MCI_INTERRUPT_RX_HW_MSG_FAIL_S
 4

	)

86 
	#AR_MCI_INTERRUPT_RX_SW_MSG_FAIL
 0x00000020

	)

87 
	#AR_MCI_INTERRUPT_RX_SW_MSG_FAIL_S
 5

	)

88 
	#AR_MCI_INTERRUPT_TX_HW_MSG_FAIL
 0x00000080

	)

89 
	#AR_MCI_INTERRUPT_TX_HW_MSG_FAIL_S
 7

	)

90 
	#AR_MCI_INTERRUPT_TX_SW_MSG_FAIL
 0x00000100

	)

91 
	#AR_MCI_INTERRUPT_TX_SW_MSG_FAIL_S
 8

	)

92 
	#AR_MCI_INTERRUPT_RX_MSG
 0x00000200

	)

93 
	#AR_MCI_INTERRUPT_RX_MSG_S
 9

	)

94 
	#AR_MCI_INTERRUPT_REMOTE_SLEEP_UPDATE
 0x00000400

	)

95 
	#AR_MCI_INTERRUPT_REMOTE_SLEEP_UPDATE_S
 10

	)

96 
	#AR_MCI_INTERRUPT_BT_PRI
 0x07fff800

	)

97 
	#AR_MCI_INTERRUPT_BT_PRI_S
 11

	)

98 
	#AR_MCI_INTERRUPT_BT_PRI_THRESH
 0x08000000

	)

99 
	#AR_MCI_INTERRUPT_BT_PRI_THRESH_S
 27

	)

100 
	#AR_MCI_INTERRUPT_BT_FREQ
 0x10000000

	)

101 
	#AR_MCI_INTERRUPT_BT_FREQ_S
 28

	)

102 
	#AR_MCI_INTERRUPT_BT_STOMP
 0x20000000

	)

103 
	#AR_MCI_INTERRUPT_BT_STOMP_S
 29

	)

104 
	#AR_MCI_INTERRUPT_BB_AIC_IRQ
 0x40000000

	)

105 
	#AR_MCI_INTERRUPT_BB_AIC_IRQ_S
 30

	)

106 
	#AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT
 0x80000000

	)

107 
	#AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT_S
 31

	)

109 
	#AR_MCI_REMOTE_CPU_INT
 0x1830

	)

110 
	#AR_MCI_REMOTE_CPU_INT_EN
 0x1834

	)

111 
	#AR_MCI_INTERRUPT_RX_MSG_RAW
 0x1838

	)

112 
	#AR_MCI_INTERRUPT_RX_MSG_EN
 0x183c

	)

113 
	#AR_MCI_INTERRUPT_RX_MSG_REMOTE_RESET
 0x00000001

	)

114 
	#AR_MCI_INTERRUPT_RX_MSG_REMOTE_RESET_S
 0

	)

115 
	#AR_MCI_INTERRUPT_RX_MSG_LNA_CONTROL
 0x00000002

	)

116 
	#AR_MCI_INTERRUPT_RX_MSG_LNA_CONTROL_S
 1

	)

117 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_NACK
 0x00000004

	)

118 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_NACK_S
 2

	)

119 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_INFO
 0x00000008

	)

120 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_INFO_S
 3

	)

121 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_RST
 0x00000010

	)

122 
	#AR_MCI_INTERRUPT_RX_MSG_CONT_RST_S
 4

	)

123 
	#AR_MCI_INTERRUPT_RX_MSG_SCHD_INFO
 0x00000020

	)

124 
	#AR_MCI_INTERRUPT_RX_MSG_SCHD_INFO_S
 5

	)

125 
	#AR_MCI_INTERRUPT_RX_MSG_CPU_INT
 0x00000040

	)

126 
	#AR_MCI_INTERRUPT_RX_MSG_CPU_INT_S
 6

	)

127 
	#AR_MCI_INTERRUPT_RX_MSG_GPM
 0x00000100

	)

128 
	#AR_MCI_INTERRUPT_RX_MSG_GPM_S
 8

	)

129 
	#AR_MCI_INTERRUPT_RX_MSG_LNA_INFO
 0x00000200

	)

130 
	#AR_MCI_INTERRUPT_RX_MSG_LNA_INFO_S
 9

	)

131 
	#AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
 0x00000400

	)

132 
	#AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING_S
 10

	)

133 
	#AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
 0x00000800

	)

134 
	#AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING_S
 11

	)

135 
	#AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
 0x00001000

	)

136 
	#AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE_S
 12

	)

138 
	#AR_MCI_CPU_INT
 0x1840

	)

140 
	#AR_MCI_RX_STATUS
 0x1844

	)

141 
	#AR_MCI_RX_LAST_SCHD_MSG_INDEX
 0x00000F00

	)

142 
	#AR_MCI_RX_LAST_SCHD_MSG_INDEX_S
 8

	)

143 
	#AR_MCI_RX_REMOTE_SLEEP
 0x00001000

	)

144 
	#AR_MCI_RX_REMOTE_SLEEP_S
 12

	)

145 
	#AR_MCI_RX_MCI_CLK_REQ
 0x00002000

	)

146 
	#AR_MCI_RX_MCI_CLK_REQ_S
 13

	)

148 
	#AR_MCI_CONT_STATUS
 0x1848

	)

149 
	#AR_MCI_CONT_RSSI_POWER
 0x000000FF

	)

150 
	#AR_MCI_CONT_RSSI_POWER_S
 0

	)

151 
	#AR_MCI_CONT_PRIORITY
 0x0000FF00

	)

152 
	#AR_MCI_CONT_PRIORITY_S
 8

	)

153 
	#AR_MCI_CONT_TXRX
 0x00010000

	)

154 
	#AR_MCI_CONT_TXRX_S
 16

	)

156 
	#AR_MCI_BT_PRI0
 0x184c

	)

157 
	#AR_MCI_BT_PRI1
 0x1850

	)

158 
	#AR_MCI_BT_PRI2
 0x1854

	)

159 
	#AR_MCI_BT_PRI3
 0x1858

	)

160 
	#AR_MCI_BT_PRI
 0x185c

	)

161 
	#AR_MCI_WL_FREQ0
 0x1860

	)

162 
	#AR_MCI_WL_FREQ1
 0x1864

	)

163 
	#AR_MCI_WL_FREQ2
 0x1868

	)

164 
	#AR_MCI_GAIN
 0x186c

	)

165 
	#AR_MCI_WBTIMER1
 0x1870

	)

166 
	#AR_MCI_WBTIMER2
 0x1874

	)

167 
	#AR_MCI_WBTIMER3
 0x1878

	)

168 
	#AR_MCI_WBTIMER4
 0x187c

	)

169 
	#AR_MCI_MAXGAIN
 0x1880

	)

170 
	#AR_MCI_HW_SCHD_TBL_CTL
 0x1884

	)

171 
	#AR_MCI_HW_SCHD_TBL_D0
 0x1888

	)

172 
	#AR_MCI_HW_SCHD_TBL_D1
 0x188c

	)

173 
	#AR_MCI_HW_SCHD_TBL_D2
 0x1890

	)

174 
	#AR_MCI_HW_SCHD_TBL_D3
 0x1894

	)

175 
	#AR_MCI_TX_PAYLOAD0
 0x1898

	)

176 
	#AR_MCI_TX_PAYLOAD1
 0x189c

	)

177 
	#AR_MCI_TX_PAYLOAD2
 0x18a0

	)

178 
	#AR_MCI_TX_PAYLOAD3
 0x18a4

	)

179 
	#AR_BTCOEX_WBTIMER
 0x18a8

	)

181 
	#AR_BTCOEX_CTRL
 0x18ac

	)

182 
	#AR_BTCOEX_CTRL_AR9462_MODE
 0x00000001

	)

183 
	#AR_BTCOEX_CTRL_AR9462_MODE_S
 0

	)

184 
	#AR_BTCOEX_CTRL_WBTIMER_EN
 0x00000002

	)

185 
	#AR_BTCOEX_CTRL_WBTIMER_EN_S
 1

	)

186 
	#AR_BTCOEX_CTRL_MCI_MODE_EN
 0x00000004

	)

187 
	#AR_BTCOEX_CTRL_MCI_MODE_EN_S
 2

	)

188 
	#AR_BTCOEX_CTRL_LNA_SHARED
 0x00000008

	)

189 
	#AR_BTCOEX_CTRL_LNA_SHARED_S
 3

	)

190 
	#AR_BTCOEX_CTRL_PA_SHARED
 0x00000010

	)

191 
	#AR_BTCOEX_CTRL_PA_SHARED_S
 4

	)

192 
	#AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN
 0x00000020

	)

193 
	#AR_BTCOEX_CTRL_ONE_STEP_LOOK_AHEAD_EN_S
 5

	)

194 
	#AR_BTCOEX_CTRL_TIME_TO_NEXT_BT_THRESH_EN
 0x00000040

	)

195 
	#AR_BTCOEX_CTRL_TIME_TO_NEXT_BT_THRESH_EN_S
 6

	)

196 
	#AR_BTCOEX_CTRL_NUM_ANTENNAS
 0x00000180

	)

197 
	#AR_BTCOEX_CTRL_NUM_ANTENNAS_S
 7

	)

198 
	#AR_BTCOEX_CTRL_RX_CHAIN_MASK
 0x00000E00

	)

199 
	#AR_BTCOEX_CTRL_RX_CHAIN_MASK_S
 9

	)

200 
	#AR_BTCOEX_CTRL_AGGR_THRESH
 0x00007000

	)

201 
	#AR_BTCOEX_CTRL_AGGR_THRESH_S
 12

	)

202 
	#AR_BTCOEX_CTRL_1_CHAIN_BCN
 0x00080000

	)

203 
	#AR_BTCOEX_CTRL_1_CHAIN_BCN_S
 19

	)

204 
	#AR_BTCOEX_CTRL_1_CHAIN_ACK
 0x00100000

	)

205 
	#AR_BTCOEX_CTRL_1_CHAIN_ACK_S
 20

	)

206 
	#AR_BTCOEX_CTRL_WAIT_BA_MARGIN
 0x1FE00000

	)

207 
	#AR_BTCOEX_CTRL_WAIT_BA_MARGIN_S
 28

	)

208 
	#AR_BTCOEX_CTRL_REDUCE_TXPWR
 0x20000000

	)

209 
	#AR_BTCOEX_CTRL_REDUCE_TXPWR_S
 29

	)

210 
	#AR_BTCOEX_CTRL_SPDT_ENABLE_10
 0x40000000

	)

211 
	#AR_BTCOEX_CTRL_SPDT_ENABLE_10_S
 30

	)

212 
	#AR_BTCOEX_CTRL_SPDT_POLARITY
 0x80000000

	)

213 
	#AR_BTCOEX_CTRL_SPDT_POLARITY_S
 31

	)

215 
	#AR_BTCOEX_WL_WEIGHTS0
 0x18b0

	)

216 
	#AR_BTCOEX_WL_WEIGHTS1
 0x18b4

	)

217 
	#AR_BTCOEX_WL_WEIGHTS2
 0x18b8

	)

218 
	#AR_BTCOEX_WL_WEIGHTS3
 0x18bc

	)

220 
	#AR_BTCOEX_MAX_TXPWR
(
_x
Ë(0x18c0 + ((_xË<< 2))

	)

221 
	#AR_BTCOEX_WL_LNA
 0x1940

	)

222 
	#AR_BTCOEX_RFGAIN_CTRL
 0x1944

	)

223 
	#AR_BTCOEX_WL_LNA_TIMEOUT
 0x003FFFFF

	)

224 
	#AR_BTCOEX_WL_LNA_TIMEOUT_S
 0

	)

226 
	#AR_BTCOEX_CTRL2
 0x1948

	)

227 
	#AR_BTCOEX_CTRL2_TXPWR_THRESH
 0x0007F800

	)

228 
	#AR_BTCOEX_CTRL2_TXPWR_THRESH_S
 11

	)

229 
	#AR_BTCOEX_CTRL2_TX_CHAIN_MASK
 0x00380000

	)

230 
	#AR_BTCOEX_CTRL2_TX_CHAIN_MASK_S
 19

	)

231 
	#AR_BTCOEX_CTRL2_RX_DEWEIGHT
 0x00400000

	)

232 
	#AR_BTCOEX_CTRL2_RX_DEWEIGHT_S
 22

	)

233 
	#AR_BTCOEX_CTRL2_GPIO_OBS_SEL
 0x00800000

	)

234 
	#AR_BTCOEX_CTRL2_GPIO_OBS_SEL_S
 23

	)

235 
	#AR_BTCOEX_CTRL2_MAC_BB_OBS_SEL
 0x01000000

	)

236 
	#AR_BTCOEX_CTRL2_MAC_BB_OBS_SEL_S
 24

	)

237 
	#AR_BTCOEX_CTRL2_DESC_BASED_TXPWR_ENABLE
 0x02000000

	)

238 
	#AR_BTCOEX_CTRL2_DESC_BASED_TXPWR_ENABLE_S
 25

	)

240 
	#AR_BTCOEX_CTRL_SPDT_ENABLE
 0x00000001

	)

241 
	#AR_BTCOEX_CTRL_SPDT_ENABLE_S
 0

	)

242 
	#AR_BTCOEX_CTRL_BT_OWN_SPDT_CTRL
 0x00000002

	)

243 
	#AR_BTCOEX_CTRL_BT_OWN_SPDT_CTRL_S
 1

	)

244 
	#AR_BTCOEX_CTRL_USE_LATCHED_BT_ANT
 0x00000004

	)

245 
	#AR_BTCOEX_CTRL_USE_LATCHED_BT_ANT_S
 2

	)

246 
	#AR_GLB_WLAN_UART_INTF_EN
 0x00020000

	)

247 
	#AR_GLB_WLAN_UART_INTF_EN_S
 17

	)

248 
	#AR_GLB_DS_JTAG_DISABLE
 0x00040000

	)

249 
	#AR_GLB_DS_JTAG_DISABLE_S
 18

	)

251 
	#AR_BTCOEX_RC
 0x194c

	)

252 
	#AR_BTCOEX_MAX_RFGAIN
(
_x
Ë(0x1950 + ((_xË<< 2))

	)

253 
	#AR_BTCOEX_DBG
 0x1a50

	)

254 
	#AR_MCI_LAST_HW_MSG_HDR
 0x1a54

	)

255 
	#AR_MCI_LAST_HW_MSG_BDY
 0x1a58

	)

257 
	#AR_MCI_SCHD_TABLE_2
 0x1a5c

	)

258 
	#AR_MCI_SCHD_TABLE_2_MEM_BASED
 0x00000001

	)

259 
	#AR_MCI_SCHD_TABLE_2_MEM_BASED_S
 0

	)

260 
	#AR_MCI_SCHD_TABLE_2_HW_BASED
 0x00000002

	)

261 
	#AR_MCI_SCHD_TABLE_2_HW_BASED_S
 1

	)

263 
	#AR_BTCOEX_CTRL3
 0x1a60

	)

264 
	#AR_BTCOEX_CTRL3_CONT_INFO_TIMEOUT
 0x00000fff

	)

265 
	#AR_BTCOEX_CTRL3_CONT_INFO_TIMEOUT_S
 0

	)

267 
	#AR_GLB_SWREG_DISCONT_MODE
 0x2002c

	)

268 
	#AR_GLB_SWREG_DISCONT_EN_BT_WLAN
 0x3

	)

270 
	#AR_MCI_MISC
 0x1a74

	)

271 
	#AR_MCI_MISC_HW_FIX_EN
 0x00000001

	)

272 
	#AR_MCI_MISC_HW_FIX_EN_S
 0

	)

274 
	#AR_MCI_DBG_CNT_CTRL
 0x1a78

	)

275 
	#AR_MCI_DBG_CNT_CTRL_ENABLE
 0x00000001

	)

276 
	#AR_MCI_DBG_CNT_CTRL_ENABLE_S
 0

	)

277 
	#AR_MCI_DBG_CNT_CTRL_BT_LINKID
 0x000007f8

	)

278 
	#AR_MCI_DBG_CNT_CTRL_BT_LINKID_S
 3

	)

280 
	#MCI_STAT_ALL_BT_LINKID
 0xffff

	)

282 
	#AR_MCI_INTERRUPT_DEFAULT
 (
AR_MCI_INTERRUPT_SW_MSG_DONE
 | \

283 
AR_MCI_INTERRUPT_RX_INVALID_HDR
 | \

284 
AR_MCI_INTERRUPT_RX_HW_MSG_FAIL
 | \

285 
AR_MCI_INTERRUPT_RX_SW_MSG_FAIL
 | \

286 
AR_MCI_INTERRUPT_TX_HW_MSG_FAIL
 | \

287 
AR_MCI_INTERRUPT_TX_SW_MSG_FAIL
 | \

288 
AR_MCI_INTERRUPT_RX_MSG
 | \

289 
AR_MCI_INTERRUPT_REMOTE_SLEEP_UPDATE
 | \

290 
AR_MCI_INTERRUPT_CONT_INFO_TIMEOUT
)

	)

292 
	#AR_MCI_INTERRUPT_MSG_FAIL_MASK
 (
AR_MCI_INTERRUPT_RX_HW_MSG_FAIL
 | \

293 
AR_MCI_INTERRUPT_RX_SW_MSG_FAIL
 | \

294 
AR_MCI_INTERRUPT_TX_HW_MSG_FAIL
 | \

295 
AR_MCI_INTERRUPT_TX_SW_MSG_FAIL
)

	)

297 
	#AR_MCI_INTERRUPT_RX_HW_MSG_MASK
 (
AR_MCI_INTERRUPT_RX_MSG_SCHD_INFO
 | \

298 
AR_MCI_INTERRUPT_RX_MSG_LNA_CONTROL
 | \

299 
AR_MCI_INTERRUPT_RX_MSG_LNA_INFO
 | \

300 
AR_MCI_INTERRUPT_RX_MSG_CONT_NACK
 | \

301 
AR_MCI_INTERRUPT_RX_MSG_CONT_INFO
 | \

302 
AR_MCI_INTERRUPT_RX_MSG_CONT_RST
)

	)

304 
	#AR_MCI_INTERRUPT_RX_MSG_DEFAULT
 (
AR_MCI_INTERRUPT_RX_MSG_GPM
 | \

305 
AR_MCI_INTERRUPT_RX_MSG_REMOTE_RESET
 | \

306 
AR_MCI_INTERRUPT_RX_MSG_SYS_WAKING
 | \

307 
AR_MCI_INTERRUPT_RX_MSG_SYS_SLEEPING
 | \

308 
AR_MCI_INTERRUPT_RX_MSG_REQ_WAKE
)

	)

	@reg_wow.h

17 #i‚de‡
REG_WOW_H


18 
	#REG_WOW_H


	)

20 
	#AR_WOW_PATTERN
 0x825C

	)

21 
	#AR_WOW_COUNT
 0x8260

	)

22 
	#AR_WOW_BCN_EN
 0x8270

	)

23 
	#AR_WOW_BCN_TIMO
 0x8274

	)

24 
	#AR_WOW_KEEP_ALIVE_TIMO
 0x8278

	)

25 
	#AR_WOW_KEEP_ALIVE
 0x827c

	)

26 
	#AR_WOW_KEEP_ALIVE_DELAY
 0x8288

	)

27 
	#AR_WOW_PATTERN_MATCH
 0x828c

	)

54 
	#AR_WOW_LENGTH1
 0x8360

	)

55 
	#AR_WOW_LENGTH2
 0X8364

	)

56 
	#AR_WOW_LENGTH3
 0X8380

	)

57 
	#AR_WOW_LENGTH4
 0X8384

	)

59 
	#AR_WOW_PATTERN_MATCH_LT_256B
 0x8368

	)

60 
	#AR_MAC_PCU_WOW4
 0x8370

	)

62 
	#AR_SW_WOW_CONTROL
 0x20018

	)

63 
	#AR_SW_WOW_ENABLE
 0x1

	)

64 
	#AR_SWITCH_TO_REFCLK
 0x2

	)

65 
	#AR_RESET_CONTROL
 0x4

	)

66 
	#AR_RESET_VALUE_MASK
 0x8

	)

67 
	#AR_HW_WOW_DISABLE
 0x10

	)

68 
	#AR_CLR_MAC_INTERRUPT
 0x20

	)

69 
	#AR_CLR_KA_INTERRUPT
 0x40

	)

71 
	#AR_WOW_BACK_OFF_SHIFT
(
x
Ë((x & 0xfË<< 27Ë

	)

72 
	#AR_WOW_MAC_INTR_EN
 0x00040000

	)

73 
	#AR_WOW_MAGIC_EN
 0x00010000

	)

74 
	#AR_WOW_PATTERN_EN
(
x
Ë(x & 0xff)

	)

75 
	#AR_WOW_PAT_FOUND_SHIFT
 8

	)

76 
	#AR_WOW_PATTERN_FOUND
(
x
Ë(x & (0xf‡<< 
AR_WOW_PAT_FOUND_SHIFT
))

	)

77 
	#AR_WOW_PATTERN_FOUND_MASK
 ((0xffË<< 
AR_WOW_PAT_FOUND_SHIFT
)

	)

78 
	#AR_WOW_MAGIC_PAT_FOUND
 0x00020000

	)

79 
	#AR_WOW_MAC_INTR
 0x00080000

	)

80 
	#AR_WOW_KEEP_ALIVE_FAIL
 0x00100000

	)

81 
	#AR_WOW_BEACON_FAIL
 0x00200000

	)

83 
	#AR_WOW_STATUS
(
x
Ë(x & (
AR_WOW_PATTERN_FOUND_MASK
 | \

84 
AR_WOW_MAGIC_PAT_FOUND
 | \

85 
AR_WOW_KEEP_ALIVE_FAIL
 | \

86 
AR_WOW_BEACON_FAIL
))

	)

87 
	#AR_WOW_CLEAR_EVENTS
(
x
Ë(x & ~(
	`AR_WOW_PATTERN_EN
(0xff) | \

88 
AR_WOW_MAGIC_EN
 | \

89 
AR_WOW_MAC_INTR_EN
 | \

90 
AR_WOW_BEACON_FAIL
 | \

91 
AR_WOW_KEEP_ALIVE_FAIL
))

	)

93 
	#AR_WOW2_PATTERN_EN
(
x
Ë((x & 0xffË<< 0)

	)

94 
	#AR_WOW2_PATTERN_FOUND_SHIFT
 8

	)

95 
	#AR_WOW2_PATTERN_FOUND
(
x
Ë(x & (0xf‡<< 
AR_WOW2_PATTERN_FOUND_SHIFT
))

	)

96 
	#AR_WOW2_PATTERN_FOUND_MASK
 ((0xffË<< 
AR_WOW2_PATTERN_FOUND_SHIFT
)

	)

98 
	#AR_WOW_STATUS2
(
x
Ë(x & 
AR_WOW2_PATTERN_FOUND_MASK
)

	)

99 
	#AR_WOW_CLEAR_EVENTS2
(
x
Ë(x & ~(
	`AR_WOW2_PATTERN_EN
(0xff)))

	)

101 
	#AR_WOW_AIFS_CNT
(
x
Ë(x & 0xff)

	)

102 
	#AR_WOW_SLOT_CNT
(
x
Ë((x & 0xffË<< 8)

	)

103 
	#AR_WOW_KEEP_ALIVE_CNT
(
x
Ë((x & 0xffË<< 16)

	)

105 
	#AR_WOW_BEACON_FAIL_EN
 0x00000001

	)

106 
	#AR_WOW_BEACON_TIMO
 0x40000000

	)

107 
	#AR_WOW_KEEP_ALIVE_NEVER
 0xffffffff

	)

108 
	#AR_WOW_KEEP_ALIVE_AUTO_DIS
 0x00000001

	)

109 
	#AR_WOW_KEEP_ALIVE_FAIL_DIS
 0x00000002

	)

110 
	#AR_WOW_KEEP_ALIVE_DELAY_VALUE
 0x000003e8

	)

111 
	#AR_WOW_BMISSTHRESHOLD
 0x20

	)

112 
	#AR_WOW_PAT_END_OF_PKT
(
x
Ë(x & 0xf)

	)

113 
	#AR_WOW_PAT_OFF_MATCH
(
x
Ë((x & 0xfË<< 8)

	)

114 
	#AR_WOW_PAT_BACKOFF
 0x00000004

	)

115 
	#AR_WOW_CNT_AIFS_CNT
 0x00000022

	)

116 
	#AR_WOW_CNT_SLOT_CNT
 0x00000009

	)

117 
	#AR_WOW_CNT_KA_CNT
 0x00000008

	)

119 
	#AR_WOW_TRANSMIT_BUFFER
 0xe000

	)

120 
	#AR_WOW_TXBUF
(
i
Ë(
AR_WOW_TRANSMIT_BUFFER
 + ((iË<< 2))

	)

121 
	#AR_WOW_KA_DESC_WORD2
 0xe000

	)

122 
	#AR_WOW_TB_PATTERN
(
i
Ë(0xe100 + (ò<< 8))

	)

123 
	#AR_WOW_TB_MASK
(
i
Ë(0xec00 + (ò<< 5))

	)

124 
	#AR_WOW_PATTERN_SUPPORTED_LEGACY
 0xff

	)

125 
	#AR_WOW_PATTERN_SUPPORTED
 0xffff

	)

126 
	#AR_WOW_LENGTH_MAX
 0xff

	)

127 
	#AR_WOW_LEN1_SHIFT
(
_i
Ë((0x3 - ((_iË& 0x3)Ë<< 0x3)

	)

128 
	#AR_WOW_LENGTH1_MASK
(
_i
Ë(
AR_WOW_LENGTH_MAX
 << 
	`AR_WOW_LEN1_SHIFT
(_i))

	)

129 
	#AR_WOW_LEN2_SHIFT
(
_i
Ë((0x7 - ((_iË& 0x7)Ë<< 0x3)

	)

130 
	#AR_WOW_LENGTH2_MASK
(
_i
Ë(
AR_WOW_LENGTH_MAX
 << 
	`AR_WOW_LEN2_SHIFT
(_i))

	)

131 
	#AR_WOW_LEN3_SHIFT
(
_i
Ë((0xb - ((_iË& 0xb)Ë<< 0x3)

	)

132 
	#AR_WOW_LENGTH3_MASK
(
_i
Ë(
AR_WOW_LENGTH_MAX
 << 
	`AR_WOW_LEN3_SHIFT
(_i))

	)

133 
	#AR_WOW_LEN4_SHIFT
(
_i
Ë((0x‡- ((_iË& 0xf)Ë<< 0x3)

	)

134 
	#AR_WOW_LENGTH4_MASK
(
_i
Ë(
AR_WOW_LENGTH_MAX
 << 
	`AR_WOW_LEN4_SHIFT
(_i))

	)

	@rng.c

17 
	~<löux/hw_øndom.h
>

18 
	~<löux/kthªad.h
>

20 
	~"©h9k.h
"

21 
	~"hw.h
"

22 
	~"¨9003_phy.h
"

24 
	#ATH9K_RNG_BUF_SIZE
 320

	)

25 
	#ATH9K_RNG_ENTROPY
(
x
Ë(((xË* 8 * 320Ë>> 10Ë

	)

27 
	$©h9k_∫g_d©a_ªad
(
©h_so·c
 *
sc
, 
u32
 *
buf
, u32 
buf_size
)

29 
i
, 
j
;

30 
u32
 
v1
, 
v2
, 
∫g_œ°
 = 
sc
->rng_last;

31 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

33 
	`©h9k_ps_wakeup
(
sc
);

35 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_BBB_OBS_SEL
, 1);

36 
	`REG_CLR_BIT
(
ah
, 
AR_PHY_TEST
, 
AR_PHY_TEST_RX_OBS_SEL_BIT5
);

37 
	`REG_RMW_FIELD
(
ah
, 
AR_PHY_TEST_CTL_STATUS
, 
AR_PHY_TEST_CTL_RX_OBS_SEL
, 0);

39 
i
 = 0, 
j
 = 0; i < 
buf_size
; i++) {

40 
v1
 = 
	`REG_READ
(
ah
, 
AR_PHY_TST_ADC
) & 0xffff;

41 
v2
 = 
	`REG_READ
(
ah
, 
AR_PHY_TST_ADC
) & 0xffff;

44 i‡(
v1
 && 
v2
 && 
∫g_œ°
 != v1 && v1 != v2 && v1 != 0xffff &&

45 
v2
 != 0xffff)

46 
buf
[
j
++] = (
v1
 << 16Ë| 
v2
;

48 
∫g_œ°
 = 
v2
;

51 
	`©h9k_ps_ª°‹e
(
sc
);

53 
sc
->
∫g_œ°
 =Ñng_last;

55  
j
 << 2;

56 
	}
}

58 
	$©h9k_∫g_kthªad
(*
d©a
)

60 
byãs_ªad
;

61 
©h_so·c
 *
sc
 = 
d©a
;

62 
u32
 *
∫g_buf
;

64 
∫g_buf
 = 
	`kmÆloc_¨øy
(
ATH9K_RNG_BUF_SIZE
, (
u32
), 
GFP_KERNEL
);

65 i‡(!
∫g_buf
)

66 
out
;

68 !
	`kthªad_should_°›
()) {

69 
byãs_ªad
 = 
	`©h9k_∫g_d©a_ªad
(
sc
, 
∫g_buf
,

70 
ATH9K_RNG_BUF_SIZE
);

71 i‡(
	`u∆ikñy
(!
byãs_ªad
)) {

72 
	`m¶ìp_öãºu±ibÀ
(10);

77 
	`add_hwgíî©‹_øndom√ss
((*)
∫g_buf
, 
byãs_ªad
,

78 
	`ATH9K_RNG_ENTROPY
(
byãs_ªad
));

81 
	`k‰ì
(
∫g_buf
);

82 
out
:

83 
sc
->
∫g_èsk
 = 
NULL
;

86 
	}
}

88 
	$©h9k_∫g_°¨t
(
©h_so·c
 *
sc
)

90 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

92 i‡(
sc
->
∫g_èsk
)

95 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
))

98 
sc
->
∫g_èsk
 = 
	`kthªad_run
(
©h9k_∫g_kthªad
, sc, "ath9k-hwrng");

99 i‡(
	`IS_ERR
(
sc
->
∫g_èsk
))

100 
sc
->
∫g_èsk
 = 
NULL
;

101 
	}
}

103 
	$©h9k_∫g_°›
(
©h_so·c
 *
sc
)

105 i‡(
sc
->
∫g_èsk
)

106 
	`kthªad_°›
(
sc
->
∫g_èsk
);

107 
	}
}

	@tx99.c

17 
	~"©h9k.h
"

19 
	$©h9k_tx99_°›
(
©h_so·c
 *
sc
)

21 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

22 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

24 
	`©h_døö_Æl_txq
(
sc
);

25 
	`©h_°¨åecv
(
sc
);

27 
	`©h9k_hw_£t_öãºu±s
(
ah
);

28 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

30 
	`õì80211_wake_queues
(
sc
->
hw
);

32 
	`k‰ì_skb
(
sc
->
tx99_skb
);

33 
sc
->
tx99_skb
 = 
NULL
;

34 
sc
->
tx99_°©e
 = 
Ál£
;

36 
	`©h9k_hw_tx99_°›
(
sc
->
sc_ah
);

37 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TX99 stopped\n");

38 
	}
}

40 
sk_buff
 *
	$©h9k_buûd_tx99_skb
(
©h_so·c
 *
sc
)

42 
u8
 
PN9D©a
[] = {0xff, 0x87, 0xb8, 0x59, 0xb7, 0xa1, 0xcc, 0x24,

50 
u32
 
Àn
 = 1200;

51 
õì80211_tx_øã
 *
øã
;

52 
õì80211_hw
 *
hw
 = 
sc
->hw;

53 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

54 
õì80211_hdr
 *
hdr
;

55 
õì80211_tx_öfo
 *
tx_öfo
;

56 
sk_buff
 *
skb
;

57 
©h_vif
 *
avp
;

59 i‡(!
sc
->
tx99_vif
)

60  
NULL
;

62 
avp
 = (
©h_vif
 *)
sc
->
tx99_vif
->
drv_¥iv
;

64 
skb
 = 
	`Æloc_skb
(
Àn
, 
GFP_KERNEL
);

65 i‡(!
skb
)

66  
NULL
;

68 
	`skb_put
(
skb
, 
Àn
);

70 
	`mem£t
(
skb
->
d©a
, 0, 
Àn
);

72 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

73 
hdr
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_FTYPE_DATA
);

74 
hdr
->
duøti⁄_id
 = 0;

76 
	`mem˝y
(
hdr
->
addr1
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

77 
	`mem˝y
(
hdr
->
addr2
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

78 
	`mem˝y
(
hdr
->
addr3
, 
hw
->
wùhy
->
≥rm_addr
, 
ETH_ALEN
);

80 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
avp
->
£q_no
);

82 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

83 
	`mem£t
(
tx_öfo
, 0, (*tx_info));

84 
øã
 = &
tx_öfo
->
c⁄åﬁ
.
øãs
[0];

85 
tx_öfo
->
b™d
 = 
sc
->
cur_ch™
->
ch™def
.
ch™
->band;

86 
tx_öfo
->
Êags
 = 
IEEE80211_TX_CTL_NO_ACK
;

87 
tx_öfo
->
c⁄åﬁ
.
vif
 = 
sc
->
tx99_vif
;

88 
øã
->
cou¡
 = 1;

89 i‡(
ah
->
curch™
 && 
	`IS_CHAN_HT
(ah->curchan)) {

90 
øã
->
Êags
 |
IEEE80211_TX_RC_MCS
;

91 i‡(
	`IS_CHAN_HT40
(
ah
->
curch™
))

92 
øã
->
Êags
 |
IEEE80211_TX_RC_40_MHZ_WIDTH
;

95 
	`mem˝y
(
skb
->
d©a
 + (*
hdr
), 
PN9D©a
, (PN9Data));

97  
skb
;

98 
	}
}

100 
	$©h9k_tx99_deöô
(
©h_so·c
 *
sc
)

102 
	`©h_ª£t
(
sc
, 
NULL
);

104 
	`©h9k_ps_wakeup
(
sc
);

105 
	`©h9k_tx99_°›
(
sc
);

106 
	`©h9k_ps_ª°‹e
(
sc
);

107 
	}
}

109 
	$©h9k_tx99_öô
(
©h_so·c
 *
sc
)

111 
õì80211_hw
 *
hw
 = 
sc
->hw;

112 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

113 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

114 
©h_tx_c⁄åﬁ
 
tx˘l
;

115 
r
;

117 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

118 
	`©h_îr
(
comm⁄
,

120  -
EINVAL
;

123 
sc
->
tx99_skb
 = 
	`©h9k_buûd_tx99_skb
(sc);

124 i‡(!
sc
->
tx99_skb
)

125  -
ENOMEM
;

127 
	`mem£t
(&
tx˘l
, 0, (txctl));

128 
tx˘l
.
txq
 = 
sc
->
tx
.
txq_m≠
[
IEEE80211_AC_VO
];

130 
	`©h_ª£t
(
sc
, 
NULL
);

132 
	`©h9k_ps_wakeup
(
sc
);

134 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

135 
	`©omic_£t
(&
ah
->
öå_ªf_˙t
, -1);

136 
	`©h_døö_Æl_txq
(
sc
);

137 
	`©h_°›ªcv
(
sc
);

139 
sc
->
tx99_°©e
 = 
åue
;

141 
	`õì80211_°›_queues
(
hw
);

143 i‡(
sc
->
tx99_powî
 =
MAX_RATE_POWER
 + 1)

144 
sc
->
tx99_powî
 = 
MAX_RATE_POWER
;

146 
	`©h9k_hw_tx99_£t_txpowî
(
ah
, 
sc
->
tx99_powî
);

147 
r
 = 
	`©h9k_tx99_£nd
(
sc
, sc->
tx99_skb
, &
tx˘l
);

148 i‡(
r
) {

149 
	`©h_dbg
(
comm⁄
, 
XMIT
, "FailedÅo xmit TX99 skb\n");

150  
r
;

153 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TX99 xmit started using %d ( %ddBm)\n",

154 
sc
->
tx99_powî
,

155 
sc
->
tx99_powî
 / 2);

160 
	}
}

162 
ssize_t
 
	$ªad_fûe_tx99
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

163 
size_t
 
cou¡
, 
loff_t
 *
µos
)

165 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

166 
buf
[3];

167 
Àn
;

169 
Àn
 = 
	`•rötf
(
buf
, "%d\n", 
sc
->
tx99_°©e
);

170  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

171 
	}
}

173 
ssize_t
 
	$wrôe_fûe_tx99
(
fûe
 *fûe, c⁄° 
__u£r
 *
u£r_buf
,

174 
size_t
 
cou¡
, 
loff_t
 *
µos
)

176 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

177 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

178 
buf
[32];

179 
boﬁ
 
°¨t
;

180 
ssize_t
 
Àn
;

181 
r
;

183 i‡(
sc
->
cur_ch™
->
nvifs
 > 1)

184  -
EOPNOTSUPP
;

186 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

187 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

188  -
EFAULT
;

190 i‡(
	`°πoboﬁ
(
buf
, &
°¨t
))

191  -
EINVAL
;

193 i‡(
°¨t
 =
sc
->
tx99_°©e
) {

194 i‡(!
°¨t
)

195  
cou¡
;

196 
	`©h_dbg
(
comm⁄
, 
XMIT
, "Resetting TX99\n");

197 
	`©h9k_tx99_deöô
(
sc
);

200 i‡(!
°¨t
) {

201 
	`©h9k_tx99_deöô
(
sc
);

202  
cou¡
;

205 
r
 = 
	`©h9k_tx99_öô
(
sc
);

206 i‡(
r
)

207  
r
;

209  
cou¡
;

210 
	}
}

212 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tx99
 = {

213 .
ªad
 = 
ªad_fûe_tx99
,

214 .
	gwrôe
 = 
wrôe_fûe_tx99
,

215 .
	g›í
 = 
sim∂e_›í
,

216 .
	gow√r
 = 
THIS_MODULE
,

217 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

220 
ssize_t
 
	$ªad_fûe_tx99_powî
(
fûe
 *file,

221 
__u£r
 *
u£r_buf
,

222 
size_t
 
cou¡
, 
loff_t
 *
µos
)

224 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

225 
buf
[32];

226 
Àn
;

228 
Àn
 = 
	`•rötf
(
buf
, "%d (%d dBm)\n",

229 
sc
->
tx99_powî
,

230 
sc
->
tx99_powî
 / 2);

232  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

233 
	}
}

235 
ssize_t
 
	$wrôe_fûe_tx99_powî
(
fûe
 *file,

236 c⁄° 
__u£r
 *
u£r_buf
,

237 
size_t
 
cou¡
, 
loff_t
 *
µos
)

239 
©h_so·c
 *
sc
 = 
fûe
->
¥iv©e_d©a
;

240 
r
;

241 
u8
 
tx_powî
;

243 
r
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
tx_powî
);

244 i‡(
r
)

245  
r
;

247 i‡(
tx_powî
 > 
MAX_RATE_POWER
)

248  -
EINVAL
;

250 
sc
->
tx99_powî
 = 
tx_powî
;

252 
	`©h9k_ps_wakeup
(
sc
);

253 
	`©h9k_hw_tx99_£t_txpowî
(
sc
->
sc_ah
, sc->
tx99_powî
);

254 
	`©h9k_ps_ª°‹e
(
sc
);

256  
cou¡
;

257 
	}
}

259 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tx99_powî
 = {

260 .
ªad
 = 
ªad_fûe_tx99_powî
,

261 .
	gwrôe
 = 
wrôe_fûe_tx99_powî
,

262 .
	g›í
 = 
sim∂e_›í
,

263 .
	gow√r
 = 
THIS_MODULE
,

264 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

267 
	$©h9k_tx99_öô_debug
(
©h_so·c
 *
sc
)

269 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
sc
->
sc_ah
))

272 
	`debugfs_¸óã_fûe
("tx99", 
S_IRUSR
 | 
S_IWUSR
,

273 
sc
->
debug
.
debugfs_phy
, sc,

274 &
f›s_tx99
);

275 
	`debugfs_¸óã_fûe
("tx99_powî", 
S_IRUSR
 | 
S_IWUSR
,

276 
sc
->
debug
.
debugfs_phy
, sc,

277 &
f›s_tx99_powî
);

278 
	}
}

	@wmi.c

17 
	~"htc.h
"

19 c⁄° *
	$wmi_cmd_to_«me
(
wmi_cmd_id
 
wmi_cmd
)

21 
wmi_cmd
) {

22 
WMI_ECHO_CMDID
:

24 
WMI_ACCESS_MEMORY_CMDID
:

26 
WMI_GET_FW_VERSION
:

28 
WMI_DISABLE_INTR_CMDID
:

30 
WMI_ENABLE_INTR_CMDID
:

32 
WMI_ATH_INIT_CMDID
:

34 
WMI_ABORT_TXQ_CMDID
:

36 
WMI_STOP_TX_DMA_CMDID
:

38 
WMI_ABORT_TX_DMA_CMDID
:

40 
WMI_DRAIN_TXQ_CMDID
:

42 
WMI_DRAIN_TXQ_ALL_CMDID
:

44 
WMI_START_RECV_CMDID
:

46 
WMI_STOP_RECV_CMDID
:

48 
WMI_FLUSH_RECV_CMDID
:

50 
WMI_SET_MODE_CMDID
:

52 
WMI_NODE_CREATE_CMDID
:

54 
WMI_NODE_REMOVE_CMDID
:

56 
WMI_VAP_REMOVE_CMDID
:

58 
WMI_VAP_CREATE_CMDID
:

60 
WMI_REG_READ_CMDID
:

62 
WMI_REG_WRITE_CMDID
:

64 
WMI_REG_RMW_CMDID
:

66 
WMI_RC_STATE_CHANGE_CMDID
:

68 
WMI_RC_RATE_UPDATE_CMDID
:

70 
WMI_TARGET_IC_UPDATE_CMDID
:

72 
WMI_TX_AGGR_ENABLE_CMDID
:

74 
WMI_TGT_DETACH_CMDID
:

76 
WMI_NODE_UPDATE_CMDID
:

78 
WMI_INT_STATS_CMDID
:

80 
WMI_TX_STATS_CMDID
:

82 
WMI_RX_STATS_CMDID
:

84 
WMI_BITRATE_MASK_CMDID
:

89 
	}
}

91 
wmi
 *
	$©h9k_öô_wmi
(
©h9k_htc_¥iv
 *
¥iv
)

93 
wmi
 *wmi;

95 
wmi
 = 
	`kzÆloc
((wmi), 
GFP_KERNEL
);

96 i‡(!
wmi
)

97  
NULL
;

99 
wmi
->
drv_¥iv
 = 
¥iv
;

100 
wmi
->
°›≥d
 = 
Ál£
;

101 
	`skb_queue_hód_öô
(&
wmi
->
wmi_evít_queue
);

102 
	`•ö_lock_öô
(&
wmi
->
wmi_lock
);

103 
	`•ö_lock_öô
(&
wmi
->
evít_lock
);

104 
	`muãx_öô
(&
wmi
->
›_muãx
);

105 
	`muãx_öô
(&
wmi
->
mu…i_wrôe_muãx
);

106 
	`muãx_öô
(&
wmi
->
mu…i_rmw_muãx
);

107 
	`öô_com∂ëi⁄
(&
wmi
->
cmd_waô
);

108 
	`INIT_LIST_HEAD
(&
wmi
->
≥ndög_tx_evíts
);

109 
	`èskÀt_öô
(&
wmi
->
wmi_evít_èskÀt
, 
©h9k_wmi_evít_èskÀt
,

110 ()
wmi
);

112  
wmi
;

113 
	}
}

115 
	$©h9k_deöô_wmi
(
©h9k_htc_¥iv
 *
¥iv
)

117 
wmi
 *wmò
¥iv
->wmi;

119 
	`muãx_lock
(&
wmi
->
›_muãx
);

120 
wmi
->
°›≥d
 = 
åue
;

121 
	`muãx_u∆ock
(&
wmi
->
›_muãx
);

123 
	`k‰ì
(
¥iv
->
wmi
);

124 
	}
}

126 
	$©h9k_wmi_evít_døö
(
©h9k_htc_¥iv
 *
¥iv
)

128 
Êags
;

130 
	`èskÀt_kûl
(&
¥iv
->
wmi
->
wmi_evít_èskÀt
);

131 
	`•ö_lock_úqßve
(&
¥iv
->
wmi
->
wmi_lock
, 
Êags
);

132 
	`__skb_queue_purge
(&
¥iv
->
wmi
->
wmi_evít_queue
);

133 
	`•ö_u∆ock_úqª°‹e
(&
¥iv
->
wmi
->
wmi_lock
, 
Êags
);

134 
	}
}

136 
	$©h9k_wmi_evít_èskÀt
(
d©a
)

138 
wmi
 *wmò(wmò*)
d©a
;

139 
©h9k_htc_¥iv
 *
¥iv
 = 
wmi
->
drv_¥iv
;

140 
wmi_cmd_hdr
 *
hdr
;

141 *
wmi_evít
;

142 
wmi_evít_swba
 *
swba
;

143 
sk_buff
 *
skb
 = 
NULL
;

144 
Êags
;

145 
u16
 
cmd_id
;

148 
	`•ö_lock_úqßve
(&
wmi
->
wmi_lock
, 
Êags
);

149 
skb
 = 
	`__skb_dequeue
(&
wmi
->
wmi_evít_queue
);

150 i‡(!
skb
) {

151 
	`•ö_u∆ock_úqª°‹e
(&
wmi
->
wmi_lock
, 
Êags
);

154 
	`•ö_u∆ock_úqª°‹e
(&
wmi
->
wmi_lock
, 
Êags
);

156 
hdr
 = (
wmi_cmd_hdr
 *Ë
skb
->
d©a
;

157 
cmd_id
 = 
	`be16_to_˝u
(
hdr
->
comm™d_id
);

158 
wmi_evít
 = 
	`skb_puŒ
(
skb
, (
wmi_cmd_hdr
));

160 
cmd_id
) {

161 
WMI_SWBA_EVENTID
:

162 
swba
 = (
wmi_evít_swba
 *Ë
wmi_evít
;

163 
	`©h9k_htc_swba
(
¥iv
, 
swba
);

165 
WMI_FATAL_EVENTID
:

166 
	`õì80211_queue_w‹k
(
wmi
->
drv_¥iv
->
hw
,

167 &
wmi
->
drv_¥iv
->
Áèl_w‹k
);

169 
WMI_TXSTATUS_EVENTID
:

170 
	`•ö_lock_bh
(&
¥iv
->
tx
.
tx_lock
);

171 i‡(
¥iv
->
tx
.
Êags
 & 
ATH9K_HTC_OP_TX_DRAIN
) {

172 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

175 
	`•ö_u∆ock_bh
(&
¥iv
->
tx
.
tx_lock
);

177 
	`©h9k_htc_tx°©us
(
¥iv
, 
wmi_evít
);

183 
	`k‰ì_skb
(
skb
);

185 
	}
}

187 
	$©h9k_Áèl_w‹k
(
w‹k_°ru˘
 *
w‹k
)

189 
©h9k_htc_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, ath9k_htc_priv,

190 
Áèl_w‹k
);

191 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
¥iv
->
ah
);

193 
	`©h_dbg
(
comm⁄
, 
FATAL
, "FATAL EventÑeceived,Ñesetting device\n");

194 
	`©h9k_htc_ª£t
(
¥iv
);

195 
	}
}

197 
	$©h9k_wmi_r•_ˇŒback
(
wmi
 *wmi, 
sk_buff
 *
skb
)

199 
	`skb_puŒ
(
skb
, (
wmi_cmd_hdr
));

201 i‡(
wmi
->
cmd_r•_buf
 !
NULL
 && wmi->
cmd_r•_Àn
 != 0)

202 
	`mem˝y
(
wmi
->
cmd_r•_buf
, 
skb
->
d©a
, wmi->
cmd_r•_Àn
);

204 
	`com∂ëe
(&
wmi
->
cmd_waô
);

205 
	}
}

207 
	$©h9k_wmi_˘æ_rx
(*
¥iv
, 
sk_buff
 *
skb
,

208 
htc_ídpoöt_id
 
ïid
)

210 
wmi
 *wmò(wmò*Ë
¥iv
;

211 
wmi_cmd_hdr
 *
hdr
;

212 
u16
 
cmd_id
;

214 i‡(
	`u∆ikñy
(
wmi
->
°›≥d
))

215 
‰ì_skb
;

217 
hdr
 = (
wmi_cmd_hdr
 *Ë
skb
->
d©a
;

218 
cmd_id
 = 
	`be16_to_˝u
(
hdr
->
comm™d_id
);

220 i‡(
cmd_id
 & 0x1000) {

221 
	`•ö_lock
(&
wmi
->
wmi_lock
);

222 
	`__skb_queue_èû
(&
wmi
->
wmi_evít_queue
, 
skb
);

223 
	`•ö_u∆ock
(&
wmi
->
wmi_lock
);

224 
	`èskÀt_scheduÀ
(&
wmi
->
wmi_evít_èskÀt
);

229 
	`•ö_lock
(&
wmi
->
wmi_lock
);

230 i‡(
	`be16_to_˝u
(
hdr
->
£q_no
Ë!
wmi
->
œ°_£q_id
) {

231 
	`•ö_u∆ock
(&
wmi
->
wmi_lock
);

232 
‰ì_skb
;

234 
	`•ö_u∆ock
(&
wmi
->
wmi_lock
);

237 
	`©h9k_wmi_r•_ˇŒback
(
wmi
, 
skb
);

239 
‰ì_skb
:

240 
	`k‰ì_skb
(
skb
);

241 
	}
}

243 
	$©h9k_wmi_˘æ_tx
(*
¥iv
, 
sk_buff
 *
skb
,

244 
htc_ídpoöt_id
 
ïid
, 
boﬁ
 
txok
)

246 
	`k‰ì_skb
(
skb
);

247 
	}
}

249 
	$©h9k_wmi_c⁄√˘
(
htc_èrgë
 *
htc
, 
wmi
 *wmi,

250 
htc_ídpoöt_id
 *
wmi_˘æ_ïid
)

252 
htc_£rvi˚_c⁄ƒeq
 
c⁄√˘
;

253 
ªt
;

255 
wmi
->
htc
 = htc;

257 
	`mem£t
(&
c⁄√˘
, 0, (connect));

259 
c⁄√˘
.
ï_ˇŒbacks
.
¥iv
 = 
wmi
;

260 
c⁄√˘
.
ï_ˇŒbacks
.
tx
 = 
©h9k_wmi_˘æ_tx
;

261 
c⁄√˘
.
ï_ˇŒbacks
.
rx
 = 
©h9k_wmi_˘æ_rx
;

262 
c⁄√˘
.
£rvi˚_id
 = 
WMI_CONTROL_SVC
;

264 
ªt
 = 
	`htc_c⁄√˘_£rvi˚
(
htc
, &
c⁄√˘
, &
wmi
->
˘æ_ïid
);

265 i‡(
ªt
)

266  
ªt
;

268 *
wmi_˘æ_ïid
 = 
wmi
->
˘æ_ïid
;

271 
	}
}

273 
	$©h9k_wmi_cmd_issue
(
wmi
 *wmi,

274 
sk_buff
 *
skb
,

275 
wmi_cmd_id
 
cmd
, 
u16
 
Àn
)

277 
wmi_cmd_hdr
 *
hdr
;

278 
Êags
;

280 
hdr
 = (
wmi_cmd_hdr
 *Ë
	`skb_push
(
skb
, (wmi_cmd_hdr));

281 
hdr
->
comm™d_id
 = 
	`˝u_to_be16
(
cmd
);

282 
hdr
->
£q_no
 = 
	`˝u_to_be16
(++
wmi
->
tx_£q_id
);

284 
	`•ö_lock_úqßve
(&
wmi
->
wmi_lock
, 
Êags
);

285 
wmi
->
œ°_£q_id
 = wmi->
tx_£q_id
;

286 
	`•ö_u∆ock_úqª°‹e
(&
wmi
->
wmi_lock
, 
Êags
);

288  
	`htc_£nd_ïid
(
wmi
->
htc
, 
skb
, wmi->
˘æ_ïid
);

289 
	}
}

291 
	$©h9k_wmi_cmd
(
wmi
 *wmi, 
wmi_cmd_id
 
cmd_id
,

292 
u8
 *
cmd_buf
, 
u32
 
cmd_Àn
,

293 
u8
 *
r•_buf
, 
u32
 
r•_Àn
,

294 
u32
 
timeout
)

296 
©h_hw
 *
ah
 = 
wmi
->
drv_¥iv
->ah;

297 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

298 
u16
 
hódroom
 = (
htc_‰ame_hdr
) +

299 (
wmi_cmd_hdr
);

300 
sk_buff
 *
skb
;

301 
u8
 *
d©a
;

302 
time_À·
;

303 
ªt
 = 0;

305 i‡(
ah
->
ah_Êags
 & 
AH_UNPLUGGED
)

308 
skb
 = 
	`Æloc_skb
(
hódroom
 + 
cmd_Àn
, 
GFP_ATOMIC
);

309 i‡(!
skb
)

310  -
ENOMEM
;

312 
	`skb_ª£rve
(
skb
, 
hódroom
);

314 i‡(
cmd_Àn
 !0 && 
cmd_buf
 !
NULL
) {

315 
d©a
 = (
u8
 *Ë
	`skb_put
(
skb
, 
cmd_Àn
);

316 
	`mem˝y
(
d©a
, 
cmd_buf
, 
cmd_Àn
);

319 
	`muãx_lock
(&
wmi
->
›_muãx
);

322 i‡(
	`u∆ikñy
(
wmi
->
°›≥d
)) {

323 
ªt
 = -
EPROTO
;

324 
out
;

328 
wmi
->
cmd_r•_buf
 = 
r•_buf
;

329 
wmi
->
cmd_r•_Àn
 = 
r•_Àn
;

331 
ªt
 = 
	`©h9k_wmi_cmd_issue
(
wmi
, 
skb
, 
cmd_id
, 
cmd_Àn
);

332 i‡(
ªt
)

333 
out
;

335 
time_À·
 = 
	`waô_f‹_com∂ëi⁄_timeout
(&
wmi
->
cmd_waô
, 
timeout
);

336 i‡(!
time_À·
) {

337 
	`©h_dbg
(
comm⁄
, 
WMI
, "Timeout waiting for WMI command: %s\n",

338 
	`wmi_cmd_to_«me
(
cmd_id
));

339 
	`muãx_u∆ock
(&
wmi
->
›_muãx
);

340  -
ETIMEDOUT
;

343 
	`muãx_u∆ock
(&
wmi
->
›_muãx
);

347 
out
:

348 
	`©h_dbg
(
comm⁄
, 
WMI
, "WMI faûuª f‹: %s\n", 
	`wmi_cmd_to_«me
(
cmd_id
));

349 
	`muãx_u∆ock
(&
wmi
->
›_muãx
);

350 
	`k‰ì_skb
(
skb
);

352  
ªt
;

353 
	}
}

	@wmi.h

17 #i‚de‡
WMI_H


18 
	#WMI_H


	)

20 
	swmi_evít_txøã
 {

21 
__be32
 
	mtxøã
;

23 
u8
 
	mrssi_thªsh
;

24 
u8
 
	m≥r
;

25 } 
	mrc_°©s
;

26 } 
	g__∑cked
;

28 
	swmi_cmd_hdr
 {

29 
__be16
 
	mcomm™d_id
;

30 
__be16
 
	m£q_no
;

31 } 
	g__∑cked
;

33 
	swmi_fw_vîsi⁄
 {

34 
__be16
 
	mmaj‹
;

35 
__be16
 
	mmö‹
;

37 } 
	g__∑cked
;

39 
	swmi_evít_swba
 {

40 
__be64
 
	mtsf
;

41 
u8
 
	mbóc⁄_≥ndög
;

42 } 
	g__∑cked
;

49 
	#HTC_MAX_TX_STATUS
 12

	)

51 
	#ATH9K_HTC_TXSTAT_ACK
 
	`BIT
(0)

	)

52 
	#ATH9K_HTC_TXSTAT_FILT
 
	`BIT
(1)

	)

53 
	#ATH9K_HTC_TXSTAT_RTC_CTS
 
	`BIT
(2)

	)

54 
	#ATH9K_HTC_TXSTAT_MCS
 
	`BIT
(3)

	)

55 
	#ATH9K_HTC_TXSTAT_CW40
 
	`BIT
(4)

	)

56 
	#ATH9K_HTC_TXSTAT_SGI
 
	`BIT
(5)

	)

64 
	#ATH9K_HTC_TXSTAT_RATE
 0x0f

	)

65 
	#ATH9K_HTC_TXSTAT_RATE_S
 0

	)

67 
	#ATH9K_HTC_TXSTAT_EPID
 0xf0

	)

68 
	#ATH9K_HTC_TXSTAT_EPID_S
 4

	)

70 
	s__wmi_evít_tx°©us
 {

71 
u8
 
	mcookõ
;

72 
u8
 
	mts_øã
;

73 
u8
 
	mts_Êags
;

76 
	swmi_evít_tx°©us
 {

77 
u8
 
	m˙t
;

78 
__wmi_evít_tx°©us
 
	mtx°©us
[
HTC_MAX_TX_STATUS
];

79 } 
	g__∑cked
;

81 
	ewmi_cmd_id
 {

82 
	mWMI_ECHO_CMDID
 = 0x0001,

83 
	mWMI_ACCESS_MEMORY_CMDID
,

86 
	mWMI_GET_FW_VERSION
,

87 
	mWMI_DISABLE_INTR_CMDID
,

88 
	mWMI_ENABLE_INTR_CMDID
,

89 
	mWMI_ATH_INIT_CMDID
,

90 
	mWMI_ABORT_TXQ_CMDID
,

91 
	mWMI_STOP_TX_DMA_CMDID
,

92 
	mWMI_ABORT_TX_DMA_CMDID
,

93 
	mWMI_DRAIN_TXQ_CMDID
,

94 
	mWMI_DRAIN_TXQ_ALL_CMDID
,

95 
	mWMI_START_RECV_CMDID
,

96 
	mWMI_STOP_RECV_CMDID
,

97 
	mWMI_FLUSH_RECV_CMDID
,

98 
	mWMI_SET_MODE_CMDID
,

99 
	mWMI_NODE_CREATE_CMDID
,

100 
	mWMI_NODE_REMOVE_CMDID
,

101 
	mWMI_VAP_REMOVE_CMDID
,

102 
	mWMI_VAP_CREATE_CMDID
,

103 
	mWMI_REG_READ_CMDID
,

104 
	mWMI_REG_WRITE_CMDID
,

105 
	mWMI_RC_STATE_CHANGE_CMDID
,

106 
	mWMI_RC_RATE_UPDATE_CMDID
,

107 
	mWMI_TARGET_IC_UPDATE_CMDID
,

108 
	mWMI_TX_AGGR_ENABLE_CMDID
,

109 
	mWMI_TGT_DETACH_CMDID
,

110 
	mWMI_NODE_UPDATE_CMDID
,

111 
	mWMI_INT_STATS_CMDID
,

112 
	mWMI_TX_STATS_CMDID
,

113 
	mWMI_RX_STATS_CMDID
,

114 
	mWMI_BITRATE_MASK_CMDID
,

115 
	mWMI_REG_RMW_CMDID
,

118 
	ewmi_evít_id
 {

119 
	mWMI_TGT_RDY_EVENTID
 = 0x1001,

120 
	mWMI_SWBA_EVENTID
,

121 
	mWMI_FATAL_EVENTID
,

122 
	mWMI_TXTO_EVENTID
,

123 
	mWMI_BMISS_EVENTID
,

124 
	mWMI_DELBA_EVENTID
,

125 
	mWMI_TXSTATUS_EVENTID
,

128 
	#MAX_CMD_NUMBER
 62

	)

129 
	#MAX_RMW_CMD_NUMBER
 15

	)

131 
	sªgi°î_wrôe
 {

132 
__be32
 
	mªg
;

133 
__be32
 
	mvÆ
;

136 
	sªgi°î_rmw
 {

137 
__be32
 
	mªg
;

138 
__be32
 
	m£t
;

139 
__be32
 
	m˛r
;

140 } 
	g__∑cked
;

142 
	s©h9k_htc_tx_evít
 {

143 
	mcou¡
;

144 
__wmi_evít_tx°©us
 
	mtxs
;

145 
li°_hód
 
	mli°
;

148 
	swmi
 {

149 
©h9k_htc_¥iv
 *
	mdrv_¥iv
;

150 
htc_èrgë
 *
	mhtc
;

151 
htc_ídpoöt_id
 
	m˘æ_ïid
;

152 
muãx
 
	m›_muãx
;

153 
com∂ëi⁄
 
	mcmd_waô
;

154 
u16
 
	mœ°_£q_id
;

155 
sk_buff_hód
 
	mwmi_evít_queue
;

156 
èskÀt_°ru˘
 
	mwmi_evít_èskÀt
;

157 
u16
 
	mtx_£q_id
;

158 
u8
 *
	mcmd_r•_buf
;

159 
u32
 
	mcmd_r•_Àn
;

160 
boﬁ
 
	m°›≥d
;

162 
li°_hód
 
	m≥ndög_tx_evíts
;

163 
•ölock_t
 
	mevít_lock
;

165 
•ölock_t
 
	mwmi_lock
;

168 
©omic_t
 
	mmwrôe_˙t
;

169 
ªgi°î_wrôe
 
	mmu…i_wrôe
[
MAX_CMD_NUMBER
];

170 
u32
 
	mmu…i_wrôe_idx
;

171 
muãx
 
	mmu…i_wrôe_muãx
;

174 
©omic_t
 
	mm_rmw_˙t
;

175 
ªgi°î_rmw
 
	mmu…i_rmw
[
MAX_RMW_CMD_NUMBER
];

176 
u32
 
	mmu…i_rmw_idx
;

177 
muãx
 
	mmu…i_rmw_muãx
;

181 
wmi
 *
©h9k_öô_wmi
(
©h9k_htc_¥iv
 *
¥iv
);

182 
©h9k_deöô_wmi
(
©h9k_htc_¥iv
 *
¥iv
);

183 
©h9k_wmi_c⁄√˘
(
htc_èrgë
 *
htc
, 
wmi
 *wmi,

184 
htc_ídpoöt_id
 *
wmi_˘æ_ïid
);

185 
©h9k_wmi_cmd
(
wmi
 *wmi, 
wmi_cmd_id
 
cmd_id
,

186 
u8
 *
cmd_buf
, 
u32
 
cmd_Àn
,

187 
u8
 *
r•_buf
, 
u32
 
r•_Àn
,

188 
u32
 
timeout
);

189 
©h9k_wmi_evít_èskÀt
(
d©a
);

190 
©h9k_Áèl_w‹k
(
w‹k_°ru˘
 *
w‹k
);

191 
©h9k_wmi_evít_døö
(
©h9k_htc_¥iv
 *
¥iv
);

193 
	#WMI_CMD
(
_wmi_cmd
) \

195 
ªt
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
_wmi_cmd
, 
NULL
, 0, \

196 (
u8
 *Ë&
cmd_r•
, \

197 (
cmd_r•
), 
HZ
*2); \

198 } 0)

	)

200 
	#WMI_CMD_BUF
(
_wmi_cmd
, 
_buf
) \

202 
ªt
 = 
	`©h9k_wmi_cmd
(
¥iv
->
wmi
, 
_wmi_cmd
, \

203 (
u8
 *Ë
_buf
, (*_buf), \

204 &
cmd_r•
, (cmd_r•), 
HZ
*2); \

205 } 0)

	)

	@wow.c

17 
	~"©h9k.h
"

19 c⁄° 
wùhy_wowœn_suµ‹t
 
	g©h9k_wowœn_suµ‹t_Àgacy
 = {

20 .
Êags
 = 
WIPHY_WOWLAN_MAGIC_PKT
 | 
WIPHY_WOWLAN_DISCONNECT
,

21 .
	gn_∑âîns
 = 
MAX_NUM_USER_PATTERN
,

22 .
	g∑âîn_mö_Àn
 = 1,

23 .
	g∑âîn_max_Àn
 = 
MAX_PATTERN_SIZE
,

26 c⁄° 
wùhy_wowœn_suµ‹t
 
	g©h9k_wowœn_suµ‹t
 = {

27 .
Êags
 = 
WIPHY_WOWLAN_MAGIC_PKT
 | 
WIPHY_WOWLAN_DISCONNECT
,

28 .
	gn_∑âîns
 = 
MAX_NUM_PATTERN
 - 2,

29 .
	g∑âîn_mö_Àn
 = 1,

30 .
	g∑âîn_max_Àn
 = 
MAX_PATTERN_SIZE
,

33 
u8
 
	$©h9k_wow_m≠_åiggîs
(
©h_so·c
 *
sc
,

34 
cfg80211_wowœn
 *
wowœn
)

36 
u8
 
wow_åiggîs
 = 0;

38 i‡(
wowœn
->
disc⁄√˘
)

39 
wow_åiggîs
 |
AH_WOW_LINK_CHANGE
 |

40 
AH_WOW_BEACON_MISS
;

41 i‡(
wowœn
->
magic_pkt
)

42 
wow_åiggîs
 |
AH_WOW_MAGIC_PATTERN_EN
;

44 i‡(
wowœn
->
n_∑âîns
)

45 
wow_åiggîs
 |
AH_WOW_USER_PATTERN_EN
;

47  
wow_åiggîs
;

48 
	}
}

50 
	$©h9k_wow_add_dißssoc_dóuth_∑âîn
(
©h_so·c
 *
sc
)

52 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

53 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

54 
∑âîn_cou¡
 = 0;

55 
ªt
, 
i
, 
byã_˙t
 = 0;

56 
u8
 
dis_dóuth_∑âîn
[
MAX_PATTERN_SIZE
];

57 
u8
 
dis_dóuth_mask
[
MAX_PATTERN_SIZE
];

59 
	`mem£t
(
dis_dóuth_∑âîn
, 0, 
MAX_PATTERN_SIZE
);

60 
	`mem£t
(
dis_dóuth_mask
, 0, 
MAX_PATTERN_SIZE
);

91 
i
 = 0; i < 
MAX_PATTERN_MASK_SIZE
; i++)

92 
dis_dóuth_mask
[
i
] = 0xff;

95 
dis_dóuth_∑âîn
[
byã_˙t
] = 0xa0;

96 
byã_˙t
++;

99 
byã_˙t
 += 3;

105 
byã_˙t
 += 6;

108 
	`mem˝y
((
dis_dóuth_∑âîn
 + 
byã_˙t
), 
comm⁄
->
curbssid
, 
ETH_ALEN
);

110 
byã_˙t
 += 6;

113 
	`mem˝y
((
dis_dóuth_∑âîn
 + 
byã_˙t
), 
comm⁄
->
curbssid
, 
ETH_ALEN
);

116 
dis_dóuth_mask
[0] = 0xfe;

117 
dis_dóuth_mask
[1] = 0x03;

118 
dis_dóuth_mask
[2] = 0xc0;

120 
ªt
 = 
	`©h9k_hw_wow_≠∂y_∑âîn
(
ah
, 
dis_dóuth_∑âîn
, 
dis_dóuth_mask
,

121 
∑âîn_cou¡
, 
byã_˙t
);

122 i‡(
ªt
)

123 
exô
;

125 
∑âîn_cou¡
++;

130 
dis_dóuth_∑âîn
[0] = 0xC0;

132 
ªt
 = 
	`©h9k_hw_wow_≠∂y_∑âîn
(
ah
, 
dis_dóuth_∑âîn
, 
dis_dóuth_mask
,

133 
∑âîn_cou¡
, 
byã_˙t
);

134 
exô
:

135  
ªt
;

136 
	}
}

138 
	$©h9k_wow_add_∑âîn
(
©h_so·c
 *
sc
,

139 
cfg80211_wowœn
 *
wowœn
)

141 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

142 
cfg80211_pkt_∑âîn
 *
∑âîns
 = 
wowœn
->patterns;

143 
u8
 
wow_∑âîn
[
MAX_PATTERN_SIZE
];

144 
u8
 
wow_mask
[
MAX_PATTERN_SIZE
];

145 
mask_Àn
, 
ªt
 = 0;

146 
s8
 
i
 = 0;

148 
i
 = 0; i < 
wowœn
->
n_∑âîns
; i++) {

149 
mask_Àn
 = 
	`DIV_ROUND_UP
(
∑âîns
[
i
].
∑âîn_Àn
, 8);

150 
	`mem£t
(
wow_∑âîn
, 0, 
MAX_PATTERN_SIZE
);

151 
	`mem£t
(
wow_mask
, 0, 
MAX_PATTERN_SIZE
);

152 
	`mem˝y
(
wow_∑âîn
, 
∑âîns
[
i
].
∑âîn
,Ö©ã∫s[i].
∑âîn_Àn
);

153 
	`mem˝y
(
wow_mask
, 
∑âîns
[
i
].
mask
, 
mask_Àn
);

155 
ªt
 = 
	`©h9k_hw_wow_≠∂y_∑âîn
(
ah
,

156 
wow_∑âîn
,

157 
wow_mask
,

158 
i
 + 2,

159 
∑âîns
[
i
].
∑âîn_Àn
);

160 i‡(
ªt
)

164  
ªt
;

165 
	}
}

167 
	$©h9k_su•íd
(
õì80211_hw
 *
hw
,

168 
cfg80211_wowœn
 *
wowœn
)

170 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

171 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

172 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

173 
u8
 
åiggîs
;

174 
ªt
 = 0;

176 
	`©h9k_deöô_ch™√l_c⁄ãxt
(
sc
);

178 
	`muãx_lock
(&
sc
->
muãx
);

180 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
)) {

181 
	`©h_îr
(
comm⁄
, "DeviceÇotÖresent\n");

182 
ªt
 = -
ENODEV
;

183 
Áû_wow
;

186 i‡(
	`WARN_ON
(!
wowœn
)) {

187 
	`©h_îr
(
comm⁄
, "None ofÅhe WoWÅriggersÉnabled\n");

188 
ªt
 = -
EINVAL
;

189 
Áû_wow
;

192 i‡(
sc
->
cur_ch™
->
nvifs
 > 1) {

193 
	`©h_dbg
(
comm⁄
, 
WOW
, "WoW for multivif isÇot yet supported\n");

194 
ªt
 = 1;

195 
Áû_wow
;

198 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

199 i‡(
	`ã°_bô
(
ATH_OP_MULTI_CHANNEL
, &
comm⁄
->
›_Êags
)) {

200 
	`©h_dbg
(
comm⁄
, 
WOW
,

202 
ªt
 = 1;

203 
Áû_wow
;

207 i‡(!
	`ã°_bô
(
ATH_OP_PRIM_STA_VIF
, &
comm⁄
->
›_Êags
)) {

208 
	`©h_dbg
(
comm⁄
, 
WOW
, "None ofÅhe STA vifsáreássociated\n");

209 
ªt
 = 1;

210 
Áû_wow
;

213 
åiggîs
 = 
	`©h9k_wow_m≠_åiggîs
(
sc
, 
wowœn
);

214 i‡(!
åiggîs
) {

215 
	`©h_dbg
(
comm⁄
, 
WOW
, "No valid WoWÅriggers\n");

216 
ªt
 = 1;

217 
Áû_wow
;

220 
	`©h_ˇn˚l_w‹k
(
sc
);

221 
	`©h_°›_™i
(
sc
);

223 
	`©h9k_ps_wakeup
(
sc
);

225 
	`©h9k_°›_btc€x
(
sc
);

231 
ªt
 = 
	`©h9k_wow_add_dißssoc_dóuth_∑âîn
(
sc
);

232 i‡(
ªt
) {

233 
	`©h_îr
(
comm⁄
,

234 "U«bÀÅÿadd dißssoc/dóuthÖ©ã∫: %d\n", 
ªt
);

235 
Áû_wow
;

238 i‡(
åiggîs
 & 
AH_WOW_USER_PATTERN_EN
) {

239 
ªt
 = 
	`©h9k_wow_add_∑âîn
(
sc
, 
wowœn
);

240 i‡(
ªt
) {

241 
	`©h_îr
(
comm⁄
,

242 "U«bÀÅÿadd u£∏∑âîn: %d\n", 
ªt
);

243 
Áû_wow
;

247 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

253 
sc
->
wow_öå_bef‹e_¶ìp
 = 
ah
->
imask
;

254 
ah
->
imask
 &~
ATH9K_INT_GLOBAL
;

255 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

256 
ah
->
imask
 = 
ATH9K_INT_BMISS
 | 
ATH9K_INT_GLOBAL
;

257 
	`©h9k_hw_£t_öãºu±s
(
ah
);

258 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

260 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

266 
	`synchr⁄ize_úq
(
sc
->
úq
);

267 
	`èskÀt_kûl
(&
sc
->
öå_tq
);

269 
	`©h9k_hw_wow_íabÀ
(
ah
, 
åiggîs
);

271 
	`©h9k_ps_ª°‹e
(
sc
);

272 
	`©h_dbg
(
comm⁄
, 
WOW
, "Su•íd wôh WoWÅriggîs: 0x%x\n", 
åiggîs
);

274 
	`£t_bô
(
ATH_OP_WOW_ENABLED
, &
comm⁄
->
›_Êags
);

275 
Áû_wow
:

276 
	`muãx_u∆ock
(&
sc
->
muãx
);

277  
ªt
;

278 
	}
}

280 
	$©h9k_ªsume
(
õì80211_hw
 *
hw
)

282 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

283 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

284 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

285 
u8
 
°©us
;

287 
	`muãx_lock
(&
sc
->
muãx
);

289 
	`©h9k_ps_wakeup
(
sc
);

291 
	`•ö_lock_bh
(&
sc
->
sc_pcu_lock
);

293 
	`©h9k_hw_dißbÀ_öãºu±s
(
ah
);

294 
ah
->
imask
 = 
sc
->
wow_öå_bef‹e_¶ìp
;

295 
	`©h9k_hw_£t_öãºu±s
(
ah
);

296 
	`©h9k_hw_íabÀ_öãºu±s
(
ah
);

298 
	`•ö_u∆ock_bh
(&
sc
->
sc_pcu_lock
);

300 
°©us
 = 
	`©h9k_hw_wow_wakeup
(
ah
);

301 
	`©h_dbg
(
comm⁄
, 
WOW
, "Resumêwôh WoW sètus: 0x%x\n", 
°©us
);

303 
	`©h_ª°¨t_w‹k
(
sc
);

304 
	`©h9k_°¨t_btc€x
(
sc
);

306 
	`˛ór_bô
(
ATH_OP_WOW_ENABLED
, &
comm⁄
->
›_Êags
);

308 
	`©h9k_ps_ª°‹e
(
sc
);

309 
	`muãx_u∆ock
(&
sc
->
muãx
);

312 
	}
}

314 
	$©h9k_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
)

316 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

317 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

319 
	`muãx_lock
(&
sc
->
muãx
);

320 
	`devi˚_£t_wakeup_íabÀ
(
sc
->
dev
, 
íabÀd
);

321 
	`muãx_u∆ock
(&
sc
->
muãx
);

323 
	`©h_dbg
(
comm⁄
, 
WOW
, "WoW wakeup source is %s\n",

324 (
íabÀd
) ? "enabled" : "disabled");

325 
	}
}

327 
	$©h9k_öô_wow
(
õì80211_hw
 *
hw
)

329 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

330 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

332 i‡((
sc
->
drivî_d©a
 & 
ATH9K_PCI_WOW
Ë|| sc->
f‹˚_wow
) {

333 i‡(
	`AR_SREV_9462_20_OR_LATER
(
ah
Ë|| 
	`AR_SREV_9565_11_OR_LATER
(ah))

334 
hw
->
wùhy
->
wowœn
 = &
©h9k_wowœn_suµ‹t
;

336 
hw
->
wùhy
->
wowœn
 = &
©h9k_wowœn_suµ‹t_Àgacy
;

338 
	`devi˚_öô_wakeup
(
sc
->
dev
, 1);

340 
	}
}

342 
	$©h9k_deöô_wow
(
õì80211_hw
 *
hw
)

344 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

346 i‡((
sc
->
drivî_d©a
 & 
ATH9K_PCI_WOW
Ë|| sc->
f‹˚_wow
)

347 
	`devi˚_öô_wakeup
(
sc
->
dev
, 0);

348 
	}
}

	@xmit.c

17 
	~<löux/dma-m≠pög.h
>

18 
	~"©h9k.h
"

19 
	~"¨9003_mac.h
"

21 
	#BITS_PER_BYTE
 8

	)

22 
	#OFDM_PLCP_BITS
 22

	)

23 
	#HT_RC_2_STREAMS
(
_rc
Ë((((_rcË& 0x78Ë>> 3Ë+ 1)

	)

24 
	#L_STF
 8

	)

25 
	#L_LTF
 8

	)

26 
	#L_SIG
 4

	)

27 
	#HT_SIG
 8

	)

28 
	#HT_STF
 4

	)

29 
	#HT_LTF
(
_ns
Ë(4 * (_ns))

	)

30 
	#SYMBOL_TIME
(
_ns
Ë((_nsË<< 2Ë

	)

31 
	#SYMBOL_TIME_HALFGI
(
_ns
Ë(((_nsË* 18 + 4Ë/ 5Ë

	)

32 
	#TIME_SYMBOLS
(
t
Ë(—Ë>> 2)

	)

33 
	#TIME_SYMBOLS_HALFGI
(
t
Ë((—Ë* 5 - 4Ë/ 18)

	)

34 
	#NUM_SYMBOLS_PER_USEC
(
_u£c
Ë(_u£¯>> 2)

	)

35 
	#NUM_SYMBOLS_PER_USEC_HALFGI
(
_u£c
Ë(((_u£c*5)-4)/18)

	)

38 
u16
 
	gbôs_≥r_symbﬁ
[][2] = {

50 
©h_tx_£nd_n‹mÆ
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

51 
©h_©x_tid
 *
tid
, 
sk_buff
 *
skb
);

52 
©h_tx_com∂ëe
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
,

53 
tx_Êags
, 
©h_txq
 *
txq
);

54 
©h_tx_com∂ëe_buf
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

55 
©h_txq
 *
txq
, 
li°_hód
 *
bf_q
,

56 
©h_tx_°©us
 *
ts
, 
txok
);

57 
©h_tx_txqaddbuf
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

58 
li°_hód
 *
hód
, 
boﬁ
 
öã∫Æ
);

59 
©h_tx_rc_°©us
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

60 
©h_tx_°©us
 *
ts
, 
n‰ames
, 
nbad
,

61 
txok
);

62 
©h_tx_upd©e_baw
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
,

63 
£qno
);

64 
©h_buf
 *
©h_tx_£tup_buf„r
(
©h_so·c
 *
sc
,

65 
©h_txq
 *
txq
,

66 
©h_©x_tid
 *
tid
,

67 
sk_buff
 *
skb
);

70 
	mMCS_HT20
,

71 
	mMCS_HT20_SGI
,

72 
	mMCS_HT40
,

73 
	mMCS_HT40_SGI
,

80 
	$©h_txq_lock
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

81 
	`__acquúes
(&
txq
->
axq_lock
)

83 
	`•ö_lock_bh
(&
txq
->
axq_lock
);

84 
	}
}

86 
	$©h_txq_u∆ock
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

87 
	`__ªÀa£s
(&
txq
->
axq_lock
)

89 
	`•ö_u∆ock_bh
(&
txq
->
axq_lock
);

90 
	}
}

92 
	$©h_txq_u∆ock_com∂ëe
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

93 
	`__ªÀa£s
(&
txq
->
axq_lock
)

95 
sk_buff_hód
 
q
;

96 
sk_buff
 *
skb
;

98 
	`__skb_queue_hód_öô
(&
q
);

99 
	`skb_queue_•li˚_öô
(&
txq
->
com∂ëe_q
, &
q
);

100 
	`•ö_u∆ock_bh
(&
txq
->
axq_lock
);

102 (
skb
 = 
	`__skb_dequeue
(&
q
)))

103 
	`õì80211_tx_°©us
(
sc
->
hw
, 
skb
);

104 
	}
}

106 
	$©h_tx_queue_tid
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

107 
©h_©x_tid
 *
tid
)

109 
li°_hód
 *
li°
;

110 
©h_vif
 *
avp
 = (©h_vi‡*Ë
tid
->
™
->
vif
->
drv_¥iv
;

111 
©h_ch™˘x
 *
˘x
 = 
avp
->
ch™˘x
;

113 i‡(!
˘x
)

116 
li°
 = &
˘x
->
acq
[
	`TID_TO_WME_AC
(
tid
->
tidno
)];

117 i‡(
	`li°_em±y
(&
tid
->
li°
))

118 
	`li°_add_èû
(&
tid
->
li°
,Üist);

119 
	}
}

121 
©h_‰ame_öfo
 *
	$gë_‰ame_öfo
(
sk_buff
 *
skb
)

123 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

124 
	`BUILD_BUG_ON
((
©h_‰ame_öfo
) >

125 (
tx_öfo
->
øã_drivî_d©a
));

126  (
©h_‰ame_öfo
 *Ë&
tx_öfo
->
øã_drivî_d©a
[0];

127 
	}
}

129 
	$©h_£nd_b¨
(
©h_©x_tid
 *
tid
, 
u16
 
£qno
)

131 i‡(!
tid
->
™
->
°a
)

134 
	`õì80211_£nd_b¨
(
tid
->
™
->
vif
,Åid->™->
°a
->
addr
,Åid->
tidno
,

135 
£qno
 << 
IEEE80211_SEQ_SEQ_SHIFT
);

136 
	}
}

138 
	$©h_£t_øãs
(
õì80211_vif
 *
vif
, 
õì80211_°a
 *
°a
,

139 
©h_buf
 *
bf
, 
boﬁ
 
ps
)

141 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

143 i‡(
ps
) {

145 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
 = -1;

146 
öfo
->
c⁄åﬁ
.
øãs
[0].
cou¡
 = 0;

149 
	`õì80211_gë_tx_øãs
(
vif
, 
°a
, 
bf
->
bf_mpdu
, bf->
øãs
,

150 
	`ARRAY_SIZE
(
bf
->
øãs
));

151 i‡(!
ps
)

154 i‡(
bf
->
øãs
[0].
cou¡
 > 2)

155 
bf
->
øãs
[0].
cou¡
 = 2;

157 
bf
->
øãs
[1].
idx
 = -1;

158 
	}
}

160 
	$©h_txq_skb_d⁄e
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

161 
sk_buff
 *
skb
)

163 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

164 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

165 
q
 = 
fi
->
txq
;

167 i‡(
q
 < 0)

170 
txq
 = 
sc
->
tx
.
txq_m≠
[
q
];

171 i‡(
	`WARN_ON
(--
txq
->
≥ndög_‰ames
 < 0))

172 
txq
->
≥ndög_‰ames
 = 0;

174 i‡(
txq
->
°›≥d
 &&

175 
txq
->
≥ndög_‰ames
 < 
sc
->
tx
.
txq_max_≥ndög
[
q
]) {

176 i‡(
	`©h9k_is_ch™˘x_íabÀd
())

177 
	`õì80211_wake_queue
(
sc
->
hw
, 
öfo
->
hw_queue
);

179 
	`õì80211_wake_queue
(
sc
->
hw
, 
q
);

180 
txq
->
°›≥d
 = 
Ál£
;

182 
	}
}

184 
©h_©x_tid
 *

185 
	$©h_gë_skb_tid
(
©h_so·c
 *
sc
, 
©h_node
 *
™
, 
sk_buff
 *
skb
)

187 
u8
 
tidno
 = 
skb
->
¥i‹ôy
 & 
IEEE80211_QOS_CTL_TID_MASK
;

188  
	`ATH_AN_2_TID
(
™
, 
tidno
);

189 
	}
}

191 
boﬁ
 
	$©h_tid_has_buf„ªd
(
©h_©x_tid
 *
tid
)

193  !
	`skb_queue_em±y
(&
tid
->
buf_q
Ë|| !skb_queue_em±y(&tid->
ªåy_q
);

194 
	}
}

196 
sk_buff
 *
	$©h_tid_dequeue
(
©h_©x_tid
 *
tid
)

198 
sk_buff
 *
skb
;

200 
skb
 = 
	`__skb_dequeue
(&
tid
->
ªåy_q
);

201 i‡(!
skb
)

202 
skb
 = 
	`__skb_dequeue
(&
tid
->
buf_q
);

204  
skb
;

205 
	}
}

213 
	$©h_tx_tid_ch™ge_°©e
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
)

215 
©h_txq
 *
txq
 = 
tid
->txq;

216 
õì80211_tx_öfo
 *
tx_öfo
;

217 
sk_buff
 *
skb
, *
tskb
;

218 
©h_buf
 *
bf
;

219 
©h_‰ame_öfo
 *
fi
;

221 
	`skb_queue_wÆk_ß„
(&
tid
->
buf_q
, 
skb
, 
tskb
) {

222 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

223 
bf
 = 
fi
->bf;

225 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

226 
tx_öfo
->
Êags
 &~
IEEE80211_TX_CTL_AMPDU
;

228 i‡(
bf
)

231 
bf
 = 
	`©h_tx_£tup_buf„r
(
sc
, 
txq
, 
tid
, 
skb
);

232 i‡(!
bf
) {

233 
	`__skb_u∆ök
(
skb
, &
tid
->
buf_q
);

234 
	`©h_txq_skb_d⁄e
(
sc
, 
txq
, 
skb
);

235 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

240 
	}
}

242 
	$©h_tx_Êush_tid
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
)

244 
©h_txq
 *
txq
 = 
tid
->txq;

245 
sk_buff
 *
skb
;

246 
©h_buf
 *
bf
;

247 
li°_hód
 
bf_hód
;

248 
©h_tx_°©us
 
ts
;

249 
©h_‰ame_öfo
 *
fi
;

250 
boﬁ
 
£ndb¨
 = 
Ál£
;

252 
	`INIT_LIST_HEAD
(&
bf_hód
);

254 
	`mem£t
(&
ts
, 0, (ts));

256 (
skb
 = 
	`__skb_dequeue
(&
tid
->
ªåy_q
))) {

257 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

258 
bf
 = 
fi
->bf;

259 i‡(!
bf
) {

260 
	`©h_txq_skb_d⁄e
(
sc
, 
txq
, 
skb
);

261 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

265 i‡(
fi
->
baw_åacked
) {

266 
	`©h_tx_upd©e_baw
(
sc
, 
tid
, 
bf
->
bf_°©e
.
£qno
);

267 
£ndb¨
 = 
åue
;

270 
	`li°_add_èû
(&
bf
->
li°
, &
bf_hód
);

271 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, &
bf_hód
, &
ts
, 0);

274 i‡(
£ndb¨
) {

275 
	`©h_txq_u∆ock
(
sc
, 
txq
);

276 
	`©h_£nd_b¨
(
tid
,Åid->
£q_°¨t
);

277 
	`©h_txq_lock
(
sc
, 
txq
);

279 
	}
}

281 
	$©h_tx_upd©e_baw
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
,

282 
£qno
)

284 
ödex
, 
cödex
;

286 
ödex
 = 
	`ATH_BA_INDEX
(
tid
->
£q_°¨t
, 
£qno
);

287 
cödex
 = (
tid
->
baw_hód
 + 
ödex
Ë& (
ATH_TID_MAX_BUFS
 - 1);

289 
	`__˛ór_bô
(
cödex
, 
tid
->
tx_buf
);

291 
tid
->
baw_hód
 !tid->
baw_èû
 && !
	`ã°_bô
—id->baw_hód,Åid->
tx_buf
)) {

292 
	`INCR
(
tid
->
£q_°¨t
, 
IEEE80211_SEQ_MAX
);

293 
	`INCR
(
tid
->
baw_hód
, 
ATH_TID_MAX_BUFS
);

294 i‡(
tid
->
b¨_ödex
 >= 0)

295 
tid
->
b¨_ödex
--;

297 
	}
}

299 
	$©h_tx_addto_baw
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
,

300 
©h_buf
 *
bf
)

302 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
bf
->
bf_mpdu
);

303 
u16
 
£qno
 = 
bf
->
bf_°©e
.seqno;

304 
ödex
, 
cödex
;

306 
ödex
 = 
	`ATH_BA_INDEX
(
tid
->
£q_°¨t
, 
£qno
);

307 
cödex
 = (
tid
->
baw_hód
 + 
ödex
Ë& (
ATH_TID_MAX_BUFS
 - 1);

308 
	`__£t_bô
(
cödex
, 
tid
->
tx_buf
);

309 
fi
->
baw_åacked
 = 1;

311 i‡(
ödex
 >((
tid
->
baw_èû
 -Åid->
baw_hód
) &

312 (
ATH_TID_MAX_BUFS
 - 1))) {

313 
tid
->
baw_èû
 = 
cödex
;

314 
	`INCR
(
tid
->
baw_èû
, 
ATH_TID_MAX_BUFS
);

316 
	}
}

318 
	$©h_tid_døö
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

319 
©h_©x_tid
 *
tid
)

322 
sk_buff
 *
skb
;

323 
©h_buf
 *
bf
;

324 
li°_hód
 
bf_hód
;

325 
©h_tx_°©us
 
ts
;

326 
©h_‰ame_öfo
 *
fi
;

328 
	`mem£t
(&
ts
, 0, (ts));

329 
	`INIT_LIST_HEAD
(&
bf_hód
);

331 (
skb
 = 
	`©h_tid_dequeue
(
tid
))) {

332 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

333 
bf
 = 
fi
->bf;

335 i‡(!
bf
) {

336 
	`©h_tx_com∂ëe
(
sc
, 
skb
, 
ATH_TX_ERROR
, 
txq
);

340 
	`li°_add_èû
(&
bf
->
li°
, &
bf_hód
);

341 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, &
bf_hód
, &
ts
, 0);

343 
	}
}

345 
	$©h_tx_£t_ªåy
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

346 
sk_buff
 *
skb
, 
cou¡
)

348 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

349 
©h_buf
 *
bf
 = 
fi
->bf;

350 
õì80211_hdr
 *
hdr
;

351 
¥ev
 = 
fi
->
ªåõs
;

353 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
a_ªåõs
);

354 
fi
->
ªåõs
 +
cou¡
;

356 i‡(
¥ev
 > 0)

359 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

360 
hdr
->
‰ame_c⁄åﬁ
 |
	`˝u_to_À16
(
IEEE80211_FCTL_RETRY
);

361 
	`dma_sync_sögÀ_f‹_devi˚
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

362 (*
hdr
), 
DMA_TO_DEVICE
);

363 
	}
}

365 
©h_buf
 *
	$©h_tx_gë_buf„r
(
©h_so·c
 *
sc
)

367 
©h_buf
 *
bf
 = 
NULL
;

369 
	`•ö_lock_bh
(&
sc
->
tx
.
txbuÊock
);

371 i‡(
	`u∆ikñy
(
	`li°_em±y
(&
sc
->
tx
.
txbuf
))) {

372 
	`•ö_u∆ock_bh
(&
sc
->
tx
.
txbuÊock
);

373  
NULL
;

376 
bf
 = 
	`li°_fú°_íåy
(&
sc
->
tx
.
txbuf
, 
©h_buf
, 
li°
);

377 
	`li°_dñ
(&
bf
->
li°
);

379 
	`•ö_u∆ock_bh
(&
sc
->
tx
.
txbuÊock
);

381  
bf
;

382 
	}
}

384 
	$©h_tx_ªtu∫_buf„r
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
)

386 
	`•ö_lock_bh
(&
sc
->
tx
.
txbuÊock
);

387 
	`li°_add_èû
(&
bf
->
li°
, &
sc
->
tx
.
txbuf
);

388 
	`•ö_u∆ock_bh
(&
sc
->
tx
.
txbuÊock
);

389 
	}
}

391 
©h_buf
* 
	$©h_˛⁄e_txbuf
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
)

393 
©h_buf
 *
tbf
;

395 
tbf
 = 
	`©h_tx_gë_buf„r
(
sc
);

396 i‡(
	`WARN_ON
(!
tbf
))

397  
NULL
;

399 
	`ATH_TXBUF_RESET
(
tbf
);

401 
tbf
->
bf_mpdu
 = 
bf
->bf_mpdu;

402 
tbf
->
bf_buf_addr
 = 
bf
->bf_buf_addr;

403 
	`mem˝y
(
tbf
->
bf_desc
, 
bf
->bf_desc, 
sc
->
sc_ah
->
ˇps
.
tx_desc_Àn
);

404 
tbf
->
bf_°©e
 = 
bf
->bf_state;

405 
tbf
->
bf_°©e
.
°Æe
 = 
Ál£
;

407  
tbf
;

408 
	}
}

410 
	$©h_tx_cou¡_‰ames
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

411 
©h_tx_°©us
 *
ts
, 
txok
,

412 *
n‰ames
, *
nbad
)

414 
©h_‰ame_öfo
 *
fi
;

415 
u16
 
£q_°
 = 0;

416 
u32
 
ba
[
WME_BA_BMP_SIZE
 >> 5];

417 
ba_ödex
;

418 
ißggr
 = 0;

420 *
nbad
 = 0;

421 *
n‰ames
 = 0;

423 
ißggr
 = 
	`bf_ißggr
(
bf
);

424 i‡(
ißggr
) {

425 
£q_°
 = 
ts
->
ts_£qnum
;

426 
	`mem˝y
(
ba
, &
ts
->
ba_low
, 
WME_BA_BMP_SIZE
 >> 3);

429 
bf
) {

430 
fi
 = 
	`gë_‰ame_öfo
(
bf
->
bf_mpdu
);

431 
ba_ödex
 = 
	`ATH_BA_INDEX
(
£q_°
, 
bf
->
bf_°©e
.
£qno
);

433 (*
n‰ames
)++;

434 i‡(!
txok
 || (
ißggr
 && !
	`ATH_BA_ISSET
(
ba
, 
ba_ödex
)))

435 (*
nbad
)++;

437 
bf
 = bf->
bf_√xt
;

439 
	}
}

442 
	$©h_tx_com∂ëe_aggr
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

443 
©h_buf
 *
bf
, 
li°_hód
 *
bf_q
,

444 
©h_tx_°©us
 *
ts
, 
txok
)

446 
©h_node
 *
™
 = 
NULL
;

447 
sk_buff
 *
skb
;

448 
õì80211_°a
 *
°a
;

449 
õì80211_hw
 *
hw
 = 
sc
->hw;

450 
õì80211_hdr
 *
hdr
;

451 
õì80211_tx_öfo
 *
tx_öfo
;

452 
©h_©x_tid
 *
tid
 = 
NULL
;

453 
©h_buf
 *
bf_√xt
, *
bf_œ°
 = 
bf
->
bf_œ°bf
;

454 
li°_hód
 
bf_hód
;

455 
sk_buff_hód
 
bf_≥ndög
;

456 
u16
 
£q_°
 = 0, 
acked_˙t
 = 0, 
txÁû_˙t
 = 0, 
£q_fú°
;

457 
u32
 
ba
[
WME_BA_BMP_SIZE
 >> 5];

458 
ißggr
, 
txÁû
, 
tx≥ndög
, 
£ndb¨
 = 0, 
√edª£t
 = 0, 
nbad
 = 0;

459 
boﬁ
 
rc_upd©e
 = 
åue
, 
isba
;

460 
õì80211_tx_øã
 
øãs
[4];

461 
©h_‰ame_öfo
 *
fi
;

462 
n‰ames
;

463 
boﬁ
 
Êush
 = !!(
ts
->
ts_°©us
 & 
ATH9K_TX_FLUSH
);

464 
i
, 
ªåõs
;

465 
b¨_ödex
 = -1;

467 
skb
 = 
bf
->
bf_mpdu
;

468 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

470 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

472 
	`mem˝y
(
øãs
, 
bf
->rates, (rates));

474 
ªåõs
 = 
ts
->
ts_l⁄gªåy
 + 1;

475 
i
 = 0; i < 
ts
->
ts_øãödex
; i++)

476 
ªåõs
 +
øãs
[
i
].
cou¡
;

478 
	`rcu_ªad_lock
();

480 
°a
 = 
	`õì80211_föd_°a_by_iÁddr
(
hw
, 
hdr
->
addr1
, hdr->
addr2
);

481 i‡(!
°a
) {

482 
	`rcu_ªad_u∆ock
();

484 
	`INIT_LIST_HEAD
(&
bf_hód
);

485 
bf
) {

486 
bf_√xt
 = 
bf
->bf_next;

488 i‡(!
bf
->
bf_°©e
.
°Æe
 || 
bf_√xt
 !
NULL
)

489 
	`li°_move_èû
(&
bf
->
li°
, &
bf_hód
);

491 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, &
bf_hód
, 
ts
, 0);

493 
bf
 = 
bf_√xt
;

498 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

499 
tid
 = 
	`©h_gë_skb_tid
(
sc
, 
™
, 
skb
);

500 
£q_fú°
 = 
tid
->
£q_°¨t
;

501 
isba
 = 
ts
->
ts_Êags
 & 
ATH9K_TX_BA
;

511 i‡(
isba
 && 
tid
->
tidno
 !
ts
->tid)

512 
txok
 = 
Ál£
;

514 
ißggr
 = 
	`bf_ißggr
(
bf
);

515 
	`mem£t
(
ba
, 0, 
WME_BA_BMP_SIZE
 >> 3);

517 i‡(
ißggr
 && 
txok
) {

518 i‡(
ts
->
ts_Êags
 & 
ATH9K_TX_BA
) {

519 
£q_°
 = 
ts
->
ts_£qnum
;

520 
	`mem˝y
(
ba
, &
ts
->
ba_low
, 
WME_BA_BMP_SIZE
 >> 3);

529 i‡(
sc
->
sc_ah
->
›mode
 =
NL80211_IFTYPE_STATION
)

530 
√edª£t
 = 1;

534 
	`__skb_queue_hód_öô
(&
bf_≥ndög
);

536 
	`©h_tx_cou¡_‰ames
(
sc
, 
bf
, 
ts
, 
txok
, &
n‰ames
, &
nbad
);

537 
bf
) {

538 
u16
 
£qno
 = 
bf
->
bf_°©e
.seqno;

540 
txÁû
 = 
tx≥ndög
 = 
£ndb¨
 = 0;

541 
bf_√xt
 = 
bf
->bf_next;

543 
skb
 = 
bf
->
bf_mpdu
;

544 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

545 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

547 i‡(!
	`BAW_WITHIN
(
tid
->
£q_°¨t
,Åid->
baw_size
, 
£qno
) ||

548 !
tid
->
a˘ive
) {

553 
txÁû
 = 1;

554 } i‡(
	`ATH_BA_ISSET
(
ba
, 
	`ATH_BA_INDEX
(
£q_°
, 
£qno
))) {

557 
acked_˙t
++;

558 } i‡(!
ißggr
 && 
txok
) {

560 
acked_˙t
++;

561 } i‡(
Êush
) {

562 
tx≥ndög
 = 1;

563 } i‡(
fi
->
ªåõs
 < 
ATH_MAX_SW_RETRIES
) {

564 i‡(
txok
 || !
™
->
¶ìpög
)

565 
	`©h_tx_£t_ªåy
(
sc
, 
txq
, 
bf
->
bf_mpdu
,

566 
ªåõs
);

568 
tx≥ndög
 = 1;

570 
txÁû
 = 1;

571 
txÁû_˙t
++;

572 
b¨_ödex
 = 
	`max_t
(, bar_index,

573 
	`ATH_BA_INDEX
(
£q_fú°
, 
£qno
));

580 
	`INIT_LIST_HEAD
(&
bf_hód
);

581 i‡(
bf_√xt
 !
NULL
 || !
bf_œ°
->
bf_°©e
.
°Æe
)

582 
	`li°_move_èû
(&
bf
->
li°
, &
bf_hód
);

584 i‡(!
tx≥ndög
) {

589 
	`©h_tx_upd©e_baw
(
sc
, 
tid
, 
£qno
);

591 i‡(
rc_upd©e
 && (
acked_˙t
 =1 || 
txÁû_˙t
 == 1)) {

592 
	`mem˝y
(
tx_öfo
->
c⁄åﬁ
.
øãs
,Ñates, (rates));

593 
	`©h_tx_rc_°©us
(
sc
, 
bf
, 
ts
, 
n‰ames
, 
nbad
, 
txok
);

594 
rc_upd©e
 = 
Ál£
;

595 i‡(
bf
 =bf->
bf_œ°bf
)

596 
	`©h_dy«ck_ßm∂e_tx_ts
(
sc
->
sc_ah
,

597 
bf
->
bf_mpdu
,

598 
ts
);

601 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, &
bf_hód
, 
ts
,

602 !
txÁû
);

604 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_STATUS_EOSP
) {

605 
tx_öfo
->
Êags
 &~
IEEE80211_TX_STATUS_EOSP
;

606 
	`õì80211_°a_eo•
(
°a
);

609 i‡(
bf
->
bf_√xt
 =
NULL
 && 
bf_œ°
->
bf_°©e
.
°Æe
) {

610 
©h_buf
 *
tbf
;

612 
tbf
 = 
	`©h_˛⁄e_txbuf
(
sc
, 
bf_œ°
);

618 i‡(!
tbf
) {

619 
	`©h_tx_upd©e_baw
(
sc
, 
tid
, 
£qno
);

621 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
,

622 &
bf_hód
, 
ts
, 0);

623 
b¨_ödex
 = 
	`max_t
(, bar_index,

624 
	`ATH_BA_INDEX
(
£q_fú°
, 
£qno
));

628 
fi
->
bf
 = 
tbf
;

635 
	`__skb_queue_èû
(&
bf_≥ndög
, 
skb
);

638 
bf
 = 
bf_√xt
;

642 i‡(!
	`skb_queue_em±y
(&
bf_≥ndög
)) {

643 i‡(
™
->
¶ìpög
)

644 
	`õì80211_°a_£t_buf„ªd
(
°a
, 
tid
->
tidno
, 
åue
);

646 
	`skb_queue_•li˚_èû
(&
bf_≥ndög
, &
tid
->
ªåy_q
);

647 i‡(!
™
->
¶ìpög
) {

648 
	`©h_tx_queue_tid
(
sc
, 
txq
, 
tid
);

650 i‡(
ts
->
ts_°©us
 & (
ATH9K_TXERR_FILT
 | 
ATH9K_TXERR_XRETRY
))

651 
tid
->
˛ór_ps_fûãr
 = 
åue
;

655 i‡(
b¨_ödex
 >= 0) {

656 
u16
 
b¨_£q
 = 
	`ATH_BA_INDEX2SEQ
(
£q_fú°
, 
b¨_ödex
);

658 i‡(
	`BAW_WITHIN
(
tid
->
£q_°¨t
,Åid->
baw_size
, 
b¨_£q
))

659 
tid
->
b¨_ödex
 = 
	`ATH_BA_INDEX
—id->
£q_°¨t
, 
b¨_£q
);

661 
	`©h_txq_u∆ock
(
sc
, 
txq
);

662 
	`©h_£nd_b¨
(
tid
, 
	`ATH_BA_INDEX2SEQ
(
£q_fú°
, 
b¨_ödex
 + 1));

663 
	`©h_txq_lock
(
sc
, 
txq
);

666 
	`rcu_ªad_u∆ock
();

668 i‡(
√edª£t
)

669 
	`©h9k_queue_ª£t
(
sc
, 
RESET_TYPE_TX_ERROR
);

670 
	}
}

672 
boﬁ
 
	$bf_is_ampdu_nŸ_¥obög
(
©h_buf
 *
bf
)

674 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

675  
	`bf_ißmpdu
(
bf
Ë&& !(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_RATE_CTRL_PROBE
);

676 
	}
}

678 
	$©h_tx_¥o˚ss_buf„r
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

679 
©h_tx_°©us
 *
ts
, 
©h_buf
 *
bf
,

680 
li°_hód
 *
bf_hód
)

682 
õì80211_tx_öfo
 *
öfo
;

683 
boﬁ
 
txok
, 
Êush
;

685 
txok
 = !(
ts
->
ts_°©us
 & 
ATH9K_TXERR_MASK
);

686 
Êush
 = !!(
ts
->
ts_°©us
 & 
ATH9K_TX_FLUSH
);

687 
txq
->
axq_tx_ö¥ogªss
 = 
Ál£
;

689 
txq
->
axq_dïth
--;

690 i‡(
	`bf_is_ampdu_nŸ_¥obög
(
bf
))

691 
txq
->
axq_ampdu_dïth
--;

693 
ts
->
duøti⁄
 = 
	`©h9k_hw_gë_duøti⁄
(
sc
->
sc_ah
, 
bf
->
bf_desc
,

694 
ts
->
ts_øãödex
);

695 i‡(!
	`bf_ißmpdu
(
bf
)) {

696 i‡(!
Êush
) {

697 
öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

698 
	`mem˝y
(
öfo
->
c⁄åﬁ
.
øãs
, 
bf
->rates,

699 (
öfo
->
c⁄åﬁ
.
øãs
));

700 
	`©h_tx_rc_°©us
(
sc
, 
bf
, 
ts
, 1, 
txok
 ? 0 : 1,Åxok);

701 
	`©h_dy«ck_ßm∂e_tx_ts
(
sc
->
sc_ah
, 
bf
->
bf_mpdu
, 
ts
);

703 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, 
bf_hód
, 
ts
, 
txok
);

705 
	`©h_tx_com∂ëe_aggr
(
sc
, 
txq
, 
bf
, 
bf_hód
, 
ts
, 
txok
);

707 i‡(!
Êush
)

708 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

709 
	}
}

711 
boﬁ
 
	$©h_lookup_Àgacy
(
©h_buf
 *
bf
)

713 
sk_buff
 *
skb
;

714 
õì80211_tx_öfo
 *
tx_öfo
;

715 
õì80211_tx_øã
 *
øãs
;

716 
i
;

718 
skb
 = 
bf
->
bf_mpdu
;

719 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

720 
øãs
 = 
tx_öfo
->
c⁄åﬁ
.rates;

722 
i
 = 0; i < 4; i++) {

723 i‡(!
øãs
[
i
].
cou¡
 ||Ñ©es[i].
idx
 < 0)

726 i‡(!(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_MCS
))

727  
åue
;

730  
Ál£
;

731 
	}
}

733 
u32
 
	$©h_lookup_øã
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

734 
©h_©x_tid
 *
tid
)

736 
sk_buff
 *
skb
;

737 
õì80211_tx_öfo
 *
tx_öfo
;

738 
õì80211_tx_øã
 *
øãs
;

739 
u32
 
max_4ms_‰amñí
, 
‰mÀn
;

740 
u16
 
aggr_limô
, 
bt_aggr_limô
, 
Àgacy
 = 0;

741 
q
 = 
tid
->
txq
->
mac80211_qnum
;

742 
i
;

744 
skb
 = 
bf
->
bf_mpdu
;

745 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

746 
øãs
 = 
bf
->rates;

752 
max_4ms_‰amñí
 = 
ATH_AMPDU_LIMIT_MAX
;

754 
i
 = 0; i < 4; i++) {

755 
modeidx
;

757 i‡(!
øãs
[
i
].
cou¡
)

760 i‡(!(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_MCS
)) {

761 
Àgacy
 = 1;

765 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

766 
modeidx
 = 
MCS_HT40
;

768 
modeidx
 = 
MCS_HT20
;

770 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
)

771 
modeidx
++;

773 
‰mÀn
 = 
sc
->
tx
.
max_aggr_‰amñí
[
q
][
modeidx
][
øãs
[
i
].
idx
];

774 
max_4ms_‰amñí
 = 
	`mö
(max_4ms_‰amñí, 
‰mÀn
);

782 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_RATE_CTRL_PROBE
 || 
Àgacy
)

785 
aggr_limô
 = 
	`mö
(
max_4ms_‰amñí
, (
u32
)
ATH_AMPDU_LIMIT_MAX
);

790 
bt_aggr_limô
 = 
	`©h9k_btc€x_aggr_limô
(
sc
, 
max_4ms_‰amñí
);

791 i‡(
bt_aggr_limô
)

792 
aggr_limô
 = 
bt_aggr_limô
;

794 i‡(
tid
->
™
->
maxampdu
)

795 
aggr_limô
 = 
	`mö
◊ggr_limô, 
tid
->
™
->
maxampdu
);

797  
aggr_limô
;

798 
	}
}

804 
	$©h_compuã_num_dñims
(
©h_so·c
 *
sc
, 
©h_©x_tid
 *
tid
,

805 
©h_buf
 *
bf
, 
u16
 
‰mÀn
,

806 
boﬁ
 
fú°_sub‰m
)

808 
	#FIRST_DESC_NDELIMS
 60

	)

809 
u32
 
nsymbôs
, 
nsymbﬁs
;

810 
u16
 
möÀn
;

811 
u8
 
Êags
, 
rix
;

812 
width
, 
°ªams
, 
hÆf_gi
, 
ndñim
, 
mödñim
;

813 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
bf
->
bf_mpdu
);

816 
ndñim
 = 
	`ATH_AGGR_GET_NDELIM
(
‰mÀn
);

824 i‡((
fi
->
keyix
 !
ATH9K_TXKEYIX_INVALID
) &&

825 !(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
))

826 
ndñim
 +
ATH_AGGR_ENCRYPTDELIM
;

832 i‡(
fú°_sub‰m
 && !
	`AR_SREV_9580_10_OR_LATER
(
sc
->
sc_ah
) &&

833 (
sc
->
sc_ah
->
ít_mode
 & 
AR_ENT_OTP_MIN_PKT_SIZE_DISABLE
))

834 
ndñim
 = 
	`max
“dñim, 
FIRST_DESC_NDELIMS
);

846 i‡(
tid
->
™
->
mpdudísôy
 == 0)

847  
ndñim
;

849 
rix
 = 
bf
->
øãs
[0].
idx
;

850 
Êags
 = 
bf
->
øãs
[0].flags;

851 
width
 = (
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
) ? 1 : 0;

852 
hÆf_gi
 = (
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
) ? 1 : 0;

854 i‡(
hÆf_gi
)

855 
nsymbﬁs
 = 
	`NUM_SYMBOLS_PER_USEC_HALFGI
(
tid
->
™
->
mpdudísôy
);

857 
nsymbﬁs
 = 
	`NUM_SYMBOLS_PER_USEC
(
tid
->
™
->
mpdudísôy
);

859 i‡(
nsymbﬁs
 == 0)

860 
nsymbﬁs
 = 1;

862 
°ªams
 = 
	`HT_RC_2_STREAMS
(
rix
);

863 
nsymbôs
 = 
bôs_≥r_symbﬁ
[
rix
 % 8][
width
] * 
°ªams
;

864 
möÀn
 = (
nsymbﬁs
 * 
nsymbôs
Ë/ 
BITS_PER_BYTE
;

866 i‡(
‰mÀn
 < 
möÀn
) {

867 
mödñim
 = (
möÀn
 - 
‰mÀn
Ë/ 
ATH_AGGR_DELIM_SZ
;

868 
ndñim
 = 
	`max
(
mödñim
,Çdelim);

871  
ndñim
;

872 
	}
}

874 
©h_buf
 *

875 
	$©h_tx_gë_tid_sub‰ame
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

876 
©h_©x_tid
 *
tid
, 
sk_buff_hód
 **
q
)

878 
õì80211_tx_öfo
 *
tx_öfo
;

879 
©h_‰ame_öfo
 *
fi
;

880 
sk_buff
 *
skb
;

881 
©h_buf
 *
bf
;

882 
u16
 
£qno
;

885 *
q
 = &
tid
->
ªåy_q
;

886 i‡(
	`skb_queue_em±y
(*
q
))

887 *
q
 = &
tid
->
buf_q
;

889 
skb
 = 
	`skb_≥ek
(*
q
);

890 i‡(!
skb
)

893 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

894 
bf
 = 
fi
->bf;

895 i‡(!
fi
->
bf
)

896 
bf
 = 
	`©h_tx_£tup_buf„r
(
sc
, 
txq
, 
tid
, 
skb
);

898 
bf
->
bf_°©e
.
°Æe
 = 
Ál£
;

900 i‡(!
bf
) {

901 
	`__skb_u∆ök
(
skb
, *
q
);

902 
	`©h_txq_skb_d⁄e
(
sc
, 
txq
, 
skb
);

903 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

907 
bf
->
bf_√xt
 = 
NULL
;

908 
bf
->
bf_œ°bf
 = bf;

910 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

911 
tx_öfo
->
Êags
 &~
IEEE80211_TX_CTL_CLEAR_PS_FILT
;

918 i‡(!
tid
->
a˘ive
)

919 
tx_öfo
->
Êags
 &~
IEEE80211_TX_CTL_AMPDU
;

921 i‡(!(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)) {

922 
bf
->
bf_°©e
.
bf_ty≥
 = 0;

923  
bf
;

926 
bf
->
bf_°©e
.
bf_ty≥
 = 
BUF_AMPDU
 | 
BUF_AGGR
;

927 
£qno
 = 
bf
->
bf_°©e
.seqno;

930 i‡(!
	`BAW_WITHIN
(
tid
->
£q_°¨t
,Åid->
baw_size
, 
£qno
))

933 i‡(
tid
->
b¨_ödex
 > 
	`ATH_BA_INDEX
—id->
£q_°¨t
, 
£qno
)) {

934 
©h_tx_°©us
 
ts
 = {};

935 
li°_hód
 
bf_hód
;

937 
	`INIT_LIST_HEAD
(&
bf_hód
);

938 
	`li°_add
(&
bf
->
li°
, &
bf_hód
);

939 
	`__skb_u∆ök
(
skb
, *
q
);

940 
	`©h_tx_upd©e_baw
(
sc
, 
tid
, 
£qno
);

941 
	`©h_tx_com∂ëe_buf
(
sc
, 
bf
, 
txq
, &
bf_hód
, &
ts
, 0);

945  
bf
;

948  
NULL
;

949 
	}
}

951 
boﬁ


952 
	$©h_tx_f‹m_aggr
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

953 
©h_©x_tid
 *
tid
, 
li°_hód
 *
bf_q
,

954 
©h_buf
 *
bf_fú°
, 
sk_buff_hód
 *
tid_q
,

955 *
aggr_Àn
)

957 
	#PADBYTES
(
_Àn
Ë((4 - ((_ÀnË% 4)Ë% 4)

	)

958 
©h_buf
 *
bf
 = 
bf_fú°
, *
bf_¥ev
 = 
NULL
;

959 
n‰ames
 = 0, 
ndñim
;

960 
u16
 
aggr_limô
 = 0, 
Æ
 = 0, 
b∑d
 = 0,

961 
Æ_dñè
, 
h_baw
 = 
tid
->
baw_size
 / 2;

962 
õì80211_tx_öfo
 *
tx_öfo
;

963 
©h_‰ame_öfo
 *
fi
;

964 
sk_buff
 *
skb
;

965 
boﬁ
 
˛o£d
 = 
Ál£
;

967 
bf
 = 
bf_fú°
;

968 
aggr_limô
 = 
	`©h_lookup_øã
(
sc
, 
bf
, 
tid
);

971 
skb
 = 
bf
->
bf_mpdu
;

972 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

975 
Æ_dñè
 = 
ATH_AGGR_DELIM_SZ
 + 
fi
->
‰amñí
;

976 i‡(
n‰ames
) {

977 i‡(
aggr_limô
 < 
Æ
 + 
b∑d
 + 
Æ_dñè
 ||

978 
	`©h_lookup_Àgacy
(
bf
Ë|| 
n‰ames
 >
h_baw
)

981 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

982 i‡((
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_RATE_CTRL_PROBE
) ||

983 !(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
))

988 
Æ
 +
b∑d
 + 
Æ_dñè
;

994 
ndñim
 = 
	`©h_compuã_num_dñims
(
sc
, 
tid
, 
bf_fú°
, 
fi
->
‰amñí
,

995 !
n‰ames
);

996 
b∑d
 = 
	`PADBYTES
(
Æ_dñè
Ë+ (
ndñim
 << 2);

998 
n‰ames
++;

999 
bf
->
bf_√xt
 = 
NULL
;

1002 i‡(!
fi
->
baw_åacked
)

1003 
	`©h_tx_addto_baw
(
sc
, 
tid
, 
bf
);

1004 
bf
->
bf_°©e
.
ndñim
 =Çdelim;

1006 
	`__skb_u∆ök
(
skb
, 
tid_q
);

1007 
	`li°_add_èû
(&
bf
->
li°
, 
bf_q
);

1008 i‡(
bf_¥ev
)

1009 
bf_¥ev
->
bf_√xt
 = 
bf
;

1011 
bf_¥ev
 = 
bf
;

1013 
bf
 = 
	`©h_tx_gë_tid_sub‰ame
(
sc
, 
txq
, 
tid
, &
tid_q
);

1014 i‡(!
bf
) {

1015 
˛o£d
 = 
åue
;

1018 } 
	`©h_tid_has_buf„ªd
(
tid
));

1020 
bf
 = 
bf_fú°
;

1021 
bf
->
bf_œ°bf
 = 
bf_¥ev
;

1023 i‡(
bf
 =
bf_¥ev
) {

1024 
Æ
 = 
	`gë_‰ame_öfo
(
bf
->
bf_mpdu
)->
‰amñí
;

1025 
bf
->
bf_°©e
.
bf_ty≥
 = 
BUF_AMPDU
;

1027 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
a_aggr
);

1030 *
aggr_Àn
 = 
Æ
;

1032  
˛o£d
;

1033 #unde‡
PADBYTES


1034 
	}
}

1042 
u32
 
	$©h_pkt_duøti⁄
(
©h_so·c
 *
sc
, 
u8
 
rix
, 
pkéí
,

1043 
width
, 
hÆf_gi
, 
boﬁ
 
sh‹tPªambÀ
)

1045 
u32
 
nbôs
, 
nsymbôs
, 
duøti⁄
, 
nsymbﬁs
;

1046 
°ªams
;

1049 
°ªams
 = 
	`HT_RC_2_STREAMS
(
rix
);

1050 
nbôs
 = (
pkéí
 << 3Ë+ 
OFDM_PLCP_BITS
;

1051 
nsymbôs
 = 
bôs_≥r_symbﬁ
[
rix
 % 8][
width
] * 
°ªams
;

1052 
nsymbﬁs
 = (
nbôs
 + 
nsymbôs
 - 1) /Çsymbits;

1054 i‡(!
hÆf_gi
)

1055 
duøti⁄
 = 
	`SYMBOL_TIME
(
nsymbﬁs
);

1057 
duøti⁄
 = 
	`SYMBOL_TIME_HALFGI
(
nsymbﬁs
);

1060 
duøti⁄
 +
L_STF
 + 
L_LTF
 + 
L_SIG
 + 
HT_SIG
 + 
HT_STF
 + 
	`HT_LTF
(
°ªams
);

1062  
duøti⁄
;

1063 
	}
}

1065 
	$©h_max_‰amñí
(
u£c
, 
mcs
, 
boﬁ
 
ht40
, boﬁ 
sgi
)

1067 
°ªams
 = 
	`HT_RC_2_STREAMS
(
mcs
);

1068 
symbﬁs
, 
bôs
;

1069 
byãs
 = 0;

1071 
u£c
 -
L_STF
 + 
L_LTF
 + 
L_SIG
 + 
HT_SIG
 + 
HT_STF
 + 
	`HT_LTF
(
°ªams
);

1072 
symbﬁs
 = 
sgi
 ? 
	`TIME_SYMBOLS_HALFGI
(
u£c
Ë: 
	`TIME_SYMBOLS
(usec);

1073 
bôs
 = 
symbﬁs
 * 
bôs_≥r_symbﬁ
[
mcs
 % 8][
ht40
] * 
°ªams
;

1074 
bôs
 -
OFDM_PLCP_BITS
;

1075 
byãs
 = 
bôs
 / 8;

1076 i‡(
byãs
 > 65532)

1077 
byãs
 = 65532;

1079  
byãs
;

1080 
	}
}

1082 
	$©h_upd©e_max_aggr_‰amñí
(
©h_so·c
 *
sc
, 
queue
, 
tx›
)

1084 
u16
 *
cur_ht20
, *
cur_ht20_sgi
, *
cur_ht40
, *
cur_ht40_sgi
;

1085 
mcs
;

1088 i‡(!
tx›
 ||Åxop > 4096)

1089 
tx›
 = 4096;

1091 
cur_ht20
 = 
sc
->
tx
.
max_aggr_‰amñí
[
queue
][
MCS_HT20
];

1092 
cur_ht20_sgi
 = 
sc
->
tx
.
max_aggr_‰amñí
[
queue
][
MCS_HT20_SGI
];

1093 
cur_ht40
 = 
sc
->
tx
.
max_aggr_‰amñí
[
queue
][
MCS_HT40
];

1094 
cur_ht40_sgi
 = 
sc
->
tx
.
max_aggr_‰amñí
[
queue
][
MCS_HT40_SGI
];

1095 
mcs
 = 0; mcs < 32; mcs++) {

1096 
cur_ht20
[
mcs
] = 
	`©h_max_‰amñí
(
tx›
, mcs, 
Ál£
, false);

1097 
cur_ht20_sgi
[
mcs
] = 
	`©h_max_‰amñí
(
tx›
, mcs, 
Ál£
, 
åue
);

1098 
cur_ht40
[
mcs
] = 
	`©h_max_‰amñí
(
tx›
, mcs, 
åue
, 
Ál£
);

1099 
cur_ht40_sgi
[
mcs
] = 
	`©h_max_‰amñí
(
tx›
, mcs, 
åue
,Årue);

1101 
	}
}

1103 
u8
 
	$©h_gë_øã_txpowî
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

1104 
u8
 
øãidx
, 
boﬁ
 
is_40
, boﬁ 
is_cck
)

1106 
u8
 
max_powî
;

1107 
sk_buff
 *
skb
;

1108 
©h_‰ame_öfo
 *
fi
;

1109 
õì80211_tx_öfo
 *
öfo
;

1110 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1112 i‡(
sc
->
tx99_°©e
 || !
ah
->
çc_íabÀd
)

1113  
MAX_RATE_POWER
;

1115 
skb
 = 
bf
->
bf_mpdu
;

1116 
fi
 = 
	`gë_‰ame_öfo
(
skb
);

1117 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1119 i‡(!
	`AR_SREV_9300_20_OR_LATER
(
ah
)) {

1120 
txpowî
 = 
fi
->
tx_powî
;

1122 i‡(
is_40
) {

1123 
u8
 
powî_ht40dñè
;

1124 
¨5416_ì¥om_def
 *
ìp
 = &
ah
->
ì¥om
.
def
;

1126 i‡(
AR5416_VER_MASK
 >
AR5416_EEP_MINOR_VER_2
) {

1127 
boﬁ
 
is_2ghz
;

1128 
modÆ_ìp_hódî
 *
pmodÆ
;

1130 
is_2ghz
 = 
öfo
->
b™d
 =
IEEE80211_BAND_2GHZ
;

1131 
pmodÆ
 = &
ìp
->
modÆHódî
[
is_2ghz
];

1132 
powî_ht40dñè
 = 
pmodÆ
->
ht40PowîIncF‹Pdadc
;

1134 
powî_ht40dñè
 = 2;

1136 
txpowî
 +
powî_ht40dñè
;

1139 i‡(
	`AR_SREV_9287
(
ah
Ë|| 
	`AR_SREV_9285
(ah) ||

1140 
	`AR_SREV_9271
(
ah
)) {

1141 
txpowî
 -2 * 
AR9287_PWR_TABLE_OFFSET_DB
;

1142 } i‡(
	`AR_SREV_9280_20_OR_LATER
(
ah
)) {

1143 
s8
 
powî_off£t
;

1145 
powî_off£t
 = 
ah
->
ìp_›s
->
	`gë_ì¥om
(ah,

1146 
EEP_PWR_TABLE_OFFSET
);

1147 
txpowî
 -2 * 
powî_off£t
;

1150 i‡(
OLC_FOR_AR9280_20_LATER
 && 
is_cck
)

1151 
txpowî
 -= 2;

1153 
txpowî
 = 
	`max
(txpower, 0);

1154 
max_powî
 = 
	`mö_t
(
u8
, 
ah
->
tx_powî
[
øãidx
], 
txpowî
);

1160 i‡(!
max_powî
 && !
	`AR_SREV_9280_20_OR_LATER
(
ah
))

1161 
max_powî
 = 1;

1162 } i‡(!
bf
->
bf_°©e
.
bfs_∑¥d
) {

1163 i‡(
øãidx
 < 8 && (
öfo
->
Êags
 & 
IEEE80211_TX_CTL_STBC
))

1164 
max_powî
 = 
	`mö_t
(
u8
, 
ah
->
tx_powî_°bc
[
øãidx
],

1165 
fi
->
tx_powî
);

1167 
max_powî
 = 
	`mö_t
(
u8
, 
ah
->
tx_powî
[
øãidx
],

1168 
fi
->
tx_powî
);

1170 
max_powî
 = 
ah
->
∑¥d_åaöög_powî
;

1173  
max_powî
;

1174 
	}
}

1176 
	$©h_buf_£t_øã
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

1177 
©h_tx_öfo
 *
öfo
, 
Àn
, 
boﬁ
 
πs
)

1179 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1180 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

1181 
sk_buff
 *
skb
;

1182 
õì80211_tx_öfo
 *
tx_öfo
;

1183 
õì80211_tx_øã
 *
øãs
;

1184 c⁄° 
õì80211_øã
 *
øã
;

1185 
õì80211_hdr
 *
hdr
;

1186 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
bf
->
bf_mpdu
);

1187 
u32
 
πs_thªsh
 = 
sc
->
hw
->
wùhy
->
πs_thªshﬁd
;

1188 
i
;

1189 
u8
 
rix
 = 0;

1191 
skb
 = 
bf
->
bf_mpdu
;

1192 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1193 
øãs
 = 
bf
->rates;

1194 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1197 
öfo
->
dur_upd©e
 = !
	`õì80211_is_p•ﬁl
(
hdr
->
‰ame_c⁄åﬁ
);

1198 
öfo
->
πs˘s_øã
 = 
fi
->rtscts_rate;

1200 
i
 = 0; i < 
	`ARRAY_SIZE
(
bf
->
øãs
); i++) {

1201 
boﬁ
 
is_40
, 
is_sgi
, 
is_•
, 
is_cck
;

1202 
phy
;

1204 i‡(!
øãs
[
i
].
cou¡
 || (øãs[i].
idx
 < 0))

1207 
rix
 = 
øãs
[
i
].
idx
;

1208 
öfo
->
øãs
[
i
].
Trõs
 =Ñ©es[i].
cou¡
;

1213 i‡(
	`bf_ißmpdu
(
bf
Ë&& !
	`bf_ißggr
(bf) &&

1214 (
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_MCS
) &&

1215 
	`u∆ikñy
(
πs_thªsh
 !(
u32
) -1)) {

1216 i‡(!
πs_thªsh
 || (
Àn
 >Ñts_thresh))

1217 
πs
 = 
åue
;

1220 i‡(
πs
 || 
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_USE_RTS_CTS
) {

1221 
öfo
->
øãs
[
i
].
R©eFœgs
 |
ATH9K_RATESERIES_RTS_CTS
;

1222 
öfo
->
Êags
 |
ATH9K_TXDESC_RTSENA
;

1223 } i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_USE_CTS_PROTECT
) {

1224 
öfo
->
øãs
[
i
].
R©eFœgs
 |
ATH9K_RATESERIES_RTS_CTS
;

1225 
öfo
->
Êags
 |
ATH9K_TXDESC_CTSENA
;

1228 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

1229 
öfo
->
øãs
[
i
].
R©eFœgs
 |
ATH9K_RATESERIES_2040
;

1230 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
)

1231 
öfo
->
øãs
[
i
].
R©eFœgs
 |
ATH9K_RATESERIES_HALFGI
;

1233 
is_sgi
 = !!(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
);

1234 
is_40
 = !!(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
);

1235 
is_•
 = !!(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
);

1237 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_MCS
) {

1239 
öfo
->
øãs
[
i
].
R©e
 = 
rix
 | 0x80;

1240 
öfo
->
øãs
[
i
].
ChSñ
 = 
	`©h_txchaömask_ªdu˘i⁄
(
sc
,

1241 
ah
->
txchaömask
, 
öfo
->
øãs
[
i
].
R©e
);

1242 
öfo
->
øãs
[
i
].
PktDuøti⁄
 = 
	`©h_pkt_duøti⁄
(
sc
, 
rix
, 
Àn
,

1243 
is_40
, 
is_sgi
, 
is_•
);

1244 i‡(
rix
 < 8 && (
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_STBC
))

1245 
öfo
->
øãs
[
i
].
R©eFœgs
 |
ATH9K_RATESERIES_STBC
;

1247 
öfo
->
txpowî
[
i
] = 
	`©h_gë_øã_txpowî
(
sc
, 
bf
, 
rix
,

1248 
is_40
, 
Ál£
);

1253 
øã
 = &
comm⁄
->
sb™ds
[
tx_öfo
->
b™d
].
bôøãs
[
øãs
[
i
].
idx
];

1254 i‡((
tx_öfo
->
b™d
 =
IEEE80211_BAND_2GHZ
) &&

1255 !(
øã
->
Êags
 & 
IEEE80211_RATE_ERP_G
))

1256 
phy
 = 
WLAN_RC_PHY_CCK
;

1258 
phy
 = 
WLAN_RC_PHY_OFDM
;

1260 
öfo
->
øãs
[
i
].
R©e
 = 
øã
->
hw_vÆue
;

1261 i‡(
øã
->
hw_vÆue_sh‹t
) {

1262 i‡(
øãs
[
i
].
Êags
 & 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
)

1263 
öfo
->
øãs
[
i
].
R©e
 |
øã
->
hw_vÆue_sh‹t
;

1265 
is_•
 = 
Ál£
;

1268 i‡(
bf
->
bf_°©e
.
bfs_∑¥d
)

1269 
öfo
->
øãs
[
i
].
ChSñ
 = 
ah
->
txchaömask
;

1271 
öfo
->
øãs
[
i
].
ChSñ
 = 
	`©h_txchaömask_ªdu˘i⁄
(
sc
,

1272 
ah
->
txchaömask
, 
öfo
->
øãs
[
i
].
R©e
);

1274 
öfo
->
øãs
[
i
].
PktDuøti⁄
 = 
	`©h9k_hw_compuãtxtime
(
sc
->
sc_ah
,

1275 
phy
, 
øã
->
bôøã
 * 100, 
Àn
, 
rix
, 
is_•
);

1277 
is_cck
 = 
	`IS_CCK_RATE
(
öfo
->
øãs
[
i
].
R©e
);

1278 
öfo
->
txpowî
[
i
] = 
	`©h_gë_øã_txpowî
(
sc
, 
bf
, 
rix
, 
Ál£
,

1279 
is_cck
);

1283 i‡(
	`bf_ißggr
(
bf
Ë&& (
Àn
 > 
sc
->
sc_ah
->
ˇps
.
πs_aggr_limô
))

1284 
öfo
->
Êags
 &~
ATH9K_TXDESC_RTSENA
;

1287 i‡(
öfo
->
Êags
 & 
ATH9K_TXDESC_RTSENA
)

1288 
öfo
->
Êags
 &~
ATH9K_TXDESC_CTSENA
;

1289 
	}
}

1291 
©h9k_pkt_ty≥
 
	$gë_hw_∑ckë_ty≥
(
sk_buff
 *
skb
)

1293 
õì80211_hdr
 *
hdr
;

1294 
©h9k_pkt_ty≥
 
hty≥
;

1295 
__À16
 
fc
;

1297 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1298 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

1300 i‡(
	`õì80211_is_bóc⁄
(
fc
))

1301 
hty≥
 = 
ATH9K_PKT_TYPE_BEACON
;

1302 i‡(
	`õì80211_is_¥obe_ª•
(
fc
))

1303 
hty≥
 = 
ATH9K_PKT_TYPE_PROBE_RESP
;

1304 i‡(
	`õì80211_is_©im
(
fc
))

1305 
hty≥
 = 
ATH9K_PKT_TYPE_ATIM
;

1306 i‡(
	`õì80211_is_p•ﬁl
(
fc
))

1307 
hty≥
 = 
ATH9K_PKT_TYPE_PSPOLL
;

1309 
hty≥
 = 
ATH9K_PKT_TYPE_NORMAL
;

1311  
hty≥
;

1312 
	}
}

1314 
	$©h_tx_fûl_desc
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

1315 
©h_txq
 *
txq
, 
Àn
)

1317 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1318 
©h_buf
 *
bf_fú°
 = 
NULL
;

1319 
©h_tx_öfo
 
öfo
;

1320 
u32
 
πs_thªsh
 = 
sc
->
hw
->
wùhy
->
πs_thªshﬁd
;

1321 
boﬁ
 
πs
 = 
Ál£
;

1323 
	`mem£t
(&
öfo
, 0, (info));

1324 
öfo
.
is_fú°
 = 
åue
;

1325 
öfo
.
is_œ°
 = 
åue
;

1326 
öfo
.
qcu
 = 
txq
->
axq_qnum
;

1328 
bf
) {

1329 
sk_buff
 *
skb
 = 
bf
->
bf_mpdu
;

1330 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1331 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

1332 
boﬁ
 
aggr
 = !!(
bf
->
bf_°©e
.
bf_ty≥
 & 
BUF_AGGR
);

1334 
öfo
.
ty≥
 = 
	`gë_hw_∑ckë_ty≥
(
skb
);

1335 i‡(
bf
->
bf_√xt
)

1336 
öfo
.
lök
 = 
bf
->
bf_√xt
->
bf_daddr
;

1338 
öfo
.
lök
 = (
sc
->
tx99_°©e
Ë? 
bf
->
bf_daddr
 : 0;

1340 i‡(!
bf_fú°
) {

1341 
bf_fú°
 = 
bf
;

1343 i‡(!
sc
->
tx99_°©e
)

1344 
öfo
.
Êags
 = 
ATH9K_TXDESC_INTREQ
;

1345 i‡((
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_CLEAR_PS_FILT
) ||

1346 
txq
 =
sc
->
tx
.
u≠sdq
)

1347 
öfo
.
Êags
 |
ATH9K_TXDESC_CLRDMASK
;

1349 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
)

1350 
öfo
.
Êags
 |
ATH9K_TXDESC_NOACK
;

1351 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_LDPC
)

1352 
öfo
.
Êags
 |
ATH9K_TXDESC_LDPC
;

1354 i‡(
bf
->
bf_°©e
.
bfs_∑¥d
)

1355 
öfo
.
Êags
 |(
u32
Ë
bf
->
bf_°©e
.
bfs_∑¥d
 <<

1356 
ATH9K_TXDESC_PAPRD_S
;

1365 i‡(
aggr
 && (
bf
 =
bf_fú°
) &&

1366 
	`u∆ikñy
(
πs_thªsh
 !(
u32
) -1)) {

1370 i‡(!
πs_thªsh
 || (
Àn
 >Ñts_thresh))

1371 
πs
 = 
åue
;

1374 i‡(!
aggr
)

1375 
Àn
 = 
fi
->
‰amñí
;

1377 
	`©h_buf_£t_øã
(
sc
, 
bf
, &
öfo
, 
Àn
, 
πs
);

1380 
öfo
.
buf_addr
[0] = 
bf
->
bf_buf_addr
;

1381 
öfo
.
buf_Àn
[0] = 
skb
->
Àn
;

1382 
öfo
.
pkt_Àn
 = 
fi
->
‰amñí
;

1383 
öfo
.
keyix
 = 
fi
->keyix;

1384 
öfo
.
keyty≥
 = 
fi
->keytype;

1386 i‡(
aggr
) {

1387 i‡(
bf
 =
bf_fú°
)

1388 
öfo
.
aggr
 = 
AGGR_BUF_FIRST
;

1389 i‡(
bf
 =
bf_fú°
->
bf_œ°bf
)

1390 
öfo
.
aggr
 = 
AGGR_BUF_LAST
;

1392 
öfo
.
aggr
 = 
AGGR_BUF_MIDDLE
;

1394 
öfo
.
ndñim
 = 
bf
->
bf_°©e
.ndelim;

1395 
öfo
.
aggr_Àn
 = 
Àn
;

1398 i‡(
bf
 =
bf_fú°
->
bf_œ°bf
)

1399 
bf_fú°
 = 
NULL
;

1401 
	`©h9k_hw_£t_txdesc
(
ah
, 
bf
->
bf_desc
, &
öfo
);

1402 
bf
 = bf->
bf_√xt
;

1404 
	}
}

1407 
	$©h_tx_f‹m_bur°
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

1408 
©h_©x_tid
 *
tid
, 
li°_hód
 *
bf_q
,

1409 
©h_buf
 *
bf_fú°
, 
sk_buff_hód
 *
tid_q
)

1411 
©h_buf
 *
bf
 = 
bf_fú°
, *
bf_¥ev
 = 
NULL
;

1412 
sk_buff
 *
skb
;

1413 
n‰ames
 = 0;

1416 
õì80211_tx_öfo
 *
tx_öfo
;

1417 
skb
 = 
bf
->
bf_mpdu
;

1419 
n‰ames
++;

1420 
	`__skb_u∆ök
(
skb
, 
tid_q
);

1421 
	`li°_add_èû
(&
bf
->
li°
, 
bf_q
);

1422 i‡(
bf_¥ev
)

1423 
bf_¥ev
->
bf_√xt
 = 
bf
;

1424 
bf_¥ev
 = 
bf
;

1426 i‡(
n‰ames
 >= 2)

1429 
bf
 = 
	`©h_tx_gë_tid_sub‰ame
(
sc
, 
txq
, 
tid
, &
tid_q
);

1430 i‡(!
bf
)

1433 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

1434 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)

1437 
	`©h_£t_øãs
(
tid
->
™
->
vif
,Åid->™->
°a
, 
bf
, 
Ál£
);

1439 
	}
}

1441 
boﬁ
 
	$©h_tx_sched_aggr
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

1442 
©h_©x_tid
 *
tid
, 
boﬁ
 *
°›
)

1444 
©h_buf
 *
bf
;

1445 
õì80211_tx_öfo
 *
tx_öfo
;

1446 
sk_buff_hód
 *
tid_q
;

1447 
li°_hód
 
bf_q
;

1448 
aggr_Àn
 = 0;

1449 
boﬁ
 
aggr
, 
œ°
 = 
åue
;

1451 i‡(!
	`©h_tid_has_buf„ªd
(
tid
))

1452  
Ál£
;

1454 
	`INIT_LIST_HEAD
(&
bf_q
);

1456 
bf
 = 
	`©h_tx_gë_tid_sub‰ame
(
sc
, 
txq
, 
tid
, &
tid_q
);

1457 i‡(!
bf
)

1458  
Ál£
;

1460 
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
bf
->
bf_mpdu
);

1461 
aggr
 = !!(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
);

1462 i‡((
aggr
 && 
txq
->
axq_ampdu_dïth
 >
ATH_AGGR_MIN_QDEPTH
) ||

1463 (!
aggr
 && 
txq
->
axq_dïth
 >
ATH_NON_AGGR_MIN_QDEPTH
)) {

1464 *
°›
 = 
åue
;

1465  
Ál£
;

1468 
	`©h_£t_øãs
(
tid
->
™
->
vif
,Åid->™->
°a
, 
bf
, 
Ál£
);

1469 i‡(
aggr
)

1470 
œ°
 = 
	`©h_tx_f‹m_aggr
(
sc
, 
txq
, 
tid
, &
bf_q
, 
bf
,

1471 
tid_q
, &
aggr_Àn
);

1473 
	`©h_tx_f‹m_bur°
(
sc
, 
txq
, 
tid
, &
bf_q
, 
bf
, 
tid_q
);

1475 i‡(
	`li°_em±y
(&
bf_q
))

1476  
Ál£
;

1478 i‡(
tid
->
˛ór_ps_fûãr
 ||Åid->
™
->
no_ps_fûãr
) {

1479 
tid
->
˛ór_ps_fûãr
 = 
Ál£
;

1480 
tx_öfo
->
Êags
 |
IEEE80211_TX_CTL_CLEAR_PS_FILT
;

1483 
	`©h_tx_fûl_desc
(
sc
, 
bf
, 
txq
, 
aggr_Àn
);

1484 
	`©h_tx_txqaddbuf
(
sc
, 
txq
, &
bf_q
, 
Ál£
);

1485  
åue
;

1486 
	}
}

1488 
	$©h_tx_aggr_°¨t
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
,

1489 
u16
 
tid
, u16 *
s¢
)

1491 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1492 
©h_©x_tid
 *
txtid
;

1493 
©h_txq
 *
txq
;

1494 
©h_node
 *
™
;

1495 
u8
 
dísôy
;

1497 
	`©h_dbg
(
comm⁄
, 
XMIT
, "%†ˇŒed\n", 
__func__
);

1499 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

1500 
txtid
 = 
	`ATH_AN_2_TID
(
™
, 
tid
);

1501 
txq
 = 
txtid
->txq;

1503 
	`©h_txq_lock
(
sc
, 
txq
);

1509 i‡(
°a
->
ht_ˇp
.
ht_suµ‹ãd
) {

1510 
™
->
maxampdu
 = (1 << (
IEEE80211_HT_MAX_AMPDU_FACTOR
 +

1511 
°a
->
ht_ˇp
.
ampdu_Á˘‹
)) - 1;

1512 
dísôy
 = 
	`©h9k_∑r£_mpdudísôy
(
°a
->
ht_ˇp
.
ampdu_dísôy
);

1513 
™
->
mpdudísôy
 = 
dísôy
;

1517 
	`©h_tx_tid_ch™ge_°©e
(
sc
, 
txtid
);

1519 
txtid
->
a˘ive
 = 
åue
;

1520 *
s¢
 = 
txtid
->
£q_°¨t
 =Åxtid->
£q_√xt
;

1521 
txtid
->
b¨_ödex
 = -1;

1523 
	`mem£t
(
txtid
->
tx_buf
, 0, (txtid->tx_buf));

1524 
txtid
->
baw_hód
 =Åxtid->
baw_èû
 = 0;

1526 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

1529 
	}
}

1531 
	$©h_tx_aggr_°›
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
, 
u16
 
tid
)

1533 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1534 
©h_node
 *
™
 = (©h_nodê*)
°a
->
drv_¥iv
;

1535 
©h_©x_tid
 *
txtid
 = 
	`ATH_AN_2_TID
(
™
, 
tid
);

1536 
©h_txq
 *
txq
 = 
txtid
->txq;

1538 
	`©h_dbg
(
comm⁄
, 
XMIT
, "%†ˇŒed\n", 
__func__
);

1540 
	`©h_txq_lock
(
sc
, 
txq
);

1541 
txtid
->
a˘ive
 = 
Ál£
;

1542 
	`©h_tx_Êush_tid
(
sc
, 
txtid
);

1543 
	`©h_tx_tid_ch™ge_°©e
(
sc
, 
txtid
);

1544 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

1545 
	}
}

1547 
	$©h_tx_aggr_¶ìp
(
õì80211_°a
 *
°a
, 
©h_so·c
 *
sc
,

1548 
©h_node
 *
™
)

1550 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1551 
©h_©x_tid
 *
tid
;

1552 
©h_txq
 *
txq
;

1553 
boﬁ
 
buf„ªd
;

1554 
tidno
;

1556 
	`©h_dbg
(
comm⁄
, 
XMIT
, "%†ˇŒed\n", 
__func__
);

1558 
tidno
 = 0, 
tid
 = &
™
->tid[tidno];

1559 
tidno
 < 
IEEE80211_NUM_TIDS
;Åidno++, 
tid
++) {

1561 
txq
 = 
tid
->txq;

1563 
	`©h_txq_lock
(
sc
, 
txq
);

1565 i‡(
	`li°_em±y
(&
tid
->
li°
)) {

1566 
	`©h_txq_u∆ock
(
sc
, 
txq
);

1570 
buf„ªd
 = 
	`©h_tid_has_buf„ªd
(
tid
);

1572 
	`li°_dñ_öô
(&
tid
->
li°
);

1574 
	`©h_txq_u∆ock
(
sc
, 
txq
);

1576 
	`õì80211_°a_£t_buf„ªd
(
°a
, 
tidno
, 
buf„ªd
);

1578 
	}
}

1580 
	$©h_tx_aggr_wakeup
(
©h_so·c
 *
sc
, 
©h_node
 *
™
)

1582 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1583 
©h_©x_tid
 *
tid
;

1584 
©h_txq
 *
txq
;

1585 
tidno
;

1587 
	`©h_dbg
(
comm⁄
, 
XMIT
, "%†ˇŒed\n", 
__func__
);

1589 
tidno
 = 0, 
tid
 = &
™
->tid[tidno];

1590 
tidno
 < 
IEEE80211_NUM_TIDS
;Åidno++, 
tid
++) {

1592 
txq
 = 
tid
->txq;

1594 
	`©h_txq_lock
(
sc
, 
txq
);

1595 
tid
->
˛ór_ps_fûãr
 = 
åue
;

1597 i‡(
	`©h_tid_has_buf„ªd
(
tid
)) {

1598 
	`©h_tx_queue_tid
(
sc
, 
txq
, 
tid
);

1599 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

1602 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

1604 
	}
}

1606 
	$©h_tx_aggr_ªsume
(
©h_so·c
 *
sc
, 
õì80211_°a
 *
°a
,

1607 
u16
 
tidno
)

1609 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1610 
©h_©x_tid
 *
tid
;

1611 
©h_node
 *
™
;

1612 
©h_txq
 *
txq
;

1614 
	`©h_dbg
(
comm⁄
, 
XMIT
, "%†ˇŒed\n", 
__func__
);

1616 
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

1617 
tid
 = 
	`ATH_AN_2_TID
(
™
, 
tidno
);

1618 
txq
 = 
tid
->txq;

1620 
	`©h_txq_lock
(
sc
, 
txq
);

1622 
tid
->
baw_size
 = 
IEEE80211_MIN_AMPDU_BUF
 << 
°a
->
ht_ˇp
.
ampdu_Á˘‹
;

1624 i‡(
	`©h_tid_has_buf„ªd
(
tid
)) {

1625 
	`©h_tx_queue_tid
(
sc
, 
txq
, 
tid
);

1626 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

1629 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

1630 
	}
}

1632 
	$©h9k_ªÀa£_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

1633 
õì80211_°a
 *
°a
,

1634 
u16
 
tids
, 
n‰ames
,

1635 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

1636 
boﬁ
 
m‹e_d©a
)

1638 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

1639 
©h_node
 *
™
 = (©h_nodê*)
°a
->
drv_¥iv
;

1640 
©h_txq
 *
txq
 = 
sc
->
tx
.
u≠sdq
;

1641 
õì80211_tx_öfo
 *
öfo
;

1642 
li°_hód
 
bf_q
;

1643 
©h_buf
 *
bf_èû
 = 
NULL
, *
bf
;

1644 
sk_buff_hód
 *
tid_q
;

1645 
£¡
 = 0;

1646 
i
;

1648 
	`INIT_LIST_HEAD
(&
bf_q
);

1649 
i
 = 0; 
tids
 && 
n‰ames
; i++,Åids >>= 1) {

1650 
©h_©x_tid
 *
tid
;

1652 i‡(!(
tids
 & 1))

1655 
tid
 = 
	`ATH_AN_2_TID
(
™
, 
i
);

1657 
	`©h_txq_lock
(
sc
, 
tid
->
txq
);

1658 
n‰ames
 > 0) {

1659 
bf
 = 
	`©h_tx_gë_tid_sub‰ame
(
sc
, sc->
tx
.
u≠sdq
, 
tid
, &
tid_q
);

1660 i‡(!
bf
)

1663 
	`__skb_u∆ök
(
bf
->
bf_mpdu
, 
tid_q
);

1664 
	`li°_add_èû
(&
bf
->
li°
, &
bf_q
);

1665 
	`©h_£t_øãs
(
tid
->
™
->
vif
,Åid->™->
°a
, 
bf
, 
åue
);

1666 i‡(
	`bf_ißmpdu
(
bf
)) {

1667 
	`©h_tx_addto_baw
(
sc
, 
tid
, 
bf
);

1668 
bf
->
bf_°©e
.
bf_ty≥
 &~
BUF_AGGR
;

1670 i‡(
bf_èû
)

1671 
bf_èû
->
bf_√xt
 = 
bf
;

1673 
bf_èû
 = 
bf
;

1674 
n‰ames
--;

1675 
£¡
++;

1676 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
a_queued_hw
);

1678 i‡(
™
->
°a
 && !
	`©h_tid_has_buf„ªd
(
tid
))

1679 
	`õì80211_°a_£t_buf„ªd
(
™
->
°a
, 
i
, 
Ál£
);

1681 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
tid
->
txq
);

1684 i‡(
	`li°_em±y
(&
bf_q
))

1687 
öfo
 = 
	`IEEE80211_SKB_CB
(
bf_èû
->
bf_mpdu
);

1688 
öfo
->
Êags
 |
IEEE80211_TX_STATUS_EOSP
;

1690 
bf
 = 
	`li°_fú°_íåy
(&
bf_q
, 
©h_buf
, 
li°
);

1691 
	`©h_txq_lock
(
sc
, 
txq
);

1692 
	`©h_tx_fûl_desc
(
sc
, 
bf
, 
txq
, 0);

1693 
	`©h_tx_txqaddbuf
(
sc
, 
txq
, &
bf_q
, 
Ál£
);

1694 
	`©h_txq_u∆ock
(
sc
, 
txq
);

1695 
	}
}

1701 
©h_txq
 *
	$©h_txq_£tup
(
©h_so·c
 *
sc
, 
qty≥
, 
subty≥
)

1703 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1704 
©h9k_tx_queue_öfo
 
qi
;

1705 c⁄° 
subty≥_txq_to_hwq
[] = {

1706 [
IEEE80211_AC_BE
] = 
ATH_TXQ_AC_BE
,

1707 [
IEEE80211_AC_BK
] = 
ATH_TXQ_AC_BK
,

1708 [
IEEE80211_AC_VI
] = 
ATH_TXQ_AC_VI
,

1709 [
IEEE80211_AC_VO
] = 
ATH_TXQ_AC_VO
,

1711 
axq_qnum
, 
i
;

1713 
	`mem£t
(&
qi
, 0, (qi));

1714 
qi
.
tqi_subty≥
 = 
subty≥_txq_to_hwq
[
subty≥
];

1715 
qi
.
tqi_aifs
 = 
ATH9K_TXQ_USEDEFAULT
;

1716 
qi
.
tqi_cwmö
 = 
ATH9K_TXQ_USEDEFAULT
;

1717 
qi
.
tqi_cwmax
 = 
ATH9K_TXQ_USEDEFAULT
;

1718 
qi
.
tqi_physCompBuf
 = 0;

1735 i‡(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

1736 
qi
.
tqi_qÊags
 = 
TXQ_FLAG_TXINT_ENABLE
;

1738 i‡(
qty≥
 =
ATH9K_TX_QUEUE_UAPSD
)

1739 
qi
.
tqi_qÊags
 = 
TXQ_FLAG_TXDESCINT_ENABLE
;

1741 
qi
.
tqi_qÊags
 = 
TXQ_FLAG_TXEOLINT_ENABLE
 |

1742 
TXQ_FLAG_TXDESCINT_ENABLE
;

1744 
axq_qnum
 = 
	`©h9k_hw_£tu±xqueue
(
ah
, 
qty≥
, &
qi
);

1745 i‡(
axq_qnum
 == -1) {

1750  
NULL
;

1752 i‡(!
	`ATH_TXQ_SETUP
(
sc
, 
axq_qnum
)) {

1753 
©h_txq
 *
txq
 = &
sc
->
tx
.txq[
axq_qnum
];

1755 
txq
->
axq_qnum
 =áxq_qnum;

1756 
txq
->
mac80211_qnum
 = -1;

1757 
txq
->
axq_lök
 = 
NULL
;

1758 
	`__skb_queue_hód_öô
(&
txq
->
com∂ëe_q
);

1759 
	`INIT_LIST_HEAD
(&
txq
->
axq_q
);

1760 
	`•ö_lock_öô
(&
txq
->
axq_lock
);

1761 
txq
->
axq_dïth
 = 0;

1762 
txq
->
axq_ampdu_dïth
 = 0;

1763 
txq
->
axq_tx_ö¥ogªss
 = 
Ál£
;

1764 
sc
->
tx
.
txq£tup
 |1<<
axq_qnum
;

1766 
txq
->
txq_hódidx
 =Åxq->
txq_èûidx
 = 0;

1767 
i
 = 0; i < 
ATH_TXFIFO_DEPTH
; i++)

1768 
	`INIT_LIST_HEAD
(&
txq
->
txq_fifo
[
i
]);

1770  &
sc
->
tx
.
txq
[
axq_qnum
];

1771 
	}
}

1773 
	$©h_txq_upd©e
(
©h_so·c
 *
sc
, 
qnum
,

1774 
©h9k_tx_queue_öfo
 *
qöfo
)

1776 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1777 
îr‹
 = 0;

1778 
©h9k_tx_queue_öfo
 
qi
;

1780 
	`BUG_ON
(
sc
->
tx
.
txq
[
qnum
].
axq_qnum
 != qnum);

1782 
	`©h9k_hw_gë_txq_¥›s
(
ah
, 
qnum
, &
qi
);

1783 
qi
.
tqi_aifs
 = 
qöfo
->tqi_aifs;

1784 
qi
.
tqi_cwmö
 = 
qöfo
->tqi_cwmin;

1785 
qi
.
tqi_cwmax
 = 
qöfo
->tqi_cwmax;

1786 
qi
.
tqi_bur°Time
 = 
qöfo
->tqi_burstTime;

1787 
qi
.
tqi_ªadyTime
 = 
qöfo
->tqi_readyTime;

1789 i‡(!
	`©h9k_hw_£t_txq_¥›s
(
ah
, 
qnum
, &
qi
)) {

1790 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
),

1791 "U«bÀÅÿupd©êh¨dw¨êqueuê%u!\n", 
qnum
);

1792 
îr‹
 = -
EIO
;

1794 
	`©h9k_hw_ª£âxqueue
(
ah
, 
qnum
);

1797  
îr‹
;

1798 
	}
}

1800 
	$©h_ˇbq_upd©e
(
©h_so·c
 *
sc
)

1802 
©h9k_tx_queue_öfo
 
qi
;

1803 
©h_bóc⁄_c⁄fig
 *
cur_c⁄f
 = &
sc
->
cur_ch™
->
bóc⁄
;

1804 
qnum
 = 
sc
->
bóc⁄
.
ˇbq
->
axq_qnum
;

1806 
	`©h9k_hw_gë_txq_¥›s
(
sc
->
sc_ah
, 
qnum
, &
qi
);

1808 
qi
.
tqi_ªadyTime
 = (
	`TU_TO_USEC
(
cur_c⁄f
->
bóc⁄_öãrvÆ
) *

1809 
ATH_CABQ_READY_TIME
) / 100;

1810 
	`©h_txq_upd©e
(
sc
, 
qnum
, &
qi
);

1813 
	}
}

1815 
	$©h_døö_txq_li°
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

1816 
li°_hód
 *
li°
)

1818 
©h_buf
 *
bf
, *
œ°bf
;

1819 
li°_hód
 
bf_hód
;

1820 
©h_tx_°©us
 
ts
;

1822 
	`mem£t
(&
ts
, 0, (ts));

1823 
ts
.
ts_°©us
 = 
ATH9K_TX_FLUSH
;

1824 
	`INIT_LIST_HEAD
(&
bf_hód
);

1826 !
	`li°_em±y
(
li°
)) {

1827 
bf
 = 
	`li°_fú°_íåy
(
li°
, 
©h_buf
,Üist);

1829 i‡(
bf
->
bf_°©e
.
°Æe
) {

1830 
	`li°_dñ
(&
bf
->
li°
);

1832 
	`©h_tx_ªtu∫_buf„r
(
sc
, 
bf
);

1836 
œ°bf
 = 
bf
->
bf_œ°bf
;

1837 
	`li°_cut_posôi⁄
(&
bf_hód
, 
li°
, &
œ°bf
->list);

1838 
	`©h_tx_¥o˚ss_buf„r
(
sc
, 
txq
, &
ts
, 
bf
, &
bf_hód
);

1840 
	}
}

1848 
	$©h_døötxq
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

1850 
	`©h_txq_lock
(
sc
, 
txq
);

1852 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
) {

1853 
idx
 = 
txq
->
txq_èûidx
;

1855 !
	`li°_em±y
(&
txq
->
txq_fifo
[
idx
])) {

1856 
	`©h_døö_txq_li°
(
sc
, 
txq
, &txq->
txq_fifo
[
idx
]);

1858 
	`INCR
(
idx
, 
ATH_TXFIFO_DEPTH
);

1860 
txq
->
txq_èûidx
 = 
idx
;

1863 
txq
->
axq_lök
 = 
NULL
;

1864 
txq
->
axq_tx_ö¥ogªss
 = 
Ál£
;

1865 
	`©h_døö_txq_li°
(
sc
, 
txq
, &txq->
axq_q
);

1867 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

1868 
	}
}

1870 
boﬁ
 
	$©h_døö_Æl_txq
(
©h_so·c
 *
sc
)

1872 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

1873 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1874 
©h_txq
 *
txq
;

1875 
i
;

1876 
u32
 
≈íd
 = 0;

1878 i‡(
	`ã°_bô
(
ATH_OP_INVALID
, &
comm⁄
->
›_Êags
))

1879  
åue
;

1881 
	`©h9k_hw_ab‹t_tx_dma
(
ah
);

1884 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++) {

1885 i‡(!
	`ATH_TXQ_SETUP
(
sc
, 
i
))

1888 i‡(!
sc
->
tx
.
txq
[
i
].
axq_dïth
)

1891 i‡(
	`©h9k_hw_numtx≥ndög
(
ah
, 
sc
->
tx
.
txq
[
i
].
axq_qnum
))

1892 
≈íd
 |
	`BIT
(
i
);

1895 i‡(
≈íd
) {

1896 
	`RESET_STAT_INC
(
sc
, 
RESET_TX_DMA_ERROR
);

1897 
	`©h_dbg
(
comm⁄
, 
RESET
,

1898 "FaûedÅÿ°› TX DMA, queues=0x%03x!\n", 
≈íd
);

1901 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++) {

1902 i‡(!
	`ATH_TXQ_SETUP
(
sc
, 
i
))

1910 
txq
 = &
sc
->
tx
.txq[
i
];

1911 
txq
->
°›≥d
 = 
Ál£
;

1912 
	`©h_døötxq
(
sc
, 
txq
);

1915  !
≈íd
;

1916 
	}
}

1918 
	$©h_tx_˛ónupq
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

1920 
	`©h9k_hw_ªÀa£txqueue
(
sc
->
sc_ah
, 
txq
->
axq_qnum
);

1921 
sc
->
tx
.
txq£tup
 &~(1<<
txq
->
axq_qnum
);

1922 
	}
}

1927 
	$©h_txq_scheduÀ
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

1929 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

1930 
©h_©x_tid
 *
tid
, *
œ°_tid
;

1931 
li°_hód
 *
tid_li°
;

1932 
boﬁ
 
£¡
 = 
Ál£
;

1934 i‡(
txq
->
mac80211_qnum
 < 0)

1937 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
))

1940 
	`•ö_lock_bh
(&
sc
->
ch™_lock
);

1941 
tid_li°
 = &
sc
->
cur_ch™
->
acq
[
txq
->
mac80211_qnum
];

1943 i‡(
	`li°_em±y
(
tid_li°
)) {

1944 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1948 
	`rcu_ªad_lock
();

1950 
œ°_tid
 = 
	`li°_íåy
(
tid_li°
->
¥ev
, 
©h_©x_tid
, 
li°
);

1951 !
	`li°_em±y
(
tid_li°
)) {

1952 
boﬁ
 
°›
 = 
Ál£
;

1954 i‡(
sc
->
cur_ch™
->
°›≥d
)

1957 
tid
 = 
	`li°_fú°_íåy
(
tid_li°
, 
©h_©x_tid
, 
li°
);

1958 
	`li°_dñ_öô
(&
tid
->
li°
);

1960 i‡(
	`©h_tx_sched_aggr
(
sc
, 
txq
, 
tid
, &
°›
))

1961 
£¡
 = 
åue
;

1967 i‡(
	`©h_tid_has_buf„ªd
(
tid
))

1968 
	`©h_tx_queue_tid
(
sc
, 
txq
, 
tid
);

1970 i‡(
°›
)

1973 i‡(
tid
 =
œ°_tid
) {

1974 i‡(!
£¡
)

1977 
£¡
 = 
Ál£
;

1978 
œ°_tid
 = 
	`li°_íåy
(
tid_li°
->
¥ev
,

1979 
©h_©x_tid
, 
li°
);

1983 
	`rcu_ªad_u∆ock
();

1984 
	`•ö_u∆ock_bh
(&
sc
->
ch™_lock
);

1985 
	}
}

1987 
	$©h_txq_scheduÀ_Æl
(
©h_so·c
 *
sc
)

1989 
©h_txq
 *
txq
;

1990 
i
;

1992 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

1993 
txq
 = 
sc
->
tx
.
txq_m≠
[
i
];

1995 
	`•ö_lock_bh
(&
txq
->
axq_lock
);

1996 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

1997 
	`•ö_u∆ock_bh
(&
txq
->
axq_lock
);

1999 
	}
}

2009 
	$©h_tx_txqaddbuf
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

2010 
li°_hód
 *
hód
, 
boﬁ
 
öã∫Æ
)

2012 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2013 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2014 
©h_buf
 *
bf
, *
bf_œ°
;

2015 
boﬁ
 
puâxbuf
 = 
Ál£
;

2016 
boﬁ
 
edma
;

2023 i‡(
	`li°_em±y
(
hód
))

2026 
edma
 = !!(
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
);

2027 
bf
 = 
	`li°_fú°_íåy
(
hód
, 
©h_buf
, 
li°
);

2028 
bf_œ°
 = 
	`li°_íåy
(
hód
->
¥ev
, 
©h_buf
, 
li°
);

2030 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "qnum: %d,Åxq depth: %d\n",

2031 
txq
->
axq_qnum
,Åxq->
axq_dïth
);

2033 i‡(
edma
 && 
	`li°_em±y
(&
txq
->
txq_fifo
[txq->
txq_hódidx
])) {

2034 
	`li°_•li˚_èû_öô
(
hód
, &
txq
->
txq_fifo
[txq->
txq_hódidx
]);

2035 
	`INCR
(
txq
->
txq_hódidx
, 
ATH_TXFIFO_DEPTH
);

2036 
puâxbuf
 = 
åue
;

2038 
	`li°_•li˚_èû_öô
(
hód
, &
txq
->
axq_q
);

2040 i‡(
txq
->
axq_lök
) {

2041 
	`©h9k_hw_£t_desc_lök
(
ah
, 
txq
->
axq_lök
, 
bf
->
bf_daddr
);

2042 
	`©h_dbg
(
comm⁄
, 
XMIT
, "link[%u] (%p)=%llx (%p)\n",

2043 
txq
->
axq_qnum
,Åxq->
axq_lök
,

2044 
	`ôo64
(
bf
->
bf_daddr
), bf->
bf_desc
);

2045 } i‡(!
edma
)

2046 
puâxbuf
 = 
åue
;

2048 
txq
->
axq_lök
 = 
bf_œ°
->
bf_desc
;

2051 i‡(
puâxbuf
) {

2052 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
puâxbuf
);

2053 
	`©h9k_hw_puâxbuf
(
ah
, 
txq
->
axq_qnum
, 
bf
->
bf_daddr
);

2054 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TXDP[%u] = %llx (%p)\n",

2055 
txq
->
axq_qnum
, 
	`ôo64
(
bf
->
bf_daddr
), bf->
bf_desc
);

2058 i‡(!
edma
 || 
sc
->
tx99_°©e
) {

2059 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
tx°¨t
);

2060 
	`©h9k_hw_tx°¨t
(
ah
, 
txq
->
axq_qnum
);

2063 i‡(!
öã∫Æ
) {

2064 
bf
) {

2065 
txq
->
axq_dïth
++;

2066 i‡(
	`bf_is_ampdu_nŸ_¥obög
(
bf
))

2067 
txq
->
axq_ampdu_dïth
++;

2069 
bf_œ°
 = 
bf
->
bf_œ°bf
;

2070 
bf
 = 
bf_œ°
->
bf_√xt
;

2071 
bf_œ°
->
bf_√xt
 = 
NULL
;

2074 
	}
}

2076 
	$©h_tx_£nd_n‹mÆ
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
,

2077 
©h_©x_tid
 *
tid
, 
sk_buff
 *
skb
)

2080 
	`¥ötk
("Hi\n");

2082 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2083 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2084 
li°_hód
 
bf_hód
;

2085 
©h_buf
 *
bf
 = 
fi
->bf;

2087 
	`INIT_LIST_HEAD
(&
bf_hód
);

2088 
	`li°_add_èû
(&
bf
->
li°
, &
bf_hód
);

2089 
bf
->
bf_°©e
.
bf_ty≥
 = 0;

2090 i‡(
tid
 && (
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)) {

2091 
bf
->
bf_°©e
.
bf_ty≥
 = 
BUF_AMPDU
;

2092 
	`©h_tx_addto_baw
(
sc
, 
tid
, 
bf
);

2095 
bf
->
bf_√xt
 = 
NULL
;

2096 
bf
->
bf_œ°bf
 = bf;

2097 
	`©h_tx_fûl_desc
(
sc
, 
bf
, 
txq
, 
fi
->
‰amñí
);

2098 
	`©h_tx_txqaddbuf
(
sc
, 
txq
, &
bf_hód
, 
Ál£
);

2099 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
queued
);

2100 
	}
}

2102 
	$£tup_‰ame_öfo
(
õì80211_hw
 *
hw
,

2103 
õì80211_°a
 *
°a
,

2104 
sk_buff
 *
skb
,

2105 
‰amñí
)

2107 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2108 
õì80211_key_c⁄f
 *
hw_key
 = 
tx_öfo
->
c⁄åﬁ
.hw_key;

2109 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

2110 c⁄° 
õì80211_øã
 *
øã
;

2111 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2112 
©h_node
 *
™
 = 
NULL
;

2113 
©h9k_key_ty≥
 
keyty≥
;

2114 
boﬁ
 
sh‹t_¥ómbÀ
 = 
Ál£
;

2115 
u8
 
txpowî
;

2122 i‡(
tx_öfo
->
c⁄åﬁ
.
vif
 &&

2123 
tx_öfo
->
c⁄åﬁ
.
vif
->
bss_c⁄f
.
u£_sh‹t_¥ómbÀ
)

2124 
sh‹t_¥ómbÀ
 = 
åue
;

2126 
øã
 = 
	`õì80211_gë_πs_˘s_øã
(
hw
, 
tx_öfo
);

2127 
keyty≥
 = 
	`©h9k_cmn_gë_hw_¸y±o_keyty≥
(
skb
);

2129 i‡(
°a
)

2130 
™
 = (
©h_node
 *Ë
°a
->
drv_¥iv
;

2132 i‡(
tx_öfo
->
c⁄åﬁ
.
vif
) {

2133 
õì80211_vif
 *
vif
 = 
tx_öfo
->
c⁄åﬁ
.vif;

2135 
txpowî
 = 2 * 
vif
->
bss_c⁄f
.txpower;

2137 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2139 
txpowî
 = 
sc
->
cur_ch™
->
cur_txpowî
;

2142 
	`mem£t
(
fi
, 0, (*fi));

2143 
fi
->
txq
 = -1;

2144 i‡(
hw_key
)

2145 
fi
->
keyix
 = 
hw_key
->
hw_key_idx
;

2146 i‡(
™
 && 
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
Ë&&án->
ps_key
 > 0)

2147 
fi
->
keyix
 = 
™
->
ps_key
;

2149 
fi
->
keyix
 = 
ATH9K_TXKEYIX_INVALID
;

2150 
fi
->
keyty≥
 = keytype;

2151 
fi
->
‰amñí
 = framelen;

2152 
fi
->
tx_powî
 = 
txpowî
;

2154 i‡(!
øã
)

2156 
fi
->
πs˘s_øã
 = 
øã
->
hw_vÆue
;

2157 i‡(
sh‹t_¥ómbÀ
)

2158 
fi
->
πs˘s_øã
 |
øã
->
hw_vÆue_sh‹t
;

2159 
	}
}

2161 
u8
 
	$©h_txchaömask_ªdu˘i⁄
(
©h_so·c
 *
sc
, 
u8
 
chaömask
, 
u32
 
øã
)

2163 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2164 
©h9k_ch™√l
 *
curch™
 = 
ah
->curchan;

2166 i‡((
ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_APM
Ë&& 
	`IS_CHAN_5GHZ
(
curch™
) &&

2167 (
chaömask
 =0x7Ë&& (
øã
 < 0x90))

2169 i‡(
	`AR_SREV_9462
(
ah
Ë&& 
	`©h9k_hw_btc€x_is_íabÀd
(ah) &&

2170 
	`IS_CCK_RATE
(
øã
))

2173  
chaömask
;

2174 
	}
}

2180 
©h_buf
 *
	$©h_tx_£tup_buf„r
(
©h_so·c
 *
sc
,

2181 
©h_txq
 *
txq
,

2182 
©h_©x_tid
 *
tid
,

2183 
sk_buff
 *
skb
)

2185 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2186 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2187 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

2188 
©h_buf
 *
bf
;

2189 
‰agno
;

2190 
u16
 
£qno
;

2192 
bf
 = 
	`©h_tx_gë_buf„r
(
sc
);

2193 i‡(!
bf
) {

2194 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TX buffersáre full\n");

2195  
NULL
;

2198 
	`ATH_TXBUF_RESET
(
bf
);

2200 i‡(
tid
 && 
	`õì80211_is_d©a_¥e£¡
(
hdr
->
‰ame_c⁄åﬁ
)) {

2201 
‰agno
 = 
	`À16_to_˝u
(
hdr
->
£q_˘æ
Ë& 
IEEE80211_SCTL_FRAG
;

2202 
£qno
 = 
tid
->
£q_√xt
;

2203 
hdr
->
£q_˘æ
 = 
	`˝u_to_À16
(
tid
->
£q_√xt
 << 
IEEE80211_SEQ_SEQ_SHIFT
);

2205 i‡(
‰agno
)

2206 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
‰agno
);

2208 i‡(!
	`õì80211_has_m‹e‰ags
(
hdr
->
‰ame_c⁄åﬁ
))

2209 
	`INCR
(
tid
->
£q_√xt
, 
IEEE80211_SEQ_MAX
);

2211 
bf
->
bf_°©e
.
£qno
 = seqno;

2214 
bf
->
bf_mpdu
 = 
skb
;

2216 
bf
->
bf_buf_addr
 = 
	`dma_m≠_sögÀ
(
sc
->
dev
, 
skb
->
d©a
,

2217 
skb
->
Àn
, 
DMA_TO_DEVICE
);

2218 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
sc
->
dev
, 
bf
->
bf_buf_addr
))) {

2219 
bf
->
bf_mpdu
 = 
NULL
;

2220 
bf
->
bf_buf_addr
 = 0;

2221 
	`©h_îr
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
),

2223 
	`©h_tx_ªtu∫_buf„r
(
sc
, 
bf
);

2224  
NULL
;

2227 
fi
->
bf
 = bf;

2229  
bf
;

2230 
	}
}

2232 
	$©h_assign_£q
(
©h_comm⁄
 *
comm⁄
, 
sk_buff
 *
skb
)

2234 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*Ë
skb
->
d©a
;

2235 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2236 
õì80211_vif
 *
vif
 = 
öfo
->
c⁄åﬁ
.vif;

2237 
©h_vif
 *
avp
;

2239 i‡(!(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_ASSIGN_SEQ
))

2242 i‡(!
vif
)

2245 
avp
 = (
©h_vif
 *)
vif
->
drv_¥iv
;

2247 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_FIRST_FRAGMENT
)

2248 
avp
->
£q_no
 += 0x10;

2250 
hdr
->
£q_˘æ
 &
	`˝u_to_À16
(
IEEE80211_SCTL_FRAG
);

2251 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
avp
->
£q_no
);

2252 
	}
}

2254 
	$©h_tx_¥ï¨e
(
õì80211_hw
 *
hw
, 
sk_buff
 *
skb
,

2255 
©h_tx_c⁄åﬁ
 *
tx˘l
)

2257 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*Ë
skb
->
d©a
;

2258 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2259 
õì80211_°a
 *
°a
 = 
tx˘l
->sta;

2260 
õì80211_vif
 *
vif
 = 
öfo
->
c⁄åﬁ
.vif;

2261 
©h_vif
 *
avp
;

2262 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2263 
‰mÀn
 = 
skb
->
Àn
 + 
FCS_LEN
;

2264 
∑dpos
, 
∑dsize
;

2267 i‡(
°a
)

2268 
tx˘l
->
™
 = (
©h_node
 *)
°a
->
drv_¥iv
;

2269 i‡(
vif
 && 
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
)) {

2270 
avp
 = (*)
vif
->
drv_¥iv
;

2271 
tx˘l
->
™
 = &
avp
->
mˇ°_node
;

2274 i‡(
öfo
->
c⁄åﬁ
.
hw_key
)

2275 
‰mÀn
 +
öfo
->
c⁄åﬁ
.
hw_key
->
icv_Àn
;

2277 
	`©h_assign_£q
(
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
), 
skb
);

2279 i‡((
vif
 && vif->
ty≥
 !
NL80211_IFTYPE_AP
 &&

2280 
vif
->
ty≥
 !
NL80211_IFTYPE_AP_VLAN
) ||

2281 !
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

2282 
öfo
->
Êags
 |
IEEE80211_TX_CTL_CLEAR_PS_FILT
;

2285 
∑dpos
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

2286 
∑dsize
 = 
∑dpos
 & 3;

2287 i‡(
∑dsize
 && 
skb
->
Àn
 > 
∑dpos
) {

2288 i‡(
	`skb_hódroom
(
skb
Ë< 
∑dsize
)

2289  -
ENOMEM
;

2291 
	`skb_push
(
skb
, 
∑dsize
);

2292 
	`memmove
(
skb
->
d©a
, skb->d©®+ 
∑dsize
, 
∑dpos
);

2295 
	`£tup_‰ame_öfo
(
hw
, 
°a
, 
skb
, 
‰mÀn
);

2297 
	}
}

2301 
	$©h_tx_°¨t
(
õì80211_hw
 *
hw
, 
sk_buff
 *
skb
,

2302 
©h_tx_c⁄åﬁ
 *
tx˘l
)

2304 
õì80211_hdr
 *
hdr
;

2305 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2306 
õì80211_°a
 *
°a
 = 
tx˘l
->sta;

2307 
õì80211_vif
 *
vif
 = 
öfo
->
c⁄åﬁ
.vif;

2308 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2309 
©h_vif
 *
avp
 = 
NULL
;

2310 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2311 
©h_txq
 *
txq
 = 
tx˘l
->txq;

2312 
©h_©x_tid
 *
tid
 = 
NULL
;

2313 
©h_buf
 *
bf
;

2314 
boﬁ
 
queue
, 
ps_ª•
;

2315 
q
, 
ªt
;

2317 i‡(
vif
)

2318 
avp
 = (*)
vif
->
drv_¥iv
;

2320 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_TX_OFFCHAN
)

2321 
tx˘l
->
f‹˚_ch™√l
 = 
åue
;

2323 
ps_ª•
 = !!(
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_PS_RESPONSE
);

2325 
ªt
 = 
	`©h_tx_¥ï¨e
(
hw
, 
skb
, 
tx˘l
);

2326 i‡(
ªt
)

2327  
ªt
;

2329 
hdr
 = (
õì80211_hdr
 *Ë
skb
->
d©a
;

2335 
q
 = 
	`skb_gë_queue_m≠pög
(
skb
);

2337 
	`©h_txq_lock
(
sc
, 
txq
);

2338 i‡(
txq
 =
sc
->
tx
.
txq_m≠
[
q
]) {

2339 
fi
->
txq
 = 
q
;

2340 i‡(++
txq
->
≥ndög_‰ames
 > 
sc
->
tx
.
txq_max_≥ndög
[
q
] &&

2341 !
txq
->
°›≥d
) {

2342 i‡(
	`©h9k_is_ch™˘x_íabÀd
())

2343 
	`õì80211_°›_queue
(
sc
->
hw
, 
öfo
->
hw_queue
);

2345 
	`õì80211_°›_queue
(
sc
->
hw
, 
q
);

2346 
txq
->
°›≥d
 = 
åue
;

2350 
queue
 = 
	`õì80211_is_d©a_¥e£¡
(
hdr
->
‰ame_c⁄åﬁ
);

2353 i‡(
	`©h9k_is_ch™˘x_íabÀd
() &&

2354 
	`õì80211_is_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
) &&

2355 !
tx˘l
->
f‹˚_ch™√l
)

2356 
queue
 = 
åue
;

2362 i‡(((
avp
 &&ávp->
ch™˘x
 !
sc
->
cur_ch™
) ||

2363 
sc
->
cur_ch™
->
°›≥d
Ë&& !
tx˘l
->
f‹˚_ch™√l
) {

2364 i‡(!
tx˘l
->
™
)

2365 
tx˘l
->
™
 = &
avp
->
mˇ°_node
;

2366 
queue
 = 
åue
;

2367 
ps_ª•
 = 
Ál£
;

2370 i‡(
tx˘l
->
™
 && 
queue
)

2371 
tid
 = 
	`©h_gë_skb_tid
(
sc
, 
tx˘l
->
™
, 
skb
);

2373 i‡(
ps_ª•
) {

2374 
	`©h_txq_u∆ock
(
sc
, 
txq
);

2375 
txq
 = 
sc
->
tx
.
u≠sdq
;

2376 
	`©h_txq_lock
(
sc
, 
txq
);

2377 } i‡(
tx˘l
->
™
 && 
queue
) {

2378 
	`WARN_ON
(
tid
->
txq
 !
tx˘l
->txq);

2380 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_CLEAR_PS_FILT
)

2381 
tid
->
˛ór_ps_fûãr
 = 
åue
;

2387 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
a_queued_sw
);

2388 
	`__skb_queue_èû
(&
tid
->
buf_q
, 
skb
);

2389 i‡(!
tx˘l
->
™
->
¶ìpög
)

2390 
	`©h_tx_queue_tid
(
sc
, 
txq
, 
tid
);

2392 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

2393 
out
;

2396 
bf
 = 
	`©h_tx_£tup_buf„r
(
sc
, 
txq
, 
tid
, 
skb
);

2397 i‡(!
bf
) {

2398 
	`©h_txq_skb_d⁄e
(
sc
, 
txq
, 
skb
);

2399 i‡(
tx˘l
->
∑¥d
)

2400 
	`dev_k‰ì_skb_™y
(
skb
);

2402 
	`õì80211_‰ì_txskb
(
sc
->
hw
, 
skb
);

2403 
out
;

2406 
bf
->
bf_°©e
.
bfs_∑¥d
 = 
tx˘l
->
∑¥d
;

2408 i‡(
tx˘l
->
∑¥d
)

2409 
bf
->
bf_°©e
.
bfs_∑¥d_time°amp
 = 
jiffõs
;

2411 
	`©h_£t_øãs
(
vif
, 
°a
, 
bf
, 
ps_ª•
);

2412 
	`©h_tx_£nd_n‹mÆ
(
sc
, 
txq
, 
tid
, 
skb
);

2414 
out
:

2415 
	`©h_txq_u∆ock
(
sc
, 
txq
);

2418 
	}
}

2420 
	$©h_tx_ˇbq
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2421 
sk_buff
 *
skb
)

2423 
©h_so·c
 *
sc
 = 
hw
->
¥iv
;

2424 
©h_tx_c⁄åﬁ
 
tx˘l
 = {

2425 .
txq
 = 
sc
->
bóc⁄
.
ˇbq


2427 
©h_tx_öfo
 
öfo
 = {};

2428 
õì80211_hdr
 *
hdr
;

2429 
©h_buf
 *
bf_èû
 = 
NULL
;

2430 
©h_buf
 *
bf
;

2431 
	`LIST_HEAD
(
bf_q
);

2432 
duøti⁄
 = 0;

2433 
max_duøti⁄
;

2435 
max_duøti⁄
 =

2436 
sc
->
cur_ch™
->
bóc⁄
.
bóc⁄_öãrvÆ
 * 1000 *

2437 
sc
->
cur_ch™
->
bóc⁄
.
dtim_≥riod
 / 
ATH_BCBUF
;

2440 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2442 i‡(
	`©h_tx_¥ï¨e
(
hw
, 
skb
, &
tx˘l
))

2445 
bf
 = 
	`©h_tx_£tup_buf„r
(
sc
, 
tx˘l
.
txq
, 
NULL
, 
skb
);

2446 i‡(!
bf
)

2449 
bf
->
bf_œ°bf
 = bf;

2450 
	`©h_£t_øãs
(
vif
, 
NULL
, 
bf
, 
Ál£
);

2451 
	`©h_buf_£t_øã
(
sc
, 
bf
, &
öfo
, 
fi
->
‰amñí
, 
Ál£
);

2452 
duøti⁄
 +
öfo
.
øãs
[0].
PktDuøti⁄
;

2453 i‡(
bf_èû
)

2454 
bf_èû
->
bf_√xt
 = 
bf
;

2456 
	`li°_add_èû
(&
bf
->
li°
, &
bf_q
);

2457 
bf_èû
 = 
bf
;

2458 
skb
 = 
NULL
;

2460 i‡(
duøti⁄
 > 
max_duøti⁄
)

2463 
skb
 = 
	`õì80211_gë_buf„ªd_bc
(
hw
, 
vif
);

2464 } 
skb
);

2466 i‡(
skb
)

2467 
	`õì80211_‰ì_txskb
(
hw
, 
skb
);

2469 i‡(
	`li°_em±y
(&
bf_q
))

2472 
bf
 = 
	`li°_fú°_íåy
(&
bf_q
, 
©h_buf
, 
li°
);

2473 
hdr
 = (
õì80211_hdr
 *Ë
bf
->
bf_mpdu
->
d©a
;

2475 i‡(
hdr
->
‰ame_c⁄åﬁ
 & 
	`˝u_to_À16
(
IEEE80211_FCTL_MOREDATA
)) {

2476 
hdr
->
‰ame_c⁄åﬁ
 &~
	`˝u_to_À16
(
IEEE80211_FCTL_MOREDATA
);

2477 
	`dma_sync_sögÀ_f‹_devi˚
(
sc
->
dev
, 
bf
->
bf_buf_addr
,

2478 (*
hdr
), 
DMA_TO_DEVICE
);

2481 
	`©h_txq_lock
(
sc
, 
tx˘l
.
txq
);

2482 
	`©h_tx_fûl_desc
(
sc
, 
bf
, 
tx˘l
.
txq
, 0);

2483 
	`©h_tx_txqaddbuf
(
sc
, 
tx˘l
.
txq
, &
bf_q
, 
Ál£
);

2484 
	`TX_STAT_INC
(
tx˘l
.
txq
->
axq_qnum
, 
queued
);

2485 
	`©h_txq_u∆ock
(
sc
, 
tx˘l
.
txq
);

2486 
	}
}

2492 
	$©h_tx_com∂ëe
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
,

2493 
tx_Êags
, 
©h_txq
 *
txq
)

2495 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2496 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2497 
õì80211_hdr
 * 
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

2498 
∑dpos
, 
∑dsize
;

2499 
Êags
;

2501 
	`©h_dbg
(
comm⁄
, 
XMIT
, "TX com∂ëe: skb: %p\n", 
skb
);

2503 i‡(
sc
->
sc_ah
->
ˇld©a
)

2504 
	`£t_bô
(
PAPRD_PACKET_SENT
, &
sc
->
sc_ah
->
ˇld©a
->
ˇl_Êags
);

2506 i‡(!(
tx_Êags
 & 
ATH_TX_ERROR
)) {

2507 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
)

2508 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_NOACK_TRANSMITTED
;

2510 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

2513 
∑dpos
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

2514 
∑dsize
 = 
∑dpos
 & 3;

2515 i‡(
∑dsize
 && 
skb
->
Àn
>
∑dpos
+padsize) {

2520 
	`memmove
(
skb
->
d©a
 + 
∑dsize
, skb->d©a, 
∑dpos
);

2521 
	`skb_puŒ
(
skb
, 
∑dsize
);

2524 
	`•ö_lock_úqßve
(&
sc
->
sc_pm_lock
, 
Êags
);

2525 i‡((
sc
->
ps_Êags
 & 
PS_WAIT_FOR_TX_ACK
Ë&& !
txq
->
axq_dïth
) {

2526 
sc
->
ps_Êags
 &~
PS_WAIT_FOR_TX_ACK
;

2527 
	`©h_dbg
(
comm⁄
, 
PS
,

2529 
sc
->
ps_Êags
 & (
PS_WAIT_FOR_BEACON
 |

2530 
PS_WAIT_FOR_CAB
 |

2531 
PS_WAIT_FOR_PSPOLL_DATA
 |

2532 
PS_WAIT_FOR_TX_ACK
));

2534 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
sc_pm_lock
, 
Êags
);

2536 
	`__skb_queue_èû
(&
txq
->
com∂ëe_q
, 
skb
);

2537 
	`©h_txq_skb_d⁄e
(
sc
, 
txq
, 
skb
);

2538 
	}
}

2540 
	$©h_tx_com∂ëe_buf
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

2541 
©h_txq
 *
txq
, 
li°_hód
 *
bf_q
,

2542 
©h_tx_°©us
 *
ts
, 
txok
)

2544 
sk_buff
 *
skb
 = 
bf
->
bf_mpdu
;

2545 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2546 
Êags
;

2547 
tx_Êags
 = 0;

2549 i‡(!
txok
)

2550 
tx_Êags
 |
ATH_TX_ERROR
;

2552 i‡(
ts
->
ts_°©us
 & 
ATH9K_TXERR_FILT
)

2553 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_TX_FILTERED
;

2555 
	`dma_unm≠_sögÀ
(
sc
->
dev
, 
bf
->
bf_buf_addr
, 
skb
->
Àn
, 
DMA_TO_DEVICE
);

2556 
bf
->
bf_buf_addr
 = 0;

2557 i‡(
sc
->
tx99_°©e
)

2558 
skù_tx_com∂ëe
;

2560 i‡(
bf
->
bf_°©e
.
bfs_∑¥d
) {

2561 i‡(
	`time_a·î
(
jiffõs
,

2562 
bf
->
bf_°©e
.
bfs_∑¥d_time°amp
 +

2563 
	`m£cs_to_jiffõs
(
ATH_PAPRD_TIMEOUT
)))

2564 
	`dev_k‰ì_skb_™y
(
skb
);

2566 
	`com∂ëe
(&
sc
->
∑¥d_com∂ëe
);

2568 
	`©h_debug_°©_tx
(
sc
, 
bf
, 
ts
, 
txq
, 
tx_Êags
);

2569 
	`©h_tx_com∂ëe
(
sc
, 
skb
, 
tx_Êags
, 
txq
);

2571 
skù_tx_com∂ëe
:

2575 
bf
->
bf_mpdu
 = 
NULL
;

2580 
	`•ö_lock_úqßve
(&
sc
->
tx
.
txbuÊock
, 
Êags
);

2581 
	`li°_•li˚_èû_öô
(
bf_q
, &
sc
->
tx
.
txbuf
);

2582 
	`•ö_u∆ock_úqª°‹e
(&
sc
->
tx
.
txbuÊock
, 
Êags
);

2583 
	}
}

2585 
	$©h_tx_rc_°©us
(
©h_so·c
 *
sc
, 
©h_buf
 *
bf
,

2586 
©h_tx_°©us
 *
ts
, 
n‰ames
, 
nbad
,

2587 
txok
)

2589 
sk_buff
 *
skb
 = 
bf
->
bf_mpdu
;

2590 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

2591 
õì80211_tx_öfo
 *
tx_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2592 
õì80211_hw
 *
hw
 = 
sc
->hw;

2593 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2594 
u8
 
i
, 
tx_øãödex
;

2596 i‡(
txok
)

2597 
tx_öfo
->
°©us
.
ack_sig«l
 = 
ts
->
ts_rssi
;

2599 
tx_øãödex
 = 
ts
->
ts_øãödex
;

2600 
	`WARN_ON
(
tx_øãödex
 >
hw
->
max_øãs
);

2602 i‡(
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
) {

2603 
tx_öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU
;

2605 
	`BUG_ON
(
nbad
 > 
n‰ames
);

2607 
tx_öfo
->
°©us
.
ampdu_Àn
 = 
n‰ames
;

2608 
tx_öfo
->
°©us
.
ampdu_ack_Àn
 = 
n‰ames
 - 
nbad
;

2610 i‡((
ts
->
ts_°©us
 & 
ATH9K_TXERR_FILT
) == 0 &&

2611 (
tx_öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
) == 0) {

2624 i‡(
	`u∆ikñy
(
ts
->
ts_Êags
 & (
ATH9K_TX_DATA_UNDERRUN
 |

2625 
ATH9K_TX_DELIM_UNDERRUN
)) &&

2626 
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) &&

2627 
ah
->
tx_åig_Àvñ
 >
sc
->
sc_ah
->
c⁄fig
.
max_txåig_Àvñ
)

2628 
tx_öfo
->
°©us
.
øãs
[
tx_øãödex
].
cou¡
 =

2629 
hw
->
max_øã_åõs
;

2632 
i
 = 
tx_øãödex
 + 1; i < 
hw
->
max_øãs
; i++) {

2633 
tx_öfo
->
°©us
.
øãs
[
i
].
cou¡
 = 0;

2634 
tx_öfo
->
°©us
.
øãs
[
i
].
idx
 = -1;

2637 
tx_öfo
->
°©us
.
øãs
[
tx_øãödex
].
cou¡
 = 
ts
->
ts_l⁄gªåy
 + 1;

2638 
	}
}

2640 
	$©h_tx_¥o˚ssq
(
©h_so·c
 *
sc
, 
©h_txq
 *
txq
)

2642 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2643 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
ah
);

2644 
©h_buf
 *
bf
, *
œ°bf
, *
bf_hñd
 = 
NULL
;

2645 
li°_hód
 
bf_hód
;

2646 
©h_desc
 *
ds
;

2647 
©h_tx_°©us
 
ts
;

2648 
°©us
;

2650 
	`©h_dbg
(
comm⁄
, 
QUEUE
, "tx queue %d (%x),Üink %p\n",

2651 
txq
->
axq_qnum
, 
	`©h9k_hw_gëtxbuf
(
sc
->
sc_ah
,Åxq->axq_qnum),

2652 
txq
->
axq_lök
);

2654 
	`©h_txq_lock
(
sc
, 
txq
);

2656 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
))

2659 i‡(
	`li°_em±y
(&
txq
->
axq_q
)) {

2660 
txq
->
axq_lök
 = 
NULL
;

2661 
	`©h_txq_scheduÀ
(
sc
, 
txq
);

2664 
bf
 = 
	`li°_fú°_íåy
(&
txq
->
axq_q
, 
©h_buf
, 
li°
);

2674 
bf_hñd
 = 
NULL
;

2675 i‡(
bf
->
bf_°©e
.
°Æe
) {

2676 
bf_hñd
 = 
bf
;

2677 i‡(
	`li°_is_œ°
(&
bf_hñd
->
li°
, &
txq
->
axq_q
))

2680 
bf
 = 
	`li°_íåy
(
bf_hñd
->
li°
.
√xt
, 
©h_buf
,

2681 
li°
);

2684 
œ°bf
 = 
bf
->
bf_œ°bf
;

2685 
ds
 = 
œ°bf
->
bf_desc
;

2687 
	`mem£t
(&
ts
, 0, (ts));

2688 
°©us
 = 
	`©h9k_hw_tx¥ocdesc
(
ah
, 
ds
, &
ts
);

2689 i‡(
°©us
 =-
EINPROGRESS
)

2692 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
tx¥ocdesc
);

2699 
œ°bf
->
bf_°©e
.
°Æe
 = 
åue
;

2700 
	`INIT_LIST_HEAD
(&
bf_hód
);

2701 i‡(!
	`li°_is_söguœr
(&
œ°bf
->
li°
))

2702 
	`li°_cut_posôi⁄
(&
bf_hód
,

2703 &
txq
->
axq_q
, 
œ°bf
->
li°
.
¥ev
);

2705 i‡(
bf_hñd
) {

2706 
	`li°_dñ
(&
bf_hñd
->
li°
);

2707 
	`©h_tx_ªtu∫_buf„r
(
sc
, 
bf_hñd
);

2710 
	`©h_tx_¥o˚ss_buf„r
(
sc
, 
txq
, &
ts
, 
bf
, &
bf_hód
);

2712 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

2713 
	}
}

2715 
	$©h_tx_èskÀt
(
©h_so·c
 *
sc
)

2717 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2718 
u32
 
qcumask
 = ((1 << 
ATH9K_NUM_TX_QUEUES
Ë- 1Ë& 
ah
->
öå_txqs
;

2719 
i
;

2721 
i
 = 0; i < 
ATH9K_NUM_TX_QUEUES
; i++) {

2722 i‡(
	`ATH_TXQ_SETUP
(
sc
, 
i
Ë&& (
qcumask
 & (1 << i)))

2723 
	`©h_tx_¥o˚ssq
(
sc
, &sc->
tx
.
txq
[
i
]);

2725 
	}
}

2727 
	$©h_tx_edma_èskÀt
(
©h_so·c
 *
sc
)

2729 
©h_tx_°©us
 
ts
;

2730 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2731 
©h_hw
 *
ah
 = 
sc
->
sc_ah
;

2732 
©h_txq
 *
txq
;

2733 
©h_buf
 *
bf
, *
œ°bf
;

2734 
li°_hód
 
bf_hód
;

2735 
li°_hód
 *
fifo_li°
;

2736 
°©us
;

2739 i‡(
	`ã°_bô
(
ATH_OP_HW_RESET
, &
comm⁄
->
›_Êags
))

2742 
°©us
 = 
	`©h9k_hw_tx¥ocdesc
(
ah
, 
NULL
, (*)&
ts
);

2743 i‡(
°©us
 =-
EINPROGRESS
)

2745 i‡(
°©us
 =-
EIO
) {

2746 
	`©h_dbg
(
comm⁄
, 
XMIT
, "ErrorÖrocessingÅx status\n");

2751 i‡(
ts
.
qid
 =
sc
->
bóc⁄
.
bóc⁄q
) {

2752 
sc
->
bóc⁄
.
tx_¥o˚s£d
 = 
åue
;

2753 
sc
->
bóc⁄
.
tx_œ°
 = !(
ts
.
ts_°©us
 & 
ATH9K_TXERR_MASK
);

2755 i‡(
	`©h9k_is_ch™˘x_íabÀd
()) {

2756 
	`©h_ch™˘x_evít
(
sc
, 
NULL
,

2757 
ATH_CHANCTX_EVENT_BEACON_SENT
);

2760 
	`©h9k_cß_upd©e
(
sc
);

2764 
txq
 = &
sc
->
tx
.txq[
ts
.
qid
];

2766 
	`©h_txq_lock
(
sc
, 
txq
);

2768 
	`TX_STAT_INC
(
txq
->
axq_qnum
, 
tx¥ocdesc
);

2770 
fifo_li°
 = &
txq
->
txq_fifo
[txq->
txq_èûidx
];

2771 i‡(
	`li°_em±y
(
fifo_li°
)) {

2772 
	`©h_txq_u∆ock
(
sc
, 
txq
);

2776 
bf
 = 
	`li°_fú°_íåy
(
fifo_li°
, 
©h_buf
, 
li°
);

2777 i‡(
bf
->
bf_°©e
.
°Æe
) {

2778 
	`li°_dñ
(&
bf
->
li°
);

2779 
	`©h_tx_ªtu∫_buf„r
(
sc
, 
bf
);

2780 
bf
 = 
	`li°_fú°_íåy
(
fifo_li°
, 
©h_buf
, 
li°
);

2783 
œ°bf
 = 
bf
->
bf_œ°bf
;

2785 
	`INIT_LIST_HEAD
(&
bf_hód
);

2786 i‡(
	`li°_is_œ°
(&
œ°bf
->
li°
, 
fifo_li°
)) {

2787 
	`li°_•li˚_èû_öô
(
fifo_li°
, &
bf_hód
);

2788 
	`INCR
(
txq
->
txq_èûidx
, 
ATH_TXFIFO_DEPTH
);

2790 i‡(!
	`li°_em±y
(&
txq
->
axq_q
)) {

2791 
li°_hód
 
bf_q
;

2793 
	`INIT_LIST_HEAD
(&
bf_q
);

2794 
txq
->
axq_lök
 = 
NULL
;

2795 
	`li°_•li˚_èû_öô
(&
txq
->
axq_q
, &
bf_q
);

2796 
	`©h_tx_txqaddbuf
(
sc
, 
txq
, &
bf_q
, 
åue
);

2799 
œ°bf
->
bf_°©e
.
°Æe
 = 
åue
;

2800 i‡(
bf
 !
œ°bf
)

2801 
	`li°_cut_posôi⁄
(&
bf_hód
, 
fifo_li°
,

2802 
œ°bf
->
li°
.
¥ev
);

2805 
	`©h_tx_¥o˚ss_buf„r
(
sc
, 
txq
, &
ts
, 
bf
, &
bf_hód
);

2806 
	`©h_txq_u∆ock_com∂ëe
(
sc
, 
txq
);

2808 
	}
}

2814 
	$©h_tx°©us_£tup
(
©h_so·c
 *
sc
, 
size
)

2816 
©h_descdma
 *
dd
 = &
sc
->
txsdma
;

2817 
u8
 
txs_Àn
 = 
sc
->
sc_ah
->
ˇps
.txs_len;

2819 
dd
->
dd_desc_Àn
 = 
size
 * 
txs_Àn
;

2820 
dd
->
dd_desc
 = 
	`dmam_Æloc_cohîít
(
sc
->
dev
, dd->
dd_desc_Àn
,

2821 &
dd
->
dd_desc_∑ddr
, 
GFP_KERNEL
);

2822 i‡(!
dd
->
dd_desc
)

2823  -
ENOMEM
;

2826 
	}
}

2828 
	$©h_tx_edma_öô
(
©h_so·c
 *
sc
)

2830 
îr
;

2832 
îr
 = 
	`©h_tx°©us_£tup
(
sc
, 
ATH_TXSTATUS_RING_SIZE
);

2833 i‡(!
îr
)

2834 
	`©h9k_hw_£tup_°©u§ög
(
sc
->
sc_ah
, sc->
txsdma
.
dd_desc
,

2835 
sc
->
txsdma
.
dd_desc_∑ddr
,

2836 
ATH_TXSTATUS_RING_SIZE
);

2838  
îr
;

2839 
	}
}

2841 
	$©h_tx_öô
(
©h_so·c
 *
sc
, 
nbufs
)

2843 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2844 
îr‹
 = 0;

2846 
	`•ö_lock_öô
(&
sc
->
tx
.
txbuÊock
);

2848 
îr‹
 = 
	`©h_descdma_£tup
(
sc
, &sc->
tx
.
txdma
, &sc->tx.
txbuf
,

2849 "tx", 
nbufs
, 1, 1);

2850 i‡(
îr‹
 != 0) {

2851 
	`©h_îr
(
comm⁄
,

2852 "FaûedÅÿÆloˇãÅx des¸ùt‹s: %d\n", 
îr‹
);

2853  
îr‹
;

2856 
îr‹
 = 
	`©h_descdma_£tup
(
sc
, &sc->
bóc⁄
.
bdma
, &sc->bóc⁄.
bbuf
,

2857 "bóc⁄", 
ATH_BCBUF
, 1, 1);

2858 i‡(
îr‹
 != 0) {

2859 
	`©h_îr
(
comm⁄
,

2860 "FaûedÅÿÆloˇã bóc⁄ des¸ùt‹s: %d\n", 
îr‹
);

2861  
îr‹
;

2864 
	`INIT_DELAYED_WORK
(&
sc
->
tx_com∂ëe_w‹k
, 
©h_tx_com∂ëe_pﬁl_w‹k
);

2866 i‡(
sc
->
sc_ah
->
ˇps
.
hw_ˇps
 & 
ATH9K_HW_CAP_EDMA
)

2867 
îr‹
 = 
	`©h_tx_edma_öô
(
sc
);

2869  
îr‹
;

2870 
	}
}

2872 
	$©h_tx_node_öô
(
©h_so·c
 *
sc
, 
©h_node
 *
™
)

2874 
©h_©x_tid
 *
tid
;

2875 
tidno
, 
a˙o
;

2877 
tidno
 = 0, 
tid
 = &
™
->tid[tidno];

2878 
tidno
 < 
IEEE80211_NUM_TIDS
;

2879 
tidno
++, 
tid
++) {

2880 
tid
->
™
 =án;

2881 
tid
->
tidno
 =Åidno;

2882 
tid
->
£q_°¨t
 =Åid->
£q_√xt
 = 0;

2883 
tid
->
baw_size
 = 
WME_MAX_BA
;

2884 
tid
->
baw_hód
 =Åid->
baw_èû
 = 0;

2885 
tid
->
a˘ive
 = 
Ál£
;

2886 
tid
->
˛ór_ps_fûãr
 = 
åue
;

2887 
	`__skb_queue_hód_öô
(&
tid
->
buf_q
);

2888 
	`__skb_queue_hód_öô
(&
tid
->
ªåy_q
);

2889 
	`INIT_LIST_HEAD
(&
tid
->
li°
);

2890 
a˙o
 = 
	`TID_TO_WME_AC
(
tidno
);

2891 
tid
->
txq
 = 
sc
->
tx
.
txq_m≠
[
a˙o
];

2893 
	}
}

2895 
	$©h_tx_node_˛ónup
(
©h_so·c
 *
sc
, 
©h_node
 *
™
)

2897 
©h_©x_tid
 *
tid
;

2898 
©h_txq
 *
txq
;

2899 
tidno
;

2901 
tidno
 = 0, 
tid
 = &
™
->tid[tidno];

2902 
tidno
 < 
IEEE80211_NUM_TIDS
;Åidno++, 
tid
++) {

2904 
txq
 = 
tid
->txq;

2906 
	`©h_txq_lock
(
sc
, 
txq
);

2908 i‡(!
	`li°_em±y
(&
tid
->
li°
))

2909 
	`li°_dñ_öô
(&
tid
->
li°
);

2911 
	`©h_tid_døö
(
sc
, 
txq
, 
tid
);

2912 
tid
->
a˘ive
 = 
Ál£
;

2914 
	`©h_txq_u∆ock
(
sc
, 
txq
);

2916 
	}
}

2918 #ifde‡
CPTCFG_ATH9K_TX99


2920 
	$©h9k_tx99_£nd
(
©h_so·c
 *
sc
, 
sk_buff
 *
skb
,

2921 
©h_tx_c⁄åﬁ
 *
tx˘l
)

2923 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*Ë
skb
->
d©a
;

2924 
©h_‰ame_öfo
 *
fi
 = 
	`gë_‰ame_öfo
(
skb
);

2925 
©h_comm⁄
 *
comm⁄
 = 
	`©h9k_hw_comm⁄
(
sc
->
sc_ah
);

2926 
©h_buf
 *
bf
;

2927 
∑dpos
, 
∑dsize
;

2929 
∑dpos
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

2930 
∑dsize
 = 
∑dpos
 & 3;

2932 i‡(
∑dsize
 && 
skb
->
Àn
 > 
∑dpos
) {

2933 i‡(
	`skb_hódroom
(
skb
Ë< 
∑dsize
) {

2934 
	`©h_dbg
(
comm⁄
, 
XMIT
,

2936  -
EINVAL
;

2939 
	`skb_push
(
skb
, 
∑dsize
);

2940 
	`memmove
(
skb
->
d©a
, skb->d©®+ 
∑dsize
, 
∑dpos
);

2943 
fi
->
keyix
 = 
ATH9K_TXKEYIX_INVALID
;

2944 
fi
->
‰amñí
 = 
skb
->
Àn
 + 
FCS_LEN
;

2945 
fi
->
keyty≥
 = 
ATH9K_KEY_TYPE_CLEAR
;

2947 
bf
 = 
	`©h_tx_£tup_buf„r
(
sc
, 
tx˘l
->
txq
, 
NULL
, 
skb
);

2948 i‡(!
bf
) {

2949 
	`©h_dbg
(
comm⁄
, 
XMIT
, "tx99 buffer setup failed\n");

2950  -
EINVAL
;

2953 
	`©h_£t_øãs
(
sc
->
tx99_vif
, 
NULL
, 
bf
, 
Ál£
);

2955 
	`©h9k_hw_£t_desc_lök
(
sc
->
sc_ah
, 
bf
->
bf_desc
, bf->
bf_daddr
);

2956 
	`©h9k_hw_tx99_°¨t
(
sc
->
sc_ah
, 
tx˘l
->
txq
->
axq_qnum
);

2958 
	`©h_tx_£nd_n‹mÆ
(
sc
, 
tx˘l
->
txq
, 
NULL
, 
skb
);

2961 
	}
}

	@../ath.h

17 #i‚de‡
ATH_H


18 
	#ATH_H


	)

20 
	~<löux/ëhîdevi˚.h
>

21 
	~<löux/skbuff.h
>

22 
	~<löux/if_ëhî.h
>

23 
	~<löux/•ölock.h
>

24 
	~<√t/mac80211.h
>

34 
	#ATH_KEYMAX
 128

	)

36 c⁄° 
u8
 
	g©h_bˇ°_mac
[
ETH_ALEN
] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

38 
	s©h_™i
 {

39 
boﬁ
 
	mˇld⁄e
;

40 
	ml⁄gˇl_timî
;

41 
	msh‹tˇl_timî
;

42 
	mª£tˇl_timî
;

43 
	mcheck™i_timî
;

44 
timî_li°
 
	mtimî
;

47 
	s©h_cy˛e_cou¡îs
 {

48 
u32
 
	mcy˛es
;

49 
u32
 
	mrx_busy
;

50 
u32
 
	mrx_‰ame
;

51 
u32
 
	mtx_‰ame
;

54 
	e©h_devi˚_°©e
 {

55 
	mATH_HW_UNAVAILABLE
,

56 
	mATH_HW_INITIALIZED
,

59 
	e©h_›_Êags
 {

60 
	mATH_OP_INVALID
,

61 
	mATH_OP_BEACONS
,

62 
	mATH_OP_ANI_RUN
,

63 
	mATH_OP_PRIM_STA_VIF
,

64 
	mATH_OP_HW_RESET
,

65 
	mATH_OP_SCANNING
,

66 
	mATH_OP_MULTI_CHANNEL
,

67 
	mATH_OP_WOW_ENABLED
,

70 
	e©h_bus_ty≥
 {

71 
	mATH_PCI
,

72 
	mATH_AHB
,

73 
	mATH_USB
,

76 
	sªg_dmn_∑ú_m≠pög
 {

77 
u16
 
	mªg_domaö
;

78 
u16
 
	mªg_5ghz_˘l
;

79 
u16
 
	mªg_2ghz_˘l
;

82 
	s©h_ªguœt‹y
 {

83 
	mÆpha2
[2];

84 
∆80211_dfs_ªgi⁄s
 
	mªgi⁄
;

85 
u16
 
	mcou¡ry_code
;

86 
u16
 
	mmax_powî_Àvñ
;

87 
u16
 
	mcuºít_rd
;

88 
öt16_t
 
	mpowî_limô
;

89 
ªg_dmn_∑ú_m≠pög
 *
	mªg∑ú
;

92 
	e©h_¸y±_ˇps
 {

93 
	mATH_CRYPT_CAP_CIPHER_AESCCM
 = 
BIT
(0),

94 
	mATH_CRYPT_CAP_MIC_COMBINED
 = 
BIT
(1),

97 
	s©h_keyvÆ
 {

98 
u8
 
	mkv_ty≥
;

99 
u8
 
	mkv_∑d
;

100 
u16
 
	mkv_Àn
;

101 
u8
 
	mkv_vÆ
[16];

102 
u8
 
	mkv_mic
[8];

103 
u8
 
	mkv_txmic
[8];

108 
	e©h_cùhî
 {

109 
	mATH_CIPHER_WEP
 = 0,

110 
	mATH_CIPHER_AES_OCB
 = 1,

111 
	mATH_CIPHER_AES_CCM
 = 2,

112 
	mATH_CIPHER_CKIP
 = 3,

113 
	mATH_CIPHER_TKIP
 = 4,

114 
	mATH_CIPHER_CLR
 = 5,

115 
	mATH_CIPHER_MIC
 = 127

127 
	s©h_›s
 {

128 (*
	mªad
)(*, 
u32
 
	mªg_off£t
);

129 (*
	mmu…i_ªad
)(*, 
u32
 *
	maddr
, u32 *
	mvÆ
, 
u16
 
	mcou¡
);

130 (*
	mwrôe
)(*, 
u32
 
	mvÆ
, u32 
	mªg_off£t
);

131 (*
	míabÀ_wrôe_buf„r
)(*);

132 (*
	mwrôe_Êush
) (*);

133 
u32
 (*
rmw
)(*, u32 
	mªg_off£t
, u32 
	m£t
, u32 
	m˛r
);

134 (*
	míabÀ_rmw_buf„r
)(*);

135 (*
	mrmw_Êush
) (*);

139 
	g©h_comm⁄
;

140 
	g©h_bus_›s
;

142 
	s©h_ps_›s
 {

143 (*
	mwakeup
)(
©h_comm⁄
 *
	mcomm⁄
);

144 (*
	mª°‹e
)(
©h_comm⁄
 *
	mcomm⁄
);

147 
	s©h_comm⁄
 {

148 *
	mah
;

149 *
	m¥iv
;

150 
õì80211_hw
 *
	mhw
;

151 
	mdebug_mask
;

152 
©h_devi˚_°©e
 
	m°©e
;

153 
	m›_Êags
;

154 
u32
 
	mch™_bw
;

156 
©h_™i
 
	m™i
;

158 
u16
 
	mˇchñsz
;

159 
u16
 
	mcuøid
;

160 
u8
 
	mmaˇddr
[
ETH_ALEN
];

161 
u8
 
	mcurbssid
[
ETH_ALEN
] 
__Æig√d
(2);

162 
u8
 
	mbssidmask
[
ETH_ALEN
];

164 
u32
 
	mrx_bufsize
;

166 
u32
 
	mkeymax
;

167 
DECLARE_BITMAP
(
keym≠
, 
ATH_KEYMAX
);

168 
DECLARE_BITMAP
(
tkù_keym≠
, 
ATH_KEYMAX
);

169 
DECLARE_BITMAP
(
ccmp_keym≠
, 
ATH_KEYMAX
);

170 
©h_¸y±_ˇps
 
	m¸y±_ˇps
;

172 
	m˛ockøã
;

174 
•ölock_t
 
	mcc_lock
;

175 
©h_cy˛e_cou¡îs
 
	mcc_™i
;

176 
©h_cy˛e_cou¡îs
 
	mcc_survey
;

178 
©h_ªguœt‹y
 
	mªguœt‹y
;

179 
©h_ªguœt‹y
 
	mªg_w‹ld_c›y
;

180 c⁄° 
©h_›s
 *
	m›s
;

181 c⁄° 
©h_bus_›s
 *
	mbus_›s
;

182 c⁄° 
©h_ps_›s
 *
	mps_›s
;

184 
boﬁ
 
	mbtc€x_íabÀd
;

185 
boﬁ
 
	mdißbÀ_™i
;

186 
boﬁ
 
	mbt_™t_divîsôy
;

188 
	mœ°_rssi
;

189 
õì80211_suµ‹ãd_b™d
 
	msb™ds
[
IEEE80211_NUM_BANDS
];

192 
ölöe
 c⁄° 
©h_ps_›s
 *
	$©h_ps_›s
(
©h_comm⁄
 *
comm⁄
)

194  
comm⁄
->
ps_›s
;

195 
	}
}

197 
sk_buff
 *
©h_rxbuf_Æloc
(
©h_comm⁄
 *
comm⁄
,

198 
u32
 
Àn
,

199 
gÂ_t
 
gÂ_mask
);

200 
boﬁ
 
©h_is_mybóc⁄
(
©h_comm⁄
 *
comm⁄
, 
õì80211_hdr
 *
hdr
);

202 
©h_hw_£tbssidmask
(
©h_comm⁄
 *
comm⁄
);

203 
©h_key_dñëe
(
©h_comm⁄
 *
comm⁄
, 
õì80211_key_c⁄f
 *
key
);

204 
©h_key_c⁄fig
(
©h_comm⁄
 *
comm⁄
,

205 
õì80211_vif
 *
vif
,

206 
õì80211_°a
 *
°a
,

207 
õì80211_key_c⁄f
 *
key
);

208 
boﬁ
 
©h_hw_keyª£t
(
©h_comm⁄
 *
comm⁄
, 
u16
 
íåy
);

209 
©h_hw_cy˛e_cou¡îs_upd©e
(
©h_comm⁄
 *
comm⁄
);

210 
öt32_t
 
©h_hw_gë_li°í_time
(
©h_comm⁄
 *
comm⁄
);

212 
	$__¥ötf
(3, 4)

213 
	`©h_¥ötk
(c⁄° *
Àvñ
, c⁄° 
©h_comm⁄
 *
comm⁄
,

214 c⁄° *
fmt
, ...);

216 
	#©h_emîg
(
comm⁄
, 
fmt
, ...) \

217 
	`©h_¥ötk
(
KERN_EMERG
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

218 
	#©h_Æît
(
comm⁄
, 
fmt
, ...) \

219 
	`©h_¥ötk
(
KERN_ALERT
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

220 
	#©h_¸ô
(
comm⁄
, 
fmt
, ...) \

221 
	`©h_¥ötk
(
KERN_CRIT
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

222 
	#©h_îr
(
comm⁄
, 
fmt
, ...) \

223 
	`©h_¥ötk
(
KERN_ERR
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

224 
	#©h_w¨n
(
comm⁄
, 
fmt
, ...) \

225 
	`©h_¥ötk
(
KERN_WARNING
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

226 
	#©h_nŸi˚
(
comm⁄
, 
fmt
, ...) \

227 
	`©h_¥ötk
(
KERN_NOTICE
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

228 
	#©h_öfo
(
comm⁄
, 
fmt
, ...) \

229 
	`©h_¥ötk
(
KERN_INFO
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
)

	)

264 
	eATH_DEBUG
 {

265 
ATH_DBG_RESET
 = 0x00000001,

266 
ATH_DBG_QUEUE
 = 0x00000002,

267 
ATH_DBG_EEPROM
 = 0x00000004,

268 
ATH_DBG_CALIBRATE
 = 0x00000008,

269 
ATH_DBG_INTERRUPT
 = 0x00000010,

270 
ATH_DBG_REGULATORY
 = 0x00000020,

271 
ATH_DBG_ANI
 = 0x00000040,

272 
ATH_DBG_XMIT
 = 0x00000080,

273 
ATH_DBG_BEACON
 = 0x00000100,

274 
ATH_DBG_CONFIG
 = 0x00000200,

275 
ATH_DBG_FATAL
 = 0x00000400,

276 
ATH_DBG_PS
 = 0x00000800,

277 
ATH_DBG_BTCOEX
 = 0x00001000,

278 
ATH_DBG_WMI
 = 0x00002000,

279 
ATH_DBG_BSTUCK
 = 0x00004000,

280 
ATH_DBG_MCI
 = 0x00008000,

281 
ATH_DBG_DFS
 = 0x00010000,

282 
ATH_DBG_WOW
 = 0x00020000,

283 
ATH_DBG_CHAN_CTX
 = 0x00040000,

284 
ATH_DBG_DYNACK
 = 0x00080000,

285 
ATH_DBG_SPECTRAL_SCAN
 = 0x00100000,

286 
ATH_DBG_ANY
 = 0xffffffff

289 
	#ATH_DBG_DEFAULT
 (
ATH_DBG_FATAL
)

	)

290 
	#ATH_DBG_MAX_LEN
 512

	)

292 #ifde‡
CPTCFG_ATH_DEBUG


294 
	#©h_dbg
(
comm⁄
, 
dbg_mask
, 
fmt
, ...) \

296 i‡((
comm⁄
)->
debug_mask
 & 
ATH_DBG_
##
dbg_mask
) \

297 
	`©h_¥ötk
(
KERN_DEBUG
, 
comm⁄
, 
fmt
, ##
__VA_ARGS__
); \

298 
	}
} 0)

	)

300 
	#ATH_DBG_WARN
(
foo
, 
¨g
...Ë
	`WARN
(foo,árg)

	)

301 
	#ATH_DBG_WARN_ON_ONCE
(
foo
Ë
	`WARN_ON_ONCE
(foo)

	)

305 
ölöe
 
__©åibuã__
 ((
	$f‹m©
 (
¥ötf
, 3, 4)))

306 
	$_©h_dbg
(
©h_comm⁄
 *
comm⁄
, 
ATH_DEBUG
 
dbg_mask
,

307 c⁄° *
fmt
, ...)

309 
	}
}

310 
	#©h_dbg
(
comm⁄
, 
dbg_mask
, 
fmt
, ...) \

311 
	`_©h_dbg
(
comm⁄
, 
ATH_DBG_
##
dbg_mask
, 
fmt
, ##
__VA_ARGS__
)

	)

313 
	#ATH_DBG_WARN
(
foo
, 
¨g
...Ëdÿ{} 0)

	)

314 
	#ATH_DBG_WARN_ON_ONCE
(
foo
) ({ \

315 
__ªt_w¨n_⁄˚
 = !!(
foo
); \

316 
	`u∆ikñy
(
__ªt_w¨n_⁄˚
); \

317 })

	)

322 c⁄° *
©h_›mode_to_°rög
(
∆80211_i·y≥
 
›mode
);

	@../dfs_pattern_detector.h

17 #i‚de‡
DFS_PATTERN_DETECTOR_H


18 
	#DFS_PATTERN_DETECTOR_H


	)

20 
	~<löux/ty≥s.h
>

21 
	~<löux/li°.h
>

22 
	~<löux/∆80211.h
>

27 
	#PRI_TOLERANCE
 16

	)

32 
	s©h_dfs_poﬁ_°©s
 {

33 
u32
 
	mpoﬁ_ª„ªn˚
;

34 
u32
 
	mpul£_Æloˇãd
;

35 
u32
 
	mpul£_Æloc_îr‹
;

36 
u32
 
	mpul£_u£d
;

37 
u32
 
	mp£q_Æloˇãd
;

38 
u32
 
	mp£q_Æloc_îr‹
;

39 
u32
 
	mp£q_u£d
;

50 
	spul£_evít
 {

51 
u64
 
	mts
;

52 
u16
 
	m‰eq
;

53 
u8
 
	mwidth
;

54 
u8
 
	mrssi
;

55 
boﬁ
 
	mchúp
;

71 
	sød¨_dëe˘‹_•ecs
 {

72 
u8
 
	mty≥_id
;

73 
u8
 
	mwidth_mö
;

74 
u8
 
	mwidth_max
;

75 
u16
 
	m¥i_mö
;

76 
u16
 
	m¥i_max
;

77 
u8
 
	mnum_¥i
;

78 
u8
 
	mµb
;

79 
u8
 
	mµb_thªsh
;

80 
u8
 
	mmax_¥i_tﬁî™˚
;

81 
boﬁ
 
	mchúp
;

95 
	sdfs_∑âîn_dëe˘‹
 {

96 (*
	mexô
)(
dfs_∑âîn_dëe˘‹
 *
	mdpd
);

97 
boﬁ
 (*
£t_dfs_domaö
)(
dfs_∑âîn_dëe˘‹
 *
	mdpd
,

98 
∆80211_dfs_ªgi⁄s
 
	mªgi⁄
);

99 
boﬁ
 (*
add_pul£
)(
dfs_∑âîn_dëe˘‹
 *
	mdpd
,

100 
pul£_evít
 *
	m≥
);

102 
©h_dfs_poﬁ_°©s
 (*
gë_°©s
)(
dfs_∑âîn_dëe˘‹
 *
	mdpd
);

103 
∆80211_dfs_ªgi⁄s
 
	mªgi⁄
;

104 
u8
 
	mnum_ød¨_ty≥s
;

105 
u64
 
	mœ°_pul£_ts
;

107 
©h_comm⁄
 *
	mcomm⁄
;

109 c⁄° 
ød¨_dëe˘‹_•ecs
 *
	mød¨_•ec
;

110 
li°_hód
 
	mch™√l_dëe˘‹s
;

118 
dfs_∑âîn_dëe˘‹
 *

119 
dfs_∑âîn_dëe˘‹_öô
(
©h_comm⁄
 *
comm⁄
,

120 
∆80211_dfs_ªgi⁄s
 
ªgi⁄
);

	@../reg.h

17 #i‚de‡
ATH_REGISTERS_H


18 
	#ATH_REGISTERS_H


	)

20 
	#AR_MIBC
 0x0040

	)

21 
	#AR_MIBC_COW
 0x00000001

	)

22 
	#AR_MIBC_FMC
 0x00000002

	)

23 
	#AR_MIBC_CMC
 0x00000004

	)

24 
	#AR_MIBC_MCS
 0x00000008

	)

26 
	#AR_STA_ID0
 0x8000

	)

27 
	#AR_STA_ID1
 0x8004

	)

28 
	#AR_STA_ID1_SADH_MASK
 0x0000ffff

	)

34 
	#AR_BSSMSKL
 0x80e0

	)

35 
	#AR_BSSMSKU
 0x80e4

	)

37 
	#AR_TFCNT
 0x80ec

	)

38 
	#AR_RFCNT
 0x80f0

	)

39 
	#AR_RCCNT
 0x80f4

	)

40 
	#AR_CCCNT
 0x80f8

	)

42 
	#AR_KEYTABLE_0
 0x8800

	)

43 
	#AR_KEYTABLE
(
_n
Ë(
AR_KEYTABLE_0
 + ((_n)*32))

	)

44 
	#AR_KEY_CACHE_SIZE
 128

	)

45 
	#AR_RSVD_KEYTABLE_ENTRIES
 4

	)

46 
	#AR_KEY_TYPE
 0x00000007

	)

47 
	#AR_KEYTABLE_TYPE_40
 0x00000000

	)

48 
	#AR_KEYTABLE_TYPE_104
 0x00000001

	)

49 
	#AR_KEYTABLE_TYPE_128
 0x00000003

	)

50 
	#AR_KEYTABLE_TYPE_TKIP
 0x00000004

	)

51 
	#AR_KEYTABLE_TYPE_AES
 0x00000005

	)

52 
	#AR_KEYTABLE_TYPE_CCM
 0x00000006

	)

53 
	#AR_KEYTABLE_TYPE_CLR
 0x00000007

	)

54 
	#AR_KEYTABLE_ANT
 0x00000008

	)

55 
	#AR_KEYTABLE_VALID
 0x00008000

	)

56 
	#AR_KEYTABLE_KEY0
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 0)

	)

57 
	#AR_KEYTABLE_KEY1
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 4)

	)

58 
	#AR_KEYTABLE_KEY2
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 8)

	)

59 
	#AR_KEYTABLE_KEY3
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 12)

	)

60 
	#AR_KEYTABLE_KEY4
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 16)

	)

61 
	#AR_KEYTABLE_TYPE
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 20)

	)

62 
	#AR_KEYTABLE_MAC0
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 24)

	)

63 
	#AR_KEYTABLE_MAC1
(
_n
Ë(
	`AR_KEYTABLE
(_nË+ 28)

	)

	@../regd.h

17 #i‚de‡
REGD_H


18 
	#REGD_H


	)

20 
	~<löux/∆80211.h
>

21 
	~<√t/cfg80211.h
>

23 
	~"©h.h
"

25 
	e˘l_group
 {

26 
	mCTL_FCC
 = 0x10,

27 
	mCTL_MKK
 = 0x40,

28 
	mCTL_ETSI
 = 0x30,

31 
	#NO_CTL
 0xff

	)

32 
	#SD_NO_CTL
 0xE0

	)

33 
	#NO_CTL
 0xff

	)

34 
	#CTL_11A
 0

	)

35 
	#CTL_11B
 1

	)

36 
	#CTL_11G
 2

	)

37 
	#CTL_2GHT20
 5

	)

38 
	#CTL_5GHT20
 6

	)

39 
	#CTL_2GHT40
 7

	)

40 
	#CTL_5GHT40
 8

	)

42 
	#CTRY_DEBUG
 0x1ff

	)

43 
	#CTRY_DEFAULT
 0

	)

45 
	#COUNTRY_ERD_FLAG
 0x8000

	)

46 
	#WORLDWIDE_ROAMING_FLAG
 0x4000

	)

48 
	#MULTI_DOMAIN_MASK
 0xFF00

	)

50 
	#WORLD_SKU_MASK
 0x00F0

	)

51 
	#WORLD_SKU_PREFIX
 0x0060

	)

53 
	#CHANNEL_HALF_BW
 10

	)

54 
	#CHANNEL_QUARTER_BW
 5

	)

56 
	scou¡ry_code_to_íum_rd
 {

57 
u16
 
	mcou¡ryCode
;

58 
u16
 
	mªgDmnEnum
;

59 c⁄° *
	misoName
;

62 
	eCou¡ryCode
 {

63 
	mCTRY_ALBANIA
 = 8,

64 
	mCTRY_ALGERIA
 = 12,

65 
	mCTRY_ARGENTINA
 = 32,

66 
	mCTRY_ARMENIA
 = 51,

67 
	mCTRY_ARUBA
 = 533,

68 
	mCTRY_AUSTRALIA
 = 36,

69 
	mCTRY_AUSTRIA
 = 40,

70 
	mCTRY_AZERBAIJAN
 = 31,

71 
	mCTRY_BAHRAIN
 = 48,

72 
	mCTRY_BANGLADESH
 = 50,

73 
	mCTRY_BARBADOS
 = 52,

74 
	mCTRY_BELARUS
 = 112,

75 
	mCTRY_BELGIUM
 = 56,

76 
	mCTRY_BELIZE
 = 84,

77 
	mCTRY_BOLIVIA
 = 68,

78 
	mCTRY_BOSNIA_HERZ
 = 70,

79 
	mCTRY_BRAZIL
 = 76,

80 
	mCTRY_BRUNEI_DARUSSALAM
 = 96,

81 
	mCTRY_BULGARIA
 = 100,

82 
	mCTRY_CAMBODIA
 = 116,

83 
	mCTRY_CANADA
 = 124,

84 
	mCTRY_CHILE
 = 152,

85 
	mCTRY_CHINA
 = 156,

86 
	mCTRY_COLOMBIA
 = 170,

87 
	mCTRY_COSTA_RICA
 = 188,

88 
	mCTRY_CROATIA
 = 191,

89 
	mCTRY_CYPRUS
 = 196,

90 
	mCTRY_CZECH
 = 203,

91 
	mCTRY_DENMARK
 = 208,

92 
	mCTRY_DOMINICAN_REPUBLIC
 = 214,

93 
	mCTRY_ECUADOR
 = 218,

94 
	mCTRY_EGYPT
 = 818,

95 
	mCTRY_EL_SALVADOR
 = 222,

96 
	mCTRY_ESTONIA
 = 233,

97 
	mCTRY_FAEROE_ISLANDS
 = 234,

98 
	mCTRY_FINLAND
 = 246,

99 
	mCTRY_FRANCE
 = 250,

100 
	mCTRY_GEORGIA
 = 268,

101 
	mCTRY_GERMANY
 = 276,

102 
	mCTRY_GREECE
 = 300,

103 
	mCTRY_GREENLAND
 = 304,

104 
	mCTRY_GRENADA
 = 308,

105 
	mCTRY_GUAM
 = 316,

106 
	mCTRY_GUATEMALA
 = 320,

107 
	mCTRY_HAITI
 = 332,

108 
	mCTRY_HONDURAS
 = 340,

109 
	mCTRY_HONG_KONG
 = 344,

110 
	mCTRY_HUNGARY
 = 348,

111 
	mCTRY_ICELAND
 = 352,

112 
	mCTRY_INDIA
 = 356,

113 
	mCTRY_INDONESIA
 = 360,

114 
	mCTRY_IRAN
 = 364,

115 
	mCTRY_IRAQ
 = 368,

116 
	mCTRY_IRELAND
 = 372,

117 
	mCTRY_ISRAEL
 = 376,

118 
	mCTRY_ITALY
 = 380,

119 
	mCTRY_JAMAICA
 = 388,

120 
	mCTRY_JAPAN
 = 392,

121 
	mCTRY_JORDAN
 = 400,

122 
	mCTRY_KAZAKHSTAN
 = 398,

123 
	mCTRY_KENYA
 = 404,

124 
	mCTRY_KOREA_NORTH
 = 408,

125 
	mCTRY_KOREA_ROC
 = 410,

126 
	mCTRY_KOREA_ROC2
 = 411,

127 
	mCTRY_KOREA_ROC3
 = 412,

128 
	mCTRY_KUWAIT
 = 414,

129 
	mCTRY_LATVIA
 = 428,

130 
	mCTRY_LEBANON
 = 422,

131 
	mCTRY_LIBYA
 = 434,

132 
	mCTRY_LIECHTENSTEIN
 = 438,

133 
	mCTRY_LITHUANIA
 = 440,

134 
	mCTRY_LUXEMBOURG
 = 442,

135 
	mCTRY_MACAU
 = 446,

136 
	mCTRY_MACEDONIA
 = 807,

137 
	mCTRY_MALAYSIA
 = 458,

138 
	mCTRY_MALTA
 = 470,

139 
	mCTRY_MEXICO
 = 484,

140 
	mCTRY_MONACO
 = 492,

141 
	mCTRY_MOROCCO
 = 504,

142 
	mCTRY_NEPAL
 = 524,

143 
	mCTRY_NETHERLANDS
 = 528,

144 
	mCTRY_NETHERLANDS_ANTILLES
 = 530,

145 
	mCTRY_NEW_ZEALAND
 = 554,

146 
	mCTRY_NICARAGUA
 = 558,

147 
	mCTRY_NORWAY
 = 578,

148 
	mCTRY_OMAN
 = 512,

149 
	mCTRY_PAKISTAN
 = 586,

150 
	mCTRY_PANAMA
 = 591,

151 
	mCTRY_PAPUA_NEW_GUINEA
 = 598,

152 
	mCTRY_PARAGUAY
 = 600,

153 
	mCTRY_PERU
 = 604,

154 
	mCTRY_PHILIPPINES
 = 608,

155 
	mCTRY_POLAND
 = 616,

156 
	mCTRY_PORTUGAL
 = 620,

157 
	mCTRY_PUERTO_RICO
 = 630,

158 
	mCTRY_QATAR
 = 634,

159 
	mCTRY_ROMANIA
 = 642,

160 
	mCTRY_RUSSIA
 = 643,

161 
	mCTRY_SAUDI_ARABIA
 = 682,

162 
	mCTRY_SERBIA_MONTENEGRO
 = 891,

163 
	mCTRY_SINGAPORE
 = 702,

164 
	mCTRY_SLOVAKIA
 = 703,

165 
	mCTRY_SLOVENIA
 = 705,

166 
	mCTRY_SOUTH_AFRICA
 = 710,

167 
	mCTRY_SPAIN
 = 724,

168 
	mCTRY_SRI_LANKA
 = 144,

169 
	mCTRY_SWEDEN
 = 752,

170 
	mCTRY_SWITZERLAND
 = 756,

171 
	mCTRY_SYRIA
 = 760,

172 
	mCTRY_TAIWAN
 = 158,

173 
	mCTRY_THAILAND
 = 764,

174 
	mCTRY_TRINIDAD_Y_TOBAGO
 = 780,

175 
	mCTRY_TUNISIA
 = 788,

176 
	mCTRY_TURKEY
 = 792,

177 
	mCTRY_UAE
 = 784,

178 
	mCTRY_UKRAINE
 = 804,

179 
	mCTRY_UNITED_KINGDOM
 = 826,

180 
	mCTRY_UNITED_STATES
 = 840,

181 
	mCTRY_UNITED_STATES_FCC49
 = 842,

182 
	mCTRY_URUGUAY
 = 858,

183 
	mCTRY_UZBEKISTAN
 = 860,

184 
	mCTRY_VENEZUELA
 = 862,

185 
	mCTRY_VIET_NAM
 = 704,

186 
	mCTRY_YEMEN
 = 887,

187 
	mCTRY_ZIMBABWE
 = 716,

188 
	mCTRY_JAPAN1
 = 393,

189 
	mCTRY_JAPAN2
 = 394,

190 
	mCTRY_JAPAN3
 = 395,

191 
	mCTRY_JAPAN4
 = 396,

192 
	mCTRY_JAPAN5
 = 397,

193 
	mCTRY_JAPAN6
 = 4006,

194 
	mCTRY_JAPAN7
 = 4007,

195 
	mCTRY_JAPAN8
 = 4008,

196 
	mCTRY_JAPAN9
 = 4009,

197 
	mCTRY_JAPAN10
 = 4010,

198 
	mCTRY_JAPAN11
 = 4011,

199 
	mCTRY_JAPAN12
 = 4012,

200 
	mCTRY_JAPAN13
 = 4013,

201 
	mCTRY_JAPAN14
 = 4014,

202 
	mCTRY_JAPAN15
 = 4015,

203 
	mCTRY_JAPAN16
 = 4016,

204 
	mCTRY_JAPAN17
 = 4017,

205 
	mCTRY_JAPAN18
 = 4018,

206 
	mCTRY_JAPAN19
 = 4019,

207 
	mCTRY_JAPAN20
 = 4020,

208 
	mCTRY_JAPAN21
 = 4021,

209 
	mCTRY_JAPAN22
 = 4022,

210 
	mCTRY_JAPAN23
 = 4023,

211 
	mCTRY_JAPAN24
 = 4024,

212 
	mCTRY_JAPAN25
 = 4025,

213 
	mCTRY_JAPAN26
 = 4026,

214 
	mCTRY_JAPAN27
 = 4027,

215 
	mCTRY_JAPAN28
 = 4028,

216 
	mCTRY_JAPAN29
 = 4029,

217 
	mCTRY_JAPAN30
 = 4030,

218 
	mCTRY_JAPAN31
 = 4031,

219 
	mCTRY_JAPAN32
 = 4032,

220 
	mCTRY_JAPAN33
 = 4033,

221 
	mCTRY_JAPAN34
 = 4034,

222 
	mCTRY_JAPAN35
 = 4035,

223 
	mCTRY_JAPAN36
 = 4036,

224 
	mCTRY_JAPAN37
 = 4037,

225 
	mCTRY_JAPAN38
 = 4038,

226 
	mCTRY_JAPAN39
 = 4039,

227 
	mCTRY_JAPAN40
 = 4040,

228 
	mCTRY_JAPAN41
 = 4041,

229 
	mCTRY_JAPAN42
 = 4042,

230 
	mCTRY_JAPAN43
 = 4043,

231 
	mCTRY_JAPAN44
 = 4044,

232 
	mCTRY_JAPAN45
 = 4045,

233 
	mCTRY_JAPAN46
 = 4046,

234 
	mCTRY_JAPAN47
 = 4047,

235 
	mCTRY_JAPAN48
 = 4048,

236 
	mCTRY_JAPAN49
 = 4049,

237 
	mCTRY_JAPAN50
 = 4050,

238 
	mCTRY_JAPAN51
 = 4051,

239 
	mCTRY_JAPAN52
 = 4052,

240 
	mCTRY_JAPAN53
 = 4053,

241 
	mCTRY_JAPAN54
 = 4054,

242 
	mCTRY_JAPAN55
 = 4055,

243 
	mCTRY_JAPAN56
 = 4056,

244 
	mCTRY_JAPAN57
 = 4057,

245 
	mCTRY_JAPAN58
 = 4058,

246 
	mCTRY_JAPAN59
 = 4059,

247 
	mCTRY_AUSTRALIA2
 = 5000,

248 
	mCTRY_CANADA2
 = 5001,

249 
	mCTRY_BELGIUM2
 = 5002

252 
boﬁ
 
©h_is_w‹ld_ªgd
(
©h_ªguœt‹y
 *
ªg
);

253 
boﬁ
 
©h_is_49ghz_Ælowed
(
u16
 
ªdomaö
);

254 
©h_ªgd_öô
(
©h_ªguœt‹y
 *
ªg
, 
wùhy
 *wiphy,

255 (*
ªg_nŸifõr
)(
wùhy
 *wiphy,

256 
ªguœt‹y_ªque°
 *
ªque°
));

257 
u32
 
	`©h_ªgd_gë_b™d_˘l
(
©h_ªguœt‹y
 *
ªg
,

258 
õì80211_b™d
 
b™d
);

259 
	`©h_ªg_nŸifõr_≠∂y
(
wùhy
 *wiphy,

260 
ªguœt‹y_ªque°
 *
ªque°
,

261 
©h_ªguœt‹y
 *
ªg
);

	@../spectral_common.h

17 #i‚de‡
SPECTRAL_COMMON_H


18 
	#SPECTRAL_COMMON_H


	)

20 
	#SPECTRAL_HT20_NUM_BINS
 56

	)

21 
	#SPECTRAL_HT20_40_NUM_BINS
 128

	)

26 
	#SPECTRAL_ATH10K_MAX_NUM_BINS
 256

	)

36 
	e©h_f·_ßm∂e_ty≥
 {

37 
	mATH_FFT_SAMPLE_HT20
 = 1,

38 
	mATH_FFT_SAMPLE_HT20_40
,

39 
	mATH_FFT_SAMPLE_ATH10K
,

42 
	sf·_ßm∂e_év
 {

43 
u8
 
	mty≥
;

44 
__be16
 
	mÀngth
;

46 } 
	g__∑cked
;

48 
	sf·_ßm∂e_ht20
 {

49 
f·_ßm∂e_év
 
	mév
;

51 
u8
 
	mmax_exp
;

53 
__be16
 
	m‰eq
;

54 
s8
 
	mrssi
;

55 
s8
 
	mnoi£
;

57 
__be16
 
	mmax_magnôude
;

58 
u8
 
	mmax_ödex
;

59 
u8
 
	mbôm≠_weight
;

61 
__be64
 
	mtsf
;

63 
u8
 
	md©a
[
SPECTRAL_HT20_NUM_BINS
];

64 } 
	g__∑cked
;

66 
	sf·_ßm∂e_ht20_40
 {

67 
f·_ßm∂e_év
 
	mév
;

69 
u8
 
	mch™√l_ty≥
;

70 
__be16
 
	m‰eq
;

72 
s8
 
	mlowî_rssi
;

73 
s8
 
	muµî_rssi
;

75 
__be64
 
	mtsf
;

77 
s8
 
	mlowî_noi£
;

78 
s8
 
	muµî_noi£
;

80 
__be16
 
	mlowî_max_magnôude
;

81 
__be16
 
	muµî_max_magnôude
;

83 
u8
 
	mlowî_max_ödex
;

84 
u8
 
	muµî_max_ödex
;

86 
u8
 
	mlowî_bôm≠_weight
;

87 
u8
 
	muµî_bôm≠_weight
;

89 
u8
 
	mmax_exp
;

91 
u8
 
	md©a
[
SPECTRAL_HT20_40_NUM_BINS
];

92 } 
	g__∑cked
;

94 
	sf·_ßm∂e_©h10k
 {

95 
f·_ßm∂e_év
 
	mév
;

96 
u8
 
	mch™_width_mhz
;

97 
__be16
 
	m‰eq1
;

98 
__be16
 
	m‰eq2
;

99 
__be16
 
	mnoi£
;

100 
__be16
 
	mmax_magnôude
;

101 
__be16
 
	mtŸÆ_gaö_db
;

102 
__be16
 
	mba£_pwr_db
;

103 
__be64
 
	mtsf
;

104 
s8
 
	mmax_ödex
;

105 
u8
 
	mrssi
;

106 
u8
 
	mªÕwr_db
;

107 
u8
 
	mavgpwr_db
;

108 
u8
 
	mmax_exp
;

110 
u8
 
	md©a
[0];

111 } 
	g__∑cked
;

	@/usr/include/linux/if_ether.h

21 #i‚de‡
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<löux/ty≥s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_TSN
 0x22F0

	)

46 
	#ETH_P_IP
 0x0800

	)

47 
	#ETH_P_X25
 0x0805

	)

48 
	#ETH_P_ARP
 0x0806

	)

49 
	#ETH_P_BPQ
 0x08FF

	)

50 
	#ETH_P_IEEEPUP
 0x0a00

	)

51 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

52 
	#ETH_P_BATMAN
 0x4305

	)

53 
	#ETH_P_DEC
 0x6000

	)

54 
	#ETH_P_DNA_DL
 0x6001

	)

55 
	#ETH_P_DNA_RC
 0x6002

	)

56 
	#ETH_P_DNA_RT
 0x6003

	)

57 
	#ETH_P_LAT
 0x6004

	)

58 
	#ETH_P_DIAG
 0x6005

	)

59 
	#ETH_P_CUST
 0x6006

	)

60 
	#ETH_P_SCA
 0x6007

	)

61 
	#ETH_P_TEB
 0x6558

	)

62 
	#ETH_P_RARP
 0x8035

	)

63 
	#ETH_P_ATALK
 0x809B

	)

64 
	#ETH_P_AARP
 0x80F3

	)

65 
	#ETH_P_8021Q
 0x8100

	)

66 
	#ETH_P_IPX
 0x8137

	)

67 
	#ETH_P_IPV6
 0x86DD

	)

68 
	#ETH_P_PAUSE
 0x8808

	)

69 
	#ETH_P_SLOW
 0x8809

	)

70 
	#ETH_P_WCCP
 0x883E

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884¯

	)

75 
	#ETH_P_PPP_DISC
 0x8863

	)

76 
	#ETH_P_PPP_SES
 0x8864

	)

77 
	#ETH_P_LINK_CTL
 0x886¯

	)

78 
	#ETH_P_ATMFATE
 0x8884

	)

81 
	#ETH_P_PAE
 0x888E

	)

82 
	#ETH_P_AOE
 0x88A2

	)

83 
	#ETH_P_8021AD
 0x88A8

	)

84 
	#ETH_P_802_EX1
 0x88B5

	)

85 
	#ETH_P_TIPC
 0x88CA

	)

86 
	#ETH_P_8021AH
 0x88E7

	)

87 
	#ETH_P_MVRP
 0x88F5

	)

88 
	#ETH_P_1588
 0x88F7

	)

89 
	#ETH_P_PRP
 0x88FB

	)

90 
	#ETH_P_FCOE
 0x8906

	)

91 
	#ETH_P_TDLS
 0x890D

	)

92 
	#ETH_P_FIP
 0x8914

	)

93 
	#ETH_P_80221
 0x8917

	)

94 
	#ETH_P_LOOPBACK
 0x9000

	)

95 
	#ETH_P_QINQ1
 0x9100

	)

96 
	#ETH_P_QINQ2
 0x9200

	)

97 
	#ETH_P_QINQ3
 0x9300

	)

98 
	#ETH_P_EDSA
 0xDADA

	)

99 
	#ETH_P_AF_IUCV
 0xFBFB

	)

101 
	#ETH_P_802_3_MIN
 0x0600

	)

108 
	#ETH_P_802_3
 0x0001

	)

109 
	#ETH_P_AX25
 0x0002

	)

110 
	#ETH_P_ALL
 0x0003

	)

111 
	#ETH_P_802_2
 0x0004

	)

112 
	#ETH_P_SNAP
 0x0005

	)

113 
	#ETH_P_DDCMP
 0x0006

	)

114 
	#ETH_P_WAN_PPP
 0x0007

	)

115 
	#ETH_P_PPP_MP
 0x0008

	)

116 
	#ETH_P_LOCALTALK
 0x0009

	)

117 
	#ETH_P_CAN
 0x000C

	)

118 
	#ETH_P_CANFD
 0x000D

	)

119 
	#ETH_P_PPPTALK
 0x0010

	)

120 
	#ETH_P_TR_802_2
 0x0011

	)

121 
	#ETH_P_MOBITEX
 0x0015

	)

122 
	#ETH_P_CONTROL
 0x0016

	)

123 
	#ETH_P_IRDA
 0x0017

	)

124 
	#ETH_P_ECONET
 0x0018

	)

125 
	#ETH_P_HDLC
 0x0019

	)

126 
	#ETH_P_ARCNET
 0x001A

	)

127 
	#ETH_P_DSA
 0x001B

	)

128 
	#ETH_P_TRAILER
 0x001C

	)

129 
	#ETH_P_PHONET
 0x00F5

	)

130 
	#ETH_P_IEEE802154
 0x00F6

	)

131 
	#ETH_P_CAIF
 0x00F7

	)

132 
	#ETH_P_XDSA
 0x00F8

	)

138 
	sëhhdr
 {

139 
	mh_de°
[
ETH_ALEN
];

140 
	mh_sour˚
[
ETH_ALEN
];

141 
__be16
 
	mh_¥Ÿo
;

142 } 
__©åibuã__
((
∑cked
));

	@/usr/include/linux/kernel.h

1 #i‚de‡
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<löux/sysöfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`ty≥of
(x))◊Ë- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

	@/usr/include/linux/netdevice.h

25 #i‚de‡
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<löux/if.h
>

29 
	~<löux/if_ëhî.h
>

30 
	~<löux/if_∑ckë.h
>

31 
	~<löux/if_lök.h
>

34 
	#MAX_ADDR_LEN
 32

	)

37 
	#INIT_NETDEV_GROUP
 0

	)

41 
	#NET_NAME_UNKNOWN
 0

	)

42 
	#NET_NAME_ENUM
 1

	)

43 
	#NET_NAME_PREDICTABLE
 2

	)

44 
	#NET_NAME_USER
 3

	)

45 
	#NET_NAME_RENAMED
 4

	)

49 
	mIF_PORT_UNKNOWN
 = 0,

50 
	mIF_PORT_10BASE2
,

51 
	mIF_PORT_10BASET
,

52 
	mIF_PORT_AUI
,

53 
	mIF_PORT_100BASET
,

54 
	mIF_PORT_100BASETX
,

55 
	mIF_PORT_100BASEFX


59 
	#NET_ADDR_PERM
 0

	)

60 
	#NET_ADDR_RANDOM
 1

	)

61 
	#NET_ADDR_STOLEN
 2

	)

62 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/nl80211.h

1 #i‚de‡
__LINUX_NL80211_H


2 
	#__LINUX_NL80211_H


	)

42 
	~<löux/ty≥s.h
>

44 
	#NL80211_GENL_NAME
 "∆80211"

	)

46 
	#NL80211_MULTICAST_GROUP_CONFIG
 "c⁄fig"

	)

47 
	#NL80211_MULTICAST_GROUP_SCAN
 "sˇn"

	)

48 
	#NL80211_MULTICAST_GROUP_REG
 "ªguœt‹y"

	)

49 
	#NL80211_MULTICAST_GROUP_MLME
 "mlme"

	)

50 
	#NL80211_MULTICAST_GROUP_VENDOR
 "víd‹"

	)

51 
	#NL80211_MULTICAST_GROUP_TESTMODE
 "ã°mode"

	)

826 
	e∆80211_comm™ds
 {

828 
	mNL80211_CMD_UNSPEC
,

830 
	mNL80211_CMD_GET_WIPHY
,

831 
	mNL80211_CMD_SET_WIPHY
,

832 
	mNL80211_CMD_NEW_WIPHY
,

833 
	mNL80211_CMD_DEL_WIPHY
,

835 
	mNL80211_CMD_GET_INTERFACE
,

836 
	mNL80211_CMD_SET_INTERFACE
,

837 
	mNL80211_CMD_NEW_INTERFACE
,

838 
	mNL80211_CMD_DEL_INTERFACE
,

840 
	mNL80211_CMD_GET_KEY
,

841 
	mNL80211_CMD_SET_KEY
,

842 
	mNL80211_CMD_NEW_KEY
,

843 
	mNL80211_CMD_DEL_KEY
,

845 
	mNL80211_CMD_GET_BEACON
,

846 
	mNL80211_CMD_SET_BEACON
,

847 
	mNL80211_CMD_START_AP
,

848 
	mNL80211_CMD_NEW_BEACON
 = 
NL80211_CMD_START_AP
,

849 
	mNL80211_CMD_STOP_AP
,

850 
	mNL80211_CMD_DEL_BEACON
 = 
NL80211_CMD_STOP_AP
,

852 
	mNL80211_CMD_GET_STATION
,

853 
	mNL80211_CMD_SET_STATION
,

854 
	mNL80211_CMD_NEW_STATION
,

855 
	mNL80211_CMD_DEL_STATION
,

857 
	mNL80211_CMD_GET_MPATH
,

858 
	mNL80211_CMD_SET_MPATH
,

859 
	mNL80211_CMD_NEW_MPATH
,

860 
	mNL80211_CMD_DEL_MPATH
,

862 
	mNL80211_CMD_SET_BSS
,

864 
	mNL80211_CMD_SET_REG
,

865 
	mNL80211_CMD_REQ_SET_REG
,

867 
	mNL80211_CMD_GET_MESH_CONFIG
,

868 
	mNL80211_CMD_SET_MESH_CONFIG
,

870 
	mNL80211_CMD_SET_MGMT_EXTRA_IE
 ,

872 
	mNL80211_CMD_GET_REG
,

874 
	mNL80211_CMD_GET_SCAN
,

875 
	mNL80211_CMD_TRIGGER_SCAN
,

876 
	mNL80211_CMD_NEW_SCAN_RESULTS
,

877 
	mNL80211_CMD_SCAN_ABORTED
,

879 
	mNL80211_CMD_REG_CHANGE
,

881 
	mNL80211_CMD_AUTHENTICATE
,

882 
	mNL80211_CMD_ASSOCIATE
,

883 
	mNL80211_CMD_DEAUTHENTICATE
,

884 
	mNL80211_CMD_DISASSOCIATE
,

886 
	mNL80211_CMD_MICHAEL_MIC_FAILURE
,

888 
	mNL80211_CMD_REG_BEACON_HINT
,

890 
	mNL80211_CMD_JOIN_IBSS
,

891 
	mNL80211_CMD_LEAVE_IBSS
,

893 
	mNL80211_CMD_TESTMODE
,

895 
	mNL80211_CMD_CONNECT
,

896 
	mNL80211_CMD_ROAM
,

897 
	mNL80211_CMD_DISCONNECT
,

899 
	mNL80211_CMD_SET_WIPHY_NETNS
,

901 
	mNL80211_CMD_GET_SURVEY
,

902 
	mNL80211_CMD_NEW_SURVEY_RESULTS
,

904 
	mNL80211_CMD_SET_PMKSA
,

905 
	mNL80211_CMD_DEL_PMKSA
,

906 
	mNL80211_CMD_FLUSH_PMKSA
,

908 
	mNL80211_CMD_REMAIN_ON_CHANNEL
,

909 
	mNL80211_CMD_CANCEL_REMAIN_ON_CHANNEL
,

911 
	mNL80211_CMD_SET_TX_BITRATE_MASK
,

913 
	mNL80211_CMD_REGISTER_FRAME
,

914 
	mNL80211_CMD_REGISTER_ACTION
 = 
NL80211_CMD_REGISTER_FRAME
,

915 
	mNL80211_CMD_FRAME
,

916 
	mNL80211_CMD_ACTION
 = 
NL80211_CMD_FRAME
,

917 
	mNL80211_CMD_FRAME_TX_STATUS
,

918 
	mNL80211_CMD_ACTION_TX_STATUS
 = 
NL80211_CMD_FRAME_TX_STATUS
,

920 
	mNL80211_CMD_SET_POWER_SAVE
,

921 
	mNL80211_CMD_GET_POWER_SAVE
,

923 
	mNL80211_CMD_SET_CQM
,

924 
	mNL80211_CMD_NOTIFY_CQM
,

926 
	mNL80211_CMD_SET_CHANNEL
,

927 
	mNL80211_CMD_SET_WDS_PEER
,

929 
	mNL80211_CMD_FRAME_WAIT_CANCEL
,

931 
	mNL80211_CMD_JOIN_MESH
,

932 
	mNL80211_CMD_LEAVE_MESH
,

934 
	mNL80211_CMD_UNPROT_DEAUTHENTICATE
,

935 
	mNL80211_CMD_UNPROT_DISASSOCIATE
,

937 
	mNL80211_CMD_NEW_PEER_CANDIDATE
,

939 
	mNL80211_CMD_GET_WOWLAN
,

940 
	mNL80211_CMD_SET_WOWLAN
,

942 
	mNL80211_CMD_START_SCHED_SCAN
,

943 
	mNL80211_CMD_STOP_SCHED_SCAN
,

944 
	mNL80211_CMD_SCHED_SCAN_RESULTS
,

945 
	mNL80211_CMD_SCHED_SCAN_STOPPED
,

947 
	mNL80211_CMD_SET_REKEY_OFFLOAD
,

949 
	mNL80211_CMD_PMKSA_CANDIDATE
,

951 
	mNL80211_CMD_TDLS_OPER
,

952 
	mNL80211_CMD_TDLS_MGMT
,

954 
	mNL80211_CMD_UNEXPECTED_FRAME
,

956 
	mNL80211_CMD_PROBE_CLIENT
,

958 
	mNL80211_CMD_REGISTER_BEACONS
,

960 
	mNL80211_CMD_UNEXPECTED_4ADDR_FRAME
,

962 
	mNL80211_CMD_SET_NOACK_MAP
,

964 
	mNL80211_CMD_CH_SWITCH_NOTIFY
,

966 
	mNL80211_CMD_START_P2P_DEVICE
,

967 
	mNL80211_CMD_STOP_P2P_DEVICE
,

969 
	mNL80211_CMD_CONN_FAILED
,

971 
	mNL80211_CMD_SET_MCAST_RATE
,

973 
	mNL80211_CMD_SET_MAC_ACL
,

975 
	mNL80211_CMD_RADAR_DETECT
,

977 
	mNL80211_CMD_GET_PROTOCOL_FEATURES
,

979 
	mNL80211_CMD_UPDATE_FT_IES
,

980 
	mNL80211_CMD_FT_EVENT
,

982 
	mNL80211_CMD_CRIT_PROTOCOL_START
,

983 
	mNL80211_CMD_CRIT_PROTOCOL_STOP
,

985 
	mNL80211_CMD_GET_COALESCE
,

986 
	mNL80211_CMD_SET_COALESCE
,

988 
	mNL80211_CMD_CHANNEL_SWITCH
,

990 
	mNL80211_CMD_VENDOR
,

992 
	mNL80211_CMD_SET_QOS_MAP
,

994 
	mNL80211_CMD_ADD_TX_TS
,

995 
	mNL80211_CMD_DEL_TX_TS
,

997 
	mNL80211_CMD_GET_MPP
,

999 
	mNL80211_CMD_JOIN_OCB
,

1000 
	mNL80211_CMD_LEAVE_OCB
,

1002 
	mNL80211_CMD_CH_SWITCH_STARTED_NOTIFY
,

1004 
	mNL80211_CMD_TDLS_CHANNEL_SWITCH
,

1005 
	mNL80211_CMD_TDLS_CANCEL_CHANNEL_SWITCH
,

1007 
	mNL80211_CMD_WIPHY_REG_CHANGE
,

1012 
	m__NL80211_CMD_AFTER_LAST
,

1013 
	mNL80211_CMD_MAX
 = 
__NL80211_CMD_AFTER_LAST
 - 1

1020 
	#NL80211_CMD_SET_BSS
 
NL80211_CMD_SET_BSS


	)

1021 
	#NL80211_CMD_SET_MGMT_EXTRA_IE
 
NL80211_CMD_SET_MGMT_EXTRA_IE


	)

1022 
	#NL80211_CMD_REG_CHANGE
 
NL80211_CMD_REG_CHANGE


	)

1023 
	#NL80211_CMD_AUTHENTICATE
 
NL80211_CMD_AUTHENTICATE


	)

1024 
	#NL80211_CMD_ASSOCIATE
 
NL80211_CMD_ASSOCIATE


	)

1025 
	#NL80211_CMD_DEAUTHENTICATE
 
NL80211_CMD_DEAUTHENTICATE


	)

1026 
	#NL80211_CMD_DISASSOCIATE
 
NL80211_CMD_DISASSOCIATE


	)

1027 
	#NL80211_CMD_REG_BEACON_HINT
 
NL80211_CMD_REG_BEACON_HINT


	)

1029 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

1032 
	#NL80211_CMD_GET_MESH_PARAMS
 
NL80211_CMD_GET_MESH_CONFIG


	)

1033 
	#NL80211_CMD_SET_MESH_PARAMS
 
NL80211_CMD_SET_MESH_CONFIG


	)

1034 
	#NL80211_MESH_SETUP_VENDOR_PATH_SEL_IE
 
NL80211_MESH_SETUP_IE


	)

1790 
	e∆80211_©ås
 {

1792 
	mNL80211_ATTR_UNSPEC
,

1794 
	mNL80211_ATTR_WIPHY
,

1795 
	mNL80211_ATTR_WIPHY_NAME
,

1797 
	mNL80211_ATTR_IFINDEX
,

1798 
	mNL80211_ATTR_IFNAME
,

1799 
	mNL80211_ATTR_IFTYPE
,

1801 
	mNL80211_ATTR_MAC
,

1803 
	mNL80211_ATTR_KEY_DATA
,

1804 
	mNL80211_ATTR_KEY_IDX
,

1805 
	mNL80211_ATTR_KEY_CIPHER
,

1806 
	mNL80211_ATTR_KEY_SEQ
,

1807 
	mNL80211_ATTR_KEY_DEFAULT
,

1809 
	mNL80211_ATTR_BEACON_INTERVAL
,

1810 
	mNL80211_ATTR_DTIM_PERIOD
,

1811 
	mNL80211_ATTR_BEACON_HEAD
,

1812 
	mNL80211_ATTR_BEACON_TAIL
,

1814 
	mNL80211_ATTR_STA_AID
,

1815 
	mNL80211_ATTR_STA_FLAGS
,

1816 
	mNL80211_ATTR_STA_LISTEN_INTERVAL
,

1817 
	mNL80211_ATTR_STA_SUPPORTED_RATES
,

1818 
	mNL80211_ATTR_STA_VLAN
,

1819 
	mNL80211_ATTR_STA_INFO
,

1821 
	mNL80211_ATTR_WIPHY_BANDS
,

1823 
	mNL80211_ATTR_MNTR_FLAGS
,

1825 
	mNL80211_ATTR_MESH_ID
,

1826 
	mNL80211_ATTR_STA_PLINK_ACTION
,

1827 
	mNL80211_ATTR_MPATH_NEXT_HOP
,

1828 
	mNL80211_ATTR_MPATH_INFO
,

1830 
	mNL80211_ATTR_BSS_CTS_PROT
,

1831 
	mNL80211_ATTR_BSS_SHORT_PREAMBLE
,

1832 
	mNL80211_ATTR_BSS_SHORT_SLOT_TIME
,

1834 
	mNL80211_ATTR_HT_CAPABILITY
,

1836 
	mNL80211_ATTR_SUPPORTED_IFTYPES
,

1838 
	mNL80211_ATTR_REG_ALPHA2
,

1839 
	mNL80211_ATTR_REG_RULES
,

1841 
	mNL80211_ATTR_MESH_CONFIG
,

1843 
	mNL80211_ATTR_BSS_BASIC_RATES
,

1845 
	mNL80211_ATTR_WIPHY_TXQ_PARAMS
,

1846 
	mNL80211_ATTR_WIPHY_FREQ
,

1847 
	mNL80211_ATTR_WIPHY_CHANNEL_TYPE
,

1849 
	mNL80211_ATTR_KEY_DEFAULT_MGMT
,

1851 
	mNL80211_ATTR_MGMT_SUBTYPE
,

1852 
	mNL80211_ATTR_IE
,

1854 
	mNL80211_ATTR_MAX_NUM_SCAN_SSIDS
,

1856 
	mNL80211_ATTR_SCAN_FREQUENCIES
,

1857 
	mNL80211_ATTR_SCAN_SSIDS
,

1858 
	mNL80211_ATTR_GENERATION
,

1859 
	mNL80211_ATTR_BSS
,

1861 
	mNL80211_ATTR_REG_INITIATOR
,

1862 
	mNL80211_ATTR_REG_TYPE
,

1864 
	mNL80211_ATTR_SUPPORTED_COMMANDS
,

1866 
	mNL80211_ATTR_FRAME
,

1867 
	mNL80211_ATTR_SSID
,

1868 
	mNL80211_ATTR_AUTH_TYPE
,

1869 
	mNL80211_ATTR_REASON_CODE
,

1871 
	mNL80211_ATTR_KEY_TYPE
,

1873 
	mNL80211_ATTR_MAX_SCAN_IE_LEN
,

1874 
	mNL80211_ATTR_CIPHER_SUITES
,

1876 
	mNL80211_ATTR_FREQ_BEFORE
,

1877 
	mNL80211_ATTR_FREQ_AFTER
,

1879 
	mNL80211_ATTR_FREQ_FIXED
,

1882 
	mNL80211_ATTR_WIPHY_RETRY_SHORT
,

1883 
	mNL80211_ATTR_WIPHY_RETRY_LONG
,

1884 
	mNL80211_ATTR_WIPHY_FRAG_THRESHOLD
,

1885 
	mNL80211_ATTR_WIPHY_RTS_THRESHOLD
,

1887 
	mNL80211_ATTR_TIMED_OUT
,

1889 
	mNL80211_ATTR_USE_MFP
,

1891 
	mNL80211_ATTR_STA_FLAGS2
,

1893 
	mNL80211_ATTR_CONTROL_PORT
,

1895 
	mNL80211_ATTR_TESTDATA
,

1897 
	mNL80211_ATTR_PRIVACY
,

1899 
	mNL80211_ATTR_DISCONNECTED_BY_AP
,

1900 
	mNL80211_ATTR_STATUS_CODE
,

1902 
	mNL80211_ATTR_CIPHER_SUITES_PAIRWISE
,

1903 
	mNL80211_ATTR_CIPHER_SUITE_GROUP
,

1904 
	mNL80211_ATTR_WPA_VERSIONS
,

1905 
	mNL80211_ATTR_AKM_SUITES
,

1907 
	mNL80211_ATTR_REQ_IE
,

1908 
	mNL80211_ATTR_RESP_IE
,

1910 
	mNL80211_ATTR_PREV_BSSID
,

1912 
	mNL80211_ATTR_KEY
,

1913 
	mNL80211_ATTR_KEYS
,

1915 
	mNL80211_ATTR_PID
,

1917 
	mNL80211_ATTR_4ADDR
,

1919 
	mNL80211_ATTR_SURVEY_INFO
,

1921 
	mNL80211_ATTR_PMKID
,

1922 
	mNL80211_ATTR_MAX_NUM_PMKIDS
,

1924 
	mNL80211_ATTR_DURATION
,

1926 
	mNL80211_ATTR_COOKIE
,

1928 
	mNL80211_ATTR_WIPHY_COVERAGE_CLASS
,

1930 
	mNL80211_ATTR_TX_RATES
,

1932 
	mNL80211_ATTR_FRAME_MATCH
,

1934 
	mNL80211_ATTR_ACK
,

1936 
	mNL80211_ATTR_PS_STATE
,

1938 
	mNL80211_ATTR_CQM
,

1940 
	mNL80211_ATTR_LOCAL_STATE_CHANGE
,

1942 
	mNL80211_ATTR_AP_ISOLATE
,

1944 
	mNL80211_ATTR_WIPHY_TX_POWER_SETTING
,

1945 
	mNL80211_ATTR_WIPHY_TX_POWER_LEVEL
,

1947 
	mNL80211_ATTR_TX_FRAME_TYPES
,

1948 
	mNL80211_ATTR_RX_FRAME_TYPES
,

1949 
	mNL80211_ATTR_FRAME_TYPE
,

1951 
	mNL80211_ATTR_CONTROL_PORT_ETHERTYPE
,

1952 
	mNL80211_ATTR_CONTROL_PORT_NO_ENCRYPT
,

1954 
	mNL80211_ATTR_SUPPORT_IBSS_RSN
,

1956 
	mNL80211_ATTR_WIPHY_ANTENNA_TX
,

1957 
	mNL80211_ATTR_WIPHY_ANTENNA_RX
,

1959 
	mNL80211_ATTR_MCAST_RATE
,

1961 
	mNL80211_ATTR_OFFCHANNEL_TX_OK
,

1963 
	mNL80211_ATTR_BSS_HT_OPMODE
,

1965 
	mNL80211_ATTR_KEY_DEFAULT_TYPES
,

1967 
	mNL80211_ATTR_MAX_REMAIN_ON_CHANNEL_DURATION
,

1969 
	mNL80211_ATTR_MESH_SETUP
,

1971 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_TX
,

1972 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_RX
,

1974 
	mNL80211_ATTR_SUPPORT_MESH_AUTH
,

1975 
	mNL80211_ATTR_STA_PLINK_STATE
,

1977 
	mNL80211_ATTR_WOWLAN_TRIGGERS
,

1978 
	mNL80211_ATTR_WOWLAN_TRIGGERS_SUPPORTED
,

1980 
	mNL80211_ATTR_SCHED_SCAN_INTERVAL
,

1982 
	mNL80211_ATTR_INTERFACE_COMBINATIONS
,

1983 
	mNL80211_ATTR_SOFTWARE_IFTYPES
,

1985 
	mNL80211_ATTR_REKEY_DATA
,

1987 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_SSIDS
,

1988 
	mNL80211_ATTR_MAX_SCHED_SCAN_IE_LEN
,

1990 
	mNL80211_ATTR_SCAN_SUPP_RATES
,

1992 
	mNL80211_ATTR_HIDDEN_SSID
,

1994 
	mNL80211_ATTR_IE_PROBE_RESP
,

1995 
	mNL80211_ATTR_IE_ASSOC_RESP
,

1997 
	mNL80211_ATTR_STA_WME
,

1998 
	mNL80211_ATTR_SUPPORT_AP_UAPSD
,

2000 
	mNL80211_ATTR_ROAM_SUPPORT
,

2002 
	mNL80211_ATTR_SCHED_SCAN_MATCH
,

2003 
	mNL80211_ATTR_MAX_MATCH_SETS
,

2005 
	mNL80211_ATTR_PMKSA_CANDIDATE
,

2007 
	mNL80211_ATTR_TX_NO_CCK_RATE
,

2009 
	mNL80211_ATTR_TDLS_ACTION
,

2010 
	mNL80211_ATTR_TDLS_DIALOG_TOKEN
,

2011 
	mNL80211_ATTR_TDLS_OPERATION
,

2012 
	mNL80211_ATTR_TDLS_SUPPORT
,

2013 
	mNL80211_ATTR_TDLS_EXTERNAL_SETUP
,

2015 
	mNL80211_ATTR_DEVICE_AP_SME
,

2017 
	mNL80211_ATTR_DONT_WAIT_FOR_ACK
,

2019 
	mNL80211_ATTR_FEATURE_FLAGS
,

2021 
	mNL80211_ATTR_PROBE_RESP_OFFLOAD
,

2023 
	mNL80211_ATTR_PROBE_RESP
,

2025 
	mNL80211_ATTR_DFS_REGION
,

2027 
	mNL80211_ATTR_DISABLE_HT
,

2028 
	mNL80211_ATTR_HT_CAPABILITY_MASK
,

2030 
	mNL80211_ATTR_NOACK_MAP
,

2032 
	mNL80211_ATTR_INACTIVITY_TIMEOUT
,

2034 
	mNL80211_ATTR_RX_SIGNAL_DBM
,

2036 
	mNL80211_ATTR_BG_SCAN_PERIOD
,

2038 
	mNL80211_ATTR_WDEV
,

2040 
	mNL80211_ATTR_USER_REG_HINT_TYPE
,

2042 
	mNL80211_ATTR_CONN_FAILED_REASON
,

2044 
	mNL80211_ATTR_SAE_DATA
,

2046 
	mNL80211_ATTR_VHT_CAPABILITY
,

2048 
	mNL80211_ATTR_SCAN_FLAGS
,

2050 
	mNL80211_ATTR_CHANNEL_WIDTH
,

2051 
	mNL80211_ATTR_CENTER_FREQ1
,

2052 
	mNL80211_ATTR_CENTER_FREQ2
,

2054 
	mNL80211_ATTR_P2P_CTWINDOW
,

2055 
	mNL80211_ATTR_P2P_OPPPS
,

2057 
	mNL80211_ATTR_LOCAL_MESH_POWER_MODE
,

2059 
	mNL80211_ATTR_ACL_POLICY
,

2061 
	mNL80211_ATTR_MAC_ADDRS
,

2063 
	mNL80211_ATTR_MAC_ACL_MAX
,

2065 
	mNL80211_ATTR_RADAR_EVENT
,

2067 
	mNL80211_ATTR_EXT_CAPA
,

2068 
	mNL80211_ATTR_EXT_CAPA_MASK
,

2070 
	mNL80211_ATTR_STA_CAPABILITY
,

2071 
	mNL80211_ATTR_STA_EXT_CAPABILITY
,

2073 
	mNL80211_ATTR_PROTOCOL_FEATURES
,

2074 
	mNL80211_ATTR_SPLIT_WIPHY_DUMP
,

2076 
	mNL80211_ATTR_DISABLE_VHT
,

2077 
	mNL80211_ATTR_VHT_CAPABILITY_MASK
,

2079 
	mNL80211_ATTR_MDID
,

2080 
	mNL80211_ATTR_IE_RIC
,

2082 
	mNL80211_ATTR_CRIT_PROT_ID
,

2083 
	mNL80211_ATTR_MAX_CRIT_PROT_DURATION
,

2085 
	mNL80211_ATTR_PEER_AID
,

2087 
	mNL80211_ATTR_COALESCE_RULE
,

2089 
	mNL80211_ATTR_CH_SWITCH_COUNT
,

2090 
	mNL80211_ATTR_CH_SWITCH_BLOCK_TX
,

2091 
	mNL80211_ATTR_CSA_IES
,

2092 
	mNL80211_ATTR_CSA_C_OFF_BEACON
,

2093 
	mNL80211_ATTR_CSA_C_OFF_PRESP
,

2095 
	mNL80211_ATTR_RXMGMT_FLAGS
,

2097 
	mNL80211_ATTR_STA_SUPPORTED_CHANNELS
,

2099 
	mNL80211_ATTR_STA_SUPPORTED_OPER_CLASSES
,

2101 
	mNL80211_ATTR_HANDLE_DFS
,

2103 
	mNL80211_ATTR_SUPPORT_5_MHZ
,

2104 
	mNL80211_ATTR_SUPPORT_10_MHZ
,

2106 
	mNL80211_ATTR_OPMODE_NOTIF
,

2108 
	mNL80211_ATTR_VENDOR_ID
,

2109 
	mNL80211_ATTR_VENDOR_SUBCMD
,

2110 
	mNL80211_ATTR_VENDOR_DATA
,

2111 
	mNL80211_ATTR_VENDOR_EVENTS
,

2113 
	mNL80211_ATTR_QOS_MAP
,

2115 
	mNL80211_ATTR_MAC_HINT
,

2116 
	mNL80211_ATTR_WIPHY_FREQ_HINT
,

2118 
	mNL80211_ATTR_MAX_AP_ASSOC_STA
,

2120 
	mNL80211_ATTR_TDLS_PEER_CAPABILITY
,

2122 
	mNL80211_ATTR_SOCKET_OWNER
,

2124 
	mNL80211_ATTR_CSA_C_OFFSETS_TX
,

2125 
	mNL80211_ATTR_MAX_CSA_COUNTERS
,

2127 
	mNL80211_ATTR_TDLS_INITIATOR
,

2129 
	mNL80211_ATTR_USE_RRM
,

2131 
	mNL80211_ATTR_WIPHY_DYN_ACK
,

2133 
	mNL80211_ATTR_TSID
,

2134 
	mNL80211_ATTR_USER_PRIO
,

2135 
	mNL80211_ATTR_ADMITTED_TIME
,

2137 
	mNL80211_ATTR_SMPS_MODE
,

2139 
	mNL80211_ATTR_OPER_CLASS
,

2141 
	mNL80211_ATTR_MAC_MASK
,

2143 
	mNL80211_ATTR_WIPHY_SELF_MANAGED_REG
,

2145 
	mNL80211_ATTR_EXT_FEATURES
,

2147 
	mNL80211_ATTR_SURVEY_RADIO_STATS
,

2149 
	mNL80211_ATTR_NETNS_FD
,

2151 
	mNL80211_ATTR_SCHED_SCAN_DELAY
,

2153 
	mNL80211_ATTR_REG_INDOOR
,

2155 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_PLANS
,

2156 
	mNL80211_ATTR_MAX_SCAN_PLAN_INTERVAL
,

2157 
	mNL80211_ATTR_MAX_SCAN_PLAN_ITERATIONS
,

2158 
	mNL80211_ATTR_SCHED_SCAN_PLANS
,

2162 
	m__NL80211_ATTR_AFTER_LAST
,

2163 
	mNUM_NL80211_ATTR
 = 
__NL80211_ATTR_AFTER_LAST
,

2164 
	mNL80211_ATTR_MAX
 = 
__NL80211_ATTR_AFTER_LAST
 - 1

2168 
	#NL80211_ATTR_SCAN_GENERATION
 
NL80211_ATTR_GENERATION


	)

2169 
	#NL80211_ATTR_MESH_PARAMS
 
NL80211_ATTR_MESH_CONFIG


	)

2170 
	#NL80211_ATTR_IFACE_SOCKET_OWNER
 
NL80211_ATTR_SOCKET_OWNER


	)

2176 
	#NL80211_CMD_CONNECT
 
NL80211_CMD_CONNECT


	)

2177 
	#NL80211_ATTR_HT_CAPABILITY
 
NL80211_ATTR_HT_CAPABILITY


	)

2178 
	#NL80211_ATTR_BSS_BASIC_RATES
 
NL80211_ATTR_BSS_BASIC_RATES


	)

2179 
	#NL80211_ATTR_WIPHY_TXQ_PARAMS
 
NL80211_ATTR_WIPHY_TXQ_PARAMS


	)

2180 
	#NL80211_ATTR_WIPHY_FREQ
 
NL80211_ATTR_WIPHY_FREQ


	)

2181 
	#NL80211_ATTR_WIPHY_CHANNEL_TYPE
 
NL80211_ATTR_WIPHY_CHANNEL_TYPE


	)

2182 
	#NL80211_ATTR_MGMT_SUBTYPE
 
NL80211_ATTR_MGMT_SUBTYPE


	)

2183 
	#NL80211_ATTR_IE
 
NL80211_ATTR_IE


	)

2184 
	#NL80211_ATTR_REG_INITIATOR
 
NL80211_ATTR_REG_INITIATOR


	)

2185 
	#NL80211_ATTR_REG_TYPE
 
NL80211_ATTR_REG_TYPE


	)

2186 
	#NL80211_ATTR_FRAME
 
NL80211_ATTR_FRAME


	)

2187 
	#NL80211_ATTR_SSID
 
NL80211_ATTR_SSID


	)

2188 
	#NL80211_ATTR_AUTH_TYPE
 
NL80211_ATTR_AUTH_TYPE


	)

2189 
	#NL80211_ATTR_REASON_CODE
 
NL80211_ATTR_REASON_CODE


	)

2190 
	#NL80211_ATTR_CIPHER_SUITES_PAIRWISE
 
NL80211_ATTR_CIPHER_SUITES_PAIRWISE


	)

2191 
	#NL80211_ATTR_CIPHER_SUITE_GROUP
 
NL80211_ATTR_CIPHER_SUITE_GROUP


	)

2192 
	#NL80211_ATTR_WPA_VERSIONS
 
NL80211_ATTR_WPA_VERSIONS


	)

2193 
	#NL80211_ATTR_AKM_SUITES
 
NL80211_ATTR_AKM_SUITES


	)

2194 
	#NL80211_ATTR_KEY
 
NL80211_ATTR_KEY


	)

2195 
	#NL80211_ATTR_KEYS
 
NL80211_ATTR_KEYS


	)

2196 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

2198 
	#NL80211_MAX_SUPP_RATES
 32

	)

2199 
	#NL80211_MAX_SUPP_HT_RATES
 77

	)

2200 
	#NL80211_MAX_SUPP_REG_RULES
 64

	)

2201 
	#NL80211_TKIP_DATA_OFFSET_ENCR_KEY
 0

	)

2202 
	#NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
 16

	)

2203 
	#NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 24

	)

2204 
	#NL80211_HT_CAPABILITY_LEN
 26

	)

2205 
	#NL80211_VHT_CAPABILITY_LEN
 12

	)

2207 
	#NL80211_MAX_NR_CIPHER_SUITES
 5

	)

2208 
	#NL80211_MAX_NR_AKM_SUITES
 2

	)

2210 
	#NL80211_MIN_REMAIN_ON_CHANNEL_TIME
 10

	)

2213 
	#NL80211_SCAN_RSSI_THOLD_OFF
 -300

	)

2215 
	#NL80211_CQM_TXE_MAX_INTVL
 1800

	)

2245 
	e∆80211_i·y≥
 {

2246 
	mNL80211_IFTYPE_UNSPECIFIED
,

2247 
	mNL80211_IFTYPE_ADHOC
,

2248 
	mNL80211_IFTYPE_STATION
,

2249 
	mNL80211_IFTYPE_AP
,

2250 
	mNL80211_IFTYPE_AP_VLAN
,

2251 
	mNL80211_IFTYPE_WDS
,

2252 
	mNL80211_IFTYPE_MONITOR
,

2253 
	mNL80211_IFTYPE_MESH_POINT
,

2254 
	mNL80211_IFTYPE_P2P_CLIENT
,

2255 
	mNL80211_IFTYPE_P2P_GO
,

2256 
	mNL80211_IFTYPE_P2P_DEVICE
,

2257 
	mNL80211_IFTYPE_OCB
,

2260 
	mNUM_NL80211_IFTYPES
,

2261 
	mNL80211_IFTYPE_MAX
 = 
NUM_NL80211_IFTYPES
 - 1

2288 
	e∆80211_°a_Êags
 {

2289 
	m__NL80211_STA_FLAG_INVALID
,

2290 
	mNL80211_STA_FLAG_AUTHORIZED
,

2291 
	mNL80211_STA_FLAG_SHORT_PREAMBLE
,

2292 
	mNL80211_STA_FLAG_WME
,

2293 
	mNL80211_STA_FLAG_MFP
,

2294 
	mNL80211_STA_FLAG_AUTHENTICATED
,

2295 
	mNL80211_STA_FLAG_TDLS_PEER
,

2296 
	mNL80211_STA_FLAG_ASSOCIATED
,

2299 
	m__NL80211_STA_FLAG_AFTER_LAST
,

2300 
	mNL80211_STA_FLAG_MAX
 = 
__NL80211_STA_FLAG_AFTER_LAST
 - 1

2303 
	#NL80211_STA_FLAG_MAX_OLD_API
 
NL80211_STA_FLAG_TDLS_PEER


	)

2312 
	s∆80211_°a_Êag_upd©e
 {

2313 
__u32
 
	mmask
;

2314 
__u32
 
	m£t
;

2315 } 
__©åibuã__
((
∑cked
));

2351 
	e∆80211_øã_öfo
 {

2352 
	m__NL80211_RATE_INFO_INVALID
,

2353 
	mNL80211_RATE_INFO_BITRATE
,

2354 
	mNL80211_RATE_INFO_MCS
,

2355 
	mNL80211_RATE_INFO_40_MHZ_WIDTH
,

2356 
	mNL80211_RATE_INFO_SHORT_GI
,

2357 
	mNL80211_RATE_INFO_BITRATE32
,

2358 
	mNL80211_RATE_INFO_VHT_MCS
,

2359 
	mNL80211_RATE_INFO_VHT_NSS
,

2360 
	mNL80211_RATE_INFO_80_MHZ_WIDTH
,

2361 
	mNL80211_RATE_INFO_80P80_MHZ_WIDTH
,

2362 
	mNL80211_RATE_INFO_160_MHZ_WIDTH
,

2363 
	mNL80211_RATE_INFO_10_MHZ_WIDTH
,

2364 
	mNL80211_RATE_INFO_5_MHZ_WIDTH
,

2367 
	m__NL80211_RATE_INFO_AFTER_LAST
,

2368 
	mNL80211_RATE_INFO_MAX
 = 
__NL80211_RATE_INFO_AFTER_LAST
 - 1

2388 
	e∆80211_°a_bss_∑øm
 {

2389 
	m__NL80211_STA_BSS_PARAM_INVALID
,

2390 
	mNL80211_STA_BSS_PARAM_CTS_PROT
,

2391 
	mNL80211_STA_BSS_PARAM_SHORT_PREAMBLE
,

2392 
	mNL80211_STA_BSS_PARAM_SHORT_SLOT_TIME
,

2393 
	mNL80211_STA_BSS_PARAM_DTIM_PERIOD
,

2394 
	mNL80211_STA_BSS_PARAM_BEACON_INTERVAL
,

2397 
	m__NL80211_STA_BSS_PARAM_AFTER_LAST
,

2398 
	mNL80211_STA_BSS_PARAM_MAX
 = 
__NL80211_STA_BSS_PARAM_AFTER_LAST
 - 1

2463 
	e∆80211_°a_öfo
 {

2464 
	m__NL80211_STA_INFO_INVALID
,

2465 
	mNL80211_STA_INFO_INACTIVE_TIME
,

2466 
	mNL80211_STA_INFO_RX_BYTES
,

2467 
	mNL80211_STA_INFO_TX_BYTES
,

2468 
	mNL80211_STA_INFO_LLID
,

2469 
	mNL80211_STA_INFO_PLID
,

2470 
	mNL80211_STA_INFO_PLINK_STATE
,

2471 
	mNL80211_STA_INFO_SIGNAL
,

2472 
	mNL80211_STA_INFO_TX_BITRATE
,

2473 
	mNL80211_STA_INFO_RX_PACKETS
,

2474 
	mNL80211_STA_INFO_TX_PACKETS
,

2475 
	mNL80211_STA_INFO_TX_RETRIES
,

2476 
	mNL80211_STA_INFO_TX_FAILED
,

2477 
	mNL80211_STA_INFO_SIGNAL_AVG
,

2478 
	mNL80211_STA_INFO_RX_BITRATE
,

2479 
	mNL80211_STA_INFO_BSS_PARAM
,

2480 
	mNL80211_STA_INFO_CONNECTED_TIME
,

2481 
	mNL80211_STA_INFO_STA_FLAGS
,

2482 
	mNL80211_STA_INFO_BEACON_LOSS
,

2483 
	mNL80211_STA_INFO_T_OFFSET
,

2484 
	mNL80211_STA_INFO_LOCAL_PM
,

2485 
	mNL80211_STA_INFO_PEER_PM
,

2486 
	mNL80211_STA_INFO_NONPEER_PM
,

2487 
	mNL80211_STA_INFO_RX_BYTES64
,

2488 
	mNL80211_STA_INFO_TX_BYTES64
,

2489 
	mNL80211_STA_INFO_CHAIN_SIGNAL
,

2490 
	mNL80211_STA_INFO_CHAIN_SIGNAL_AVG
,

2491 
	mNL80211_STA_INFO_EXPECTED_THROUGHPUT
,

2492 
	mNL80211_STA_INFO_RX_DROP_MISC
,

2493 
	mNL80211_STA_INFO_BEACON_RX
,

2494 
	mNL80211_STA_INFO_BEACON_SIGNAL_AVG
,

2495 
	mNL80211_STA_INFO_TID_STATS
,

2498 
	m__NL80211_STA_INFO_AFTER_LAST
,

2499 
	mNL80211_STA_INFO_MAX
 = 
__NL80211_STA_INFO_AFTER_LAST
 - 1

2515 
	e∆80211_tid_°©s
 {

2516 
	m__NL80211_TID_STATS_INVALID
,

2517 
	mNL80211_TID_STATS_RX_MSDU
,

2518 
	mNL80211_TID_STATS_TX_MSDU
,

2519 
	mNL80211_TID_STATS_TX_MSDU_RETRIES
,

2520 
	mNL80211_TID_STATS_TX_MSDU_FAILED
,

2523 
	mNUM_NL80211_TID_STATS
,

2524 
	mNL80211_TID_STATS_MAX
 = 
NUM_NL80211_TID_STATS
 - 1

2536 
	e∆80211_m∑th_Êags
 {

2537 
	mNL80211_MPATH_FLAG_ACTIVE
 = 1<<0,

2538 
	mNL80211_MPATH_FLAG_RESOLVING
 = 1<<1,

2539 
	mNL80211_MPATH_FLAG_SN_VALID
 = 1<<2,

2540 
	mNL80211_MPATH_FLAG_FIXED
 = 1<<3,

2541 
	mNL80211_MPATH_FLAG_RESOLVED
 = 1<<4,

2563 
	e∆80211_m∑th_öfo
 {

2564 
	m__NL80211_MPATH_INFO_INVALID
,

2565 
	mNL80211_MPATH_INFO_FRAME_QLEN
,

2566 
	mNL80211_MPATH_INFO_SN
,

2567 
	mNL80211_MPATH_INFO_METRIC
,

2568 
	mNL80211_MPATH_INFO_EXPTIME
,

2569 
	mNL80211_MPATH_INFO_FLAGS
,

2570 
	mNL80211_MPATH_INFO_DISCOVERY_TIMEOUT
,

2571 
	mNL80211_MPATH_INFO_DISCOVERY_RETRIES
,

2574 
	m__NL80211_MPATH_INFO_AFTER_LAST
,

2575 
	mNL80211_MPATH_INFO_MAX
 = 
__NL80211_MPATH_INFO_AFTER_LAST
 - 1

2596 
	e∆80211_b™d_©å
 {

2597 
	m__NL80211_BAND_ATTR_INVALID
,

2598 
	mNL80211_BAND_ATTR_FREQS
,

2599 
	mNL80211_BAND_ATTR_RATES
,

2601 
	mNL80211_BAND_ATTR_HT_MCS_SET
,

2602 
	mNL80211_BAND_ATTR_HT_CAPA
,

2603 
	mNL80211_BAND_ATTR_HT_AMPDU_FACTOR
,

2604 
	mNL80211_BAND_ATTR_HT_AMPDU_DENSITY
,

2606 
	mNL80211_BAND_ATTR_VHT_MCS_SET
,

2607 
	mNL80211_BAND_ATTR_VHT_CAPA
,

2610 
	m__NL80211_BAND_ATTR_AFTER_LAST
,

2611 
	mNL80211_BAND_ATTR_MAX
 = 
__NL80211_BAND_ATTR_AFTER_LAST
 - 1

2614 
	#NL80211_BAND_ATTR_HT_CAPA
 
NL80211_BAND_ATTR_HT_CAPA


	)

2674 
	e∆80211_‰equícy_©å
 {

2675 
	m__NL80211_FREQUENCY_ATTR_INVALID
,

2676 
	mNL80211_FREQUENCY_ATTR_FREQ
,

2677 
	mNL80211_FREQUENCY_ATTR_DISABLED
,

2678 
	mNL80211_FREQUENCY_ATTR_NO_IR
,

2679 
	m__NL80211_FREQUENCY_ATTR_NO_IBSS
,

2680 
	mNL80211_FREQUENCY_ATTR_RADAR
,

2681 
	mNL80211_FREQUENCY_ATTR_MAX_TX_POWER
,

2682 
	mNL80211_FREQUENCY_ATTR_DFS_STATE
,

2683 
	mNL80211_FREQUENCY_ATTR_DFS_TIME
,

2684 
	mNL80211_FREQUENCY_ATTR_NO_HT40_MINUS
,

2685 
	mNL80211_FREQUENCY_ATTR_NO_HT40_PLUS
,

2686 
	mNL80211_FREQUENCY_ATTR_NO_80MHZ
,

2687 
	mNL80211_FREQUENCY_ATTR_NO_160MHZ
,

2688 
	mNL80211_FREQUENCY_ATTR_DFS_CAC_TIME
,

2689 
	mNL80211_FREQUENCY_ATTR_INDOOR_ONLY
,

2690 
	mNL80211_FREQUENCY_ATTR_IR_CONCURRENT
,

2691 
	mNL80211_FREQUENCY_ATTR_NO_20MHZ
,

2692 
	mNL80211_FREQUENCY_ATTR_NO_10MHZ
,

2695 
	m__NL80211_FREQUENCY_ATTR_AFTER_LAST
,

2696 
	mNL80211_FREQUENCY_ATTR_MAX
 = 
__NL80211_FREQUENCY_ATTR_AFTER_LAST
 - 1

2699 
	#NL80211_FREQUENCY_ATTR_MAX_TX_POWER
 
NL80211_FREQUENCY_ATTR_MAX_TX_POWER


	)

2700 
	#NL80211_FREQUENCY_ATTR_PASSIVE_SCAN
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

2701 
	#NL80211_FREQUENCY_ATTR_NO_IBSS
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

2702 
	#NL80211_FREQUENCY_ATTR_NO_IR
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

2703 
	#NL80211_FREQUENCY_ATTR_GO_CONCURRENT
 \

2704 
NL80211_FREQUENCY_ATTR_IR_CONCURRENT


	)

2716 
	e∆80211_bôøã_©å
 {

2717 
	m__NL80211_BITRATE_ATTR_INVALID
,

2718 
	mNL80211_BITRATE_ATTR_RATE
,

2719 
	mNL80211_BITRATE_ATTR_2GHZ_SHORTPREAMBLE
,

2722 
	m__NL80211_BITRATE_ATTR_AFTER_LAST
,

2723 
	mNL80211_BITRATE_ATTR_MAX
 = 
__NL80211_BITRATE_ATTR_AFTER_LAST
 - 1

2742 
	e∆80211_ªg_öôüt‹
 {

2743 
	mNL80211_REGDOM_SET_BY_CORE
,

2744 
	mNL80211_REGDOM_SET_BY_USER
,

2745 
	mNL80211_REGDOM_SET_BY_DRIVER
,

2746 
	mNL80211_REGDOM_SET_BY_COUNTRY_IE
,

2765 
	e∆80211_ªg_ty≥
 {

2766 
	mNL80211_REGDOM_TYPE_COUNTRY
,

2767 
	mNL80211_REGDOM_TYPE_WORLD
,

2768 
	mNL80211_REGDOM_TYPE_CUSTOM_WORLD
,

2769 
	mNL80211_REGDOM_TYPE_INTERSECTION
,

2797 
	e∆80211_ªg_ruÀ_©å
 {

2798 
	m__NL80211_REG_RULE_ATTR_INVALID
,

2799 
	mNL80211_ATTR_REG_RULE_FLAGS
,

2801 
	mNL80211_ATTR_FREQ_RANGE_START
,

2802 
	mNL80211_ATTR_FREQ_RANGE_END
,

2803 
	mNL80211_ATTR_FREQ_RANGE_MAX_BW
,

2805 
	mNL80211_ATTR_POWER_RULE_MAX_ANT_GAIN
,

2806 
	mNL80211_ATTR_POWER_RULE_MAX_EIRP
,

2808 
	mNL80211_ATTR_DFS_CAC_TIME
,

2811 
	m__NL80211_REG_RULE_ATTR_AFTER_LAST
,

2812 
	mNL80211_REG_RULE_ATTR_MAX
 = 
__NL80211_REG_RULE_ATTR_AFTER_LAST
 - 1

2832 
	e∆80211_sched_sˇn_m©ch_©å
 {

2833 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_INVALID
,

2835 
	mNL80211_SCHED_SCAN_MATCH_ATTR_SSID
,

2836 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RSSI
,

2839 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
,

2840 
	mNL80211_SCHED_SCAN_MATCH_ATTR_MAX
 =

2841 
__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
 - 1

2845 
	#NL80211_ATTR_SCHED_SCAN_MATCH_SSID
 
NL80211_SCHED_SCAN_MATCH_ATTR_SSID


	)

2869 
	e∆80211_ªg_ruÀ_Êags
 {

2870 
	mNL80211_RRF_NO_OFDM
 = 1<<0,

2871 
	mNL80211_RRF_NO_CCK
 = 1<<1,

2872 
	mNL80211_RRF_NO_INDOOR
 = 1<<2,

2873 
	mNL80211_RRF_NO_OUTDOOR
 = 1<<3,

2874 
	mNL80211_RRF_DFS
 = 1<<4,

2875 
	mNL80211_RRF_PTP_ONLY
 = 1<<5,

2876 
	mNL80211_RRF_PTMP_ONLY
 = 1<<6,

2877 
	mNL80211_RRF_NO_IR
 = 1<<7,

2878 
	m__NL80211_RRF_NO_IBSS
 = 1<<8,

2879 
	mNL80211_RRF_AUTO_BW
 = 1<<11,

2880 
	mNL80211_RRF_IR_CONCURRENT
 = 1<<12,

2881 
	mNL80211_RRF_NO_HT40MINUS
 = 1<<13,

2882 
	mNL80211_RRF_NO_HT40PLUS
 = 1<<14,

2883 
	mNL80211_RRF_NO_80MHZ
 = 1<<15,

2884 
	mNL80211_RRF_NO_160MHZ
 = 1<<16,

2887 
	#NL80211_RRF_PASSIVE_SCAN
 
NL80211_RRF_NO_IR


	)

2888 
	#NL80211_RRF_NO_IBSS
 
NL80211_RRF_NO_IR


	)

2889 
	#NL80211_RRF_NO_IR
 
NL80211_RRF_NO_IR


	)

2890 
	#NL80211_RRF_NO_HT40
 (
NL80211_RRF_NO_HT40MINUS
 |\

2891 
NL80211_RRF_NO_HT40PLUS
)

	)

2892 
	#NL80211_RRF_GO_CONCURRENT
 
NL80211_RRF_IR_CONCURRENT


	)

2895 
	#NL80211_RRF_NO_IR_ALL
 (
NL80211_RRF_NO_IR
 | 
__NL80211_RRF_NO_IBSS
)

	)

2905 
	e∆80211_dfs_ªgi⁄s
 {

2906 
	mNL80211_DFS_UNSET
 = 0,

2907 
	mNL80211_DFS_FCC
 = 1,

2908 
	mNL80211_DFS_ETSI
 = 2,

2909 
	mNL80211_DFS_JP
 = 3,

2929 
	e∆80211_u£r_ªg_höt_ty≥
 {

2930 
	mNL80211_USER_REG_HINT_USER
 = 0,

2931 
	mNL80211_USER_REG_HINT_CELL_BASE
 = 1,

2932 
	mNL80211_USER_REG_HINT_INDOOR
 = 2,

2961 
	e∆80211_survey_öfo
 {

2962 
	m__NL80211_SURVEY_INFO_INVALID
,

2963 
	mNL80211_SURVEY_INFO_FREQUENCY
,

2964 
	mNL80211_SURVEY_INFO_NOISE
,

2965 
	mNL80211_SURVEY_INFO_IN_USE
,

2966 
	mNL80211_SURVEY_INFO_TIME
,

2967 
	mNL80211_SURVEY_INFO_TIME_BUSY
,

2968 
	mNL80211_SURVEY_INFO_TIME_EXT_BUSY
,

2969 
	mNL80211_SURVEY_INFO_TIME_RX
,

2970 
	mNL80211_SURVEY_INFO_TIME_TX
,

2971 
	mNL80211_SURVEY_INFO_TIME_SCAN
,

2974 
	m__NL80211_SURVEY_INFO_AFTER_LAST
,

2975 
	mNL80211_SURVEY_INFO_MAX
 = 
__NL80211_SURVEY_INFO_AFTER_LAST
 - 1

2979 
	#NL80211_SURVEY_INFO_CHANNEL_TIME
 
NL80211_SURVEY_INFO_TIME


	)

2980 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_BUSY
 
NL80211_SURVEY_INFO_TIME_BUSY


	)

2981 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_EXT_BUSY
 
NL80211_SURVEY_INFO_TIME_EXT_BUSY


	)

2982 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_RX
 
NL80211_SURVEY_INFO_TIME_RX


	)

2983 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_TX
 
NL80211_SURVEY_INFO_TIME_TX


	)

3004 
	e∆80211_m¡r_Êags
 {

3005 
	m__NL80211_MNTR_FLAG_INVALID
,

3006 
	mNL80211_MNTR_FLAG_FCSFAIL
,

3007 
	mNL80211_MNTR_FLAG_PLCPFAIL
,

3008 
	mNL80211_MNTR_FLAG_CONTROL
,

3009 
	mNL80211_MNTR_FLAG_OTHER_BSS
,

3010 
	mNL80211_MNTR_FLAG_COOK_FRAMES
,

3011 
	mNL80211_MNTR_FLAG_ACTIVE
,

3014 
	m__NL80211_MNTR_FLAG_AFTER_LAST
,

3015 
	mNL80211_MNTR_FLAG_MAX
 = 
__NL80211_MNTR_FLAG_AFTER_LAST
 - 1

3036 
	e∆80211_mesh_powî_mode
 {

3037 
	mNL80211_MESH_POWER_UNKNOWN
,

3038 
	mNL80211_MESH_POWER_ACTIVE
,

3039 
	mNL80211_MESH_POWER_LIGHT_SLEEP
,

3040 
	mNL80211_MESH_POWER_DEEP_SLEEP
,

3042 
	m__NL80211_MESH_POWER_AFTER_LAST
,

3043 
	mNL80211_MESH_POWER_MAX
 = 
__NL80211_MESH_POWER_AFTER_LAST
 - 1

3154 
	e∆80211_meshc⁄f_∑øms
 {

3155 
	m__NL80211_MESHCONF_INVALID
,

3156 
	mNL80211_MESHCONF_RETRY_TIMEOUT
,

3157 
	mNL80211_MESHCONF_CONFIRM_TIMEOUT
,

3158 
	mNL80211_MESHCONF_HOLDING_TIMEOUT
,

3159 
	mNL80211_MESHCONF_MAX_PEER_LINKS
,

3160 
	mNL80211_MESHCONF_MAX_RETRIES
,

3161 
	mNL80211_MESHCONF_TTL
,

3162 
	mNL80211_MESHCONF_AUTO_OPEN_PLINKS
,

3163 
	mNL80211_MESHCONF_HWMP_MAX_PREQ_RETRIES
,

3164 
	mNL80211_MESHCONF_PATH_REFRESH_TIME
,

3165 
	mNL80211_MESHCONF_MIN_DISCOVERY_TIMEOUT
,

3166 
	mNL80211_MESHCONF_HWMP_ACTIVE_PATH_TIMEOUT
,

3167 
	mNL80211_MESHCONF_HWMP_PREQ_MIN_INTERVAL
,

3168 
	mNL80211_MESHCONF_HWMP_NET_DIAM_TRVS_TIME
,

3169 
	mNL80211_MESHCONF_HWMP_ROOTMODE
,

3170 
	mNL80211_MESHCONF_ELEMENT_TTL
,

3171 
	mNL80211_MESHCONF_HWMP_RANN_INTERVAL
,

3172 
	mNL80211_MESHCONF_GATE_ANNOUNCEMENTS
,

3173 
	mNL80211_MESHCONF_HWMP_PERR_MIN_INTERVAL
,

3174 
	mNL80211_MESHCONF_FORWARDING
,

3175 
	mNL80211_MESHCONF_RSSI_THRESHOLD
,

3176 
	mNL80211_MESHCONF_SYNC_OFFSET_MAX_NEIGHBOR
,

3177 
	mNL80211_MESHCONF_HT_OPMODE
,

3178 
	mNL80211_MESHCONF_HWMP_PATH_TO_ROOT_TIMEOUT
,

3179 
	mNL80211_MESHCONF_HWMP_ROOT_INTERVAL
,

3180 
	mNL80211_MESHCONF_HWMP_CONFIRMATION_INTERVAL
,

3181 
	mNL80211_MESHCONF_POWER_MODE
,

3182 
	mNL80211_MESHCONF_AWAKE_WINDOW
,

3183 
	mNL80211_MESHCONF_PLINK_TIMEOUT
,

3186 
	m__NL80211_MESHCONF_ATTR_AFTER_LAST
,

3187 
	mNL80211_MESHCONF_ATTR_MAX
 = 
__NL80211_MESHCONF_ATTR_AFTER_LAST
 - 1

3239 
	e∆80211_mesh_£tup_∑øms
 {

3240 
	m__NL80211_MESH_SETUP_INVALID
,

3241 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_PATH_SEL
,

3242 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_METRIC
,

3243 
	mNL80211_MESH_SETUP_IE
,

3244 
	mNL80211_MESH_SETUP_USERSPACE_AUTH
,

3245 
	mNL80211_MESH_SETUP_USERSPACE_AMPE
,

3246 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_SYNC
,

3247 
	mNL80211_MESH_SETUP_USERSPACE_MPM
,

3248 
	mNL80211_MESH_SETUP_AUTH_PROTOCOL
,

3251 
	m__NL80211_MESH_SETUP_ATTR_AFTER_LAST
,

3252 
	mNL80211_MESH_SETUP_ATTR_MAX
 = 
__NL80211_MESH_SETUP_ATTR_AFTER_LAST
 - 1

3269 
	e∆80211_txq_©å
 {

3270 
	m__NL80211_TXQ_ATTR_INVALID
,

3271 
	mNL80211_TXQ_ATTR_AC
,

3272 
	mNL80211_TXQ_ATTR_TXOP
,

3273 
	mNL80211_TXQ_ATTR_CWMIN
,

3274 
	mNL80211_TXQ_ATTR_CWMAX
,

3275 
	mNL80211_TXQ_ATTR_AIFS
,

3278 
	m__NL80211_TXQ_ATTR_AFTER_LAST
,

3279 
	mNL80211_TXQ_ATTR_MAX
 = 
__NL80211_TXQ_ATTR_AFTER_LAST
 - 1

3282 
	e∆80211_ac
 {

3283 
	mNL80211_AC_VO
,

3284 
	mNL80211_AC_VI
,

3285 
	mNL80211_AC_BE
,

3286 
	mNL80211_AC_BK
,

3287 
	mNL80211_NUM_ACS


3291 
	#NL80211_TXQ_ATTR_QUEUE
 
NL80211_TXQ_ATTR_AC


	)

3292 
	#NL80211_TXQ_Q_VO
 
NL80211_AC_VO


	)

3293 
	#NL80211_TXQ_Q_VI
 
NL80211_AC_VI


	)

3294 
	#NL80211_TXQ_Q_BE
 
NL80211_AC_BE


	)

3295 
	#NL80211_TXQ_Q_BK
 
NL80211_AC_BK


	)

3306 
	e∆80211_ch™√l_ty≥
 {

3307 
	mNL80211_CHAN_NO_HT
,

3308 
	mNL80211_CHAN_HT20
,

3309 
	mNL80211_CHAN_HT40MINUS
,

3310 
	mNL80211_CHAN_HT40PLUS


3332 
	e∆80211_ch™_width
 {

3333 
	mNL80211_CHAN_WIDTH_20_NOHT
,

3334 
	mNL80211_CHAN_WIDTH_20
,

3335 
	mNL80211_CHAN_WIDTH_40
,

3336 
	mNL80211_CHAN_WIDTH_80
,

3337 
	mNL80211_CHAN_WIDTH_80P80
,

3338 
	mNL80211_CHAN_WIDTH_160
,

3339 
	mNL80211_CHAN_WIDTH_5
,

3340 
	mNL80211_CHAN_WIDTH_10
,

3352 
	e∆80211_bss_sˇn_width
 {

3353 
	mNL80211_BSS_CHAN_WIDTH_20
,

3354 
	mNL80211_BSS_CHAN_WIDTH_10
,

3355 
	mNL80211_BSS_CHAN_WIDTH_5
,

3400 
	e∆80211_bss
 {

3401 
	m__NL80211_BSS_INVALID
,

3402 
	mNL80211_BSS_BSSID
,

3403 
	mNL80211_BSS_FREQUENCY
,

3404 
	mNL80211_BSS_TSF
,

3405 
	mNL80211_BSS_BEACON_INTERVAL
,

3406 
	mNL80211_BSS_CAPABILITY
,

3407 
	mNL80211_BSS_INFORMATION_ELEMENTS
,

3408 
	mNL80211_BSS_SIGNAL_MBM
,

3409 
	mNL80211_BSS_SIGNAL_UNSPEC
,

3410 
	mNL80211_BSS_STATUS
,

3411 
	mNL80211_BSS_SEEN_MS_AGO
,

3412 
	mNL80211_BSS_BEACON_IES
,

3413 
	mNL80211_BSS_CHAN_WIDTH
,

3414 
	mNL80211_BSS_BEACON_TSF
,

3415 
	mNL80211_BSS_PRESP_DATA
,

3416 
	mNL80211_BSS_LAST_SEEN_BOOTTIME
,

3419 
	m__NL80211_BSS_AFTER_LAST
,

3420 
	mNL80211_BSS_MAX
 = 
__NL80211_BSS_AFTER_LAST
 - 1

3435 
	e∆80211_bss_°©us
 {

3436 
	mNL80211_BSS_STATUS_AUTHENTICATED
,

3437 
	mNL80211_BSS_STATUS_ASSOCIATED
,

3438 
	mNL80211_BSS_STATUS_IBSS_JOINED
,

3455 
	e∆80211_auth_ty≥
 {

3456 
	mNL80211_AUTHTYPE_OPEN_SYSTEM
,

3457 
	mNL80211_AUTHTYPE_SHARED_KEY
,

3458 
	mNL80211_AUTHTYPE_FT
,

3459 
	mNL80211_AUTHTYPE_NETWORK_EAP
,

3460 
	mNL80211_AUTHTYPE_SAE
,

3463 
	m__NL80211_AUTHTYPE_NUM
,

3464 
	mNL80211_AUTHTYPE_MAX
 = 
__NL80211_AUTHTYPE_NUM
 - 1,

3465 
	mNL80211_AUTHTYPE_AUTOMATIC


3475 
	e∆80211_key_ty≥
 {

3476 
	mNL80211_KEYTYPE_GROUP
,

3477 
	mNL80211_KEYTYPE_PAIRWISE
,

3478 
	mNL80211_KEYTYPE_PEERKEY
,

3480 
	mNUM_NL80211_KEYTYPES


3488 
	e∆80211_mÂ
 {

3489 
	mNL80211_MFP_NO
,

3490 
	mNL80211_MFP_REQUIRED
,

3493 
	e∆80211_w∑_vîsi⁄s
 {

3494 
	mNL80211_WPA_VERSION_1
 = 1 << 0,

3495 
	mNL80211_WPA_VERSION_2
 = 1 << 1,

3507 
	e∆80211_key_deÁu…_ty≥s
 {

3508 
	m__NL80211_KEY_DEFAULT_TYPE_INVALID
,

3509 
	mNL80211_KEY_DEFAULT_TYPE_UNICAST
,

3510 
	mNL80211_KEY_DEFAULT_TYPE_MULTICAST
,

3512 
	mNUM_NL80211_KEY_DEFAULT_TYPES


3537 
	e∆80211_key_©åibuãs
 {

3538 
	m__NL80211_KEY_INVALID
,

3539 
	mNL80211_KEY_DATA
,

3540 
	mNL80211_KEY_IDX
,

3541 
	mNL80211_KEY_CIPHER
,

3542 
	mNL80211_KEY_SEQ
,

3543 
	mNL80211_KEY_DEFAULT
,

3544 
	mNL80211_KEY_DEFAULT_MGMT
,

3545 
	mNL80211_KEY_TYPE
,

3546 
	mNL80211_KEY_DEFAULT_TYPES
,

3549 
	m__NL80211_KEY_AFTER_LAST
,

3550 
	mNL80211_KEY_MAX
 = 
__NL80211_KEY_AFTER_LAST
 - 1

3568 
	e∆80211_tx_øã_©åibuãs
 {

3569 
	m__NL80211_TXRATE_INVALID
,

3570 
	mNL80211_TXRATE_LEGACY
,

3571 
	mNL80211_TXRATE_HT
,

3572 
	mNL80211_TXRATE_VHT
,

3573 
	mNL80211_TXRATE_GI
,

3576 
	m__NL80211_TXRATE_AFTER_LAST
,

3577 
	mNL80211_TXRATE_MAX
 = 
__NL80211_TXRATE_AFTER_LAST
 - 1

3580 
	#NL80211_TXRATE_MCS
 
NL80211_TXRATE_HT


	)

3581 
	#NL80211_VHT_NSS_MAX
 8

	)

3587 
	s∆80211_txøã_vht
 {

3588 
__u16
 
	mmcs
[
NL80211_VHT_NSS_MAX
];

3591 
	e∆80211_txøã_gi
 {

3592 
	mNL80211_TXRATE_DEFAULT_GI
,

3593 
	mNL80211_TXRATE_FORCE_SGI
,

3594 
	mNL80211_TXRATE_FORCE_LGI
,

3603 
	e∆80211_b™d
 {

3604 
	mNL80211_BAND_2GHZ
,

3605 
	mNL80211_BAND_5GHZ
,

3606 
	mNL80211_BAND_60GHZ
,

3614 
	e∆80211_ps_°©e
 {

3615 
	mNL80211_PS_DISABLED
,

3616 
	mNL80211_PS_ENABLED
,

3647 
	e∆80211_©å_cqm
 {

3648 
	m__NL80211_ATTR_CQM_INVALID
,

3649 
	mNL80211_ATTR_CQM_RSSI_THOLD
,

3650 
	mNL80211_ATTR_CQM_RSSI_HYST
,

3651 
	mNL80211_ATTR_CQM_RSSI_THRESHOLD_EVENT
,

3652 
	mNL80211_ATTR_CQM_PKT_LOSS_EVENT
,

3653 
	mNL80211_ATTR_CQM_TXE_RATE
,

3654 
	mNL80211_ATTR_CQM_TXE_PKTS
,

3655 
	mNL80211_ATTR_CQM_TXE_INTVL
,

3656 
	mNL80211_ATTR_CQM_BEACON_LOSS_EVENT
,

3659 
	m__NL80211_ATTR_CQM_AFTER_LAST
,

3660 
	mNL80211_ATTR_CQM_MAX
 = 
__NL80211_ATTR_CQM_AFTER_LAST
 - 1

3671 
	e∆80211_cqm_rssi_thªshﬁd_evít
 {

3672 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

3673 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

3674 
	mNL80211_CQM_RSSI_BEACON_LOSS_EVENT
,

3684 
	e∆80211_tx_powî_£âög
 {

3685 
	mNL80211_TX_POWER_AUTOMATIC
,

3686 
	mNL80211_TX_POWER_LIMITED
,

3687 
	mNL80211_TX_POWER_FIXED
,

3711 
	e∆80211_∑ckë_∑âîn_©å
 {

3712 
	m__NL80211_PKTPAT_INVALID
,

3713 
	mNL80211_PKTPAT_MASK
,

3714 
	mNL80211_PKTPAT_PATTERN
,

3715 
	mNL80211_PKTPAT_OFFSET
,

3717 
	mNUM_NL80211_PKTPAT
,

3718 
	mMAX_NL80211_PKTPAT
 = 
NUM_NL80211_PKTPAT
 - 1,

3734 
	s∆80211_∑âîn_suµ‹t
 {

3735 
__u32
 
	mmax_∑âîns
;

3736 
__u32
 
	mmö_∑âîn_Àn
;

3737 
__u32
 
	mmax_∑âîn_Àn
;

3738 
__u32
 
	mmax_pkt_off£t
;

3739 } 
__©åibuã__
((
∑cked
));

3742 
	#__NL80211_WOWLAN_PKTPAT_INVALID
 
__NL80211_PKTPAT_INVALID


	)

3743 
	#NL80211_WOWLAN_PKTPAT_MASK
 
NL80211_PKTPAT_MASK


	)

3744 
	#NL80211_WOWLAN_PKTPAT_PATTERN
 
NL80211_PKTPAT_PATTERN


	)

3745 
	#NL80211_WOWLAN_PKTPAT_OFFSET
 
NL80211_PKTPAT_OFFSET


	)

3746 
	#NUM_NL80211_WOWLAN_PKTPAT
 
NUM_NL80211_PKTPAT


	)

3747 
	#MAX_NL80211_WOWLAN_PKTPAT
 
MAX_NL80211_PKTPAT


	)

3748 
	#∆80211_wowœn_∑âîn_suµ‹t
 
∆80211_∑âîn_suµ‹t


	)

3839 
	e∆80211_wowœn_åiggîs
 {

3840 
	m__NL80211_WOWLAN_TRIG_INVALID
,

3841 
	mNL80211_WOWLAN_TRIG_ANY
,

3842 
	mNL80211_WOWLAN_TRIG_DISCONNECT
,

3843 
	mNL80211_WOWLAN_TRIG_MAGIC_PKT
,

3844 
	mNL80211_WOWLAN_TRIG_PKT_PATTERN
,

3845 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_SUPPORTED
,

3846 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_FAILURE
,

3847 
	mNL80211_WOWLAN_TRIG_EAP_IDENT_REQUEST
,

3848 
	mNL80211_WOWLAN_TRIG_4WAY_HANDSHAKE
,

3849 
	mNL80211_WOWLAN_TRIG_RFKILL_RELEASE
,

3850 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211
,

3851 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211_LEN
,

3852 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023
,

3853 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023_LEN
,

3854 
	mNL80211_WOWLAN_TRIG_TCP_CONNECTION
,

3855 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_MATCH
,

3856 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_CONNLOST
,

3857 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_NOMORETOKENS
,

3858 
	mNL80211_WOWLAN_TRIG_NET_DETECT
,

3859 
	mNL80211_WOWLAN_TRIG_NET_DETECT_RESULTS
,

3862 
	mNUM_NL80211_WOWLAN_TRIG
,

3863 
	mMAX_NL80211_WOWLAN_TRIG
 = 
NUM_NL80211_WOWLAN_TRIG
 - 1

3899 
	s∆80211_wowœn_t˝_d©a_£q
 {

3900 
__u32
 
	m°¨t
, 
	moff£t
, 
	mÀn
;

3910 
	s∆80211_wowœn_t˝_d©a_tokí
 {

3911 
__u32
 
	moff£t
, 
	mÀn
;

3912 
__u8
 
	mtokí_°ªam
[];

3921 
	s∆80211_wowœn_t˝_d©a_tokí_„©uª
 {

3922 
__u32
 
	mmö_Àn
, 
	mmax_Àn
, 
	mbufsize
;

3957 
	e∆80211_wowœn_t˝_©ås
 {

3958 
	m__NL80211_WOWLAN_TCP_INVALID
,

3959 
	mNL80211_WOWLAN_TCP_SRC_IPV4
,

3960 
	mNL80211_WOWLAN_TCP_DST_IPV4
,

3961 
	mNL80211_WOWLAN_TCP_DST_MAC
,

3962 
	mNL80211_WOWLAN_TCP_SRC_PORT
,

3963 
	mNL80211_WOWLAN_TCP_DST_PORT
,

3964 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD
,

3965 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_SEQ
,

3966 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_TOKEN
,

3967 
	mNL80211_WOWLAN_TCP_DATA_INTERVAL
,

3968 
	mNL80211_WOWLAN_TCP_WAKE_PAYLOAD
,

3969 
	mNL80211_WOWLAN_TCP_WAKE_MASK
,

3972 
	mNUM_NL80211_WOWLAN_TCP
,

3973 
	mMAX_NL80211_WOWLAN_TCP
 = 
NUM_NL80211_WOWLAN_TCP
 - 1

3985 
	s∆80211_cﬂÀs˚_ruÀ_suµ‹t
 {

3986 
__u32
 
	mmax_ruÀs
;

3987 
∆80211_∑âîn_suµ‹t
 
	m∑t
;

3988 
__u32
 
	mmax_dñay
;

3989 } 
__©åibuã__
((
∑cked
));

4002 
	e∆80211_©å_cﬂÀs˚_ruÀ
 {

4003 
	m__NL80211_COALESCE_RULE_INVALID
,

4004 
	mNL80211_ATTR_COALESCE_RULE_DELAY
,

4005 
	mNL80211_ATTR_COALESCE_RULE_CONDITION
,

4006 
	mNL80211_ATTR_COALESCE_RULE_PKT_PATTERN
,

4009 
	mNUM_NL80211_ATTR_COALESCE_RULE
,

4010 
	mNL80211_ATTR_COALESCE_RULE_MAX
 = 
NUM_NL80211_ATTR_COALESCE_RULE
 - 1

4020 
	e∆80211_cﬂÀs˚_c⁄dôi⁄
 {

4021 
	mNL80211_COALESCE_CONDITION_MATCH
,

4022 
	mNL80211_COALESCE_CONDITION_NO_MATCH


4035 
	e∆80211_iÁ˚_limô_©ås
 {

4036 
	mNL80211_IFACE_LIMIT_UNSPEC
,

4037 
	mNL80211_IFACE_LIMIT_MAX
,

4038 
	mNL80211_IFACE_LIMIT_TYPES
,

4041 
	mNUM_NL80211_IFACE_LIMIT
,

4042 
	mMAX_NL80211_IFACE_LIMIT
 = 
NUM_NL80211_IFACE_LIMIT
 - 1

4091 
	e∆80211_if_combö©i⁄_©ås
 {

4092 
	mNL80211_IFACE_COMB_UNSPEC
,

4093 
	mNL80211_IFACE_COMB_LIMITS
,

4094 
	mNL80211_IFACE_COMB_MAXNUM
,

4095 
	mNL80211_IFACE_COMB_STA_AP_BI_MATCH
,

4096 
	mNL80211_IFACE_COMB_NUM_CHANNELS
,

4097 
	mNL80211_IFACE_COMB_RADAR_DETECT_WIDTHS
,

4098 
	mNL80211_IFACE_COMB_RADAR_DETECT_REGIONS
,

4101 
	mNUM_NL80211_IFACE_COMB
,

4102 
	mMAX_NL80211_IFACE_COMB
 = 
NUM_NL80211_IFACE_COMB
 - 1

4124 
	e∆80211_∂ök_°©e
 {

4125 
	mNL80211_PLINK_LISTEN
,

4126 
	mNL80211_PLINK_OPN_SNT
,

4127 
	mNL80211_PLINK_OPN_RCVD
,

4128 
	mNL80211_PLINK_CNF_RCVD
,

4129 
	mNL80211_PLINK_ESTAB
,

4130 
	mNL80211_PLINK_HOLDING
,

4131 
	mNL80211_PLINK_BLOCKED
,

4134 
	mNUM_NL80211_PLINK_STATES
,

4135 
	mMAX_NL80211_PLINK_STATES
 = 
NUM_NL80211_PLINK_STATES
 - 1

4146 
	e∂ök_a˘i⁄s
 {

4147 
	mNL80211_PLINK_ACTION_NO_ACTION
,

4148 
	mNL80211_PLINK_ACTION_OPEN
,

4149 
	mNL80211_PLINK_ACTION_BLOCK
,

4151 
	mNUM_NL80211_PLINK_ACTIONS
,

4155 
	#NL80211_KCK_LEN
 16

	)

4156 
	#NL80211_KEK_LEN
 16

	)

4157 
	#NL80211_REPLAY_CTR_LEN
 8

	)

4168 
	e∆80211_ªkey_d©a
 {

4169 
	m__NL80211_REKEY_DATA_INVALID
,

4170 
	mNL80211_REKEY_DATA_KEK
,

4171 
	mNL80211_REKEY_DATA_KCK
,

4172 
	mNL80211_REKEY_DATA_REPLAY_CTR
,

4175 
	mNUM_NL80211_REKEY_DATA
,

4176 
	mMAX_NL80211_REKEY_DATA
 = 
NUM_NL80211_REKEY_DATA
 - 1

4188 
	e∆80211_hiddí_ssid
 {

4189 
	mNL80211_HIDDEN_SSID_NOT_IN_USE
,

4190 
	mNL80211_HIDDEN_SSID_ZERO_LEN
,

4191 
	mNL80211_HIDDEN_SSID_ZERO_CONTENTS


4204 
	e∆80211_°a_wme_©å
 {

4205 
	m__NL80211_STA_WME_INVALID
,

4206 
	mNL80211_STA_WME_UAPSD_QUEUES
,

4207 
	mNL80211_STA_WME_MAX_SP
,

4210 
	m__NL80211_STA_WME_AFTER_LAST
,

4211 
	mNL80211_STA_WME_MAX
 = 
__NL80211_STA_WME_AFTER_LAST
 - 1

4226 
	e∆80211_pmkß_ˇndid©e_©å
 {

4227 
	m__NL80211_PMKSA_CANDIDATE_INVALID
,

4228 
	mNL80211_PMKSA_CANDIDATE_INDEX
,

4229 
	mNL80211_PMKSA_CANDIDATE_BSSID
,

4230 
	mNL80211_PMKSA_CANDIDATE_PREAUTH
,

4233 
	mNUM_NL80211_PMKSA_CANDIDATE
,

4234 
	mMAX_NL80211_PMKSA_CANDIDATE
 = 
NUM_NL80211_PMKSA_CANDIDATE
 - 1

4245 
	e∆80211_tdls_›î©i⁄
 {

4246 
	mNL80211_TDLS_DISCOVERY_REQ
,

4247 
	mNL80211_TDLS_SETUP
,

4248 
	mNL80211_TDLS_TEARDOWN
,

4249 
	mNL80211_TDLS_ENABLE_LINK
,

4250 
	mNL80211_TDLS_DISABLE_LINK
,

4354 
	e∆80211_„©uª_Êags
 {

4355 
	mNL80211_FEATURE_SK_TX_STATUS
 = 1 << 0,

4356 
	mNL80211_FEATURE_HT_IBSS
 = 1 << 1,

4357 
	mNL80211_FEATURE_INACTIVITY_TIMER
 = 1 << 2,

4358 
	mNL80211_FEATURE_CELL_BASE_REG_HINTS
 = 1 << 3,

4359 
	mNL80211_FEATURE_P2P_DEVICE_NEEDS_CHANNEL
 = 1 << 4,

4360 
	mNL80211_FEATURE_SAE
 = 1 << 5,

4361 
	mNL80211_FEATURE_LOW_PRIORITY_SCAN
 = 1 << 6,

4362 
	mNL80211_FEATURE_SCAN_FLUSH
 = 1 << 7,

4363 
	mNL80211_FEATURE_AP_SCAN
 = 1 << 8,

4364 
	mNL80211_FEATURE_VIF_TXPOWER
 = 1 << 9,

4365 
	mNL80211_FEATURE_NEED_OBSS_SCAN
 = 1 << 10,

4366 
	mNL80211_FEATURE_P2P_GO_CTWIN
 = 1 << 11,

4367 
	mNL80211_FEATURE_P2P_GO_OPPPS
 = 1 << 12,

4369 
	mNL80211_FEATURE_ADVERTISE_CHAN_LIMITS
 = 1 << 14,

4370 
	mNL80211_FEATURE_FULL_AP_CLIENT_STATE
 = 1 << 15,

4371 
	mNL80211_FEATURE_USERSPACE_MPM
 = 1 << 16,

4372 
	mNL80211_FEATURE_ACTIVE_MONITOR
 = 1 << 17,

4373 
	mNL80211_FEATURE_AP_MODE_CHAN_WIDTH_CHANGE
 = 1 << 18,

4374 
	mNL80211_FEATURE_DS_PARAM_SET_IE_IN_PROBES
 = 1 << 19,

4375 
	mNL80211_FEATURE_WFA_TPC_IE_IN_PROBES
 = 1 << 20,

4376 
	mNL80211_FEATURE_QUIET
 = 1 << 21,

4377 
	mNL80211_FEATURE_TX_POWER_INSERTION
 = 1 << 22,

4378 
	mNL80211_FEATURE_ACKTO_ESTIMATION
 = 1 << 23,

4379 
	mNL80211_FEATURE_STATIC_SMPS
 = 1 << 24,

4380 
	mNL80211_FEATURE_DYNAMIC_SMPS
 = 1 << 25,

4381 
	mNL80211_FEATURE_SUPPORTS_WMM_ADMISSION
 = 1 << 26,

4382 
	mNL80211_FEATURE_MAC_ON_CREATE
 = 1 << 27,

4383 
	mNL80211_FEATURE_TDLS_CHANNEL_SWITCH
 = 1 << 28,

4384 
	mNL80211_FEATURE_SCAN_RANDOM_MAC_ADDR
 = 1 << 29,

4385 
	mNL80211_FEATURE_SCHED_SCAN_RANDOM_MAC_ADDR
 = 1 << 30,

4386 
	mNL80211_FEATURE_ND_RANDOM_MAC_ADDR
 = 1 << 31,

4396 
	e∆80211_ext_„©uª_ödex
 {

4397 
	mNL80211_EXT_FEATURE_VHT_IBSS
,

4400 
	mNUM_NL80211_EXT_FEATURES
,

4401 
	mMAX_NL80211_EXT_FEATURES
 = 
NUM_NL80211_EXT_FEATURES
 - 1

4418 
	e∆80211_¥obe_ª•_ofÊﬂd_suµ‹t_©å
 {

4419 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS
 = 1<<0,

4420 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS2
 = 1<<1,

4421 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_P2P
 = 1<<2,

4422 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_80211U
 = 1<<3,

4431 
	e∆80211_c⁄√˘_Áûed_ªas⁄
 {

4432 
	mNL80211_CONN_FAIL_MAX_CLIENTS
,

4433 
	mNL80211_CONN_FAIL_BLOCKED_CLIENT
,

4460 
	e∆80211_sˇn_Êags
 {

4461 
	mNL80211_SCAN_FLAG_LOW_PRIORITY
 = 1<<0,

4462 
	mNL80211_SCAN_FLAG_FLUSH
 = 1<<1,

4463 
	mNL80211_SCAN_FLAG_AP
 = 1<<2,

4464 
	mNL80211_SCAN_FLAG_RANDOM_ADDR
 = 1<<3,

4480 
	e∆80211_a˛_pﬁicy
 {

4481 
	mNL80211_ACL_POLICY_ACCEPT_UNLESS_LISTED
,

4482 
	mNL80211_ACL_POLICY_DENY_UNLESS_LISTED
,

4495 
	e∆80211_smps_mode
 {

4496 
	mNL80211_SMPS_OFF
,

4497 
	mNL80211_SMPS_STATIC
,

4498 
	mNL80211_SMPS_DYNAMIC
,

4500 
	m__NL80211_SMPS_AFTER_LAST
,

4501 
	mNL80211_SMPS_MAX
 = 
__NL80211_SMPS_AFTER_LAST
 - 1

4519 
	e∆80211_ød¨_evít
 {

4520 
	mNL80211_RADAR_DETECTED
,

4521 
	mNL80211_RADAR_CAC_FINISHED
,

4522 
	mNL80211_RADAR_CAC_ABORTED
,

4523 
	mNL80211_RADAR_NOP_FINISHED
,

4537 
	e∆80211_dfs_°©e
 {

4538 
	mNL80211_DFS_USABLE
,

4539 
	mNL80211_DFS_UNAVAILABLE
,

4540 
	mNL80211_DFS_AVAILABLE
,

4551 
	e∆80211_¥Ÿocﬁ_„©uªs
 {

4552 
	mNL80211_PROTOCOL_FEATURE_SPLIT_WIPHY_DUMP
 = 1 << 0,

4564 
	e∆80211_¸ô_¥Ÿo_id
 {

4565 
	mNL80211_CRIT_PROTO_UNSPEC
,

4566 
	mNL80211_CRIT_PROTO_DHCP
,

4567 
	mNL80211_CRIT_PROTO_EAPOL
,

4568 
	mNL80211_CRIT_PROTO_APIPA
,

4570 
	mNUM_NL80211_CRIT_PROTO


4574 
	#NL80211_CRIT_PROTO_MAX_DURATION
 5000

	)

4583 
	e∆80211_rxmgmt_Êags
 {

4584 
	mNL80211_RXMGMT_FLAG_ANSWERED
 = 1 << 0,

4592 
	#NL80211_VENDOR_ID_IS_LINUX
 0x80000000

	)

4602 
	s∆80211_víd‹_cmd_öfo
 {

4603 
__u32
 
	mvíd‹_id
;

4604 
__u32
 
	msubcmd
;

4617 
	e∆80211_tdls_≥î_ˇ∑bûôy
 {

4618 
	mNL80211_TDLS_PEER_HT
 = 1<<0,

4619 
	mNL80211_TDLS_PEER_VHT
 = 1<<1,

4620 
	mNL80211_TDLS_PEER_WMM
 = 1<<2,

4636 
	e∆80211_sched_sˇn_∂™
 {

4637 
	m__NL80211_SCHED_SCAN_PLAN_INVALID
,

4638 
	mNL80211_SCHED_SCAN_PLAN_INTERVAL
,

4639 
	mNL80211_SCHED_SCAN_PLAN_ITERATIONS
,

4642 
	m__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
,

4643 
	mNL80211_SCHED_SCAN_PLAN_MAX
 =

4644 
__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
 - 1

	@/usr/include/linux/pci.h

17 #i‚de‡
LINUX_PCI_H


18 
	#LINUX_PCI_H


	)

20 
	~<löux/pci_ªgs.h
>

30 
	#PCI_DEVFN
(
¶Ÿ
, 
func
Ë((((¶ŸË& 0x1fË<< 3Ë| ((funcË& 0x07))

	)

31 
	#PCI_SLOT
(
dev‚
Ë(((dev‚Ë>> 3Ë& 0x1f)

	)

32 
	#PCI_FUNC
(
dev‚
Ë((dev‚Ë& 0x07)

	)

35 
	#PCIIOC_BASE
 ('P' << 24 | 'C' << 16 | 'I' << 8)

	)

36 
	#PCIIOC_CONTROLLER
 (
PCIIOC_BASE
 | 0x00Ë

	)

37 
	#PCIIOC_MMAP_IS_IO
 (
PCIIOC_BASE
 | 0x01Ë

	)

38 
	#PCIIOC_MMAP_IS_MEM
 (
PCIIOC_BASE
 | 0x02Ë

	)

39 
	#PCIIOC_WRITE_COMBINE
 (
PCIIOC_BASE
 | 0x03Ë

	)

	@/usr/include/linux/random.h

7 #i‚de‡
_LINUX_RANDOM_H


8 
	#_LINUX_RANDOM_H


	)

10 
	~<löux/ty≥s.h
>

11 
	~<löux/io˘l.h
>

12 
	~<löux/úqƒ.h
>

17 
	#RNDGETENTCNT
 
	`_IOR
–'R', 0x00, )

	)

20 
	#RNDADDTOENTCNT
 
	`_IOW
–'R', 0x01, )

	)

23 
	#RNDGETPOOL
 
	`_IOR
–'R', 0x02, [2] )

	)

29 
	#RNDADDENTROPY
 
	`_IOW
–'R', 0x03, [2] )

	)

32 
	#RNDZAPENTCNT
 
	`_IO
–'R', 0x04 )

	)

35 
	#RNDCLEARPOOL
 
	`_IO
–'R', 0x06 )

	)

37 
	sønd_poﬁ_öfo
 {

38 
	míå›y_cou¡
;

39 
	mbuf_size
;

40 
__u32
 
	mbuf
[0];

49 
	#GRND_NONBLOCK
 0x0001

	)

50 
	#GRND_RANDOM
 0x0002

	)

	@/usr/include/linux/time.h

1 #i‚de‡
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<löux/ty≥s.h
>

7 #i‚de‡
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stime•ec
 {

10 
__kî√l_time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

15 
	stimevÆ
 {

16 
__kî√l_time_t
 
	mtv_£c
;

17 
__kî√l_su£c⁄ds_t
 
	mtv_u£c
;

20 
	stimez⁄e
 {

21 
	mtz_möuãswe°
;

22 
	mtz_d°time
;

30 
	#ITIMER_REAL
 0

	)

31 
	#ITIMER_VIRTUAL
 1

	)

32 
	#ITIMER_PROF
 2

	)

34 
	sôimî•ec
 {

35 
time•ec
 
	mô_öãrvÆ
;

36 
time•ec
 
	mô_vÆue
;

39 
	sôimîvÆ
 {

40 
timevÆ
 
	mô_öãrvÆ
;

41 
timevÆ
 
	mô_vÆue
;

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

57 
	#CLOCK_SGI_CYCLE
 10

	)

58 
	#CLOCK_TAI
 11

	)

60 
	#MAX_CLOCKS
 16

	)

61 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

62 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

67 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/linux/if.h

19 #i‚de‡
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<löux/libc-com∑t.h
>

23 
	~<löux/ty≥s.h
>

24 
	~<löux/sockë.h
>

27 #i‡
__UAPI_DEF_IF_IFNAMSIZ


28 
	#IFNAMSIZ
 16

	)

30 
	#IFALIASZ
 256

	)

31 
	~<löux/hdlc/io˘l.h
>

34 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 && \

35 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

76 
	e√t_devi˚_Êags
 {

78 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


79 
IFF_UP
 = 1<<0,

80 
	mIFF_BROADCAST
 = 1<<1,

81 
	mIFF_DEBUG
 = 1<<2,

82 
	mIFF_LOOPBACK
 = 1<<3,

83 
	mIFF_POINTOPOINT
 = 1<<4,

84 
	mIFF_NOTRAILERS
 = 1<<5,

85 
	mIFF_RUNNING
 = 1<<6,

86 
	mIFF_NOARP
 = 1<<7,

87 
	mIFF_PROMISC
 = 1<<8,

88 
	mIFF_ALLMULTI
 = 1<<9,

89 
	mIFF_MASTER
 = 1<<10,

90 
	mIFF_SLAVE
 = 1<<11,

91 
	mIFF_MULTICAST
 = 1<<12,

92 
	mIFF_PORTSEL
 = 1<<13,

93 
	mIFF_AUTOMEDIA
 = 1<<14,

94 
	mIFF_DYNAMIC
 = 1<<15,

96 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


97 
	mIFF_LOWER_UP
 = 1<<16,

98 
	mIFF_DORMANT
 = 1<<17,

99 
	mIFF_ECHO
 = 1<<18,

105 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


106 
	#IFF_UP
 
IFF_UP


	)

107 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

108 
	#IFF_DEBUG
 
IFF_DEBUG


	)

109 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

110 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

111 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

112 
	#IFF_RUNNING
 
IFF_RUNNING


	)

113 
	#IFF_NOARP
 
IFF_NOARP


	)

114 
	#IFF_PROMISC
 
IFF_PROMISC


	)

115 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

116 
	#IFF_MASTER
 
IFF_MASTER


	)

117 
	#IFF_SLAVE
 
IFF_SLAVE


	)

118 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

119 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

120 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

121 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

124 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


125 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

126 
	#IFF_DORMANT
 
IFF_DORMANT


	)

127 
	#IFF_ECHO
 
IFF_ECHO


	)

130 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

131 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

133 
	#IF_GET_IFACE
 0x0001

	)

134 
	#IF_GET_PROTO
 0x0002

	)

137 
	#IF_IFACE_V35
 0x1000

	)

138 
	#IF_IFACE_V24
 0x1001

	)

139 
	#IF_IFACE_X21
 0x1002

	)

140 
	#IF_IFACE_T1
 0x1003

	)

141 
	#IF_IFACE_E1
 0x1004

	)

142 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

143 
	#IF_IFACE_X21D
 0x1006

	)

146 
	#IF_PROTO_HDLC
 0x2000

	)

147 
	#IF_PROTO_PPP
 0x2001

	)

148 
	#IF_PROTO_CISCO
 0x2002

	)

149 
	#IF_PROTO_FR
 0x2003

	)

150 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

151 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

152 
	#IF_PROTO_X25
 0x2006

	)

153 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

154 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

155 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

156 
	#IF_PROTO_FR_PVC
 0x200A

	)

157 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

158 
	#IF_PROTO_RAW
 0x200C

	)

162 
	mIF_OPER_UNKNOWN
,

163 
	mIF_OPER_NOTPRESENT
,

164 
	mIF_OPER_DOWN
,

165 
	mIF_OPER_LOWERLAYERDOWN
,

166 
	mIF_OPER_TESTING
,

167 
	mIF_OPER_DORMANT
,

168 
	mIF_OPER_UP
,

173 
	mIF_LINK_MODE_DEFAULT
,

174 
	mIF_LINK_MODE_DORMANT
,

188 #i‡
__UAPI_DEF_IF_IFMAP


189 
	sifm≠
 {

190 
	mmem_°¨t
;

191 
	mmem_íd
;

192 
	mba£_addr
;

193 
	múq
;

194 
	mdma
;

195 
	mp‹t
;

200 
	sif_£âögs
 {

201 
	mty≥
;

202 
	msize
;

205 
øw_hdlc_¥Ÿo
 *
	møw_hdlc
;

206 
cisco_¥Ÿo
 *
	mcisco
;

207 
‰_¥Ÿo
 *
	m‰
;

208 
‰_¥Ÿo_pvc
 *
	m‰_pvc
;

209 
‰_¥Ÿo_pvc_öfo
 *
	m‰_pvc_öfo
;

212 
sync_£rül_£âögs
 *
	msync
;

213 
ã1_£âögs
 *
	mã1
;

214 } 
	mifs_ifsu
;

225 #i‡
__UAPI_DEF_IF_IFREQ


226 
	si‰eq
 {

227 
	#IFHWADDRLEN
 6

	)

230 
	mi‰n_«me
[
IFNAMSIZ
];

231 } 
	mi‰_i‰n
;

234 
sockaddr
 
	mi‰u_addr
;

235 
sockaddr
 
	mi‰u_d°addr
;

236 
sockaddr
 
	mi‰u_brﬂdaddr
;

237 
sockaddr
 
	mi‰u_√tmask
;

238 
sockaddr
 
	mi‰u_hwaddr
;

239 
	mi‰u_Êags
;

240 
	mi‰u_ivÆue
;

241 
	mi‰u_mtu
;

242 
ifm≠
 
	mi‰u_m≠
;

243 
	mi‰u_¶ave
[
IFNAMSIZ
];

244 
	mi‰u_√w«me
[
IFNAMSIZ
];

245 * 
	mi‰u_d©a
;

246 
if_£âögs
 
	mi‰u_£âögs
;

247 } 
	mi‰_i‰u
;

251 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

252 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

253 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

254 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

255 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

256 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

257 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

258 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

259 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

260 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

261 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

262 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

263 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

264 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

265 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

266 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

267 
	#i‰_£âögs
 
i‰_i‰u
.
i‰u_£âögs


	)

277 #i‡
__UAPI_DEF_IF_IFCONF


278 
	sifc⁄f
 {

279 
	mifc_Àn
;

281 *
	mifcu_buf
;

282 
i‰eq
 *
	mifcu_ªq
;

283 } 
	mifc_ifcu
;

287 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

288 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

	@/usr/include/linux/if_link.h

1 #i‚de‡
_LINUX_IF_LINK_H


2 
	#_LINUX_IF_LINK_H


	)

4 
	~<löux/ty≥s.h
>

5 
	~<löux/√éök.h
>

8 
	sπ∆_lök_°©s
 {

9 
__u32
 
	mrx_∑ckës
;

10 
__u32
 
	mtx_∑ckës
;

11 
__u32
 
	mrx_byãs
;

12 
__u32
 
	mtx_byãs
;

13 
__u32
 
	mrx_îr‹s
;

14 
__u32
 
	mtx_îr‹s
;

15 
__u32
 
	mrx_dr›≥d
;

16 
__u32
 
	mtx_dr›≥d
;

17 
__u32
 
	mmu…iˇ°
;

18 
__u32
 
	mcﬁlisi⁄s
;

21 
__u32
 
	mrx_Àngth_îr‹s
;

22 
__u32
 
	mrx_ovî_îr‹s
;

23 
__u32
 
	mrx_¸c_îr‹s
;

24 
__u32
 
	mrx_‰ame_îr‹s
;

25 
__u32
 
	mrx_fifo_îr‹s
;

26 
__u32
 
	mrx_mis£d_îr‹s
;

29 
__u32
 
	mtx_ab‹ãd_îr‹s
;

30 
__u32
 
	mtx_ˇºõr_îr‹s
;

31 
__u32
 
	mtx_fifo_îr‹s
;

32 
__u32
 
	mtx_hóπbót_îr‹s
;

33 
__u32
 
	mtx_wödow_îr‹s
;

36 
__u32
 
	mrx_com¥es£d
;

37 
__u32
 
	mtx_com¥es£d
;

41 
	sπ∆_lök_°©s64
 {

42 
__u64
 
	mrx_∑ckës
;

43 
__u64
 
	mtx_∑ckës
;

44 
__u64
 
	mrx_byãs
;

45 
__u64
 
	mtx_byãs
;

46 
__u64
 
	mrx_îr‹s
;

47 
__u64
 
	mtx_îr‹s
;

48 
__u64
 
	mrx_dr›≥d
;

49 
__u64
 
	mtx_dr›≥d
;

50 
__u64
 
	mmu…iˇ°
;

51 
__u64
 
	mcﬁlisi⁄s
;

54 
__u64
 
	mrx_Àngth_îr‹s
;

55 
__u64
 
	mrx_ovî_îr‹s
;

56 
__u64
 
	mrx_¸c_îr‹s
;

57 
__u64
 
	mrx_‰ame_îr‹s
;

58 
__u64
 
	mrx_fifo_îr‹s
;

59 
__u64
 
	mrx_mis£d_îr‹s
;

62 
__u64
 
	mtx_ab‹ãd_îr‹s
;

63 
__u64
 
	mtx_ˇºõr_îr‹s
;

64 
__u64
 
	mtx_fifo_îr‹s
;

65 
__u64
 
	mtx_hóπbót_îr‹s
;

66 
__u64
 
	mtx_wödow_îr‹s
;

69 
__u64
 
	mrx_com¥es£d
;

70 
__u64
 
	mtx_com¥es£d
;

74 
	sπ∆_lök_ifm≠
 {

75 
__u64
 
	mmem_°¨t
;

76 
__u64
 
	mmem_íd
;

77 
__u64
 
	mba£_addr
;

78 
__u16
 
	múq
;

79 
__u8
 
	mdma
;

80 
__u8
 
	mp‹t
;

102 
	mIFLA_UNSPEC
,

103 
	mIFLA_ADDRESS
,

104 
	mIFLA_BROADCAST
,

105 
	mIFLA_IFNAME
,

106 
	mIFLA_MTU
,

107 
	mIFLA_LINK
,

108 
	mIFLA_QDISC
,

109 
	mIFLA_STATS
,

110 
	mIFLA_COST
,

111 
	#IFLA_COST
 
IFLA_COST


	)

112 
	mIFLA_PRIORITY
,

113 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

114 
	mIFLA_MASTER
,

115 
	#IFLA_MASTER
 
IFLA_MASTER


	)

116 
	mIFLA_WIRELESS
,

117 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

118 
	mIFLA_PROTINFO
,

119 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

120 
	mIFLA_TXQLEN
,

121 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

122 
	mIFLA_MAP
,

123 
	#IFLA_MAP
 
IFLA_MAP


	)

124 
	mIFLA_WEIGHT
,

125 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

126 
	mIFLA_OPERSTATE
,

127 
	mIFLA_LINKMODE
,

128 
	mIFLA_LINKINFO
,

129 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

130 
	mIFLA_NET_NS_PID
,

131 
	mIFLA_IFALIAS
,

132 
	mIFLA_NUM_VF
,

133 
	mIFLA_VFINFO_LIST
,

134 
	mIFLA_STATS64
,

135 
	mIFLA_VF_PORTS
,

136 
	mIFLA_PORT_SELF
,

137 
	mIFLA_AF_SPEC
,

138 
	mIFLA_GROUP
,

139 
	mIFLA_NET_NS_FD
,

140 
	mIFLA_EXT_MASK
,

141 
	mIFLA_PROMISCUITY
,

142 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

143 
	mIFLA_NUM_TX_QUEUES
,

144 
	mIFLA_NUM_RX_QUEUES
,

145 
	mIFLA_CARRIER
,

146 
	mIFLA_PHYS_PORT_ID
,

147 
	mIFLA_CARRIER_CHANGES
,

148 
	mIFLA_PHYS_SWITCH_ID
,

149 
	mIFLA_LINK_NETNSID
,

150 
	mIFLA_PHYS_PORT_NAME
,

151 
	mIFLA_PROTO_DOWN
,

152 
	m__IFLA_MAX


156 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

159 
	#IFLA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iföfomsg
))))

	)

160 
	#IFLA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iföfomsg
))

	)

163 
	mIFLA_INET_UNSPEC
,

164 
	mIFLA_INET_CONF
,

165 
	m__IFLA_INET_MAX
,

168 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

201 
	mIFLA_INET6_UNSPEC
,

202 
	mIFLA_INET6_FLAGS
,

203 
	mIFLA_INET6_CONF
,

204 
	mIFLA_INET6_STATS
,

205 
	mIFLA_INET6_MCAST
,

206 
	mIFLA_INET6_CACHEINFO
,

207 
	mIFLA_INET6_ICMP6STATS
,

208 
	mIFLA_INET6_TOKEN
,

209 
	mIFLA_INET6_ADDR_GEN_MODE
,

210 
	m__IFLA_INET6_MAX


213 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

215 
	eö6_addr_gí_mode
 {

216 
	mIN6_ADDR_GEN_MODE_EUI64
,

217 
	mIN6_ADDR_GEN_MODE_NONE
,

218 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

224 
	mIFLA_BR_UNSPEC
,

225 
	mIFLA_BR_FORWARD_DELAY
,

226 
	mIFLA_BR_HELLO_TIME
,

227 
	mIFLA_BR_MAX_AGE
,

228 
	mIFLA_BR_AGEING_TIME
,

229 
	mIFLA_BR_STP_STATE
,

230 
	mIFLA_BR_PRIORITY
,

231 
	mIFLA_BR_VLAN_FILTERING
,

232 
	mIFLA_BR_VLAN_PROTOCOL
,

233 
	mIFLA_BR_GROUP_FWD_MASK
,

234 
	mIFLA_BR_ROOT_ID
,

235 
	mIFLA_BR_BRIDGE_ID
,

236 
	mIFLA_BR_ROOT_PORT
,

237 
	mIFLA_BR_ROOT_PATH_COST
,

238 
	mIFLA_BR_TOPOLOGY_CHANGE
,

239 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

240 
	mIFLA_BR_HELLO_TIMER
,

241 
	mIFLA_BR_TCN_TIMER
,

242 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

243 
	mIFLA_BR_GC_TIMER
,

244 
	mIFLA_BR_GROUP_ADDR
,

245 
	mIFLA_BR_FDB_FLUSH
,

246 
	mIFLA_BR_MCAST_ROUTER
,

247 
	mIFLA_BR_MCAST_SNOOPING
,

248 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

249 
	mIFLA_BR_MCAST_QUERIER
,

250 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

251 
	mIFLA_BR_MCAST_HASH_MAX
,

252 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

253 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

254 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

255 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

256 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

257 
	mIFLA_BR_MCAST_QUERY_INTVL
,

258 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

259 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

260 
	mIFLA_BR_NF_CALL_IPTABLES
,

261 
	mIFLA_BR_NF_CALL_IP6TABLES
,

262 
	mIFLA_BR_NF_CALL_ARPTABLES
,

263 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

264 
	m__IFLA_BR_MAX
,

267 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

269 
	siÊa_bridge_id
 {

270 
__u8
 
	m¥io
[2];

271 
__u8
 
	maddr
[6];

275 
	mBRIDGE_MODE_UNSPEC
,

276 
	mBRIDGE_MODE_HAIRPIN
,

280 
	mIFLA_BRPORT_UNSPEC
,

281 
	mIFLA_BRPORT_STATE
,

282 
	mIFLA_BRPORT_PRIORITY
,

283 
	mIFLA_BRPORT_COST
,

284 
	mIFLA_BRPORT_MODE
,

285 
	mIFLA_BRPORT_GUARD
,

286 
	mIFLA_BRPORT_PROTECT
,

287 
	mIFLA_BRPORT_FAST_LEAVE
,

288 
	mIFLA_BRPORT_LEARNING
,

289 
	mIFLA_BRPORT_UNICAST_FLOOD
,

290 
	mIFLA_BRPORT_PROXYARP
,

291 
	mIFLA_BRPORT_LEARNING_SYNC
,

292 
	mIFLA_BRPORT_PROXYARP_WIFI
,

293 
	mIFLA_BRPORT_ROOT_ID
,

294 
	mIFLA_BRPORT_BRIDGE_ID
,

295 
	mIFLA_BRPORT_DESIGNATED_PORT
,

296 
	mIFLA_BRPORT_DESIGNATED_COST
,

297 
	mIFLA_BRPORT_ID
,

298 
	mIFLA_BRPORT_NO
,

299 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

300 
	mIFLA_BRPORT_CONFIG_PENDING
,

301 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

302 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

303 
	mIFLA_BRPORT_HOLD_TIMER
,

304 
	mIFLA_BRPORT_FLUSH
,

305 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

306 
	m__IFLA_BRPORT_MAX


308 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

310 
	siÊa_ˇcheöfo
 {

311 
__u32
 
	mmax_ªasm_Àn
;

312 
__u32
 
	mt°amp
;

313 
__u32
 
	mªachabÀ_time
;

314 
__u32
 
	mªå™s_time
;

318 
	mIFLA_INFO_UNSPEC
,

319 
	mIFLA_INFO_KIND
,

320 
	mIFLA_INFO_DATA
,

321 
	mIFLA_INFO_XSTATS
,

322 
	mIFLA_INFO_SLAVE_KIND
,

323 
	mIFLA_INFO_SLAVE_DATA
,

324 
	m__IFLA_INFO_MAX
,

327 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

332 
	mIFLA_VLAN_UNSPEC
,

333 
	mIFLA_VLAN_ID
,

334 
	mIFLA_VLAN_FLAGS
,

335 
	mIFLA_VLAN_EGRESS_QOS
,

336 
	mIFLA_VLAN_INGRESS_QOS
,

337 
	mIFLA_VLAN_PROTOCOL
,

338 
	m__IFLA_VLAN_MAX
,

341 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

343 
	siÊa_vœn_Êags
 {

344 
__u32
 
	mÊags
;

345 
__u32
 
	mmask
;

349 
	mIFLA_VLAN_QOS_UNSPEC
,

350 
	mIFLA_VLAN_QOS_MAPPING
,

351 
	m__IFLA_VLAN_QOS_MAX


354 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

356 
	siÊa_vœn_qos_m≠pög
 {

357 
__u32
 
	m‰om
;

358 
__u32
 
	mto
;

363 
	mIFLA_MACVLAN_UNSPEC
,

364 
	mIFLA_MACVLAN_MODE
,

365 
	mIFLA_MACVLAN_FLAGS
,

366 
	mIFLA_MACVLAN_MACADDR_MODE
,

367 
	mIFLA_MACVLAN_MACADDR
,

368 
	mIFLA_MACVLAN_MACADDR_DATA
,

369 
	mIFLA_MACVLAN_MACADDR_COUNT
,

370 
	m__IFLA_MACVLAN_MAX
,

373 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

375 
	emacvœn_mode
 {

376 
	mMACVLAN_MODE_PRIVATE
 = 1,

377 
	mMACVLAN_MODE_VEPA
 = 2,

378 
	mMACVLAN_MODE_BRIDGE
 = 4,

379 
	mMACVLAN_MODE_PASSTHRU
 = 8,

380 
	mMACVLAN_MODE_SOURCE
 = 16,

383 
	emacvœn_maˇddr_mode
 {

384 
	mMACVLAN_MACADDR_ADD
,

385 
	mMACVLAN_MACADDR_DEL
,

386 
	mMACVLAN_MACADDR_FLUSH
,

387 
	mMACVLAN_MACADDR_SET
,

390 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

394 
	mIFLA_VRF_UNSPEC
,

395 
	mIFLA_VRF_TABLE
,

396 
	m__IFLA_VRF_MAX


399 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

403 
	mIFLA_IPVLAN_UNSPEC
,

404 
	mIFLA_IPVLAN_MODE
,

405 
	m__IFLA_IPVLAN_MAX


408 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

410 
	eùvœn_mode
 {

411 
	mIPVLAN_MODE_L2
 = 0,

412 
	mIPVLAN_MODE_L3
,

413 
	mIPVLAN_MODE_MAX


418 
	mIFLA_VXLAN_UNSPEC
,

419 
	mIFLA_VXLAN_ID
,

420 
	mIFLA_VXLAN_GROUP
,

421 
	mIFLA_VXLAN_LINK
,

422 
	mIFLA_VXLAN_LOCAL
,

423 
	mIFLA_VXLAN_TTL
,

424 
	mIFLA_VXLAN_TOS
,

425 
	mIFLA_VXLAN_LEARNING
,

426 
	mIFLA_VXLAN_AGEING
,

427 
	mIFLA_VXLAN_LIMIT
,

428 
	mIFLA_VXLAN_PORT_RANGE
,

429 
	mIFLA_VXLAN_PROXY
,

430 
	mIFLA_VXLAN_RSC
,

431 
	mIFLA_VXLAN_L2MISS
,

432 
	mIFLA_VXLAN_L3MISS
,

433 
	mIFLA_VXLAN_PORT
,

434 
	mIFLA_VXLAN_GROUP6
,

435 
	mIFLA_VXLAN_LOCAL6
,

436 
	mIFLA_VXLAN_UDP_CSUM
,

437 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

438 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

439 
	mIFLA_VXLAN_REMCSUM_TX
,

440 
	mIFLA_VXLAN_REMCSUM_RX
,

441 
	mIFLA_VXLAN_GBP
,

442 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

443 
	mIFLA_VXLAN_COLLECT_METADATA
,

444 
	mIFLA_VXLAN_FAN_MAP
 = 33,

445 
	m__IFLA_VXLAN_MAX


447 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

449 
	siÊa_vxœn_p‹t_ønge
 {

450 
__be16
 
	mlow
;

451 
__be16
 
	mhigh
;

456 
	mIFLA_GENEVE_UNSPEC
,

457 
	mIFLA_GENEVE_ID
,

458 
	mIFLA_GENEVE_REMOTE
,

459 
	mIFLA_GENEVE_TTL
,

460 
	mIFLA_GENEVE_TOS
,

461 
	mIFLA_GENEVE_PORT
,

462 
	mIFLA_GENEVE_COLLECT_METADATA
,

463 
	mIFLA_GENEVE_REMOTE6
,

464 
	mIFLA_GENEVE_UDP_CSUM
,

465 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

466 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

467 
	m__IFLA_GENEVE_MAX


469 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

474 
	mIFLA_BOND_UNSPEC
,

475 
	mIFLA_BOND_MODE
,

476 
	mIFLA_BOND_ACTIVE_SLAVE
,

477 
	mIFLA_BOND_MIIMON
,

478 
	mIFLA_BOND_UPDELAY
,

479 
	mIFLA_BOND_DOWNDELAY
,

480 
	mIFLA_BOND_USE_CARRIER
,

481 
	mIFLA_BOND_ARP_INTERVAL
,

482 
	mIFLA_BOND_ARP_IP_TARGET
,

483 
	mIFLA_BOND_ARP_VALIDATE
,

484 
	mIFLA_BOND_ARP_ALL_TARGETS
,

485 
	mIFLA_BOND_PRIMARY
,

486 
	mIFLA_BOND_PRIMARY_RESELECT
,

487 
	mIFLA_BOND_FAIL_OVER_MAC
,

488 
	mIFLA_BOND_XMIT_HASH_POLICY
,

489 
	mIFLA_BOND_RESEND_IGMP
,

490 
	mIFLA_BOND_NUM_PEER_NOTIF
,

491 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

492 
	mIFLA_BOND_MIN_LINKS
,

493 
	mIFLA_BOND_LP_INTERVAL
,

494 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

495 
	mIFLA_BOND_AD_LACP_RATE
,

496 
	mIFLA_BOND_AD_SELECT
,

497 
	mIFLA_BOND_AD_INFO
,

498 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

499 
	mIFLA_BOND_AD_USER_PORT_KEY
,

500 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

501 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

502 
	m__IFLA_BOND_MAX
,

505 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

508 
	mIFLA_BOND_AD_INFO_UNSPEC
,

509 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

510 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

511 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

512 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

513 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

514 
	m__IFLA_BOND_AD_INFO_MAX
,

517 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

520 
	mIFLA_BOND_SLAVE_UNSPEC
,

521 
	mIFLA_BOND_SLAVE_STATE
,

522 
	mIFLA_BOND_SLAVE_MII_STATUS
,

523 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

524 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

525 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

526 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

527 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

528 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

529 
	m__IFLA_BOND_SLAVE_MAX
,

532 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

537 
	mIFLA_VF_INFO_UNSPEC
,

538 
	mIFLA_VF_INFO
,

539 
	m__IFLA_VF_INFO_MAX
,

542 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

545 
	mIFLA_VF_UNSPEC
,

546 
	mIFLA_VF_MAC
,

547 
	mIFLA_VF_VLAN
,

548 
	mIFLA_VF_TX_RATE
,

549 
	mIFLA_VF_SPOOFCHK
,

550 
	mIFLA_VF_LINK_STATE
,

551 
	mIFLA_VF_RATE
,

552 
	mIFLA_VF_RSS_QUERY_EN
,

555 
	mIFLA_VF_STATS
,

556 
	mIFLA_VF_TRUST
,

557 
	m__IFLA_VF_MAX
,

560 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

562 
	siÊa_vf_mac
 {

563 
__u32
 
	mvf
;

564 
__u8
 
	mmac
[32];

567 
	siÊa_vf_vœn
 {

568 
__u32
 
	mvf
;

569 
__u32
 
	mvœn
;

570 
__u32
 
	mqos
;

573 
	siÊa_vf_tx_øã
 {

574 
__u32
 
	mvf
;

575 
__u32
 
	møã
;

578 
	siÊa_vf_øã
 {

579 
__u32
 
	mvf
;

580 
__u32
 
	mmö_tx_øã
;

581 
__u32
 
	mmax_tx_øã
;

584 
	siÊa_vf_•oofchk
 {

585 
__u32
 
	mvf
;

586 
__u32
 
	m£âög
;

590 
	mIFLA_VF_LINK_STATE_AUTO
,

591 
	mIFLA_VF_LINK_STATE_ENABLE
,

592 
	mIFLA_VF_LINK_STATE_DISABLE
,

593 
	m__IFLA_VF_LINK_STATE_MAX
,

596 
	siÊa_vf_lök_°©e
 {

597 
__u32
 
	mvf
;

598 
__u32
 
	mlök_°©e
;

601 
	siÊa_vf_rss_quîy_í
 {

602 
__u32
 
	mvf
;

603 
__u32
 
	m£âög
;

607 
	mIFLA_VF_STATS_RX_PACKETS
,

608 
	mIFLA_VF_STATS_TX_PACKETS
,

609 
	mIFLA_VF_STATS_RX_BYTES
,

610 
	mIFLA_VF_STATS_TX_BYTES
,

611 
	mIFLA_VF_STATS_BROADCAST
,

612 
	mIFLA_VF_STATS_MULTICAST
,

613 
	m__IFLA_VF_STATS_MAX
,

616 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

618 
	siÊa_vf_åu°
 {

619 
__u32
 
	mvf
;

620 
__u32
 
	m£âög
;

639 
	mIFLA_VF_PORT_UNSPEC
,

640 
	mIFLA_VF_PORT
,

641 
	m__IFLA_VF_PORT_MAX
,

644 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

647 
	mIFLA_PORT_UNSPEC
,

648 
	mIFLA_PORT_VF
,

649 
	mIFLA_PORT_PROFILE
,

650 
	mIFLA_PORT_VSI_TYPE
,

651 
	mIFLA_PORT_INSTANCE_UUID
,

652 
	mIFLA_PORT_HOST_UUID
,

653 
	mIFLA_PORT_REQUEST
,

654 
	mIFLA_PORT_RESPONSE
,

655 
	m__IFLA_PORT_MAX
,

658 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

660 
	#PORT_PROFILE_MAX
 40

	)

661 
	#PORT_UUID_MAX
 16

	)

662 
	#PORT_SELF_VF
 -1

	)

665 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

666 
	mPORT_REQUEST_PREASSOCIATE_RR
,

667 
	mPORT_REQUEST_ASSOCIATE
,

668 
	mPORT_REQUEST_DISASSOCIATE
,

672 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

673 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

674 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

675 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

676 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

677 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

678 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

680 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

681 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

682 
	mPORT_PROFILE_RESPONSE_INVALID
,

683 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

684 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

685 
	mPORT_PROFILE_RESPONSE_ERROR
,

688 
	siÊa_p‹t_vsi
 {

689 
__u8
 
	mvsi_mgr_id
;

690 
__u8
 
	mvsi_ty≥_id
[3];

691 
__u8
 
	mvsi_ty≥_vîsi⁄
;

692 
__u8
 
	m∑d
[3];

699 
	mIFLA_IPOIB_UNSPEC
,

700 
	mIFLA_IPOIB_PKEY
,

701 
	mIFLA_IPOIB_MODE
,

702 
	mIFLA_IPOIB_UMCAST
,

703 
	m__IFLA_IPOIB_MAX


707 
	mIPOIB_MODE_DATAGRAM
 = 0,

708 
	mIPOIB_MODE_CONNECTED
 = 1,

711 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

717 
	mIFLA_HSR_UNSPEC
,

718 
	mIFLA_HSR_SLAVE1
,

719 
	mIFLA_HSR_SLAVE2
,

720 
	mIFLA_HSR_MULTICAST_SPEC
,

721 
	mIFLA_HSR_SUPERVISION_ADDR
,

722 
	mIFLA_HSR_SEQ_NR
,

723 
	m__IFLA_HSR_MAX
,

726 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

	@/usr/include/linux/if_packet.h

1 #i‚de‡
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<löux/ty≥s.h
>

6 
	ssockaddr_pkt
 {

7 
	m•kt_Ámûy
;

8 
	m•kt_devi˚
[14];

9 
__be16
 
	m•kt_¥Ÿocﬁ
;

12 
	ssockaddr_Œ
 {

13 
	m¶l_Ámûy
;

14 
__be16
 
	m¶l_¥Ÿocﬁ
;

15 
	m¶l_ifödex
;

16 
	m¶l_h©y≥
;

17 
	m¶l_pkây≥
;

18 
	m¶l_hÆí
;

19 
	m¶l_addr
[8];

24 
	#PACKET_HOST
 0

	)

25 
	#PACKET_BROADCAST
 1

	)

26 
	#PACKET_MULTICAST
 2

	)

27 
	#PACKET_OTHERHOST
 3

	)

28 
	#PACKET_OUTGOING
 4

	)

29 
	#PACKET_LOOPBACK
 5

	)

30 
	#PACKET_USER
 6

	)

31 
	#PACKET_KERNEL
 7

	)

33 
	#PACKET_FASTROUTE
 6

	)

37 
	#PACKET_ADD_MEMBERSHIP
 1

	)

38 
	#PACKET_DROP_MEMBERSHIP
 2

	)

39 
	#PACKET_RECV_OUTPUT
 3

	)

41 
	#PACKET_RX_RING
 5

	)

42 
	#PACKET_STATISTICS
 6

	)

43 
	#PACKET_COPY_THRESH
 7

	)

44 
	#PACKET_AUXDATA
 8

	)

45 
	#PACKET_ORIGDEV
 9

	)

46 
	#PACKET_VERSION
 10

	)

47 
	#PACKET_HDRLEN
 11

	)

48 
	#PACKET_RESERVE
 12

	)

49 
	#PACKET_TX_RING
 13

	)

50 
	#PACKET_LOSS
 14

	)

51 
	#PACKET_VNET_HDR
 15

	)

52 
	#PACKET_TX_TIMESTAMP
 16

	)

53 
	#PACKET_TIMESTAMP
 17

	)

54 
	#PACKET_FANOUT
 18

	)

55 
	#PACKET_TX_HAS_OFF
 19

	)

56 
	#PACKET_QDISC_BYPASS
 20

	)

57 
	#PACKET_ROLLOVER_STATS
 21

	)

58 
	#PACKET_FANOUT_DATA
 22

	)

60 
	#PACKET_FANOUT_HASH
 0

	)

61 
	#PACKET_FANOUT_LB
 1

	)

62 
	#PACKET_FANOUT_CPU
 2

	)

63 
	#PACKET_FANOUT_ROLLOVER
 3

	)

64 
	#PACKET_FANOUT_RND
 4

	)

65 
	#PACKET_FANOUT_QM
 5

	)

66 
	#PACKET_FANOUT_CBPF
 6

	)

67 
	#PACKET_FANOUT_EBPF
 7

	)

68 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

69 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

71 
	sçackë_°©s
 {

72 
	mç_∑ckës
;

73 
	mç_dr›s
;

76 
	sçackë_°©s_v3
 {

77 
	mç_∑ckës
;

78 
	mç_dr›s
;

79 
	mç_‰ìze_q_˙t
;

82 
	sçackë_rﬁlovî_°©s
 {

83 
__Æig√d_u64
 
	mç_Æl
;

84 
__Æig√d_u64
 
	mç_huge
;

85 
__Æig√d_u64
 
	mç_Áûed
;

88 
	uçackë_°©s_u
 {

89 
çackë_°©s
 
	m°©s1
;

90 
çackë_°©s_v3
 
	m°©s3
;

93 
	sçackë_auxd©a
 {

94 
__u32
 
	mç_°©us
;

95 
__u32
 
	mç_Àn
;

96 
__u32
 
	mç_¢≠Àn
;

97 
__u16
 
	mç_mac
;

98 
__u16
 
	mç_√t
;

99 
__u16
 
	mç_vœn_tci
;

100 
__u16
 
	mç_vœn_çid
;

104 
	#TP_STATUS_KERNEL
 0

	)

105 
	#TP_STATUS_USER
 (1 << 0)

	)

106 
	#TP_STATUS_COPY
 (1 << 1)

	)

107 
	#TP_STATUS_LOSING
 (1 << 2)

	)

108 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

109 
	#TP_STATUS_VLAN_VALID
 (1 << 4Ë

	)

110 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

111 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6Ë

	)

112 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

115 
	#TP_STATUS_AVAILABLE
 0

	)

116 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

117 
	#TP_STATUS_SENDING
 (1 << 1)

	)

118 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

121 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

122 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30Ë

	)

123 
	#TP_STATUS_TS_RAW_HARDWARE
 (1 << 31)

	)

126 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

128 
	sçackë_hdr
 {

129 
	mç_°©us
;

130 
	mç_Àn
;

131 
	mç_¢≠Àn
;

132 
	mç_mac
;

133 
	mç_√t
;

134 
	mç_£c
;

135 
	mç_u£c
;

138 
	#TPACKET_ALIGNMENT
 16

	)

139 
	#TPACKET_ALIGN
(
x
Ë(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

140 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë_hdr
)Ë+ (
sockaddr_Œ
))

	)

142 
	sçackë2_hdr
 {

143 
__u32
 
	mç_°©us
;

144 
__u32
 
	mç_Àn
;

145 
__u32
 
	mç_¢≠Àn
;

146 
__u16
 
	mç_mac
;

147 
__u16
 
	mç_√t
;

148 
__u32
 
	mç_£c
;

149 
__u32
 
	mç_n£c
;

150 
__u16
 
	mç_vœn_tci
;

151 
__u16
 
	mç_vœn_çid
;

152 
__u8
 
	mç_∑ddög
[4];

155 
	sçackë_hdr_v¨ü¡1
 {

156 
__u32
 
	mç_rxhash
;

157 
__u32
 
	mç_vœn_tci
;

158 
__u16
 
	mç_vœn_çid
;

159 
__u16
 
	mç_∑ddög
;

162 
	sçackë3_hdr
 {

163 
__u32
 
	mç_√xt_off£t
;

164 
__u32
 
	mç_£c
;

165 
__u32
 
	mç_n£c
;

166 
__u32
 
	mç_¢≠Àn
;

167 
__u32
 
	mç_Àn
;

168 
__u32
 
	mç_°©us
;

169 
__u16
 
	mç_mac
;

170 
__u16
 
	mç_√t
;

173 
çackë_hdr_v¨ü¡1
 
	mhv1
;

175 
__u8
 
	mç_∑ddög
[8];

178 
	sçackë_bd_ts
 {

179 
	mts_£c
;

181 
	mts_u£c
;

182 
	mts_n£c
;

186 
	sçackë_hdr_v1
 {

187 
__u32
 
	mblock_°©us
;

188 
__u32
 
	mnum_pkts
;

189 
__u32
 
	moff£t_to_fú°_pkt
;

194 
__u32
 
	mblk_Àn
;

205 
__Æig√d_u64
 
	m£q_num
;

232 
çackë_bd_ts
 
	mts_fú°_pkt
, 
	mts_œ°_pkt
;

235 
	uçackë_bd_hódî_u
 {

236 
çackë_hdr_v1
 
	mbh1
;

239 
	sçackë_block_desc
 {

240 
__u32
 
	mvîsi⁄
;

241 
__u32
 
	moff£t_to_¥iv
;

242 
çackë_bd_hódî_u
 
	mhdr
;

245 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë2_hdr
)Ë+ (
sockaddr_Œ
))

	)

246 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë3_hdr
)Ë+ (
sockaddr_Œ
))

	)

248 
	eçackë_vîsi⁄s
 {

249 
	mTPACKET_V1
,

250 
	mTPACKET_V2
,

251 
	mTPACKET_V3


267 
	sçackë_ªq
 {

268 
	mç_block_size
;

269 
	mç_block_ƒ
;

270 
	mç_‰ame_size
;

271 
	mç_‰ame_ƒ
;

274 
	sçackë_ªq3
 {

275 
	mç_block_size
;

276 
	mç_block_ƒ
;

277 
	mç_‰ame_size
;

278 
	mç_‰ame_ƒ
;

279 
	mç_ªtúe_blk_tov
;

280 
	mç_sizeof_¥iv
;

281 
	mç_„©uª_ªq_w‹d
;

284 
	uçackë_ªq_u
 {

285 
çackë_ªq
 
	mªq
;

286 
çackë_ªq3
 
	mªq3
;

289 
	s∑ckë_mªq
 {

290 
	mmr_ifödex
;

291 
	mmr_ty≥
;

292 
	mmr_Æí
;

293 
	mmr_addªss
[8];

296 
	#PACKET_MR_MULTICAST
 0

	)

297 
	#PACKET_MR_PROMISC
 1

	)

298 
	#PACKET_MR_ALLMULTI
 2

	)

299 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/ioctl.h

1 #i‚de‡
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/io˘l.h
>

	@/usr/include/linux/irqnr.h

	@/usr/include/linux/pci_regs.h

22 #i‚de‡
LINUX_PCI_REGS_H


23 
	#LINUX_PCI_REGS_H


	)

29 
	#PCI_STD_HEADER_SIZEOF
 64

	)

30 
	#PCI_VENDOR_ID
 0x00

	)

31 
	#PCI_DEVICE_ID
 0x02

	)

32 
	#PCI_COMMAND
 0x04

	)

33 
	#PCI_COMMAND_IO
 0x1

	)

34 
	#PCI_COMMAND_MEMORY
 0x2

	)

35 
	#PCI_COMMAND_MASTER
 0x4

	)

36 
	#PCI_COMMAND_SPECIAL
 0x8

	)

37 
	#PCI_COMMAND_INVALIDATE
 0x10

	)

38 
	#PCI_COMMAND_VGA_PALETTE
 0x20

	)

39 
	#PCI_COMMAND_PARITY
 0x40

	)

40 
	#PCI_COMMAND_WAIT
 0x80

	)

41 
	#PCI_COMMAND_SERR
 0x100

	)

42 
	#PCI_COMMAND_FAST_BACK
 0x200

	)

43 
	#PCI_COMMAND_INTX_DISABLE
 0x400

	)

45 
	#PCI_STATUS
 0x06

	)

46 
	#PCI_STATUS_INTERRUPT
 0x08

	)

47 
	#PCI_STATUS_CAP_LIST
 0x10

	)

48 
	#PCI_STATUS_66MHZ
 0x20

	)

49 
	#PCI_STATUS_UDF
 0x40

	)

50 
	#PCI_STATUS_FAST_BACK
 0x80

	)

51 
	#PCI_STATUS_PARITY
 0x100

	)

52 
	#PCI_STATUS_DEVSEL_MASK
 0x600

	)

53 
	#PCI_STATUS_DEVSEL_FAST
 0x000

	)

54 
	#PCI_STATUS_DEVSEL_MEDIUM
 0x200

	)

55 
	#PCI_STATUS_DEVSEL_SLOW
 0x400

	)

56 
	#PCI_STATUS_SIG_TARGET_ABORT
 0x800

	)

57 
	#PCI_STATUS_REC_TARGET_ABORT
 0x1000

	)

58 
	#PCI_STATUS_REC_MASTER_ABORT
 0x2000

	)

59 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 0x4000

	)

60 
	#PCI_STATUS_DETECTED_PARITY
 0x8000

	)

62 
	#PCI_CLASS_REVISION
 0x08

	)

63 
	#PCI_REVISION_ID
 0x08

	)

64 
	#PCI_CLASS_PROG
 0x09

	)

65 
	#PCI_CLASS_DEVICE
 0x0®

	)

67 
	#PCI_CACHE_LINE_SIZE
 0x0¯

	)

68 
	#PCI_LATENCY_TIMER
 0x0d

	)

69 
	#PCI_HEADER_TYPE
 0x0ê

	)

70 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

71 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

72 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

74 
	#PCI_BIST
 0x0‡

	)

75 
	#PCI_BIST_CODE_MASK
 0x0‡

	)

76 
	#PCI_BIST_START
 0x40

	)

77 
	#PCI_BIST_CAPABLE
 0x80

	)

85 
	#PCI_BASE_ADDRESS_0
 0x10

	)

86 
	#PCI_BASE_ADDRESS_1
 0x14

	)

87 
	#PCI_BASE_ADDRESS_2
 0x18

	)

88 
	#PCI_BASE_ADDRESS_3
 0x1¯

	)

89 
	#PCI_BASE_ADDRESS_4
 0x20

	)

90 
	#PCI_BASE_ADDRESS_5
 0x24

	)

91 
	#PCI_BASE_ADDRESS_SPACE
 0x01

	)

92 
	#PCI_BASE_ADDRESS_SPACE_IO
 0x01

	)

93 
	#PCI_BASE_ADDRESS_SPACE_MEMORY
 0x00

	)

94 
	#PCI_BASE_ADDRESS_MEM_TYPE_MASK
 0x06

	)

95 
	#PCI_BASE_ADDRESS_MEM_TYPE_32
 0x00

	)

96 
	#PCI_BASE_ADDRESS_MEM_TYPE_1M
 0x02

	)

97 
	#PCI_BASE_ADDRESS_MEM_TYPE_64
 0x04

	)

98 
	#PCI_BASE_ADDRESS_MEM_PREFETCH
 0x08

	)

99 
	#PCI_BASE_ADDRESS_MEM_MASK
 (~0x0fUL)

	)

100 
	#PCI_BASE_ADDRESS_IO_MASK
 (~0x03UL)

	)

104 
	#PCI_CARDBUS_CIS
 0x28

	)

105 
	#PCI_SUBSYSTEM_VENDOR_ID
 0x2c

	)

106 
	#PCI_SUBSYSTEM_ID
 0x2e

	)

107 
	#PCI_ROM_ADDRESS
 0x30

	)

108 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

109 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffUL)

	)

111 
	#PCI_CAPABILITY_LIST
 0x34

	)

114 
	#PCI_INTERRUPT_LINE
 0x3¯

	)

115 
	#PCI_INTERRUPT_PIN
 0x3d

	)

116 
	#PCI_MIN_GNT
 0x3ê

	)

117 
	#PCI_MAX_LAT
 0x3‡

	)

120 
	#PCI_PRIMARY_BUS
 0x18

	)

121 
	#PCI_SECONDARY_BUS
 0x19

	)

122 
	#PCI_SUBORDINATE_BUS
 0x1®

	)

123 
	#PCI_SEC_LATENCY_TIMER
 0x1b

	)

124 
	#PCI_IO_BASE
 0x1¯

	)

125 
	#PCI_IO_LIMIT
 0x1d

	)

126 
	#PCI_IO_RANGE_TYPE_MASK
 0x0fUL

	)

127 
	#PCI_IO_RANGE_TYPE_16
 0x00

	)

128 
	#PCI_IO_RANGE_TYPE_32
 0x01

	)

129 
	#PCI_IO_RANGE_MASK
 (~0x0fULË

	)

130 
	#PCI_IO_1K_RANGE_MASK
 (~0x03ULË

	)

131 
	#PCI_SEC_STATUS
 0x1ê

	)

132 
	#PCI_MEMORY_BASE
 0x20

	)

133 
	#PCI_MEMORY_LIMIT
 0x22

	)

134 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

135 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

136 
	#PCI_PREF_MEMORY_BASE
 0x24

	)

137 
	#PCI_PREF_MEMORY_LIMIT
 0x26

	)

138 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

139 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

140 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

141 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

142 
	#PCI_PREF_BASE_UPPER32
 0x28

	)

143 
	#PCI_PREF_LIMIT_UPPER32
 0x2c

	)

144 
	#PCI_IO_BASE_UPPER16
 0x30

	)

145 
	#PCI_IO_LIMIT_UPPER16
 0x32

	)

148 
	#PCI_ROM_ADDRESS1
 0x38

	)

150 
	#PCI_BRIDGE_CONTROL
 0x3e

	)

151 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

152 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

153 
	#PCI_BRIDGE_CTL_ISA
 0x04

	)

154 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

155 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

156 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

157 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

160 
	#PCI_CB_CAPABILITY_LIST
 0x14

	)

162 
	#PCI_CB_SEC_STATUS
 0x16

	)

163 
	#PCI_CB_PRIMARY_BUS
 0x18

	)

164 
	#PCI_CB_CARD_BUS
 0x19

	)

165 
	#PCI_CB_SUBORDINATE_BUS
 0x1®

	)

166 
	#PCI_CB_LATENCY_TIMER
 0x1b

	)

167 
	#PCI_CB_MEMORY_BASE_0
 0x1c

	)

168 
	#PCI_CB_MEMORY_LIMIT_0
 0x20

	)

169 
	#PCI_CB_MEMORY_BASE_1
 0x24

	)

170 
	#PCI_CB_MEMORY_LIMIT_1
 0x28

	)

171 
	#PCI_CB_IO_BASE_0
 0x2c

	)

172 
	#PCI_CB_IO_BASE_0_HI
 0x2e

	)

173 
	#PCI_CB_IO_LIMIT_0
 0x30

	)

174 
	#PCI_CB_IO_LIMIT_0_HI
 0x32

	)

175 
	#PCI_CB_IO_BASE_1
 0x34

	)

176 
	#PCI_CB_IO_BASE_1_HI
 0x36

	)

177 
	#PCI_CB_IO_LIMIT_1
 0x38

	)

178 
	#PCI_CB_IO_LIMIT_1_HI
 0x3a

	)

179 
	#PCI_CB_IO_RANGE_MASK
 (~0x03UL)

	)

181 
	#PCI_CB_BRIDGE_CONTROL
 0x3e

	)

182 
	#PCI_CB_BRIDGE_CTL_PARITY
 0x01

	)

183 
	#PCI_CB_BRIDGE_CTL_SERR
 0x02

	)

184 
	#PCI_CB_BRIDGE_CTL_ISA
 0x04

	)

185 
	#PCI_CB_BRIDGE_CTL_VGA
 0x08

	)

186 
	#PCI_CB_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

187 
	#PCI_CB_BRIDGE_CTL_CB_RESET
 0x40

	)

188 
	#PCI_CB_BRIDGE_CTL_16BIT_INT
 0x80

	)

189 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM0
 0x100

	)

190 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM1
 0x200

	)

191 
	#PCI_CB_BRIDGE_CTL_POST_WRITES
 0x400

	)

192 
	#PCI_CB_SUBSYSTEM_VENDOR_ID
 0x40

	)

193 
	#PCI_CB_SUBSYSTEM_ID
 0x42

	)

194 
	#PCI_CB_LEGACY_MODE_BASE
 0x44

	)

199 
	#PCI_CAP_LIST_ID
 0

	)

200 
	#PCI_CAP_ID_PM
 0x01

	)

201 
	#PCI_CAP_ID_AGP
 0x02

	)

202 
	#PCI_CAP_ID_VPD
 0x03

	)

203 
	#PCI_CAP_ID_SLOTID
 0x04

	)

204 
	#PCI_CAP_ID_MSI
 0x05

	)

205 
	#PCI_CAP_ID_CHSWP
 0x06

	)

206 
	#PCI_CAP_ID_PCIX
 0x07

	)

207 
	#PCI_CAP_ID_HT
 0x08

	)

208 
	#PCI_CAP_ID_VNDR
 0x09

	)

209 
	#PCI_CAP_ID_DBG
 0x0A

	)

210 
	#PCI_CAP_ID_CCRC
 0x0B

	)

211 
	#PCI_CAP_ID_SHPC
 0x0C

	)

212 
	#PCI_CAP_ID_SSVID
 0x0D

	)

213 
	#PCI_CAP_ID_AGP3
 0x0E

	)

214 
	#PCI_CAP_ID_SECDEV
 0x0F

	)

215 
	#PCI_CAP_ID_EXP
 0x10

	)

216 
	#PCI_CAP_ID_MSIX
 0x11

	)

217 
	#PCI_CAP_ID_SATA
 0x12

	)

218 
	#PCI_CAP_ID_AF
 0x13

	)

219 
	#PCI_CAP_ID_EA
 0x14

	)

220 
	#PCI_CAP_ID_MAX
 
PCI_CAP_ID_EA


	)

221 
	#PCI_CAP_LIST_NEXT
 1

	)

222 
	#PCI_CAP_FLAGS
 2

	)

223 
	#PCI_CAP_SIZEOF
 4

	)

227 
	#PCI_PM_PMC
 2

	)

228 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

229 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

230 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

231 
	#PCI_PM_CAP_DSI
 0x0020

	)

232 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

233 
	#PCI_PM_CAP_D1
 0x0200

	)

234 
	#PCI_PM_CAP_D2
 0x0400

	)

235 
	#PCI_PM_CAP_PME
 0x0800

	)

236 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

237 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

238 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

239 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

240 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

241 
	#PCI_PM_CAP_PME_D3cﬁd
 0x8000

	)

242 
	#PCI_PM_CAP_PME_SHIFT
 11

	)

243 
	#PCI_PM_CTRL
 4

	)

244 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

245 
	#PCI_PM_CTRL_NO_SOFT_RESET
 0x0008

	)

246 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

247 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

248 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

249 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

250 
	#PCI_PM_PPB_EXTENSIONS
 6

	)

251 
	#PCI_PM_PPB_B2_B3
 0x40

	)

252 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

253 
	#PCI_PM_DATA_REGISTER
 7

	)

254 
	#PCI_PM_SIZEOF
 8

	)

258 
	#PCI_AGP_VERSION
 2

	)

259 
	#PCI_AGP_RFU
 3

	)

260 
	#PCI_AGP_STATUS
 4

	)

261 
	#PCI_AGP_STATUS_RQ_MASK
 0xff000000

	)

262 
	#PCI_AGP_STATUS_SBA
 0x0200

	)

263 
	#PCI_AGP_STATUS_64BIT
 0x0020

	)

264 
	#PCI_AGP_STATUS_FW
 0x0010

	)

265 
	#PCI_AGP_STATUS_RATE4
 0x0004

	)

266 
	#PCI_AGP_STATUS_RATE2
 0x0002

	)

267 
	#PCI_AGP_STATUS_RATE1
 0x0001

	)

268 
	#PCI_AGP_COMMAND
 8

	)

269 
	#PCI_AGP_COMMAND_RQ_MASK
 0xff000000

	)

270 
	#PCI_AGP_COMMAND_SBA
 0x0200

	)

271 
	#PCI_AGP_COMMAND_AGP
 0x0100

	)

272 
	#PCI_AGP_COMMAND_64BIT
 0x0020

	)

273 
	#PCI_AGP_COMMAND_FW
 0x0010

	)

274 
	#PCI_AGP_COMMAND_RATE4
 0x0004

	)

275 
	#PCI_AGP_COMMAND_RATE2
 0x0002

	)

276 
	#PCI_AGP_COMMAND_RATE1
 0x0001

	)

277 
	#PCI_AGP_SIZEOF
 12

	)

281 
	#PCI_VPD_ADDR
 2

	)

282 
	#PCI_VPD_ADDR_MASK
 0x7ff‡

	)

283 
	#PCI_VPD_ADDR_F
 0x8000

	)

284 
	#PCI_VPD_DATA
 4

	)

285 
	#PCI_CAP_VPD_SIZEOF
 8

	)

289 
	#PCI_SID_ESR
 2

	)

290 
	#PCI_SID_ESR_NSLOTS
 0x1‡

	)

291 
	#PCI_SID_ESR_FIC
 0x20

	)

292 
	#PCI_SID_CHASSIS_NR
 3

	)

296 
	#PCI_MSI_FLAGS
 2

	)

297 
	#PCI_MSI_FLAGS_ENABLE
 0x0001

	)

298 
	#PCI_MSI_FLAGS_QMASK
 0x000ê

	)

299 
	#PCI_MSI_FLAGS_QSIZE
 0x0070

	)

300 
	#PCI_MSI_FLAGS_64BIT
 0x0080

	)

301 
	#PCI_MSI_FLAGS_MASKBIT
 0x0100

	)

302 
	#PCI_MSI_RFU
 3

	)

303 
	#PCI_MSI_ADDRESS_LO
 4

	)

304 
	#PCI_MSI_ADDRESS_HI
 8

	)

305 
	#PCI_MSI_DATA_32
 8

	)

306 
	#PCI_MSI_MASK_32
 12

	)

307 
	#PCI_MSI_PENDING_32
 16

	)

308 
	#PCI_MSI_DATA_64
 12

	)

309 
	#PCI_MSI_MASK_64
 16

	)

310 
	#PCI_MSI_PENDING_64
 20

	)

313 
	#PCI_MSIX_FLAGS
 2

	)

314 
	#PCI_MSIX_FLAGS_QSIZE
 0x07FF

	)

315 
	#PCI_MSIX_FLAGS_MASKALL
 0x4000

	)

316 
	#PCI_MSIX_FLAGS_ENABLE
 0x8000

	)

317 
	#PCI_MSIX_TABLE
 4

	)

318 
	#PCI_MSIX_TABLE_BIR
 0x00000007

	)

319 
	#PCI_MSIX_TABLE_OFFSET
 0xfffffff8

	)

320 
	#PCI_MSIX_PBA
 8

	)

321 
	#PCI_MSIX_PBA_BIR
 0x00000007

	)

322 
	#PCI_MSIX_PBA_OFFSET
 0xfffffff8

	)

323 
	#PCI_MSIX_FLAGS_BIRMASK
 
PCI_MSIX_PBA_BIR


	)

324 
	#PCI_CAP_MSIX_SIZEOF
 12

	)

327 
	#PCI_MSIX_ENTRY_SIZE
 16

	)

328 
	#PCI_MSIX_ENTRY_LOWER_ADDR
 0

	)

329 
	#PCI_MSIX_ENTRY_UPPER_ADDR
 4

	)

330 
	#PCI_MSIX_ENTRY_DATA
 8

	)

331 
	#PCI_MSIX_ENTRY_VECTOR_CTRL
 12

	)

332 
	#PCI_MSIX_ENTRY_CTRL_MASKBIT
 1

	)

336 
	#PCI_CHSWP_CSR
 2

	)

337 
	#PCI_CHSWP_DHA
 0x01

	)

338 
	#PCI_CHSWP_EIM
 0x02

	)

339 
	#PCI_CHSWP_PIE
 0x04

	)

340 
	#PCI_CHSWP_LOO
 0x08

	)

341 
	#PCI_CHSWP_PI
 0x30

	)

342 
	#PCI_CHSWP_EXT
 0x40

	)

343 
	#PCI_CHSWP_INS
 0x80

	)

347 
	#PCI_AF_LENGTH
 2

	)

348 
	#PCI_AF_CAP
 3

	)

349 
	#PCI_AF_CAP_TP
 0x01

	)

350 
	#PCI_AF_CAP_FLR
 0x02

	)

351 
	#PCI_AF_CTRL
 4

	)

352 
	#PCI_AF_CTRL_FLR
 0x01

	)

353 
	#PCI_AF_STATUS
 5

	)

354 
	#PCI_AF_STATUS_TP
 0x01

	)

355 
	#PCI_CAP_AF_SIZEOF
 6

	)

359 
	#PCI_EA_NUM_ENT
 2

	)

360 
	#PCI_EA_NUM_ENT_MASK
 0x3‡

	)

361 
	#PCI_EA_FIRST_ENT
 4

	)

362 
	#PCI_EA_FIRST_ENT_BRIDGE
 8

	)

363 
	#PCI_EA_ES
 0x00000007

	)

364 
	#PCI_EA_BEI
 0x000000f0

	)

366 
	#PCI_EA_BEI_BAR0
 0

	)

367 
	#PCI_EA_BEI_BAR5
 5

	)

368 
	#PCI_EA_BEI_BRIDGE
 6

	)

369 
	#PCI_EA_BEI_ENI
 7

	)

370 
	#PCI_EA_BEI_ROM
 8

	)

372 
	#PCI_EA_BEI_VF_BAR0
 9

	)

373 
	#PCI_EA_BEI_VF_BAR5
 14

	)

374 
	#PCI_EA_BEI_RESERVED
 15

	)

375 
	#PCI_EA_PP
 0x0000ff00

	)

376 
	#PCI_EA_SP
 0x00ff0000

	)

377 
	#PCI_EA_P_MEM
 0x00

	)

378 
	#PCI_EA_P_MEM_PREFETCH
 0x01

	)

379 
	#PCI_EA_P_IO
 0x02

	)

380 
	#PCI_EA_P_VF_MEM_PREFETCH
 0x03

	)

381 
	#PCI_EA_P_VF_MEM
 0x04

	)

382 
	#PCI_EA_P_BRIDGE_MEM
 0x05

	)

383 
	#PCI_EA_P_BRIDGE_MEM_PREFETCH
 0x06

	)

384 
	#PCI_EA_P_BRIDGE_IO
 0x07

	)

386 
	#PCI_EA_P_MEM_RESERVED
 0xfd

	)

387 
	#PCI_EA_P_IO_RESERVED
 0x„

	)

388 
	#PCI_EA_P_UNAVAILABLE
 0xf‡

	)

389 
	#PCI_EA_WRITABLE
 0x40000000

	)

390 
	#PCI_EA_ENABLE
 0x80000000

	)

391 
	#PCI_EA_BASE
 4

	)

392 
	#PCI_EA_MAX_OFFSET
 8

	)

394 
	#PCI_EA_IS_64
 0x00000002

	)

395 
	#PCI_EA_FIELD_MASK
 0xfffffff¯

	)

399 
	#PCI_X_CMD
 2

	)

400 
	#PCI_X_CMD_DPERR_E
 0x0001

	)

401 
	#PCI_X_CMD_ERO
 0x0002

	)

402 
	#PCI_X_CMD_READ_512
 0x0000

	)

403 
	#PCI_X_CMD_READ_1K
 0x0004

	)

404 
	#PCI_X_CMD_READ_2K
 0x0008

	)

405 
	#PCI_X_CMD_READ_4K
 0x000¯

	)

406 
	#PCI_X_CMD_MAX_READ
 0x000¯

	)

408 
	#PCI_X_CMD_SPLIT_1
 0x0000

	)

409 
	#PCI_X_CMD_SPLIT_2
 0x0010

	)

410 
	#PCI_X_CMD_SPLIT_3
 0x0020

	)

411 
	#PCI_X_CMD_SPLIT_4
 0x0030

	)

412 
	#PCI_X_CMD_SPLIT_8
 0x0040

	)

413 
	#PCI_X_CMD_SPLIT_12
 0x0050

	)

414 
	#PCI_X_CMD_SPLIT_16
 0x0060

	)

415 
	#PCI_X_CMD_SPLIT_32
 0x0070

	)

416 
	#PCI_X_CMD_MAX_SPLIT
 0x0070

	)

417 
	#PCI_X_CMD_VERSION
(
x
Ë(((xË>> 12Ë& 3Ë

	)

418 
	#PCI_X_STATUS
 4

	)

419 
	#PCI_X_STATUS_DEVFN
 0x000000f‡

	)

420 
	#PCI_X_STATUS_BUS
 0x0000ff00

	)

421 
	#PCI_X_STATUS_64BIT
 0x00010000

	)

422 
	#PCI_X_STATUS_133MHZ
 0x00020000

	)

423 
	#PCI_X_STATUS_SPL_DISC
 0x00040000

	)

424 
	#PCI_X_STATUS_UNX_SPL
 0x00080000

	)

425 
	#PCI_X_STATUS_COMPLEX
 0x00100000

	)

426 
	#PCI_X_STATUS_MAX_READ
 0x00600000

	)

427 
	#PCI_X_STATUS_MAX_SPLIT
 0x03800000

	)

428 
	#PCI_X_STATUS_MAX_CUM
 0x1c000000

	)

429 
	#PCI_X_STATUS_SPL_ERR
 0x20000000

	)

430 
	#PCI_X_STATUS_266MHZ
 0x40000000

	)

431 
	#PCI_X_STATUS_533MHZ
 0x80000000

	)

432 
	#PCI_X_ECC_CSR
 8

	)

433 
	#PCI_CAP_PCIX_SIZEOF_V0
 8

	)

434 
	#PCI_CAP_PCIX_SIZEOF_V1
 24

	)

435 
	#PCI_CAP_PCIX_SIZEOF_V2
 
PCI_CAP_PCIX_SIZEOF_V1


	)

439 
	#PCI_X_BRIDGE_SSTATUS
 2

	)

440 
	#PCI_X_SSTATUS_64BIT
 0x0001

	)

441 
	#PCI_X_SSTATUS_133MHZ
 0x0002

	)

442 
	#PCI_X_SSTATUS_FREQ
 0x03c0

	)

443 
	#PCI_X_SSTATUS_VERS
 0x3000

	)

444 
	#PCI_X_SSTATUS_V1
 0x1000

	)

445 
	#PCI_X_SSTATUS_V2
 0x2000

	)

446 
	#PCI_X_SSTATUS_266MHZ
 0x4000

	)

447 
	#PCI_X_SSTATUS_533MHZ
 0x8000

	)

448 
	#PCI_X_BRIDGE_STATUS
 4

	)

452 
	#PCI_SSVID_VENDOR_ID
 4

	)

453 
	#PCI_SSVID_DEVICE_ID
 6

	)

457 
	#PCI_EXP_FLAGS
 2

	)

458 
	#PCI_EXP_FLAGS_VERS
 0x000‡

	)

459 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

460 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

461 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

462 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

463 
	#PCI_EXP_TYPE_UPSTREAM
 0x5

	)

464 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

465 
	#PCI_EXP_TYPE_PCI_BRIDGE
 0x7

	)

466 
	#PCI_EXP_TYPE_PCIE_BRIDGE
 0x8

	)

467 
	#PCI_EXP_TYPE_RC_END
 0x9

	)

468 
	#PCI_EXP_TYPE_RC_EC
 0x®

	)

469 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

470 
	#PCI_EXP_FLAGS_IRQ
 0x3e00

	)

471 
	#PCI_EXP_DEVCAP
 4

	)

472 
	#PCI_EXP_DEVCAP_PAYLOAD
 0x00000007

	)

473 
	#PCI_EXP_DEVCAP_PHANTOM
 0x00000018

	)

474 
	#PCI_EXP_DEVCAP_EXT_TAG
 0x00000020

	)

475 
	#PCI_EXP_DEVCAP_L0S
 0x000001c0

	)

476 
	#PCI_EXP_DEVCAP_L1
 0x00000e00

	)

477 
	#PCI_EXP_DEVCAP_ATN_BUT
 0x00001000

	)

478 
	#PCI_EXP_DEVCAP_ATN_IND
 0x00002000

	)

479 
	#PCI_EXP_DEVCAP_PWR_IND
 0x00004000

	)

480 
	#PCI_EXP_DEVCAP_RBER
 0x00008000

	)

481 
	#PCI_EXP_DEVCAP_PWR_VAL
 0x03fc0000

	)

482 
	#PCI_EXP_DEVCAP_PWR_SCL
 0x0c000000

	)

483 
	#PCI_EXP_DEVCAP_FLR
 0x10000000

	)

484 
	#PCI_EXP_DEVCTL
 8

	)

485 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

486 
	#PCI_EXP_DEVCTL_NFERE
 0x0002

	)

487 
	#PCI_EXP_DEVCTL_FERE
 0x0004

	)

488 
	#PCI_EXP_DEVCTL_URRE
 0x0008

	)

489 
	#PCI_EXP_DEVCTL_RELAX_EN
 0x0010

	)

490 
	#PCI_EXP_DEVCTL_PAYLOAD
 0x00e0

	)

491 
	#PCI_EXP_DEVCTL_EXT_TAG
 0x0100

	)

492 
	#PCI_EXP_DEVCTL_PHANTOM
 0x0200

	)

493 
	#PCI_EXP_DEVCTL_AUX_PME
 0x0400

	)

494 
	#PCI_EXP_DEVCTL_NOSNOOP_EN
 0x0800

	)

495 
	#PCI_EXP_DEVCTL_READRQ
 0x7000

	)

496 
	#PCI_EXP_DEVCTL_READRQ_128B
 0x0000

	)

497 
	#PCI_EXP_DEVCTL_READRQ_256B
 0x1000

	)

498 
	#PCI_EXP_DEVCTL_READRQ_512B
 0x2000

	)

499 
	#PCI_EXP_DEVCTL_READRQ_1024B
 0x3000

	)

500 
	#PCI_EXP_DEVCTL_BCR_FLR
 0x8000

	)

501 
	#PCI_EXP_DEVSTA
 10

	)

502 
	#PCI_EXP_DEVSTA_CED
 0x0001

	)

503 
	#PCI_EXP_DEVSTA_NFED
 0x0002

	)

504 
	#PCI_EXP_DEVSTA_FED
 0x0004

	)

505 
	#PCI_EXP_DEVSTA_URD
 0x0008

	)

506 
	#PCI_EXP_DEVSTA_AUXPD
 0x0010

	)

507 
	#PCI_EXP_DEVSTA_TRPND
 0x0020

	)

508 
	#PCI_EXP_LNKCAP
 12

	)

509 
	#PCI_EXP_LNKCAP_SLS
 0x0000000‡

	)

510 
	#PCI_EXP_LNKCAP_SLS_2_5GB
 0x00000001

	)

511 
	#PCI_EXP_LNKCAP_SLS_5_0GB
 0x00000002

	)

512 
	#PCI_EXP_LNKCAP_MLW
 0x000003f0

	)

513 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

514 
	#PCI_EXP_LNKCAP_L0SEL
 0x00007000

	)

515 
	#PCI_EXP_LNKCAP_L1EL
 0x00038000

	)

516 
	#PCI_EXP_LNKCAP_CLKPM
 0x00040000

	)

517 
	#PCI_EXP_LNKCAP_SDERC
 0x00080000

	)

518 
	#PCI_EXP_LNKCAP_DLLLARC
 0x00100000

	)

519 
	#PCI_EXP_LNKCAP_LBNC
 0x00200000

	)

520 
	#PCI_EXP_LNKCAP_PN
 0xff000000

	)

521 
	#PCI_EXP_LNKCTL
 16

	)

522 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

523 
	#PCI_EXP_LNKCTL_ASPM_L0S
 0x0001

	)

524 
	#PCI_EXP_LNKCTL_ASPM_L1
 0x0002

	)

525 
	#PCI_EXP_LNKCTL_RCB
 0x0008

	)

526 
	#PCI_EXP_LNKCTL_LD
 0x0010

	)

527 
	#PCI_EXP_LNKCTL_RL
 0x0020

	)

528 
	#PCI_EXP_LNKCTL_CCC
 0x0040

	)

529 
	#PCI_EXP_LNKCTL_ES
 0x0080

	)

530 
	#PCI_EXP_LNKCTL_CLKREQ_EN
 0x0100

	)

531 
	#PCI_EXP_LNKCTL_HAWD
 0x0200

	)

532 
	#PCI_EXP_LNKCTL_LBMIE
 0x0400

	)

533 
	#PCI_EXP_LNKCTL_LABIE
 0x0800

	)

534 
	#PCI_EXP_LNKSTA
 18

	)

535 
	#PCI_EXP_LNKSTA_CLS
 0x000‡

	)

536 
	#PCI_EXP_LNKSTA_CLS_2_5GB
 0x0001

	)

537 
	#PCI_EXP_LNKSTA_CLS_5_0GB
 0x0002

	)

538 
	#PCI_EXP_LNKSTA_CLS_8_0GB
 0x0003

	)

539 
	#PCI_EXP_LNKSTA_NLW
 0x03f0

	)

540 
	#PCI_EXP_LNKSTA_NLW_X1
 0x0010

	)

541 
	#PCI_EXP_LNKSTA_NLW_X2
 0x0020

	)

542 
	#PCI_EXP_LNKSTA_NLW_X4
 0x0040

	)

543 
	#PCI_EXP_LNKSTA_NLW_X8
 0x0080

	)

544 
	#PCI_EXP_LNKSTA_NLW_SHIFT
 4

	)

545 
	#PCI_EXP_LNKSTA_LT
 0x0800

	)

546 
	#PCI_EXP_LNKSTA_SLC
 0x1000

	)

547 
	#PCI_EXP_LNKSTA_DLLLA
 0x2000

	)

548 
	#PCI_EXP_LNKSTA_LBMS
 0x4000

	)

549 
	#PCI_EXP_LNKSTA_LABS
 0x8000

	)

550 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V1
 20

	)

551 
	#PCI_EXP_SLTCAP
 20

	)

552 
	#PCI_EXP_SLTCAP_ABP
 0x00000001

	)

553 
	#PCI_EXP_SLTCAP_PCP
 0x00000002

	)

554 
	#PCI_EXP_SLTCAP_MRLSP
 0x00000004

	)

555 
	#PCI_EXP_SLTCAP_AIP
 0x00000008

	)

556 
	#PCI_EXP_SLTCAP_PIP
 0x00000010

	)

557 
	#PCI_EXP_SLTCAP_HPS
 0x00000020

	)

558 
	#PCI_EXP_SLTCAP_HPC
 0x00000040

	)

559 
	#PCI_EXP_SLTCAP_SPLV
 0x00007f80

	)

560 
	#PCI_EXP_SLTCAP_SPLS
 0x00018000

	)

561 
	#PCI_EXP_SLTCAP_EIP
 0x00020000

	)

562 
	#PCI_EXP_SLTCAP_NCCS
 0x00040000

	)

563 
	#PCI_EXP_SLTCAP_PSN
 0xfff80000

	)

564 
	#PCI_EXP_SLTCTL
 24

	)

565 
	#PCI_EXP_SLTCTL_ABPE
 0x0001

	)

566 
	#PCI_EXP_SLTCTL_PFDE
 0x0002

	)

567 
	#PCI_EXP_SLTCTL_MRLSCE
 0x0004

	)

568 
	#PCI_EXP_SLTCTL_PDCE
 0x0008

	)

569 
	#PCI_EXP_SLTCTL_CCIE
 0x0010

	)

570 
	#PCI_EXP_SLTCTL_HPIE
 0x0020

	)

571 
	#PCI_EXP_SLTCTL_AIC
 0x00c0

	)

572 
	#PCI_EXP_SLTCTL_ATTN_IND_ON
 0x0040

	)

573 
	#PCI_EXP_SLTCTL_ATTN_IND_BLINK
 0x0080

	)

574 
	#PCI_EXP_SLTCTL_ATTN_IND_OFF
 0x00c0

	)

575 
	#PCI_EXP_SLTCTL_PIC
 0x0300

	)

576 
	#PCI_EXP_SLTCTL_PWR_IND_ON
 0x0100

	)

577 
	#PCI_EXP_SLTCTL_PWR_IND_BLINK
 0x0200

	)

578 
	#PCI_EXP_SLTCTL_PWR_IND_OFF
 0x0300

	)

579 
	#PCI_EXP_SLTCTL_PCC
 0x0400

	)

580 
	#PCI_EXP_SLTCTL_PWR_ON
 0x0000

	)

581 
	#PCI_EXP_SLTCTL_PWR_OFF
 0x0400

	)

582 
	#PCI_EXP_SLTCTL_EIC
 0x0800

	)

583 
	#PCI_EXP_SLTCTL_DLLSCE
 0x1000

	)

584 
	#PCI_EXP_SLTSTA
 26

	)

585 
	#PCI_EXP_SLTSTA_ABP
 0x0001

	)

586 
	#PCI_EXP_SLTSTA_PFD
 0x0002

	)

587 
	#PCI_EXP_SLTSTA_MRLSC
 0x0004

	)

588 
	#PCI_EXP_SLTSTA_PDC
 0x0008

	)

589 
	#PCI_EXP_SLTSTA_CC
 0x0010

	)

590 
	#PCI_EXP_SLTSTA_MRLSS
 0x0020

	)

591 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

592 
	#PCI_EXP_SLTSTA_EIS
 0x0080

	)

593 
	#PCI_EXP_SLTSTA_DLLSC
 0x0100

	)

594 
	#PCI_EXP_RTCTL
 28

	)

595 
	#PCI_EXP_RTCTL_SECEE
 0x0001

	)

596 
	#PCI_EXP_RTCTL_SENFEE
 0x0002

	)

597 
	#PCI_EXP_RTCTL_SEFEE
 0x0004

	)

598 
	#PCI_EXP_RTCTL_PMEIE
 0x0008

	)

599 
	#PCI_EXP_RTCTL_CRSSVE
 0x0010

	)

600 
	#PCI_EXP_RTCAP
 30

	)

601 
	#PCI_EXP_RTCAP_CRSVIS
 0x0001

	)

602 
	#PCI_EXP_RTSTA
 32

	)

603 
	#PCI_EXP_RTSTA_PME
 0x00010000

	)

604 
	#PCI_EXP_RTSTA_PENDING
 0x00020000

	)

613 
	#PCI_EXP_DEVCAP2
 36

	)

614 
	#PCI_EXP_DEVCAP2_ARI
 0x00000020

	)

615 
	#PCI_EXP_DEVCAP2_LTR
 0x00000800

	)

616 
	#PCI_EXP_DEVCAP2_OBFF_MASK
 0x000c0000

	)

617 
	#PCI_EXP_DEVCAP2_OBFF_MSG
 0x00040000

	)

618 
	#PCI_EXP_DEVCAP2_OBFF_WAKE
 0x00080000

	)

619 
	#PCI_EXP_DEVCTL2
 40

	)

620 
	#PCI_EXP_DEVCTL2_COMP_TIMEOUT
 0x000‡

	)

621 
	#PCI_EXP_DEVCTL2_ARI
 0x0020

	)

622 
	#PCI_EXP_DEVCTL2_IDO_REQ_EN
 0x0100

	)

623 
	#PCI_EXP_DEVCTL2_IDO_CMP_EN
 0x0200

	)

624 
	#PCI_EXP_DEVCTL2_LTR_EN
 0x0400

	)

625 
	#PCI_EXP_DEVCTL2_OBFF_MSGA_EN
 0x2000

	)

626 
	#PCI_EXP_DEVCTL2_OBFF_MSGB_EN
 0x4000

	)

627 
	#PCI_EXP_DEVCTL2_OBFF_WAKE_EN
 0x6000

	)

628 
	#PCI_EXP_DEVSTA2
 42

	)

629 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V2
 44

	)

630 
	#PCI_EXP_LNKCAP2
 44

	)

631 
	#PCI_EXP_LNKCAP2_SLS_2_5GB
 0x00000002

	)

632 
	#PCI_EXP_LNKCAP2_SLS_5_0GB
 0x00000004

	)

633 
	#PCI_EXP_LNKCAP2_SLS_8_0GB
 0x00000008

	)

634 
	#PCI_EXP_LNKCAP2_CROSSLINK
 0x00000100

	)

635 
	#PCI_EXP_LNKCTL2
 48

	)

636 
	#PCI_EXP_LNKSTA2
 50

	)

637 
	#PCI_EXP_SLTCAP2
 52

	)

638 
	#PCI_EXP_SLTCTL2
 56

	)

639 
	#PCI_EXP_SLTSTA2
 58

	)

642 
	#PCI_EXT_CAP_ID
(
hódî
Ë(hódî & 0x0000ffff)

	)

643 
	#PCI_EXT_CAP_VER
(
hódî
Ë((hódî >> 16Ë& 0xf)

	)

644 
	#PCI_EXT_CAP_NEXT
(
hódî
Ë((hódî >> 20Ë& 0xffc)

	)

646 
	#PCI_EXT_CAP_ID_ERR
 0x01

	)

647 
	#PCI_EXT_CAP_ID_VC
 0x02

	)

648 
	#PCI_EXT_CAP_ID_DSN
 0x03

	)

649 
	#PCI_EXT_CAP_ID_PWR
 0x04

	)

650 
	#PCI_EXT_CAP_ID_RCLD
 0x05

	)

651 
	#PCI_EXT_CAP_ID_RCILC
 0x06

	)

652 
	#PCI_EXT_CAP_ID_RCEC
 0x07

	)

653 
	#PCI_EXT_CAP_ID_MFVC
 0x08

	)

654 
	#PCI_EXT_CAP_ID_VC9
 0x09

	)

655 
	#PCI_EXT_CAP_ID_RCRB
 0x0A

	)

656 
	#PCI_EXT_CAP_ID_VNDR
 0x0B

	)

657 
	#PCI_EXT_CAP_ID_CAC
 0x0C

	)

658 
	#PCI_EXT_CAP_ID_ACS
 0x0D

	)

659 
	#PCI_EXT_CAP_ID_ARI
 0x0E

	)

660 
	#PCI_EXT_CAP_ID_ATS
 0x0F

	)

661 
	#PCI_EXT_CAP_ID_SRIOV
 0x10

	)

662 
	#PCI_EXT_CAP_ID_MRIOV
 0x11

	)

663 
	#PCI_EXT_CAP_ID_MCAST
 0x12

	)

664 
	#PCI_EXT_CAP_ID_PRI
 0x13

	)

665 
	#PCI_EXT_CAP_ID_AMD_XXX
 0x14

	)

666 
	#PCI_EXT_CAP_ID_REBAR
 0x15

	)

667 
	#PCI_EXT_CAP_ID_DPA
 0x16

	)

668 
	#PCI_EXT_CAP_ID_TPH
 0x17

	)

669 
	#PCI_EXT_CAP_ID_LTR
 0x18

	)

670 
	#PCI_EXT_CAP_ID_SECPCI
 0x19

	)

671 
	#PCI_EXT_CAP_ID_PMUX
 0x1A

	)

672 
	#PCI_EXT_CAP_ID_PASID
 0x1B

	)

673 
	#PCI_EXT_CAP_ID_MAX
 
PCI_EXT_CAP_ID_PASID


	)

675 
	#PCI_EXT_CAP_DSN_SIZEOF
 12

	)

676 
	#PCI_EXT_CAP_MCAST_ENDPOINT_SIZEOF
 40

	)

679 
	#PCI_ERR_UNCOR_STATUS
 4

	)

680 
	#PCI_ERR_UNC_UND
 0x00000001

	)

681 
	#PCI_ERR_UNC_DLP
 0x00000010

	)

682 
	#PCI_ERR_UNC_SURPDN
 0x00000020

	)

683 
	#PCI_ERR_UNC_POISON_TLP
 0x00001000

	)

684 
	#PCI_ERR_UNC_FCP
 0x00002000

	)

685 
	#PCI_ERR_UNC_COMP_TIME
 0x00004000

	)

686 
	#PCI_ERR_UNC_COMP_ABORT
 0x00008000

	)

687 
	#PCI_ERR_UNC_UNX_COMP
 0x00010000

	)

688 
	#PCI_ERR_UNC_RX_OVER
 0x00020000

	)

689 
	#PCI_ERR_UNC_MALF_TLP
 0x00040000

	)

690 
	#PCI_ERR_UNC_ECRC
 0x00080000

	)

691 
	#PCI_ERR_UNC_UNSUP
 0x00100000

	)

692 
	#PCI_ERR_UNC_ACSV
 0x00200000

	)

693 
	#PCI_ERR_UNC_INTN
 0x00400000

	)

694 
	#PCI_ERR_UNC_MCBTLP
 0x00800000

	)

695 
	#PCI_ERR_UNC_ATOMEG
 0x01000000

	)

696 
	#PCI_ERR_UNC_TLPPRE
 0x02000000

	)

697 
	#PCI_ERR_UNCOR_MASK
 8

	)

699 
	#PCI_ERR_UNCOR_SEVER
 12

	)

701 
	#PCI_ERR_COR_STATUS
 16

	)

702 
	#PCI_ERR_COR_RCVR
 0x00000001

	)

703 
	#PCI_ERR_COR_BAD_TLP
 0x00000040

	)

704 
	#PCI_ERR_COR_BAD_DLLP
 0x00000080

	)

705 
	#PCI_ERR_COR_REP_ROLL
 0x00000100

	)

706 
	#PCI_ERR_COR_REP_TIMER
 0x00001000

	)

707 
	#PCI_ERR_COR_ADV_NFAT
 0x00002000

	)

708 
	#PCI_ERR_COR_INTERNAL
 0x00004000

	)

709 
	#PCI_ERR_COR_LOG_OVER
 0x00008000

	)

710 
	#PCI_ERR_COR_MASK
 20

	)

712 
	#PCI_ERR_CAP
 24

	)

713 
	#PCI_ERR_CAP_FEP
(
x
Ë((xË& 31Ë

	)

714 
	#PCI_ERR_CAP_ECRC_GENC
 0x00000020

	)

715 
	#PCI_ERR_CAP_ECRC_GENE
 0x00000040

	)

716 
	#PCI_ERR_CAP_ECRC_CHKC
 0x00000080

	)

717 
	#PCI_ERR_CAP_ECRC_CHKE
 0x00000100

	)

718 
	#PCI_ERR_HEADER_LOG
 28

	)

719 
	#PCI_ERR_ROOT_COMMAND
 44

	)

721 
	#PCI_ERR_ROOT_CMD_COR_EN
 0x00000001

	)

723 
	#PCI_ERR_ROOT_CMD_NONFATAL_EN
 0x00000002

	)

725 
	#PCI_ERR_ROOT_CMD_FATAL_EN
 0x00000004

	)

726 
	#PCI_ERR_ROOT_STATUS
 48

	)

727 
	#PCI_ERR_ROOT_COR_RCV
 0x00000001

	)

729 
	#PCI_ERR_ROOT_MULTI_COR_RCV
 0x00000002

	)

731 
	#PCI_ERR_ROOT_UNCOR_RCV
 0x00000004

	)

733 
	#PCI_ERR_ROOT_MULTI_UNCOR_RCV
 0x00000008

	)

734 
	#PCI_ERR_ROOT_FIRST_FATAL
 0x00000010

	)

735 
	#PCI_ERR_ROOT_NONFATAL_RCV
 0x00000020

	)

736 
	#PCI_ERR_ROOT_FATAL_RCV
 0x00000040

	)

737 
	#PCI_ERR_ROOT_ERR_SRC
 52

	)

740 
	#PCI_VC_PORT_CAP1
 4

	)

741 
	#PCI_VC_CAP1_EVCC
 0x00000007

	)

742 
	#PCI_VC_CAP1_LPEVCC
 0x00000070

	)

743 
	#PCI_VC_CAP1_ARB_SIZE
 0x00000c00

	)

744 
	#PCI_VC_PORT_CAP2
 8

	)

745 
	#PCI_VC_CAP2_32_PHASE
 0x00000002

	)

746 
	#PCI_VC_CAP2_64_PHASE
 0x00000004

	)

747 
	#PCI_VC_CAP2_128_PHASE
 0x00000008

	)

748 
	#PCI_VC_CAP2_ARB_OFF
 0xff000000

	)

749 
	#PCI_VC_PORT_CTRL
 12

	)

750 
	#PCI_VC_PORT_CTRL_LOAD_TABLE
 0x00000001

	)

751 
	#PCI_VC_PORT_STATUS
 14

	)

752 
	#PCI_VC_PORT_STATUS_TABLE
 0x00000001

	)

753 
	#PCI_VC_RES_CAP
 16

	)

754 
	#PCI_VC_RES_CAP_32_PHASE
 0x00000002

	)

755 
	#PCI_VC_RES_CAP_64_PHASE
 0x00000004

	)

756 
	#PCI_VC_RES_CAP_128_PHASE
 0x00000008

	)

757 
	#PCI_VC_RES_CAP_128_PHASE_TB
 0x00000010

	)

758 
	#PCI_VC_RES_CAP_256_PHASE
 0x00000020

	)

759 
	#PCI_VC_RES_CAP_ARB_OFF
 0xff000000

	)

760 
	#PCI_VC_RES_CTRL
 20

	)

761 
	#PCI_VC_RES_CTRL_LOAD_TABLE
 0x00010000

	)

762 
	#PCI_VC_RES_CTRL_ARB_SELECT
 0x000e0000

	)

763 
	#PCI_VC_RES_CTRL_ID
 0x07000000

	)

764 
	#PCI_VC_RES_CTRL_ENABLE
 0x80000000

	)

765 
	#PCI_VC_RES_STATUS
 26

	)

766 
	#PCI_VC_RES_STATUS_TABLE
 0x00000001

	)

767 
	#PCI_VC_RES_STATUS_NEGO
 0x00000002

	)

768 
	#PCI_CAP_VC_BASE_SIZEOF
 0x10

	)

769 
	#PCI_CAP_VC_PER_VC_SIZEOF
 0x0C

	)

772 
	#PCI_PWR_DSR
 4

	)

773 
	#PCI_PWR_DATA
 8

	)

774 
	#PCI_PWR_DATA_BASE
(
x
Ë((xË& 0xffË

	)

775 
	#PCI_PWR_DATA_SCALE
(
x
Ë(((xË>> 8Ë& 3Ë

	)

776 
	#PCI_PWR_DATA_PM_SUB
(
x
Ë(((xË>> 10Ë& 7Ë

	)

777 
	#PCI_PWR_DATA_PM_STATE
(
x
Ë(((xË>> 13Ë& 3Ë

	)

778 
	#PCI_PWR_DATA_TYPE
(
x
Ë(((xË>> 15Ë& 7Ë

	)

779 
	#PCI_PWR_DATA_RAIL
(
x
Ë(((xË>> 18Ë& 7Ë

	)

780 
	#PCI_PWR_CAP
 12

	)

781 
	#PCI_PWR_CAP_BUDGET
(
x
Ë((xË& 1Ë

	)

782 
	#PCI_EXT_CAP_PWR_SIZEOF
 16

	)

785 
	#PCI_VNDR_HEADER
 4

	)

786 
	#PCI_VNDR_HEADER_ID
(
x
Ë((xË& 0xffff)

	)

787 
	#PCI_VNDR_HEADER_REV
(
x
Ë(((xË>> 16Ë& 0xf)

	)

788 
	#PCI_VNDR_HEADER_LEN
(
x
Ë(((xË>> 20Ë& 0xfff)

	)

798 
	#HT_3BIT_CAP_MASK
 0xE0

	)

799 
	#HT_CAPTYPE_SLAVE
 0x00

	)

800 
	#HT_CAPTYPE_HOST
 0x20

	)

802 
	#HT_5BIT_CAP_MASK
 0xF8

	)

803 
	#HT_CAPTYPE_IRQ
 0x80

	)

804 
	#HT_CAPTYPE_REMAPPING_40
 0xA0

	)

805 
	#HT_CAPTYPE_REMAPPING_64
 0xA2

	)

806 
	#HT_CAPTYPE_UNITID_CLUMP
 0x90

	)

807 
	#HT_CAPTYPE_EXTCONF
 0x98

	)

808 
	#HT_CAPTYPE_MSI_MAPPING
 0xA8

	)

809 
	#HT_MSI_FLAGS
 0x02

	)

810 
	#HT_MSI_FLAGS_ENABLE
 0x1

	)

811 
	#HT_MSI_FLAGS_FIXED
 0x2

	)

812 
	#HT_MSI_FIXED_ADDR
 0x00000000FEE00000ULL

	)

813 
	#HT_MSI_ADDR_LO
 0x04

	)

814 
	#HT_MSI_ADDR_LO_MASK
 0xFFF00000

	)

815 
	#HT_MSI_ADDR_HI
 0x08

	)

816 
	#HT_CAPTYPE_DIRECT_ROUTE
 0xB0

	)

817 
	#HT_CAPTYPE_VCSET
 0xB8

	)

818 
	#HT_CAPTYPE_ERROR_RETRY
 0xC0

	)

819 
	#HT_CAPTYPE_GEN3
 0xD0

	)

820 
	#HT_CAPTYPE_PM
 0xE0

	)

821 
	#HT_CAP_SIZEOF_LONG
 28

	)

822 
	#HT_CAP_SIZEOF_SHORT
 24

	)

825 
	#PCI_ARI_CAP
 0x04

	)

826 
	#PCI_ARI_CAP_MFVC
 0x0001

	)

827 
	#PCI_ARI_CAP_ACS
 0x0002

	)

828 
	#PCI_ARI_CAP_NFN
(
x
Ë(((xË>> 8Ë& 0xffË

	)

829 
	#PCI_ARI_CTRL
 0x06

	)

830 
	#PCI_ARI_CTRL_MFVC
 0x0001

	)

831 
	#PCI_ARI_CTRL_ACS
 0x0002

	)

832 
	#PCI_ARI_CTRL_FG
(
x
Ë(((xË>> 4Ë& 7Ë

	)

833 
	#PCI_EXT_CAP_ARI_SIZEOF
 8

	)

836 
	#PCI_ATS_CAP
 0x04

	)

837 
	#PCI_ATS_CAP_QDEP
(
x
Ë((xË& 0x1fË

	)

838 
	#PCI_ATS_MAX_QDEP
 32

	)

839 
	#PCI_ATS_CTRL
 0x06

	)

840 
	#PCI_ATS_CTRL_ENABLE
 0x8000

	)

841 
	#PCI_ATS_CTRL_STU
(
x
Ë((xË& 0x1fË

	)

842 
	#PCI_ATS_MIN_STU
 12

	)

843 
	#PCI_EXT_CAP_ATS_SIZEOF
 8

	)

846 
	#PCI_PRI_CTRL
 0x04

	)

847 
	#PCI_PRI_CTRL_ENABLE
 0x01

	)

848 
	#PCI_PRI_CTRL_RESET
 0x02

	)

849 
	#PCI_PRI_STATUS
 0x06

	)

850 
	#PCI_PRI_STATUS_RF
 0x001

	)

851 
	#PCI_PRI_STATUS_UPRGI
 0x002

	)

852 
	#PCI_PRI_STATUS_STOPPED
 0x100

	)

853 
	#PCI_PRI_MAX_REQ
 0x08

	)

854 
	#PCI_PRI_ALLOC_REQ
 0x0¯

	)

855 
	#PCI_EXT_CAP_PRI_SIZEOF
 16

	)

858 
	#PCI_PASID_CAP
 0x04

	)

859 
	#PCI_PASID_CAP_EXEC
 0x02

	)

860 
	#PCI_PASID_CAP_PRIV
 0x04

	)

861 
	#PCI_PASID_CTRL
 0x06

	)

862 
	#PCI_PASID_CTRL_ENABLE
 0x01

	)

863 
	#PCI_PASID_CTRL_EXEC
 0x02

	)

864 
	#PCI_PASID_CTRL_PRIV
 0x04

	)

865 
	#PCI_EXT_CAP_PASID_SIZEOF
 8

	)

868 
	#PCI_SRIOV_CAP
 0x04

	)

869 
	#PCI_SRIOV_CAP_VFM
 0x01

	)

870 
	#PCI_SRIOV_CAP_INTR
(
x
Ë((xË>> 21Ë

	)

871 
	#PCI_SRIOV_CTRL
 0x08

	)

872 
	#PCI_SRIOV_CTRL_VFE
 0x01

	)

873 
	#PCI_SRIOV_CTRL_VFM
 0x02

	)

874 
	#PCI_SRIOV_CTRL_INTR
 0x04

	)

875 
	#PCI_SRIOV_CTRL_MSE
 0x08

	)

876 
	#PCI_SRIOV_CTRL_ARI
 0x10

	)

877 
	#PCI_SRIOV_STATUS
 0x0®

	)

878 
	#PCI_SRIOV_STATUS_VFM
 0x01

	)

879 
	#PCI_SRIOV_INITIAL_VF
 0x0¯

	)

880 
	#PCI_SRIOV_TOTAL_VF
 0x0ê

	)

881 
	#PCI_SRIOV_NUM_VF
 0x10

	)

882 
	#PCI_SRIOV_FUNC_LINK
 0x12

	)

883 
	#PCI_SRIOV_VF_OFFSET
 0x14

	)

884 
	#PCI_SRIOV_VF_STRIDE
 0x16

	)

885 
	#PCI_SRIOV_VF_DID
 0x1®

	)

886 
	#PCI_SRIOV_SUP_PGSIZE
 0x1¯

	)

887 
	#PCI_SRIOV_SYS_PGSIZE
 0x20

	)

888 
	#PCI_SRIOV_BAR
 0x24

	)

889 
	#PCI_SRIOV_NUM_BARS
 6

	)

890 
	#PCI_SRIOV_VFM
 0x3¯

	)

891 
	#PCI_SRIOV_VFM_BIR
(
x
Ë((xË& 7Ë

	)

892 
	#PCI_SRIOV_VFM_OFFSET
(
x
Ë((xË& ~7Ë

	)

893 
	#PCI_SRIOV_VFM_UA
 0x0

	)

894 
	#PCI_SRIOV_VFM_MI
 0x1

	)

895 
	#PCI_SRIOV_VFM_MO
 0x2

	)

896 
	#PCI_SRIOV_VFM_AV
 0x3

	)

897 
	#PCI_EXT_CAP_SRIOV_SIZEOF
 64

	)

899 
	#PCI_LTR_MAX_SNOOP_LAT
 0x4

	)

900 
	#PCI_LTR_MAX_NOSNOOP_LAT
 0x6

	)

901 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

902 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

903 
	#PCI_LTR_SCALE_SHIFT
 10

	)

904 
	#PCI_EXT_CAP_LTR_SIZEOF
 8

	)

907 
	#PCI_ACS_CAP
 0x04

	)

908 
	#PCI_ACS_SV
 0x01

	)

909 
	#PCI_ACS_TB
 0x02

	)

910 
	#PCI_ACS_RR
 0x04

	)

911 
	#PCI_ACS_CR
 0x08

	)

912 
	#PCI_ACS_UF
 0x10

	)

913 
	#PCI_ACS_EC
 0x20

	)

914 
	#PCI_ACS_DT
 0x40

	)

915 
	#PCI_ACS_EGRESS_BITS
 0x05

	)

916 
	#PCI_ACS_CTRL
 0x06

	)

917 
	#PCI_ACS_EGRESS_CTL_V
 0x08

	)

919 
	#PCI_VSEC_HDR
 4

	)

920 
	#PCI_VSEC_HDR_LEN_SHIFT
 20

	)

923 
	#PCI_SATA_REGS
 4

	)

924 
	#PCI_SATA_REGS_MASK
 0xF

	)

925 
	#PCI_SATA_REGS_INLINE
 0xF

	)

926 
	#PCI_SATA_SIZEOF_SHORT
 8

	)

927 
	#PCI_SATA_SIZEOF_LONG
 16

	)

930 
	#PCI_REBAR_CTRL
 8

	)

931 
	#PCI_REBAR_CTRL_NBAR_MASK
 (7 << 5Ë

	)

932 
	#PCI_REBAR_CTRL_NBAR_SHIFT
 5

	)

935 
	#PCI_DPA_CAP
 4

	)

936 
	#PCI_DPA_CAP_SUBSTATE_MASK
 0x1F

	)

937 
	#PCI_DPA_BASE_SIZEOF
 16

	)

940 
	#PCI_TPH_CAP
 4

	)

941 
	#PCI_TPH_CAP_LOC_MASK
 0x600

	)

942 
	#PCI_TPH_LOC_NONE
 0x000

	)

943 
	#PCI_TPH_LOC_CAP
 0x200

	)

944 
	#PCI_TPH_LOC_MSIX
 0x400

	)

945 
	#PCI_TPH_CAP_ST_MASK
 0x07FF0000

	)

946 
	#PCI_TPH_CAP_ST_SHIFT
 16

	)

947 
	#PCI_TPH_BASE_SIZEOF
 12

	)

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kî√l_fd_£t
;

29 (*
	t__kî√l_sigh™dÀr_t
)();

32 
	t__kî√l_key_t
;

33 
	t__kî√l_mqd_t
;

35 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/sysinfo.h

1 #i‚de‡
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<löux/ty≥s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysöfo
 {

8 
__kî√l_l⁄g_t
 
	mu±ime
;

9 
__kî√l_ul⁄g_t
 
	mlﬂds
[3];

10 
__kî√l_ul⁄g_t
 
	mtŸÆøm
;

11 
__kî√l_ul⁄g_t
 
	m‰ìøm
;

12 
__kî√l_ul⁄g_t
 
	msh¨edøm
;

13 
__kî√l_ul⁄g_t
 
	mbuf„ºam
;

14 
__kî√l_ul⁄g_t
 
	mtŸÆsw≠
;

15 
__kî√l_ul⁄g_t
 
	m‰ìsw≠
;

16 
__u16
 
	m¥ocs
;

17 
__u16
 
	m∑d
;

18 
__kî√l_ul⁄g_t
 
	mtŸÆhigh
;

19 
__kî√l_ul⁄g_t
 
	m‰ìhigh
;

20 
__u32
 
	mmem_unô
;

21 
	m_f
[20-2*(
__kî√l_ul⁄g_t
)-(
__u32
)];

	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

6 
	~<asm-gíîic/öt-Œ64.h
>

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~<asm/posix_ty≥s_32.h
>

3 #ñi‡
deföed
(
__ILP32__
)

4 
	~<asm/posix_ty≥s_x32.h
>

6 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/linux/hdlc/ioctl.h

1 #i‚de‡
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

37 #i‚de‡
__ASSEMBLY__


40 
	m˛ock_øã
;

41 
	m˛ock_ty≥
;

42 
	mlo›back
;

43 } 
	tsync_£rül_£âögs
;

46 
	m˛ock_øã
;

47 
	m˛ock_ty≥
;

48 
	mlo›back
;

49 
	m¶Ÿ_m≠
;

50 } 
	tã1_£âögs
;

53 
	mícodög
;

54 
	m∑rôy
;

55 } 
	tøw_hdlc_¥Ÿo
;

58 
	mt391
;

59 
	mt392
;

60 
	mn391
;

61 
	mn392
;

62 
	mn393
;

63 
	mlmi
;

64 
	md˚
;

65 } 
	t‰_¥Ÿo
;

68 
	mdlci
;

69 } 
	t‰_¥Ÿo_pvc
;

72 
	mdlci
;

73 
	mma°î
[
IFNAMSIZ
];

74 }
	t‰_¥Ÿo_pvc_öfo
;

77 
	möãrvÆ
;

78 
	mtimeout
;

79 } 
	tcisco_¥Ÿo
;

	@/usr/include/linux/libc-compat.h

48 #i‚de‡
_LIBC_COMPAT_H


49 
	#_LIBC_COMPAT_H


	)

52 #i‡
deföed
(
__GLIBC__
)

55 #i‡
deföed
(
_NET_IF_H
Ë&& deföed(
__USE_MISC
)

60 
	#__UAPI_DEF_IF_IFCONF
 0

	)

61 
	#__UAPI_DEF_IF_IFMAP
 0

	)

62 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

63 
	#__UAPI_DEF_IF_IFREQ
 0

	)

65 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

67 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


68 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

77 
	#__UAPI_DEF_IF_IFCONF
 1

	)

78 
	#__UAPI_DEF_IF_IFMAP
 1

	)

79 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

80 
	#__UAPI_DEF_IF_IFREQ
 1

	)

82 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

84 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

89 #i‡
deföed
(
_NETINET_IN_H
)

93 
	#__UAPI_DEF_IN_ADDR
 0

	)

94 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

95 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

96 
	#__UAPI_DEF_IP_MREQ
 0

	)

97 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

98 
	#__UAPI_DEF_IN_CLASS
 0

	)

100 
	#__UAPI_DEF_IN6_ADDR
 0

	)

105 #i‡
deföed
(
__USE_MISC
Ë|| deföed (
__USE_GNU
)

106 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

108 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

110 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

111 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

112 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

113 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

114 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

115 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

122 
	#__UAPI_DEF_IN_ADDR
 1

	)

123 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

124 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

125 
	#__UAPI_DEF_IP_MREQ
 1

	)

126 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

127 
	#__UAPI_DEF_IN_CLASS
 1

	)

129 
	#__UAPI_DEF_IN6_ADDR
 1

	)

132 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

133 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

134 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

135 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

136 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

137 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

138 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

143 #i‡
deföed
(
_SYS_XATTR_H
)

144 
	#__UAPI_DEF_XATTR
 0

	)

146 
	#__UAPI_DEF_XATTR
 1

	)

155 
	#__UAPI_DEF_IF_IFCONF
 1

	)

156 
	#__UAPI_DEF_IF_IFMAP
 1

	)

157 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

158 
	#__UAPI_DEF_IF_IFREQ
 1

	)

160 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

162 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

165 
	#__UAPI_DEF_IN_ADDR
 1

	)

166 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

167 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

168 
	#__UAPI_DEF_IP_MREQ
 1

	)

169 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

170 
	#__UAPI_DEF_IN_CLASS
 1

	)

173 
	#__UAPI_DEF_IN6_ADDR
 1

	)

174 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

175 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

176 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

177 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

178 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

179 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

180 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

183 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/netlink.h

1 #i‚de‡
__LINUX_NETLINK_H


2 
	#__LINUX_NETLINK_H


	)

4 
	~<löux/kî√l.h
>

5 
	~<löux/sockë.h
>

6 
	~<löux/ty≥s.h
>

8 
	#NETLINK_ROUTE
 0

	)

9 
	#NETLINK_UNUSED
 1

	)

10 
	#NETLINK_USERSOCK
 2

	)

11 
	#NETLINK_FIREWALL
 3

	)

12 
	#NETLINK_SOCK_DIAG
 4

	)

13 
	#NETLINK_NFLOG
 5

	)

14 
	#NETLINK_XFRM
 6

	)

15 
	#NETLINK_SELINUX
 7

	)

16 
	#NETLINK_ISCSI
 8

	)

17 
	#NETLINK_AUDIT
 9

	)

18 
	#NETLINK_FIB_LOOKUP
 10

	)

19 
	#NETLINK_CONNECTOR
 11

	)

20 
	#NETLINK_NETFILTER
 12

	)

21 
	#NETLINK_IP6_FW
 13

	)

22 
	#NETLINK_DNRTMSG
 14

	)

23 
	#NETLINK_KOBJECT_UEVENT
 15

	)

24 
	#NETLINK_GENERIC
 16

	)

26 
	#NETLINK_SCSITRANSPORT
 18

	)

27 
	#NETLINK_ECRYPTFS
 19

	)

28 
	#NETLINK_RDMA
 20

	)

29 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

33 
	#MAX_LINKS
 32

	)

35 
	ssockaddr_∆
 {

36 
__kî√l_ß_Ámûy_t
 
	m∆_Ámûy
;

37 
	m∆_∑d
;

38 
__u32
 
	m∆_pid
;

39 
__u32
 
	m∆_groups
;

42 
	s∆msghdr
 {

43 
__u32
 
	m∆msg_Àn
;

44 
__u16
 
	m∆msg_ty≥
;

45 
__u16
 
	m∆msg_Êags
;

46 
__u32
 
	m∆msg_£q
;

47 
__u32
 
	m∆msg_pid
;

52 
	#NLM_F_REQUEST
 1

	)

53 
	#NLM_F_MULTI
 2

	)

54 
	#NLM_F_ACK
 4

	)

55 
	#NLM_F_ECHO
 8

	)

56 
	#NLM_F_DUMP_INTR
 16

	)

57 
	#NLM_F_DUMP_FILTERED
 32

	)

60 
	#NLM_F_ROOT
 0x100

	)

61 
	#NLM_F_MATCH
 0x200

	)

62 
	#NLM_F_ATOMIC
 0x400

	)

63 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

66 
	#NLM_F_REPLACE
 0x100

	)

67 
	#NLM_F_EXCL
 0x200

	)

68 
	#NLM_F_CREATE
 0x400

	)

69 
	#NLM_F_APPEND
 0x800

	)

80 
	#NLMSG_ALIGNTO
 4U

	)

81 
	#NLMSG_ALIGN
(
Àn
Ë–(÷í)+
NLMSG_ALIGNTO
-1Ë& ~(NLMSG_ALIGNTO-1Ë)

	)

82 
	#NLMSG_HDRLEN
 ((Ë
	`NLMSG_ALIGN
((
∆msghdr
)))

	)

83 
	#NLMSG_LENGTH
(
Àn
Ë(÷íË+ 
NLMSG_HDRLEN
)

	)

84 
	#NLMSG_SPACE
(
Àn
Ë
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
÷í))

	)

85 
	#NLMSG_DATA
(
∆h
Ë((*)(((*ÍlhË+ 
	`NLMSG_LENGTH
(0)))

	)

86 
	#NLMSG_NEXT
(
∆h
,
Àn
Ë(÷íË-
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
), \

87 (
∆msghdr
*)(((*)(
∆h
)Ë+ 
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
)))

	)

88 
	#NLMSG_OK
(
∆h
,
Àn
Ë(÷íË>()(
∆msghdr
) && \

89 (
∆h
)->
∆msg_Àn
 >(
∆msghdr
) && \

90 (
∆h
)->
∆msg_Àn
 <(
Àn
))

	)

91 
	#NLMSG_PAYLOAD
(
∆h
,
Àn
Ë(“lh)->
∆msg_Àn
 - 
	`NLMSG_SPACE
(÷í)))

	)

93 
	#NLMSG_NOOP
 0x1

	)

94 
	#NLMSG_ERROR
 0x2

	)

95 
	#NLMSG_DONE
 0x3

	)

96 
	#NLMSG_OVERRUN
 0x4

	)

98 
	#NLMSG_MIN_TYPE
 0x10

	)

100 
	s∆msgîr
 {

101 
	mîr‹
;

102 
∆msghdr
 
	mmsg
;

105 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

106 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

107 
	#NETLINK_PKTINFO
 3

	)

108 
	#NETLINK_BROADCAST_ERROR
 4

	)

109 
	#NETLINK_NO_ENOBUFS
 5

	)

110 
	#NETLINK_RX_RING
 6

	)

111 
	#NETLINK_TX_RING
 7

	)

112 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

113 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

114 
	#NETLINK_CAP_ACK
 10

	)

116 
	s∆_pktöfo
 {

117 
__u32
 
	mgroup
;

120 
	s∆_mm≠_ªq
 {

121 
	mnm_block_size
;

122 
	mnm_block_ƒ
;

123 
	mnm_‰ame_size
;

124 
	mnm_‰ame_ƒ
;

127 
	s∆_mm≠_hdr
 {

128 
	mnm_°©us
;

129 
	mnm_Àn
;

130 
__u32
 
	mnm_group
;

132 
__u32
 
	mnm_pid
;

133 
__u32
 
	mnm_uid
;

134 
__u32
 
	mnm_gid
;

137 
	e∆_mm≠_°©us
 {

138 
	mNL_MMAP_STATUS_UNUSED
,

139 
	mNL_MMAP_STATUS_RESERVED
,

140 
	mNL_MMAP_STATUS_VALID
,

141 
	mNL_MMAP_STATUS_COPY
,

142 
	mNL_MMAP_STATUS_SKIP
,

145 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

146 
	#NL_MMAP_MSG_ALIGN
(
sz
Ë
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

147 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
∆_mm≠_hdr
))

	)

149 
	#NET_MAJOR
 36

	)

152 
	mNETLINK_UNCONNECTED
 = 0,

153 
	mNETLINK_CONNECTED
,

165 
	s∆©å
 {

166 
__u16
 
	m∆a_Àn
;

167 
__u16
 
	m∆a_ty≥
;

180 
	#NLA_F_NESTED
 (1 << 15)

	)

181 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

182 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

184 
	#NLA_ALIGNTO
 4

	)

185 
	#NLA_ALIGN
(
Àn
Ë((÷íË+ 
NLA_ALIGNTO
 - 1Ë& ~(NLA_ALIGNTO - 1))

	)

186 
	#NLA_HDRLEN
 ((Ë
	`NLA_ALIGN
((
∆©å
)))

	)

	@/usr/include/linux/socket.h

1 #i‚de‡
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__Æignof__
 (
sockaddr
 *))

	)

11 
	t__kî√l_ß_Ámûy_t
;

13 
	s__kî√l_sockaddr_°‹age
 {

14 
__kî√l_ß_Ámûy_t
 
	mss_Ámûy
;

16 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

19 } 
__©åibuã__
 ((
Æig√d
(
_K_SS_ALIGNSIZE
)));

	@/usr/include/linux/stddef.h

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #i‚de‡
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #i‚de‡
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #i‚de‡
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #i‚de‡
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #i‚de‡
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

66 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

67 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

68 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

69 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
Ë(—))

	)

74 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

75 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

79 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

80 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

83 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm/posix_types_32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__kî√l_mode_t
;

11 
	#__kî√l_mode_t
 
__kî√l_mode_t


	)

13 
	t__kî√l_ùc_pid_t
;

14 
	#__kî√l_ùc_pid_t
 
__kî√l_ùc_pid_t


	)

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	#__kî√l_uid_t
 
__kî√l_uid_t


	)

20 
	t__kî√l_ﬁd_dev_t
;

21 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

23 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_64.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__kî√l_ﬁd_uid_t
;

11 
	t__kî√l_ﬁd_gid_t
;

12 
	#__kî√l_ﬁd_uid_t
 
__kî√l_ﬁd_uid_t


	)

14 
	t__kî√l_ﬁd_dev_t
;

15 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

17 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__kî√l_l⁄g_t
;

14 
	t__kî√l_ul⁄g_t
;

15 
	#__kî√l_l⁄g_t
 
__kî√l_l⁄g_t


	)

17 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/asm-generic/posix_types.h

1 #i‚de‡
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__kî√l_l⁄g_t


14 
	t__kî√l_l⁄g_t
;

15 
	t__kî√l_ul⁄g_t
;

18 #i‚de‡
__kî√l_öo_t


19 
__kî√l_ul⁄g_t
 
	t__kî√l_öo_t
;

22 #i‚de‡
__kî√l_mode_t


23 
	t__kî√l_mode_t
;

26 #i‚de‡
__kî√l_pid_t


27 
	t__kî√l_pid_t
;

30 #i‚de‡
__kî√l_ùc_pid_t


31 
	t__kî√l_ùc_pid_t
;

34 #i‚de‡
__kî√l_uid_t


35 
	t__kî√l_uid_t
;

36 
	t__kî√l_gid_t
;

39 #i‚de‡
__kî√l_su£c⁄ds_t


40 
__kî√l_l⁄g_t
 
	t__kî√l_su£c⁄ds_t
;

43 #i‚de‡
__kî√l_daddr_t


44 
	t__kî√l_daddr_t
;

47 #i‚de‡
__kî√l_uid32_t


48 
	t__kî√l_uid32_t
;

49 
	t__kî√l_gid32_t
;

52 #i‚de‡
__kî√l_ﬁd_uid_t


53 
__kî√l_uid_t
 
	t__kî√l_ﬁd_uid_t
;

54 
__kî√l_gid_t
 
	t__kî√l_ﬁd_gid_t
;

57 #i‚de‡
__kî√l_ﬁd_dev_t


58 
	t__kî√l_ﬁd_dev_t
;

65 #i‚de‡
__kî√l_size_t


66 #i‡
__BITS_PER_LONG
 != 64

67 
	t__kî√l_size_t
;

68 
	t__kî√l_ssize_t
;

69 
	t__kî√l_±rdiff_t
;

71 
__kî√l_ul⁄g_t
 
	t__kî√l_size_t
;

72 
__kî√l_l⁄g_t
 
	t__kî√l_ssize_t
;

73 
__kî√l_l⁄g_t
 
	t__kî√l_±rdiff_t
;

77 #i‚de‡
__kî√l_fsid_t


79 
	mvÆ
[2];

80 } 
	t__kî√l_fsid_t
;

86 
__kî√l_l⁄g_t
 
	t__kî√l_off_t
;

87 
	t__kî√l_loff_t
;

88 
__kî√l_l⁄g_t
 
	t__kî√l_time_t
;

89 
__kî√l_l⁄g_t
 
	t__kî√l_˛ock_t
;

90 
	t__kî√l_timî_t
;

91 
	t__kî√l_˛ockid_t
;

92 * 
	t__kî√l_ˇddr_t
;

93 
	t__kî√l_uid16_t
;

94 
	t__kî√l_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #i‡
deföed
(
__x86_64__
Ë&& !deföed(
__ILP32__
)

5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
150
2441
ahb.c
ani.c
ani.h
antenna.c
ar5008_initvals.h
ar5008_phy.c
ar9001_initvals.h
ar9002_calib.c
ar9002_hw.c
ar9002_initvals.h
ar9002_mac.c
ar9002_phy.c
ar9002_phy.h
ar9003_2p2_initvals.h
ar9003_aic.c
ar9003_aic.h
ar9003_buffalo_initvals.h
ar9003_calib.c
ar9003_eeprom.c
ar9003_eeprom.h
ar9003_hw.c
ar9003_mac.c
ar9003_mac.h
ar9003_mci.c
ar9003_mci.h
ar9003_paprd.c
ar9003_phy.c
ar9003_phy.h
ar9003_rtt.c
ar9003_rtt.h
ar9003_wow.c
ar9330_1p1_initvals.h
ar9330_1p2_initvals.h
ar9340_initvals.h
ar9462_2p0_initvals.h
ar9462_2p1_initvals.h
ar9485_initvals.h
ar953x_initvals.h
ar955x_1p0_initvals.h
ar9565_1p0_initvals.h
ar9565_1p1_initvals.h
ar956x_initvals.h
ar9580_1p0_initvals.h
ath9k.h
ath9k.mod.c
ath9k_common.mod.c
ath9k_hw.mod.c
beacon.c
btcoex.c
btcoex.h
calib.c
calib.h
channel.c
common-beacon.c
common-beacon.h
common-debug.c
common-debug.h
common-init.c
common-init.h
common-spectral.c
common-spectral.h
common.c
common.h
debug.c
debug.h
debug_sta.c
dfs.c
dfs.h
dfs_debug.c
dfs_debug.h
dynack.c
dynack.h
eeprom.c
eeprom.h
eeprom_4k.c
eeprom_9287.c
eeprom_def.c
gpio.c
hif_usb.c
hif_usb.h
htc.h
htc_drv_beacon.c
htc_drv_debug.c
htc_drv_gpio.c
htc_drv_init.c
htc_drv_main.c
htc_drv_txrx.c
htc_hst.c
htc_hst.h
hw-ops.h
hw.c
hw.h
init.c
link.c
mac.c
mac.h
main.c
mci.c
mci.h
pci.c
phy.h
recv.c
reg.h
reg_aic.h
reg_mci.h
reg_wow.h
rng.c
tx99.c
wmi.c
wmi.h
wow.c
xmit.c
../ath.h
../dfs_pattern_detector.h
../reg.h
../regd.h
../spectral_common.h
/usr/include/linux/if_ether.h
/usr/include/linux/kernel.h
/usr/include/linux/netdevice.h
/usr/include/linux/nl80211.h
/usr/include/linux/pci.h
/usr/include/linux/random.h
/usr/include/linux/time.h
/usr/include/linux/types.h
/usr/include/asm/types.h
/usr/include/linux/if.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/irqnr.h
/usr/include/linux/pci_regs.h
/usr/include/linux/posix_types.h
/usr/include/linux/sysinfo.h
/usr/include/asm-generic/types.h
/usr/include/asm/ioctl.h
/usr/include/asm/posix_types.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/libc-compat.h
/usr/include/linux/netlink.h
/usr/include/linux/socket.h
/usr/include/linux/stddef.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
